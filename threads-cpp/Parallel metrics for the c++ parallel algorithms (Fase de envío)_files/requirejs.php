/**
 * AJAX helper for the tag management page.
 *
 * @module     core/tag
 * @package    core_tag
 * @copyright  2015 Marina Glancy
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.0
 */
define("core/tag",["jquery","core/ajax","core/templates","core/notification","core/str","core/modal_factory","core/modal_events","core/pending"],(function($,ajax,templates,notification,str,ModalFactory,ModalEvents,Pending){return{initTagindexPage:function(){$("body").delegate(".tagarea[data-ta] a[data-quickload=1]","click",(function(e){var pendingPromise=new Pending("core/tag:initTagindexPage");e.preventDefault();var target=$(this),query=target[0].search.replace(/^\?/,""),tagarea=target.closest(".tagarea[data-ta]"),args=query.split("&").reduce((function(s,c){var t=c.split("=");return s[t[0]]=decodeURIComponent(t[1]),s}),{});ajax.call([{methodname:"core_tag_get_tagindex",args:{tagindex:args}}])[0].then((function(data){return templates.render("core_tag/index",data)})).then((function(html,js){templates.replaceNode(tagarea,html,js)})).always(pendingPromise.resolve).catch(notification.exception)}))},initManagePage:function(){$("body").on("updated","[data-inplaceeditable]",(function(e){var pendingPromise=new Pending("core/tag:initManagePage");if(str.get_strings([{key:"selecttag",component:"core_tag"},{key:"now",component:"core"}]).then((function(result){$('label[for="tagselect'+e.ajaxreturn.itemid+'"]').html(result[0]),$(e.target).closest("tr").find("td.col-timemodified").html(result[1])})).always(pendingPromise.resolve).catch(notification.exception),"tagflag"===e.ajaxreturn.itemtype){var row=$(e.target).closest("tr");"0"===e.ajaxreturn.value?row.removeClass("flagged-tag"):row.addClass("flagged-tag")}})),$(".tag-management-table").delegate("a.tagdelete","click",(function(e){var pendingPromise=new Pending("core/tag:tagdelete");e.preventDefault();var href=$(this).attr("href");str.get_strings([{key:"delete",component:"core"},{key:"confirmdeletetag",component:"tag"},{key:"yes",component:"core"},{key:"no",component:"core"}]).then((function(s){return notification.confirm(s[0],s[1],s[2],s[3],(function(){window.location.href=href}))})).always(pendingPromise.resolve).catch(notification.exception)})),$("#tag-management-delete").click((function(e){var form=$(this).closest("form").get(0);if($(form).find("input[type=checkbox]:checked").length){var pendingPromise=new Pending("core/tag:tag-management-delete"),tempElement=$("<input type='hidden'/>").attr("name",this.name);e.preventDefault(),str.get_strings([{key:"delete",component:"core"},{key:"confirmdeletetags",component:"tag"},{key:"yes",component:"core"},{key:"no",component:"core"}]).then((function(s){return notification.confirm(s[0],s[1],s[2],s[3],(function(){tempElement.appendTo(form),form.submit()}))})).always(pendingPromise.resolve).catch(notification.exception)}})),$("#tag-management-combine").click((function(e){var pendingPromise=new Pending("core/tag:tag-management-combine");e.preventDefault();var form=$(this).closest("form").get(0),tags=$(form).find("input[type=checkbox]:checked");if(tags.length<=1)str.get_strings([{key:"combineselected",component:"tag"},{key:"selectmultipletags",component:"tag"},{key:"ok"}]).then((function(s){return notification.alert(s[0],s[1],s[2])})).always(pendingPromise.resolve).catch(notification.exception);else{var tempElement=$("<input type='hidden'/>").attr("name",this.name),saveButtonText="",tagOptions=[];tags.each((function(){var tagid=$(this).val(),tagname=$(".inplaceeditable[data-itemtype=tagname][data-itemid="+tagid+"]").attr("data-value");tagOptions.push({id:tagid,name:tagname})})),str.get_strings([{key:"combineselected",component:"tag"},{key:"continue",component:"core"}]).then((function(langStrings){var modalTitle=langStrings[0];saveButtonText=langStrings[1];var templateContext={tags:tagOptions};return ModalFactory.create({title:modalTitle,body:templates.render("core_tag/combine_tags",templateContext),type:ModalFactory.types.SAVE_CANCEL})})).then((function(modal){return modal.setSaveButtonText(saveButtonText),modal})).then((function(modal){modal.getRoot().on(ModalEvents.save,(function(e){e.preventDefault(),tempElement.appendTo(form);var maintag=$("input[name=maintag]:checked","#combinetags_form").val();$("<input type='hidden'/>").attr("name","maintag").attr("value",maintag).appendTo(form),form.submit()})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.show(),$("#combinetags_form input[type=radio]").first().focus().prop("checked",!0)})).always(pendingPromise.resolve).catch(notification.exception)}})),$("body").on("updatefailed","[data-inplaceeditable][data-itemtype=tagname]",(function(e){var exception=e.exception,newvalue=e.newvalue,tagid=$(e.target).attr("data-itemid");if("namesalreadybeeingused"===exception.errorcode){var pendingPromise=new Pending("core/tag:updatefailed");e.preventDefault(),str.get_strings([{key:"confirm",component:"core"},{key:"nameuseddocombine",component:"tag"},{key:"yes",component:"core"},{key:"cancel",component:"core"}]).then((function(s){return notification.confirm(s[0],s[1],s[2],s[3],(function(){window.location.href=window.location.href+"&newname="+encodeURIComponent(newvalue)+"&tagid="+encodeURIComponent(tagid)+"&action=renamecombine&sesskey="+M.cfg.sesskey}))})).always(pendingPromise.resolve).catch(notification.exception)}})),$("body").on("click","a[data-action=addstandardtag]",(function(e){var pendingPromise=new Pending("core/tag:addstandardtag");return e.preventDefault(),ModalFactory.create({title:str.get_string("addotags","tag"),body:templates.render("core_tag/add_tags",{actionurl:window.location.href,sesskey:M.cfg.sesskey}),type:ModalFactory.types.SAVE_CANCEL}).then((function(modal){modal.setSaveButtonText(str.get_string("continue","core")),modal.getRoot().on(ModalEvents.save,(function(e){var tagsInput=$(e.currentTarget).find("#id_tagslist"),name=tagsInput.val().trim();tagsInput.val(name);var tagsForm=$("#addtags_form");return tagsForm.on("submit",(function(e){var form=$("#addtags_form");!1===form[0].checkValidity()&&(e.preventDefault(),e.stopPropagation()),form.addClass("was-validated"),$('[data-region="tagslistinput"]').addClass("error");var errorMessage=$("#id_tagslist_error_message");errorMessage.removeAttr("hidden"),errorMessage.addClass("help-block")})),tagsForm.submit(),!1})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.show()})).always(pendingPromise.resolve).catch(notification.exception)}))},initManageCollectionsPage:function(){$("body").on("updated","[data-inplaceeditable]",(function(e){var areaid,collid,pendingPromise=new Pending("core/tag:initManageCollectionsPage-updated"),ajaxreturn=e.ajaxreturn;"core_tag"===ajaxreturn.component&&"tagareaenable"===ajaxreturn.itemtype&&(areaid=$(this).attr("data-itemid"),$(".tag-collections-table ul[data-collectionid] li[data-areaid="+areaid+"]").hide(),"1"===ajaxreturn.value?($(this).closest("tr").removeClass("dimmed_text"),collid=$(this).closest("tr").find('[data-itemtype="tagareacollection"]').attr("data-value"),$(".tag-collections-table ul[data-collectionid="+collid+"] li[data-areaid="+areaid+"]").show()):$(this).closest("tr").addClass("dimmed_text")),"core_tag"===ajaxreturn.component&&"tagareacollection"===ajaxreturn.itemtype&&(areaid=$(this).attr("data-itemid"),$(".tag-collections-table ul[data-collectionid] li[data-areaid="+areaid+"]").hide(),collid=$(this).attr("data-value"),"1"===$(this).closest("tr").find('[data-itemtype="tagareaenable"]').attr("data-value")&&$(".tag-collections-table ul[data-collectionid="+collid+"] li[data-areaid="+areaid+"]").show()),pendingPromise.resolve()})),$("body").on("click",".addtagcoll > a",(function(e){var pendingPromise=new Pending("core/tag:initManageCollectionsPage-addtagcoll");e.preventDefault();var href=$(this).attr("data-url"),saveButtonText="";str.get_strings([{key:"addtagcoll",component:"tag"},{key:"create",component:"core"}]).then((function(langStrings){var modalTitle=langStrings[0];saveButtonText=langStrings[1];var templateContext={actionurl:href,sesskey:M.cfg.sesskey};return ModalFactory.create({title:modalTitle,body:templates.render("core_tag/add_tag_collection",templateContext),type:ModalFactory.types.SAVE_CANCEL})})).then((function(modal){return modal.setSaveButtonText(saveButtonText),modal.getRoot().on(ModalEvents.save,(function(e){var collectionInput=$(e.currentTarget).find("#addtagcoll_name"),name=collectionInput.val().trim();collectionInput.val(name);var form=$("#addtagcoll_form");return form.on("submit",(function(e){!1===form[0].checkValidity()&&(e.preventDefault(),e.stopPropagation()),form.addClass("was-validated"),$('[data-region="addtagcoll_nameinput"]').addClass("error");var errorMessage=$("#id_addtagcoll_name_error_message");errorMessage.removeAttr("hidden"),errorMessage.addClass("help-block")})),form.submit(),!1})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.show(),modal})).always(pendingPromise.resolve).catch(notification.exception)})),$("body").on("click",".tag-collections-table .action_delete",(function(e){var pendingPromise=new Pending("core/tag:initManageCollectionsPage-action_delete");e.preventDefault();var href=$(this).attr("data-url")+"&sesskey="+M.cfg.sesskey;str.get_strings([{key:"delete"},{key:"suredeletecoll",component:"tag",param:$(this).attr("data-collname")},{key:"yes"},{key:"no"}]).then((function(s){return notification.confirm(s[0],s[1],s[2],s[3],(function(){window.location.href=href}))})).always(pendingPromise.resolve).catch(notification.exception)}))}}}));
/**
 * This is an empty module, that is required before all other modules.
 * Because every module is returned from a request for any other module, this
 * forces the loading of all modules with a single request.
 *
 * @module     core/log
 * @package    core
 * @copyright  2015 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/log",["core/loglevel"],(function(log){var originalFactory=log.methodFactory;return log.methodFactory=function(methodName,logLevel){var rawMethod=originalFactory(methodName,logLevel);return function(message,source){rawMethod(source?source+": "+message:message)}},log.setConfig=function(config){void 0!==config.level&&log.setLevel(config.level)},log}));
define("core/pubsub",["exports","core/pending"],(function(_exports,_pending){var obj;
/**
   * A simple Javascript PubSub implementation.
   *
   * @module     core/pubsub
   * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.unsubscribe=_exports.subscribe=_exports.publish=void 0,_pending=(obj=_pending)&&obj.__esModule?obj:{default:obj};var events={};_exports.subscribe=function(eventName,callback){events[eventName]=events[eventName]||[],events[eventName].push(callback)};_exports.unsubscribe=function(eventName,callback){if(events[eventName])for(var i=0;i<events[eventName].length;i++)if(events[eventName][i]===callback){events[eventName].splice(i,1);break}};_exports.publish=function(eventName,data){var pendingPromise=new _pending.default("Publishing "+eventName);events[eventName]&&events[eventName].forEach((function(callback){callback(data)})),pendingPromise.resolve()}}));
/**
 * Enhance a textarea with auto growing rows to fit the content.
 *
 * @module     core/auto_rows
 * @class      auto_rows
 * @package    core
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.2
 */
define("core/auto_rows",["jquery"],(function($){var SELECTORS_ELEMENT="[data-auto-rows]",EVENTS={ROW_CHANGE:"autorows:rowchange"},changeListener=function(e){var element=$(e.target),minRows=element.data("min-rows"),currentRows=element.attr("rows");void 0===minRows&&element.data("min-rows",currentRows),element.attr("rows",1);var rows=function(element){var currentRows=element.attr("rows"),minRows=element.data("min-rows"),maxRows=element.attr("data-max-rows"),height=element.height(),padding=element.innerHeight()-height,rows=(element[0].scrollHeight-padding)/(height/currentRows);return element.css("height",""),rows<minRows?minRows:maxRows&&rows>=maxRows?maxRows:rows}(element);element.attr("rows",rows),rows!=currentRows&&element.trigger(EVENTS.ROW_CHANGE)};return{init:function(root){$(root).data("auto-rows")?$(root).on("input propertychange",changeListener.bind(this)):$(root).on("input propertychange",SELECTORS_ELEMENT,changeListener.bind(this))},events:EVENTS}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core/emoji/auto_complete",["exports","core/emoji/data","core/templates","core/utils","core/localstorage","core/key_codes"],(function(_exports,EmojiData,_templates,_utils,_localstorage,_key_codes){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,EmojiData=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(EmojiData),_localstorage=_interopRequireDefault(_localstorage),_key_codes=_interopRequireDefault(_key_codes);var fn,_ref,SELECTORS_EMOJI_BUTTON='[data-region="emoji-button"]',SELECTORS_ACTIVE_EMOJI_BUTTON='[data-region="emoji-button"].active',getRecentEmojis=function(){var storedData=_localstorage.default.get("moodle-recent-emojis");return storedData?JSON.parse(storedData):[]},addRecentEmoji=function(unified,shortName){var newEmoji={unified:unified,shortnames:[shortName]},recentEmojis=getRecentEmojis(),newRecentEmojis=[newEmoji].concat(_toConsumableArray(recentEmojis.filter((function(emoji){return emoji.unified!=newEmoji.unified}))));newRecentEmojis=newRecentEmojis.slice(0,27),_localstorage.default.set("moodle-recent-emojis",JSON.stringify(newRecentEmojis))},getEmojiTextFromShortName=function(shortName){var unified=EmojiData.byShortName[shortName];if(unified){var charCodes=unified.split("-").map((function(code){return"0x".concat(code)}));return String.fromCodePoint.apply(null,charCodes)}return null},render=(fn=regeneratorRuntime.mark((function _callee(root,shortNames){var renderContext,html;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return renderContext={emojis:shortNames.map((function(shortName,index){return{active:0===index,emojitext:getEmojiTextFromShortName(shortName),displayshortname:":".concat(shortName,":"),shortname:shortName,unified:EmojiData.byShortName[shortName]}}))},_context.next=3,(0,_templates.render)("core/emoji/auto_complete",renderContext);case 3:html=_context.sent,root.innerHTML=html;case 5:case"end":return _context.stop()}}),_callee)})),_ref=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(_x,_x2){return _ref.apply(this,arguments)}),getShortNameFromText=function(text){return text.replace(/:/g,"")},getActiveEmojiSuggestion=function(root){return root.querySelector(SELECTORS_ACTIVE_EMOJI_BUTTON)},selectEmojiElement=function(element,selectCallback){var shortName=element.getAttribute("data-short-name"),unified=element.getAttribute("data-unified");addRecentEmoji(unified,shortName),selectCallback(element.innerHTML.trim())};return _exports.default=function(root,textArea,hasSuggestionCallback,selectCallback){var hasSuggestions=!1,previousSearchText="";textArea.addEventListener("keyup",(0,_utils.debounce)((function(){var searchText=function(text,position){var startMatches=text.slice(0,position).match(/(\S*)$/),endMatches=text.slice(position).match(/^(\S*)/),startText="",endText="";return startMatches&&(startText=startMatches[startMatches.length-1]),endMatches&&(endText=endMatches[endMatches.length-1]),"".concat(startText).concat(endText)}(textArea.value,textArea.selectionStart);if(searchText!==previousSearchText){if(previousSearchText=searchText,function(text){return/^:[^:\s]+:$/.test(text)}(searchText)){var shortName=getShortNameFromText(searchText),emojiText=getEmojiTextFromShortName(shortName);hasSuggestions=!1,emojiText&&(addRecentEmoji(EmojiData.byShortName[shortName],shortName),selectCallback(emojiText))}else if(function(text){return/^:[^:\s]*$/.test(text)}(searchText)){var suggestions=(searchTerm=getShortNameFromText(searchText),limit=50,""===searchTerm?getRecentEmojis().map((function(data){return data.shortnames[0]})).slice(0,limit):(searchTerm=searchTerm.toLowerCase(),Object.keys(EmojiData.byShortName).filter((function(shortName){return shortName.includes(searchTerm)})).slice(0,limit)));suggestions.length?(render(root,suggestions),hasSuggestions=!0):hasSuggestions=!1}else hasSuggestions=!1;var searchTerm,limit;hasSuggestionCallback(hasSuggestions)}}),200)),textArea.addEventListener("keydown",(function(e){if(hasSuggestions&&!(e.shiftKey||e.metaKey||e.altKey||e.ctrlKey))switch(e.which){case _key_codes.default.escape:hasSuggestions=!1,hasSuggestionCallback(!1);break;case _key_codes.default.arrowLeft:!function(root){var activeEmojiSuggestion=getActiveEmojiSuggestion(root),previousSuggestion=activeEmojiSuggestion.previousElementSibling;previousSuggestion&&(activeEmojiSuggestion.classList.remove("active"),previousSuggestion.classList.add("active"),previousSuggestion.scrollIntoView({behaviour:"smooth",inline:"center"}))}(root),e.preventDefault();break;case _key_codes.default.arrowRight:!function(root){var activeEmojiSuggestion=getActiveEmojiSuggestion(root),nextSuggestion=activeEmojiSuggestion.nextElementSibling;nextSuggestion&&(activeEmojiSuggestion.classList.remove("active"),nextSuggestion.classList.add("active"),nextSuggestion.scrollIntoView({behaviour:"smooth",inline:"center"}))}(root),e.preventDefault();break;case _key_codes.default.enter:selectEmojiElement(getActiveEmojiSuggestion(root),selectCallback),e.preventDefault(),e.stopPropagation()}})),root.addEventListener("click",(function(e){var target=e.target;target.matches(SELECTORS_EMOJI_BUTTON)&&selectEmojiElement(target,selectCallback)}))},_exports.default}));
define("core/emoji/data",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.byShortName=_exports.byCategory=void 0;_exports.byCategory=[{name:"Smileys & People",emojis:[{unified:"1F600",shortnames:["grinning"]},{unified:"1F601",shortnames:["grin"]},{unified:"1F602",shortnames:["joy"]},{unified:"1F923",shortnames:["rolling_on_the_floor_laughing"]},{unified:"1F603",shortnames:["smiley"]},{unified:"1F604",shortnames:["smile"]},{unified:"1F605",shortnames:["sweat_smile"]},{unified:"1F606",shortnames:["laughing"]},{unified:"1F609",shortnames:["wink"]},{unified:"1F60A",shortnames:["blush"]},{unified:"1F60B",shortnames:["yum"]},{unified:"1F60E",shortnames:["sunglasses"]},{unified:"1F60D",shortnames:["heart_eyes"]},{unified:"1F618",shortnames:["kissing_heart"]},{unified:"1F617",shortnames:["kissing"]},{unified:"1F619",shortnames:["kissing_smiling_eyes"]},{unified:"1F61A",shortnames:["kissing_closed_eyes"]},{unified:"263A-FE0F",shortnames:["relaxed"]},{unified:"1F642",shortnames:["slightly_smiling_face"]},{unified:"1F917",shortnames:["hugging_face"]},{unified:"1F929",shortnames:["star-struck"]},{unified:"1F914",shortnames:["thinking_face"]},{unified:"1F928",shortnames:["face_with_raised_eyebrow"]},{unified:"1F610",shortnames:["neutral_face"]},{unified:"1F611",shortnames:["expressionless"]},{unified:"1F636",shortnames:["no_mouth"]},{unified:"1F644",shortnames:["face_with_rolling_eyes"]},{unified:"1F60F",shortnames:["smirk"]},{unified:"1F623",shortnames:["persevere"]},{unified:"1F625",shortnames:["disappointed_relieved"]},{unified:"1F62E",shortnames:["open_mouth"]},{unified:"1F910",shortnames:["zipper_mouth_face"]},{unified:"1F62F",shortnames:["hushed"]},{unified:"1F62A",shortnames:["sleepy"]},{unified:"1F62B",shortnames:["tired_face"]},{unified:"1F634",shortnames:["sleeping"]},{unified:"1F60C",shortnames:["relieved"]},{unified:"1F61B",shortnames:["stuck_out_tongue"]},{unified:"1F61C",shortnames:["stuck_out_tongue_winking_eye"]},{unified:"1F61D",shortnames:["stuck_out_tongue_closed_eyes"]},{unified:"1F924",shortnames:["drooling_face"]},{unified:"1F612",shortnames:["unamused"]},{unified:"1F613",shortnames:["sweat"]},{unified:"1F614",shortnames:["pensive"]},{unified:"1F615",shortnames:["confused"]},{unified:"1F643",shortnames:["upside_down_face"]},{unified:"1F911",shortnames:["money_mouth_face"]},{unified:"1F632",shortnames:["astonished"]},{unified:"2639-FE0F",shortnames:["white_frowning_face"]},{unified:"1F641",shortnames:["slightly_frowning_face"]},{unified:"1F616",shortnames:["confounded"]},{unified:"1F61E",shortnames:["disappointed"]},{unified:"1F61F",shortnames:["worried"]},{unified:"1F624",shortnames:["triumph"]},{unified:"1F622",shortnames:["cry"]},{unified:"1F62D",shortnames:["sob"]},{unified:"1F626",shortnames:["frowning"]},{unified:"1F627",shortnames:["anguished"]},{unified:"1F628",shortnames:["fearful"]},{unified:"1F629",shortnames:["weary"]},{unified:"1F92F",shortnames:["exploding_head"]},{unified:"1F62C",shortnames:["grimacing"]},{unified:"1F630",shortnames:["cold_sweat"]},{unified:"1F631",shortnames:["scream"]},{unified:"1F633",shortnames:["flushed"]},{unified:"1F92A",shortnames:["zany_face"]},{unified:"1F635",shortnames:["dizzy_face"]},{unified:"1F621",shortnames:["rage"]},{unified:"1F620",shortnames:["angry"]},{unified:"1F92C",shortnames:["face_with_symbols_on_mouth"]},{unified:"1F637",shortnames:["mask"]},{unified:"1F912",shortnames:["face_with_thermometer"]},{unified:"1F915",shortnames:["face_with_head_bandage"]},{unified:"1F922",shortnames:["nauseated_face"]},{unified:"1F92E",shortnames:["face_vomiting"]},{unified:"1F927",shortnames:["sneezing_face"]},{unified:"1F607",shortnames:["innocent"]},{unified:"1F920",shortnames:["face_with_cowboy_hat"]},{unified:"1F921",shortnames:["clown_face"]},{unified:"1F925",shortnames:["lying_face"]},{unified:"1F92B",shortnames:["shushing_face"]},{unified:"1F92D",shortnames:["face_with_hand_over_mouth"]},{unified:"1F9D0",shortnames:["face_with_monocle"]},{unified:"1F913",shortnames:["nerd_face"]},{unified:"1F608",shortnames:["smiling_imp"]},{unified:"1F47F",shortnames:["imp"]},{unified:"1F479",shortnames:["japanese_ogre"]},{unified:"1F47A",shortnames:["japanese_goblin"]},{unified:"1F480",shortnames:["skull"]},{unified:"2620-FE0F",shortnames:["skull_and_crossbones"]},{unified:"1F47B",shortnames:["ghost"]},{unified:"1F47D",shortnames:["alien"]},{unified:"1F47E",shortnames:["space_invader"]},{unified:"1F916",shortnames:["robot_face"]},{unified:"1F4A9",shortnames:["hankey"]},{unified:"1F63A",shortnames:["smiley_cat"]},{unified:"1F638",shortnames:["smile_cat"]},{unified:"1F639",shortnames:["joy_cat"]},{unified:"1F63B",shortnames:["heart_eyes_cat"]},{unified:"1F63C",shortnames:["smirk_cat"]},{unified:"1F63D",shortnames:["kissing_cat"]},{unified:"1F640",shortnames:["scream_cat"]},{unified:"1F63F",shortnames:["crying_cat_face"]},{unified:"1F63E",shortnames:["pouting_cat"]},{unified:"1F648",shortnames:["see_no_evil"]},{unified:"1F649",shortnames:["hear_no_evil"]},{unified:"1F64A",shortnames:["speak_no_evil"]},{unified:"1F476",shortnames:["baby"]},{unified:"1F9D2",shortnames:["child"]},{unified:"1F466",shortnames:["boy"]},{unified:"1F467",shortnames:["girl"]},{unified:"1F9D1",shortnames:["adult"]},{unified:"1F468",shortnames:["man"]},{unified:"1F469",shortnames:["woman"]},{unified:"1F9D3",shortnames:["older_adult"]},{unified:"1F474",shortnames:["older_man"]},{unified:"1F475",shortnames:["older_woman"]},{unified:"1F468-200D-2695-FE0F",shortnames:["male-doctor"]},{unified:"1F469-200D-2695-FE0F",shortnames:["female-doctor"]},{unified:"1F468-200D-1F393",shortnames:["male-student"]},{unified:"1F469-200D-1F393",shortnames:["female-student"]},{unified:"1F468-200D-1F3EB",shortnames:["male-teacher"]},{unified:"1F469-200D-1F3EB",shortnames:["female-teacher"]},{unified:"1F468-200D-2696-FE0F",shortnames:["male-judge"]},{unified:"1F469-200D-2696-FE0F",shortnames:["female-judge"]},{unified:"1F468-200D-1F33E",shortnames:["male-farmer"]},{unified:"1F469-200D-1F33E",shortnames:["female-farmer"]},{unified:"1F468-200D-1F373",shortnames:["male-cook"]},{unified:"1F469-200D-1F373",shortnames:["female-cook"]},{unified:"1F468-200D-1F527",shortnames:["male-mechanic"]},{unified:"1F469-200D-1F527",shortnames:["female-mechanic"]},{unified:"1F468-200D-1F3ED",shortnames:["male-factory-worker"]},{unified:"1F469-200D-1F3ED",shortnames:["female-factory-worker"]},{unified:"1F468-200D-1F4BC",shortnames:["male-office-worker"]},{unified:"1F469-200D-1F4BC",shortnames:["female-office-worker"]},{unified:"1F468-200D-1F52C",shortnames:["male-scientist"]},{unified:"1F469-200D-1F52C",shortnames:["female-scientist"]},{unified:"1F468-200D-1F4BB",shortnames:["male-technologist"]},{unified:"1F469-200D-1F4BB",shortnames:["female-technologist"]},{unified:"1F468-200D-1F3A4",shortnames:["male-singer"]},{unified:"1F469-200D-1F3A4",shortnames:["female-singer"]},{unified:"1F468-200D-1F3A8",shortnames:["male-artist"]},{unified:"1F469-200D-1F3A8",shortnames:["female-artist"]},{unified:"1F468-200D-2708-FE0F",shortnames:["male-pilot"]},{unified:"1F469-200D-2708-FE0F",shortnames:["female-pilot"]},{unified:"1F468-200D-1F680",shortnames:["male-astronaut"]},{unified:"1F469-200D-1F680",shortnames:["female-astronaut"]},{unified:"1F468-200D-1F692",shortnames:["male-firefighter"]},{unified:"1F469-200D-1F692",shortnames:["female-firefighter"]},{unified:"1F46E-200D-2642-FE0F",shortnames:["male-police-officer","cop"]},{unified:"1F46E-200D-2640-FE0F",shortnames:["female-police-officer"]},{unified:"1F575-FE0F-200D-2642-FE0F",shortnames:["male-detective","sleuth_or_spy"]},{unified:"1F575-FE0F-200D-2640-FE0F",shortnames:["female-detective"]},{unified:"1F482-200D-2642-FE0F",shortnames:["male-guard","guardsman"]},{unified:"1F482-200D-2640-FE0F",shortnames:["female-guard"]},{unified:"1F477-200D-2642-FE0F",shortnames:["male-construction-worker","construction_worker"]},{unified:"1F477-200D-2640-FE0F",shortnames:["female-construction-worker"]},{unified:"1F934",shortnames:["prince"]},{unified:"1F478",shortnames:["princess"]},{unified:"1F473-200D-2642-FE0F",shortnames:["man-wearing-turban","man_with_turban"]},{unified:"1F473-200D-2640-FE0F",shortnames:["woman-wearing-turban"]},{unified:"1F472",shortnames:["man_with_gua_pi_mao"]},{unified:"1F9D5",shortnames:["person_with_headscarf"]},{unified:"1F9D4",shortnames:["bearded_person"]},{unified:"1F471-200D-2642-FE0F",shortnames:["blond-haired-man","person_with_blond_hair"]},{unified:"1F471-200D-2640-FE0F",shortnames:["blond-haired-woman"]},{unified:"1F935",shortnames:["man_in_tuxedo"]},{unified:"1F470",shortnames:["bride_with_veil"]},{unified:"1F930",shortnames:["pregnant_woman"]},{unified:"1F931",shortnames:["breast-feeding"]},{unified:"1F47C",shortnames:["angel"]},{unified:"1F385",shortnames:["santa"]},{unified:"1F936",shortnames:["mrs_claus"]},{unified:"1F9D9-200D-2640-FE0F",shortnames:["female_mage","mage"]},{unified:"1F9D9-200D-2642-FE0F",shortnames:["male_mage"]},{unified:"1F9DA-200D-2640-FE0F",shortnames:["female_fairy","fairy"]},{unified:"1F9DA-200D-2642-FE0F",shortnames:["male_fairy"]},{unified:"1F9DB-200D-2640-FE0F",shortnames:["female_vampire","vampire"]},{unified:"1F9DB-200D-2642-FE0F",shortnames:["male_vampire"]},{unified:"1F9DC-200D-2640-FE0F",shortnames:["mermaid"]},{unified:"1F9DC-200D-2642-FE0F",shortnames:["merman","merperson"]},{unified:"1F9DD-200D-2640-FE0F",shortnames:["female_elf"]},{unified:"1F9DD-200D-2642-FE0F",shortnames:["male_elf","elf"]},{unified:"1F9DE-200D-2640-FE0F",shortnames:["female_genie"]},{unified:"1F9DE-200D-2642-FE0F",shortnames:["male_genie","genie"]},{unified:"1F9DF-200D-2640-FE0F",shortnames:["female_zombie"]},{unified:"1F9DF-200D-2642-FE0F",shortnames:["male_zombie","zombie"]},{unified:"1F64D-200D-2642-FE0F",shortnames:["man-frowning"]},{unified:"1F64D-200D-2640-FE0F",shortnames:["woman-frowning","person_frowning"]},{unified:"1F64E-200D-2642-FE0F",shortnames:["man-pouting"]},{unified:"1F64E-200D-2640-FE0F",shortnames:["woman-pouting","person_with_pouting_face"]},{unified:"1F645-200D-2642-FE0F",shortnames:["man-gesturing-no"]},{unified:"1F645-200D-2640-FE0F",shortnames:["woman-gesturing-no","no_good"]},{unified:"1F646-200D-2642-FE0F",shortnames:["man-gesturing-ok"]},{unified:"1F646-200D-2640-FE0F",shortnames:["woman-gesturing-ok","ok_woman"]},{unified:"1F481-200D-2642-FE0F",shortnames:["man-tipping-hand"]},{unified:"1F481-200D-2640-FE0F",shortnames:["woman-tipping-hand","information_desk_person"]},{unified:"1F64B-200D-2642-FE0F",shortnames:["man-raising-hand"]},{unified:"1F64B-200D-2640-FE0F",shortnames:["woman-raising-hand","raising_hand"]},{unified:"1F647-200D-2642-FE0F",shortnames:["man-bowing","bow"]},{unified:"1F647-200D-2640-FE0F",shortnames:["woman-bowing"]},{unified:"1F926",shortnames:["face_palm"]},{unified:"1F926-200D-2642-FE0F",shortnames:["man-facepalming"]},{unified:"1F926-200D-2640-FE0F",shortnames:["woman-facepalming"]},{unified:"1F937",shortnames:["shrug"]},{unified:"1F937-200D-2642-FE0F",shortnames:["man-shrugging"]},{unified:"1F937-200D-2640-FE0F",shortnames:["woman-shrugging"]},{unified:"1F486-200D-2642-FE0F",shortnames:["man-getting-massage"]},{unified:"1F486-200D-2640-FE0F",shortnames:["woman-getting-massage","massage"]},{unified:"1F487-200D-2642-FE0F",shortnames:["man-getting-haircut"]},{unified:"1F487-200D-2640-FE0F",shortnames:["woman-getting-haircut","haircut"]},{unified:"1F6B6-200D-2642-FE0F",shortnames:["man-walking","walking"]},{unified:"1F6B6-200D-2640-FE0F",shortnames:["woman-walking"]},{unified:"1F3C3-200D-2642-FE0F",shortnames:["man-running","runner"]},{unified:"1F3C3-200D-2640-FE0F",shortnames:["woman-running"]},{unified:"1F483",shortnames:["dancer"]},{unified:"1F57A",shortnames:["man_dancing"]},{unified:"1F46F-200D-2642-FE0F",shortnames:["man-with-bunny-ears-partying"]},{unified:"1F46F-200D-2640-FE0F",shortnames:["woman-with-bunny-ears-partying","dancers"]},{unified:"1F9D6-200D-2640-FE0F",shortnames:["woman_in_steamy_room"]},{unified:"1F9D6-200D-2642-FE0F",shortnames:["man_in_steamy_room","person_in_steamy_room"]},{unified:"1F9D7-200D-2640-FE0F",shortnames:["woman_climbing","person_climbing"]},{unified:"1F9D7-200D-2642-FE0F",shortnames:["man_climbing"]},{unified:"1F9D8-200D-2640-FE0F",shortnames:["woman_in_lotus_position","person_in_lotus_position"]},{unified:"1F9D8-200D-2642-FE0F",shortnames:["man_in_lotus_position"]},{unified:"1F6C0",shortnames:["bath"]},{unified:"1F6CC",shortnames:["sleeping_accommodation"]},{unified:"1F574-FE0F",shortnames:["man_in_business_suit_levitating"]},{unified:"1F5E3-FE0F",shortnames:["speaking_head_in_silhouette"]},{unified:"1F464",shortnames:["bust_in_silhouette"]},{unified:"1F465",shortnames:["busts_in_silhouette"]},{unified:"1F93A",shortnames:["fencer"]},{unified:"1F3C7",shortnames:["horse_racing"]},{unified:"26F7-FE0F",shortnames:["skier"]},{unified:"1F3C2",shortnames:["snowboarder"]},{unified:"1F3CC-FE0F-200D-2642-FE0F",shortnames:["man-golfing","golfer"]},{unified:"1F3CC-FE0F-200D-2640-FE0F",shortnames:["woman-golfing"]},{unified:"1F3C4-200D-2642-FE0F",shortnames:["man-surfing","surfer"]},{unified:"1F3C4-200D-2640-FE0F",shortnames:["woman-surfing"]},{unified:"1F6A3-200D-2642-FE0F",shortnames:["man-rowing-boat","rowboat"]},{unified:"1F6A3-200D-2640-FE0F",shortnames:["woman-rowing-boat"]},{unified:"1F3CA-200D-2642-FE0F",shortnames:["man-swimming","swimmer"]},{unified:"1F3CA-200D-2640-FE0F",shortnames:["woman-swimming"]},{unified:"26F9-FE0F-200D-2642-FE0F",shortnames:["man-bouncing-ball","person_with_ball"]},{unified:"26F9-FE0F-200D-2640-FE0F",shortnames:["woman-bouncing-ball"]},{unified:"1F3CB-FE0F-200D-2642-FE0F",shortnames:["man-lifting-weights","weight_lifter"]},{unified:"1F3CB-FE0F-200D-2640-FE0F",shortnames:["woman-lifting-weights"]},{unified:"1F6B4-200D-2642-FE0F",shortnames:["man-biking","bicyclist"]},{unified:"1F6B4-200D-2640-FE0F",shortnames:["woman-biking"]},{unified:"1F6B5-200D-2642-FE0F",shortnames:["man-mountain-biking","mountain_bicyclist"]},{unified:"1F6B5-200D-2640-FE0F",shortnames:["woman-mountain-biking"]},{unified:"1F3CE-FE0F",shortnames:["racing_car"]},{unified:"1F3CD-FE0F",shortnames:["racing_motorcycle"]},{unified:"1F938",shortnames:["person_doing_cartwheel"]},{unified:"1F938-200D-2642-FE0F",shortnames:["man-cartwheeling"]},{unified:"1F938-200D-2640-FE0F",shortnames:["woman-cartwheeling"]},{unified:"1F93C",shortnames:["wrestlers"]},{unified:"1F93C-200D-2642-FE0F",shortnames:["man-wrestling"]},{unified:"1F93C-200D-2640-FE0F",shortnames:["woman-wrestling"]},{unified:"1F93D",shortnames:["water_polo"]},{unified:"1F93D-200D-2642-FE0F",shortnames:["man-playing-water-polo"]},{unified:"1F93D-200D-2640-FE0F",shortnames:["woman-playing-water-polo"]},{unified:"1F93E",shortnames:["handball"]},{unified:"1F93E-200D-2642-FE0F",shortnames:["man-playing-handball"]},{unified:"1F93E-200D-2640-FE0F",shortnames:["woman-playing-handball"]},{unified:"1F939",shortnames:["juggling"]},{unified:"1F939-200D-2642-FE0F",shortnames:["man-juggling"]},{unified:"1F939-200D-2640-FE0F",shortnames:["woman-juggling"]},{unified:"1F46B",shortnames:["couple"]},{unified:"1F46C",shortnames:["two_men_holding_hands"]},{unified:"1F46D",shortnames:["two_women_holding_hands"]},{unified:"1F469-200D-2764-FE0F-200D-1F48B-200D-1F468",shortnames:["woman-kiss-man","couplekiss"]},{unified:"1F468-200D-2764-FE0F-200D-1F48B-200D-1F468",shortnames:["man-kiss-man"]},{unified:"1F469-200D-2764-FE0F-200D-1F48B-200D-1F469",shortnames:["woman-kiss-woman"]},{unified:"1F469-200D-2764-FE0F-200D-1F468",shortnames:["woman-heart-man","couple_with_heart"]},{unified:"1F468-200D-2764-FE0F-200D-1F468",shortnames:["man-heart-man"]},{unified:"1F469-200D-2764-FE0F-200D-1F469",shortnames:["woman-heart-woman"]},{unified:"1F468-200D-1F469-200D-1F466",shortnames:["man-woman-boy","family"]},{unified:"1F468-200D-1F469-200D-1F467",shortnames:["man-woman-girl"]},{unified:"1F468-200D-1F469-200D-1F467-200D-1F466",shortnames:["man-woman-girl-boy"]},{unified:"1F468-200D-1F469-200D-1F466-200D-1F466",shortnames:["man-woman-boy-boy"]},{unified:"1F468-200D-1F469-200D-1F467-200D-1F467",shortnames:["man-woman-girl-girl"]},{unified:"1F468-200D-1F468-200D-1F466",shortnames:["man-man-boy"]},{unified:"1F468-200D-1F468-200D-1F467",shortnames:["man-man-girl"]},{unified:"1F468-200D-1F468-200D-1F467-200D-1F466",shortnames:["man-man-girl-boy"]},{unified:"1F468-200D-1F468-200D-1F466-200D-1F466",shortnames:["man-man-boy-boy"]},{unified:"1F468-200D-1F468-200D-1F467-200D-1F467",shortnames:["man-man-girl-girl"]},{unified:"1F469-200D-1F469-200D-1F466",shortnames:["woman-woman-boy"]},{unified:"1F469-200D-1F469-200D-1F467",shortnames:["woman-woman-girl"]},{unified:"1F469-200D-1F469-200D-1F467-200D-1F466",shortnames:["woman-woman-girl-boy"]},{unified:"1F469-200D-1F469-200D-1F466-200D-1F466",shortnames:["woman-woman-boy-boy"]},{unified:"1F469-200D-1F469-200D-1F467-200D-1F467",shortnames:["woman-woman-girl-girl"]},{unified:"1F468-200D-1F466",shortnames:["man-boy"]},{unified:"1F468-200D-1F466-200D-1F466",shortnames:["man-boy-boy"]},{unified:"1F468-200D-1F467",shortnames:["man-girl"]},{unified:"1F468-200D-1F467-200D-1F466",shortnames:["man-girl-boy"]},{unified:"1F468-200D-1F467-200D-1F467",shortnames:["man-girl-girl"]},{unified:"1F469-200D-1F466",shortnames:["woman-boy"]},{unified:"1F469-200D-1F466-200D-1F466",shortnames:["woman-boy-boy"]},{unified:"1F469-200D-1F467",shortnames:["woman-girl"]},{unified:"1F469-200D-1F467-200D-1F466",shortnames:["woman-girl-boy"]},{unified:"1F469-200D-1F467-200D-1F467",shortnames:["woman-girl-girl"]},{unified:"1F933",shortnames:["selfie"]},{unified:"1F4AA",shortnames:["muscle"]},{unified:"1F448",shortnames:["point_left"]},{unified:"1F449",shortnames:["point_right"]},{unified:"261D-FE0F",shortnames:["point_up"]},{unified:"1F446",shortnames:["point_up_2"]},{unified:"1F595",shortnames:["middle_finger"]},{unified:"1F447",shortnames:["point_down"]},{unified:"270C-FE0F",shortnames:["v"]},{unified:"1F91E",shortnames:["crossed_fingers"]},{unified:"1F596",shortnames:["spock-hand"]},{unified:"1F918",shortnames:["the_horns"]},{unified:"1F919",shortnames:["call_me_hand"]},{unified:"1F590-FE0F",shortnames:["raised_hand_with_fingers_splayed"]},{unified:"270B",shortnames:["hand"]},{unified:"1F44C",shortnames:["ok_hand"]},{unified:"1F44D",shortnames:["+1"]},{unified:"1F44E",shortnames:["-1"]},{unified:"270A",shortnames:["fist"]},{unified:"1F44A",shortnames:["facepunch"]},{unified:"1F91B",shortnames:["left-facing_fist"]},{unified:"1F91C",shortnames:["right-facing_fist"]},{unified:"1F91A",shortnames:["raised_back_of_hand"]},{unified:"1F44B",shortnames:["wave"]},{unified:"1F91F",shortnames:["i_love_you_hand_sign"]},{unified:"270D-FE0F",shortnames:["writing_hand"]},{unified:"1F44F",shortnames:["clap"]},{unified:"1F450",shortnames:["open_hands"]},{unified:"1F64C",shortnames:["raised_hands"]},{unified:"1F932",shortnames:["palms_up_together"]},{unified:"1F64F",shortnames:["pray"]},{unified:"1F91D",shortnames:["handshake"]},{unified:"1F485",shortnames:["nail_care"]},{unified:"1F442",shortnames:["ear"]},{unified:"1F443",shortnames:["nose"]},{unified:"1F463",shortnames:["footprints"]},{unified:"1F440",shortnames:["eyes"]},{unified:"1F441-FE0F",shortnames:["eye"]},{unified:"1F441-FE0F-200D-1F5E8-FE0F",shortnames:["eye-in-speech-bubble"]},{unified:"1F9E0",shortnames:["brain"]},{unified:"1F445",shortnames:["tongue"]},{unified:"1F444",shortnames:["lips"]},{unified:"1F48B",shortnames:["kiss"]},{unified:"1F498",shortnames:["cupid"]},{unified:"2764-FE0F",shortnames:["heart"]},{unified:"1F493",shortnames:["heartbeat"]},{unified:"1F494",shortnames:["broken_heart"]},{unified:"1F495",shortnames:["two_hearts"]},{unified:"1F496",shortnames:["sparkling_heart"]},{unified:"1F497",shortnames:["heartpulse"]},{unified:"1F499",shortnames:["blue_heart"]},{unified:"1F49A",shortnames:["green_heart"]},{unified:"1F49B",shortnames:["yellow_heart"]},{unified:"1F9E1",shortnames:["orange_heart"]},{unified:"1F49C",shortnames:["purple_heart"]},{unified:"1F5A4",shortnames:["black_heart"]},{unified:"1F49D",shortnames:["gift_heart"]},{unified:"1F49E",shortnames:["revolving_hearts"]},{unified:"1F49F",shortnames:["heart_decoration"]},{unified:"2763-FE0F",shortnames:["heavy_heart_exclamation_mark_ornament"]},{unified:"1F48C",shortnames:["love_letter"]},{unified:"1F4A4",shortnames:["zzz"]},{unified:"1F4A2",shortnames:["anger"]},{unified:"1F4A3",shortnames:["bomb"]},{unified:"1F4A5",shortnames:["boom"]},{unified:"1F4A6",shortnames:["sweat_drops"]},{unified:"1F4A8",shortnames:["dash"]},{unified:"1F4AB",shortnames:["dizzy"]},{unified:"1F4AC",shortnames:["speech_balloon"]},{unified:"1F5E8-FE0F",shortnames:["left_speech_bubble"]},{unified:"1F5EF-FE0F",shortnames:["right_anger_bubble"]},{unified:"1F4AD",shortnames:["thought_balloon"]},{unified:"1F573-FE0F",shortnames:["hole"]},{unified:"1F453",shortnames:["eyeglasses"]},{unified:"1F576-FE0F",shortnames:["dark_sunglasses"]},{unified:"1F454",shortnames:["necktie"]},{unified:"1F455",shortnames:["shirt"]},{unified:"1F456",shortnames:["jeans"]},{unified:"1F9E3",shortnames:["scarf"]},{unified:"1F9E4",shortnames:["gloves"]},{unified:"1F9E5",shortnames:["coat"]},{unified:"1F9E6",shortnames:["socks"]},{unified:"1F457",shortnames:["dress"]},{unified:"1F458",shortnames:["kimono"]},{unified:"1F459",shortnames:["bikini"]},{unified:"1F45A",shortnames:["womans_clothes"]},{unified:"1F45B",shortnames:["purse"]},{unified:"1F45C",shortnames:["handbag"]},{unified:"1F45D",shortnames:["pouch"]},{unified:"1F6CD-FE0F",shortnames:["shopping_bags"]},{unified:"1F392",shortnames:["school_satchel"]},{unified:"1F45E",shortnames:["mans_shoe"]},{unified:"1F45F",shortnames:["athletic_shoe"]},{unified:"1F460",shortnames:["high_heel"]},{unified:"1F461",shortnames:["sandal"]},{unified:"1F462",shortnames:["boot"]},{unified:"1F451",shortnames:["crown"]},{unified:"1F452",shortnames:["womans_hat"]},{unified:"1F3A9",shortnames:["tophat"]},{unified:"1F393",shortnames:["mortar_board"]},{unified:"1F9E2",shortnames:["billed_cap"]},{unified:"26D1-FE0F",shortnames:["helmet_with_white_cross"]},{unified:"1F4FF",shortnames:["prayer_beads"]},{unified:"1F484",shortnames:["lipstick"]},{unified:"1F48D",shortnames:["ring"]},{unified:"1F48E",shortnames:["gem"]}]},{name:"Animals & Nature",emojis:[{unified:"1F435",shortnames:["monkey_face"]},{unified:"1F412",shortnames:["monkey"]},{unified:"1F98D",shortnames:["gorilla"]},{unified:"1F436",shortnames:["dog"]},{unified:"1F415",shortnames:["dog2"]},{unified:"1F429",shortnames:["poodle"]},{unified:"1F43A",shortnames:["wolf"]},{unified:"1F98A",shortnames:["fox_face"]},{unified:"1F431",shortnames:["cat"]},{unified:"1F408",shortnames:["cat2"]},{unified:"1F981",shortnames:["lion_face"]},{unified:"1F42F",shortnames:["tiger"]},{unified:"1F405",shortnames:["tiger2"]},{unified:"1F406",shortnames:["leopard"]},{unified:"1F434",shortnames:["horse"]},{unified:"1F40E",shortnames:["racehorse"]},{unified:"1F984",shortnames:["unicorn_face"]},{unified:"1F993",shortnames:["zebra_face"]},{unified:"1F98C",shortnames:["deer"]},{unified:"1F42E",shortnames:["cow"]},{unified:"1F402",shortnames:["ox"]},{unified:"1F403",shortnames:["water_buffalo"]},{unified:"1F404",shortnames:["cow2"]},{unified:"1F437",shortnames:["pig"]},{unified:"1F416",shortnames:["pig2"]},{unified:"1F417",shortnames:["boar"]},{unified:"1F43D",shortnames:["pig_nose"]},{unified:"1F40F",shortnames:["ram"]},{unified:"1F411",shortnames:["sheep"]},{unified:"1F410",shortnames:["goat"]},{unified:"1F42A",shortnames:["dromedary_camel"]},{unified:"1F42B",shortnames:["camel"]},{unified:"1F992",shortnames:["giraffe_face"]},{unified:"1F418",shortnames:["elephant"]},{unified:"1F98F",shortnames:["rhinoceros"]},{unified:"1F42D",shortnames:["mouse"]},{unified:"1F401",shortnames:["mouse2"]},{unified:"1F400",shortnames:["rat"]},{unified:"1F439",shortnames:["hamster"]},{unified:"1F430",shortnames:["rabbit"]},{unified:"1F407",shortnames:["rabbit2"]},{unified:"1F43F-FE0F",shortnames:["chipmunk"]},{unified:"1F994",shortnames:["hedgehog"]},{unified:"1F987",shortnames:["bat"]},{unified:"1F43B",shortnames:["bear"]},{unified:"1F428",shortnames:["koala"]},{unified:"1F43C",shortnames:["panda_face"]},{unified:"1F43E",shortnames:["feet"]},{unified:"1F983",shortnames:["turkey"]},{unified:"1F414",shortnames:["chicken"]},{unified:"1F413",shortnames:["rooster"]},{unified:"1F423",shortnames:["hatching_chick"]},{unified:"1F424",shortnames:["baby_chick"]},{unified:"1F425",shortnames:["hatched_chick"]},{unified:"1F426",shortnames:["bird"]},{unified:"1F427",shortnames:["penguin"]},{unified:"1F54A-FE0F",shortnames:["dove_of_peace"]},{unified:"1F985",shortnames:["eagle"]},{unified:"1F986",shortnames:["duck"]},{unified:"1F989",shortnames:["owl"]},{unified:"1F438",shortnames:["frog"]},{unified:"1F40A",shortnames:["crocodile"]},{unified:"1F422",shortnames:["turtle"]},{unified:"1F98E",shortnames:["lizard"]},{unified:"1F40D",shortnames:["snake"]},{unified:"1F432",shortnames:["dragon_face"]},{unified:"1F409",shortnames:["dragon"]},{unified:"1F995",shortnames:["sauropod"]},{unified:"1F996",shortnames:["t-rex"]},{unified:"1F433",shortnames:["whale"]},{unified:"1F40B",shortnames:["whale2"]},{unified:"1F42C",shortnames:["dolphin"]},{unified:"1F41F",shortnames:["fish"]},{unified:"1F420",shortnames:["tropical_fish"]},{unified:"1F421",shortnames:["blowfish"]},{unified:"1F988",shortnames:["shark"]},{unified:"1F419",shortnames:["octopus"]},{unified:"1F41A",shortnames:["shell"]},{unified:"1F980",shortnames:["crab"]},{unified:"1F990",shortnames:["shrimp"]},{unified:"1F991",shortnames:["squid"]},{unified:"1F40C",shortnames:["snail"]},{unified:"1F98B",shortnames:["butterfly"]},{unified:"1F41B",shortnames:["bug"]},{unified:"1F41C",shortnames:["ant"]},{unified:"1F41D",shortnames:["bee"]},{unified:"1F41E",shortnames:["beetle"]},{unified:"1F997",shortnames:["cricket"]},{unified:"1F577-FE0F",shortnames:["spider"]},{unified:"1F578-FE0F",shortnames:["spider_web"]},{unified:"1F982",shortnames:["scorpion"]},{unified:"1F490",shortnames:["bouquet"]},{unified:"1F338",shortnames:["cherry_blossom"]},{unified:"1F4AE",shortnames:["white_flower"]},{unified:"1F3F5-FE0F",shortnames:["rosette"]},{unified:"1F339",shortnames:["rose"]},{unified:"1F940",shortnames:["wilted_flower"]},{unified:"1F33A",shortnames:["hibiscus"]},{unified:"1F33B",shortnames:["sunflower"]},{unified:"1F33C",shortnames:["blossom"]},{unified:"1F337",shortnames:["tulip"]},{unified:"1F331",shortnames:["seedling"]},{unified:"1F332",shortnames:["evergreen_tree"]},{unified:"1F333",shortnames:["deciduous_tree"]},{unified:"1F334",shortnames:["palm_tree"]},{unified:"1F335",shortnames:["cactus"]},{unified:"1F33E",shortnames:["ear_of_rice"]},{unified:"1F33F",shortnames:["herb"]},{unified:"2618-FE0F",shortnames:["shamrock"]},{unified:"1F340",shortnames:["four_leaf_clover"]},{unified:"1F341",shortnames:["maple_leaf"]},{unified:"1F342",shortnames:["fallen_leaf"]},{unified:"1F343",shortnames:["leaves"]}]},{name:"Food & Drink",emojis:[{unified:"1F347",shortnames:["grapes"]},{unified:"1F348",shortnames:["melon"]},{unified:"1F349",shortnames:["watermelon"]},{unified:"1F34A",shortnames:["tangerine"]},{unified:"1F34B",shortnames:["lemon"]},{unified:"1F34C",shortnames:["banana"]},{unified:"1F34D",shortnames:["pineapple"]},{unified:"1F34E",shortnames:["apple"]},{unified:"1F34F",shortnames:["green_apple"]},{unified:"1F350",shortnames:["pear"]},{unified:"1F351",shortnames:["peach"]},{unified:"1F352",shortnames:["cherries"]},{unified:"1F353",shortnames:["strawberry"]},{unified:"1F95D",shortnames:["kiwifruit"]},{unified:"1F345",shortnames:["tomato"]},{unified:"1F965",shortnames:["coconut"]},{unified:"1F951",shortnames:["avocado"]},{unified:"1F346",shortnames:["eggplant"]},{unified:"1F954",shortnames:["potato"]},{unified:"1F955",shortnames:["carrot"]},{unified:"1F33D",shortnames:["corn"]},{unified:"1F336-FE0F",shortnames:["hot_pepper"]},{unified:"1F952",shortnames:["cucumber"]},{unified:"1F966",shortnames:["broccoli"]},{unified:"1F344",shortnames:["mushroom"]},{unified:"1F95C",shortnames:["peanuts"]},{unified:"1F330",shortnames:["chestnut"]},{unified:"1F35E",shortnames:["bread"]},{unified:"1F950",shortnames:["croissant"]},{unified:"1F956",shortnames:["baguette_bread"]},{unified:"1F968",shortnames:["pretzel"]},{unified:"1F95E",shortnames:["pancakes"]},{unified:"1F9C0",shortnames:["cheese_wedge"]},{unified:"1F356",shortnames:["meat_on_bone"]},{unified:"1F357",shortnames:["poultry_leg"]},{unified:"1F969",shortnames:["cut_of_meat"]},{unified:"1F953",shortnames:["bacon"]},{unified:"1F354",shortnames:["hamburger"]},{unified:"1F35F",shortnames:["fries"]},{unified:"1F355",shortnames:["pizza"]},{unified:"1F32D",shortnames:["hotdog"]},{unified:"1F96A",shortnames:["sandwich"]},{unified:"1F32E",shortnames:["taco"]},{unified:"1F32F",shortnames:["burrito"]},{unified:"1F959",shortnames:["stuffed_flatbread"]},{unified:"1F95A",shortnames:["egg"]},{unified:"1F373",shortnames:["fried_egg"]},{unified:"1F958",shortnames:["shallow_pan_of_food"]},{unified:"1F372",shortnames:["stew"]},{unified:"1F963",shortnames:["bowl_with_spoon"]},{unified:"1F957",shortnames:["green_salad"]},{unified:"1F37F",shortnames:["popcorn"]},{unified:"1F96B",shortnames:["canned_food"]},{unified:"1F371",shortnames:["bento"]},{unified:"1F358",shortnames:["rice_cracker"]},{unified:"1F359",shortnames:["rice_ball"]},{unified:"1F35A",shortnames:["rice"]},{unified:"1F35B",shortnames:["curry"]},{unified:"1F35C",shortnames:["ramen"]},{unified:"1F35D",shortnames:["spaghetti"]},{unified:"1F360",shortnames:["sweet_potato"]},{unified:"1F362",shortnames:["oden"]},{unified:"1F363",shortnames:["sushi"]},{unified:"1F364",shortnames:["fried_shrimp"]},{unified:"1F365",shortnames:["fish_cake"]},{unified:"1F361",shortnames:["dango"]},{unified:"1F95F",shortnames:["dumpling"]},{unified:"1F960",shortnames:["fortune_cookie"]},{unified:"1F961",shortnames:["takeout_box"]},{unified:"1F366",shortnames:["icecream"]},{unified:"1F367",shortnames:["shaved_ice"]},{unified:"1F368",shortnames:["ice_cream"]},{unified:"1F369",shortnames:["doughnut"]},{unified:"1F36A",shortnames:["cookie"]},{unified:"1F382",shortnames:["birthday"]},{unified:"1F370",shortnames:["cake"]},{unified:"1F967",shortnames:["pie"]},{unified:"1F36B",shortnames:["chocolate_bar"]},{unified:"1F36C",shortnames:["candy"]},{unified:"1F36D",shortnames:["lollipop"]},{unified:"1F36E",shortnames:["custard"]},{unified:"1F36F",shortnames:["honey_pot"]},{unified:"1F37C",shortnames:["baby_bottle"]},{unified:"1F95B",shortnames:["glass_of_milk"]},{unified:"2615",shortnames:["coffee"]},{unified:"1F375",shortnames:["tea"]},{unified:"1F376",shortnames:["sake"]},{unified:"1F37E",shortnames:["champagne"]},{unified:"1F377",shortnames:["wine_glass"]},{unified:"1F378",shortnames:["cocktail"]},{unified:"1F379",shortnames:["tropical_drink"]},{unified:"1F37A",shortnames:["beer"]},{unified:"1F37B",shortnames:["beers"]},{unified:"1F942",shortnames:["clinking_glasses"]},{unified:"1F943",shortnames:["tumbler_glass"]},{unified:"1F964",shortnames:["cup_with_straw"]},{unified:"1F962",shortnames:["chopsticks"]},{unified:"1F37D-FE0F",shortnames:["knife_fork_plate"]},{unified:"1F374",shortnames:["fork_and_knife"]},{unified:"1F944",shortnames:["spoon"]},{unified:"1F52A",shortnames:["hocho"]},{unified:"1F3FA",shortnames:["amphora"]}]},{name:"Travel & Places",emojis:[{unified:"1F30D",shortnames:["earth_africa"]},{unified:"1F30E",shortnames:["earth_americas"]},{unified:"1F30F",shortnames:["earth_asia"]},{unified:"1F310",shortnames:["globe_with_meridians"]},{unified:"1F5FA-FE0F",shortnames:["world_map"]},{unified:"1F5FE",shortnames:["japan"]},{unified:"1F3D4-FE0F",shortnames:["snow_capped_mountain"]},{unified:"26F0-FE0F",shortnames:["mountain"]},{unified:"1F30B",shortnames:["volcano"]},{unified:"1F5FB",shortnames:["mount_fuji"]},{unified:"1F3D5-FE0F",shortnames:["camping"]},{unified:"1F3D6-FE0F",shortnames:["beach_with_umbrella"]},{unified:"1F3DC-FE0F",shortnames:["desert"]},{unified:"1F3DD-FE0F",shortnames:["desert_island"]},{unified:"1F3DE-FE0F",shortnames:["national_park"]},{unified:"1F3DF-FE0F",shortnames:["stadium"]},{unified:"1F3DB-FE0F",shortnames:["classical_building"]},{unified:"1F3D7-FE0F",shortnames:["building_construction"]},{unified:"1F3D8-FE0F",shortnames:["house_buildings"]},{unified:"1F3D9-FE0F",shortnames:["cityscape"]},{unified:"1F3DA-FE0F",shortnames:["derelict_house_building"]},{unified:"1F3E0",shortnames:["house"]},{unified:"1F3E1",shortnames:["house_with_garden"]},{unified:"1F3E2",shortnames:["office"]},{unified:"1F3E3",shortnames:["post_office"]},{unified:"1F3E4",shortnames:["european_post_office"]},{unified:"1F3E5",shortnames:["hospital"]},{unified:"1F3E6",shortnames:["bank"]},{unified:"1F3E8",shortnames:["hotel"]},{unified:"1F3E9",shortnames:["love_hotel"]},{unified:"1F3EA",shortnames:["convenience_store"]},{unified:"1F3EB",shortnames:["school"]},{unified:"1F3EC",shortnames:["department_store"]},{unified:"1F3ED",shortnames:["factory"]},{unified:"1F3EF",shortnames:["japanese_castle"]},{unified:"1F3F0",shortnames:["european_castle"]},{unified:"1F492",shortnames:["wedding"]},{unified:"1F5FC",shortnames:["tokyo_tower"]},{unified:"1F5FD",shortnames:["statue_of_liberty"]},{unified:"26EA",shortnames:["church"]},{unified:"1F54C",shortnames:["mosque"]},{unified:"1F54D",shortnames:["synagogue"]},{unified:"26E9-FE0F",shortnames:["shinto_shrine"]},{unified:"1F54B",shortnames:["kaaba"]},{unified:"26F2",shortnames:["fountain"]},{unified:"26FA",shortnames:["tent"]},{unified:"1F301",shortnames:["foggy"]},{unified:"1F303",shortnames:["night_with_stars"]},{unified:"1F304",shortnames:["sunrise_over_mountains"]},{unified:"1F305",shortnames:["sunrise"]},{unified:"1F306",shortnames:["city_sunset"]},{unified:"1F307",shortnames:["city_sunrise"]},{unified:"1F309",shortnames:["bridge_at_night"]},{unified:"2668-FE0F",shortnames:["hotsprings"]},{unified:"1F30C",shortnames:["milky_way"]},{unified:"1F3A0",shortnames:["carousel_horse"]},{unified:"1F3A1",shortnames:["ferris_wheel"]},{unified:"1F3A2",shortnames:["roller_coaster"]},{unified:"1F488",shortnames:["barber"]},{unified:"1F3AA",shortnames:["circus_tent"]},{unified:"1F3AD",shortnames:["performing_arts"]},{unified:"1F5BC-FE0F",shortnames:["frame_with_picture"]},{unified:"1F3A8",shortnames:["art"]},{unified:"1F3B0",shortnames:["slot_machine"]},{unified:"1F682",shortnames:["steam_locomotive"]},{unified:"1F683",shortnames:["railway_car"]},{unified:"1F684",shortnames:["bullettrain_side"]},{unified:"1F685",shortnames:["bullettrain_front"]},{unified:"1F686",shortnames:["train2"]},{unified:"1F687",shortnames:["metro"]},{unified:"1F688",shortnames:["light_rail"]},{unified:"1F689",shortnames:["station"]},{unified:"1F68A",shortnames:["tram"]},{unified:"1F69D",shortnames:["monorail"]},{unified:"1F69E",shortnames:["mountain_railway"]},{unified:"1F68B",shortnames:["train"]},{unified:"1F68C",shortnames:["bus"]},{unified:"1F68D",shortnames:["oncoming_bus"]},{unified:"1F68E",shortnames:["trolleybus"]},{unified:"1F690",shortnames:["minibus"]},{unified:"1F691",shortnames:["ambulance"]},{unified:"1F692",shortnames:["fire_engine"]},{unified:"1F693",shortnames:["police_car"]},{unified:"1F694",shortnames:["oncoming_police_car"]},{unified:"1F695",shortnames:["taxi"]},{unified:"1F696",shortnames:["oncoming_taxi"]},{unified:"1F697",shortnames:["car"]},{unified:"1F698",shortnames:["oncoming_automobile"]},{unified:"1F699",shortnames:["blue_car"]},{unified:"1F69A",shortnames:["truck"]},{unified:"1F69B",shortnames:["articulated_lorry"]},{unified:"1F69C",shortnames:["tractor"]},{unified:"1F6B2",shortnames:["bike"]},{unified:"1F6F4",shortnames:["scooter"]},{unified:"1F6F5",shortnames:["motor_scooter"]},{unified:"1F68F",shortnames:["busstop"]},{unified:"1F6E3-FE0F",shortnames:["motorway"]},{unified:"1F6E4-FE0F",shortnames:["railway_track"]},{unified:"26FD",shortnames:["fuelpump"]},{unified:"1F6A8",shortnames:["rotating_light"]},{unified:"1F6A5",shortnames:["traffic_light"]},{unified:"1F6A6",shortnames:["vertical_traffic_light"]},{unified:"1F6A7",shortnames:["construction"]},{unified:"1F6D1",shortnames:["octagonal_sign"]},{unified:"2693",shortnames:["anchor"]},{unified:"26F5",shortnames:["boat"]},{unified:"1F6F6",shortnames:["canoe"]},{unified:"1F6A4",shortnames:["speedboat"]},{unified:"1F6F3-FE0F",shortnames:["passenger_ship"]},{unified:"26F4-FE0F",shortnames:["ferry"]},{unified:"1F6E5-FE0F",shortnames:["motor_boat"]},{unified:"1F6A2",shortnames:["ship"]},{unified:"2708-FE0F",shortnames:["airplane"]},{unified:"1F6E9-FE0F",shortnames:["small_airplane"]},{unified:"1F6EB",shortnames:["airplane_departure"]},{unified:"1F6EC",shortnames:["airplane_arriving"]},{unified:"1F4BA",shortnames:["seat"]},{unified:"1F681",shortnames:["helicopter"]},{unified:"1F69F",shortnames:["suspension_railway"]},{unified:"1F6A0",shortnames:["mountain_cableway"]},{unified:"1F6A1",shortnames:["aerial_tramway"]},{unified:"1F6F0-FE0F",shortnames:["satellite"]},{unified:"1F680",shortnames:["rocket"]},{unified:"1F6F8",shortnames:["flying_saucer"]},{unified:"1F6CE-FE0F",shortnames:["bellhop_bell"]},{unified:"1F6AA",shortnames:["door"]},{unified:"1F6CF-FE0F",shortnames:["bed"]},{unified:"1F6CB-FE0F",shortnames:["couch_and_lamp"]},{unified:"1F6BD",shortnames:["toilet"]},{unified:"1F6BF",shortnames:["shower"]},{unified:"1F6C1",shortnames:["bathtub"]},{unified:"231B",shortnames:["hourglass"]},{unified:"23F3",shortnames:["hourglass_flowing_sand"]},{unified:"231A",shortnames:["watch"]},{unified:"23F0",shortnames:["alarm_clock"]},{unified:"23F1-FE0F",shortnames:["stopwatch"]},{unified:"23F2-FE0F",shortnames:["timer_clock"]},{unified:"1F570-FE0F",shortnames:["mantelpiece_clock"]},{unified:"1F55B",shortnames:["clock12"]},{unified:"1F567",shortnames:["clock1230"]},{unified:"1F550",shortnames:["clock1"]},{unified:"1F55C",shortnames:["clock130"]},{unified:"1F551",shortnames:["clock2"]},{unified:"1F55D",shortnames:["clock230"]},{unified:"1F552",shortnames:["clock3"]},{unified:"1F55E",shortnames:["clock330"]},{unified:"1F553",shortnames:["clock4"]},{unified:"1F55F",shortnames:["clock430"]},{unified:"1F554",shortnames:["clock5"]},{unified:"1F560",shortnames:["clock530"]},{unified:"1F555",shortnames:["clock6"]},{unified:"1F561",shortnames:["clock630"]},{unified:"1F556",shortnames:["clock7"]},{unified:"1F562",shortnames:["clock730"]},{unified:"1F557",shortnames:["clock8"]},{unified:"1F563",shortnames:["clock830"]},{unified:"1F558",shortnames:["clock9"]},{unified:"1F564",shortnames:["clock930"]},{unified:"1F559",shortnames:["clock10"]},{unified:"1F565",shortnames:["clock1030"]},{unified:"1F55A",shortnames:["clock11"]},{unified:"1F566",shortnames:["clock1130"]},{unified:"1F311",shortnames:["new_moon"]},{unified:"1F312",shortnames:["waxing_crescent_moon"]},{unified:"1F313",shortnames:["first_quarter_moon"]},{unified:"1F314",shortnames:["moon"]},{unified:"1F315",shortnames:["full_moon"]},{unified:"1F316",shortnames:["waning_gibbous_moon"]},{unified:"1F317",shortnames:["last_quarter_moon"]},{unified:"1F318",shortnames:["waning_crescent_moon"]},{unified:"1F319",shortnames:["crescent_moon"]},{unified:"1F31A",shortnames:["new_moon_with_face"]},{unified:"1F31B",shortnames:["first_quarter_moon_with_face"]},{unified:"1F31C",shortnames:["last_quarter_moon_with_face"]},{unified:"1F321-FE0F",shortnames:["thermometer"]},{unified:"2600-FE0F",shortnames:["sunny"]},{unified:"1F31D",shortnames:["full_moon_with_face"]},{unified:"1F31E",shortnames:["sun_with_face"]},{unified:"2B50",shortnames:["star"]},{unified:"1F31F",shortnames:["star2"]},{unified:"1F320",shortnames:["stars"]},{unified:"2601-FE0F",shortnames:["cloud"]},{unified:"26C5",shortnames:["partly_sunny"]},{unified:"26C8-FE0F",shortnames:["thunder_cloud_and_rain"]},{unified:"1F324-FE0F",shortnames:["mostly_sunny"]},{unified:"1F325-FE0F",shortnames:["barely_sunny"]},{unified:"1F326-FE0F",shortnames:["partly_sunny_rain"]},{unified:"1F327-FE0F",shortnames:["rain_cloud"]},{unified:"1F328-FE0F",shortnames:["snow_cloud"]},{unified:"1F329-FE0F",shortnames:["lightning"]},{unified:"1F32A-FE0F",shortnames:["tornado"]},{unified:"1F32B-FE0F",shortnames:["fog"]},{unified:"1F32C-FE0F",shortnames:["wind_blowing_face"]},{unified:"1F300",shortnames:["cyclone"]},{unified:"1F308",shortnames:["rainbow"]},{unified:"1F302",shortnames:["closed_umbrella"]},{unified:"2602-FE0F",shortnames:["umbrella"]},{unified:"2614",shortnames:["umbrella_with_rain_drops"]},{unified:"26F1-FE0F",shortnames:["umbrella_on_ground"]},{unified:"26A1",shortnames:["zap"]},{unified:"2744-FE0F",shortnames:["snowflake"]},{unified:"2603-FE0F",shortnames:["snowman"]},{unified:"26C4",shortnames:["snowman_without_snow"]},{unified:"2604-FE0F",shortnames:["comet"]},{unified:"1F525",shortnames:["fire"]},{unified:"1F4A7",shortnames:["droplet"]},{unified:"1F30A",shortnames:["ocean"]}]},{name:"Activities",emojis:[{unified:"1F383",shortnames:["jack_o_lantern"]},{unified:"1F384",shortnames:["christmas_tree"]},{unified:"1F386",shortnames:["fireworks"]},{unified:"1F387",shortnames:["sparkler"]},{unified:"2728",shortnames:["sparkles"]},{unified:"1F388",shortnames:["balloon"]},{unified:"1F389",shortnames:["tada"]},{unified:"1F38A",shortnames:["confetti_ball"]},{unified:"1F38B",shortnames:["tanabata_tree"]},{unified:"1F38D",shortnames:["bamboo"]},{unified:"1F38E",shortnames:["dolls"]},{unified:"1F38F",shortnames:["flags"]},{unified:"1F390",shortnames:["wind_chime"]},{unified:"1F391",shortnames:["rice_scene"]},{unified:"1F380",shortnames:["ribbon"]},{unified:"1F381",shortnames:["gift"]},{unified:"1F397-FE0F",shortnames:["reminder_ribbon"]},{unified:"1F39F-FE0F",shortnames:["admission_tickets"]},{unified:"1F3AB",shortnames:["ticket"]},{unified:"1F396-FE0F",shortnames:["medal"]},{unified:"1F3C6",shortnames:["trophy"]},{unified:"1F3C5",shortnames:["sports_medal"]},{unified:"1F947",shortnames:["first_place_medal"]},{unified:"1F948",shortnames:["second_place_medal"]},{unified:"1F949",shortnames:["third_place_medal"]},{unified:"26BD",shortnames:["soccer"]},{unified:"26BE",shortnames:["baseball"]},{unified:"1F3C0",shortnames:["basketball"]},{unified:"1F3D0",shortnames:["volleyball"]},{unified:"1F3C8",shortnames:["football"]},{unified:"1F3C9",shortnames:["rugby_football"]},{unified:"1F3BE",shortnames:["tennis"]},{unified:"1F3B1",shortnames:["8ball"]},{unified:"1F3B3",shortnames:["bowling"]},{unified:"1F3CF",shortnames:["cricket_bat_and_ball"]},{unified:"1F3D1",shortnames:["field_hockey_stick_and_ball"]},{unified:"1F3D2",shortnames:["ice_hockey_stick_and_puck"]},{unified:"1F3D3",shortnames:["table_tennis_paddle_and_ball"]},{unified:"1F3F8",shortnames:["badminton_racquet_and_shuttlecock"]},{unified:"1F94A",shortnames:["boxing_glove"]},{unified:"1F94B",shortnames:["martial_arts_uniform"]},{unified:"1F945",shortnames:["goal_net"]},{unified:"1F3AF",shortnames:["dart"]},{unified:"26F3",shortnames:["golf"]},{unified:"26F8-FE0F",shortnames:["ice_skate"]},{unified:"1F3A3",shortnames:["fishing_pole_and_fish"]},{unified:"1F3BD",shortnames:["running_shirt_with_sash"]},{unified:"1F3BF",shortnames:["ski"]},{unified:"1F6F7",shortnames:["sled"]},{unified:"1F94C",shortnames:["curling_stone"]},{unified:"1F3AE",shortnames:["video_game"]},{unified:"1F579-FE0F",shortnames:["joystick"]},{unified:"1F3B2",shortnames:["game_die"]},{unified:"2660-FE0F",shortnames:["spades"]},{unified:"2665-FE0F",shortnames:["hearts"]},{unified:"2666-FE0F",shortnames:["diamonds"]},{unified:"2663-FE0F",shortnames:["clubs"]},{unified:"1F0CF",shortnames:["black_joker"]},{unified:"1F004",shortnames:["mahjong"]},{unified:"1F3B4",shortnames:["flower_playing_cards"]}]},{name:"Objects",emojis:[{unified:"1F507",shortnames:["mute"]},{unified:"1F508",shortnames:["speaker"]},{unified:"1F509",shortnames:["sound"]},{unified:"1F50A",shortnames:["loud_sound"]},{unified:"1F4E2",shortnames:["loudspeaker"]},{unified:"1F4E3",shortnames:["mega"]},{unified:"1F4EF",shortnames:["postal_horn"]},{unified:"1F514",shortnames:["bell"]},{unified:"1F515",shortnames:["no_bell"]},{unified:"1F3BC",shortnames:["musical_score"]},{unified:"1F3B5",shortnames:["musical_note"]},{unified:"1F3B6",shortnames:["notes"]},{unified:"1F399-FE0F",shortnames:["studio_microphone"]},{unified:"1F39A-FE0F",shortnames:["level_slider"]},{unified:"1F39B-FE0F",shortnames:["control_knobs"]},{unified:"1F3A4",shortnames:["microphone"]},{unified:"1F3A7",shortnames:["headphones"]},{unified:"1F4FB",shortnames:["radio"]},{unified:"1F3B7",shortnames:["saxophone"]},{unified:"1F3B8",shortnames:["guitar"]},{unified:"1F3B9",shortnames:["musical_keyboard"]},{unified:"1F3BA",shortnames:["trumpet"]},{unified:"1F3BB",shortnames:["violin"]},{unified:"1F941",shortnames:["drum_with_drumsticks"]},{unified:"1F4F1",shortnames:["iphone"]},{unified:"1F4F2",shortnames:["calling"]},{unified:"260E-FE0F",shortnames:["phone"]},{unified:"1F4DE",shortnames:["telephone_receiver"]},{unified:"1F4DF",shortnames:["pager"]},{unified:"1F4E0",shortnames:["fax"]},{unified:"1F50B",shortnames:["battery"]},{unified:"1F50C",shortnames:["electric_plug"]},{unified:"1F4BB",shortnames:["computer"]},{unified:"1F5A5-FE0F",shortnames:["desktop_computer"]},{unified:"1F5A8-FE0F",shortnames:["printer"]},{unified:"2328-FE0F",shortnames:["keyboard"]},{unified:"1F5B1-FE0F",shortnames:["three_button_mouse"]},{unified:"1F5B2-FE0F",shortnames:["trackball"]},{unified:"1F4BD",shortnames:["minidisc"]},{unified:"1F4BE",shortnames:["floppy_disk"]},{unified:"1F4BF",shortnames:["cd"]},{unified:"1F4C0",shortnames:["dvd"]},{unified:"1F3A5",shortnames:["movie_camera"]},{unified:"1F39E-FE0F",shortnames:["film_frames"]},{unified:"1F4FD-FE0F",shortnames:["film_projector"]},{unified:"1F3AC",shortnames:["clapper"]},{unified:"1F4FA",shortnames:["tv"]},{unified:"1F4F7",shortnames:["camera"]},{unified:"1F4F8",shortnames:["camera_with_flash"]},{unified:"1F4F9",shortnames:["video_camera"]},{unified:"1F4FC",shortnames:["vhs"]},{unified:"1F50D",shortnames:["mag"]},{unified:"1F50E",shortnames:["mag_right"]},{unified:"1F52C",shortnames:["microscope"]},{unified:"1F52D",shortnames:["telescope"]},{unified:"1F4E1",shortnames:["satellite_antenna"]},{unified:"1F56F-FE0F",shortnames:["candle"]},{unified:"1F4A1",shortnames:["bulb"]},{unified:"1F526",shortnames:["flashlight"]},{unified:"1F3EE",shortnames:["izakaya_lantern"]},{unified:"1F4D4",shortnames:["notebook_with_decorative_cover"]},{unified:"1F4D5",shortnames:["closed_book"]},{unified:"1F4D6",shortnames:["book"]},{unified:"1F4D7",shortnames:["green_book"]},{unified:"1F4D8",shortnames:["blue_book"]},{unified:"1F4D9",shortnames:["orange_book"]},{unified:"1F4DA",shortnames:["books"]},{unified:"1F4D3",shortnames:["notebook"]},{unified:"1F4D2",shortnames:["ledger"]},{unified:"1F4C3",shortnames:["page_with_curl"]},{unified:"1F4DC",shortnames:["scroll"]},{unified:"1F4C4",shortnames:["page_facing_up"]},{unified:"1F4F0",shortnames:["newspaper"]},{unified:"1F5DE-FE0F",shortnames:["rolled_up_newspaper"]},{unified:"1F4D1",shortnames:["bookmark_tabs"]},{unified:"1F516",shortnames:["bookmark"]},{unified:"1F3F7-FE0F",shortnames:["label"]},{unified:"1F4B0",shortnames:["moneybag"]},{unified:"1F4B4",shortnames:["yen"]},{unified:"1F4B5",shortnames:["dollar"]},{unified:"1F4B6",shortnames:["euro"]},{unified:"1F4B7",shortnames:["pound"]},{unified:"1F4B8",shortnames:["money_with_wings"]},{unified:"1F4B3",shortnames:["credit_card"]},{unified:"1F4B9",shortnames:["chart"]},{unified:"1F4B1",shortnames:["currency_exchange"]},{unified:"1F4B2",shortnames:["heavy_dollar_sign"]},{unified:"2709-FE0F",shortnames:["email"]},{unified:"1F4E7",shortnames:["e-mail"]},{unified:"1F4E8",shortnames:["incoming_envelope"]},{unified:"1F4E9",shortnames:["envelope_with_arrow"]},{unified:"1F4E4",shortnames:["outbox_tray"]},{unified:"1F4E5",shortnames:["inbox_tray"]},{unified:"1F4E6",shortnames:["package"]},{unified:"1F4EB",shortnames:["mailbox"]},{unified:"1F4EA",shortnames:["mailbox_closed"]},{unified:"1F4EC",shortnames:["mailbox_with_mail"]},{unified:"1F4ED",shortnames:["mailbox_with_no_mail"]},{unified:"1F4EE",shortnames:["postbox"]},{unified:"1F5F3-FE0F",shortnames:["ballot_box_with_ballot"]},{unified:"270F-FE0F",shortnames:["pencil2"]},{unified:"2712-FE0F",shortnames:["black_nib"]},{unified:"1F58B-FE0F",shortnames:["lower_left_fountain_pen"]},{unified:"1F58A-FE0F",shortnames:["lower_left_ballpoint_pen"]},{unified:"1F58C-FE0F",shortnames:["lower_left_paintbrush"]},{unified:"1F58D-FE0F",shortnames:["lower_left_crayon"]},{unified:"1F4DD",shortnames:["memo"]},{unified:"1F4BC",shortnames:["briefcase"]},{unified:"1F4C1",shortnames:["file_folder"]},{unified:"1F4C2",shortnames:["open_file_folder"]},{unified:"1F5C2-FE0F",shortnames:["card_index_dividers"]},{unified:"1F4C5",shortnames:["date"]},{unified:"1F4C6",shortnames:["calendar"]},{unified:"1F5D2-FE0F",shortnames:["spiral_note_pad"]},{unified:"1F5D3-FE0F",shortnames:["spiral_calendar_pad"]},{unified:"1F4C7",shortnames:["card_index"]},{unified:"1F4C8",shortnames:["chart_with_upwards_trend"]},{unified:"1F4C9",shortnames:["chart_with_downwards_trend"]},{unified:"1F4CA",shortnames:["bar_chart"]},{unified:"1F4CB",shortnames:["clipboard"]},{unified:"1F4CC",shortnames:["pushpin"]},{unified:"1F4CD",shortnames:["round_pushpin"]},{unified:"1F4CE",shortnames:["paperclip"]},{unified:"1F587-FE0F",shortnames:["linked_paperclips"]},{unified:"1F4CF",shortnames:["straight_ruler"]},{unified:"1F4D0",shortnames:["triangular_ruler"]},{unified:"2702-FE0F",shortnames:["scissors"]},{unified:"1F5C3-FE0F",shortnames:["card_file_box"]},{unified:"1F5C4-FE0F",shortnames:["file_cabinet"]},{unified:"1F5D1-FE0F",shortnames:["wastebasket"]},{unified:"1F512",shortnames:["lock"]},{unified:"1F513",shortnames:["unlock"]},{unified:"1F50F",shortnames:["lock_with_ink_pen"]},{unified:"1F510",shortnames:["closed_lock_with_key"]},{unified:"1F511",shortnames:["key"]},{unified:"1F5DD-FE0F",shortnames:["old_key"]},{unified:"1F528",shortnames:["hammer"]},{unified:"26CF-FE0F",shortnames:["pick"]},{unified:"2692-FE0F",shortnames:["hammer_and_pick"]},{unified:"1F6E0-FE0F",shortnames:["hammer_and_wrench"]},{unified:"1F5E1-FE0F",shortnames:["dagger_knife"]},{unified:"2694-FE0F",shortnames:["crossed_swords"]},{unified:"1F52B",shortnames:["gun"]},{unified:"1F3F9",shortnames:["bow_and_arrow"]},{unified:"1F6E1-FE0F",shortnames:["shield"]},{unified:"1F527",shortnames:["wrench"]},{unified:"1F529",shortnames:["nut_and_bolt"]},{unified:"2699-FE0F",shortnames:["gear"]},{unified:"1F5DC-FE0F",shortnames:["compression"]},{unified:"2697-FE0F",shortnames:["alembic"]},{unified:"2696-FE0F",shortnames:["scales"]},{unified:"1F517",shortnames:["link"]},{unified:"26D3-FE0F",shortnames:["chains"]},{unified:"1F489",shortnames:["syringe"]},{unified:"1F48A",shortnames:["pill"]},{unified:"1F6AC",shortnames:["smoking"]},{unified:"26B0-FE0F",shortnames:["coffin"]},{unified:"26B1-FE0F",shortnames:["funeral_urn"]},{unified:"1F5FF",shortnames:["moyai"]},{unified:"1F6E2-FE0F",shortnames:["oil_drum"]},{unified:"1F52E",shortnames:["crystal_ball"]},{unified:"1F6D2",shortnames:["shopping_trolley"]}]},{name:"Symbols",emojis:[{unified:"1F3E7",shortnames:["atm"]},{unified:"1F6AE",shortnames:["put_litter_in_its_place"]},{unified:"1F6B0",shortnames:["potable_water"]},{unified:"267F",shortnames:["wheelchair"]},{unified:"1F6B9",shortnames:["mens"]},{unified:"1F6BA",shortnames:["womens"]},{unified:"1F6BB",shortnames:["restroom"]},{unified:"1F6BC",shortnames:["baby_symbol"]},{unified:"1F6BE",shortnames:["wc"]},{unified:"1F6C2",shortnames:["passport_control"]},{unified:"1F6C3",shortnames:["customs"]},{unified:"1F6C4",shortnames:["baggage_claim"]},{unified:"1F6C5",shortnames:["left_luggage"]},{unified:"26A0-FE0F",shortnames:["warning"]},{unified:"1F6B8",shortnames:["children_crossing"]},{unified:"26D4",shortnames:["no_entry"]},{unified:"1F6AB",shortnames:["no_entry_sign"]},{unified:"1F6B3",shortnames:["no_bicycles"]},{unified:"1F6AD",shortnames:["no_smoking"]},{unified:"1F6AF",shortnames:["do_not_litter"]},{unified:"1F6B1",shortnames:["non-potable_water"]},{unified:"1F6B7",shortnames:["no_pedestrians"]},{unified:"1F4F5",shortnames:["no_mobile_phones"]},{unified:"1F51E",shortnames:["underage"]},{unified:"2622-FE0F",shortnames:["radioactive_sign"]},{unified:"2623-FE0F",shortnames:["biohazard_sign"]},{unified:"2B06-FE0F",shortnames:["arrow_up"]},{unified:"2197-FE0F",shortnames:["arrow_upper_right"]},{unified:"27A1-FE0F",shortnames:["arrow_right"]},{unified:"2198-FE0F",shortnames:["arrow_lower_right"]},{unified:"2B07-FE0F",shortnames:["arrow_down"]},{unified:"2199-FE0F",shortnames:["arrow_lower_left"]},{unified:"2B05-FE0F",shortnames:["arrow_left"]},{unified:"2196-FE0F",shortnames:["arrow_upper_left"]},{unified:"2195-FE0F",shortnames:["arrow_up_down"]},{unified:"2194-FE0F",shortnames:["left_right_arrow"]},{unified:"21A9-FE0F",shortnames:["leftwards_arrow_with_hook"]},{unified:"21AA-FE0F",shortnames:["arrow_right_hook"]},{unified:"2934-FE0F",shortnames:["arrow_heading_up"]},{unified:"2935-FE0F",shortnames:["arrow_heading_down"]},{unified:"1F503",shortnames:["arrows_clockwise"]},{unified:"1F504",shortnames:["arrows_counterclockwise"]},{unified:"1F519",shortnames:["back"]},{unified:"1F51A",shortnames:["end"]},{unified:"1F51B",shortnames:["on"]},{unified:"1F51C",shortnames:["soon"]},{unified:"1F51D",shortnames:["top"]},{unified:"1F6D0",shortnames:["place_of_worship"]},{unified:"269B-FE0F",shortnames:["atom_symbol"]},{unified:"1F549-FE0F",shortnames:["om_symbol"]},{unified:"2721-FE0F",shortnames:["star_of_david"]},{unified:"2638-FE0F",shortnames:["wheel_of_dharma"]},{unified:"262F-FE0F",shortnames:["yin_yang"]},{unified:"271D-FE0F",shortnames:["latin_cross"]},{unified:"2626-FE0F",shortnames:["orthodox_cross"]},{unified:"262A-FE0F",shortnames:["star_and_crescent"]},{unified:"262E-FE0F",shortnames:["peace_symbol"]},{unified:"1F54E",shortnames:["menorah_with_nine_branches"]},{unified:"1F52F",shortnames:["six_pointed_star"]},{unified:"2648",shortnames:["aries"]},{unified:"2649",shortnames:["taurus"]},{unified:"264A",shortnames:["gemini"]},{unified:"264B",shortnames:["cancer"]},{unified:"264C",shortnames:["leo"]},{unified:"264D",shortnames:["virgo"]},{unified:"264E",shortnames:["libra"]},{unified:"264F",shortnames:["scorpius"]},{unified:"2650",shortnames:["sagittarius"]},{unified:"2651",shortnames:["capricorn"]},{unified:"2652",shortnames:["aquarius"]},{unified:"2653",shortnames:["pisces"]},{unified:"26CE",shortnames:["ophiuchus"]},{unified:"1F500",shortnames:["twisted_rightwards_arrows"]},{unified:"1F501",shortnames:["repeat"]},{unified:"1F502",shortnames:["repeat_one"]},{unified:"25B6-FE0F",shortnames:["arrow_forward"]},{unified:"23E9",shortnames:["fast_forward"]},{unified:"23ED-FE0F",shortnames:["black_right_pointing_double_triangle_with_vertical_bar"]},{unified:"23EF-FE0F",shortnames:["black_right_pointing_triangle_with_double_vertical_bar"]},{unified:"25C0-FE0F",shortnames:["arrow_backward"]},{unified:"23EA",shortnames:["rewind"]},{unified:"23EE-FE0F",shortnames:["black_left_pointing_double_triangle_with_vertical_bar"]},{unified:"1F53C",shortnames:["arrow_up_small"]},{unified:"23EB",shortnames:["arrow_double_up"]},{unified:"1F53D",shortnames:["arrow_down_small"]},{unified:"23EC",shortnames:["arrow_double_down"]},{unified:"23F8-FE0F",shortnames:["double_vertical_bar"]},{unified:"23F9-FE0F",shortnames:["black_square_for_stop"]},{unified:"23FA-FE0F",shortnames:["black_circle_for_record"]},{unified:"23CF-FE0F",shortnames:["eject"]},{unified:"1F3A6",shortnames:["cinema"]},{unified:"1F505",shortnames:["low_brightness"]},{unified:"1F506",shortnames:["high_brightness"]},{unified:"1F4F6",shortnames:["signal_strength"]},{unified:"1F4F3",shortnames:["vibration_mode"]},{unified:"1F4F4",shortnames:["mobile_phone_off"]},{unified:"2640-FE0F",shortnames:["female_sign"]},{unified:"2642-FE0F",shortnames:["male_sign"]},{unified:"2695-FE0F",shortnames:["medical_symbol"]},{unified:"267B-FE0F",shortnames:["recycle"]},{unified:"269C-FE0F",shortnames:["fleur_de_lis"]},{unified:"1F531",shortnames:["trident"]},{unified:"1F4DB",shortnames:["name_badge"]},{unified:"1F530",shortnames:["beginner"]},{unified:"2B55",shortnames:["o"]},{unified:"2705",shortnames:["white_check_mark"]},{unified:"2611-FE0F",shortnames:["ballot_box_with_check"]},{unified:"2714-FE0F",shortnames:["heavy_check_mark"]},{unified:"2716-FE0F",shortnames:["heavy_multiplication_x"]},{unified:"274C",shortnames:["x"]},{unified:"274E",shortnames:["negative_squared_cross_mark"]},{unified:"2795",shortnames:["heavy_plus_sign"]},{unified:"2796",shortnames:["heavy_minus_sign"]},{unified:"2797",shortnames:["heavy_division_sign"]},{unified:"27B0",shortnames:["curly_loop"]},{unified:"27BF",shortnames:["loop"]},{unified:"303D-FE0F",shortnames:["part_alternation_mark"]},{unified:"2733-FE0F",shortnames:["eight_spoked_asterisk"]},{unified:"2734-FE0F",shortnames:["eight_pointed_black_star"]},{unified:"2747-FE0F",shortnames:["sparkle"]},{unified:"203C-FE0F",shortnames:["bangbang"]},{unified:"2049-FE0F",shortnames:["interrobang"]},{unified:"2753",shortnames:["question"]},{unified:"2754",shortnames:["grey_question"]},{unified:"2755",shortnames:["grey_exclamation"]},{unified:"2757",shortnames:["exclamation"]},{unified:"3030-FE0F",shortnames:["wavy_dash"]},{unified:"00A9-FE0F",shortnames:["copyright"]},{unified:"00AE-FE0F",shortnames:["registered"]},{unified:"2122-FE0F",shortnames:["tm"]},{unified:"0023-FE0F-20E3",shortnames:["hash"]},{unified:"002A-FE0F-20E3",shortnames:["keycap_star"]},{unified:"0030-FE0F-20E3",shortnames:["zero"]},{unified:"0031-FE0F-20E3",shortnames:["one"]},{unified:"0032-FE0F-20E3",shortnames:["two"]},{unified:"0033-FE0F-20E3",shortnames:["three"]},{unified:"0034-FE0F-20E3",shortnames:["four"]},{unified:"0035-FE0F-20E3",shortnames:["five"]},{unified:"0036-FE0F-20E3",shortnames:["six"]},{unified:"0037-FE0F-20E3",shortnames:["seven"]},{unified:"0038-FE0F-20E3",shortnames:["eight"]},{unified:"0039-FE0F-20E3",shortnames:["nine"]},{unified:"1F51F",shortnames:["keycap_ten"]},{unified:"1F4AF",shortnames:["100"]},{unified:"1F520",shortnames:["capital_abcd"]},{unified:"1F521",shortnames:["abcd"]},{unified:"1F522",shortnames:["1234"]},{unified:"1F523",shortnames:["symbols"]},{unified:"1F524",shortnames:["abc"]},{unified:"1F170-FE0F",shortnames:["a"]},{unified:"1F18E",shortnames:["ab"]},{unified:"1F171-FE0F",shortnames:["b"]},{unified:"1F191",shortnames:["cl"]},{unified:"1F192",shortnames:["cool"]},{unified:"1F193",shortnames:["free"]},{unified:"2139-FE0F",shortnames:["information_source"]},{unified:"1F194",shortnames:["id"]},{unified:"24C2-FE0F",shortnames:["m"]},{unified:"1F195",shortnames:["new"]},{unified:"1F196",shortnames:["ng"]},{unified:"1F17E-FE0F",shortnames:["o2"]},{unified:"1F197",shortnames:["ok"]},{unified:"1F17F-FE0F",shortnames:["parking"]},{unified:"1F198",shortnames:["sos"]},{unified:"1F199",shortnames:["up"]},{unified:"1F19A",shortnames:["vs"]},{unified:"1F201",shortnames:["koko"]},{unified:"1F202-FE0F",shortnames:["sa"]},{unified:"1F237-FE0F",shortnames:["u6708"]},{unified:"1F236",shortnames:["u6709"]},{unified:"1F22F",shortnames:["u6307"]},{unified:"1F250",shortnames:["ideograph_advantage"]},{unified:"1F239",shortnames:["u5272"]},{unified:"1F21A",shortnames:["u7121"]},{unified:"1F232",shortnames:["u7981"]},{unified:"1F251",shortnames:["accept"]},{unified:"1F238",shortnames:["u7533"]},{unified:"1F234",shortnames:["u5408"]},{unified:"1F233",shortnames:["u7a7a"]},{unified:"3297-FE0F",shortnames:["congratulations"]},{unified:"3299-FE0F",shortnames:["secret"]},{unified:"1F23A",shortnames:["u55b6"]},{unified:"1F235",shortnames:["u6e80"]},{unified:"25AA-FE0F",shortnames:["black_small_square"]},{unified:"25AB-FE0F",shortnames:["white_small_square"]},{unified:"25FB-FE0F",shortnames:["white_medium_square"]},{unified:"25FC-FE0F",shortnames:["black_medium_square"]},{unified:"25FD",shortnames:["white_medium_small_square"]},{unified:"25FE",shortnames:["black_medium_small_square"]},{unified:"2B1B",shortnames:["black_large_square"]},{unified:"2B1C",shortnames:["white_large_square"]},{unified:"1F536",shortnames:["large_orange_diamond"]},{unified:"1F537",shortnames:["large_blue_diamond"]},{unified:"1F538",shortnames:["small_orange_diamond"]},{unified:"1F539",shortnames:["small_blue_diamond"]},{unified:"1F53A",shortnames:["small_red_triangle"]},{unified:"1F53B",shortnames:["small_red_triangle_down"]},{unified:"1F4A0",shortnames:["diamond_shape_with_a_dot_inside"]},{unified:"1F518",shortnames:["radio_button"]},{unified:"1F532",shortnames:["black_square_button"]},{unified:"1F533",shortnames:["white_square_button"]},{unified:"26AA",shortnames:["white_circle"]},{unified:"26AB",shortnames:["black_circle"]},{unified:"1F534",shortnames:["red_circle"]},{unified:"1F535",shortnames:["large_blue_circle"]}]},{name:"Flags",emojis:[{unified:"1F3C1",shortnames:["checkered_flag"]},{unified:"1F6A9",shortnames:["triangular_flag_on_post"]},{unified:"1F38C",shortnames:["crossed_flags"]},{unified:"1F3F4",shortnames:["waving_black_flag"]},{unified:"1F3F3-FE0F",shortnames:["waving_white_flag"]},{unified:"1F3F3-FE0F-200D-1F308",shortnames:["rainbow-flag"]},{unified:"1F1E6-1F1E8",shortnames:["flag-ac"]},{unified:"1F1E6-1F1E9",shortnames:["flag-ad"]},{unified:"1F1E6-1F1EA",shortnames:["flag-ae"]},{unified:"1F1E6-1F1EB",shortnames:["flag-af"]},{unified:"1F1E6-1F1EC",shortnames:["flag-ag"]},{unified:"1F1E6-1F1EE",shortnames:["flag-ai"]},{unified:"1F1E6-1F1F1",shortnames:["flag-al"]},{unified:"1F1E6-1F1F2",shortnames:["flag-am"]},{unified:"1F1E6-1F1F4",shortnames:["flag-ao"]},{unified:"1F1E6-1F1F6",shortnames:["flag-aq"]},{unified:"1F1E6-1F1F7",shortnames:["flag-ar"]},{unified:"1F1E6-1F1F8",shortnames:["flag-as"]},{unified:"1F1E6-1F1F9",shortnames:["flag-at"]},{unified:"1F1E6-1F1FA",shortnames:["flag-au"]},{unified:"1F1E6-1F1FC",shortnames:["flag-aw"]},{unified:"1F1E6-1F1FD",shortnames:["flag-ax"]},{unified:"1F1E6-1F1FF",shortnames:["flag-az"]},{unified:"1F1E7-1F1E6",shortnames:["flag-ba"]},{unified:"1F1E7-1F1E7",shortnames:["flag-bb"]},{unified:"1F1E7-1F1E9",shortnames:["flag-bd"]},{unified:"1F1E7-1F1EA",shortnames:["flag-be"]},{unified:"1F1E7-1F1EB",shortnames:["flag-bf"]},{unified:"1F1E7-1F1EC",shortnames:["flag-bg"]},{unified:"1F1E7-1F1ED",shortnames:["flag-bh"]},{unified:"1F1E7-1F1EE",shortnames:["flag-bi"]},{unified:"1F1E7-1F1EF",shortnames:["flag-bj"]},{unified:"1F1E7-1F1F1",shortnames:["flag-bl"]},{unified:"1F1E7-1F1F2",shortnames:["flag-bm"]},{unified:"1F1E7-1F1F3",shortnames:["flag-bn"]},{unified:"1F1E7-1F1F4",shortnames:["flag-bo"]},{unified:"1F1E7-1F1F6",shortnames:["flag-bq"]},{unified:"1F1E7-1F1F7",shortnames:["flag-br"]},{unified:"1F1E7-1F1F8",shortnames:["flag-bs"]},{unified:"1F1E7-1F1F9",shortnames:["flag-bt"]},{unified:"1F1E7-1F1FB",shortnames:["flag-bv"]},{unified:"1F1E7-1F1FC",shortnames:["flag-bw"]},{unified:"1F1E7-1F1FE",shortnames:["flag-by"]},{unified:"1F1E7-1F1FF",shortnames:["flag-bz"]},{unified:"1F1E8-1F1E6",shortnames:["flag-ca"]},{unified:"1F1E8-1F1E8",shortnames:["flag-cc"]},{unified:"1F1E8-1F1E9",shortnames:["flag-cd"]},{unified:"1F1E8-1F1EB",shortnames:["flag-cf"]},{unified:"1F1E8-1F1EC",shortnames:["flag-cg"]},{unified:"1F1E8-1F1ED",shortnames:["flag-ch"]},{unified:"1F1E8-1F1EE",shortnames:["flag-ci"]},{unified:"1F1E8-1F1F0",shortnames:["flag-ck"]},{unified:"1F1E8-1F1F1",shortnames:["flag-cl"]},{unified:"1F1E8-1F1F2",shortnames:["flag-cm"]},{unified:"1F1E8-1F1F3",shortnames:["cn"]},{unified:"1F1E8-1F1F4",shortnames:["flag-co"]},{unified:"1F1E8-1F1F5",shortnames:["flag-cp"]},{unified:"1F1E8-1F1F7",shortnames:["flag-cr"]},{unified:"1F1E8-1F1FA",shortnames:["flag-cu"]},{unified:"1F1E8-1F1FB",shortnames:["flag-cv"]},{unified:"1F1E8-1F1FC",shortnames:["flag-cw"]},{unified:"1F1E8-1F1FD",shortnames:["flag-cx"]},{unified:"1F1E8-1F1FE",shortnames:["flag-cy"]},{unified:"1F1E8-1F1FF",shortnames:["flag-cz"]},{unified:"1F1E9-1F1EA",shortnames:["de"]},{unified:"1F1E9-1F1EC",shortnames:["flag-dg"]},{unified:"1F1E9-1F1EF",shortnames:["flag-dj"]},{unified:"1F1E9-1F1F0",shortnames:["flag-dk"]},{unified:"1F1E9-1F1F2",shortnames:["flag-dm"]},{unified:"1F1E9-1F1F4",shortnames:["flag-do"]},{unified:"1F1E9-1F1FF",shortnames:["flag-dz"]},{unified:"1F1EA-1F1E6",shortnames:["flag-ea"]},{unified:"1F1EA-1F1E8",shortnames:["flag-ec"]},{unified:"1F1EA-1F1EA",shortnames:["flag-ee"]},{unified:"1F1EA-1F1EC",shortnames:["flag-eg"]},{unified:"1F1EA-1F1ED",shortnames:["flag-eh"]},{unified:"1F1EA-1F1F7",shortnames:["flag-er"]},{unified:"1F1EA-1F1F8",shortnames:["es"]},{unified:"1F1EA-1F1F9",shortnames:["flag-et"]},{unified:"1F1EA-1F1FA",shortnames:["flag-eu"]},{unified:"1F1EB-1F1EE",shortnames:["flag-fi"]},{unified:"1F1EB-1F1EF",shortnames:["flag-fj"]},{unified:"1F1EB-1F1F0",shortnames:["flag-fk"]},{unified:"1F1EB-1F1F2",shortnames:["flag-fm"]},{unified:"1F1EB-1F1F4",shortnames:["flag-fo"]},{unified:"1F1EB-1F1F7",shortnames:["fr"]},{unified:"1F1EC-1F1E6",shortnames:["flag-ga"]},{unified:"1F1EC-1F1E7",shortnames:["gb"]},{unified:"1F1EC-1F1E9",shortnames:["flag-gd"]},{unified:"1F1EC-1F1EA",shortnames:["flag-ge"]},{unified:"1F1EC-1F1EB",shortnames:["flag-gf"]},{unified:"1F1EC-1F1EC",shortnames:["flag-gg"]},{unified:"1F1EC-1F1ED",shortnames:["flag-gh"]},{unified:"1F1EC-1F1EE",shortnames:["flag-gi"]},{unified:"1F1EC-1F1F1",shortnames:["flag-gl"]},{unified:"1F1EC-1F1F2",shortnames:["flag-gm"]},{unified:"1F1EC-1F1F3",shortnames:["flag-gn"]},{unified:"1F1EC-1F1F5",shortnames:["flag-gp"]},{unified:"1F1EC-1F1F6",shortnames:["flag-gq"]},{unified:"1F1EC-1F1F7",shortnames:["flag-gr"]},{unified:"1F1EC-1F1F8",shortnames:["flag-gs"]},{unified:"1F1EC-1F1F9",shortnames:["flag-gt"]},{unified:"1F1EC-1F1FA",shortnames:["flag-gu"]},{unified:"1F1EC-1F1FC",shortnames:["flag-gw"]},{unified:"1F1EC-1F1FE",shortnames:["flag-gy"]},{unified:"1F1ED-1F1F0",shortnames:["flag-hk"]},{unified:"1F1ED-1F1F2",shortnames:["flag-hm"]},{unified:"1F1ED-1F1F3",shortnames:["flag-hn"]},{unified:"1F1ED-1F1F7",shortnames:["flag-hr"]},{unified:"1F1ED-1F1F9",shortnames:["flag-ht"]},{unified:"1F1ED-1F1FA",shortnames:["flag-hu"]},{unified:"1F1EE-1F1E8",shortnames:["flag-ic"]},{unified:"1F1EE-1F1E9",shortnames:["flag-id"]},{unified:"1F1EE-1F1EA",shortnames:["flag-ie"]},{unified:"1F1EE-1F1F1",shortnames:["flag-il"]},{unified:"1F1EE-1F1F2",shortnames:["flag-im"]},{unified:"1F1EE-1F1F3",shortnames:["flag-in"]},{unified:"1F1EE-1F1F4",shortnames:["flag-io"]},{unified:"1F1EE-1F1F6",shortnames:["flag-iq"]},{unified:"1F1EE-1F1F7",shortnames:["flag-ir"]},{unified:"1F1EE-1F1F8",shortnames:["flag-is"]},{unified:"1F1EE-1F1F9",shortnames:["it"]},{unified:"1F1EF-1F1EA",shortnames:["flag-je"]},{unified:"1F1EF-1F1F2",shortnames:["flag-jm"]},{unified:"1F1EF-1F1F4",shortnames:["flag-jo"]},{unified:"1F1EF-1F1F5",shortnames:["jp"]},{unified:"1F1F0-1F1EA",shortnames:["flag-ke"]},{unified:"1F1F0-1F1EC",shortnames:["flag-kg"]},{unified:"1F1F0-1F1ED",shortnames:["flag-kh"]},{unified:"1F1F0-1F1EE",shortnames:["flag-ki"]},{unified:"1F1F0-1F1F2",shortnames:["flag-km"]},{unified:"1F1F0-1F1F3",shortnames:["flag-kn"]},{unified:"1F1F0-1F1F5",shortnames:["flag-kp"]},{unified:"1F1F0-1F1F7",shortnames:["kr"]},{unified:"1F1F0-1F1FC",shortnames:["flag-kw"]},{unified:"1F1F0-1F1FE",shortnames:["flag-ky"]},{unified:"1F1F0-1F1FF",shortnames:["flag-kz"]},{unified:"1F1F1-1F1E6",shortnames:["flag-la"]},{unified:"1F1F1-1F1E7",shortnames:["flag-lb"]},{unified:"1F1F1-1F1E8",shortnames:["flag-lc"]},{unified:"1F1F1-1F1EE",shortnames:["flag-li"]},{unified:"1F1F1-1F1F0",shortnames:["flag-lk"]},{unified:"1F1F1-1F1F7",shortnames:["flag-lr"]},{unified:"1F1F1-1F1F8",shortnames:["flag-ls"]},{unified:"1F1F1-1F1F9",shortnames:["flag-lt"]},{unified:"1F1F1-1F1FA",shortnames:["flag-lu"]},{unified:"1F1F1-1F1FB",shortnames:["flag-lv"]},{unified:"1F1F1-1F1FE",shortnames:["flag-ly"]},{unified:"1F1F2-1F1E6",shortnames:["flag-ma"]},{unified:"1F1F2-1F1E8",shortnames:["flag-mc"]},{unified:"1F1F2-1F1E9",shortnames:["flag-md"]},{unified:"1F1F2-1F1EA",shortnames:["flag-me"]},{unified:"1F1F2-1F1EB",shortnames:["flag-mf"]},{unified:"1F1F2-1F1EC",shortnames:["flag-mg"]},{unified:"1F1F2-1F1ED",shortnames:["flag-mh"]},{unified:"1F1F2-1F1F0",shortnames:["flag-mk"]},{unified:"1F1F2-1F1F1",shortnames:["flag-ml"]},{unified:"1F1F2-1F1F2",shortnames:["flag-mm"]},{unified:"1F1F2-1F1F3",shortnames:["flag-mn"]},{unified:"1F1F2-1F1F4",shortnames:["flag-mo"]},{unified:"1F1F2-1F1F5",shortnames:["flag-mp"]},{unified:"1F1F2-1F1F6",shortnames:["flag-mq"]},{unified:"1F1F2-1F1F7",shortnames:["flag-mr"]},{unified:"1F1F2-1F1F8",shortnames:["flag-ms"]},{unified:"1F1F2-1F1F9",shortnames:["flag-mt"]},{unified:"1F1F2-1F1FA",shortnames:["flag-mu"]},{unified:"1F1F2-1F1FB",shortnames:["flag-mv"]},{unified:"1F1F2-1F1FC",shortnames:["flag-mw"]},{unified:"1F1F2-1F1FD",shortnames:["flag-mx"]},{unified:"1F1F2-1F1FE",shortnames:["flag-my"]},{unified:"1F1F2-1F1FF",shortnames:["flag-mz"]},{unified:"1F1F3-1F1E6",shortnames:["flag-na"]},{unified:"1F1F3-1F1E8",shortnames:["flag-nc"]},{unified:"1F1F3-1F1EA",shortnames:["flag-ne"]},{unified:"1F1F3-1F1EB",shortnames:["flag-nf"]},{unified:"1F1F3-1F1EC",shortnames:["flag-ng"]},{unified:"1F1F3-1F1EE",shortnames:["flag-ni"]},{unified:"1F1F3-1F1F1",shortnames:["flag-nl"]},{unified:"1F1F3-1F1F4",shortnames:["flag-no"]},{unified:"1F1F3-1F1F5",shortnames:["flag-np"]},{unified:"1F1F3-1F1F7",shortnames:["flag-nr"]},{unified:"1F1F3-1F1FA",shortnames:["flag-nu"]},{unified:"1F1F3-1F1FF",shortnames:["flag-nz"]},{unified:"1F1F4-1F1F2",shortnames:["flag-om"]},{unified:"1F1F5-1F1E6",shortnames:["flag-pa"]},{unified:"1F1F5-1F1EA",shortnames:["flag-pe"]},{unified:"1F1F5-1F1EB",shortnames:["flag-pf"]},{unified:"1F1F5-1F1EC",shortnames:["flag-pg"]},{unified:"1F1F5-1F1ED",shortnames:["flag-ph"]},{unified:"1F1F5-1F1F0",shortnames:["flag-pk"]},{unified:"1F1F5-1F1F1",shortnames:["flag-pl"]},{unified:"1F1F5-1F1F2",shortnames:["flag-pm"]},{unified:"1F1F5-1F1F3",shortnames:["flag-pn"]},{unified:"1F1F5-1F1F7",shortnames:["flag-pr"]},{unified:"1F1F5-1F1F8",shortnames:["flag-ps"]},{unified:"1F1F5-1F1F9",shortnames:["flag-pt"]},{unified:"1F1F5-1F1FC",shortnames:["flag-pw"]},{unified:"1F1F5-1F1FE",shortnames:["flag-py"]},{unified:"1F1F6-1F1E6",shortnames:["flag-qa"]},{unified:"1F1F7-1F1EA",shortnames:["flag-re"]},{unified:"1F1F7-1F1F4",shortnames:["flag-ro"]},{unified:"1F1F7-1F1F8",shortnames:["flag-rs"]},{unified:"1F1F7-1F1FA",shortnames:["ru"]},{unified:"1F1F7-1F1FC",shortnames:["flag-rw"]},{unified:"1F1F8-1F1E6",shortnames:["flag-sa"]},{unified:"1F1F8-1F1E7",shortnames:["flag-sb"]},{unified:"1F1F8-1F1E8",shortnames:["flag-sc"]},{unified:"1F1F8-1F1E9",shortnames:["flag-sd"]},{unified:"1F1F8-1F1EA",shortnames:["flag-se"]},{unified:"1F1F8-1F1EC",shortnames:["flag-sg"]},{unified:"1F1F8-1F1ED",shortnames:["flag-sh"]},{unified:"1F1F8-1F1EE",shortnames:["flag-si"]},{unified:"1F1F8-1F1EF",shortnames:["flag-sj"]},{unified:"1F1F8-1F1F0",shortnames:["flag-sk"]},{unified:"1F1F8-1F1F1",shortnames:["flag-sl"]},{unified:"1F1F8-1F1F2",shortnames:["flag-sm"]},{unified:"1F1F8-1F1F3",shortnames:["flag-sn"]},{unified:"1F1F8-1F1F4",shortnames:["flag-so"]},{unified:"1F1F8-1F1F7",shortnames:["flag-sr"]},{unified:"1F1F8-1F1F8",shortnames:["flag-ss"]},{unified:"1F1F8-1F1F9",shortnames:["flag-st"]},{unified:"1F1F8-1F1FB",shortnames:["flag-sv"]},{unified:"1F1F8-1F1FD",shortnames:["flag-sx"]},{unified:"1F1F8-1F1FE",shortnames:["flag-sy"]},{unified:"1F1F8-1F1FF",shortnames:["flag-sz"]},{unified:"1F1F9-1F1E6",shortnames:["flag-ta"]},{unified:"1F1F9-1F1E8",shortnames:["flag-tc"]},{unified:"1F1F9-1F1E9",shortnames:["flag-td"]},{unified:"1F1F9-1F1EB",shortnames:["flag-tf"]},{unified:"1F1F9-1F1EC",shortnames:["flag-tg"]},{unified:"1F1F9-1F1ED",shortnames:["flag-th"]},{unified:"1F1F9-1F1EF",shortnames:["flag-tj"]},{unified:"1F1F9-1F1F0",shortnames:["flag-tk"]},{unified:"1F1F9-1F1F1",shortnames:["flag-tl"]},{unified:"1F1F9-1F1F2",shortnames:["flag-tm"]},{unified:"1F1F9-1F1F3",shortnames:["flag-tn"]},{unified:"1F1F9-1F1F4",shortnames:["flag-to"]},{unified:"1F1F9-1F1F7",shortnames:["flag-tr"]},{unified:"1F1F9-1F1F9",shortnames:["flag-tt"]},{unified:"1F1F9-1F1FB",shortnames:["flag-tv"]},{unified:"1F1F9-1F1FC",shortnames:["flag-tw"]},{unified:"1F1F9-1F1FF",shortnames:["flag-tz"]},{unified:"1F1FA-1F1E6",shortnames:["flag-ua"]},{unified:"1F1FA-1F1EC",shortnames:["flag-ug"]},{unified:"1F1FA-1F1F2",shortnames:["flag-um"]},{unified:"1F1FA-1F1F3",shortnames:["flag-un"]},{unified:"1F1FA-1F1F8",shortnames:["us"]},{unified:"1F1FA-1F1FE",shortnames:["flag-uy"]},{unified:"1F1FA-1F1FF",shortnames:["flag-uz"]},{unified:"1F1FB-1F1E6",shortnames:["flag-va"]},{unified:"1F1FB-1F1E8",shortnames:["flag-vc"]},{unified:"1F1FB-1F1EA",shortnames:["flag-ve"]},{unified:"1F1FB-1F1EC",shortnames:["flag-vg"]},{unified:"1F1FB-1F1EE",shortnames:["flag-vi"]},{unified:"1F1FB-1F1F3",shortnames:["flag-vn"]},{unified:"1F1FB-1F1FA",shortnames:["flag-vu"]},{unified:"1F1FC-1F1EB",shortnames:["flag-wf"]},{unified:"1F1FC-1F1F8",shortnames:["flag-ws"]},{unified:"1F1FD-1F1F0",shortnames:["flag-xk"]},{unified:"1F1FE-1F1EA",shortnames:["flag-ye"]},{unified:"1F1FE-1F1F9",shortnames:["flag-yt"]},{unified:"1F1FF-1F1E6",shortnames:["flag-za"]},{unified:"1F1FF-1F1F2",shortnames:["flag-zm"]},{unified:"1F1FF-1F1FC",shortnames:["flag-zw"]},{unified:"1F3F4-E0067-E0062-E0065-E006E-E0067-E007F",shortnames:["flag-england"]},{unified:"1F3F4-E0067-E0062-E0073-E0063-E0074-E007F",shortnames:["flag-scotland"]},{unified:"1F3F4-E0067-E0062-E0077-E006C-E0073-E007F",shortnames:["flag-wales"]}]}];_exports.byShortName={hash:"0023-FE0F-20E3",keycap_star:"002A-FE0F-20E3",zero:"0030-FE0F-20E3",one:"0031-FE0F-20E3",two:"0032-FE0F-20E3",three:"0033-FE0F-20E3",four:"0034-FE0F-20E3",five:"0035-FE0F-20E3",six:"0036-FE0F-20E3",seven:"0037-FE0F-20E3",eight:"0038-FE0F-20E3",nine:"0039-FE0F-20E3",copyright:"00A9-FE0F",registered:"00AE-FE0F",mahjong:"1F004",black_joker:"1F0CF",a:"1F170-FE0F",b:"1F171-FE0F",o2:"1F17E-FE0F",parking:"1F17F-FE0F",ab:"1F18E",cl:"1F191",cool:"1F192",free:"1F193",id:"1F194",new:"1F195",ng:"1F196",ok:"1F197",sos:"1F198",up:"1F199",vs:"1F19A","flag-ac":"1F1E6-1F1E8","flag-ad":"1F1E6-1F1E9","flag-ae":"1F1E6-1F1EA","flag-af":"1F1E6-1F1EB","flag-ag":"1F1E6-1F1EC","flag-ai":"1F1E6-1F1EE","flag-al":"1F1E6-1F1F1","flag-am":"1F1E6-1F1F2","flag-ao":"1F1E6-1F1F4","flag-aq":"1F1E6-1F1F6","flag-ar":"1F1E6-1F1F7","flag-as":"1F1E6-1F1F8","flag-at":"1F1E6-1F1F9","flag-au":"1F1E6-1F1FA","flag-aw":"1F1E6-1F1FC","flag-ax":"1F1E6-1F1FD","flag-az":"1F1E6-1F1FF","flag-ba":"1F1E7-1F1E6","flag-bb":"1F1E7-1F1E7","flag-bd":"1F1E7-1F1E9","flag-be":"1F1E7-1F1EA","flag-bf":"1F1E7-1F1EB","flag-bg":"1F1E7-1F1EC","flag-bh":"1F1E7-1F1ED","flag-bi":"1F1E7-1F1EE","flag-bj":"1F1E7-1F1EF","flag-bl":"1F1E7-1F1F1","flag-bm":"1F1E7-1F1F2","flag-bn":"1F1E7-1F1F3","flag-bo":"1F1E7-1F1F4","flag-bq":"1F1E7-1F1F6","flag-br":"1F1E7-1F1F7","flag-bs":"1F1E7-1F1F8","flag-bt":"1F1E7-1F1F9","flag-bv":"1F1E7-1F1FB","flag-bw":"1F1E7-1F1FC","flag-by":"1F1E7-1F1FE","flag-bz":"1F1E7-1F1FF","flag-ca":"1F1E8-1F1E6","flag-cc":"1F1E8-1F1E8","flag-cd":"1F1E8-1F1E9","flag-cf":"1F1E8-1F1EB","flag-cg":"1F1E8-1F1EC","flag-ch":"1F1E8-1F1ED","flag-ci":"1F1E8-1F1EE","flag-ck":"1F1E8-1F1F0","flag-cl":"1F1E8-1F1F1","flag-cm":"1F1E8-1F1F2",cn:"1F1E8-1F1F3","flag-co":"1F1E8-1F1F4","flag-cp":"1F1E8-1F1F5","flag-cr":"1F1E8-1F1F7","flag-cu":"1F1E8-1F1FA","flag-cv":"1F1E8-1F1FB","flag-cw":"1F1E8-1F1FC","flag-cx":"1F1E8-1F1FD","flag-cy":"1F1E8-1F1FE","flag-cz":"1F1E8-1F1FF",de:"1F1E9-1F1EA","flag-dg":"1F1E9-1F1EC","flag-dj":"1F1E9-1F1EF","flag-dk":"1F1E9-1F1F0","flag-dm":"1F1E9-1F1F2","flag-do":"1F1E9-1F1F4","flag-dz":"1F1E9-1F1FF","flag-ea":"1F1EA-1F1E6","flag-ec":"1F1EA-1F1E8","flag-ee":"1F1EA-1F1EA","flag-eg":"1F1EA-1F1EC","flag-eh":"1F1EA-1F1ED","flag-er":"1F1EA-1F1F7",es:"1F1EA-1F1F8","flag-et":"1F1EA-1F1F9","flag-eu":"1F1EA-1F1FA","flag-fi":"1F1EB-1F1EE","flag-fj":"1F1EB-1F1EF","flag-fk":"1F1EB-1F1F0","flag-fm":"1F1EB-1F1F2","flag-fo":"1F1EB-1F1F4",fr:"1F1EB-1F1F7","flag-ga":"1F1EC-1F1E6",gb:"1F1EC-1F1E7","flag-gd":"1F1EC-1F1E9","flag-ge":"1F1EC-1F1EA","flag-gf":"1F1EC-1F1EB","flag-gg":"1F1EC-1F1EC","flag-gh":"1F1EC-1F1ED","flag-gi":"1F1EC-1F1EE","flag-gl":"1F1EC-1F1F1","flag-gm":"1F1EC-1F1F2","flag-gn":"1F1EC-1F1F3","flag-gp":"1F1EC-1F1F5","flag-gq":"1F1EC-1F1F6","flag-gr":"1F1EC-1F1F7","flag-gs":"1F1EC-1F1F8","flag-gt":"1F1EC-1F1F9","flag-gu":"1F1EC-1F1FA","flag-gw":"1F1EC-1F1FC","flag-gy":"1F1EC-1F1FE","flag-hk":"1F1ED-1F1F0","flag-hm":"1F1ED-1F1F2","flag-hn":"1F1ED-1F1F3","flag-hr":"1F1ED-1F1F7","flag-ht":"1F1ED-1F1F9","flag-hu":"1F1ED-1F1FA","flag-ic":"1F1EE-1F1E8","flag-id":"1F1EE-1F1E9","flag-ie":"1F1EE-1F1EA","flag-il":"1F1EE-1F1F1","flag-im":"1F1EE-1F1F2","flag-in":"1F1EE-1F1F3","flag-io":"1F1EE-1F1F4","flag-iq":"1F1EE-1F1F6","flag-ir":"1F1EE-1F1F7","flag-is":"1F1EE-1F1F8",it:"1F1EE-1F1F9","flag-je":"1F1EF-1F1EA","flag-jm":"1F1EF-1F1F2","flag-jo":"1F1EF-1F1F4",jp:"1F1EF-1F1F5","flag-ke":"1F1F0-1F1EA","flag-kg":"1F1F0-1F1EC","flag-kh":"1F1F0-1F1ED","flag-ki":"1F1F0-1F1EE","flag-km":"1F1F0-1F1F2","flag-kn":"1F1F0-1F1F3","flag-kp":"1F1F0-1F1F5",kr:"1F1F0-1F1F7","flag-kw":"1F1F0-1F1FC","flag-ky":"1F1F0-1F1FE","flag-kz":"1F1F0-1F1FF","flag-la":"1F1F1-1F1E6","flag-lb":"1F1F1-1F1E7","flag-lc":"1F1F1-1F1E8","flag-li":"1F1F1-1F1EE","flag-lk":"1F1F1-1F1F0","flag-lr":"1F1F1-1F1F7","flag-ls":"1F1F1-1F1F8","flag-lt":"1F1F1-1F1F9","flag-lu":"1F1F1-1F1FA","flag-lv":"1F1F1-1F1FB","flag-ly":"1F1F1-1F1FE","flag-ma":"1F1F2-1F1E6","flag-mc":"1F1F2-1F1E8","flag-md":"1F1F2-1F1E9","flag-me":"1F1F2-1F1EA","flag-mf":"1F1F2-1F1EB","flag-mg":"1F1F2-1F1EC","flag-mh":"1F1F2-1F1ED","flag-mk":"1F1F2-1F1F0","flag-ml":"1F1F2-1F1F1","flag-mm":"1F1F2-1F1F2","flag-mn":"1F1F2-1F1F3","flag-mo":"1F1F2-1F1F4","flag-mp":"1F1F2-1F1F5","flag-mq":"1F1F2-1F1F6","flag-mr":"1F1F2-1F1F7","flag-ms":"1F1F2-1F1F8","flag-mt":"1F1F2-1F1F9","flag-mu":"1F1F2-1F1FA","flag-mv":"1F1F2-1F1FB","flag-mw":"1F1F2-1F1FC","flag-mx":"1F1F2-1F1FD","flag-my":"1F1F2-1F1FE","flag-mz":"1F1F2-1F1FF","flag-na":"1F1F3-1F1E6","flag-nc":"1F1F3-1F1E8","flag-ne":"1F1F3-1F1EA","flag-nf":"1F1F3-1F1EB","flag-ng":"1F1F3-1F1EC","flag-ni":"1F1F3-1F1EE","flag-nl":"1F1F3-1F1F1","flag-no":"1F1F3-1F1F4","flag-np":"1F1F3-1F1F5","flag-nr":"1F1F3-1F1F7","flag-nu":"1F1F3-1F1FA","flag-nz":"1F1F3-1F1FF","flag-om":"1F1F4-1F1F2","flag-pa":"1F1F5-1F1E6","flag-pe":"1F1F5-1F1EA","flag-pf":"1F1F5-1F1EB","flag-pg":"1F1F5-1F1EC","flag-ph":"1F1F5-1F1ED","flag-pk":"1F1F5-1F1F0","flag-pl":"1F1F5-1F1F1","flag-pm":"1F1F5-1F1F2","flag-pn":"1F1F5-1F1F3","flag-pr":"1F1F5-1F1F7","flag-ps":"1F1F5-1F1F8","flag-pt":"1F1F5-1F1F9","flag-pw":"1F1F5-1F1FC","flag-py":"1F1F5-1F1FE","flag-qa":"1F1F6-1F1E6","flag-re":"1F1F7-1F1EA","flag-ro":"1F1F7-1F1F4","flag-rs":"1F1F7-1F1F8",ru:"1F1F7-1F1FA","flag-rw":"1F1F7-1F1FC","flag-sa":"1F1F8-1F1E6","flag-sb":"1F1F8-1F1E7","flag-sc":"1F1F8-1F1E8","flag-sd":"1F1F8-1F1E9","flag-se":"1F1F8-1F1EA","flag-sg":"1F1F8-1F1EC","flag-sh":"1F1F8-1F1ED","flag-si":"1F1F8-1F1EE","flag-sj":"1F1F8-1F1EF","flag-sk":"1F1F8-1F1F0","flag-sl":"1F1F8-1F1F1","flag-sm":"1F1F8-1F1F2","flag-sn":"1F1F8-1F1F3","flag-so":"1F1F8-1F1F4","flag-sr":"1F1F8-1F1F7","flag-ss":"1F1F8-1F1F8","flag-st":"1F1F8-1F1F9","flag-sv":"1F1F8-1F1FB","flag-sx":"1F1F8-1F1FD","flag-sy":"1F1F8-1F1FE","flag-sz":"1F1F8-1F1FF","flag-ta":"1F1F9-1F1E6","flag-tc":"1F1F9-1F1E8","flag-td":"1F1F9-1F1E9","flag-tf":"1F1F9-1F1EB","flag-tg":"1F1F9-1F1EC","flag-th":"1F1F9-1F1ED","flag-tj":"1F1F9-1F1EF","flag-tk":"1F1F9-1F1F0","flag-tl":"1F1F9-1F1F1","flag-tm":"1F1F9-1F1F2","flag-tn":"1F1F9-1F1F3","flag-to":"1F1F9-1F1F4","flag-tr":"1F1F9-1F1F7","flag-tt":"1F1F9-1F1F9","flag-tv":"1F1F9-1F1FB","flag-tw":"1F1F9-1F1FC","flag-tz":"1F1F9-1F1FF","flag-ua":"1F1FA-1F1E6","flag-ug":"1F1FA-1F1EC","flag-um":"1F1FA-1F1F2","flag-un":"1F1FA-1F1F3",us:"1F1FA-1F1F8","flag-uy":"1F1FA-1F1FE","flag-uz":"1F1FA-1F1FF","flag-va":"1F1FB-1F1E6","flag-vc":"1F1FB-1F1E8","flag-ve":"1F1FB-1F1EA","flag-vg":"1F1FB-1F1EC","flag-vi":"1F1FB-1F1EE","flag-vn":"1F1FB-1F1F3","flag-vu":"1F1FB-1F1FA","flag-wf":"1F1FC-1F1EB","flag-ws":"1F1FC-1F1F8","flag-xk":"1F1FD-1F1F0","flag-ye":"1F1FE-1F1EA","flag-yt":"1F1FE-1F1F9","flag-za":"1F1FF-1F1E6","flag-zm":"1F1FF-1F1F2","flag-zw":"1F1FF-1F1FC",koko:"1F201",sa:"1F202-FE0F",u7121:"1F21A",u6307:"1F22F",u7981:"1F232",u7a7a:"1F233",u5408:"1F234",u6e80:"1F235",u6709:"1F236",u6708:"1F237-FE0F",u7533:"1F238",u5272:"1F239",u55b6:"1F23A",ideograph_advantage:"1F250",accept:"1F251",cyclone:"1F300",foggy:"1F301",closed_umbrella:"1F302",night_with_stars:"1F303",sunrise_over_mountains:"1F304",sunrise:"1F305",city_sunset:"1F306",city_sunrise:"1F307",rainbow:"1F308",bridge_at_night:"1F309",ocean:"1F30A",volcano:"1F30B",milky_way:"1F30C",earth_africa:"1F30D",earth_americas:"1F30E",earth_asia:"1F30F",globe_with_meridians:"1F310",new_moon:"1F311",waxing_crescent_moon:"1F312",first_quarter_moon:"1F313",moon:"1F314",full_moon:"1F315",waning_gibbous_moon:"1F316",last_quarter_moon:"1F317",waning_crescent_moon:"1F318",crescent_moon:"1F319",new_moon_with_face:"1F31A",first_quarter_moon_with_face:"1F31B",last_quarter_moon_with_face:"1F31C",full_moon_with_face:"1F31D",sun_with_face:"1F31E",star2:"1F31F",stars:"1F320",thermometer:"1F321-FE0F",mostly_sunny:"1F324-FE0F",barely_sunny:"1F325-FE0F",partly_sunny_rain:"1F326-FE0F",rain_cloud:"1F327-FE0F",snow_cloud:"1F328-FE0F",lightning:"1F329-FE0F",tornado:"1F32A-FE0F",fog:"1F32B-FE0F",wind_blowing_face:"1F32C-FE0F",hotdog:"1F32D",taco:"1F32E",burrito:"1F32F",chestnut:"1F330",seedling:"1F331",evergreen_tree:"1F332",deciduous_tree:"1F333",palm_tree:"1F334",cactus:"1F335",hot_pepper:"1F336-FE0F",tulip:"1F337",cherry_blossom:"1F338",rose:"1F339",hibiscus:"1F33A",sunflower:"1F33B",blossom:"1F33C",corn:"1F33D",ear_of_rice:"1F33E",herb:"1F33F",four_leaf_clover:"1F340",maple_leaf:"1F341",fallen_leaf:"1F342",leaves:"1F343",mushroom:"1F344",tomato:"1F345",eggplant:"1F346",grapes:"1F347",melon:"1F348",watermelon:"1F349",tangerine:"1F34A",lemon:"1F34B",banana:"1F34C",pineapple:"1F34D",apple:"1F34E",green_apple:"1F34F",pear:"1F350",peach:"1F351",cherries:"1F352",strawberry:"1F353",hamburger:"1F354",pizza:"1F355",meat_on_bone:"1F356",poultry_leg:"1F357",rice_cracker:"1F358",rice_ball:"1F359",rice:"1F35A",curry:"1F35B",ramen:"1F35C",spaghetti:"1F35D",bread:"1F35E",fries:"1F35F",sweet_potato:"1F360",dango:"1F361",oden:"1F362",sushi:"1F363",fried_shrimp:"1F364",fish_cake:"1F365",icecream:"1F366",shaved_ice:"1F367",ice_cream:"1F368",doughnut:"1F369",cookie:"1F36A",chocolate_bar:"1F36B",candy:"1F36C",lollipop:"1F36D",custard:"1F36E",honey_pot:"1F36F",cake:"1F370",bento:"1F371",stew:"1F372",fried_egg:"1F373",fork_and_knife:"1F374",tea:"1F375",sake:"1F376",wine_glass:"1F377",cocktail:"1F378",tropical_drink:"1F379",beer:"1F37A",beers:"1F37B",baby_bottle:"1F37C",knife_fork_plate:"1F37D-FE0F",champagne:"1F37E",popcorn:"1F37F",ribbon:"1F380",gift:"1F381",birthday:"1F382",jack_o_lantern:"1F383",christmas_tree:"1F384",santa:"1F385",fireworks:"1F386",sparkler:"1F387",balloon:"1F388",tada:"1F389",confetti_ball:"1F38A",tanabata_tree:"1F38B",crossed_flags:"1F38C",bamboo:"1F38D",dolls:"1F38E",flags:"1F38F",wind_chime:"1F390",rice_scene:"1F391",school_satchel:"1F392",mortar_board:"1F393",medal:"1F396-FE0F",reminder_ribbon:"1F397-FE0F",studio_microphone:"1F399-FE0F",level_slider:"1F39A-FE0F",control_knobs:"1F39B-FE0F",film_frames:"1F39E-FE0F",admission_tickets:"1F39F-FE0F",carousel_horse:"1F3A0",ferris_wheel:"1F3A1",roller_coaster:"1F3A2",fishing_pole_and_fish:"1F3A3",microphone:"1F3A4",movie_camera:"1F3A5",cinema:"1F3A6",headphones:"1F3A7",art:"1F3A8",tophat:"1F3A9",circus_tent:"1F3AA",ticket:"1F3AB",clapper:"1F3AC",performing_arts:"1F3AD",video_game:"1F3AE",dart:"1F3AF",slot_machine:"1F3B0","8ball":"1F3B1",game_die:"1F3B2",bowling:"1F3B3",flower_playing_cards:"1F3B4",musical_note:"1F3B5",notes:"1F3B6",saxophone:"1F3B7",guitar:"1F3B8",musical_keyboard:"1F3B9",trumpet:"1F3BA",violin:"1F3BB",musical_score:"1F3BC",running_shirt_with_sash:"1F3BD",tennis:"1F3BE",ski:"1F3BF",basketball:"1F3C0",checkered_flag:"1F3C1",snowboarder:"1F3C2","woman-running":"1F3C3-200D-2640-FE0F","man-running":"1F3C3-200D-2642-FE0F",runner:"1F3C3-200D-2642-FE0F","woman-surfing":"1F3C4-200D-2640-FE0F","man-surfing":"1F3C4-200D-2642-FE0F",surfer:"1F3C4-200D-2642-FE0F",sports_medal:"1F3C5",trophy:"1F3C6",horse_racing:"1F3C7",football:"1F3C8",rugby_football:"1F3C9","woman-swimming":"1F3CA-200D-2640-FE0F","man-swimming":"1F3CA-200D-2642-FE0F",swimmer:"1F3CA-200D-2642-FE0F","woman-lifting-weights":"1F3CB-FE0F-200D-2640-FE0F","man-lifting-weights":"1F3CB-FE0F-200D-2642-FE0F",weight_lifter:"1F3CB-FE0F-200D-2642-FE0F","woman-golfing":"1F3CC-FE0F-200D-2640-FE0F","man-golfing":"1F3CC-FE0F-200D-2642-FE0F",golfer:"1F3CC-FE0F-200D-2642-FE0F",racing_motorcycle:"1F3CD-FE0F",racing_car:"1F3CE-FE0F",cricket_bat_and_ball:"1F3CF",volleyball:"1F3D0",field_hockey_stick_and_ball:"1F3D1",ice_hockey_stick_and_puck:"1F3D2",table_tennis_paddle_and_ball:"1F3D3",snow_capped_mountain:"1F3D4-FE0F",camping:"1F3D5-FE0F",beach_with_umbrella:"1F3D6-FE0F",building_construction:"1F3D7-FE0F",house_buildings:"1F3D8-FE0F",cityscape:"1F3D9-FE0F",derelict_house_building:"1F3DA-FE0F",classical_building:"1F3DB-FE0F",desert:"1F3DC-FE0F",desert_island:"1F3DD-FE0F",national_park:"1F3DE-FE0F",stadium:"1F3DF-FE0F",house:"1F3E0",house_with_garden:"1F3E1",office:"1F3E2",post_office:"1F3E3",european_post_office:"1F3E4",hospital:"1F3E5",bank:"1F3E6",atm:"1F3E7",hotel:"1F3E8",love_hotel:"1F3E9",convenience_store:"1F3EA",school:"1F3EB",department_store:"1F3EC",factory:"1F3ED",izakaya_lantern:"1F3EE",japanese_castle:"1F3EF",european_castle:"1F3F0","rainbow-flag":"1F3F3-FE0F-200D-1F308",waving_white_flag:"1F3F3-FE0F","flag-england":"1F3F4-E0067-E0062-E0065-E006E-E0067-E007F","flag-scotland":"1F3F4-E0067-E0062-E0073-E0063-E0074-E007F","flag-wales":"1F3F4-E0067-E0062-E0077-E006C-E0073-E007F",waving_black_flag:"1F3F4",rosette:"1F3F5-FE0F",label:"1F3F7-FE0F",badminton_racquet_and_shuttlecock:"1F3F8",bow_and_arrow:"1F3F9",amphora:"1F3FA","skin-tone-2":"1F3FB","skin-tone-3":"1F3FC","skin-tone-4":"1F3FD","skin-tone-5":"1F3FE","skin-tone-6":"1F3FF",rat:"1F400",mouse2:"1F401",ox:"1F402",water_buffalo:"1F403",cow2:"1F404",tiger2:"1F405",leopard:"1F406",rabbit2:"1F407",cat2:"1F408",dragon:"1F409",crocodile:"1F40A",whale2:"1F40B",snail:"1F40C",snake:"1F40D",racehorse:"1F40E",ram:"1F40F",goat:"1F410",sheep:"1F411",monkey:"1F412",rooster:"1F413",chicken:"1F414",dog2:"1F415",pig2:"1F416",boar:"1F417",elephant:"1F418",octopus:"1F419",shell:"1F41A",bug:"1F41B",ant:"1F41C",bee:"1F41D",beetle:"1F41E",fish:"1F41F",tropical_fish:"1F420",blowfish:"1F421",turtle:"1F422",hatching_chick:"1F423",baby_chick:"1F424",hatched_chick:"1F425",bird:"1F426",penguin:"1F427",koala:"1F428",poodle:"1F429",dromedary_camel:"1F42A",camel:"1F42B",dolphin:"1F42C",mouse:"1F42D",cow:"1F42E",tiger:"1F42F",rabbit:"1F430",cat:"1F431",dragon_face:"1F432",whale:"1F433",horse:"1F434",monkey_face:"1F435",dog:"1F436",pig:"1F437",frog:"1F438",hamster:"1F439",wolf:"1F43A",bear:"1F43B",panda_face:"1F43C",pig_nose:"1F43D",feet:"1F43E",chipmunk:"1F43F-FE0F",eyes:"1F440","eye-in-speech-bubble":"1F441-FE0F-200D-1F5E8-FE0F",eye:"1F441-FE0F",ear:"1F442",nose:"1F443",lips:"1F444",tongue:"1F445",point_up_2:"1F446",point_down:"1F447",point_left:"1F448",point_right:"1F449",facepunch:"1F44A",wave:"1F44B",ok_hand:"1F44C","+1":"1F44D","-1":"1F44E",clap:"1F44F",open_hands:"1F450",crown:"1F451",womans_hat:"1F452",eyeglasses:"1F453",necktie:"1F454",shirt:"1F455",jeans:"1F456",dress:"1F457",kimono:"1F458",bikini:"1F459",womans_clothes:"1F45A",purse:"1F45B",handbag:"1F45C",pouch:"1F45D",mans_shoe:"1F45E",athletic_shoe:"1F45F",high_heel:"1F460",sandal:"1F461",boot:"1F462",footprints:"1F463",bust_in_silhouette:"1F464",busts_in_silhouette:"1F465",boy:"1F466",girl:"1F467","male-farmer":"1F468-200D-1F33E","male-cook":"1F468-200D-1F373","male-student":"1F468-200D-1F393","male-singer":"1F468-200D-1F3A4","male-artist":"1F468-200D-1F3A8","male-teacher":"1F468-200D-1F3EB","male-factory-worker":"1F468-200D-1F3ED","man-boy-boy":"1F468-200D-1F466-200D-1F466","man-boy":"1F468-200D-1F466","man-girl-boy":"1F468-200D-1F467-200D-1F466","man-girl-girl":"1F468-200D-1F467-200D-1F467","man-girl":"1F468-200D-1F467","man-man-boy":"1F468-200D-1F468-200D-1F466","man-man-boy-boy":"1F468-200D-1F468-200D-1F466-200D-1F466","man-man-girl":"1F468-200D-1F468-200D-1F467","man-man-girl-boy":"1F468-200D-1F468-200D-1F467-200D-1F466","man-man-girl-girl":"1F468-200D-1F468-200D-1F467-200D-1F467","man-woman-boy":"1F468-200D-1F469-200D-1F466","man-woman-boy-boy":"1F468-200D-1F469-200D-1F466-200D-1F466","man-woman-girl":"1F468-200D-1F469-200D-1F467","man-woman-girl-boy":"1F468-200D-1F469-200D-1F467-200D-1F466","man-woman-girl-girl":"1F468-200D-1F469-200D-1F467-200D-1F467","male-technologist":"1F468-200D-1F4BB","male-office-worker":"1F468-200D-1F4BC","male-mechanic":"1F468-200D-1F527","male-scientist":"1F468-200D-1F52C","male-astronaut":"1F468-200D-1F680","male-firefighter":"1F468-200D-1F692","male-doctor":"1F468-200D-2695-FE0F","male-judge":"1F468-200D-2696-FE0F","male-pilot":"1F468-200D-2708-FE0F","man-heart-man":"1F468-200D-2764-FE0F-200D-1F468","man-kiss-man":"1F468-200D-2764-FE0F-200D-1F48B-200D-1F468",man:"1F468","female-farmer":"1F469-200D-1F33E","female-cook":"1F469-200D-1F373","female-student":"1F469-200D-1F393","female-singer":"1F469-200D-1F3A4","female-artist":"1F469-200D-1F3A8","female-teacher":"1F469-200D-1F3EB","female-factory-worker":"1F469-200D-1F3ED","woman-boy-boy":"1F469-200D-1F466-200D-1F466","woman-boy":"1F469-200D-1F466","woman-girl-boy":"1F469-200D-1F467-200D-1F466","woman-girl-girl":"1F469-200D-1F467-200D-1F467","woman-girl":"1F469-200D-1F467","woman-woman-boy":"1F469-200D-1F469-200D-1F466","woman-woman-boy-boy":"1F469-200D-1F469-200D-1F466-200D-1F466","woman-woman-girl":"1F469-200D-1F469-200D-1F467","woman-woman-girl-boy":"1F469-200D-1F469-200D-1F467-200D-1F466","woman-woman-girl-girl":"1F469-200D-1F469-200D-1F467-200D-1F467","female-technologist":"1F469-200D-1F4BB","female-office-worker":"1F469-200D-1F4BC","female-mechanic":"1F469-200D-1F527","female-scientist":"1F469-200D-1F52C","female-astronaut":"1F469-200D-1F680","female-firefighter":"1F469-200D-1F692","female-doctor":"1F469-200D-2695-FE0F","female-judge":"1F469-200D-2696-FE0F","female-pilot":"1F469-200D-2708-FE0F","woman-heart-man":"1F469-200D-2764-FE0F-200D-1F468","woman-heart-woman":"1F469-200D-2764-FE0F-200D-1F469","woman-kiss-man":"1F469-200D-2764-FE0F-200D-1F48B-200D-1F468","woman-kiss-woman":"1F469-200D-2764-FE0F-200D-1F48B-200D-1F469",woman:"1F469",family:"1F468-200D-1F469-200D-1F466",couple:"1F46B",two_men_holding_hands:"1F46C",two_women_holding_hands:"1F46D","female-police-officer":"1F46E-200D-2640-FE0F","male-police-officer":"1F46E-200D-2642-FE0F",cop:"1F46E-200D-2642-FE0F","woman-with-bunny-ears-partying":"1F46F-200D-2640-FE0F","man-with-bunny-ears-partying":"1F46F-200D-2642-FE0F",dancers:"1F46F-200D-2640-FE0F",bride_with_veil:"1F470","blond-haired-woman":"1F471-200D-2640-FE0F","blond-haired-man":"1F471-200D-2642-FE0F",person_with_blond_hair:"1F471-200D-2642-FE0F",man_with_gua_pi_mao:"1F472","woman-wearing-turban":"1F473-200D-2640-FE0F","man-wearing-turban":"1F473-200D-2642-FE0F",man_with_turban:"1F473-200D-2642-FE0F",older_man:"1F474",older_woman:"1F475",baby:"1F476","female-construction-worker":"1F477-200D-2640-FE0F","male-construction-worker":"1F477-200D-2642-FE0F",construction_worker:"1F477-200D-2642-FE0F",princess:"1F478",japanese_ogre:"1F479",japanese_goblin:"1F47A",ghost:"1F47B",angel:"1F47C",alien:"1F47D",space_invader:"1F47E",imp:"1F47F",skull:"1F480","woman-tipping-hand":"1F481-200D-2640-FE0F","man-tipping-hand":"1F481-200D-2642-FE0F",information_desk_person:"1F481-200D-2640-FE0F","female-guard":"1F482-200D-2640-FE0F","male-guard":"1F482-200D-2642-FE0F",guardsman:"1F482-200D-2642-FE0F",dancer:"1F483",lipstick:"1F484",nail_care:"1F485","woman-getting-massage":"1F486-200D-2640-FE0F","man-getting-massage":"1F486-200D-2642-FE0F",massage:"1F486-200D-2640-FE0F","woman-getting-haircut":"1F487-200D-2640-FE0F","man-getting-haircut":"1F487-200D-2642-FE0F",haircut:"1F487-200D-2640-FE0F",barber:"1F488",syringe:"1F489",pill:"1F48A",kiss:"1F48B",love_letter:"1F48C",ring:"1F48D",gem:"1F48E",couplekiss:"1F469-200D-2764-FE0F-200D-1F48B-200D-1F468",bouquet:"1F490",couple_with_heart:"1F469-200D-2764-FE0F-200D-1F468",wedding:"1F492",heartbeat:"1F493",broken_heart:"1F494",two_hearts:"1F495",sparkling_heart:"1F496",heartpulse:"1F497",cupid:"1F498",blue_heart:"1F499",green_heart:"1F49A",yellow_heart:"1F49B",purple_heart:"1F49C",gift_heart:"1F49D",revolving_hearts:"1F49E",heart_decoration:"1F49F",diamond_shape_with_a_dot_inside:"1F4A0",bulb:"1F4A1",anger:"1F4A2",bomb:"1F4A3",zzz:"1F4A4",boom:"1F4A5",sweat_drops:"1F4A6",droplet:"1F4A7",dash:"1F4A8",hankey:"1F4A9",muscle:"1F4AA",dizzy:"1F4AB",speech_balloon:"1F4AC",thought_balloon:"1F4AD",white_flower:"1F4AE",100:"1F4AF",moneybag:"1F4B0",currency_exchange:"1F4B1",heavy_dollar_sign:"1F4B2",credit_card:"1F4B3",yen:"1F4B4",dollar:"1F4B5",euro:"1F4B6",pound:"1F4B7",money_with_wings:"1F4B8",chart:"1F4B9",seat:"1F4BA",computer:"1F4BB",briefcase:"1F4BC",minidisc:"1F4BD",floppy_disk:"1F4BE",cd:"1F4BF",dvd:"1F4C0",file_folder:"1F4C1",open_file_folder:"1F4C2",page_with_curl:"1F4C3",page_facing_up:"1F4C4",date:"1F4C5",calendar:"1F4C6",card_index:"1F4C7",chart_with_upwards_trend:"1F4C8",chart_with_downwards_trend:"1F4C9",bar_chart:"1F4CA",clipboard:"1F4CB",pushpin:"1F4CC",round_pushpin:"1F4CD",paperclip:"1F4CE",straight_ruler:"1F4CF",triangular_ruler:"1F4D0",bookmark_tabs:"1F4D1",ledger:"1F4D2",notebook:"1F4D3",notebook_with_decorative_cover:"1F4D4",closed_book:"1F4D5",book:"1F4D6",green_book:"1F4D7",blue_book:"1F4D8",orange_book:"1F4D9",books:"1F4DA",name_badge:"1F4DB",scroll:"1F4DC",memo:"1F4DD",telephone_receiver:"1F4DE",pager:"1F4DF",fax:"1F4E0",satellite_antenna:"1F4E1",loudspeaker:"1F4E2",mega:"1F4E3",outbox_tray:"1F4E4",inbox_tray:"1F4E5",package:"1F4E6","e-mail":"1F4E7",incoming_envelope:"1F4E8",envelope_with_arrow:"1F4E9",mailbox_closed:"1F4EA",mailbox:"1F4EB",mailbox_with_mail:"1F4EC",mailbox_with_no_mail:"1F4ED",postbox:"1F4EE",postal_horn:"1F4EF",newspaper:"1F4F0",iphone:"1F4F1",calling:"1F4F2",vibration_mode:"1F4F3",mobile_phone_off:"1F4F4",no_mobile_phones:"1F4F5",signal_strength:"1F4F6",camera:"1F4F7",camera_with_flash:"1F4F8",video_camera:"1F4F9",tv:"1F4FA",radio:"1F4FB",vhs:"1F4FC",film_projector:"1F4FD-FE0F",prayer_beads:"1F4FF",twisted_rightwards_arrows:"1F500",repeat:"1F501",repeat_one:"1F502",arrows_clockwise:"1F503",arrows_counterclockwise:"1F504",low_brightness:"1F505",high_brightness:"1F506",mute:"1F507",speaker:"1F508",sound:"1F509",loud_sound:"1F50A",battery:"1F50B",electric_plug:"1F50C",mag:"1F50D",mag_right:"1F50E",lock_with_ink_pen:"1F50F",closed_lock_with_key:"1F510",key:"1F511",lock:"1F512",unlock:"1F513",bell:"1F514",no_bell:"1F515",bookmark:"1F516",link:"1F517",radio_button:"1F518",back:"1F519",end:"1F51A",on:"1F51B",soon:"1F51C",top:"1F51D",underage:"1F51E",keycap_ten:"1F51F",capital_abcd:"1F520",abcd:"1F521",1234:"1F522",symbols:"1F523",abc:"1F524",fire:"1F525",flashlight:"1F526",wrench:"1F527",hammer:"1F528",nut_and_bolt:"1F529",hocho:"1F52A",gun:"1F52B",microscope:"1F52C",telescope:"1F52D",crystal_ball:"1F52E",six_pointed_star:"1F52F",beginner:"1F530",trident:"1F531",black_square_button:"1F532",white_square_button:"1F533",red_circle:"1F534",large_blue_circle:"1F535",large_orange_diamond:"1F536",large_blue_diamond:"1F537",small_orange_diamond:"1F538",small_blue_diamond:"1F539",small_red_triangle:"1F53A",small_red_triangle_down:"1F53B",arrow_up_small:"1F53C",arrow_down_small:"1F53D",om_symbol:"1F549-FE0F",dove_of_peace:"1F54A-FE0F",kaaba:"1F54B",mosque:"1F54C",synagogue:"1F54D",menorah_with_nine_branches:"1F54E",clock1:"1F550",clock2:"1F551",clock3:"1F552",clock4:"1F553",clock5:"1F554",clock6:"1F555",clock7:"1F556",clock8:"1F557",clock9:"1F558",clock10:"1F559",clock11:"1F55A",clock12:"1F55B",clock130:"1F55C",clock230:"1F55D",clock330:"1F55E",clock430:"1F55F",clock530:"1F560",clock630:"1F561",clock730:"1F562",clock830:"1F563",clock930:"1F564",clock1030:"1F565",clock1130:"1F566",clock1230:"1F567",candle:"1F56F-FE0F",mantelpiece_clock:"1F570-FE0F",hole:"1F573-FE0F",man_in_business_suit_levitating:"1F574-FE0F","female-detective":"1F575-FE0F-200D-2640-FE0F","male-detective":"1F575-FE0F-200D-2642-FE0F",sleuth_or_spy:"1F575-FE0F-200D-2642-FE0F",dark_sunglasses:"1F576-FE0F",spider:"1F577-FE0F",spider_web:"1F578-FE0F",joystick:"1F579-FE0F",man_dancing:"1F57A",linked_paperclips:"1F587-FE0F",lower_left_ballpoint_pen:"1F58A-FE0F",lower_left_fountain_pen:"1F58B-FE0F",lower_left_paintbrush:"1F58C-FE0F",lower_left_crayon:"1F58D-FE0F",raised_hand_with_fingers_splayed:"1F590-FE0F",middle_finger:"1F595","spock-hand":"1F596",black_heart:"1F5A4",desktop_computer:"1F5A5-FE0F",printer:"1F5A8-FE0F",three_button_mouse:"1F5B1-FE0F",trackball:"1F5B2-FE0F",frame_with_picture:"1F5BC-FE0F",card_index_dividers:"1F5C2-FE0F",card_file_box:"1F5C3-FE0F",file_cabinet:"1F5C4-FE0F",wastebasket:"1F5D1-FE0F",spiral_note_pad:"1F5D2-FE0F",spiral_calendar_pad:"1F5D3-FE0F",compression:"1F5DC-FE0F",old_key:"1F5DD-FE0F",rolled_up_newspaper:"1F5DE-FE0F",dagger_knife:"1F5E1-FE0F",speaking_head_in_silhouette:"1F5E3-FE0F",left_speech_bubble:"1F5E8-FE0F",right_anger_bubble:"1F5EF-FE0F",ballot_box_with_ballot:"1F5F3-FE0F",world_map:"1F5FA-FE0F",mount_fuji:"1F5FB",tokyo_tower:"1F5FC",statue_of_liberty:"1F5FD",japan:"1F5FE",moyai:"1F5FF",grinning:"1F600",grin:"1F601",joy:"1F602",smiley:"1F603",smile:"1F604",sweat_smile:"1F605",laughing:"1F606",innocent:"1F607",smiling_imp:"1F608",wink:"1F609",blush:"1F60A",yum:"1F60B",relieved:"1F60C",heart_eyes:"1F60D",sunglasses:"1F60E",smirk:"1F60F",neutral_face:"1F610",expressionless:"1F611",unamused:"1F612",sweat:"1F613",pensive:"1F614",confused:"1F615",confounded:"1F616",kissing:"1F617",kissing_heart:"1F618",kissing_smiling_eyes:"1F619",kissing_closed_eyes:"1F61A",stuck_out_tongue:"1F61B",stuck_out_tongue_winking_eye:"1F61C",stuck_out_tongue_closed_eyes:"1F61D",disappointed:"1F61E",worried:"1F61F",angry:"1F620",rage:"1F621",cry:"1F622",persevere:"1F623",triumph:"1F624",disappointed_relieved:"1F625",frowning:"1F626",anguished:"1F627",fearful:"1F628",weary:"1F629",sleepy:"1F62A",tired_face:"1F62B",grimacing:"1F62C",sob:"1F62D",open_mouth:"1F62E",hushed:"1F62F",cold_sweat:"1F630",scream:"1F631",astonished:"1F632",flushed:"1F633",sleeping:"1F634",dizzy_face:"1F635",no_mouth:"1F636",mask:"1F637",smile_cat:"1F638",joy_cat:"1F639",smiley_cat:"1F63A",heart_eyes_cat:"1F63B",smirk_cat:"1F63C",kissing_cat:"1F63D",pouting_cat:"1F63E",crying_cat_face:"1F63F",scream_cat:"1F640",slightly_frowning_face:"1F641",slightly_smiling_face:"1F642",upside_down_face:"1F643",face_with_rolling_eyes:"1F644","woman-gesturing-no":"1F645-200D-2640-FE0F","man-gesturing-no":"1F645-200D-2642-FE0F",no_good:"1F645-200D-2640-FE0F","woman-gesturing-ok":"1F646-200D-2640-FE0F","man-gesturing-ok":"1F646-200D-2642-FE0F",ok_woman:"1F646-200D-2640-FE0F","woman-bowing":"1F647-200D-2640-FE0F","man-bowing":"1F647-200D-2642-FE0F",bow:"1F647-200D-2642-FE0F",see_no_evil:"1F648",hear_no_evil:"1F649",speak_no_evil:"1F64A","woman-raising-hand":"1F64B-200D-2640-FE0F","man-raising-hand":"1F64B-200D-2642-FE0F",raising_hand:"1F64B-200D-2640-FE0F",raised_hands:"1F64C","woman-frowning":"1F64D-200D-2640-FE0F","man-frowning":"1F64D-200D-2642-FE0F",person_frowning:"1F64D-200D-2640-FE0F","woman-pouting":"1F64E-200D-2640-FE0F","man-pouting":"1F64E-200D-2642-FE0F",person_with_pouting_face:"1F64E-200D-2640-FE0F",pray:"1F64F",rocket:"1F680",helicopter:"1F681",steam_locomotive:"1F682",railway_car:"1F683",bullettrain_side:"1F684",bullettrain_front:"1F685",train2:"1F686",metro:"1F687",light_rail:"1F688",station:"1F689",tram:"1F68A",train:"1F68B",bus:"1F68C",oncoming_bus:"1F68D",trolleybus:"1F68E",busstop:"1F68F",minibus:"1F690",ambulance:"1F691",fire_engine:"1F692",police_car:"1F693",oncoming_police_car:"1F694",taxi:"1F695",oncoming_taxi:"1F696",car:"1F697",oncoming_automobile:"1F698",blue_car:"1F699",truck:"1F69A",articulated_lorry:"1F69B",tractor:"1F69C",monorail:"1F69D",mountain_railway:"1F69E",suspension_railway:"1F69F",mountain_cableway:"1F6A0",aerial_tramway:"1F6A1",ship:"1F6A2","woman-rowing-boat":"1F6A3-200D-2640-FE0F","man-rowing-boat":"1F6A3-200D-2642-FE0F",rowboat:"1F6A3-200D-2642-FE0F",speedboat:"1F6A4",traffic_light:"1F6A5",vertical_traffic_light:"1F6A6",construction:"1F6A7",rotating_light:"1F6A8",triangular_flag_on_post:"1F6A9",door:"1F6AA",no_entry_sign:"1F6AB",smoking:"1F6AC",no_smoking:"1F6AD",put_litter_in_its_place:"1F6AE",do_not_litter:"1F6AF",potable_water:"1F6B0","non-potable_water":"1F6B1",bike:"1F6B2",no_bicycles:"1F6B3","woman-biking":"1F6B4-200D-2640-FE0F","man-biking":"1F6B4-200D-2642-FE0F",bicyclist:"1F6B4-200D-2642-FE0F","woman-mountain-biking":"1F6B5-200D-2640-FE0F","man-mountain-biking":"1F6B5-200D-2642-FE0F",mountain_bicyclist:"1F6B5-200D-2642-FE0F","woman-walking":"1F6B6-200D-2640-FE0F","man-walking":"1F6B6-200D-2642-FE0F",walking:"1F6B6-200D-2642-FE0F",no_pedestrians:"1F6B7",children_crossing:"1F6B8",mens:"1F6B9",womens:"1F6BA",restroom:"1F6BB",baby_symbol:"1F6BC",toilet:"1F6BD",wc:"1F6BE",shower:"1F6BF",bath:"1F6C0",bathtub:"1F6C1",passport_control:"1F6C2",customs:"1F6C3",baggage_claim:"1F6C4",left_luggage:"1F6C5",couch_and_lamp:"1F6CB-FE0F",sleeping_accommodation:"1F6CC",shopping_bags:"1F6CD-FE0F",bellhop_bell:"1F6CE-FE0F",bed:"1F6CF-FE0F",place_of_worship:"1F6D0",octagonal_sign:"1F6D1",shopping_trolley:"1F6D2",hammer_and_wrench:"1F6E0-FE0F",shield:"1F6E1-FE0F",oil_drum:"1F6E2-FE0F",motorway:"1F6E3-FE0F",railway_track:"1F6E4-FE0F",motor_boat:"1F6E5-FE0F",small_airplane:"1F6E9-FE0F",airplane_departure:"1F6EB",airplane_arriving:"1F6EC",satellite:"1F6F0-FE0F",passenger_ship:"1F6F3-FE0F",scooter:"1F6F4",motor_scooter:"1F6F5",canoe:"1F6F6",sled:"1F6F7",flying_saucer:"1F6F8",zipper_mouth_face:"1F910",money_mouth_face:"1F911",face_with_thermometer:"1F912",nerd_face:"1F913",thinking_face:"1F914",face_with_head_bandage:"1F915",robot_face:"1F916",hugging_face:"1F917",the_horns:"1F918",call_me_hand:"1F919",raised_back_of_hand:"1F91A","left-facing_fist":"1F91B","right-facing_fist":"1F91C",handshake:"1F91D",crossed_fingers:"1F91E",i_love_you_hand_sign:"1F91F",face_with_cowboy_hat:"1F920",clown_face:"1F921",nauseated_face:"1F922",rolling_on_the_floor_laughing:"1F923",drooling_face:"1F924",lying_face:"1F925","woman-facepalming":"1F926-200D-2640-FE0F","man-facepalming":"1F926-200D-2642-FE0F",face_palm:"1F926",sneezing_face:"1F927",face_with_raised_eyebrow:"1F928","star-struck":"1F929",zany_face:"1F92A",shushing_face:"1F92B",face_with_symbols_on_mouth:"1F92C",face_with_hand_over_mouth:"1F92D",face_vomiting:"1F92E",exploding_head:"1F92F",pregnant_woman:"1F930","breast-feeding":"1F931",palms_up_together:"1F932",selfie:"1F933",prince:"1F934",man_in_tuxedo:"1F935",mrs_claus:"1F936","woman-shrugging":"1F937-200D-2640-FE0F","man-shrugging":"1F937-200D-2642-FE0F",shrug:"1F937","woman-cartwheeling":"1F938-200D-2640-FE0F","man-cartwheeling":"1F938-200D-2642-FE0F",person_doing_cartwheel:"1F938","woman-juggling":"1F939-200D-2640-FE0F","man-juggling":"1F939-200D-2642-FE0F",juggling:"1F939",fencer:"1F93A","woman-wrestling":"1F93C-200D-2640-FE0F","man-wrestling":"1F93C-200D-2642-FE0F",wrestlers:"1F93C","woman-playing-water-polo":"1F93D-200D-2640-FE0F","man-playing-water-polo":"1F93D-200D-2642-FE0F",water_polo:"1F93D","woman-playing-handball":"1F93E-200D-2640-FE0F","man-playing-handball":"1F93E-200D-2642-FE0F",handball:"1F93E",wilted_flower:"1F940",drum_with_drumsticks:"1F941",clinking_glasses:"1F942",tumbler_glass:"1F943",spoon:"1F944",goal_net:"1F945",first_place_medal:"1F947",second_place_medal:"1F948",third_place_medal:"1F949",boxing_glove:"1F94A",martial_arts_uniform:"1F94B",curling_stone:"1F94C",croissant:"1F950",avocado:"1F951",cucumber:"1F952",bacon:"1F953",potato:"1F954",carrot:"1F955",baguette_bread:"1F956",green_salad:"1F957",shallow_pan_of_food:"1F958",stuffed_flatbread:"1F959",egg:"1F95A",glass_of_milk:"1F95B",peanuts:"1F95C",kiwifruit:"1F95D",pancakes:"1F95E",dumpling:"1F95F",fortune_cookie:"1F960",takeout_box:"1F961",chopsticks:"1F962",bowl_with_spoon:"1F963",cup_with_straw:"1F964",coconut:"1F965",broccoli:"1F966",pie:"1F967",pretzel:"1F968",cut_of_meat:"1F969",sandwich:"1F96A",canned_food:"1F96B",crab:"1F980",lion_face:"1F981",scorpion:"1F982",turkey:"1F983",unicorn_face:"1F984",eagle:"1F985",duck:"1F986",bat:"1F987",shark:"1F988",owl:"1F989",fox_face:"1F98A",butterfly:"1F98B",deer:"1F98C",gorilla:"1F98D",lizard:"1F98E",rhinoceros:"1F98F",shrimp:"1F990",squid:"1F991",giraffe_face:"1F992",zebra_face:"1F993",hedgehog:"1F994",sauropod:"1F995","t-rex":"1F996",cricket:"1F997",cheese_wedge:"1F9C0",face_with_monocle:"1F9D0",adult:"1F9D1",child:"1F9D2",older_adult:"1F9D3",bearded_person:"1F9D4",person_with_headscarf:"1F9D5",woman_in_steamy_room:"1F9D6-200D-2640-FE0F",man_in_steamy_room:"1F9D6-200D-2642-FE0F",person_in_steamy_room:"1F9D6-200D-2642-FE0F",woman_climbing:"1F9D7-200D-2640-FE0F",man_climbing:"1F9D7-200D-2642-FE0F",person_climbing:"1F9D7-200D-2640-FE0F",woman_in_lotus_position:"1F9D8-200D-2640-FE0F",man_in_lotus_position:"1F9D8-200D-2642-FE0F",person_in_lotus_position:"1F9D8-200D-2640-FE0F",female_mage:"1F9D9-200D-2640-FE0F",male_mage:"1F9D9-200D-2642-FE0F",mage:"1F9D9-200D-2640-FE0F",female_fairy:"1F9DA-200D-2640-FE0F",male_fairy:"1F9DA-200D-2642-FE0F",fairy:"1F9DA-200D-2640-FE0F",female_vampire:"1F9DB-200D-2640-FE0F",male_vampire:"1F9DB-200D-2642-FE0F",vampire:"1F9DB-200D-2640-FE0F",mermaid:"1F9DC-200D-2640-FE0F",merman:"1F9DC-200D-2642-FE0F",merperson:"1F9DC-200D-2642-FE0F",female_elf:"1F9DD-200D-2640-FE0F",male_elf:"1F9DD-200D-2642-FE0F",elf:"1F9DD-200D-2642-FE0F",female_genie:"1F9DE-200D-2640-FE0F",male_genie:"1F9DE-200D-2642-FE0F",genie:"1F9DE-200D-2642-FE0F",female_zombie:"1F9DF-200D-2640-FE0F",male_zombie:"1F9DF-200D-2642-FE0F",zombie:"1F9DF-200D-2642-FE0F",brain:"1F9E0",orange_heart:"1F9E1",billed_cap:"1F9E2",scarf:"1F9E3",gloves:"1F9E4",coat:"1F9E5",socks:"1F9E6",bangbang:"203C-FE0F",interrobang:"2049-FE0F",tm:"2122-FE0F",information_source:"2139-FE0F",left_right_arrow:"2194-FE0F",arrow_up_down:"2195-FE0F",arrow_upper_left:"2196-FE0F",arrow_upper_right:"2197-FE0F",arrow_lower_right:"2198-FE0F",arrow_lower_left:"2199-FE0F",leftwards_arrow_with_hook:"21A9-FE0F",arrow_right_hook:"21AA-FE0F",watch:"231A",hourglass:"231B",keyboard:"2328-FE0F",eject:"23CF-FE0F",fast_forward:"23E9",rewind:"23EA",arrow_double_up:"23EB",arrow_double_down:"23EC",black_right_pointing_double_triangle_with_vertical_bar:"23ED-FE0F",black_left_pointing_double_triangle_with_vertical_bar:"23EE-FE0F",black_right_pointing_triangle_with_double_vertical_bar:"23EF-FE0F",alarm_clock:"23F0",stopwatch:"23F1-FE0F",timer_clock:"23F2-FE0F",hourglass_flowing_sand:"23F3",double_vertical_bar:"23F8-FE0F",black_square_for_stop:"23F9-FE0F",black_circle_for_record:"23FA-FE0F",m:"24C2-FE0F",black_small_square:"25AA-FE0F",white_small_square:"25AB-FE0F",arrow_forward:"25B6-FE0F",arrow_backward:"25C0-FE0F",white_medium_square:"25FB-FE0F",black_medium_square:"25FC-FE0F",white_medium_small_square:"25FD",black_medium_small_square:"25FE",sunny:"2600-FE0F",cloud:"2601-FE0F",umbrella:"2602-FE0F",snowman:"2603-FE0F",comet:"2604-FE0F",phone:"260E-FE0F",ballot_box_with_check:"2611-FE0F",umbrella_with_rain_drops:"2614",coffee:"2615",shamrock:"2618-FE0F",point_up:"261D-FE0F",skull_and_crossbones:"2620-FE0F",radioactive_sign:"2622-FE0F",biohazard_sign:"2623-FE0F",orthodox_cross:"2626-FE0F",star_and_crescent:"262A-FE0F",peace_symbol:"262E-FE0F",yin_yang:"262F-FE0F",wheel_of_dharma:"2638-FE0F",white_frowning_face:"2639-FE0F",relaxed:"263A-FE0F",female_sign:"2640-FE0F",male_sign:"2642-FE0F",aries:"2648",taurus:"2649",gemini:"264A",cancer:"264B",leo:"264C",virgo:"264D",libra:"264E",scorpius:"264F",sagittarius:"2650",capricorn:"2651",aquarius:"2652",pisces:"2653",spades:"2660-FE0F",clubs:"2663-FE0F",hearts:"2665-FE0F",diamonds:"2666-FE0F",hotsprings:"2668-FE0F",recycle:"267B-FE0F",wheelchair:"267F",hammer_and_pick:"2692-FE0F",anchor:"2693",crossed_swords:"2694-FE0F",medical_symbol:"2695-FE0F",scales:"2696-FE0F",alembic:"2697-FE0F",gear:"2699-FE0F",atom_symbol:"269B-FE0F",fleur_de_lis:"269C-FE0F",warning:"26A0-FE0F",zap:"26A1",white_circle:"26AA",black_circle:"26AB",coffin:"26B0-FE0F",funeral_urn:"26B1-FE0F",soccer:"26BD",baseball:"26BE",snowman_without_snow:"26C4",partly_sunny:"26C5",thunder_cloud_and_rain:"26C8-FE0F",ophiuchus:"26CE",pick:"26CF-FE0F",helmet_with_white_cross:"26D1-FE0F",chains:"26D3-FE0F",no_entry:"26D4",shinto_shrine:"26E9-FE0F",church:"26EA",mountain:"26F0-FE0F",umbrella_on_ground:"26F1-FE0F",fountain:"26F2",golf:"26F3",ferry:"26F4-FE0F",boat:"26F5",skier:"26F7-FE0F",ice_skate:"26F8-FE0F","woman-bouncing-ball":"26F9-FE0F-200D-2640-FE0F","man-bouncing-ball":"26F9-FE0F-200D-2642-FE0F",person_with_ball:"26F9-FE0F-200D-2642-FE0F",tent:"26FA",fuelpump:"26FD",scissors:"2702-FE0F",white_check_mark:"2705",airplane:"2708-FE0F",email:"2709-FE0F",fist:"270A",hand:"270B",v:"270C-FE0F",writing_hand:"270D-FE0F",pencil2:"270F-FE0F",black_nib:"2712-FE0F",heavy_check_mark:"2714-FE0F",heavy_multiplication_x:"2716-FE0F",latin_cross:"271D-FE0F",star_of_david:"2721-FE0F",sparkles:"2728",eight_spoked_asterisk:"2733-FE0F",eight_pointed_black_star:"2734-FE0F",snowflake:"2744-FE0F",sparkle:"2747-FE0F",x:"274C",negative_squared_cross_mark:"274E",question:"2753",grey_question:"2754",grey_exclamation:"2755",exclamation:"2757",heavy_heart_exclamation_mark_ornament:"2763-FE0F",heart:"2764-FE0F",heavy_plus_sign:"2795",heavy_minus_sign:"2796",heavy_division_sign:"2797",arrow_right:"27A1-FE0F",curly_loop:"27B0",loop:"27BF",arrow_heading_up:"2934-FE0F",arrow_heading_down:"2935-FE0F",arrow_left:"2B05-FE0F",arrow_up:"2B06-FE0F",arrow_down:"2B07-FE0F",black_large_square:"2B1B",white_large_square:"2B1C",star:"2B50",o:"2B55",wavy_dash:"3030-FE0F",part_alternation_mark:"303D-FE0F",congratulations:"3297-FE0F",secret:"3299-FE0F"}}));
define("core/emoji/picker",["exports","core/localstorage","core/emoji/data","core/utils","core/str","core/templates"],(function(_exports,_localstorage,EmojiData,_utils,_str,_templates){var obj;function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||_unsupportedIterableToArray(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||_unsupportedIterableToArray(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_localstorage=(obj=_localstorage)&&obj.__esModule?obj:{default:obj},EmojiData=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(EmojiData);var _ref,_ref2,_ref7,_ref8,ROW_TYPE_EMOJI=0,ROW_TYPE_HEADER=1,SELECTORS_CATEGORY_SELECTOR='[data-action="show-category"]',SELECTORS_EMOJIS_CONTAINER='[data-region="emojis-container"]',SELECTORS_EMOJI_PREVIEW='[data-region="emoji-preview"]',SELECTORS_EMOJI_SHORT_NAME='[data-region="emoji-short-name"]',SELECTORS_ROW_CONTAINER='[data-region="row-container"]',SELECTORS_SEARCH_INPUT='[data-region="search-input"]',SELECTORS_SEARCH_RESULTS_CONTAINER='[data-region="search-results-container"]',createRowDataForCategory=function(categoryName,categoryDisplayName,emojis,totalRowCount){var rowData=[];rowData.push({index:totalRowCount+rowData.length,type:ROW_TYPE_HEADER,data:{name:categoryName,displayName:categoryDisplayName}});for(var i=0;i<emojis.length;i+=7){var rowEmojis=emojis.slice(i,i+7);rowData.push({index:totalRowCount+rowData.length,type:ROW_TYPE_EMOJI,data:rowEmojis})}return rowData},addIndexesToRowData=function(rowData){return rowData.map((function(data,index){return _objectSpread(_objectSpread({},data),{},{index:index})}))},getCategoryScrollPositionsFromRowData=function(rowData){return rowData.reduce((function(carry,row,index){return row.type===ROW_TYPE_HEADER&&(carry[row.data.name]=40*index),carry}),{})},createHeaderRow=(_ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(rowIndex,name){var context,html,temp;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return context={index:rowIndex,text:name},_context.next=3,(0,_templates.render)("core/emoji/header_row",context);case 3:return html=_context.sent,(temp=document.createElement("div")).innerHTML=html,_context.abrupt("return",temp.firstChild);case 7:case"end":return _context.stop()}}),_callee)}))),function(_x,_x2){return _ref.apply(this,arguments)}),createEmojiRow=(_ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(rowIndex,emojis){var context,html,temp;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return context={index:rowIndex,emojis:emojis.map((function(emojiData){var charCodes=emojiData.unified.split("-").map((function(code){return"0x".concat(code)})),emojiText=String.fromCodePoint.apply(null,charCodes);return{shortnames:":".concat(emojiData.shortnames.join(": :"),":"),unified:emojiData.unified,text:emojiText,spacer:!1}})),spacers:Array(7-emojis.length).fill(!0)},_context2.next=3,(0,_templates.render)("core/emoji/emoji_row",context);case 3:return html=_context2.sent,(temp=document.createElement("div")).innerHTML=html,_context2.abrupt("return",temp.firstChild);case 7:case"end":return _context2.stop()}}),_callee2)}))),function(_x3,_x4){return _ref2.apply(this,arguments)}),isEmojiElement=function(element){return null!==element.getAttribute("data-short-names")},findCategorySelectorFromElement=function findCategorySelectorFromElement(element){return element?"show-category"===element.getAttribute("data-action")?element:findCategorySelectorFromElement(element.parentElement):null},getCategorySelectorByCategoryName=function(root,name){return root.querySelector('[data-category="'.concat(name,'"]'))},getCategoryByScrollPosition=function(root,position,categoryScrollPositions){var positions=[];for(var _categoryName in position<0&&(position=0),categoryScrollPositions){var categoryPosition=categoryScrollPositions[_categoryName];positions.push([categoryPosition,_categoryName])}positions.sort((function(_ref3,_ref4){var a=_slicedToArray(_ref3,1)[0],b=_slicedToArray(_ref4,1)[0];return a<b?-1:a>b?1:0}));var _positions$reduce=positions.reduce((function(carry,candidate){var _candidate=_slicedToArray(candidate,2),categoryPosition=_candidate[0],categoryName=_candidate[1];return categoryPosition<=position?(carry.categoryName=categoryName,carry.previousPosition=carry.currentPosition,carry.currentPosition=position):null===carry.nextPosition&&(carry.nextPosition=categoryPosition),carry}),{categoryName:null,currentPosition:null,previousPosition:null,nextPosition:null}),categoryName=_positions$reduce.categoryName,previousPosition=_positions$reduce.previousPosition,nextPosition=_positions$reduce.nextPosition;return[getCategorySelectorByCategoryName(root,categoryName),previousPosition,nextPosition]},getRecentEmojis=function(){var storedData=_localstorage.default.get("moodle-recent-emojis");return storedData?JSON.parse(storedData):[]},addRecentEmoji=function(rowData,recentEmojiRowCount,newEmoji){var categoryName=rowData[0].data.name,categoryDisplayName=rowData[0].data.displayName,recentEmojis=getRecentEmojis(),newRecentEmojis=[newEmoji].concat(_toConsumableArray(recentEmojis.filter((function(emoji){return emoji.unified!=newEmoji.unified}))));newRecentEmojis=newRecentEmojis.slice(0,21);var newRecentEmojiRowData=createRowDataForCategory(categoryName,categoryDisplayName,newRecentEmojis);return function(recentEmojis){_localstorage.default.set("moodle-recent-emojis",JSON.stringify(recentEmojis))}(newRecentEmojis),[addIndexesToRowData(newRecentEmojiRowData.concat(rowData.slice(recentEmojiRowCount))),newRecentEmojiRowData.length]},getRowsToRender=function(scrollPosition,visibleRowCount,rowData){var minVisibleRow=scrollPosition>40?Math.floor(scrollPosition/40):0,start=minVisibleRow>=5?minVisibleRow-5:minVisibleRow,end=minVisibleRow+visibleRowCount+5;return rowData.slice(start,end)},createRowElement=(_ref7=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(rowData){var row;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(row=null,rowData.type!==ROW_TYPE_HEADER){_context3.next=7;break}return _context3.next=4,createHeaderRow(rowData.index,rowData.data.displayName);case 4:row=_context3.sent,_context3.next=10;break;case 7:return _context3.next=9,createEmojiRow(rowData.index,rowData.data);case 9:row=_context3.sent;case 10:return row.style.position="absolute",row.style.left=0,row.style.right=0,row.style.top="".concat(40*rowData.index,"px"),_context3.abrupt("return",row);case 15:case"end":return _context3.stop()}}),_callee3)}))),function(_x5){return _ref7.apply(this,arguments)}),doRowsMatch=function(a,b){if(a.index!==b.index)return!1;if(a.type!==b.type)return!1;if(_typeof(a.data)!=_typeof(b.data))return!1;if(a.type===ROW_TYPE_HEADER)return a.data.name===b.data.name;if(a.data.length!==b.data.length)return!1;for(var i=0;i<a.data.length;i++)if(a.data[i].unified!=b.data[i].unified)return!1;return!0},renderRows=(_ref8=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(rowContainer,currentRows,nextRows){var toAdd,toKeep,toRemove,toRemoveElements;return regeneratorRuntime.wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return toAdd=nextRows.filter((function(nextRow){return!currentRows.some((function(currentRow){return doRowsMatch(currentRow,nextRow)}))})),toKeep=currentRows.filter((function(currentRow){return nextRows.some((function(nextRow){return doRowsMatch(currentRow,nextRow)}))})),toRemove=currentRows.filter((function(currentRow){return!nextRows.some((function(nextRow){return doRowsMatch(currentRow,nextRow)}))})),toRemoveElements=toRemove.map((function(rowData){return rowContainer.querySelectorAll('[data-row="'.concat(rowData.index,'"]'))})),_context4.next=6,Promise.all(toAdd.map((function(rowData){return createRowElement(rowData)})));case 6:_context4.sent.forEach((function(row,index){for(var rowData=toAdd[index],nextRowIndex=null,i=0;i<toKeep.length;i++)if(toKeep[i].index>rowData.index){nextRowIndex=i;break}if(null!==nextRowIndex){var nextRowData=toKeep[nextRowIndex],nextRowNode=rowContainer.querySelector('[data-row="'.concat(nextRowData.index,'"]'));rowContainer.insertBefore(row,nextRowNode),toKeep.splice(nextRowIndex,0,toKeep)}else toKeep.push(rowData),rowContainer.appendChild(row)})),toRemoveElements.forEach((function(rows){for(var i=0;i<rows.length;i++){var row=rows[i];rowContainer.removeChild(row)}}));case 9:case"end":return _context4.stop()}}),_callee4)}))),function(_x6,_x7,_x8){return _ref8.apply(this,arguments)}),generateRenderRowsAtPositionFunction=function(rowContainer){var _ref9,currentRows=[],nextRows=[],rowCount=0,isRendering=!1,renderNextRows=(_ref9=_asyncToGenerator(regeneratorRuntime.mark((function _callee5(){var nextRowsToRender;return regeneratorRuntime.wrap((function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(nextRows.length){_context5.next=2;break}return _context5.abrupt("return");case 2:if(!isRendering){_context5.next=4;break}return _context5.abrupt("return");case 4:return isRendering=!0,nextRowsToRender=nextRows.slice(),nextRows=[],_context5.next=9,renderRows(rowContainer,currentRows,nextRowsToRender);case 9:currentRows=nextRowsToRender,isRendering=!1,renderNextRows();case 12:case"end":return _context5.stop()}}),_callee5)}))),function(){return _ref9.apply(this,arguments)});return function(scrollPosition,rowData){var rowLimit=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;nextRows=getRowsToRender(scrollPosition,rowLimit,rowData),renderNextRows(),rowCount!==rowData.length&&(rowContainer.style.height="".concat(40*rowData.length,"px")),rowCount=rowData.length}},showSearchResults=function(emojiContainer,searchResultsContainer){searchResultsContainer.classList.remove("hidden"),emojiContainer.classList.add("hidden")},clearSearch=function(emojiContainer,searchResultsContainer,searchInput){searchResultsContainer.classList.add("hidden"),emojiContainer.classList.remove("hidden"),searchInput.value=""},getHandleMouseEnter=function(emojiPreview,emojiShortName){return function(e){var target=e.target;isEmojiElement(target)&&(emojiShortName.textContent=target.getAttribute("data-short-names"),emojiPreview.textContent=target.textContent)}},getHandleMouseLeave=function(emojiPreview,emojiShortName){return function(e){var target=e.target;isEmojiElement(target)&&(emojiShortName.textContent="",emojiPreview.textContent="")}},getHandleScroll=function(root,currentVisibleRowScrollPosition,emojiContainer,initialCategoryScrollPositions,renderAtPosition){var _getCategoryByScrollP2=_slicedToArray(getCategoryByScrollPosition(root,emojiContainer.scrollTop,initialCategoryScrollPositions),3),currentCategoryElement=_getCategoryByScrollP2[0],previousCategoryPosition=_getCategoryByScrollP2[1],nextCategoryPosition=_getCategoryByScrollP2[2];return function(categoryScrollPositions,rowData){var newScrollPosition=emojiContainer.scrollTop,updateRenderRows=newScrollPosition<currentVisibleRowScrollPosition-40||newScrollPosition>currentVisibleRowScrollPosition+40;if(newScrollPosition>=nextCategoryPosition||newScrollPosition<previousCategoryPosition){var _getCategoryByScrollP4=_slicedToArray(getCategoryByScrollPosition(root,newScrollPosition,categoryScrollPositions),3);currentCategoryElement=_getCategoryByScrollP4[0],previousCategoryPosition=_getCategoryByScrollP4[1],nextCategoryPosition=_getCategoryByScrollP4[2],function(root,element){for(var allCategorySelectors=root.querySelectorAll(SELECTORS_CATEGORY_SELECTOR),i=0;i<allCategorySelectors.length;i++)allCategorySelectors[i].classList.remove("selected");element.classList.add("selected")}(root,currentCategoryElement)}updateRenderRows&&requestAnimationFrame((function(){renderAtPosition(newScrollPosition,rowData),currentVisibleRowScrollPosition=newScrollPosition}))}},registerEventListeners=function(root,emojiContainer,renderAtPosition,currentVisibleRowScrollPosition,selectCallback,categoryScrollPositions,rowData,recentEmojiRowCount){var searchInput=root.querySelector(SELECTORS_SEARCH_INPUT),searchResultsContainer=root.querySelector(SELECTORS_SEARCH_RESULTS_CONTAINER),emojiPreview=root.querySelector(SELECTORS_EMOJI_PREVIEW),emojiShortName=root.querySelector(SELECTORS_EMOJI_SHORT_NAME),clickHandler=function(recentEmojiRowCount,emojiContainer,searchResultsContainer,searchInput,selectCallback,renderAtPosition){return function(e,rowData,categoryScrollPositions){var target=e.target,newRowData=rowData,newCategoryScrollPositions=categoryScrollPositions;if(clearSearch(emojiContainer,searchResultsContainer,searchInput),isEmojiElement(target)){var emojiData={unified:target.getAttribute("data-unified"),shortnames:target.getAttribute("data-short-names").replace(/:/g,"").split(" ")},currentScrollTop=emojiContainer.scrollTop,isRecentEmojiRowVisible=null!==emojiContainer.querySelector('[data-row="'.concat(recentEmojiRowCount-1,'"]')),_addRecentEmoji2=_slicedToArray(addRecentEmoji(rowData,recentEmojiRowCount,emojiData),2);return newRowData=_addRecentEmoji2[0],recentEmojiRowCount=_addRecentEmoji2[1],newCategoryScrollPositions=getCategoryScrollPositionsFromRowData(newRowData),isRecentEmojiRowVisible&&renderAtPosition(currentScrollTop,newRowData),selectCallback(target.textContent),[newRowData,newCategoryScrollPositions]}var categorySelector=findCategorySelectorFromElement(target);if(categorySelector){var position=categoryScrollPositions[categorySelector.getAttribute("data-category")];emojiContainer.scrollTop=position}return[newRowData,newCategoryScrollPositions]}}(recentEmojiRowCount,emojiContainer,searchResultsContainer,searchInput,selectCallback,renderAtPosition),scrollHandler=getHandleScroll(root,currentVisibleRowScrollPosition,emojiContainer,categoryScrollPositions,renderAtPosition),searchHandler=function(searchInput,searchResultsContainer,emojiContainer){var rowContainer=searchResultsContainer.querySelector(SELECTORS_ROW_CONTAINER),renderSearchResultsAtPosition=generateRenderRowsAtPositionFunction(rowContainer);return searchResultsContainer.appendChild(rowContainer),_asyncToGenerator(regeneratorRuntime.mark((function _callee6(){var searchTerm,matchingEmojis,searchResultsString,rowData;return regeneratorRuntime.wrap((function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(!(searchTerm=searchInput.value.toLowerCase())){_context6.next=11;break}return showSearchResults(emojiContainer,searchResultsContainer),matchingEmojis=Object.keys(EmojiData.byShortName).reduce((function(carry,shortName){return shortName.includes(searchTerm)&&carry.push({shortnames:[shortName],unified:EmojiData.byShortName[shortName]}),carry}),[]),_context6.next=6,(0,_str.get_string)("searchresults","core");case 6:searchResultsString=_context6.sent,rowData=createRowDataForCategory(searchResultsString,searchResultsString,matchingEmojis,0),renderSearchResultsAtPosition(0,rowData,rowData.length),_context6.next=12;break;case 11:clearSearch(emojiContainer,searchResultsContainer,searchInput);case 12:case"end":return _context6.stop()}}),_callee6)})))}(searchInput,searchResultsContainer,emojiContainer);root.addEventListener("focus",getHandleMouseEnter(emojiPreview,emojiShortName),!0),root.addEventListener("blur",getHandleMouseLeave(emojiPreview,emojiShortName),!0),root.addEventListener("mouseenter",getHandleMouseEnter(emojiPreview,emojiShortName),!0),root.addEventListener("mouseleave",getHandleMouseLeave(emojiPreview,emojiShortName),!0),root.addEventListener("click",(function(e){var _clickHandler2=_slicedToArray(clickHandler(e,rowData,categoryScrollPositions),2);rowData=_clickHandler2[0],categoryScrollPositions=_clickHandler2[1]})),emojiContainer.addEventListener("scroll",(0,_utils.throttle)((function(){return scrollHandler(categoryScrollPositions,rowData)}),50)),searchInput.addEventListener("input",(0,_utils.debounce)(searchHandler,200))};return _exports.default=function(root,selectCallback){var emojiContainer=root.querySelector(SELECTORS_EMOJIS_CONTAINER),rowContainer=emojiContainer.querySelector(SELECTORS_ROW_CONTAINER),allData=[{name:"Recent",emojis:getRecentEmojis()}].concat(_toConsumableArray(EmojiData.byCategory)),rowData=[],recentEmojiRowCount=0;allData.forEach((function(category){var categoryDisplayName=getCategorySelectorByCategoryName(root,category.name).title,categoryRowData=createRowDataForCategory(category.name,categoryDisplayName,category.emojis,rowData.length);"Recent"===category.name&&(recentEmojiRowCount=categoryRowData.length),rowData=rowData.concat(categoryRowData)})),rowData=addIndexesToRowData(rowData);var categoryScrollPositions=getCategoryScrollPositionsFromRowData(rowData),renderAtPosition=generateRenderRowsAtPositionFunction(rowContainer);renderAtPosition(0,rowData),registerEventListeners(root,emojiContainer,renderAtPosition,0,selectCallback,categoryScrollPositions,rowData,recentEmojiRowCount)},_exports.default}));
/**
 * Expose the M.cfg global variable.
 *
 * @module     core/config
 * @class      config
 * @package    core
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      2.9
 */
define("core/config",(function(){return M.cfg}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)
/**
 * Chart base.
 *
 * @package    core
 * @copyright  2016 Frdric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @module     core/chart_base
 */}define("core/chart_base",["core/chart_series","core/chart_axis"],(function(Series,Axis){function Base(){this._series=[],this._labels=[],this._xaxes=[],this._yaxes=[],this._setDefaults()}return Base.prototype._series=null,Base.prototype._labels=null,Base.prototype._legendOptions=null,Base.prototype._title=null,Base.prototype._xaxes=null,Base.prototype._yaxes=null,Base.prototype.COLORSET=["#f3c300","#875692","#f38400","#a1caf1","#be0032","#c2b280","#7f180d","#008856","#e68fac","#0067a5"],Base.prototype._configColorSet=null,Base.prototype.TYPE=null,Base.prototype.addSeries=function(series){if(this._validateSeries(series),this._series.push(series),null===series.getColor()){var configColorSet=this.getConfigColorSet()||Base.prototype.COLORSET;series.setColor(configColorSet[this._series.length%configColorSet.length])}},Base.prototype.create=function(Klass,data){var Chart=new Klass;return Chart.setConfigColorSet(data.config_colorset),Chart.setLabels(data.labels),Chart.setTitle(data.title),data.legend_options&&Chart.setLegendOptions(data.legend_options),data.series.forEach((function(seriesData){Chart.addSeries(Series.prototype.create(seriesData))})),data.axes.x.forEach((function(axisData,i){Chart.setXAxis(Axis.prototype.create(axisData),i)})),data.axes.y.forEach((function(axisData,i){Chart.setYAxis(Axis.prototype.create(axisData),i)})),Chart},Base.prototype.__getAxis=function(xy,index,createIfNotExists){var axis,axes="x"===xy?this._xaxes:this._yaxes,setAxis=("x"===xy?this.setXAxis:this.setYAxis).bind(this);if(createIfNotExists=void 0!==createIfNotExists&&createIfNotExists,void 0===(axis=axes[index=void 0===index?0:index])){if(!createIfNotExists)throw new Error("Unknown axis.");setAxis(axis=new Axis,index)}return axis},Base.prototype.getConfigColorSet=function(){return this._configColorSet},Base.prototype.getLabels=function(){return this._labels},Base.prototype.getLegendOptions=function(){return this._legendOptions},Base.prototype.getSeries=function(){return this._series},Base.prototype.getTitle=function(){return this._title},Base.prototype.getType=function(){if(!this.TYPE)throw new Error("The TYPE property has not been set.");return this.TYPE},Base.prototype.getXAxes=function(){return this._xaxes},Base.prototype.getXAxis=function(index,createIfNotExists){return this.__getAxis("x",index,createIfNotExists)},Base.prototype.getYAxes=function(){return this._yaxes},Base.prototype.getYAxis=function(index,createIfNotExists){return this.__getAxis("y",index,createIfNotExists)},Base.prototype.setConfigColorSet=function(colorset){this._configColorSet=colorset},Base.prototype._setDefaults=function(){},Base.prototype.setLabels=function(labels){if(labels.length&&this._series.length&&this._series[0].length!=labels.length)throw new Error("Series must match label values.");this._labels=labels},Base.prototype.setLegendOptions=function(legendOptions){if("object"!==_typeof(legendOptions))throw new Error("Setting legend with non-object value:"+legendOptions);this._legendOptions=legendOptions},Base.prototype.setTitle=function(title){this._title=title},Base.prototype.setXAxis=function(axis,index){index=void 0===index?0:index,this._validateAxis("x",axis,index),this._xaxes[index]=axis},Base.prototype.setYAxis=function(axis,index){index=void 0===index?0:index,this._validateAxis("y",axis,index),this._yaxes[index]=axis},Base.prototype._validateAxis=function(xy,axis,index){if((index=void 0===index?0:index)>0&&void 0===("x"==xy?this._xaxes:this._yaxes)[index-1])throw new Error("Missing "+xy+" axis at index lower than "+index)},Base.prototype._validateSeries=function(series){if(this._series.length&&this._series[0].getCount()!=series.getCount())throw new Error("Series do not have an equal number of values.");if(this._labels.length&&this._labels.length!=series.getCount())throw new Error("Series must match label values.")},Base}));
/**
 * AJAX helper for the inline editing a value.
 *
 * This script is automatically included from template core/inplace_editable
 * It registers a click-listener on [data-inplaceeditablelink] link (the "inplace edit" icon),
 * then replaces the displayed value with an input field. On "Enter" it sends a request
 * to web service core_update_inplace_editable, which invokes the specified callback.
 * Any exception thrown by the web service (or callback) is displayed as an error popup.
 *
 * @module     core/inplace_editable
 * @package    core
 * @copyright  2016 Marina Glancy
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("core/inplace_editable",["jquery","core/ajax","core/templates","core/notification","core/str","core/config","core/url","core/form-autocomplete","core/pending"],(function($,ajax,templates,notification,str,cfg,url,autocomplete,Pending){return $("body").on("click keypress","[data-inplaceeditable] [data-inplaceeditablelink]",(function(e){if("keypress"!==e.type||13===e.keyCode){var editingEnabledPromise=new Pending("autocomplete-start-editing");e.stopImmediatePropagation(),e.preventDefault();var mainelement=$(this).closest("[data-inplaceeditable]"),updateValue=function(mainelement,value){var pendingId=[mainelement.attr("data-itemid"),mainelement.attr("data-component"),mainelement.attr("data-itemtype")].join("-"),pendingPromise=new Pending(pendingId);!function(element){element.addClass("updating");var spinner=element.find("img.spinner");spinner.length?spinner.show():(spinner=$("<img/>").attr("src",url.imageUrl("i/loading_small")).addClass("spinner").addClass("smallicon"),element.append(spinner))}(mainelement),ajax.call([{methodname:"core_update_inplace_editable",args:{itemid:mainelement.attr("data-itemid"),component:mainelement.attr("data-component"),itemtype:mainelement.attr("data-itemtype"),value:value}}])[0].then((function(data){return templates.render("core/inplace_editable",data).then((function(html,js){var oldvalue=mainelement.attr("data-value"),newelement=$(html);templates.replaceNode(mainelement,newelement,js),newelement.find("[data-inplaceeditablelink]").focus(),newelement.trigger({type:"updated",ajaxreturn:data,oldvalue:oldvalue})}))})).then((function(){return pendingPromise.resolve()})).fail((function(ex){var element,e=$.Event("updatefailed",{exception:ex,newvalue:value});(element=mainelement).removeClass("updating"),element.find("img.spinner").hide(),M.util.js_complete(pendingId),mainelement.trigger(e),e.isDefaultPrevented()||notification.exception(ex)}))},turnEditingOff=function(el){el.find("input").off(),el.find("select").off(),el.html(el.attr("data-oldcontent")),el.removeAttr("data-oldcontent"),el.removeClass("inplaceeditingon"),el.find("[data-inplaceeditablelink]").focus()},uniqueId=function uniqueId(prefix,idlength){var i,uniqid=prefix;for(i=0;i<idlength;i++)uniqid+=String(Math.floor(10*Math.random()));return 0===$("#"+uniqid).length?uniqid:uniqueId(prefix,idlength)};$("span.inplaceeditable.inplaceeditingon").each((function(){turnEditingOff($(this))})),function(el){el.addClass("inplaceeditingon"),el.attr("data-oldcontent",el.html());var type=el.attr("data-type"),options=el.attr("data-options");"toggle"===type?function(el,newvalue){turnEditingOff(el),updateValue(el,newvalue)}(el,options):"select"===type?function(el,options){var i,inputelement=$("<select></select>").attr("id",uniqueId("id_inplacevalue_",20)).addClass("custom-select"),lbl=$('<label class="accesshide">'+mainelement.attr("data-editlabel")+"</label>").attr("for",inputelement.attr("id"));for(i in options)inputelement.append($("<option>").attr("value",options[i].key).html(options[i].value));inputelement.val(el.attr("data-value")),el.html("").append(lbl).append(inputelement),inputelement.focus(),inputelement.select(),inputelement.on("keyup change focusout",(function(e){if(!cfg.behatsiterunning||"focusout"!==e.type){if("change"===e.type){var val=inputelement.val();turnEditingOff(el),updateValue(el,val)}("keyup"===e.type&&27===e.keyCode||"focusout"===e.type)&&turnEditingOff(el)}}))}(el,$.parseJSON(options)):"autocomplete"===type?function(el,args){var i,inputelement=$("<select></select>").attr("id",uniqueId("id_inplacevalue_",20)).addClass("form-autocomplete-original-select").addClass("custom-select"),lbl=$('<label class="accesshide">'+mainelement.attr("data-editlabel")+"</label>").attr("for",inputelement.attr("id")),options=args.options,attributes=args.attributes,saveelement=$('<a href="#"></a>'),cancelelement=$('<a href="#"></a>');for(i in options)inputelement.append($("<option>").attr("value",options[i].key).html(options[i].value));attributes.multiple&&inputelement.attr("multiple","true"),inputelement.val(JSON.parse(el.attr("data-value"))),str.get_string("savechanges","core").then((function(s){return templates.renderPix("e/save","core",s)})).then((function(html){saveelement.append(html)})).fail(notification.exception),str.get_string("cancel","core").then((function(s){return templates.renderPix("e/cancel","core",s)})).then((function(html){cancelelement.append(html)})).fail(notification.exception),el.html("").append(lbl).append(inputelement).append(saveelement).append(cancelelement),inputelement.focus(),inputelement.select(),autocomplete.enhance(inputelement,attributes.tags,attributes.ajax,attributes.placeholder,attributes.caseSensitive,attributes.showSuggestions,attributes.noSelectionString).then((function(){el.find("[role=combobox]").focus()})).fail(notification.exception),inputelement.on("keyup",(function(e){("keyup"===e.type&&27===e.keyCode||"focusout"===e.type)&&turnEditingOff(el)})),saveelement.on("click",(function(e){var val=JSON.stringify(inputelement.val());inputelement.empty(),turnEditingOff(el),updateValue(el,val),e.preventDefault()})),cancelelement.on("click",(function(e){inputelement.empty(),turnEditingOff(el),e.preventDefault()}))}(el,$.parseJSON(options)):function(el){str.get_string("edittitleinstructions").done((function(s){var instr=$('<span class="editinstructions">'+s+"</span>").attr("id",uniqueId("id_editinstructions_",20)),inputelement=$('<input type="text"/>').attr("id",uniqueId("id_inplacevalue_",20)).attr("value",el.attr("data-value")).attr("aria-describedby",instr.attr("id")).addClass("ignoredirty").addClass("form-control"),lbl=$('<label class="accesshide">'+mainelement.attr("data-editlabel")+"</label>").attr("for",inputelement.attr("id"));el.html("").append(instr).append(lbl).append(inputelement),inputelement.focus(),inputelement.select(),inputelement.on("keyup keypress focusout",(function(e){if(!cfg.behatsiterunning||"focusout"!==e.type){if("keypress"===e.type&&13===e.keyCode){var val=inputelement.val();turnEditingOff(el),updateValue(el,val)}("keyup"===e.type&&27===e.keyCode||"focusout"===e.type)&&turnEditingOff(el)}}))}))}(el)}(mainelement),editingEnabledPromise.resolve()}})),{}}));
define("core/notification",["exports","core/pending","core/log"],(function(_exports,_pending,_log){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.saveCancel=_exports.init=_exports.fetchNotifications=_exports.exception=_exports.default=_exports.confirm=_exports.alert=_exports.addNotification=void 0,_pending=_interopRequireDefault(_pending),_log=_interopRequireDefault(_log);var _systemImportTransformerGlobalIdentifier="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}var _ref,currentContextId=M.cfg.contextid,notificationTypes={success:"core/notification_success",info:"core/notification_info",warning:"core/notification_warning",error:"core/notification_error"},Selectors={notificationRegion:"#".concat("user-notifications"),fallbackRegionParents:["#region-main",'[role="main"]',"body"]},fetchNotifications=(_ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var Ajax;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,"function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core/ajax"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core/ajax")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core/ajax"]);case 2:return Ajax=_context.sent,_context.abrupt("return",Ajax.call([{methodname:"core_fetch_notifications",args:{contextid:currentContextId}}])[0].then(addNotifications));case 4:case"end":return _context.stop()}}),_callee)}))),function(){return _ref.apply(this,arguments)});_exports.fetchNotifications=fetchNotifications;var addNotifications=function(notifications){if(!notifications.length)return Promise.resolve();var pendingPromise=new _pending.default("core/notification:addNotifications");return notifications.forEach((function(notification){return renderNotification(notification.template,notification.variables)})),pendingPromise.resolve()},addNotification=function(notification){var pendingPromise=new _pending.default("core/notification:addNotifications"),template=notificationTypes.error;return notification=function(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}({closebutton:!0,announce:!0,type:"error"},notification),notification.template?(template=notification.template,delete notification.template):notification.type&&(void 0!==notificationTypes[notification.type]&&(template=notificationTypes[notification.type]),delete notification.type),renderNotification(template,notification).then(pendingPromise.resolve)};_exports.addNotification=addNotification;var _ref2,_ref4,renderNotification=(_ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(template,variables){var pendingPromise,Templates;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(void 0!==variables.message&&variables.message){_context2.next=3;break}return _log.default.debug("Notification received without content. Skipping."),_context2.abrupt("return");case 3:return pendingPromise=new _pending.default("core/notification:renderNotification"),_context2.next=6,"function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core/templates"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core/templates")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core/templates"]);case 6:(Templates=_context2.sent).renderForPromise(template,variables).then((function(_ref3){var html=_ref3.html,_ref3$js=_ref3.js,js=void 0===_ref3$js?"":_ref3$js;Templates.prependNodeContents(getNotificationRegion(),html,js)})).then(pendingPromise.resolve).catch(exception);case 8:case"end":return _context2.stop()}}),_callee2)}))),function(_x,_x2){return _ref2.apply(this,arguments)}),getNotificationRegion=function(){return document.querySelector(Selectors.notificationRegion)},alert=(_ref4=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(title,message,cancelText){var pendingPromise,ModalFactory;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return pendingPromise=new _pending.default("core/notification:alert"),_context3.next=3,"function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core/modal_factory"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core/modal_factory")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core/modal_factory"]);case 3:return ModalFactory=_context3.sent,_context3.abrupt("return",ModalFactory.create({type:ModalFactory.types.ALERT,body:message,title:title,buttons:{cancel:cancelText},removeOnClose:!0}).then((function(modal){return modal.show(),pendingPromise.resolve(),modal})));case 5:case"end":return _context3.stop()}}),_callee3)}))),function(_x3,_x4,_x5){return _ref4.apply(this,arguments)});_exports.alert=alert;var confirm=function(title,question,saveLabel,noLabel,saveCallback,cancelCallback){return saveCancel(title,question,saveLabel,saveCallback,cancelCallback)};_exports.confirm=confirm;var _ref5,saveCancel=(_ref5=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(title,question,saveLabel,saveCallback,cancelCallback){var pendingPromise,_yield$Promise$all,_yield$Promise$all2,ModalFactory,ModalEvents;return regeneratorRuntime.wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return pendingPromise=new _pending.default("core/notification:confirm"),_context4.next=3,Promise.all(["function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core/modal_factory"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core/modal_factory")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core/modal_factory"]),"function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core/modal_events"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core/modal_events")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core/modal_events"])]);case 3:return _yield$Promise$all=_context4.sent,_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2),ModalFactory=_yield$Promise$all2[0],ModalEvents=_yield$Promise$all2[1],_context4.abrupt("return",ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:title,body:question,buttons:{save:saveLabel},removeOnClose:!0}).then((function(modal){return modal.show(),modal.getRoot().on(ModalEvents.save,saveCallback),modal.getRoot().on(ModalEvents.cancel,cancelCallback),pendingPromise.resolve(),modal})));case 8:case"end":return _context4.stop()}}),_callee4)}))),function(_x6,_x7,_x8,_x9,_x10){return _ref5.apply(this,arguments)});_exports.saveCancel=saveCancel;var _ref6,exception=(_ref6=_asyncToGenerator(regeneratorRuntime.mark((function _callee5(ex){var pendingPromise,ln,fn;return regeneratorRuntime.wrap((function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return pendingPromise=new _pending.default("core/notification:displayException"),ex.stack||(ex.stack=""),ex.debuginfo&&(ex.stack+=ex.debuginfo+"\n"),!ex.backtrace&&ex.stacktrace&&(ex.backtrace=ex.stacktrace),ex.backtrace&&(ex.stack+=ex.backtrace,ln=ex.backtrace.match(/line ([^ ]*) of/),fn=ex.backtrace.match(/ of ([^:]*): /),ln&&ln[1]&&(ex.lineNumber=ln[1]),fn&&fn[1]&&(ex.fileName=fn[1],ex.fileName.length>30&&(ex.fileName="..."+ex.fileName.substr(ex.fileName.length-27)))),void 0===ex.name&&ex.errorcode&&(ex.name=ex.errorcode),_context5.next=8,"function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core/yui"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core/yui")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core/yui"]);case 8:_context5.sent.use("moodle-core-notification-exception",(function(){new M.core.exception(ex).show(),pendingPromise.resolve()}));case 10:case"end":return _context5.stop()}}),_callee5)}))),function(_x11){return _ref6.apply(this,arguments)});_exports.exception=exception;var init=function(contextId,notificationList,userLoggedIn){currentContextId=contextId,function(){if(getNotificationRegion())return!1;var newRegion=document.createElement("span");newRegion.id="user-notifications",Selectors.fallbackRegionParents.some((function(selector){var targetRegion=document.querySelector(selector);return!!targetRegion&&(targetRegion.prepend(newRegion),!0)}))}(),addNotifications(notificationList),userLoggedIn&&fetchNotifications()};_exports.init=init;var _default={init:init,fetchNotifications:fetchNotifications,addNotification:addNotification,alert:alert,confirm:confirm,saveCancel:saveCancel,exception:exception};return _exports.default=_default,_exports.default}));
/*
 * JavaScript to provide automatic scrolling, e.g. during a drag operation.
 *
 * Note: this module is defined statically. It is a singleton. You
 * can only have one use of it active at any time. However, since this
 * is usually used in relation to drag-drop, and since you only ever
 * drag one thing at a time, this is not a problem in practice.
 *
 * @module     core/autoscroll
 * @class      autoscroll
 * @package    core
 * @copyright  2016 The Open University
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.6
 */
define("core/autoscroll",["jquery"],(function($){var autoscroll={SCROLL_THRESHOLD:30,SCROLL_FREQUENCY:1e3/60,SCROLL_SPEED:.5,scrollingId:null,scrollAmount:0,callback:null,start:function(callback){$(window).on("mousemove",autoscroll.mouseMove),$(window).on("touchmove",autoscroll.touchMove),autoscroll.callback=callback},stop:function(){$(window).off("mousemove",autoscroll.mouseMove),$(window).off("touchmove",autoscroll.touchMove),null!==autoscroll.scrollingId&&autoscroll.stopScrolling()},touchMove:function(e){for(var i=0;i<e.changedTouches.length;i++)autoscroll.handleMove(e.changedTouches[i].clientX,e.changedTouches[i].clientY)},mouseMove:function(e){autoscroll.handleMove(e.clientX,e.clientY)},handleMove:function(clientX,clientY){clientY<autoscroll.SCROLL_THRESHOLD?autoscroll.scrollAmount=-Math.min(autoscroll.SCROLL_THRESHOLD-clientY,autoscroll.SCROLL_THRESHOLD):clientY>$(window).height()-autoscroll.SCROLL_THRESHOLD?autoscroll.scrollAmount=Math.min(clientY-($(window).height()-autoscroll.SCROLL_THRESHOLD),autoscroll.SCROLL_THRESHOLD):autoscroll.scrollAmount=0,autoscroll.scrollAmount&&null===autoscroll.scrollingId?autoscroll.startScrolling():autoscroll.scrollAmount||null===autoscroll.scrollingId||autoscroll.stopScrolling()},startScrolling:function(){var maxScroll=$(document).height()-$(window).height();autoscroll.scrollingId=window.setInterval((function(){var y=$(window).scrollTop(),offset=Math.round(autoscroll.scrollAmount*autoscroll.SCROLL_SPEED);if(y+offset<0&&(offset=-y),y+offset>maxScroll&&(offset=maxScroll-y),0!==offset){$(window).scrollTop(y+offset);var realOffset=$(window).scrollTop()-y;0!==realOffset&&autoscroll.callback&&autoscroll.callback(realOffset)}}),autoscroll.SCROLL_FREQUENCY)},stopScrolling:function(){window.clearInterval(autoscroll.scrollingId),autoscroll.scrollingId=null}};return{start:autoscroll.start,stop:autoscroll.stop}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core/drawer",["exports","jquery","core/pubsub","core/drawer_events"],(function(_exports,_jquery,PubSub,_drawer_events){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Controls the drawer.
   *
   * @module     core/drawer
   * @copyright  2019 Jun Pataleta <jun@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),PubSub=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(PubSub),_drawer_events=_interopRequireDefault(_drawer_events);var show=function(root){root.removeClass("hidden"),root.attr("aria-expanded",!0),root.removeAttr("aria-hidden"),root.focus(),PubSub.publish(_drawer_events.default.DRAWER_SHOWN,root)},hide=function(root){root.addClass("hidden"),root.attr("aria-expanded",!1),root.attr("aria-hidden",!0),PubSub.publish(_drawer_events.default.DRAWER_HIDDEN,root)},isVisible=function(root){return!root.hasClass("hidden")},toggle=function(root){isVisible(root)?hide(root):show(root)},_default={hide:hide,show:show,isVisible:isVisible,toggle:toggle,registerToggles:function(root,toggleElements){var openTrigger=null;toggleElements.attr("aria-expanded",isVisible(root)),toggleElements.on("click",(function(e){e.preventDefault();var wasVisible=isVisible(root);toggle(root),toggleElements.attr("aria-expanded",!wasVisible),wasVisible?openTrigger&&(openTrigger.focus(),openTrigger=null):openTrigger=toggleElements.filter((function(index,element){return element==e.target||element.contains(e.target)}))}))},getDrawerRoot:function(contentRoot){return(contentRoot=(0,_jquery.default)(contentRoot)).closest('[data-region="right-hand-drawer"]')}};return _exports.default=_default,_exports.default}));
/**
 * Show/hide admin settings based on other settings selected
 *
 * @package core
 * @copyright 2018 Davo Smith, Synergy Learning
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/showhidesettings",["jquery"],(function($){var dependencies;function isCheckboxHiddenElement($el){return $el.is("input[type=hidden]")&&$el.siblings('input[type=checkbox][name="'+$el.attr("name")+'"]').length}function isCheckedRelevant($el,value){return!isCheckboxHiddenElement($el)&&!function($el,value){return $el.is("input[type=radio]")&&$el.attr("value")!==value}($el,value)}function isUncheckedRadioButton($el){return $el.is("input[type=radio]")&&!$el.prop("checked")}function isUncheckedCheckbox($el){return $el.is("input[type=checkbox]")&&!$el.prop("checked")}function isMultiSelect($el){return $el.is("select")&&$el.prop("multiple")}function multiSelectMatches($el,values){var selected=$el.val()||[];if(!values.length)return!1;if(selected.length!==values.length)return!1;for(var i in selected)if(selected.hasOwnProperty(i)&&-1===values.indexOf(selected[i]))return!1;return!0}var depFns={notchecked:function($dependon,value){var hide=!1;return value=String(value),$dependon.each((function(idx,el){var $el=$(el);isCheckedRelevant($el,value)&&(hide=hide||!$el.prop("checked"))})),hide},checked:function($dependon,value){var hide=!1;return value=String(value),$dependon.each((function(idx,el){var $el=$(el);isCheckedRelevant($el,value)&&(hide=hide||$el.prop("checked"))})),hide},noitemselected:function($dependon){var hide=!1;return $dependon.each((function(idx,el){var $el=$(el);hide=hide||-1===$el.prop("selectedIndex")})),hide},eq:function($dependon,value){var hide=!1,hiddenVal=!1;return value=String(value),$dependon.each((function(idx,el){var $el=$(el);if(!isUncheckedRadioButton($el))if(isCheckboxHiddenElement($el))hiddenVal=$el.val()===value;else if(isUncheckedCheckbox($el))hide=hide||hiddenVal;else if(isMultiSelect($el)){var values=value.split("|");hide=multiSelectMatches($el,values)}else hide=hide||$el.val()===value})),hide},in:function($dependon,value){var hide=!1,hiddenVal=!1,values=value.split("|");return $dependon.each((function(idx,el){var $el=$(el);isUncheckedRadioButton($el)||(isCheckboxHiddenElement($el)?hiddenVal=values.indexOf($el.val())>-1:hide=isUncheckedCheckbox($el)?hide||hiddenVal:isMultiSelect($el)?multiSelectMatches($el,values):hide||values.indexOf($el.val())>-1)})),hide},defaultCondition:function($dependon,value){var hide=!1,hiddenVal=!1;return value=String(value),$dependon.each((function(idx,el){var $el=$(el);if(!isUncheckedRadioButton($el))if(isCheckboxHiddenElement($el))hiddenVal=$el.val()!==value;else if(isUncheckedCheckbox($el))hide=hide||hiddenVal;else if(isMultiSelect($el)){var values=value.split("|");hide=!multiSelectMatches($el,values)}else hide=hide||$el.val()!==value})),hide}};function getElementsByName(name){return $('[name="'+name+'"],[name^="'+name+'["]')}function updateDependencies(){var toHide={};$.each(dependencies,(function(dependonname){var dependon=getElementsByName(dependonname);$.each(dependencies[dependonname],(function(condition,values){$.each(values,(function(value,elements){var hide=function($dependon,condition,value){return"function"==typeof depFns[condition]?depFns[condition]($dependon,value):depFns.defaultCondition($dependon,value)}(dependon,condition,value);$.each(elements,(function(idx,elToHide){toHide.hasOwnProperty(elToHide)?toHide[elToHide]=toHide[elToHide]||hide:toHide[elToHide]=hide}))}))}))})),$.each(toHide,(function(elToHide,hide){getElementsByName(elToHide).each((function(idx,el){var $parent=$(el).closest(".form-item");$parent.length&&(hide?$parent.hide():$parent.show())}))}))}return{init:function(opts){dependencies=opts.dependencies,$.each(dependencies,(function(depname){var $el=getElementsByName(depname);$el.length&&$el.on("change",updateDependencies)})),updateDependencies(),$(".form-dependenton").hide()}}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)
/**!
 * @fileOverview Kickass library to create and place poppers near their reference elements.
 * @version 1.12.6
 * @license
 * Copyright (c) 2016 Federico Zivolo and contributors
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */}!function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define("core/popper",factory):global.Popper=factory()}(window,(function(){for(var isBrowser="undefined"!=typeof window&&void 0!==window.document,longerTimeoutBrowsers=["Edge","Trident","Firefox"],timeoutDuration=0,i=0;i<longerTimeoutBrowsers.length;i+=1)if(isBrowser&&navigator.userAgent.indexOf(longerTimeoutBrowsers[i])>=0){timeoutDuration=1;break}var debounce=isBrowser&&window.Promise?function(fn){var called=!1;return function(){called||(called=!0,Promise.resolve().then((function(){called=!1,fn()})))}}:function(fn){var scheduled=!1;return function(){scheduled||(scheduled=!0,setTimeout((function(){scheduled=!1,fn()}),timeoutDuration))}};function isFunction(functionToCheck){return functionToCheck&&"[object Function]"==={}.toString.call(functionToCheck)}function getStyleComputedProperty(element,property){if(1!==element.nodeType)return[];var css=window.getComputedStyle(element,null);return property?css[property]:css}function getParentNode(element){return"HTML"===element.nodeName?element:element.parentNode||element.host}function getScrollParent(element){if(!element)return window.document.body;switch(element.nodeName){case"HTML":case"BODY":return element.ownerDocument.body;case"#document":return element.body}var _getStyleComputedProp=getStyleComputedProperty(element),overflow=_getStyleComputedProp.overflow,overflowX=_getStyleComputedProp.overflowX,overflowY=_getStyleComputedProp.overflowY;return/(auto|scroll)/.test(overflow+overflowY+overflowX)?element:getScrollParent(getParentNode(element))}function getOffsetParent(element){var offsetParent=element&&element.offsetParent,nodeName=offsetParent&&offsetParent.nodeName;return nodeName&&"BODY"!==nodeName&&"HTML"!==nodeName?-1!==["TD","TABLE"].indexOf(offsetParent.nodeName)&&"static"===getStyleComputedProperty(offsetParent,"position")?getOffsetParent(offsetParent):offsetParent:element?element.ownerDocument.documentElement:window.document.documentElement}function getRoot(node){return null!==node.parentNode?getRoot(node.parentNode):node}function findCommonOffsetParent(element1,element2){if(!(element1&&element1.nodeType&&element2&&element2.nodeType))return window.document.documentElement;var order=element1.compareDocumentPosition(element2)&Node.DOCUMENT_POSITION_FOLLOWING,start=order?element1:element2,end=order?element2:element1,range=document.createRange();range.setStart(start,0),range.setEnd(end,0);var element,nodeName,commonAncestorContainer=range.commonAncestorContainer;if(element1!==commonAncestorContainer&&element2!==commonAncestorContainer||start.contains(end))return"BODY"===(nodeName=(element=commonAncestorContainer).nodeName)||"HTML"!==nodeName&&getOffsetParent(element.firstElementChild)!==element?getOffsetParent(commonAncestorContainer):commonAncestorContainer;var element1root=getRoot(element1);return element1root.host?findCommonOffsetParent(element1root.host,element2):findCommonOffsetParent(element1,getRoot(element2).host)}function getScroll(element){var side=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"top",upperSide="top"===side?"scrollTop":"scrollLeft",nodeName=element.nodeName;if("BODY"===nodeName||"HTML"===nodeName){var html=element.ownerDocument.documentElement,scrollingElement=element.ownerDocument.scrollingElement||html;return scrollingElement[upperSide]}return element[upperSide]}function getBordersSize(styles,axis){var sideA="x"===axis?"Left":"Top",sideB="Left"===sideA?"Right":"Bottom";return+styles["border"+sideA+"Width"].split("px")[0]+ +styles["border"+sideB+"Width"].split("px")[0]}var isIE10=void 0,isIE10$1=function(){return void 0===isIE10&&(isIE10=-1!==navigator.appVersion.indexOf("MSIE 10")),isIE10};function getSize(axis,body,html,computedStyle){return Math.max(body["offset"+axis],body["scroll"+axis],html["client"+axis],html["offset"+axis],html["scroll"+axis],isIE10$1()?html["offset"+axis]+computedStyle["margin"+("Height"===axis?"Top":"Left")]+computedStyle["margin"+("Height"===axis?"Bottom":"Right")]:0)}function getWindowSizes(){var body=window.document.body,html=window.document.documentElement,computedStyle=isIE10$1()&&window.getComputedStyle(html);return{height:getSize("Height",body,html,computedStyle),width:getSize("Width",body,html,computedStyle)}}var classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),defineProperty=function(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj},_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};function getClientRect(offsets){return _extends({},offsets,{right:offsets.left+offsets.width,bottom:offsets.top+offsets.height})}function getBoundingClientRect(element){var rect={};if(isIE10$1())try{rect=element.getBoundingClientRect();var scrollTop=getScroll(element,"top"),scrollLeft=getScroll(element,"left");rect.top+=scrollTop,rect.left+=scrollLeft,rect.bottom+=scrollTop,rect.right+=scrollLeft}catch(err){}else rect=element.getBoundingClientRect();var result={left:rect.left,top:rect.top,width:rect.right-rect.left,height:rect.bottom-rect.top},sizes="HTML"===element.nodeName?getWindowSizes():{},width=sizes.width||element.clientWidth||result.right-result.left,height=sizes.height||element.clientHeight||result.bottom-result.top,horizScrollbar=element.offsetWidth-width,vertScrollbar=element.offsetHeight-height;if(horizScrollbar||vertScrollbar){var styles=getStyleComputedProperty(element);horizScrollbar-=getBordersSize(styles,"x"),vertScrollbar-=getBordersSize(styles,"y"),result.width-=horizScrollbar,result.height-=vertScrollbar}return getClientRect(result)}function getOffsetRectRelativeToArbitraryNode(children,parent){var isIE10=isIE10$1(),isHTML="HTML"===parent.nodeName,childrenRect=getBoundingClientRect(children),parentRect=getBoundingClientRect(parent),scrollParent=getScrollParent(children),styles=getStyleComputedProperty(parent),borderTopWidth=+styles.borderTopWidth.split("px")[0],borderLeftWidth=+styles.borderLeftWidth.split("px")[0],offsets=getClientRect({top:childrenRect.top-parentRect.top-borderTopWidth,left:childrenRect.left-parentRect.left-borderLeftWidth,width:childrenRect.width,height:childrenRect.height});if(offsets.marginTop=0,offsets.marginLeft=0,!isIE10&&isHTML){var marginTop=+styles.marginTop.split("px")[0],marginLeft=+styles.marginLeft.split("px")[0];offsets.top-=borderTopWidth-marginTop,offsets.bottom-=borderTopWidth-marginTop,offsets.left-=borderLeftWidth-marginLeft,offsets.right-=borderLeftWidth-marginLeft,offsets.marginTop=marginTop,offsets.marginLeft=marginLeft}return(isIE10?parent.contains(scrollParent):parent===scrollParent&&"BODY"!==scrollParent.nodeName)&&(offsets=function(rect,element){var subtract=arguments.length>2&&void 0!==arguments[2]&&arguments[2],scrollTop=getScroll(element,"top"),scrollLeft=getScroll(element,"left"),modifier=subtract?-1:1;return rect.top+=scrollTop*modifier,rect.bottom+=scrollTop*modifier,rect.left+=scrollLeft*modifier,rect.right+=scrollLeft*modifier,rect}(offsets,parent)),offsets}function isFixed(element){var nodeName=element.nodeName;return"BODY"!==nodeName&&"HTML"!==nodeName&&("fixed"===getStyleComputedProperty(element,"position")||isFixed(getParentNode(element)))}function getBoundaries(popper,reference,padding,boundariesElement){var boundaries={top:0,left:0},offsetParent=findCommonOffsetParent(popper,reference);if("viewport"===boundariesElement)boundaries=function(element){var html=element.ownerDocument.documentElement,relativeOffset=getOffsetRectRelativeToArbitraryNode(element,html),width=Math.max(html.clientWidth,window.innerWidth||0),height=Math.max(html.clientHeight,window.innerHeight||0),scrollTop=getScroll(html),scrollLeft=getScroll(html,"left");return getClientRect({top:scrollTop-relativeOffset.top+relativeOffset.marginTop,left:scrollLeft-relativeOffset.left+relativeOffset.marginLeft,width:width,height:height})}(offsetParent);else{var boundariesNode=void 0;"scrollParent"===boundariesElement?"BODY"===(boundariesNode=getScrollParent(getParentNode(popper))).nodeName&&(boundariesNode=popper.ownerDocument.documentElement):boundariesNode="window"===boundariesElement?popper.ownerDocument.documentElement:boundariesElement;var offsets=getOffsetRectRelativeToArbitraryNode(boundariesNode,offsetParent);if("HTML"!==boundariesNode.nodeName||isFixed(offsetParent))boundaries=offsets;else{var _getWindowSizes=getWindowSizes(),height=_getWindowSizes.height,width=_getWindowSizes.width;boundaries.top+=offsets.top-offsets.marginTop,boundaries.bottom=height+offsets.top,boundaries.left+=offsets.left-offsets.marginLeft,boundaries.right=width+offsets.left}}return boundaries.left+=padding,boundaries.top+=padding,boundaries.right-=padding,boundaries.bottom-=padding,boundaries}function getArea(_ref){return _ref.width*_ref.height}function computeAutoPlacement(placement,refRect,popper,reference,boundariesElement){var padding=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(-1===placement.indexOf("auto"))return placement;var boundaries=getBoundaries(popper,reference,padding,boundariesElement),rects={top:{width:boundaries.width,height:refRect.top-boundaries.top},right:{width:boundaries.right-refRect.right,height:boundaries.height},bottom:{width:boundaries.width,height:boundaries.bottom-refRect.bottom},left:{width:refRect.left-boundaries.left,height:boundaries.height}},sortedAreas=Object.keys(rects).map((function(key){return _extends({key:key},rects[key],{area:getArea(rects[key])})})).sort((function(a,b){return b.area-a.area})),filteredAreas=sortedAreas.filter((function(_ref2){var width=_ref2.width,height=_ref2.height;return width>=popper.clientWidth&&height>=popper.clientHeight})),computedPlacement=filteredAreas.length>0?filteredAreas[0].key:sortedAreas[0].key,variation=placement.split("-")[1];return computedPlacement+(variation?"-"+variation:"")}function getReferenceOffsets(state,popper,reference){return getOffsetRectRelativeToArbitraryNode(reference,findCommonOffsetParent(popper,reference))}function getOuterSizes(element){var styles=window.getComputedStyle(element),x=parseFloat(styles.marginTop)+parseFloat(styles.marginBottom),y=parseFloat(styles.marginLeft)+parseFloat(styles.marginRight);return{width:element.offsetWidth+y,height:element.offsetHeight+x}}function getOppositePlacement(placement){var hash={left:"right",right:"left",bottom:"top",top:"bottom"};return placement.replace(/left|right|bottom|top/g,(function(matched){return hash[matched]}))}function getPopperOffsets(popper,referenceOffsets,placement){placement=placement.split("-")[0];var popperRect=getOuterSizes(popper),popperOffsets={width:popperRect.width,height:popperRect.height},isHoriz=-1!==["right","left"].indexOf(placement),mainSide=isHoriz?"top":"left",secondarySide=isHoriz?"left":"top",measurement=isHoriz?"height":"width",secondaryMeasurement=isHoriz?"width":"height";return popperOffsets[mainSide]=referenceOffsets[mainSide]+referenceOffsets[measurement]/2-popperRect[measurement]/2,popperOffsets[secondarySide]=placement===secondarySide?referenceOffsets[secondarySide]-popperRect[secondaryMeasurement]:referenceOffsets[getOppositePlacement(secondarySide)],popperOffsets}function find(arr,check){return Array.prototype.find?arr.find(check):arr.filter(check)[0]}function runModifiers(modifiers,data,ends){return(void 0===ends?modifiers:modifiers.slice(0,function(arr,prop,value){if(Array.prototype.findIndex)return arr.findIndex((function(cur){return cur[prop]===value}));var match=find(arr,(function(obj){return obj[prop]===value}));return arr.indexOf(match)}(modifiers,"name",ends))).forEach((function(modifier){modifier.function&&console.warn("`modifier.function` is deprecated, use `modifier.fn`!");var fn=modifier.function||modifier.fn;modifier.enabled&&isFunction(fn)&&(data.offsets.popper=getClientRect(data.offsets.popper),data.offsets.reference=getClientRect(data.offsets.reference),data=fn(data,modifier))})),data}function update(){if(!this.state.isDestroyed){var data={instance:this,styles:{},arrowStyles:{},attributes:{},flipped:!1,offsets:{}};data.offsets.reference=getReferenceOffsets(this.state,this.popper,this.reference),data.placement=computeAutoPlacement(this.options.placement,data.offsets.reference,this.popper,this.reference,this.options.modifiers.flip.boundariesElement,this.options.modifiers.flip.padding),data.originalPlacement=data.placement,data.offsets.popper=getPopperOffsets(this.popper,data.offsets.reference,data.placement),data.offsets.popper.position="absolute",data=runModifiers(this.modifiers,data),this.state.isCreated?this.options.onUpdate(data):(this.state.isCreated=!0,this.options.onCreate(data))}}function isModifierEnabled(modifiers,modifierName){return modifiers.some((function(_ref){var name=_ref.name;return _ref.enabled&&name===modifierName}))}function getSupportedPropertyName(property){for(var prefixes=[!1,"ms","Webkit","Moz","O"],upperProp=property.charAt(0).toUpperCase()+property.slice(1),i=0;i<prefixes.length-1;i++){var prefix=prefixes[i],toCheck=prefix?""+prefix+upperProp:property;if(void 0!==window.document.body.style[toCheck])return toCheck}return null}function destroy(){return this.state.isDestroyed=!0,isModifierEnabled(this.modifiers,"applyStyle")&&(this.popper.removeAttribute("x-placement"),this.popper.style.left="",this.popper.style.position="",this.popper.style.top="",this.popper.style[getSupportedPropertyName("transform")]=""),this.disableEventListeners(),this.options.removeOnDestroy&&this.popper.parentNode.removeChild(this.popper),this}function getWindow(element){var ownerDocument=element.ownerDocument;return ownerDocument?ownerDocument.defaultView:window}function attachToScrollParents(scrollParent,event,callback,scrollParents){var isBody="BODY"===scrollParent.nodeName,target=isBody?scrollParent.ownerDocument.defaultView:scrollParent;target.addEventListener(event,callback,{passive:!0}),isBody||attachToScrollParents(getScrollParent(target.parentNode),event,callback,scrollParents),scrollParents.push(target)}function setupEventListeners(reference,options,state,updateBound){state.updateBound=updateBound,getWindow(reference).addEventListener("resize",state.updateBound,{passive:!0});var scrollElement=getScrollParent(reference);return attachToScrollParents(scrollElement,"scroll",state.updateBound,state.scrollParents),state.scrollElement=scrollElement,state.eventsEnabled=!0,state}function enableEventListeners(){this.state.eventsEnabled||(this.state=setupEventListeners(this.reference,this.options,this.state,this.scheduleUpdate))}function disableEventListeners(){var reference,state;this.state.eventsEnabled&&(window.cancelAnimationFrame(this.scheduleUpdate),this.state=(reference=this.reference,state=this.state,getWindow(reference).removeEventListener("resize",state.updateBound),state.scrollParents.forEach((function(target){target.removeEventListener("scroll",state.updateBound)})),state.updateBound=null,state.scrollParents=[],state.scrollElement=null,state.eventsEnabled=!1,state))}function isNumeric(n){return""!==n&&!isNaN(parseFloat(n))&&isFinite(n)}function setStyles(element,styles){Object.keys(styles).forEach((function(prop){var unit="";-1!==["width","height","top","right","bottom","left"].indexOf(prop)&&isNumeric(styles[prop])&&(unit="px"),element.style[prop]=styles[prop]+unit}))}function isModifierRequired(modifiers,requestingName,requestedName){var requesting=find(modifiers,(function(_ref){return _ref.name===requestingName})),isRequired=!!requesting&&modifiers.some((function(modifier){return modifier.name===requestedName&&modifier.enabled&&modifier.order<requesting.order}));if(!isRequired){var _requesting="`"+requestingName+"`",requested="`"+requestedName+"`";console.warn(requested+" modifier is required by "+_requesting+" modifier in order to work, be sure to include it before "+_requesting+"!")}return isRequired}var placements=["auto-start","auto","auto-end","top-start","top","top-end","right-start","right","right-end","bottom-end","bottom","bottom-start","left-end","left","left-start"],validPlacements=placements.slice(3);function clockwise(placement){var counter=arguments.length>1&&void 0!==arguments[1]&&arguments[1],index=validPlacements.indexOf(placement),arr=validPlacements.slice(index+1).concat(validPlacements.slice(0,index));return counter?arr.reverse():arr}var BEHAVIORS_FLIP="flip",BEHAVIORS_CLOCKWISE="clockwise",BEHAVIORS_COUNTERCLOCKWISE="counterclockwise";function parseOffset(offset,popperOffsets,referenceOffsets,basePlacement){var offsets=[0,0],useHeight=-1!==["right","left"].indexOf(basePlacement),fragments=offset.split(/(\+|\-)/).map((function(frag){return frag.trim()})),divider=fragments.indexOf(find(fragments,(function(frag){return-1!==frag.search(/,|\s/)})));fragments[divider]&&-1===fragments[divider].indexOf(",")&&console.warn("Offsets separated by white space(s) are deprecated, use a comma (,) instead.");var splitRegex=/\s*,\s*|\s+/,ops=-1!==divider?[fragments.slice(0,divider).concat([fragments[divider].split(splitRegex)[0]]),[fragments[divider].split(splitRegex)[1]].concat(fragments.slice(divider+1))]:[fragments];return ops=ops.map((function(op,index){var measurement=(1===index?!useHeight:useHeight)?"height":"width",mergeWithPrevious=!1;return op.reduce((function(a,b){return""===a[a.length-1]&&-1!==["+","-"].indexOf(b)?(a[a.length-1]=b,mergeWithPrevious=!0,a):mergeWithPrevious?(a[a.length-1]+=b,mergeWithPrevious=!1,a):a.concat(b)}),[]).map((function(str){return function(str,measurement,popperOffsets,referenceOffsets){var split=str.match(/((?:\-|\+)?\d*\.?\d*)(.*)/),value=+split[1],unit=split[2];if(!value)return str;if(0===unit.indexOf("%")){return getClientRect("%p"===unit?popperOffsets:referenceOffsets)[measurement]/100*value}if("vh"===unit||"vw"===unit)return("vh"===unit?Math.max(document.documentElement.clientHeight,window.innerHeight||0):Math.max(document.documentElement.clientWidth,window.innerWidth||0))/100*value;return value}(str,measurement,popperOffsets,referenceOffsets)}))})),ops.forEach((function(op,index){op.forEach((function(frag,index2){isNumeric(frag)&&(offsets[index]+=frag*("-"===op[index2-1]?-1:1))}))})),offsets}var modifiers={shift:{order:100,enabled:!0,fn:function(data){var placement=data.placement,basePlacement=placement.split("-")[0],shiftvariation=placement.split("-")[1];if(shiftvariation){var _data$offsets=data.offsets,reference=_data$offsets.reference,popper=_data$offsets.popper,isVertical=-1!==["bottom","top"].indexOf(basePlacement),side=isVertical?"left":"top",measurement=isVertical?"width":"height",shiftOffsets={start:defineProperty({},side,reference[side]),end:defineProperty({},side,reference[side]+reference[measurement]-popper[measurement])};data.offsets.popper=_extends({},popper,shiftOffsets[shiftvariation])}return data}},offset:{order:200,enabled:!0,fn:function(data,_ref){var offset=_ref.offset,placement=data.placement,_data$offsets=data.offsets,popper=_data$offsets.popper,reference=_data$offsets.reference,basePlacement=placement.split("-")[0],offsets=void 0;return offsets=isNumeric(+offset)?[+offset,0]:parseOffset(offset,popper,reference,basePlacement),"left"===basePlacement?(popper.top+=offsets[0],popper.left-=offsets[1]):"right"===basePlacement?(popper.top+=offsets[0],popper.left+=offsets[1]):"top"===basePlacement?(popper.left+=offsets[0],popper.top-=offsets[1]):"bottom"===basePlacement&&(popper.left+=offsets[0],popper.top+=offsets[1]),data.popper=popper,data},offset:0},preventOverflow:{order:300,enabled:!0,fn:function(data,options){var boundariesElement=options.boundariesElement||getOffsetParent(data.instance.popper);data.instance.reference===boundariesElement&&(boundariesElement=getOffsetParent(boundariesElement));var boundaries=getBoundaries(data.instance.popper,data.instance.reference,options.padding,boundariesElement);options.boundaries=boundaries;var order=options.priority,popper=data.offsets.popper,check={primary:function(placement){var value=popper[placement];return popper[placement]<boundaries[placement]&&!options.escapeWithReference&&(value=Math.max(popper[placement],boundaries[placement])),defineProperty({},placement,value)},secondary:function(placement){var mainSide="right"===placement?"left":"top",value=popper[mainSide];return popper[placement]>boundaries[placement]&&!options.escapeWithReference&&(value=Math.min(popper[mainSide],boundaries[placement]-("right"===placement?popper.width:popper.height))),defineProperty({},mainSide,value)}};return order.forEach((function(placement){var side=-1!==["left","top"].indexOf(placement)?"primary":"secondary";popper=_extends({},popper,check[side](placement))})),data.offsets.popper=popper,data},priority:["left","right","top","bottom"],padding:5,boundariesElement:"scrollParent"},keepTogether:{order:400,enabled:!0,fn:function(data){var _data$offsets=data.offsets,popper=_data$offsets.popper,reference=_data$offsets.reference,placement=data.placement.split("-")[0],floor=Math.floor,isVertical=-1!==["top","bottom"].indexOf(placement),side=isVertical?"right":"bottom",opSide=isVertical?"left":"top",measurement=isVertical?"width":"height";return popper[side]<floor(reference[opSide])&&(data.offsets.popper[opSide]=floor(reference[opSide])-popper[measurement]),popper[opSide]>floor(reference[side])&&(data.offsets.popper[opSide]=floor(reference[side])),data}},arrow:{order:500,enabled:!0,fn:function(data,options){if(!isModifierRequired(data.instance.modifiers,"arrow","keepTogether"))return data;var arrowElement=options.element;if("string"==typeof arrowElement){if(!(arrowElement=data.instance.popper.querySelector(arrowElement)))return data}else if(!data.instance.popper.contains(arrowElement))return console.warn("WARNING: `arrow.element` must be child of its popper element!"),data;var placement=data.placement.split("-")[0],_data$offsets=data.offsets,popper=_data$offsets.popper,reference=_data$offsets.reference,isVertical=-1!==["left","right"].indexOf(placement),len=isVertical?"height":"width",sideCapitalized=isVertical?"Top":"Left",side=sideCapitalized.toLowerCase(),altSide=isVertical?"left":"top",opSide=isVertical?"bottom":"right",arrowElementSize=getOuterSizes(arrowElement)[len];reference[opSide]-arrowElementSize<popper[side]&&(data.offsets.popper[side]-=popper[side]-(reference[opSide]-arrowElementSize)),reference[side]+arrowElementSize>popper[opSide]&&(data.offsets.popper[side]+=reference[side]+arrowElementSize-popper[opSide]);var center=reference[side]+reference[len]/2-arrowElementSize/2,popperMarginSide=getStyleComputedProperty(data.instance.popper,"margin"+sideCapitalized).replace("px",""),sideValue=center-getClientRect(data.offsets.popper)[side]-popperMarginSide;return sideValue=Math.max(Math.min(popper[len]-arrowElementSize,sideValue),0),data.arrowElement=arrowElement,data.offsets.arrow={},data.offsets.arrow[side]=Math.round(sideValue),data.offsets.arrow[altSide]="",data},element:"[x-arrow]"},flip:{order:600,enabled:!0,fn:function(data,options){if(isModifierEnabled(data.instance.modifiers,"inner"))return data;if(data.flipped&&data.placement===data.originalPlacement)return data;var boundaries=getBoundaries(data.instance.popper,data.instance.reference,options.padding,options.boundariesElement),placement=data.placement.split("-")[0],placementOpposite=getOppositePlacement(placement),variation=data.placement.split("-")[1]||"",flipOrder=[];switch(options.behavior){case BEHAVIORS_FLIP:flipOrder=[placement,placementOpposite];break;case BEHAVIORS_CLOCKWISE:flipOrder=clockwise(placement);break;case BEHAVIORS_COUNTERCLOCKWISE:flipOrder=clockwise(placement,!0);break;default:flipOrder=options.behavior}return flipOrder.forEach((function(step,index){if(placement!==step||flipOrder.length===index+1)return data;placement=data.placement.split("-")[0],placementOpposite=getOppositePlacement(placement);var popperOffsets=data.offsets.popper,refOffsets=data.offsets.reference,floor=Math.floor,overlapsRef="left"===placement&&floor(popperOffsets.right)>floor(refOffsets.left)||"right"===placement&&floor(popperOffsets.left)<floor(refOffsets.right)||"top"===placement&&floor(popperOffsets.bottom)>floor(refOffsets.top)||"bottom"===placement&&floor(popperOffsets.top)<floor(refOffsets.bottom),overflowsLeft=floor(popperOffsets.left)<floor(boundaries.left),overflowsRight=floor(popperOffsets.right)>floor(boundaries.right),overflowsTop=floor(popperOffsets.top)<floor(boundaries.top),overflowsBottom=floor(popperOffsets.bottom)>floor(boundaries.bottom),overflowsBoundaries="left"===placement&&overflowsLeft||"right"===placement&&overflowsRight||"top"===placement&&overflowsTop||"bottom"===placement&&overflowsBottom,isVertical=-1!==["top","bottom"].indexOf(placement),flippedVariation=!!options.flipVariations&&(isVertical&&"start"===variation&&overflowsLeft||isVertical&&"end"===variation&&overflowsRight||!isVertical&&"start"===variation&&overflowsTop||!isVertical&&"end"===variation&&overflowsBottom);(overlapsRef||overflowsBoundaries||flippedVariation)&&(data.flipped=!0,(overlapsRef||overflowsBoundaries)&&(placement=flipOrder[index+1]),flippedVariation&&(variation=function(variation){return"end"===variation?"start":"start"===variation?"end":variation}(variation)),data.placement=placement+(variation?"-"+variation:""),data.offsets.popper=_extends({},data.offsets.popper,getPopperOffsets(data.instance.popper,data.offsets.reference,data.placement)),data=runModifiers(data.instance.modifiers,data,"flip"))})),data},behavior:"flip",padding:5,boundariesElement:"viewport"},inner:{order:700,enabled:!1,fn:function(data){var placement=data.placement,basePlacement=placement.split("-")[0],_data$offsets=data.offsets,popper=_data$offsets.popper,reference=_data$offsets.reference,isHoriz=-1!==["left","right"].indexOf(basePlacement),subtractLength=-1===["top","left"].indexOf(basePlacement);return popper[isHoriz?"left":"top"]=reference[basePlacement]-(subtractLength?popper[isHoriz?"width":"height"]:0),data.placement=getOppositePlacement(placement),data.offsets.popper=getClientRect(popper),data}},hide:{order:800,enabled:!0,fn:function(data){if(!isModifierRequired(data.instance.modifiers,"hide","preventOverflow"))return data;var refRect=data.offsets.reference,bound=find(data.instance.modifiers,(function(modifier){return"preventOverflow"===modifier.name})).boundaries;if(refRect.bottom<bound.top||refRect.left>bound.right||refRect.top>bound.bottom||refRect.right<bound.left){if(!0===data.hide)return data;data.hide=!0,data.attributes["x-out-of-boundaries"]=""}else{if(!1===data.hide)return data;data.hide=!1,data.attributes["x-out-of-boundaries"]=!1}return data}},computeStyle:{order:850,enabled:!0,fn:function(data,options){var x=options.x,y=options.y,popper=data.offsets.popper,legacyGpuAccelerationOption=find(data.instance.modifiers,(function(modifier){return"applyStyle"===modifier.name})).gpuAcceleration;void 0!==legacyGpuAccelerationOption&&console.warn("WARNING: `gpuAcceleration` option moved to `computeStyle` modifier and will not be supported in future versions of Popper.js!");var gpuAcceleration=void 0!==legacyGpuAccelerationOption?legacyGpuAccelerationOption:options.gpuAcceleration,offsetParentRect=getBoundingClientRect(getOffsetParent(data.instance.popper)),styles={position:popper.position},offsets={left:Math.floor(popper.left),top:Math.floor(popper.top),bottom:Math.floor(popper.bottom),right:Math.floor(popper.right)},sideA="bottom"===x?"top":"bottom",sideB="right"===y?"left":"right",prefixedProperty=getSupportedPropertyName("transform"),left=void 0,top=void 0;if(top="bottom"===sideA?-offsetParentRect.height+offsets.bottom:offsets.top,left="right"===sideB?-offsetParentRect.width+offsets.right:offsets.left,gpuAcceleration&&prefixedProperty)styles[prefixedProperty]="translate3d("+left+"px, "+top+"px, 0)",styles[sideA]=0,styles[sideB]=0,styles.willChange="transform";else{var invertTop="bottom"===sideA?-1:1,invertLeft="right"===sideB?-1:1;styles[sideA]=top*invertTop,styles[sideB]=left*invertLeft,styles.willChange=sideA+", "+sideB}var attributes={"x-placement":data.placement};return data.attributes=_extends({},attributes,data.attributes),data.styles=_extends({},styles,data.styles),data.arrowStyles=_extends({},data.offsets.arrow,data.arrowStyles),data},gpuAcceleration:!0,x:"bottom",y:"right"},applyStyle:{order:900,enabled:!0,fn:function(data){var element,attributes;return setStyles(data.instance.popper,data.styles),element=data.instance.popper,attributes=data.attributes,Object.keys(attributes).forEach((function(prop){!1!==attributes[prop]?element.setAttribute(prop,attributes[prop]):element.removeAttribute(prop)})),data.arrowElement&&Object.keys(data.arrowStyles).length&&setStyles(data.arrowElement,data.arrowStyles),data},onLoad:function(reference,popper,options,modifierOptions,state){var referenceOffsets=getReferenceOffsets(0,popper,reference),placement=computeAutoPlacement(options.placement,referenceOffsets,popper,reference,options.modifiers.flip.boundariesElement,options.modifiers.flip.padding);return popper.setAttribute("x-placement",placement),setStyles(popper,{position:"absolute"}),options},gpuAcceleration:void 0}},Defaults={placement:"bottom",eventsEnabled:!0,removeOnDestroy:!1,onCreate:function(){},onUpdate:function(){},modifiers:modifiers},Popper=function(){function Popper(reference,popper){var _this=this,options=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};classCallCheck(this,Popper),this.scheduleUpdate=function(){return requestAnimationFrame(_this.update)},this.update=debounce(this.update.bind(this)),this.options=_extends({},Popper.Defaults,options),this.state={isDestroyed:!1,isCreated:!1,scrollParents:[]},this.reference=reference&&reference.jquery?reference[0]:reference,this.popper=popper&&popper.jquery?popper[0]:popper,this.options.modifiers={},Object.keys(_extends({},Popper.Defaults.modifiers,options.modifiers)).forEach((function(name){_this.options.modifiers[name]=_extends({},Popper.Defaults.modifiers[name]||{},options.modifiers?options.modifiers[name]:{})})),this.modifiers=Object.keys(this.options.modifiers).map((function(name){return _extends({name:name},_this.options.modifiers[name])})).sort((function(a,b){return a.order-b.order})),this.modifiers.forEach((function(modifierOptions){modifierOptions.enabled&&isFunction(modifierOptions.onLoad)&&modifierOptions.onLoad(_this.reference,_this.popper,_this.options,modifierOptions,_this.state)})),this.update();var eventsEnabled=this.options.eventsEnabled;eventsEnabled&&this.enableEventListeners(),this.state.eventsEnabled=eventsEnabled}return createClass(Popper,[{key:"update",value:function(){return update.call(this)}},{key:"destroy",value:function(){return destroy.call(this)}},{key:"enableEventListeners",value:function(){return enableEventListeners.call(this)}},{key:"disableEventListeners",value:function(){return disableEventListeners.call(this)}}]),Popper}();return Popper.Utils=("undefined"!=typeof window?window:global).PopperUtils,Popper.placements=placements,Popper.Defaults=Defaults,Popper}));
/**
 * Javascript to load and render a paged content section.
 *
 * @module     core/paged_content
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/paged_content",["jquery","core/paged_content_pages","core/paged_content_paging_bar","core/paged_content_paging_bar_limit_selector","core/paged_content_paging_dropdown"],(function($,Pages,PagingBar,PagingBarLimitSelector,Dropdown){return{init:function(root,renderPagesContentCallback,namespaceOverride){var pagesContainer=(root=$(root)).find(Pages.rootSelector),pagingBarContainer=root.find(PagingBar.rootSelector),dropdownContainer=root.find(Dropdown.rootSelector),pagingBarLimitSelectorContainer=root.find(PagingBarLimitSelector.rootSelector),id=root.attr("id");namespaceOverride&&(id=namespaceOverride),Pages.init(pagesContainer,id,renderPagesContentCallback),pagingBarContainer.length&&PagingBar.init(pagingBarContainer,id),pagingBarLimitSelectorContainer.length&&PagingBarLimitSelector.init(pagingBarLimitSelectorContainer,id),dropdownContainer.length&&Dropdown.init(dropdownContainer,id)},rootSelector:'[data-region="paged-content-container"]'}}));
/**
 * Javascript to manage the paging dropdown control.
 *
 * @module     core/paged_content_paging_dropdown
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/paged_content_paging_dropdown",["jquery","core/custom_interaction_events","core/paged_content_events","core/pubsub"],(function($,CustomEvents,PagedContentEvents,PubSub){var SELECTORS_DROPDOWN_ITEM='[data-region="dropdown-item"]',SELECTORS_DROPDOWN_TOGGLE='[data-region="dropdown-toggle"]',SELECTORS_ACTIVE_DROPDOWN_ITEM='[data-region="dropdown-item"].active',SELECTORS_CARET='[data-region="caret"]',getPageNumber=function(item){return parseInt(item.attr("data-page-number"),10)},getAllItems=function(root){return root.find(SELECTORS_DROPDOWN_ITEM)},getPreviousItems=function(root,item){var pageNumber=getPageNumber(item);return getAllItems(root).filter((function(index,element){return getPageNumber($(element))<pageNumber}))},getLimit=function(item){return parseInt(item.attr("data-item-count"),10)},getOffset=function(root,item){if(null!=item.attr("data-offset"))return parseInt(item.attr("data-offset"),10);var offset=0;return getPreviousItems(root,item).each((function(index,prevItem){prevItem=$(prevItem),offset+=getLimit(prevItem)})),item.attr("data-offset",offset),offset},getActiveItem=function(root){return root.find(SELECTORS_ACTIVE_DROPDOWN_ITEM)},setActiveItem=function(root,item,id){var eventPayload=function(root,items){return items.map((function(index,item){return item=$(item),{pageNumber:getPageNumber(item),limit:getLimit(item),offset:getOffset(root,item)}})).get()}(root,getPreviousItems(root,item).add(item)),toggle=root.find(SELECTORS_DROPDOWN_TOGGLE),caret=toggle.find(SELECTORS_CARET);getActiveItem(root).removeClass("active"),item.addClass("active"),toggle.html(item.text()),toggle.append(caret),PubSub.publish(id+PagedContentEvents.SHOW_PAGES,eventPayload)};return{init:function(root,id){root=$(root),function(items){items.each((function(index,item){(item=$(item)).attr("data-page-number",index+1)}))}(getAllItems(root));var activeItem=getActiveItem(root);activeItem.length&&setActiveItem(root,activeItem,id),CustomEvents.define(root,[CustomEvents.events.activate]),root.on(CustomEvents.events.activate,SELECTORS_DROPDOWN_ITEM,(function(e,data){var item=$(e.target).closest(SELECTORS_DROPDOWN_ITEM);setActiveItem(root,item,id),data.originalEvent.preventDefault()}))},rootSelector:'[data-region="paging-dropdown-container"]'}}));
define("core/utils",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.throttle=_exports.debounce=void 0;_exports.throttle=function(func,wait){var onCooldown=!1,runAgain=null;return function run(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];runAgain=null!==runAgain,onCooldown||(func.apply(this,args),onCooldown=!0,setTimeout((function(){var recurse=runAgain;onCooldown=!1,runAgain=null,recurse&&run(args)}),wait))}};_exports.debounce=function(func,wait){var timeout=null;return function(){for(var _this=this,_len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];clearTimeout(timeout),timeout=setTimeout((function(){func.apply(_this,args)}),wait)}}}));
/**
 * Chart bar.
 *
 * @package    core
 * @copyright  2016 Frdric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @module     core/chart_bar
 */
define("core/chart_bar",["core/chart_base"],(function(Base){function Bar(){Base.prototype.constructor.apply(this,arguments)}return Bar.prototype=Object.create(Base.prototype),Bar.prototype._horizontal=!1,Bar.prototype._stacked=!1,Bar.prototype.TYPE="bar",Bar.prototype.create=function(Klass,data){var chart=Base.prototype.create.apply(this,arguments);return chart.setHorizontal(data.horizontal),chart.setStacked(data.stacked),chart},Bar.prototype._setDefaults=function(){Base.prototype._setDefaults.apply(this,arguments);var axis=this.getYAxis(0,!0);axis.setMin(0)},Bar.prototype.getHorizontal=function(){return this._horizontal},Bar.prototype.getStacked=function(){return this._stacked},Bar.prototype.setHorizontal=function(horizontal){var axis=this.getXAxis(0,!0);null===axis.getMin()&&axis.setMin(0),this._horizontal=Boolean(horizontal)},Bar.prototype.setStacked=function(stacked){this._stacked=Boolean(stacked)},Bar}));
/**
 * Expose the global YUI variable. Note: This is only for scripts that are writing AMD
 * wrappers for YUI functionality. This is not for plugins.
 *
 * @module     core/yui
 * @package    core
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      2.9
 */
define("core/yui",(function(){return Y}));
/**
 * Chart output for chart.js.
 *
 * @package    core
 * @copyright  2016 Frdric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @module     core/chart_output_chartjs
 */
define("core/chart_output_chartjs",["jquery","core/chartjs","core/chart_axis","core/chart_bar","core/chart_output_base","core/chart_line","core/chart_pie","core/chart_series"],(function($,Chartjs,Axis,Bar,Base,Line,Pie,Series){var makeAxisId=function(xy,index){return"axis-"+xy+"-"+index};function Output(){Base.prototype.constructor.apply(this,arguments),this._canvas=this._node,"CANVAS"!=this._canvas.prop("tagName")&&(this._canvas=$("<canvas>"),this._node.append(this._canvas)),this._build()}return Output.prototype=Object.create(Base.prototype),Output.prototype._config=null,Output.prototype._chartjs=null,Output.prototype._canvas=null,Output.prototype._build=function(){this._config=this._makeConfig(),this._chartjs=new Chartjs(this._canvas[0],this._config)},Output.prototype._cleanData=function(data){return data instanceof Array?data.map((function(value){return $("<span>").html(value).text()})):$("<span>").html(data).text()},Output.prototype._getChartType=function(){var type=this._chart.getType();return this._chart.getType()===Bar.prototype.TYPE&&!0===this._chart.getHorizontal()?type="horizontalBar":this._chart.getType()===Pie.prototype.TYPE&&!0===this._chart.getDoughnut()&&(type="doughnut"),type},Output.prototype._makeAxisConfig=function(axis,xy,index){var scaleData={id:makeAxisId(xy,index)};return axis.getPosition()!==Axis.prototype.POS_DEFAULT&&(scaleData.position=axis.getPosition()),null!==axis.getLabel()&&(scaleData.scaleLabel={display:!0,labelString:this._cleanData(axis.getLabel())}),null!==axis.getStepSize()&&(scaleData.ticks=scaleData.ticks||{},scaleData.ticks.stepSize=axis.getStepSize()),null!==axis.getMax()&&(scaleData.ticks=scaleData.ticks||{},scaleData.ticks.max=axis.getMax()),null!==axis.getMin()&&(scaleData.ticks=scaleData.ticks||{},scaleData.ticks.min=axis.getMin()),scaleData},Output.prototype._makeConfig=function(){var config={type:this._getChartType(),data:{labels:this._cleanData(this._chart.getLabels()),datasets:this._makeDatasetsConfig()},options:{title:{display:null!==this._chart.getTitle(),text:this._cleanData(this._chart.getTitle())}}},legendOptions=this._chart.getLegendOptions();return legendOptions&&(config.options.legend=legendOptions),this._chart.getXAxes().forEach(function(axis,i){var axisLabels=axis.getLabels();config.options.scales=config.options.scales||{},config.options.scales.xAxes=config.options.scales.xAxes||[],config.options.scales.xAxes[i]=this._makeAxisConfig(axis,"x",i),null!==axisLabels&&(config.options.scales.xAxes[i].ticks.callback=function(value,index){return axisLabels[index]||""}),config.options.scales.xAxes[i].stacked=this._isStacked()}.bind(this)),this._chart.getYAxes().forEach(function(axis,i){var axisLabels=axis.getLabels();config.options.scales=config.options.scales||{},config.options.scales.yAxes=config.options.scales.yAxes||[],config.options.scales.yAxes[i]=this._makeAxisConfig(axis,"y",i),null!==axisLabels&&(config.options.scales.yAxes[i].ticks.callback=function(value){return axisLabels[parseInt(value,10)]||""}),config.options.scales.yAxes[i].stacked=this._isStacked()}.bind(this)),config.options.tooltips={callbacks:{label:this._makeTooltip.bind(this)}},config},Output.prototype._makeDatasetsConfig=function(){return this._chart.getSeries().map(function(series){var colors=series.hasColoredValues()?series.getColors():series.getColor(),dataset={label:this._cleanData(series.getLabel()),data:series.getValues(),type:series.getType(),fill:series.getFill(),backgroundColor:colors,borderColor:this._chart.getType()==Pie.prototype.TYPE?"#fff":colors,lineTension:this._isSmooth(series)?.3:0};return null!==series.getXAxis()&&(dataset.xAxisID=makeAxisId("x",series.getXAxis())),null!==series.getYAxis()&&(dataset.yAxisID=makeAxisId("y",series.getYAxis())),dataset}.bind(this))},Output.prototype._makeTooltip=function(tooltipItem,data){var series=this._chart.getSeries()[tooltipItem.datasetIndex],serieLabel=series.getLabel(),serieLabels=series.getLabels(),tooltipData=data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index],tooltip=[];if(""==tooltipItem.xLabel&&""==tooltipItem.yLabel){var chartLabels=this._cleanData(this._chart.getLabels());tooltip.push(chartLabels[tooltipItem.index])}return null!==serieLabels?tooltip.push(this._cleanData(serieLabels[tooltipItem.index])):tooltip.push(this._cleanData(serieLabel)+": "+tooltipData),tooltip},Output.prototype._isSmooth=function(series){var smooth=!1;return this._chart.getType()===Line.prototype.TYPE?null===(smooth=series.getSmooth())&&(smooth=this._chart.getSmooth()):series.getType()===Series.prototype.TYPE_LINE&&(smooth=series.getSmooth()),smooth},Output.prototype._isStacked=function(){var stacked=!1;return this._chart.getType()===Bar.prototype.TYPE&&(stacked=this._chart.getStacked()),stacked},Output.prototype.update=function(){$.extend(!0,this._config,this._makeConfig()),this._chartjs.update()},Output}));
define("core/toast",["exports","core/templates","core/notification","core/pending"],(function(_exports,_templates,_notification,_pending){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.addToastRegion=_exports.add=void 0,_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification),_pending=_interopRequireDefault(_pending);var _ref,addToastRegion=(_ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(parent){var pendingPromise,_yield$Templates$rend,html,js;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return pendingPromise=new _pending.default("addToastRegion"),_context.prev=1,_context.next=4,_templates.default.renderForPromise("core/local/toast/wrapper",{});case 4:_yield$Templates$rend=_context.sent,html=_yield$Templates$rend.html,js=_yield$Templates$rend.js,_templates.default.prependNodeContents(parent,html,js),_context.next=13;break;case 10:_context.prev=10,_context.t0=_context.catch(1),_notification.default.exception(_context.t0);case 13:pendingPromise.resolve();case 14:case"end":return _context.stop()}}),_callee,null,[[1,10]])}))),function(_x){return _ref.apply(this,arguments)});_exports.addToastRegion=addToastRegion;var _ref2,add=(_ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(message,configuration){var pendingPromise,templateName,targetNode,_yield$Templates$rend2,html,js;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return pendingPromise=new _pending.default("addToastRegion"),configuration=_objectSpread({closeButton:!1,autohide:!0,delay:4e3},configuration),templateName="core/local/toast/message",_context2.prev=3,_context2.next=6,getTargetNode();case 6:return targetNode=_context2.sent,_context2.next=9,_templates.default.renderForPromise(templateName,_objectSpread({message:message},configuration));case 9:_yield$Templates$rend2=_context2.sent,html=_yield$Templates$rend2.html,js=_yield$Templates$rend2.js,_templates.default.prependNodeContents(targetNode,html,js),_context2.next=18;break;case 15:_context2.prev=15,_context2.t0=_context2.catch(3),_notification.default.exception(_context2.t0);case 18:pendingPromise.resolve();case 19:case"end":return _context2.stop()}}),_callee2,null,[[3,15]])}))),function(_x2,_x3){return _ref2.apply(this,arguments)});_exports.add=add;var _ref3,getTargetNode=(_ref3=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(){var regions;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(!(regions=document.querySelectorAll(".toast-wrapper")).length){_context3.next=3;break}return _context3.abrupt("return",regions[regions.length-1]);case 3:return _context3.next=5,addToastRegion(document.body,"fixed-bottom");case 5:return _context3.abrupt("return",getTargetNode());case 6:case"end":return _context3.stop()}}),_callee3)}))),function(){return _ref3.apply(this,arguments)})}));
function _typeof2(obj){return _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof2(obj)}define("core/adapter",[],(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,(function(e){var n=t[o][1][e];return s(n||e)}),l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var adapter=(0,require("./adapter_factory.js").adapterFactory)({window:window});module.exports=adapter},{"./adapter_factory.js":2}],2:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.adapterFactory=function(){var _ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},window=_ref.window,options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},logging=utils.log,browserDetails=utils.detectBrowser(window),adapter={browserDetails:browserDetails,commonShim:commonShim,extractVersion:utils.extractVersion,disableLog:utils.disableLog,disableWarnings:utils.disableWarnings};switch(browserDetails.browser){case"chrome":if(!chromeShim||!chromeShim.shimPeerConnection||!options.shimChrome)return logging("Chrome shim is not included in this adapter release."),adapter;logging("adapter.js shimming chrome."),adapter.browserShim=chromeShim,chromeShim.shimGetUserMedia(window),chromeShim.shimMediaStream(window),chromeShim.shimPeerConnection(window),chromeShim.shimOnTrack(window),chromeShim.shimAddTrackRemoveTrack(window),chromeShim.shimGetSendersWithDtmf(window),chromeShim.shimGetStats(window),chromeShim.shimSenderReceiverGetStats(window),chromeShim.fixNegotiationNeeded(window),commonShim.shimRTCIceCandidate(window),commonShim.shimConnectionState(window),commonShim.shimMaxMessageSize(window),commonShim.shimSendThrowTypeError(window),commonShim.removeAllowExtmapMixed(window);break;case"firefox":if(!firefoxShim||!firefoxShim.shimPeerConnection||!options.shimFirefox)return logging("Firefox shim is not included in this adapter release."),adapter;logging("adapter.js shimming firefox."),adapter.browserShim=firefoxShim,firefoxShim.shimGetUserMedia(window),firefoxShim.shimPeerConnection(window),firefoxShim.shimOnTrack(window),firefoxShim.shimRemoveStream(window),firefoxShim.shimSenderGetStats(window),firefoxShim.shimReceiverGetStats(window),firefoxShim.shimRTCDataChannel(window),firefoxShim.shimAddTransceiver(window),firefoxShim.shimCreateOffer(window),firefoxShim.shimCreateAnswer(window),commonShim.shimRTCIceCandidate(window),commonShim.shimConnectionState(window),commonShim.shimMaxMessageSize(window),commonShim.shimSendThrowTypeError(window);break;case"edge":if(!edgeShim||!edgeShim.shimPeerConnection||!options.shimEdge)return logging("MS edge shim is not included in this adapter release."),adapter;logging("adapter.js shimming edge."),adapter.browserShim=edgeShim,edgeShim.shimGetUserMedia(window),edgeShim.shimGetDisplayMedia(window),edgeShim.shimPeerConnection(window),edgeShim.shimReplaceTrack(window),commonShim.shimMaxMessageSize(window),commonShim.shimSendThrowTypeError(window);break;case"safari":if(!safariShim||!options.shimSafari)return logging("Safari shim is not included in this adapter release."),adapter;logging("adapter.js shimming safari."),adapter.browserShim=safariShim,safariShim.shimRTCIceServerUrls(window),safariShim.shimCreateOfferLegacy(window),safariShim.shimCallbacksAPI(window),safariShim.shimLocalStreamsAPI(window),safariShim.shimRemoteStreamsAPI(window),safariShim.shimTrackEventTransceiver(window),safariShim.shimGetUserMedia(window),commonShim.shimRTCIceCandidate(window),commonShim.shimMaxMessageSize(window),commonShim.shimSendThrowTypeError(window),commonShim.removeAllowExtmapMixed(window);break;default:logging("Unsupported browser!")}return adapter};var utils=_interopRequireWildcard(require("./utils")),chromeShim=_interopRequireWildcard(require("./chrome/chrome_shim")),edgeShim=_interopRequireWildcard(require("./edge/edge_shim")),firefoxShim=_interopRequireWildcard(require("./firefox/firefox_shim")),safariShim=_interopRequireWildcard(require("./safari/safari_shim")),commonShim=_interopRequireWildcard(require("./common_shim"));function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimGetDisplayMedia=exports.shimGetUserMedia=void 0;var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_getusermedia=require("./getusermedia");Object.defineProperty(exports,"shimGetUserMedia",{enumerable:!0,get:function(){return _getusermedia.shimGetUserMedia}});var _getdisplaymedia=require("./getdisplaymedia");Object.defineProperty(exports,"shimGetDisplayMedia",{enumerable:!0,get:function(){return _getdisplaymedia.shimGetDisplayMedia}}),exports.shimMediaStream=function(window){window.MediaStream=window.MediaStream||window.webkitMediaStream},exports.shimOnTrack=function(window){if("object"===(void 0===window?"undefined":_typeof(window))&&window.RTCPeerConnection&&!("ontrack"in window.RTCPeerConnection.prototype)){Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(f){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=f)},enumerable:!0,configurable:!0});var origSetRemoteDescription=window.RTCPeerConnection.prototype.setRemoteDescription;window.RTCPeerConnection.prototype.setRemoteDescription=function(){var _this=this;return this._ontrackpoly||(this._ontrackpoly=function(e){e.stream.addEventListener("addtrack",(function(te){var receiver=void 0;receiver=window.RTCPeerConnection.prototype.getReceivers?_this.getReceivers().find((function(r){return r.track&&r.track.id===te.track.id})):{track:te.track};var event=new Event("track");event.track=te.track,event.receiver=receiver,event.transceiver={receiver:receiver},event.streams=[e.stream],_this.dispatchEvent(event)})),e.stream.getTracks().forEach((function(track){var receiver=void 0;receiver=window.RTCPeerConnection.prototype.getReceivers?_this.getReceivers().find((function(r){return r.track&&r.track.id===track.id})):{track:track};var event=new Event("track");event.track=track,event.receiver=receiver,event.transceiver={receiver:receiver},event.streams=[e.stream],_this.dispatchEvent(event)}))},this.addEventListener("addstream",this._ontrackpoly)),origSetRemoteDescription.apply(this,arguments)}}else utils.wrapPeerConnectionEvent(window,"track",(function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}))},exports.shimGetSendersWithDtmf=function(window){if("object"===(void 0===window?"undefined":_typeof(window))&&window.RTCPeerConnection&&!("getSenders"in window.RTCPeerConnection.prototype)&&"createDTMFSender"in window.RTCPeerConnection.prototype){var shimSenderWithDtmf=function(pc,track){return{track:track,get dtmf(){return void 0===this._dtmf&&("audio"===track.kind?this._dtmf=pc.createDTMFSender(track):this._dtmf=null),this._dtmf},_pc:pc}};if(!window.RTCPeerConnection.prototype.getSenders){window.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var origAddTrack=window.RTCPeerConnection.prototype.addTrack;window.RTCPeerConnection.prototype.addTrack=function(track,stream){var sender=origAddTrack.apply(this,arguments);return sender||(sender=shimSenderWithDtmf(this,track),this._senders.push(sender)),sender};var origRemoveTrack=window.RTCPeerConnection.prototype.removeTrack;window.RTCPeerConnection.prototype.removeTrack=function(sender){origRemoveTrack.apply(this,arguments);var idx=this._senders.indexOf(sender);-1!==idx&&this._senders.splice(idx,1)}}var origAddStream=window.RTCPeerConnection.prototype.addStream;window.RTCPeerConnection.prototype.addStream=function(stream){var _this2=this;this._senders=this._senders||[],origAddStream.apply(this,[stream]),stream.getTracks().forEach((function(track){_this2._senders.push(shimSenderWithDtmf(_this2,track))}))};var origRemoveStream=window.RTCPeerConnection.prototype.removeStream;window.RTCPeerConnection.prototype.removeStream=function(stream){var _this3=this;this._senders=this._senders||[],origRemoveStream.apply(this,[stream]),stream.getTracks().forEach((function(track){var sender=_this3._senders.find((function(s){return s.track===track}));sender&&_this3._senders.splice(_this3._senders.indexOf(sender),1)}))}}else if("object"===(void 0===window?"undefined":_typeof(window))&&window.RTCPeerConnection&&"getSenders"in window.RTCPeerConnection.prototype&&"createDTMFSender"in window.RTCPeerConnection.prototype&&window.RTCRtpSender&&!("dtmf"in window.RTCRtpSender.prototype)){var origGetSenders=window.RTCPeerConnection.prototype.getSenders;window.RTCPeerConnection.prototype.getSenders=function(){var _this4=this,senders=origGetSenders.apply(this,[]);return senders.forEach((function(sender){return sender._pc=_this4})),senders},Object.defineProperty(window.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},exports.shimGetStats=function(window){if(!window.RTCPeerConnection)return;var origGetStats=window.RTCPeerConnection.prototype.getStats;window.RTCPeerConnection.prototype.getStats=function(){var _this5=this,_arguments=Array.prototype.slice.call(arguments),selector=_arguments[0],onSucc=_arguments[1],onErr=_arguments[2];if(arguments.length>0&&"function"==typeof selector)return origGetStats.apply(this,arguments);if(0===origGetStats.length&&(0===arguments.length||"function"!=typeof selector))return origGetStats.apply(this,[]);var fixChromeStats_=function(response){var standardReport={};return response.result().forEach((function(report){var standardStats={id:report.id,timestamp:report.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[report.type]||report.type};report.names().forEach((function(name){standardStats[name]=report.stat(name)})),standardReport[standardStats.id]=standardStats})),standardReport},makeMapStats=function(stats){return new Map(Object.keys(stats).map((function(key){return[key,stats[key]]})))};if(arguments.length>=2){var successCallbackWrapper_=function(response){onSucc(makeMapStats(fixChromeStats_(response)))};return origGetStats.apply(this,[successCallbackWrapper_,selector])}return new Promise((function(resolve,reject){origGetStats.apply(_this5,[function(response){resolve(makeMapStats(fixChromeStats_(response)))},reject])})).then(onSucc,onErr)}},exports.shimSenderReceiverGetStats=function(window){if(!("object"===(void 0===window?"undefined":_typeof(window))&&window.RTCPeerConnection&&window.RTCRtpSender&&window.RTCRtpReceiver))return;if(!("getStats"in window.RTCRtpSender.prototype)){var origGetSenders=window.RTCPeerConnection.prototype.getSenders;origGetSenders&&(window.RTCPeerConnection.prototype.getSenders=function(){var _this6=this,senders=origGetSenders.apply(this,[]);return senders.forEach((function(sender){return sender._pc=_this6})),senders});var origAddTrack=window.RTCPeerConnection.prototype.addTrack;origAddTrack&&(window.RTCPeerConnection.prototype.addTrack=function(){var sender=origAddTrack.apply(this,arguments);return sender._pc=this,sender}),window.RTCRtpSender.prototype.getStats=function(){var sender=this;return this._pc.getStats().then((function(result){return utils.filterStats(result,sender.track,!0)}))}}if(!("getStats"in window.RTCRtpReceiver.prototype)){var origGetReceivers=window.RTCPeerConnection.prototype.getReceivers;origGetReceivers&&(window.RTCPeerConnection.prototype.getReceivers=function(){var _this7=this,receivers=origGetReceivers.apply(this,[]);return receivers.forEach((function(receiver){return receiver._pc=_this7})),receivers}),utils.wrapPeerConnectionEvent(window,"track",(function(e){return e.receiver._pc=e.srcElement,e})),window.RTCRtpReceiver.prototype.getStats=function(){var receiver=this;return this._pc.getStats().then((function(result){return utils.filterStats(result,receiver.track,!1)}))}}if(!("getStats"in window.RTCRtpSender.prototype)||!("getStats"in window.RTCRtpReceiver.prototype))return;var origGetStats=window.RTCPeerConnection.prototype.getStats;window.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof window.MediaStreamTrack){var track=arguments[0],sender=void 0,receiver=void 0,err=void 0;return this.getSenders().forEach((function(s){s.track===track&&(sender?err=!0:sender=s)})),this.getReceivers().forEach((function(r){return r.track===track&&(receiver?err=!0:receiver=r),r.track===track})),err||sender&&receiver?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):sender?sender.getStats():receiver?receiver.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return origGetStats.apply(this,arguments)}},exports.shimAddTrackRemoveTrackWithNative=shimAddTrackRemoveTrackWithNative,exports.shimAddTrackRemoveTrack=function(window){if(!window.RTCPeerConnection)return;var browserDetails=utils.detectBrowser(window);if(window.RTCPeerConnection.prototype.addTrack&&browserDetails.version>=65)return shimAddTrackRemoveTrackWithNative(window);var origGetLocalStreams=window.RTCPeerConnection.prototype.getLocalStreams;window.RTCPeerConnection.prototype.getLocalStreams=function(){var _this11=this,nativeStreams=origGetLocalStreams.apply(this);return this._reverseStreams=this._reverseStreams||{},nativeStreams.map((function(stream){return _this11._reverseStreams[stream.id]}))};var origAddStream=window.RTCPeerConnection.prototype.addStream;window.RTCPeerConnection.prototype.addStream=function(stream){var _this12=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},stream.getTracks().forEach((function(track){if(_this12.getSenders().find((function(s){return s.track===track})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[stream.id]){var newStream=new window.MediaStream(stream.getTracks());this._streams[stream.id]=newStream,this._reverseStreams[newStream.id]=stream,stream=newStream}origAddStream.apply(this,[stream])};var origRemoveStream=window.RTCPeerConnection.prototype.removeStream;function replaceInternalStreamId(pc,description){var sdp=description.sdp;return Object.keys(pc._reverseStreams||[]).forEach((function(internalId){var externalStream=pc._reverseStreams[internalId],internalStream=pc._streams[externalStream.id];sdp=sdp.replace(new RegExp(internalStream.id,"g"),externalStream.id)})),new RTCSessionDescription({type:description.type,sdp:sdp})}function replaceExternalStreamId(pc,description){var sdp=description.sdp;return Object.keys(pc._reverseStreams||[]).forEach((function(internalId){var externalStream=pc._reverseStreams[internalId],internalStream=pc._streams[externalStream.id];sdp=sdp.replace(new RegExp(externalStream.id,"g"),internalStream.id)})),new RTCSessionDescription({type:description.type,sdp:sdp})}window.RTCPeerConnection.prototype.removeStream=function(stream){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},origRemoveStream.apply(this,[this._streams[stream.id]||stream]),delete this._reverseStreams[this._streams[stream.id]?this._streams[stream.id].id:stream.id],delete this._streams[stream.id]},window.RTCPeerConnection.prototype.addTrack=function(track,stream){var _this13=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var streams=[].slice.call(arguments,1);if(1!==streams.length||!streams[0].getTracks().find((function(t){return t===track})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var alreadyExists=this.getSenders().find((function(s){return s.track===track}));if(alreadyExists)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var oldStream=this._streams[stream.id];if(oldStream)oldStream.addTrack(track),Promise.resolve().then((function(){_this13.dispatchEvent(new Event("negotiationneeded"))}));else{var newStream=new window.MediaStream([track]);this._streams[stream.id]=newStream,this._reverseStreams[newStream.id]=stream,this.addStream(newStream)}return this.getSenders().find((function(s){return s.track===track}))},["createOffer","createAnswer"].forEach((function(method){var nativeMethod=window.RTCPeerConnection.prototype[method],methodObj=_defineProperty({},method,(function(){var _this14=this,args=arguments,isLegacyCall=arguments.length&&"function"==typeof arguments[0];return isLegacyCall?nativeMethod.apply(this,[function(description){var desc=replaceInternalStreamId(_this14,description);args[0].apply(null,[desc])},function(err){args[1]&&args[1].apply(null,err)},arguments[2]]):nativeMethod.apply(this,arguments).then((function(description){return replaceInternalStreamId(_this14,description)}))}));window.RTCPeerConnection.prototype[method]=methodObj[method]}));var origSetLocalDescription=window.RTCPeerConnection.prototype.setLocalDescription;window.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=replaceExternalStreamId(this,arguments[0]),origSetLocalDescription.apply(this,arguments)):origSetLocalDescription.apply(this,arguments)};var origLocalDescription=Object.getOwnPropertyDescriptor(window.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(window.RTCPeerConnection.prototype,"localDescription",{get:function(){var description=origLocalDescription.get.apply(this);return""===description.type?description:replaceInternalStreamId(this,description)}}),window.RTCPeerConnection.prototype.removeTrack=function(sender){var _this15=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!sender._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(sender._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var stream=void 0;Object.keys(this._streams).forEach((function(streamid){_this15._streams[streamid].getTracks().find((function(track){return sender.track===track}))&&(stream=_this15._streams[streamid])})),stream&&(1===stream.getTracks().length?this.removeStream(this._reverseStreams[stream.id]):stream.removeTrack(sender.track),this.dispatchEvent(new Event("negotiationneeded")))}},exports.shimPeerConnection=function(window){var browserDetails=utils.detectBrowser(window);!window.RTCPeerConnection&&window.webkitRTCPeerConnection&&(window.RTCPeerConnection=window.webkitRTCPeerConnection);if(!window.RTCPeerConnection)return;browserDetails.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(method){var nativeMethod=window.RTCPeerConnection.prototype[method],methodObj=_defineProperty({},method,(function(){return arguments[0]=new("addIceCandidate"===method?window.RTCIceCandidate:window.RTCSessionDescription)(arguments[0]),nativeMethod.apply(this,arguments)}));window.RTCPeerConnection.prototype[method]=methodObj[method]}));var nativeAddIceCandidate=window.RTCPeerConnection.prototype.addIceCandidate;window.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?browserDetails.version<78&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():nativeAddIceCandidate.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}},exports.fixNegotiationNeeded=function(window){utils.wrapPeerConnectionEvent(window,"negotiationneeded",(function(e){if("stable"===e.target.signalingState)return e}))};var utils=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../utils.js"));function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function shimAddTrackRemoveTrackWithNative(window){window.RTCPeerConnection.prototype.getLocalStreams=function(){var _this8=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(streamId){return _this8._shimmedLocalStreams[streamId][0]}))};var origAddTrack=window.RTCPeerConnection.prototype.addTrack;window.RTCPeerConnection.prototype.addTrack=function(track,stream){if(!stream)return origAddTrack.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var sender=origAddTrack.apply(this,arguments);return this._shimmedLocalStreams[stream.id]?-1===this._shimmedLocalStreams[stream.id].indexOf(sender)&&this._shimmedLocalStreams[stream.id].push(sender):this._shimmedLocalStreams[stream.id]=[stream,sender],sender};var origAddStream=window.RTCPeerConnection.prototype.addStream;window.RTCPeerConnection.prototype.addStream=function(stream){var _this9=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},stream.getTracks().forEach((function(track){if(_this9.getSenders().find((function(s){return s.track===track})))throw new DOMException("Track already exists.","InvalidAccessError")}));var existingSenders=this.getSenders();origAddStream.apply(this,arguments);var newSenders=this.getSenders().filter((function(newSender){return-1===existingSenders.indexOf(newSender)}));this._shimmedLocalStreams[stream.id]=[stream].concat(newSenders)};var origRemoveStream=window.RTCPeerConnection.prototype.removeStream;window.RTCPeerConnection.prototype.removeStream=function(stream){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[stream.id],origRemoveStream.apply(this,arguments)};var origRemoveTrack=window.RTCPeerConnection.prototype.removeTrack;window.RTCPeerConnection.prototype.removeTrack=function(sender){var _this10=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},sender&&Object.keys(this._shimmedLocalStreams).forEach((function(streamId){var idx=_this10._shimmedLocalStreams[streamId].indexOf(sender);-1!==idx&&_this10._shimmedLocalStreams[streamId].splice(idx,1),1===_this10._shimmedLocalStreams[streamId].length&&delete _this10._shimmedLocalStreams[streamId]})),origRemoveTrack.apply(this,arguments)}}},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimGetDisplayMedia=function(window,getSourceId){if(window.navigator.mediaDevices&&"getDisplayMedia"in window.navigator.mediaDevices)return;if(!window.navigator.mediaDevices)return;if("function"!=typeof getSourceId)return void console.error("shimGetDisplayMedia: getSourceId argument is not a function");window.navigator.mediaDevices.getDisplayMedia=function(constraints){return getSourceId(constraints).then((function(sourceId){var widthSpecified=constraints.video&&constraints.video.width,heightSpecified=constraints.video&&constraints.video.height,frameRateSpecified=constraints.video&&constraints.video.frameRate;return constraints.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:sourceId,maxFrameRate:frameRateSpecified||3}},widthSpecified&&(constraints.video.mandatory.maxWidth=widthSpecified),heightSpecified&&(constraints.video.mandatory.maxHeight=heightSpecified),window.navigator.mediaDevices.getUserMedia(constraints)}))}}},{}],5:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)};exports.shimGetUserMedia=function(window){var navigator=window&&window.navigator;if(!navigator.mediaDevices)return;var browserDetails=utils.detectBrowser(window),constraintsToChrome_=function(c){if("object"!==(void 0===c?"undefined":_typeof(c))||c.mandatory||c.optional)return c;var cc={};return Object.keys(c).forEach((function(key){if("require"!==key&&"advanced"!==key&&"mediaSource"!==key){var r="object"===_typeof(c[key])?c[key]:{ideal:c[key]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var oldname_=function(prefix,name){return prefix?prefix+name.charAt(0).toUpperCase()+name.slice(1):"deviceId"===name?"sourceId":name};if(void 0!==r.ideal){cc.optional=cc.optional||[];var oc={};"number"==typeof r.ideal?(oc[oldname_("min",key)]=r.ideal,cc.optional.push(oc),(oc={})[oldname_("max",key)]=r.ideal,cc.optional.push(oc)):(oc[oldname_("",key)]=r.ideal,cc.optional.push(oc))}void 0!==r.exact&&"number"!=typeof r.exact?(cc.mandatory=cc.mandatory||{},cc.mandatory[oldname_("",key)]=r.exact):["min","max"].forEach((function(mix){void 0!==r[mix]&&(cc.mandatory=cc.mandatory||{},cc.mandatory[oldname_(mix,key)]=r[mix])}))}})),c.advanced&&(cc.optional=(cc.optional||[]).concat(c.advanced)),cc},shimConstraints_=function(constraints,func){if(browserDetails.version>=61)return func(constraints);if((constraints=JSON.parse(JSON.stringify(constraints)))&&"object"===_typeof(constraints.audio)){var remap=function(obj,a,b){a in obj&&!(b in obj)&&(obj[b]=obj[a],delete obj[a])};remap((constraints=JSON.parse(JSON.stringify(constraints))).audio,"autoGainControl","googAutoGainControl"),remap(constraints.audio,"noiseSuppression","googNoiseSuppression"),constraints.audio=constraintsToChrome_(constraints.audio)}if(constraints&&"object"===_typeof(constraints.video)){var face=constraints.video.facingMode;face=face&&("object"===(void 0===face?"undefined":_typeof(face))?face:{ideal:face});var getSupportedFacingModeLies=browserDetails.version<66;if(face&&("user"===face.exact||"environment"===face.exact||"user"===face.ideal||"environment"===face.ideal)&&(!navigator.mediaDevices.getSupportedConstraints||!navigator.mediaDevices.getSupportedConstraints().facingMode||getSupportedFacingModeLies)){delete constraints.video.facingMode;var matches=void 0;if("environment"===face.exact||"environment"===face.ideal?matches=["back","rear"]:"user"!==face.exact&&"user"!==face.ideal||(matches=["front"]),matches)return navigator.mediaDevices.enumerateDevices().then((function(devices){var dev=(devices=devices.filter((function(d){return"videoinput"===d.kind}))).find((function(d){return matches.some((function(match){return d.label.toLowerCase().includes(match)}))}));return!dev&&devices.length&&matches.includes("back")&&(dev=devices[devices.length-1]),dev&&(constraints.video.deviceId=face.exact?{exact:dev.deviceId}:{ideal:dev.deviceId}),constraints.video=constraintsToChrome_(constraints.video),logging("chrome: "+JSON.stringify(constraints)),func(constraints)}))}constraints.video=constraintsToChrome_(constraints.video)}return logging("chrome: "+JSON.stringify(constraints)),func(constraints)},shimError_=function(e){return browserDetails.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(navigator.getUserMedia=function(constraints,onSuccess,onError){shimConstraints_(constraints,(function(c){navigator.webkitGetUserMedia(c,onSuccess,(function(e){onError&&onError(shimError_(e))}))}))}.bind(navigator),navigator.mediaDevices.getUserMedia){var origGetUserMedia=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(cs){return shimConstraints_(cs,(function(c){return origGetUserMedia(c).then((function(stream){if(c.audio&&!stream.getAudioTracks().length||c.video&&!stream.getVideoTracks().length)throw stream.getTracks().forEach((function(track){track.stop()})),new DOMException("","NotFoundError");return stream}),(function(e){return Promise.reject(shimError_(e))}))}))}}};var utils=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../utils.js"));var logging=utils.log},{"../utils.js":15}],6:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)};exports.shimRTCIceCandidate=function(window){if(!window.RTCIceCandidate||window.RTCIceCandidate&&"foundation"in window.RTCIceCandidate.prototype)return;var NativeRTCIceCandidate=window.RTCIceCandidate;window.RTCIceCandidate=function(args){if("object"===(void 0===args?"undefined":_typeof(args))&&args.candidate&&0===args.candidate.indexOf("a=")&&((args=JSON.parse(JSON.stringify(args))).candidate=args.candidate.substr(2)),args.candidate&&args.candidate.length){var nativeCandidate=new NativeRTCIceCandidate(args),parsedCandidate=_sdp2.default.parseCandidate(args.candidate),augmentedCandidate=Object.assign(nativeCandidate,parsedCandidate);return augmentedCandidate.toJSON=function(){return{candidate:augmentedCandidate.candidate,sdpMid:augmentedCandidate.sdpMid,sdpMLineIndex:augmentedCandidate.sdpMLineIndex,usernameFragment:augmentedCandidate.usernameFragment}},augmentedCandidate}return new NativeRTCIceCandidate(args)},window.RTCIceCandidate.prototype=NativeRTCIceCandidate.prototype,utils.wrapPeerConnectionEvent(window,"icecandidate",(function(e){return e.candidate&&Object.defineProperty(e,"candidate",{value:new window.RTCIceCandidate(e.candidate),writable:"false"}),e}))},exports.shimMaxMessageSize=function(window){if(!window.RTCPeerConnection)return;var browserDetails=utils.detectBrowser(window);"sctp"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var sctpInDescription=function(description){if(!description||!description.sdp)return!1;var sections=_sdp2.default.splitSections(description.sdp);return sections.shift(),sections.some((function(mediaSection){var mLine=_sdp2.default.parseMLine(mediaSection);return mLine&&"application"===mLine.kind&&-1!==mLine.protocol.indexOf("SCTP")}))},getRemoteFirefoxVersion=function(description){var match=description.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===match||match.length<2)return-1;var version=parseInt(match[1],10);return version!=version?-1:version},getCanSendMaxMessageSize=function(remoteIsFirefox){var canSendMaxMessageSize=65536;return"firefox"===browserDetails.browser&&(canSendMaxMessageSize=browserDetails.version<57?-1===remoteIsFirefox?16384:2147483637:browserDetails.version<60?57===browserDetails.version?65535:65536:2147483637),canSendMaxMessageSize},getMaxMessageSize=function(description,remoteIsFirefox){var maxMessageSize=65536;"firefox"===browserDetails.browser&&57===browserDetails.version&&(maxMessageSize=65535);var match=_sdp2.default.matchPrefix(description.sdp,"a=max-message-size:");return match.length>0?maxMessageSize=parseInt(match[0].substr(19),10):"firefox"===browserDetails.browser&&-1!==remoteIsFirefox&&(maxMessageSize=2147483637),maxMessageSize},origSetRemoteDescription=window.RTCPeerConnection.prototype.setRemoteDescription;window.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===browserDetails.browser&&browserDetails.version>=76){var _getConfiguration=this.getConfiguration(),sdpSemantics=_getConfiguration.sdpSemantics;"plan-b"===sdpSemantics&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(sctpInDescription(arguments[0])){var isFirefox=getRemoteFirefoxVersion(arguments[0]),canSendMMS=getCanSendMaxMessageSize(isFirefox),remoteMMS=getMaxMessageSize(arguments[0],isFirefox),maxMessageSize=void 0;maxMessageSize=0===canSendMMS&&0===remoteMMS?Number.POSITIVE_INFINITY:0===canSendMMS||0===remoteMMS?Math.max(canSendMMS,remoteMMS):Math.min(canSendMMS,remoteMMS);var sctp={};Object.defineProperty(sctp,"maxMessageSize",{get:function(){return maxMessageSize}}),this._sctp=sctp}return origSetRemoteDescription.apply(this,arguments)}},exports.shimSendThrowTypeError=function(window){if(!window.RTCPeerConnection||!("createDataChannel"in window.RTCPeerConnection.prototype))return;function wrapDcSend(dc,pc){var origDataChannelSend=dc.send;dc.send=function(){var data=arguments[0],length=data.length||data.size||data.byteLength;if("open"===dc.readyState&&pc.sctp&&length>pc.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+pc.sctp.maxMessageSize+" bytes)");return origDataChannelSend.apply(dc,arguments)}}var origCreateDataChannel=window.RTCPeerConnection.prototype.createDataChannel;window.RTCPeerConnection.prototype.createDataChannel=function(){var dataChannel=origCreateDataChannel.apply(this,arguments);return wrapDcSend(dataChannel,this),dataChannel},utils.wrapPeerConnectionEvent(window,"datachannel",(function(e){return wrapDcSend(e.channel,e.target),e}))},exports.shimConnectionState=function(window){if(!window.RTCPeerConnection||"connectionState"in window.RTCPeerConnection.prototype)return;var proto=window.RTCPeerConnection.prototype;Object.defineProperty(proto,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(proto,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(cb){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),cb&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=cb)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(method){var origMethod=proto[method];proto[method]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var pc=e.target;if(pc._lastConnectionState!==pc.connectionState){pc._lastConnectionState=pc.connectionState;var newEvent=new Event("connectionstatechange",e);pc.dispatchEvent(newEvent)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),origMethod.apply(this,arguments)}}))},exports.removeAllowExtmapMixed=function(window){if(!window.RTCPeerConnection)return;var browserDetails=utils.detectBrowser(window);if("chrome"===browserDetails.browser&&browserDetails.version>=71)return;var nativeSRD=window.RTCPeerConnection.prototype.setRemoteDescription;window.RTCPeerConnection.prototype.setRemoteDescription=function(desc){return desc&&desc.sdp&&-1!==desc.sdp.indexOf("\na=extmap-allow-mixed")&&(desc.sdp=desc.sdp.split("\n").filter((function(line){return"a=extmap-allow-mixed"!==line.trim()})).join("\n")),nativeSRD.apply(this,arguments)}};var obj,_sdp=require("sdp"),_sdp2=(obj=_sdp)&&obj.__esModule?obj:{default:obj},utils=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("./utils"))},{"./utils":15,sdp:17}],7:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimGetDisplayMedia=exports.shimGetUserMedia=void 0;var _getusermedia=require("./getusermedia");Object.defineProperty(exports,"shimGetUserMedia",{enumerable:!0,get:function(){return _getusermedia.shimGetUserMedia}});var _getdisplaymedia=require("./getdisplaymedia");Object.defineProperty(exports,"shimGetDisplayMedia",{enumerable:!0,get:function(){return _getdisplaymedia.shimGetDisplayMedia}}),exports.shimPeerConnection=function(window){var browserDetails=utils.detectBrowser(window);if(window.RTCIceGatherer&&(window.RTCIceCandidate||(window.RTCIceCandidate=function(args){return args}),window.RTCSessionDescription||(window.RTCSessionDescription=function(args){return args}),browserDetails.version<15025)){var origMSTEnabled=Object.getOwnPropertyDescriptor(window.MediaStreamTrack.prototype,"enabled");Object.defineProperty(window.MediaStreamTrack.prototype,"enabled",{set:function(value){origMSTEnabled.set.call(this,value);var ev=new Event("enabled");ev.enabled=value,this.dispatchEvent(ev)}})}window.RTCRtpSender&&!("dtmf"in window.RTCRtpSender.prototype)&&Object.defineProperty(window.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new window.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}});window.RTCDtmfSender&&!window.RTCDTMFSender&&(window.RTCDTMFSender=window.RTCDtmfSender);var RTCPeerConnectionShim=(0,_rtcpeerconnectionShim2.default)(window,browserDetails.version);window.RTCPeerConnection=function(config){return config&&config.iceServers&&(config.iceServers=(0,_filtericeservers.filterIceServers)(config.iceServers,browserDetails.version),utils.log("ICE servers after filtering:",config.iceServers)),new RTCPeerConnectionShim(config)},window.RTCPeerConnection.prototype=RTCPeerConnectionShim.prototype},exports.shimReplaceTrack=function(window){window.RTCRtpSender&&!("replaceTrack"in window.RTCRtpSender.prototype)&&(window.RTCRtpSender.prototype.replaceTrack=window.RTCRtpSender.prototype.setTrack)};var obj,utils=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../utils")),_filtericeservers=require("./filtericeservers"),_rtcpeerconnectionShim=require("rtcpeerconnection-shim"),_rtcpeerconnectionShim2=(obj=_rtcpeerconnectionShim)&&obj.__esModule?obj:{default:obj}},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.filterIceServers=function(iceServers,edgeVersion){var hasTurn=!1;return(iceServers=JSON.parse(JSON.stringify(iceServers))).filter((function(server){if(server&&(server.urls||server.url)){var urls=server.urls||server.url;server.url&&!server.urls&&utils.deprecated("RTCIceServer.url","RTCIceServer.urls");var isString="string"==typeof urls;return isString&&(urls=[urls]),urls=urls.filter((function(url){if(0===url.indexOf("stun:"))return!1;var validTurn=url.startsWith("turn")&&!url.startsWith("turn:[")&&url.includes("transport=udp");return validTurn&&!hasTurn?(hasTurn=!0,!0):validTurn&&!hasTurn})),delete server.url,server.urls=isString?urls[0]:urls,!!urls.length}}))};var utils=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../utils"))},{"../utils":15}],9:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimGetDisplayMedia=function(window){if(!("getDisplayMedia"in window.navigator))return;if(!window.navigator.mediaDevices)return;if(window.navigator.mediaDevices&&"getDisplayMedia"in window.navigator.mediaDevices)return;window.navigator.mediaDevices.getDisplayMedia=window.navigator.getDisplayMedia.bind(window.navigator)}},{}],10:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimGetUserMedia=function(window){var navigator=window&&window.navigator,origGetUserMedia=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(c){return origGetUserMedia(c).catch((function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))}))}}},{}],11:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimGetDisplayMedia=exports.shimGetUserMedia=void 0;var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_getusermedia=require("./getusermedia");Object.defineProperty(exports,"shimGetUserMedia",{enumerable:!0,get:function(){return _getusermedia.shimGetUserMedia}});var _getdisplaymedia=require("./getdisplaymedia");Object.defineProperty(exports,"shimGetDisplayMedia",{enumerable:!0,get:function(){return _getdisplaymedia.shimGetDisplayMedia}}),exports.shimOnTrack=function(window){"object"===(void 0===window?"undefined":_typeof(window))&&window.RTCTrackEvent&&"receiver"in window.RTCTrackEvent.prototype&&!("transceiver"in window.RTCTrackEvent.prototype)&&Object.defineProperty(window.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},exports.shimPeerConnection=function(window){var browserDetails=utils.detectBrowser(window);if("object"!==(void 0===window?"undefined":_typeof(window))||!window.RTCPeerConnection&&!window.mozRTCPeerConnection)return;!window.RTCPeerConnection&&window.mozRTCPeerConnection&&(window.RTCPeerConnection=window.mozRTCPeerConnection);browserDetails.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(method){var nativeMethod=window.RTCPeerConnection.prototype[method],methodObj=function(obj,key,value){key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value;return obj}({},method,(function(){return arguments[0]=new("addIceCandidate"===method?window.RTCIceCandidate:window.RTCSessionDescription)(arguments[0]),nativeMethod.apply(this,arguments)}));window.RTCPeerConnection.prototype[method]=methodObj[method]}));if(browserDetails.version<68){var nativeAddIceCandidate=window.RTCPeerConnection.prototype.addIceCandidate;window.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?arguments[0]&&""===arguments[0].candidate?Promise.resolve():nativeAddIceCandidate.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}var modernStatsTypes={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},nativeGetStats=window.RTCPeerConnection.prototype.getStats;window.RTCPeerConnection.prototype.getStats=function(){var _arguments=Array.prototype.slice.call(arguments),selector=_arguments[0],onSucc=_arguments[1],onErr=_arguments[2];return nativeGetStats.apply(this,[selector||null]).then((function(stats){if(browserDetails.version<53&&!onSucc)try{stats.forEach((function(stat){stat.type=modernStatsTypes[stat.type]||stat.type}))}catch(e){if("TypeError"!==e.name)throw e;stats.forEach((function(stat,i){stats.set(i,Object.assign({},stat,{type:modernStatsTypes[stat.type]||stat.type}))}))}return stats})).then(onSucc,onErr)}},exports.shimSenderGetStats=function(window){if("object"!==(void 0===window?"undefined":_typeof(window))||!window.RTCPeerConnection||!window.RTCRtpSender)return;if(window.RTCRtpSender&&"getStats"in window.RTCRtpSender.prototype)return;var origGetSenders=window.RTCPeerConnection.prototype.getSenders;origGetSenders&&(window.RTCPeerConnection.prototype.getSenders=function(){var _this=this,senders=origGetSenders.apply(this,[]);return senders.forEach((function(sender){return sender._pc=_this})),senders});var origAddTrack=window.RTCPeerConnection.prototype.addTrack;origAddTrack&&(window.RTCPeerConnection.prototype.addTrack=function(){var sender=origAddTrack.apply(this,arguments);return sender._pc=this,sender});window.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}},exports.shimReceiverGetStats=function(window){if("object"!==(void 0===window?"undefined":_typeof(window))||!window.RTCPeerConnection||!window.RTCRtpSender)return;if(window.RTCRtpSender&&"getStats"in window.RTCRtpReceiver.prototype)return;var origGetReceivers=window.RTCPeerConnection.prototype.getReceivers;origGetReceivers&&(window.RTCPeerConnection.prototype.getReceivers=function(){var _this2=this,receivers=origGetReceivers.apply(this,[]);return receivers.forEach((function(receiver){return receiver._pc=_this2})),receivers});utils.wrapPeerConnectionEvent(window,"track",(function(e){return e.receiver._pc=e.srcElement,e})),window.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}},exports.shimRemoveStream=function(window){if(!window.RTCPeerConnection||"removeStream"in window.RTCPeerConnection.prototype)return;window.RTCPeerConnection.prototype.removeStream=function(stream){var _this3=this;utils.deprecated("removeStream","removeTrack"),this.getSenders().forEach((function(sender){sender.track&&stream.getTracks().includes(sender.track)&&_this3.removeTrack(sender)}))}},exports.shimRTCDataChannel=function(window){window.DataChannel&&!window.RTCDataChannel&&(window.RTCDataChannel=window.DataChannel)},exports.shimAddTransceiver=function(window){if("object"!==(void 0===window?"undefined":_typeof(window))||!window.RTCPeerConnection)return;var origAddTransceiver=window.RTCPeerConnection.prototype.addTransceiver;origAddTransceiver&&(window.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var initParameters=arguments[1],shouldPerformCheck=initParameters&&"sendEncodings"in initParameters;shouldPerformCheck&&initParameters.sendEncodings.forEach((function(encodingParam){if("rid"in encodingParam){if(!/^[a-z0-9]{0,16}$/i.test(encodingParam.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in encodingParam&&!(parseFloat(encodingParam.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in encodingParam&&!(parseFloat(encodingParam.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));var transceiver=origAddTransceiver.apply(this,arguments);if(shouldPerformCheck){var sender=transceiver.sender,params=sender.getParameters();"encodings"in params||(params.encodings=initParameters.sendEncodings,this.setParametersPromises.push(sender.setParameters(params).catch((function(){}))))}return transceiver})},exports.shimCreateOffer=function(window){if("object"!==(void 0===window?"undefined":_typeof(window))||!window.RTCPeerConnection)return;var origCreateOffer=window.RTCPeerConnection.prototype.createOffer;window.RTCPeerConnection.prototype.createOffer=function(){var _this4=this,_arguments2=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return origCreateOffer.apply(_this4,_arguments2)})).finally((function(){_this4.setParametersPromises=[]})):origCreateOffer.apply(this,arguments)}},exports.shimCreateAnswer=function(window){if("object"!==(void 0===window?"undefined":_typeof(window))||!window.RTCPeerConnection)return;var origCreateAnswer=window.RTCPeerConnection.prototype.createAnswer;window.RTCPeerConnection.prototype.createAnswer=function(){var _this5=this,_arguments3=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return origCreateAnswer.apply(_this5,_arguments3)})).finally((function(){_this5.setParametersPromises=[]})):origCreateAnswer.apply(this,arguments)}};var utils=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../utils"))},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimGetDisplayMedia=function(window,preferredMediaSource){if(window.navigator.mediaDevices&&"getDisplayMedia"in window.navigator.mediaDevices)return;if(!window.navigator.mediaDevices)return;window.navigator.mediaDevices.getDisplayMedia=function(constraints){if(!constraints||!constraints.video){var err=new DOMException("getDisplayMedia without video constraints is undefined");return err.name="NotFoundError",err.code=8,Promise.reject(err)}return!0===constraints.video?constraints.video={mediaSource:preferredMediaSource}:constraints.video.mediaSource=preferredMediaSource,window.navigator.mediaDevices.getUserMedia(constraints)}}},{}],13:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)};exports.shimGetUserMedia=function(window){var browserDetails=utils.detectBrowser(window),navigator=window&&window.navigator,MediaStreamTrack=window&&window.MediaStreamTrack;if(navigator.getUserMedia=function(constraints,onSuccess,onError){utils.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),navigator.mediaDevices.getUserMedia(constraints).then(onSuccess,onError)},!(browserDetails.version>55&&"autoGainControl"in navigator.mediaDevices.getSupportedConstraints())){var remap=function(obj,a,b){a in obj&&!(b in obj)&&(obj[b]=obj[a],delete obj[a])},nativeGetUserMedia=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);if(navigator.mediaDevices.getUserMedia=function(c){return"object"===(void 0===c?"undefined":_typeof(c))&&"object"===_typeof(c.audio)&&(c=JSON.parse(JSON.stringify(c)),remap(c.audio,"autoGainControl","mozAutoGainControl"),remap(c.audio,"noiseSuppression","mozNoiseSuppression")),nativeGetUserMedia(c)},MediaStreamTrack&&MediaStreamTrack.prototype.getSettings){var nativeGetSettings=MediaStreamTrack.prototype.getSettings;MediaStreamTrack.prototype.getSettings=function(){var obj=nativeGetSettings.apply(this,arguments);return remap(obj,"mozAutoGainControl","autoGainControl"),remap(obj,"mozNoiseSuppression","noiseSuppression"),obj}}if(MediaStreamTrack&&MediaStreamTrack.prototype.applyConstraints){var nativeApplyConstraints=MediaStreamTrack.prototype.applyConstraints;MediaStreamTrack.prototype.applyConstraints=function(c){return"audio"===this.kind&&"object"===(void 0===c?"undefined":_typeof(c))&&(c=JSON.parse(JSON.stringify(c)),remap(c,"autoGainControl","mozAutoGainControl"),remap(c,"noiseSuppression","mozNoiseSuppression")),nativeApplyConstraints.apply(this,[c])}}}};var utils=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../utils"))},{"../utils":15}],14:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)};exports.shimLocalStreamsAPI=function(window){if("object"!==(void 0===window?"undefined":_typeof(window))||!window.RTCPeerConnection)return;"getLocalStreams"in window.RTCPeerConnection.prototype||(window.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams});if(!("addStream"in window.RTCPeerConnection.prototype)){var _addTrack=window.RTCPeerConnection.prototype.addTrack;window.RTCPeerConnection.prototype.addStream=function(stream){var _this=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(stream)||this._localStreams.push(stream),stream.getAudioTracks().forEach((function(track){return _addTrack.call(_this,track,stream)})),stream.getVideoTracks().forEach((function(track){return _addTrack.call(_this,track,stream)}))},window.RTCPeerConnection.prototype.addTrack=function(track){var stream=arguments[1];return stream&&(this._localStreams?this._localStreams.includes(stream)||this._localStreams.push(stream):this._localStreams=[stream]),_addTrack.apply(this,arguments)}}"removeStream"in window.RTCPeerConnection.prototype||(window.RTCPeerConnection.prototype.removeStream=function(stream){var _this2=this;this._localStreams||(this._localStreams=[]);var index=this._localStreams.indexOf(stream);if(-1!==index){this._localStreams.splice(index,1);var tracks=stream.getTracks();this.getSenders().forEach((function(sender){tracks.includes(sender.track)&&_this2.removeTrack(sender)}))}})},exports.shimRemoteStreamsAPI=function(window){if("object"!==(void 0===window?"undefined":_typeof(window))||!window.RTCPeerConnection)return;"getRemoteStreams"in window.RTCPeerConnection.prototype||(window.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]});if(!("onaddstream"in window.RTCPeerConnection.prototype)){Object.defineProperty(window.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(f){var _this3=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=f),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(stream){if(_this3._remoteStreams||(_this3._remoteStreams=[]),!_this3._remoteStreams.includes(stream)){_this3._remoteStreams.push(stream);var event=new Event("addstream");event.stream=stream,_this3.dispatchEvent(event)}}))})}});var origSetRemoteDescription=window.RTCPeerConnection.prototype.setRemoteDescription;window.RTCPeerConnection.prototype.setRemoteDescription=function(){var pc=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(stream){if(pc._remoteStreams||(pc._remoteStreams=[]),!(pc._remoteStreams.indexOf(stream)>=0)){pc._remoteStreams.push(stream);var event=new Event("addstream");event.stream=stream,pc.dispatchEvent(event)}}))}),origSetRemoteDescription.apply(pc,arguments)}}},exports.shimCallbacksAPI=function(window){if("object"!==(void 0===window?"undefined":_typeof(window))||!window.RTCPeerConnection)return;var prototype=window.RTCPeerConnection.prototype,origCreateOffer=prototype.createOffer,origCreateAnswer=prototype.createAnswer,setLocalDescription=prototype.setLocalDescription,setRemoteDescription=prototype.setRemoteDescription,addIceCandidate=prototype.addIceCandidate;prototype.createOffer=function(successCallback,failureCallback){var options=arguments.length>=2?arguments[2]:arguments[0],promise=origCreateOffer.apply(this,[options]);return failureCallback?(promise.then(successCallback,failureCallback),Promise.resolve()):promise},prototype.createAnswer=function(successCallback,failureCallback){var options=arguments.length>=2?arguments[2]:arguments[0],promise=origCreateAnswer.apply(this,[options]);return failureCallback?(promise.then(successCallback,failureCallback),Promise.resolve()):promise};var withCallback=function(description,successCallback,failureCallback){var promise=setLocalDescription.apply(this,[description]);return failureCallback?(promise.then(successCallback,failureCallback),Promise.resolve()):promise};prototype.setLocalDescription=withCallback,withCallback=function(description,successCallback,failureCallback){var promise=setRemoteDescription.apply(this,[description]);return failureCallback?(promise.then(successCallback,failureCallback),Promise.resolve()):promise},prototype.setRemoteDescription=withCallback,withCallback=function(candidate,successCallback,failureCallback){var promise=addIceCandidate.apply(this,[candidate]);return failureCallback?(promise.then(successCallback,failureCallback),Promise.resolve()):promise},prototype.addIceCandidate=withCallback},exports.shimGetUserMedia=function(window){var navigator=window&&window.navigator;if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){var mediaDevices=navigator.mediaDevices,_getUserMedia=mediaDevices.getUserMedia.bind(mediaDevices);navigator.mediaDevices.getUserMedia=function(constraints){return _getUserMedia(shimConstraints(constraints))}}!navigator.getUserMedia&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&(navigator.getUserMedia=function(constraints,cb,errcb){navigator.mediaDevices.getUserMedia(constraints).then(cb,errcb)}.bind(navigator))},exports.shimConstraints=shimConstraints,exports.shimRTCIceServerUrls=function(window){var OrigPeerConnection=window.RTCPeerConnection;window.RTCPeerConnection=function(pcConfig,pcConstraints){if(pcConfig&&pcConfig.iceServers){for(var newIceServers=[],i=0;i<pcConfig.iceServers.length;i++){var server=pcConfig.iceServers[i];!server.hasOwnProperty("urls")&&server.hasOwnProperty("url")?(utils.deprecated("RTCIceServer.url","RTCIceServer.urls"),(server=JSON.parse(JSON.stringify(server))).urls=server.url,delete server.url,newIceServers.push(server)):newIceServers.push(pcConfig.iceServers[i])}pcConfig.iceServers=newIceServers}return new OrigPeerConnection(pcConfig,pcConstraints)},window.RTCPeerConnection.prototype=OrigPeerConnection.prototype,"generateCertificate"in window.RTCPeerConnection&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return OrigPeerConnection.generateCertificate}})},exports.shimTrackEventTransceiver=function(window){"object"===(void 0===window?"undefined":_typeof(window))&&window.RTCTrackEvent&&"receiver"in window.RTCTrackEvent.prototype&&!("transceiver"in window.RTCTrackEvent.prototype)&&Object.defineProperty(window.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},exports.shimCreateOfferLegacy=function(window){var origCreateOffer=window.RTCPeerConnection.prototype.createOffer;window.RTCPeerConnection.prototype.createOffer=function(offerOptions){if(offerOptions){void 0!==offerOptions.offerToReceiveAudio&&(offerOptions.offerToReceiveAudio=!!offerOptions.offerToReceiveAudio);var audioTransceiver=this.getTransceivers().find((function(transceiver){return"audio"===transceiver.receiver.track.kind}));!1===offerOptions.offerToReceiveAudio&&audioTransceiver?"sendrecv"===audioTransceiver.direction?audioTransceiver.setDirection?audioTransceiver.setDirection("sendonly"):audioTransceiver.direction="sendonly":"recvonly"===audioTransceiver.direction&&(audioTransceiver.setDirection?audioTransceiver.setDirection("inactive"):audioTransceiver.direction="inactive"):!0!==offerOptions.offerToReceiveAudio||audioTransceiver||this.addTransceiver("audio"),void 0!==offerOptions.offerToReceiveVideo&&(offerOptions.offerToReceiveVideo=!!offerOptions.offerToReceiveVideo);var videoTransceiver=this.getTransceivers().find((function(transceiver){return"video"===transceiver.receiver.track.kind}));!1===offerOptions.offerToReceiveVideo&&videoTransceiver?"sendrecv"===videoTransceiver.direction?videoTransceiver.setDirection?videoTransceiver.setDirection("sendonly"):videoTransceiver.direction="sendonly":"recvonly"===videoTransceiver.direction&&(videoTransceiver.setDirection?videoTransceiver.setDirection("inactive"):videoTransceiver.direction="inactive"):!0!==offerOptions.offerToReceiveVideo||videoTransceiver||this.addTransceiver("video")}return origCreateOffer.apply(this,arguments)}};var utils=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../utils"));function shimConstraints(constraints){return constraints&&void 0!==constraints.video?Object.assign({},constraints,{video:utils.compactObject(constraints.video)}):constraints}},{"../utils":15}],15:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)};exports.extractVersion=extractVersion,exports.wrapPeerConnectionEvent=function(window,eventNameToWrap,wrapper){if(!window.RTCPeerConnection)return;var proto=window.RTCPeerConnection.prototype,nativeAddEventListener=proto.addEventListener;proto.addEventListener=function(nativeEventName,cb){if(nativeEventName!==eventNameToWrap)return nativeAddEventListener.apply(this,arguments);var wrappedCallback=function(e){var modifiedEvent=wrapper(e);modifiedEvent&&cb(modifiedEvent)};return this._eventMap=this._eventMap||{},this._eventMap[cb]=wrappedCallback,nativeAddEventListener.apply(this,[nativeEventName,wrappedCallback])};var nativeRemoveEventListener=proto.removeEventListener;proto.removeEventListener=function(nativeEventName,cb){if(nativeEventName!==eventNameToWrap||!this._eventMap||!this._eventMap[cb])return nativeRemoveEventListener.apply(this,arguments);var unwrappedCb=this._eventMap[cb];return delete this._eventMap[cb],nativeRemoveEventListener.apply(this,[nativeEventName,unwrappedCb])},Object.defineProperty(proto,"on"+eventNameToWrap,{get:function(){return this["_on"+eventNameToWrap]},set:function(cb){this["_on"+eventNameToWrap]&&(this.removeEventListener(eventNameToWrap,this["_on"+eventNameToWrap]),delete this["_on"+eventNameToWrap]),cb&&this.addEventListener(eventNameToWrap,this["_on"+eventNameToWrap]=cb)},enumerable:!0,configurable:!0})},exports.disableLog=function(bool){if("boolean"!=typeof bool)return new Error("Argument type: "+(void 0===bool?"undefined":_typeof(bool))+". Please use a boolean.");return logDisabled_=bool,bool?"adapter.js logging disabled":"adapter.js logging enabled"},exports.disableWarnings=function(bool){if("boolean"!=typeof bool)return new Error("Argument type: "+(void 0===bool?"undefined":_typeof(bool))+". Please use a boolean.");return deprecationWarnings_=!bool,"adapter.js deprecation warnings "+(bool?"disabled":"enabled")},exports.log=function(){if("object"===("undefined"==typeof window?"undefined":_typeof(window))){if(logDisabled_)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},exports.deprecated=function(oldMethod,newMethod){if(!deprecationWarnings_)return;console.warn(oldMethod+" is deprecated, please use "+newMethod+" instead.")},exports.detectBrowser=function(window){var navigator=window.navigator,result={browser:null,version:null};if(void 0===window||!window.navigator)return result.browser="Not a browser.",result;if(navigator.mozGetUserMedia)result.browser="firefox",result.version=extractVersion(navigator.userAgent,/Firefox\/(\d+)\./,1);else if(navigator.webkitGetUserMedia||!1===window.isSecureContext&&window.webkitRTCPeerConnection&&!window.RTCIceGatherer)result.browser="chrome",result.version=extractVersion(navigator.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))result.browser="edge",result.version=extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!window.RTCPeerConnection||!navigator.userAgent.match(/AppleWebKit\/(\d+)\./))return result.browser="Not a supported browser.",result;result.browser="safari",result.version=extractVersion(navigator.userAgent,/AppleWebKit\/(\d+)\./,1),result.supportsUnifiedPlan=window.RTCRtpTransceiver&&"currentDirection"in window.RTCRtpTransceiver.prototype}return result},exports.compactObject=function compactObject(data){if(!isObject(data))return data;return Object.keys(data).reduce((function(accumulator,key){var isObj=isObject(data[key]),value=isObj?compactObject(data[key]):data[key],isEmptyObject=isObj&&!Object.keys(value).length;return void 0===value||isEmptyObject?accumulator:Object.assign(accumulator,function(obj,key,value){key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value;return obj}({},key,value))}),{})},exports.walkStats=walkStats,exports.filterStats=function(result,track,outbound){var streamStatsType=outbound?"outbound-rtp":"inbound-rtp",filteredResult=new Map;if(null===track)return filteredResult;var trackStats=[];return result.forEach((function(value){"track"===value.type&&value.trackIdentifier===track.id&&trackStats.push(value)})),trackStats.forEach((function(trackStat){result.forEach((function(stats){stats.type===streamStatsType&&stats.trackId===trackStat.id&&walkStats(result,stats,filteredResult)}))})),filteredResult};var logDisabled_=!0,deprecationWarnings_=!0;function extractVersion(uastring,expr,pos){var match=uastring.match(expr);return match&&match.length>=pos&&parseInt(match[pos],10)}function isObject(val){return"[object Object]"===Object.prototype.toString.call(val)}function walkStats(stats,base,resultSet){base&&!resultSet.has(base.id)&&(resultSet.set(base.id,base),Object.keys(base).forEach((function(name){name.endsWith("Id")?walkStats(stats,stats.get(base[name]),resultSet):name.endsWith("Ids")&&base[name].forEach((function(id){walkStats(stats,stats.get(id),resultSet)}))})))}},{}],16:[function(require,module,exports){var SDPUtils=require("sdp");function writeMediaSection(transceiver,caps,type,stream,dtlsRole){var sdp=SDPUtils.writeRtpDescription(transceiver.kind,caps);if(sdp+=SDPUtils.writeIceParameters(transceiver.iceGatherer.getLocalParameters()),sdp+=SDPUtils.writeDtlsParameters(transceiver.dtlsTransport.getLocalParameters(),"offer"===type?"actpass":dtlsRole||"active"),sdp+="a=mid:"+transceiver.mid+"\r\n",transceiver.rtpSender&&transceiver.rtpReceiver?sdp+="a=sendrecv\r\n":transceiver.rtpSender?sdp+="a=sendonly\r\n":transceiver.rtpReceiver?sdp+="a=recvonly\r\n":sdp+="a=inactive\r\n",transceiver.rtpSender){var trackId=transceiver.rtpSender._initialTrackId||transceiver.rtpSender.track.id;transceiver.rtpSender._initialTrackId=trackId;var msid="msid:"+(stream?stream.id:"-")+" "+trackId+"\r\n";sdp+="a="+msid,sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].ssrc+" "+msid,transceiver.sendEncodingParameters[0].rtx&&(sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].rtx.ssrc+" "+msid,sdp+="a=ssrc-group:FID "+transceiver.sendEncodingParameters[0].ssrc+" "+transceiver.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].ssrc+" cname:"+SDPUtils.localCName+"\r\n",transceiver.rtpSender&&transceiver.sendEncodingParameters[0].rtx&&(sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].rtx.ssrc+" cname:"+SDPUtils.localCName+"\r\n"),sdp}function getCommonCapabilities(localCapabilities,remoteCapabilities){var commonCapabilities={codecs:[],headerExtensions:[],fecMechanisms:[]},findCodecByPayloadType=function(pt,codecs){pt=parseInt(pt,10);for(var i=0;i<codecs.length;i++)if(codecs[i].payloadType===pt||codecs[i].preferredPayloadType===pt)return codecs[i]},rtxCapabilityMatches=function(lRtx,rRtx,lCodecs,rCodecs){var lCodec=findCodecByPayloadType(lRtx.parameters.apt,lCodecs),rCodec=findCodecByPayloadType(rRtx.parameters.apt,rCodecs);return lCodec&&rCodec&&lCodec.name.toLowerCase()===rCodec.name.toLowerCase()};return localCapabilities.codecs.forEach((function(lCodec){for(var i=0;i<remoteCapabilities.codecs.length;i++){var rCodec=remoteCapabilities.codecs[i];if(lCodec.name.toLowerCase()===rCodec.name.toLowerCase()&&lCodec.clockRate===rCodec.clockRate){if("rtx"===lCodec.name.toLowerCase()&&lCodec.parameters&&rCodec.parameters.apt&&!rtxCapabilityMatches(lCodec,rCodec,localCapabilities.codecs,remoteCapabilities.codecs))continue;(rCodec=JSON.parse(JSON.stringify(rCodec))).numChannels=Math.min(lCodec.numChannels,rCodec.numChannels),commonCapabilities.codecs.push(rCodec),rCodec.rtcpFeedback=rCodec.rtcpFeedback.filter((function(fb){for(var j=0;j<lCodec.rtcpFeedback.length;j++)if(lCodec.rtcpFeedback[j].type===fb.type&&lCodec.rtcpFeedback[j].parameter===fb.parameter)return!0;return!1}));break}}})),localCapabilities.headerExtensions.forEach((function(lHeaderExtension){for(var i=0;i<remoteCapabilities.headerExtensions.length;i++){var rHeaderExtension=remoteCapabilities.headerExtensions[i];if(lHeaderExtension.uri===rHeaderExtension.uri){commonCapabilities.headerExtensions.push(rHeaderExtension);break}}})),commonCapabilities}function isActionAllowedInSignalingState(action,type,signalingState){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[type][action].indexOf(signalingState)}function maybeAddCandidate(iceTransport,candidate){var alreadyAdded=iceTransport.getRemoteCandidates().find((function(remoteCandidate){return candidate.foundation===remoteCandidate.foundation&&candidate.ip===remoteCandidate.ip&&candidate.port===remoteCandidate.port&&candidate.priority===remoteCandidate.priority&&candidate.protocol===remoteCandidate.protocol&&candidate.type===remoteCandidate.type}));return alreadyAdded||iceTransport.addRemoteCandidate(candidate),!alreadyAdded}function makeError(name,description){var e=new Error(description);return e.name=name,e.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[name],e}module.exports=function(window,edgeVersion){function addTrackToStreamAndFireEvent(track,stream){stream.addTrack(track),stream.dispatchEvent(new window.MediaStreamTrackEvent("addtrack",{track:track}))}function fireAddTrack(pc,track,receiver,streams){var trackEvent=new Event("track");trackEvent.track=track,trackEvent.receiver=receiver,trackEvent.transceiver={receiver:receiver},trackEvent.streams=streams,window.setTimeout((function(){pc._dispatchEvent("track",trackEvent)}))}var RTCPeerConnection=function(config){var pc=this,_eventTarget=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(method){pc[method]=_eventTarget[method].bind(_eventTarget)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",config=JSON.parse(JSON.stringify(config||{})),this.usingBundle="max-bundle"===config.bundlePolicy,"negotiate"===config.rtcpMuxPolicy)throw makeError("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(config.rtcpMuxPolicy||(config.rtcpMuxPolicy="require"),config.iceTransportPolicy){case"all":case"relay":break;default:config.iceTransportPolicy="all"}switch(config.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:config.bundlePolicy="balanced"}if(config.iceServers=function(iceServers,edgeVersion){var hasTurn=!1;return(iceServers=JSON.parse(JSON.stringify(iceServers))).filter((function(server){if(server&&(server.urls||server.url)){var urls=server.urls||server.url;server.url&&!server.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var isString="string"==typeof urls;return isString&&(urls=[urls]),urls=urls.filter((function(url){return 0!==url.indexOf("turn:")||-1===url.indexOf("transport=udp")||-1!==url.indexOf("turn:[")||hasTurn?0===url.indexOf("stun:")&&edgeVersion>=14393&&-1===url.indexOf("?transport=udp"):(hasTurn=!0,!0)})),delete server.url,server.urls=isString?urls[0]:urls,!!urls.length}}))}(config.iceServers||[],edgeVersion),this._iceGatherers=[],config.iceCandidatePoolSize)for(var i=config.iceCandidatePoolSize;i>0;i--)this._iceGatherers.push(new window.RTCIceGatherer({iceServers:config.iceServers,gatherPolicy:config.iceTransportPolicy}));else config.iceCandidatePoolSize=0;this._config=config,this.transceivers=[],this._sdpSessionId=SDPUtils.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(RTCPeerConnection.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(RTCPeerConnection.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),RTCPeerConnection.prototype.onicecandidate=null,RTCPeerConnection.prototype.onaddstream=null,RTCPeerConnection.prototype.ontrack=null,RTCPeerConnection.prototype.onremovestream=null,RTCPeerConnection.prototype.onsignalingstatechange=null,RTCPeerConnection.prototype.oniceconnectionstatechange=null,RTCPeerConnection.prototype.onconnectionstatechange=null,RTCPeerConnection.prototype.onicegatheringstatechange=null,RTCPeerConnection.prototype.onnegotiationneeded=null,RTCPeerConnection.prototype.ondatachannel=null,RTCPeerConnection.prototype._dispatchEvent=function(name,event){this._isClosed||(this.dispatchEvent(event),"function"==typeof this["on"+name]&&this["on"+name](event))},RTCPeerConnection.prototype._emitGatheringStateChange=function(){var event=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",event)},RTCPeerConnection.prototype.getConfiguration=function(){return this._config},RTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},RTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams},RTCPeerConnection.prototype._createTransceiver=function(kind,doNotAdd){var hasBundleTransport=this.transceivers.length>0,transceiver={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:kind,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&hasBundleTransport)transceiver.iceTransport=this.transceivers[0].iceTransport,transceiver.dtlsTransport=this.transceivers[0].dtlsTransport;else{var transports=this._createIceAndDtlsTransports();transceiver.iceTransport=transports.iceTransport,transceiver.dtlsTransport=transports.dtlsTransport}return doNotAdd||this.transceivers.push(transceiver),transceiver},RTCPeerConnection.prototype.addTrack=function(track,stream){if(this._isClosed)throw makeError("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var transceiver;if(this.transceivers.find((function(s){return s.track===track})))throw makeError("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==track.kind||(transceiver=this.transceivers[i]);return transceiver||(transceiver=this._createTransceiver(track.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(stream)&&this.localStreams.push(stream),transceiver.track=track,transceiver.stream=stream,transceiver.rtpSender=new window.RTCRtpSender(track,transceiver.dtlsTransport),transceiver.rtpSender},RTCPeerConnection.prototype.addStream=function(stream){var pc=this;if(edgeVersion>=15025)stream.getTracks().forEach((function(track){pc.addTrack(track,stream)}));else{var clonedStream=stream.clone();stream.getTracks().forEach((function(track,idx){var clonedTrack=clonedStream.getTracks()[idx];track.addEventListener("enabled",(function(event){clonedTrack.enabled=event.enabled}))})),clonedStream.getTracks().forEach((function(track){pc.addTrack(track,clonedStream)}))}},RTCPeerConnection.prototype.removeTrack=function(sender){if(this._isClosed)throw makeError("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(sender instanceof window.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var transceiver=this.transceivers.find((function(t){return t.rtpSender===sender}));if(!transceiver)throw makeError("InvalidAccessError","Sender was not created by this connection.");var stream=transceiver.stream;transceiver.rtpSender.stop(),transceiver.rtpSender=null,transceiver.track=null,transceiver.stream=null,-1===this.transceivers.map((function(t){return t.stream})).indexOf(stream)&&this.localStreams.indexOf(stream)>-1&&this.localStreams.splice(this.localStreams.indexOf(stream),1),this._maybeFireNegotiationNeeded()},RTCPeerConnection.prototype.removeStream=function(stream){var pc=this;stream.getTracks().forEach((function(track){var sender=pc.getSenders().find((function(s){return s.track===track}));sender&&pc.removeTrack(sender)}))},RTCPeerConnection.prototype.getSenders=function(){return this.transceivers.filter((function(transceiver){return!!transceiver.rtpSender})).map((function(transceiver){return transceiver.rtpSender}))},RTCPeerConnection.prototype.getReceivers=function(){return this.transceivers.filter((function(transceiver){return!!transceiver.rtpReceiver})).map((function(transceiver){return transceiver.rtpReceiver}))},RTCPeerConnection.prototype._createIceGatherer=function(sdpMLineIndex,usingBundle){var pc=this;if(usingBundle&&sdpMLineIndex>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var iceGatherer=new window.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(iceGatherer,"state",{value:"new",writable:!0}),this.transceivers[sdpMLineIndex].bufferedCandidateEvents=[],this.transceivers[sdpMLineIndex].bufferCandidates=function(event){var end=!event.candidate||0===Object.keys(event.candidate).length;iceGatherer.state=end?"completed":"gathering",null!==pc.transceivers[sdpMLineIndex].bufferedCandidateEvents&&pc.transceivers[sdpMLineIndex].bufferedCandidateEvents.push(event)},iceGatherer.addEventListener("localcandidate",this.transceivers[sdpMLineIndex].bufferCandidates),iceGatherer},RTCPeerConnection.prototype._gather=function(mid,sdpMLineIndex){var pc=this,iceGatherer=this.transceivers[sdpMLineIndex].iceGatherer;if(!iceGatherer.onlocalcandidate){var bufferedCandidateEvents=this.transceivers[sdpMLineIndex].bufferedCandidateEvents;this.transceivers[sdpMLineIndex].bufferedCandidateEvents=null,iceGatherer.removeEventListener("localcandidate",this.transceivers[sdpMLineIndex].bufferCandidates),iceGatherer.onlocalcandidate=function(evt){if(!(pc.usingBundle&&sdpMLineIndex>0)){var event=new Event("icecandidate");event.candidate={sdpMid:mid,sdpMLineIndex:sdpMLineIndex};var cand=evt.candidate,end=!cand||0===Object.keys(cand).length;if(end)"new"!==iceGatherer.state&&"gathering"!==iceGatherer.state||(iceGatherer.state="completed");else{"new"===iceGatherer.state&&(iceGatherer.state="gathering"),cand.component=1,cand.ufrag=iceGatherer.getLocalParameters().usernameFragment;var serializedCandidate=SDPUtils.writeCandidate(cand);event.candidate=Object.assign(event.candidate,SDPUtils.parseCandidate(serializedCandidate)),event.candidate.candidate=serializedCandidate,event.candidate.toJSON=function(){return{candidate:event.candidate.candidate,sdpMid:event.candidate.sdpMid,sdpMLineIndex:event.candidate.sdpMLineIndex,usernameFragment:event.candidate.usernameFragment}}}var sections=SDPUtils.getMediaSections(pc._localDescription.sdp);sections[event.candidate.sdpMLineIndex]+=end?"a=end-of-candidates\r\n":"a="+event.candidate.candidate+"\r\n",pc._localDescription.sdp=SDPUtils.getDescription(pc._localDescription.sdp)+sections.join("");var complete=pc.transceivers.every((function(transceiver){return transceiver.iceGatherer&&"completed"===transceiver.iceGatherer.state}));"gathering"!==pc.iceGatheringState&&(pc.iceGatheringState="gathering",pc._emitGatheringStateChange()),end||pc._dispatchEvent("icecandidate",event),complete&&(pc._dispatchEvent("icecandidate",new Event("icecandidate")),pc.iceGatheringState="complete",pc._emitGatheringStateChange())}},window.setTimeout((function(){bufferedCandidateEvents.forEach((function(e){iceGatherer.onlocalcandidate(e)}))}),0)}},RTCPeerConnection.prototype._createIceAndDtlsTransports=function(){var pc=this,iceTransport=new window.RTCIceTransport(null);iceTransport.onicestatechange=function(){pc._updateIceConnectionState(),pc._updateConnectionState()};var dtlsTransport=new window.RTCDtlsTransport(iceTransport);return dtlsTransport.ondtlsstatechange=function(){pc._updateConnectionState()},dtlsTransport.onerror=function(){Object.defineProperty(dtlsTransport,"state",{value:"failed",writable:!0}),pc._updateConnectionState()},{iceTransport:iceTransport,dtlsTransport:dtlsTransport}},RTCPeerConnection.prototype._disposeIceAndDtlsTransports=function(sdpMLineIndex){var iceGatherer=this.transceivers[sdpMLineIndex].iceGatherer;iceGatherer&&(delete iceGatherer.onlocalcandidate,delete this.transceivers[sdpMLineIndex].iceGatherer);var iceTransport=this.transceivers[sdpMLineIndex].iceTransport;iceTransport&&(delete iceTransport.onicestatechange,delete this.transceivers[sdpMLineIndex].iceTransport);var dtlsTransport=this.transceivers[sdpMLineIndex].dtlsTransport;dtlsTransport&&(delete dtlsTransport.ondtlsstatechange,delete dtlsTransport.onerror,delete this.transceivers[sdpMLineIndex].dtlsTransport)},RTCPeerConnection.prototype._transceive=function(transceiver,send,recv){var params=getCommonCapabilities(transceiver.localCapabilities,transceiver.remoteCapabilities);send&&transceiver.rtpSender&&(params.encodings=transceiver.sendEncodingParameters,params.rtcp={cname:SDPUtils.localCName,compound:transceiver.rtcpParameters.compound},transceiver.recvEncodingParameters.length&&(params.rtcp.ssrc=transceiver.recvEncodingParameters[0].ssrc),transceiver.rtpSender.send(params)),recv&&transceiver.rtpReceiver&&params.codecs.length>0&&("video"===transceiver.kind&&transceiver.recvEncodingParameters&&edgeVersion<15019&&transceiver.recvEncodingParameters.forEach((function(p){delete p.rtx})),transceiver.recvEncodingParameters.length?params.encodings=transceiver.recvEncodingParameters:params.encodings=[{}],params.rtcp={compound:transceiver.rtcpParameters.compound},transceiver.rtcpParameters.cname&&(params.rtcp.cname=transceiver.rtcpParameters.cname),transceiver.sendEncodingParameters.length&&(params.rtcp.ssrc=transceiver.sendEncodingParameters[0].ssrc),transceiver.rtpReceiver.receive(params))},RTCPeerConnection.prototype.setLocalDescription=function(description){var sections,sessionpart,pc=this;if(-1===["offer","answer"].indexOf(description.type))return Promise.reject(makeError("TypeError",'Unsupported type "'+description.type+'"'));if(!isActionAllowedInSignalingState("setLocalDescription",description.type,pc.signalingState)||pc._isClosed)return Promise.reject(makeError("InvalidStateError","Can not set local "+description.type+" in state "+pc.signalingState));if("offer"===description.type)sections=SDPUtils.splitSections(description.sdp),sessionpart=sections.shift(),sections.forEach((function(mediaSection,sdpMLineIndex){var caps=SDPUtils.parseRtpParameters(mediaSection);pc.transceivers[sdpMLineIndex].localCapabilities=caps})),pc.transceivers.forEach((function(transceiver,sdpMLineIndex){pc._gather(transceiver.mid,sdpMLineIndex)}));else if("answer"===description.type){sections=SDPUtils.splitSections(pc._remoteDescription.sdp),sessionpart=sections.shift();var isIceLite=SDPUtils.matchPrefix(sessionpart,"a=ice-lite").length>0;sections.forEach((function(mediaSection,sdpMLineIndex){var transceiver=pc.transceivers[sdpMLineIndex],iceGatherer=transceiver.iceGatherer,iceTransport=transceiver.iceTransport,dtlsTransport=transceiver.dtlsTransport,localCapabilities=transceiver.localCapabilities,remoteCapabilities=transceiver.remoteCapabilities;if(!(SDPUtils.isRejected(mediaSection)&&0===SDPUtils.matchPrefix(mediaSection,"a=bundle-only").length)&&!transceiver.rejected){var remoteIceParameters=SDPUtils.getIceParameters(mediaSection,sessionpart),remoteDtlsParameters=SDPUtils.getDtlsParameters(mediaSection,sessionpart);isIceLite&&(remoteDtlsParameters.role="server"),pc.usingBundle&&0!==sdpMLineIndex||(pc._gather(transceiver.mid,sdpMLineIndex),"new"===iceTransport.state&&iceTransport.start(iceGatherer,remoteIceParameters,isIceLite?"controlling":"controlled"),"new"===dtlsTransport.state&&dtlsTransport.start(remoteDtlsParameters));var params=getCommonCapabilities(localCapabilities,remoteCapabilities);pc._transceive(transceiver,params.codecs.length>0,!1)}}))}return pc._localDescription={type:description.type,sdp:description.sdp},"offer"===description.type?pc._updateSignalingState("have-local-offer"):pc._updateSignalingState("stable"),Promise.resolve()},RTCPeerConnection.prototype.setRemoteDescription=function(description){var pc=this;if(-1===["offer","answer"].indexOf(description.type))return Promise.reject(makeError("TypeError",'Unsupported type "'+description.type+'"'));if(!isActionAllowedInSignalingState("setRemoteDescription",description.type,pc.signalingState)||pc._isClosed)return Promise.reject(makeError("InvalidStateError","Can not set remote "+description.type+" in state "+pc.signalingState));var streams={};pc.remoteStreams.forEach((function(stream){streams[stream.id]=stream}));var receiverList=[],sections=SDPUtils.splitSections(description.sdp),sessionpart=sections.shift(),isIceLite=SDPUtils.matchPrefix(sessionpart,"a=ice-lite").length>0,usingBundle=SDPUtils.matchPrefix(sessionpart,"a=group:BUNDLE ").length>0;pc.usingBundle=usingBundle;var iceOptions=SDPUtils.matchPrefix(sessionpart,"a=ice-options:")[0];return pc.canTrickleIceCandidates=!!iceOptions&&iceOptions.substr(14).split(" ").indexOf("trickle")>=0,sections.forEach((function(mediaSection,sdpMLineIndex){var lines=SDPUtils.splitLines(mediaSection),kind=SDPUtils.getKind(mediaSection),rejected=SDPUtils.isRejected(mediaSection)&&0===SDPUtils.matchPrefix(mediaSection,"a=bundle-only").length,protocol=lines[0].substr(2).split(" ")[2],direction=SDPUtils.getDirection(mediaSection,sessionpart),remoteMsid=SDPUtils.parseMsid(mediaSection),mid=SDPUtils.getMid(mediaSection)||SDPUtils.generateIdentifier();if(rejected||"application"===kind&&("DTLS/SCTP"===protocol||"UDP/DTLS/SCTP"===protocol))pc.transceivers[sdpMLineIndex]={mid:mid,kind:kind,protocol:protocol,rejected:!0};else{var transceiver,iceGatherer,iceTransport,dtlsTransport,rtpReceiver,sendEncodingParameters,recvEncodingParameters,localCapabilities,track;!rejected&&pc.transceivers[sdpMLineIndex]&&pc.transceivers[sdpMLineIndex].rejected&&(pc.transceivers[sdpMLineIndex]=pc._createTransceiver(kind,!0));var remoteIceParameters,remoteDtlsParameters,remoteCapabilities=SDPUtils.parseRtpParameters(mediaSection);rejected||(remoteIceParameters=SDPUtils.getIceParameters(mediaSection,sessionpart),(remoteDtlsParameters=SDPUtils.getDtlsParameters(mediaSection,sessionpart)).role="client"),recvEncodingParameters=SDPUtils.parseRtpEncodingParameters(mediaSection);var rtcpParameters=SDPUtils.parseRtcpParameters(mediaSection),isComplete=SDPUtils.matchPrefix(mediaSection,"a=end-of-candidates",sessionpart).length>0,cands=SDPUtils.matchPrefix(mediaSection,"a=candidate:").map((function(cand){return SDPUtils.parseCandidate(cand)})).filter((function(cand){return 1===cand.component}));if(("offer"===description.type||"answer"===description.type)&&!rejected&&usingBundle&&sdpMLineIndex>0&&pc.transceivers[sdpMLineIndex]&&(pc._disposeIceAndDtlsTransports(sdpMLineIndex),pc.transceivers[sdpMLineIndex].iceGatherer=pc.transceivers[0].iceGatherer,pc.transceivers[sdpMLineIndex].iceTransport=pc.transceivers[0].iceTransport,pc.transceivers[sdpMLineIndex].dtlsTransport=pc.transceivers[0].dtlsTransport,pc.transceivers[sdpMLineIndex].rtpSender&&pc.transceivers[sdpMLineIndex].rtpSender.setTransport(pc.transceivers[0].dtlsTransport),pc.transceivers[sdpMLineIndex].rtpReceiver&&pc.transceivers[sdpMLineIndex].rtpReceiver.setTransport(pc.transceivers[0].dtlsTransport)),"offer"!==description.type||rejected){if("answer"===description.type&&!rejected){iceGatherer=(transceiver=pc.transceivers[sdpMLineIndex]).iceGatherer,iceTransport=transceiver.iceTransport,dtlsTransport=transceiver.dtlsTransport,rtpReceiver=transceiver.rtpReceiver,sendEncodingParameters=transceiver.sendEncodingParameters,localCapabilities=transceiver.localCapabilities,pc.transceivers[sdpMLineIndex].recvEncodingParameters=recvEncodingParameters,pc.transceivers[sdpMLineIndex].remoteCapabilities=remoteCapabilities,pc.transceivers[sdpMLineIndex].rtcpParameters=rtcpParameters,cands.length&&"new"===iceTransport.state&&(!isIceLite&&!isComplete||usingBundle&&0!==sdpMLineIndex?cands.forEach((function(candidate){maybeAddCandidate(transceiver.iceTransport,candidate)})):iceTransport.setRemoteCandidates(cands)),usingBundle&&0!==sdpMLineIndex||("new"===iceTransport.state&&iceTransport.start(iceGatherer,remoteIceParameters,"controlling"),"new"===dtlsTransport.state&&dtlsTransport.start(remoteDtlsParameters)),!getCommonCapabilities(transceiver.localCapabilities,transceiver.remoteCapabilities).codecs.filter((function(c){return"rtx"===c.name.toLowerCase()})).length&&transceiver.sendEncodingParameters[0].rtx&&delete transceiver.sendEncodingParameters[0].rtx,pc._transceive(transceiver,"sendrecv"===direction||"recvonly"===direction,"sendrecv"===direction||"sendonly"===direction),!rtpReceiver||"sendrecv"!==direction&&"sendonly"!==direction?delete transceiver.rtpReceiver:(track=rtpReceiver.track,remoteMsid?(streams[remoteMsid.stream]||(streams[remoteMsid.stream]=new window.MediaStream),addTrackToStreamAndFireEvent(track,streams[remoteMsid.stream]),receiverList.push([track,rtpReceiver,streams[remoteMsid.stream]])):(streams.default||(streams.default=new window.MediaStream),addTrackToStreamAndFireEvent(track,streams.default),receiverList.push([track,rtpReceiver,streams.default])))}}else{(transceiver=pc.transceivers[sdpMLineIndex]||pc._createTransceiver(kind)).mid=mid,transceiver.iceGatherer||(transceiver.iceGatherer=pc._createIceGatherer(sdpMLineIndex,usingBundle)),cands.length&&"new"===transceiver.iceTransport.state&&(!isComplete||usingBundle&&0!==sdpMLineIndex?cands.forEach((function(candidate){maybeAddCandidate(transceiver.iceTransport,candidate)})):transceiver.iceTransport.setRemoteCandidates(cands)),localCapabilities=window.RTCRtpReceiver.getCapabilities(kind),edgeVersion<15019&&(localCapabilities.codecs=localCapabilities.codecs.filter((function(codec){return"rtx"!==codec.name}))),sendEncodingParameters=transceiver.sendEncodingParameters||[{ssrc:1001*(2*sdpMLineIndex+2)}];var stream,isNewTrack=!1;if("sendrecv"===direction||"sendonly"===direction){if(isNewTrack=!transceiver.rtpReceiver,rtpReceiver=transceiver.rtpReceiver||new window.RTCRtpReceiver(transceiver.dtlsTransport,kind),isNewTrack)track=rtpReceiver.track,remoteMsid&&"-"===remoteMsid.stream||(remoteMsid?(streams[remoteMsid.stream]||(streams[remoteMsid.stream]=new window.MediaStream,Object.defineProperty(streams[remoteMsid.stream],"id",{get:function(){return remoteMsid.stream}})),Object.defineProperty(track,"id",{get:function(){return remoteMsid.track}}),stream=streams[remoteMsid.stream]):(streams.default||(streams.default=new window.MediaStream),stream=streams.default)),stream&&(addTrackToStreamAndFireEvent(track,stream),transceiver.associatedRemoteMediaStreams.push(stream)),receiverList.push([track,rtpReceiver,stream])}else transceiver.rtpReceiver&&transceiver.rtpReceiver.track&&(transceiver.associatedRemoteMediaStreams.forEach((function(s){var nativeTrack=s.getTracks().find((function(t){return t.id===transceiver.rtpReceiver.track.id}));nativeTrack&&function(track,stream){stream.removeTrack(track),stream.dispatchEvent(new window.MediaStreamTrackEvent("removetrack",{track:track}))}(nativeTrack,s)})),transceiver.associatedRemoteMediaStreams=[]);transceiver.localCapabilities=localCapabilities,transceiver.remoteCapabilities=remoteCapabilities,transceiver.rtpReceiver=rtpReceiver,transceiver.rtcpParameters=rtcpParameters,transceiver.sendEncodingParameters=sendEncodingParameters,transceiver.recvEncodingParameters=recvEncodingParameters,pc._transceive(pc.transceivers[sdpMLineIndex],!1,isNewTrack)}}})),void 0===pc._dtlsRole&&(pc._dtlsRole="offer"===description.type?"active":"passive"),pc._remoteDescription={type:description.type,sdp:description.sdp},"offer"===description.type?pc._updateSignalingState("have-remote-offer"):pc._updateSignalingState("stable"),Object.keys(streams).forEach((function(sid){var stream=streams[sid];if(stream.getTracks().length){if(-1===pc.remoteStreams.indexOf(stream)){pc.remoteStreams.push(stream);var event=new Event("addstream");event.stream=stream,window.setTimeout((function(){pc._dispatchEvent("addstream",event)}))}receiverList.forEach((function(item){var track=item[0],receiver=item[1];stream.id===item[2].id&&fireAddTrack(pc,track,receiver,[stream])}))}})),receiverList.forEach((function(item){item[2]||fireAddTrack(pc,item[0],item[1],[])})),window.setTimeout((function(){pc&&pc.transceivers&&pc.transceivers.forEach((function(transceiver){transceiver.iceTransport&&"new"===transceiver.iceTransport.state&&transceiver.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),transceiver.iceTransport.addRemoteCandidate({}))}))}),4e3),Promise.resolve()},RTCPeerConnection.prototype.close=function(){this.transceivers.forEach((function(transceiver){transceiver.iceTransport&&transceiver.iceTransport.stop(),transceiver.dtlsTransport&&transceiver.dtlsTransport.stop(),transceiver.rtpSender&&transceiver.rtpSender.stop(),transceiver.rtpReceiver&&transceiver.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},RTCPeerConnection.prototype._updateSignalingState=function(newState){this.signalingState=newState;var event=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",event)},RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){var pc=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,window.setTimeout((function(){if(pc.needNegotiation){pc.needNegotiation=!1;var event=new Event("negotiationneeded");pc._dispatchEvent("negotiationneeded",event)}}),0))},RTCPeerConnection.prototype._updateIceConnectionState=function(){var newState,states={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(transceiver){transceiver.iceTransport&&!transceiver.rejected&&states[transceiver.iceTransport.state]++})),newState="new",states.failed>0?newState="failed":states.checking>0?newState="checking":states.disconnected>0?newState="disconnected":states.new>0?newState="new":states.connected>0?newState="connected":states.completed>0&&(newState="completed"),newState!==this.iceConnectionState){this.iceConnectionState=newState;var event=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",event)}},RTCPeerConnection.prototype._updateConnectionState=function(){var newState,states={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(transceiver){transceiver.iceTransport&&transceiver.dtlsTransport&&!transceiver.rejected&&(states[transceiver.iceTransport.state]++,states[transceiver.dtlsTransport.state]++)})),states.connected+=states.completed,newState="new",states.failed>0?newState="failed":states.connecting>0?newState="connecting":states.disconnected>0?newState="disconnected":states.new>0?newState="new":states.connected>0&&(newState="connected"),newState!==this.connectionState){this.connectionState=newState;var event=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",event)}},RTCPeerConnection.prototype.createOffer=function(){var pc=this;if(pc._isClosed)return Promise.reject(makeError("InvalidStateError","Can not call createOffer after close"));var numAudioTracks=pc.transceivers.filter((function(t){return"audio"===t.kind})).length,numVideoTracks=pc.transceivers.filter((function(t){return"video"===t.kind})).length,offerOptions=arguments[0];if(offerOptions){if(offerOptions.mandatory||offerOptions.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==offerOptions.offerToReceiveAudio&&(numAudioTracks=!0===offerOptions.offerToReceiveAudio?1:!1===offerOptions.offerToReceiveAudio?0:offerOptions.offerToReceiveAudio),void 0!==offerOptions.offerToReceiveVideo&&(numVideoTracks=!0===offerOptions.offerToReceiveVideo?1:!1===offerOptions.offerToReceiveVideo?0:offerOptions.offerToReceiveVideo)}for(pc.transceivers.forEach((function(transceiver){"audio"===transceiver.kind?--numAudioTracks<0&&(transceiver.wantReceive=!1):"video"===transceiver.kind&&--numVideoTracks<0&&(transceiver.wantReceive=!1)}));numAudioTracks>0||numVideoTracks>0;)numAudioTracks>0&&(pc._createTransceiver("audio"),numAudioTracks--),numVideoTracks>0&&(pc._createTransceiver("video"),numVideoTracks--);var sdp=SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,pc._sdpSessionVersion++);pc.transceivers.forEach((function(transceiver,sdpMLineIndex){var track=transceiver.track,kind=transceiver.kind,mid=transceiver.mid||SDPUtils.generateIdentifier();transceiver.mid=mid,transceiver.iceGatherer||(transceiver.iceGatherer=pc._createIceGatherer(sdpMLineIndex,pc.usingBundle));var localCapabilities=window.RTCRtpSender.getCapabilities(kind);edgeVersion<15019&&(localCapabilities.codecs=localCapabilities.codecs.filter((function(codec){return"rtx"!==codec.name}))),localCapabilities.codecs.forEach((function(codec){"H264"===codec.name&&void 0===codec.parameters["level-asymmetry-allowed"]&&(codec.parameters["level-asymmetry-allowed"]="1"),transceiver.remoteCapabilities&&transceiver.remoteCapabilities.codecs&&transceiver.remoteCapabilities.codecs.forEach((function(remoteCodec){codec.name.toLowerCase()===remoteCodec.name.toLowerCase()&&codec.clockRate===remoteCodec.clockRate&&(codec.preferredPayloadType=remoteCodec.payloadType)}))})),localCapabilities.headerExtensions.forEach((function(hdrExt){(transceiver.remoteCapabilities&&transceiver.remoteCapabilities.headerExtensions||[]).forEach((function(rHdrExt){hdrExt.uri===rHdrExt.uri&&(hdrExt.id=rHdrExt.id)}))}));var sendEncodingParameters=transceiver.sendEncodingParameters||[{ssrc:1001*(2*sdpMLineIndex+1)}];track&&edgeVersion>=15019&&"video"===kind&&!sendEncodingParameters[0].rtx&&(sendEncodingParameters[0].rtx={ssrc:sendEncodingParameters[0].ssrc+1}),transceiver.wantReceive&&(transceiver.rtpReceiver=new window.RTCRtpReceiver(transceiver.dtlsTransport,kind)),transceiver.localCapabilities=localCapabilities,transceiver.sendEncodingParameters=sendEncodingParameters})),"max-compat"!==pc._config.bundlePolicy&&(sdp+="a=group:BUNDLE "+pc.transceivers.map((function(t){return t.mid})).join(" ")+"\r\n"),sdp+="a=ice-options:trickle\r\n",pc.transceivers.forEach((function(transceiver,sdpMLineIndex){sdp+=writeMediaSection(transceiver,transceiver.localCapabilities,"offer",transceiver.stream,pc._dtlsRole),sdp+="a=rtcp-rsize\r\n",!transceiver.iceGatherer||"new"===pc.iceGatheringState||0!==sdpMLineIndex&&pc.usingBundle||(transceiver.iceGatherer.getLocalCandidates().forEach((function(cand){cand.component=1,sdp+="a="+SDPUtils.writeCandidate(cand)+"\r\n"})),"completed"===transceiver.iceGatherer.state&&(sdp+="a=end-of-candidates\r\n"))}));var desc=new window.RTCSessionDescription({type:"offer",sdp:sdp});return Promise.resolve(desc)},RTCPeerConnection.prototype.createAnswer=function(){var pc=this;if(pc._isClosed)return Promise.reject(makeError("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==pc.signalingState&&"have-local-pranswer"!==pc.signalingState)return Promise.reject(makeError("InvalidStateError","Can not call createAnswer in signalingState "+pc.signalingState));var sdp=SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,pc._sdpSessionVersion++);pc.usingBundle&&(sdp+="a=group:BUNDLE "+pc.transceivers.map((function(t){return t.mid})).join(" ")+"\r\n"),sdp+="a=ice-options:trickle\r\n";var mediaSectionsInOffer=SDPUtils.getMediaSections(pc._remoteDescription.sdp).length;pc.transceivers.forEach((function(transceiver,sdpMLineIndex){if(!(sdpMLineIndex+1>mediaSectionsInOffer)){if(transceiver.rejected)return"application"===transceiver.kind?"DTLS/SCTP"===transceiver.protocol?sdp+="m=application 0 DTLS/SCTP 5000\r\n":sdp+="m=application 0 "+transceiver.protocol+" webrtc-datachannel\r\n":"audio"===transceiver.kind?sdp+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===transceiver.kind&&(sdp+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(sdp+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+transceiver.mid+"\r\n");var localTrack;if(transceiver.stream)"audio"===transceiver.kind?localTrack=transceiver.stream.getAudioTracks()[0]:"video"===transceiver.kind&&(localTrack=transceiver.stream.getVideoTracks()[0]),localTrack&&edgeVersion>=15019&&"video"===transceiver.kind&&!transceiver.sendEncodingParameters[0].rtx&&(transceiver.sendEncodingParameters[0].rtx={ssrc:transceiver.sendEncodingParameters[0].ssrc+1});var commonCapabilities=getCommonCapabilities(transceiver.localCapabilities,transceiver.remoteCapabilities);!commonCapabilities.codecs.filter((function(c){return"rtx"===c.name.toLowerCase()})).length&&transceiver.sendEncodingParameters[0].rtx&&delete transceiver.sendEncodingParameters[0].rtx,sdp+=writeMediaSection(transceiver,commonCapabilities,"answer",transceiver.stream,pc._dtlsRole),transceiver.rtcpParameters&&transceiver.rtcpParameters.reducedSize&&(sdp+="a=rtcp-rsize\r\n")}}));var desc=new window.RTCSessionDescription({type:"answer",sdp:sdp});return Promise.resolve(desc)},RTCPeerConnection.prototype.addIceCandidate=function(candidate){var sections,pc=this;return candidate&&void 0===candidate.sdpMLineIndex&&!candidate.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(resolve,reject){if(!pc._remoteDescription)return reject(makeError("InvalidStateError","Can not add ICE candidate without a remote description"));if(candidate&&""!==candidate.candidate){var sdpMLineIndex=candidate.sdpMLineIndex;if(candidate.sdpMid)for(var i=0;i<pc.transceivers.length;i++)if(pc.transceivers[i].mid===candidate.sdpMid){sdpMLineIndex=i;break}var transceiver=pc.transceivers[sdpMLineIndex];if(!transceiver)return reject(makeError("OperationError","Can not add ICE candidate"));if(transceiver.rejected)return resolve();var cand=Object.keys(candidate.candidate).length>0?SDPUtils.parseCandidate(candidate.candidate):{};if("tcp"===cand.protocol&&(0===cand.port||9===cand.port))return resolve();if(cand.component&&1!==cand.component)return resolve();if((0===sdpMLineIndex||sdpMLineIndex>0&&transceiver.iceTransport!==pc.transceivers[0].iceTransport)&&!maybeAddCandidate(transceiver.iceTransport,cand))return reject(makeError("OperationError","Can not add ICE candidate"));var candidateString=candidate.candidate.trim();0===candidateString.indexOf("a=")&&(candidateString=candidateString.substr(2)),(sections=SDPUtils.getMediaSections(pc._remoteDescription.sdp))[sdpMLineIndex]+="a="+(cand.type?candidateString:"end-of-candidates")+"\r\n",pc._remoteDescription.sdp=SDPUtils.getDescription(pc._remoteDescription.sdp)+sections.join("")}else for(var j=0;j<pc.transceivers.length&&(pc.transceivers[j].rejected||(pc.transceivers[j].iceTransport.addRemoteCandidate({}),(sections=SDPUtils.getMediaSections(pc._remoteDescription.sdp))[j]+="a=end-of-candidates\r\n",pc._remoteDescription.sdp=SDPUtils.getDescription(pc._remoteDescription.sdp)+sections.join(""),!pc.usingBundle));j++);resolve()}))},RTCPeerConnection.prototype.getStats=function(selector){if(selector&&selector instanceof window.MediaStreamTrack){var senderOrReceiver=null;if(this.transceivers.forEach((function(transceiver){transceiver.rtpSender&&transceiver.rtpSender.track===selector?senderOrReceiver=transceiver.rtpSender:transceiver.rtpReceiver&&transceiver.rtpReceiver.track===selector&&(senderOrReceiver=transceiver.rtpReceiver)})),!senderOrReceiver)throw makeError("InvalidAccessError","Invalid selector.");return senderOrReceiver.getStats()}var promises=[];return this.transceivers.forEach((function(transceiver){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(method){transceiver[method]&&promises.push(transceiver[method].getStats())}))})),Promise.all(promises).then((function(allStats){var results=new Map;return allStats.forEach((function(stats){stats.forEach((function(stat){results.set(stat.id,stat)}))})),results}))};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(ortcObjectName){var obj=window[ortcObjectName];if(obj&&obj.prototype&&obj.prototype.getStats){var nativeGetstats=obj.prototype.getStats;obj.prototype.getStats=function(){return nativeGetstats.apply(this).then((function(nativeStats){var mapStats=new Map;return Object.keys(nativeStats).forEach((function(id){var stat;nativeStats[id].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(stat=nativeStats[id]).type]||stat.type,mapStats.set(id,nativeStats[id])})),mapStats}))}}}));var methods=["createOffer","createAnswer"];return methods.forEach((function(method){var nativeMethod=RTCPeerConnection.prototype[method];RTCPeerConnection.prototype[method]=function(){var args=arguments;return"function"==typeof args[0]||"function"==typeof args[1]?nativeMethod.apply(this,[arguments[2]]).then((function(description){"function"==typeof args[0]&&args[0].apply(null,[description])}),(function(error){"function"==typeof args[1]&&args[1].apply(null,[error])})):nativeMethod.apply(this,arguments)}})),(methods=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(method){var nativeMethod=RTCPeerConnection.prototype[method];RTCPeerConnection.prototype[method]=function(){var args=arguments;return"function"==typeof args[1]||"function"==typeof args[2]?nativeMethod.apply(this,arguments).then((function(){"function"==typeof args[1]&&args[1].apply(null)}),(function(error){"function"==typeof args[2]&&args[2].apply(null,[error])})):nativeMethod.apply(this,arguments)}})),["getStats"].forEach((function(method){var nativeMethod=RTCPeerConnection.prototype[method];RTCPeerConnection.prototype[method]=function(){var args=arguments;return"function"==typeof args[1]?nativeMethod.apply(this,arguments).then((function(){"function"==typeof args[1]&&args[1].apply(null)})):nativeMethod.apply(this,arguments)}})),RTCPeerConnection}},{sdp:17}],17:[function(require,module,exports){var SDPUtils={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};SDPUtils.localCName=SDPUtils.generateIdentifier(),SDPUtils.splitLines=function(blob){return blob.trim().split("\n").map((function(line){return line.trim()}))},SDPUtils.splitSections=function(blob){return blob.split("\nm=").map((function(part,index){return(index>0?"m="+part:part).trim()+"\r\n"}))},SDPUtils.getDescription=function(blob){var sections=SDPUtils.splitSections(blob);return sections&&sections[0]},SDPUtils.getMediaSections=function(blob){var sections=SDPUtils.splitSections(blob);return sections.shift(),sections},SDPUtils.matchPrefix=function(blob,prefix){return SDPUtils.splitLines(blob).filter((function(line){return 0===line.indexOf(prefix)}))},SDPUtils.parseCandidate=function(line){for(var parts,candidate={foundation:(parts=0===line.indexOf("a=candidate:")?line.substring(12).split(" "):line.substring(10).split(" "))[0],component:parseInt(parts[1],10),protocol:parts[2].toLowerCase(),priority:parseInt(parts[3],10),ip:parts[4],address:parts[4],port:parseInt(parts[5],10),type:parts[7]},i=8;i<parts.length;i+=2)switch(parts[i]){case"raddr":candidate.relatedAddress=parts[i+1];break;case"rport":candidate.relatedPort=parseInt(parts[i+1],10);break;case"tcptype":candidate.tcpType=parts[i+1];break;case"ufrag":candidate.ufrag=parts[i+1],candidate.usernameFragment=parts[i+1];break;default:candidate[parts[i]]=parts[i+1]}return candidate},SDPUtils.writeCandidate=function(candidate){var sdp=[];sdp.push(candidate.foundation),sdp.push(candidate.component),sdp.push(candidate.protocol.toUpperCase()),sdp.push(candidate.priority),sdp.push(candidate.address||candidate.ip),sdp.push(candidate.port);var type=candidate.type;return sdp.push("typ"),sdp.push(type),"host"!==type&&candidate.relatedAddress&&candidate.relatedPort&&(sdp.push("raddr"),sdp.push(candidate.relatedAddress),sdp.push("rport"),sdp.push(candidate.relatedPort)),candidate.tcpType&&"tcp"===candidate.protocol.toLowerCase()&&(sdp.push("tcptype"),sdp.push(candidate.tcpType)),(candidate.usernameFragment||candidate.ufrag)&&(sdp.push("ufrag"),sdp.push(candidate.usernameFragment||candidate.ufrag)),"candidate:"+sdp.join(" ")},SDPUtils.parseIceOptions=function(line){return line.substr(14).split(" ")},SDPUtils.parseRtpMap=function(line){var parts=line.substr(9).split(" "),parsed={payloadType:parseInt(parts.shift(),10)};return parts=parts[0].split("/"),parsed.name=parts[0],parsed.clockRate=parseInt(parts[1],10),parsed.channels=3===parts.length?parseInt(parts[2],10):1,parsed.numChannels=parsed.channels,parsed},SDPUtils.writeRtpMap=function(codec){var pt=codec.payloadType;void 0!==codec.preferredPayloadType&&(pt=codec.preferredPayloadType);var channels=codec.channels||codec.numChannels||1;return"a=rtpmap:"+pt+" "+codec.name+"/"+codec.clockRate+(1!==channels?"/"+channels:"")+"\r\n"},SDPUtils.parseExtmap=function(line){var parts=line.substr(9).split(" ");return{id:parseInt(parts[0],10),direction:parts[0].indexOf("/")>0?parts[0].split("/")[1]:"sendrecv",uri:parts[1]}},SDPUtils.writeExtmap=function(headerExtension){return"a=extmap:"+(headerExtension.id||headerExtension.preferredId)+(headerExtension.direction&&"sendrecv"!==headerExtension.direction?"/"+headerExtension.direction:"")+" "+headerExtension.uri+"\r\n"},SDPUtils.parseFmtp=function(line){for(var kv,parsed={},parts=line.substr(line.indexOf(" ")+1).split(";"),j=0;j<parts.length;j++)parsed[(kv=parts[j].trim().split("="))[0].trim()]=kv[1];return parsed},SDPUtils.writeFmtp=function(codec){var line="",pt=codec.payloadType;if(void 0!==codec.preferredPayloadType&&(pt=codec.preferredPayloadType),codec.parameters&&Object.keys(codec.parameters).length){var params=[];Object.keys(codec.parameters).forEach((function(param){codec.parameters[param]?params.push(param+"="+codec.parameters[param]):params.push(param)})),line+="a=fmtp:"+pt+" "+params.join(";")+"\r\n"}return line},SDPUtils.parseRtcpFb=function(line){var parts=line.substr(line.indexOf(" ")+1).split(" ");return{type:parts.shift(),parameter:parts.join(" ")}},SDPUtils.writeRtcpFb=function(codec){var lines="",pt=codec.payloadType;return void 0!==codec.preferredPayloadType&&(pt=codec.preferredPayloadType),codec.rtcpFeedback&&codec.rtcpFeedback.length&&codec.rtcpFeedback.forEach((function(fb){lines+="a=rtcp-fb:"+pt+" "+fb.type+(fb.parameter&&fb.parameter.length?" "+fb.parameter:"")+"\r\n"})),lines},SDPUtils.parseSsrcMedia=function(line){var sp=line.indexOf(" "),parts={ssrc:parseInt(line.substr(7,sp-7),10)},colon=line.indexOf(":",sp);return colon>-1?(parts.attribute=line.substr(sp+1,colon-sp-1),parts.value=line.substr(colon+1)):parts.attribute=line.substr(sp+1),parts},SDPUtils.parseSsrcGroup=function(line){var parts=line.substr(13).split(" ");return{semantics:parts.shift(),ssrcs:parts.map((function(ssrc){return parseInt(ssrc,10)}))}},SDPUtils.getMid=function(mediaSection){var mid=SDPUtils.matchPrefix(mediaSection,"a=mid:")[0];if(mid)return mid.substr(6)},SDPUtils.parseFingerprint=function(line){var parts=line.substr(14).split(" ");return{algorithm:parts[0].toLowerCase(),value:parts[1]}},SDPUtils.getDtlsParameters=function(mediaSection,sessionpart){return{role:"auto",fingerprints:SDPUtils.matchPrefix(mediaSection+sessionpart,"a=fingerprint:").map(SDPUtils.parseFingerprint)}},SDPUtils.writeDtlsParameters=function(params,setupType){var sdp="a=setup:"+setupType+"\r\n";return params.fingerprints.forEach((function(fp){sdp+="a=fingerprint:"+fp.algorithm+" "+fp.value+"\r\n"})),sdp},SDPUtils.getIceParameters=function(mediaSection,sessionpart){var lines=SDPUtils.splitLines(mediaSection);return{usernameFragment:(lines=lines.concat(SDPUtils.splitLines(sessionpart))).filter((function(line){return 0===line.indexOf("a=ice-ufrag:")}))[0].substr(12),password:lines.filter((function(line){return 0===line.indexOf("a=ice-pwd:")}))[0].substr(10)}},SDPUtils.writeIceParameters=function(params){return"a=ice-ufrag:"+params.usernameFragment+"\r\na=ice-pwd:"+params.password+"\r\n"},SDPUtils.parseRtpParameters=function(mediaSection){for(var description={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},mline=SDPUtils.splitLines(mediaSection)[0].split(" "),i=3;i<mline.length;i++){var pt=mline[i],rtpmapline=SDPUtils.matchPrefix(mediaSection,"a=rtpmap:"+pt+" ")[0];if(rtpmapline){var codec=SDPUtils.parseRtpMap(rtpmapline),fmtps=SDPUtils.matchPrefix(mediaSection,"a=fmtp:"+pt+" ");switch(codec.parameters=fmtps.length?SDPUtils.parseFmtp(fmtps[0]):{},codec.rtcpFeedback=SDPUtils.matchPrefix(mediaSection,"a=rtcp-fb:"+pt+" ").map(SDPUtils.parseRtcpFb),description.codecs.push(codec),codec.name.toUpperCase()){case"RED":case"ULPFEC":description.fecMechanisms.push(codec.name.toUpperCase())}}}return SDPUtils.matchPrefix(mediaSection,"a=extmap:").forEach((function(line){description.headerExtensions.push(SDPUtils.parseExtmap(line))})),description},SDPUtils.writeRtpDescription=function(kind,caps){var sdp="";sdp+="m="+kind+" ",sdp+=caps.codecs.length>0?"9":"0",sdp+=" UDP/TLS/RTP/SAVPF ",sdp+=caps.codecs.map((function(codec){return void 0!==codec.preferredPayloadType?codec.preferredPayloadType:codec.payloadType})).join(" ")+"\r\n",sdp+="c=IN IP4 0.0.0.0\r\n",sdp+="a=rtcp:9 IN IP4 0.0.0.0\r\n",caps.codecs.forEach((function(codec){sdp+=SDPUtils.writeRtpMap(codec),sdp+=SDPUtils.writeFmtp(codec),sdp+=SDPUtils.writeRtcpFb(codec)}));var maxptime=0;return caps.codecs.forEach((function(codec){codec.maxptime>maxptime&&(maxptime=codec.maxptime)})),maxptime>0&&(sdp+="a=maxptime:"+maxptime+"\r\n"),sdp+="a=rtcp-mux\r\n",caps.headerExtensions&&caps.headerExtensions.forEach((function(extension){sdp+=SDPUtils.writeExtmap(extension)})),sdp},SDPUtils.parseRtpEncodingParameters=function(mediaSection){var secondarySsrc,encodingParameters=[],description=SDPUtils.parseRtpParameters(mediaSection),hasRed=-1!==description.fecMechanisms.indexOf("RED"),hasUlpfec=-1!==description.fecMechanisms.indexOf("ULPFEC"),ssrcs=SDPUtils.matchPrefix(mediaSection,"a=ssrc:").map((function(line){return SDPUtils.parseSsrcMedia(line)})).filter((function(parts){return"cname"===parts.attribute})),primarySsrc=ssrcs.length>0&&ssrcs[0].ssrc,flows=SDPUtils.matchPrefix(mediaSection,"a=ssrc-group:FID").map((function(line){return line.substr(17).split(" ").map((function(part){return parseInt(part,10)}))}));flows.length>0&&flows[0].length>1&&flows[0][0]===primarySsrc&&(secondarySsrc=flows[0][1]),description.codecs.forEach((function(codec){if("RTX"===codec.name.toUpperCase()&&codec.parameters.apt){var encParam={ssrc:primarySsrc,codecPayloadType:parseInt(codec.parameters.apt,10)};primarySsrc&&secondarySsrc&&(encParam.rtx={ssrc:secondarySsrc}),encodingParameters.push(encParam),hasRed&&((encParam=JSON.parse(JSON.stringify(encParam))).fec={ssrc:primarySsrc,mechanism:hasUlpfec?"red+ulpfec":"red"},encodingParameters.push(encParam))}})),0===encodingParameters.length&&primarySsrc&&encodingParameters.push({ssrc:primarySsrc});var bandwidth=SDPUtils.matchPrefix(mediaSection,"b=");return bandwidth.length&&(bandwidth=0===bandwidth[0].indexOf("b=TIAS:")?parseInt(bandwidth[0].substr(7),10):0===bandwidth[0].indexOf("b=AS:")?1e3*parseInt(bandwidth[0].substr(5),10)*.95-16e3:void 0,encodingParameters.forEach((function(params){params.maxBitrate=bandwidth}))),encodingParameters},SDPUtils.parseRtcpParameters=function(mediaSection){var rtcpParameters={},remoteSsrc=SDPUtils.matchPrefix(mediaSection,"a=ssrc:").map((function(line){return SDPUtils.parseSsrcMedia(line)})).filter((function(obj){return"cname"===obj.attribute}))[0];remoteSsrc&&(rtcpParameters.cname=remoteSsrc.value,rtcpParameters.ssrc=remoteSsrc.ssrc);var rsize=SDPUtils.matchPrefix(mediaSection,"a=rtcp-rsize");rtcpParameters.reducedSize=rsize.length>0,rtcpParameters.compound=0===rsize.length;var mux=SDPUtils.matchPrefix(mediaSection,"a=rtcp-mux");return rtcpParameters.mux=mux.length>0,rtcpParameters},SDPUtils.parseMsid=function(mediaSection){var parts,spec=SDPUtils.matchPrefix(mediaSection,"a=msid:");if(1===spec.length)return{stream:(parts=spec[0].substr(7).split(" "))[0],track:parts[1]};var planB=SDPUtils.matchPrefix(mediaSection,"a=ssrc:").map((function(line){return SDPUtils.parseSsrcMedia(line)})).filter((function(msidParts){return"msid"===msidParts.attribute}));return planB.length>0?{stream:(parts=planB[0].value.split(" "))[0],track:parts[1]}:void 0},SDPUtils.parseSctpDescription=function(mediaSection){var maxMessageSize,mline=SDPUtils.parseMLine(mediaSection),maxSizeLine=SDPUtils.matchPrefix(mediaSection,"a=max-message-size:");maxSizeLine.length>0&&(maxMessageSize=parseInt(maxSizeLine[0].substr(19),10)),isNaN(maxMessageSize)&&(maxMessageSize=65536);var sctpPort=SDPUtils.matchPrefix(mediaSection,"a=sctp-port:");if(sctpPort.length>0)return{port:parseInt(sctpPort[0].substr(12),10),protocol:mline.fmt,maxMessageSize:maxMessageSize};if(SDPUtils.matchPrefix(mediaSection,"a=sctpmap:").length>0){var parts=SDPUtils.matchPrefix(mediaSection,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(parts[0],10),protocol:parts[1],maxMessageSize:maxMessageSize}}},SDPUtils.writeSctpDescription=function(media,sctp){var output=[];return output="DTLS/SCTP"!==media.protocol?["m="+media.kind+" 9 "+media.protocol+" "+sctp.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+sctp.port+"\r\n"]:["m="+media.kind+" 9 "+media.protocol+" "+sctp.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+sctp.port+" "+sctp.protocol+" 65535\r\n"],void 0!==sctp.maxMessageSize&&output.push("a=max-message-size:"+sctp.maxMessageSize+"\r\n"),output.join("")},SDPUtils.generateSessionId=function(){return Math.random().toString().substr(2,21)},SDPUtils.writeSessionBoilerplate=function(sessId,sessVer,sessUser){var version=void 0!==sessVer?sessVer:2;return"v=0\r\no="+(sessUser||"thisisadapterortc")+" "+(sessId||SDPUtils.generateSessionId())+" "+version+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},SDPUtils.writeMediaSection=function(transceiver,caps,type,stream){var sdp=SDPUtils.writeRtpDescription(transceiver.kind,caps);if(sdp+=SDPUtils.writeIceParameters(transceiver.iceGatherer.getLocalParameters()),sdp+=SDPUtils.writeDtlsParameters(transceiver.dtlsTransport.getLocalParameters(),"offer"===type?"actpass":"active"),sdp+="a=mid:"+transceiver.mid+"\r\n",transceiver.direction?sdp+="a="+transceiver.direction+"\r\n":transceiver.rtpSender&&transceiver.rtpReceiver?sdp+="a=sendrecv\r\n":transceiver.rtpSender?sdp+="a=sendonly\r\n":transceiver.rtpReceiver?sdp+="a=recvonly\r\n":sdp+="a=inactive\r\n",transceiver.rtpSender){var msid="msid:"+stream.id+" "+transceiver.rtpSender.track.id+"\r\n";sdp+="a="+msid,sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].ssrc+" "+msid,transceiver.sendEncodingParameters[0].rtx&&(sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].rtx.ssrc+" "+msid,sdp+="a=ssrc-group:FID "+transceiver.sendEncodingParameters[0].ssrc+" "+transceiver.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].ssrc+" cname:"+SDPUtils.localCName+"\r\n",transceiver.rtpSender&&transceiver.sendEncodingParameters[0].rtx&&(sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].rtx.ssrc+" cname:"+SDPUtils.localCName+"\r\n"),sdp},SDPUtils.getDirection=function(mediaSection,sessionpart){for(var lines=SDPUtils.splitLines(mediaSection),i=0;i<lines.length;i++)switch(lines[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return lines[i].substr(2)}return sessionpart?SDPUtils.getDirection(sessionpart):"sendrecv"},SDPUtils.getKind=function(mediaSection){return SDPUtils.splitLines(mediaSection)[0].split(" ")[0].substr(2)},SDPUtils.isRejected=function(mediaSection){return"0"===mediaSection.split(" ",2)[1]},SDPUtils.parseMLine=function(mediaSection){var parts=SDPUtils.splitLines(mediaSection)[0].substr(2).split(" ");return{kind:parts[0],port:parseInt(parts[1],10),protocol:parts[2],fmt:parts.slice(3).join(" ")}},SDPUtils.parseOLine=function(mediaSection){var parts=SDPUtils.matchPrefix(mediaSection,"o=")[0].substr(2).split(" ");return{username:parts[0],sessionId:parts[1],sessionVersion:parseInt(parts[2],10),netType:parts[3],addressType:parts[4],address:parts[5]}},SDPUtils.isValidSDP=function(blob){if("string"!=typeof blob||0===blob.length)return!1;for(var lines=SDPUtils.splitLines(blob),i=0;i<lines.length;i++)if(lines[i].length<2||"="!==lines[i].charAt(1))return!1;return!0},"object"===_typeof2(module)&&(module.exports=SDPUtils)},{}]},{},[1])(1)}));
/**
 * Implement an accessible aria tree widget, from a nested unordered list.
 * Based on http://oaa-accessibility.org/example/41/.
 *
 * @module     tool_lp/tree
 * @package    core
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/tree",["jquery"],(function($){var SELECTORS_ITEM="[role=treeitem]",SELECTORS_GROUP="[role=treeitem]:has([role=group]), [role=treeitem][aria-owns], [role=treeitem][data-requires-ajax=true]",SELECTORS_CLOSED_GROUP="[role=treeitem]:has([role=group])[aria-expanded=false], [role=treeitem][aria-owns][aria-expanded=false], [role=treeitem][data-requires-ajax=true][aria-expanded=false]",SELECTORS_FIRST_ITEM="[role=treeitem]:first",SELECTORS_VISIBLE_ITEM="[role=treeitem]:visible",SELECTORS_UNLOADED_AJAX_ITEM="[role=treeitem][data-requires-ajax=true][data-loaded=false][aria-expanded=true]",Tree=function(selector,selectCallback){this.treeRoot=$(selector),this.treeRoot.data("activeItem",null),this.selectCallback=selectCallback,this.keys={tab:9,enter:13,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,asterisk:106},this.initialiseNodes(this.treeRoot),this.setActiveItem(this.treeRoot.find(SELECTORS_FIRST_ITEM)),this.refreshVisibleItemsCache(),this.bindEventHandlers()};return Tree.prototype.registerEnterCallback=function(callback){this.enterCallback=callback},Tree.prototype.refreshVisibleItemsCache=function(){this.treeRoot.data("visibleItems",this.treeRoot.find(SELECTORS_VISIBLE_ITEM))},Tree.prototype.getVisibleItems=function(){return this.treeRoot.data("visibleItems")},Tree.prototype.setActiveItem=function(item){var currentActive=this.treeRoot.data("activeItem");item!==currentActive&&(currentActive&&(currentActive.attr("tabindex","-1"),currentActive.attr("aria-selected","false")),item.attr("tabindex","0"),item.attr("aria-selected","true"),this.treeRoot.data("activeItem",item),"function"==typeof this.selectCallback&&this.selectCallback(item))},Tree.prototype.isGroupItem=function(item){return item.is(SELECTORS_GROUP)},Tree.prototype.getGroupFromItem=function(item){var ariaowns=this.treeRoot.find("#"+item.attr("aria-owns")),plain=item.children("[role=group]");return ariaowns.length>plain.length?ariaowns:plain},Tree.prototype.isGroupCollapsed=function(item){return"false"===item.attr("aria-expanded")},Tree.prototype.isGroupCollapsible=function(item){return"false"!==item.attr("data-collapsible")},Tree.prototype.initialiseNodes=function(node){this.removeAllFromTabOrder(node),this.setAriaSelectedFalseOnItems(node);var thisTree=this;node.find(SELECTORS_UNLOADED_AJAX_ITEM).each((function(){var unloadedNode=$(this);thisTree.collapseGroup(unloadedNode),thisTree.expandGroup(unloadedNode)}))},Tree.prototype.removeAllFromTabOrder=function(node){node.find("*").attr("tabindex","-1"),this.getGroupFromItem($(node)).find("*").attr("tabindex","-1")},Tree.prototype.setAriaSelectedFalseOnItems=function(node){node.find(SELECTORS_ITEM).attr("aria-selected","false")},Tree.prototype.expandAllGroups=function(){var thisTree=this;this.treeRoot.find(SELECTORS_CLOSED_GROUP).each((function(){var groupNode=$(this);thisTree.expandGroup($(this)).done((function(){thisTree.expandAllChildGroups(groupNode)}))}))},Tree.prototype.expandAllChildGroups=function(item){var thisTree=this;this.getGroupFromItem(item).find(SELECTORS_CLOSED_GROUP).each((function(){var groupNode=$(this);thisTree.expandGroup($(this)).done((function(){thisTree.expandAllChildGroups(groupNode)}))}))},Tree.prototype.expandGroup=function(item){var promise=$.Deferred();if("false"!==item.attr("data-expandable")&&this.isGroupCollapsed(item))if("true"===item.attr("data-requires-ajax")&&"true"!==item.attr("data-loaded")){item.attr("data-loaded",!1);var moduleName=item.closest("[data-ajax-loader]").attr("data-ajax-loader"),thisTree=this;item.addClass("loading"),require([moduleName],(function(loader){loader.load(item).done((function(){item.attr("data-loaded",!0),thisTree.initialiseNodes(item),thisTree.finishExpandingGroup(item),item.removeClass("loading"),promise.resolve()}))}))}else this.finishExpandingGroup(item),promise.resolve();else promise.resolve();return promise},Tree.prototype.finishExpandingGroup=function(item){this.getGroupFromItem(item).attr("aria-hidden","false"),item.attr("aria-expanded","true"),this.refreshVisibleItemsCache()},Tree.prototype.collapseGroup=function(item){this.isGroupCollapsible(item)&&!this.isGroupCollapsed(item)&&(this.getGroupFromItem(item).attr("aria-hidden","true"),item.attr("aria-expanded","false"),this.refreshVisibleItemsCache())},Tree.prototype.toggleGroup=function(item){"true"===item.attr("aria-expanded")?this.collapseGroup(item):this.expandGroup(item)},Tree.prototype.handleKeyDown=function(item,e){var currentIndex=this.getVisibleItems().index(item);if(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey&&e.keyCode!=this.keys.tab)return!0;switch(e.keyCode){case this.keys.home:return this.getVisibleItems().first().focus(),e.stopPropagation(),!1;case this.keys.end:return this.getVisibleItems().last().focus(),e.stopPropagation(),!1;case this.keys.enter:var links=item.children("a").length?item.children("a"):item.children().not(SELECTORS_GROUP).find("a");return links.length?"function"==typeof this.enterCallback?this.enterCallback(item):window.location.href=links.first().attr("href"):this.isGroupItem(item)&&this.toggleGroup(item,!0),e.stopPropagation(),!1;case this.keys.space:return this.isGroupItem(item)&&this.toggleGroup(item,!0),e.stopPropagation(),!1;case this.keys.left:var focusParent=function(tree){tree.getVisibleItems().filter((function(){return tree.getGroupFromItem($(this)).has(item).length})).focus()};return this.isGroupItem(item)?this.isGroupCollapsed(item)?focusParent(this):this.collapseGroup(item):focusParent(this),e.stopPropagation(),!1;case this.keys.right:return this.isGroupItem(item)&&(this.isGroupCollapsed(item)?this.expandGroup(item):this.getGroupFromItem(item).find(SELECTORS_ITEM).first().focus()),e.stopPropagation(),!1;case this.keys.up:if(currentIndex>0)this.getVisibleItems().eq(currentIndex-1).focus();return e.stopPropagation(),!1;case this.keys.down:if(currentIndex<this.getVisibleItems().length-1)this.getVisibleItems().eq(currentIndex+1).focus();return e.stopPropagation(),!1;case this.keys.asterisk:return this.expandAllGroups(),e.stopPropagation(),!1}return!0},Tree.prototype.handleClick=function(item,e){return e.altKey||e.ctrlKey||e.shiftKey||e.metaKey||(item.focus(),this.isGroupItem(item)&&this.toggleGroup(item),e.stopPropagation()),!0},Tree.prototype.handleFocus=function(item,e){return this.setActiveItem(item),e.stopPropagation(),!0},Tree.prototype.bindEventHandlers=function(){var thisObj=this;this.treeRoot.on({click:function(e){return thisObj.handleClick($(this),e)},keydown:function(e){return thisObj.handleKeyDown($(this),e)},focus:function(e){return thisObj.handleFocus($(this),e)}},SELECTORS_ITEM)},Tree}));
/**
 * Factory to create a paged content widget.
 *
 * @module     core/paged_content_factory
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/paged_content_factory",["jquery","core/templates","core/notification","core/paged_content","core/paged_content_events","core/pubsub","core/ajax"],(function($,Templates,Notification,PagedContent,PagedContentEvents,PubSub,Ajax){var TEMPLATES_PAGED_CONTENT="core/paged_content",DEFAULT_ITEMS_PER_PAGE_SINGLE=25,DEFAULT_ITEMS_PER_PAGE_ARRAY=[25,50,100,0],DEFAULT_MAX_PAGES=3,buildPagingBarTemplateContextUnknownLength=function(itemsPerPage){null===itemsPerPage&&(itemsPerPage=DEFAULT_ITEMS_PER_PAGE_ARRAY);var context={showitemsperpageselector:!1,itemsperpage:35,previous:!0,next:!0,activepagenumber:1,hidecontrolonsinglepage:!0,pages:[]};return context.itemsperpage=function(itemsPerPage){var context=[];return $.isArray(itemsPerPage)?(context=itemsPerPage.map((function(num){return"number"==typeof num?{value:num,active:!1}:num}))).filter((function(item){return item.active})).length||(context[0].active=!0):context=[{value:itemsPerPage,active:!0}],context}(itemsPerPage),context.showitemsperpageselector=$.isArray(itemsPerPage)&&itemsPerPage.length>1,context},buildPagingBarTemplateContext=function(numberOfItems,itemsPerPage){return numberOfItems?function(numberOfItems,itemsPerPage){null===itemsPerPage&&(itemsPerPage=DEFAULT_ITEMS_PER_PAGE_SINGLE),$.isArray(itemsPerPage)&&(itemsPerPage=itemsPerPage[0]);var context={showitemsperpageselector:!1,itemsperpage:35,previous:!0,next:!0,activepagenumber:1,hidecontrolonsinglepage:!0,pages:[]};context.itemsperpage=itemsPerPage;for(var numberOfPages=function(numberOfItems,itemsPerPage){var numberOfPages=1;if(numberOfItems>0){var partial=numberOfItems%itemsPerPage;numberOfPages=partial?(numberOfItems-=partial)/itemsPerPage+1:numberOfItems/itemsPerPage}return numberOfPages}(numberOfItems,itemsPerPage),i=1;i<=numberOfPages;i++){var page={number:i,page:""+i};1===i&&(page.active=!0),context.pages.push(page)}return context.barsize=10,context}(numberOfItems,itemsPerPage):buildPagingBarTemplateContextUnknownLength(itemsPerPage)},buildTemplateContext=function(numberOfItems,itemsPerPage,config){var context={pagingbar:!1,pagingdropdown:!1,skipjs:!0,ignorecontrolwhileloading:!0,controlplacementbottom:!1};return config.hasOwnProperty("ignoreControlWhileLoading")&&(context.ignorecontrolwhileloading=config.ignoreControlWhileLoading),config.hasOwnProperty("controlPlacementBottom")&&(context.controlplacementbottom=config.controlPlacementBottom),config.hasOwnProperty("hideControlOnSinglePage")&&(context.hidecontrolonsinglepage=config.hideControlOnSinglePage),config.hasOwnProperty("ariaLabels")&&(context.arialabels=config.ariaLabels),config.hasOwnProperty("dropdown")&&config.dropdown?context.pagingdropdown=function(itemsPerPage,config){if(null===itemsPerPage&&(itemsPerPage=DEFAULT_ITEMS_PER_PAGE_SINGLE),$.isArray(itemsPerPage))return{options:itemsPerPage};var context={options:[]},totalItems=0,lastIncrease=0,maxPages=DEFAULT_MAX_PAGES;config.hasOwnProperty("maxPages")&&(maxPages=config.maxPages);for(var i=1;i<=maxPages;i++){var itemCount=0;i<=2?(itemCount=itemsPerPage,lastIncrease=itemsPerPage):itemCount=lastIncrease*=2;var option={itemcount:itemCount,content:totalItems+=itemCount};1===i&&(option.active=!0),context.options.push(option)}return context}(itemsPerPage,config):context.pagingbar=buildPagingBarTemplateContext(numberOfItems,itemsPerPage),context},createWithTotalAndLimit=function(numberOfItems,itemsPerPage,renderPagesContentCallback,config){config=config||{};var deferred=$.Deferred(),templateContext=buildTemplateContext(numberOfItems,itemsPerPage,config);return Templates.render(TEMPLATES_PAGED_CONTENT,templateContext).then((function(html,js){var id=(html=$(html)).attr("id");config.hasOwnProperty("eventNamespace")&&(id=config.eventNamespace);var container=html;PagedContent.init(container,renderPagesContentCallback,id),registerEvents(id,config),deferred.resolve(html,js)})).fail((function(exception){deferred.reject(exception)})).fail(Notification.exception),deferred.promise()},registerEvents=function(namespace,config){var persistentLimitKey;config.hasOwnProperty("persistentLimitKey")&&PubSub.subscribe(namespace+PagedContentEvents.SET_ITEMS_PER_PAGE_LIMIT,(persistentLimitKey=config.persistentLimitKey,function(limit){var request={methodname:"core_user_update_user_preferences",args:{preferences:[{type:persistentLimitKey,value:limit}]}};Ajax.call([request])}))};return{create:function(renderPagesContentCallback,config){return createWithTotalAndLimit(null,null,renderPagesContentCallback,config)},createWithLimit:function(itemsPerPage,renderPagesContentCallback,config){return createWithTotalAndLimit(null,itemsPerPage,renderPagesContentCallback,config)},createWithTotalAndLimit:createWithTotalAndLimit,createFromStaticList:function(contentItems,itemsPerPage,renderContentCallback,config){void 0===config&&(config={});var numberOfItems=contentItems.length;return createWithTotalAndLimit(numberOfItems,itemsPerPage,(function(pagesData){var contentToRender=[];return pagesData.forEach((function(pageData){var begin=pageData.offset,end=pageData.limit?begin+pageData.limit:numberOfItems,items=contentItems.slice(begin,end);contentToRender.push(items)})),renderContentCallback(contentToRender)}),config)},createFromAjax:createWithTotalAndLimit,resetLastPageNumber:function(id,lastPageNumber){PubSub.publish(id+PagedContentEvents.ALL_ITEMS_LOADED,lastPageNumber)}}}));
/**
 * A timer that will execute a callback with decreasing frequency. Useful for
 * doing polling on the server without overwhelming it with requests.
 *
 * @module     core/backoff_timer
 * @class      backoff_timer
 * @package    core
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/backoff_timer",(function(){var BackoffTimer=function(callback,backoffFunction){this.callback=callback,this.backOffFunction=backoffFunction};return BackoffTimer.prototype.callback=null,BackoffTimer.prototype.backOffFunction=null,BackoffTimer.prototype.time=null,BackoffTimer.prototype.timeout=null,BackoffTimer.prototype.generateNextTime=function(){var newTime=this.backOffFunction(this.time);return this.time=newTime,newTime},BackoffTimer.prototype.reset=function(){return this.time=null,this.stop(),this},BackoffTimer.prototype.stop=function(){return this.timeout&&(window.clearTimeout(this.timeout),this.timeout=null),this},BackoffTimer.prototype.start=function(){if(!this.timeout){var time=this.generateNextTime();this.timeout=window.setTimeout(function(){this.callback(),this.stop(),this.start()}.bind(this),time)}return this},BackoffTimer.prototype.restart=function(){return this.reset().start()},BackoffTimer.getIncrementalCallback=function(minamount,incrementamount,maxamount,timeoutamount){return function(time){return time?time+incrementamount>maxamount?timeoutamount:time+incrementamount:minamount}},BackoffTimer}));
/**
 * Chart pie.
 *
 * @package    core
 * @copyright  2016 Frdric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @module     core/chart_pie
 */
define("core/chart_pie",["core/chart_base"],(function(Base){function Pie(){Base.prototype.constructor.apply(this,arguments)}return Pie.prototype=Object.create(Base.prototype),Pie.prototype.TYPE="pie",Pie.prototype._doughnut=null,Pie.prototype.create=function(Klass,data){var chart=Base.prototype.create.apply(this,arguments);return chart.setDoughnut(data.doughnut),chart},Pie.prototype.addSeries=function(series){if(null===series.getColor()){for(var colors=[],configColorSet=this.getConfigColorSet()||Base.prototype.COLORSET,i=0;i<series.getCount();i++)colors.push(configColorSet[i%configColorSet.length]);series.setColors(colors)}return Base.prototype.addSeries.apply(this,arguments)},Pie.prototype.getDoughnut=function(){return this._doughnut},Pie.prototype.setDoughnut=function(doughnut){this._doughnut=Boolean(doughnut)},Pie.prototype._validateSeries=function(){if(this._series.length>=1)throw new Error("Pie charts only support one serie.");return Base.prototype._validateSeries.apply(this,arguments)},Pie}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}var global,factory;global=window,factory=function(mustache){var objectToString=Object.prototype.toString,isArray=Array.isArray||function(object){return"[object Array]"===objectToString.call(object)};function isFunction(object){return"function"==typeof object}function escapeRegExp(string){return string.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function hasProperty(obj,propName){return null!=obj&&"object"===_typeof(obj)&&propName in obj}var regExpTest=RegExp.prototype.test,nonSpaceRe=/\S/;function isWhitespace(string){return!function(re,string){return regExpTest.call(re,string)}(nonSpaceRe,string)}var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},whiteRe=/\s*/,spaceRe=/\s+/,equalsRe=/\s*=/,curlyRe=/\s*\}/,tagRe=/#|\^|\/|>|\{|&|=|!|\$|</;function Scanner(string){this.string=string,this.tail=string,this.pos=0}function Context(view,parentContext){this.view=view,this.blocks={},this.cache={".":this.view},this.parent=parentContext}function Writer(){this.cache={}}Scanner.prototype.eos=function(){return""===this.tail},Scanner.prototype.scan=function(re){var match=this.tail.match(re);if(!match||0!==match.index)return"";var string=match[0];return this.tail=this.tail.substring(string.length),this.pos+=string.length,string},Scanner.prototype.scanUntil=function(re){var match,index=this.tail.search(re);switch(index){case-1:match=this.tail,this.tail="";break;case 0:match="";break;default:match=this.tail.substring(0,index),this.tail=this.tail.substring(index)}return this.pos+=match.length,match},Context.prototype.push=function(view){return new Context(view,this)},Context.prototype.setBlockVar=function(name,value){return this.blocks[name]=value,value},Context.prototype.clearBlockVars=function(){this.blocks={}},Context.prototype.getBlockVar=function(name){var value,blocks=this.blocks;return blocks.hasOwnProperty(name)?value=blocks[name]:this.parent&&(value=this.parent.getBlockVar(name)),value},Context.prototype.lookup=function(name){var value,primitive,propName,cache=this.cache;if(cache.hasOwnProperty(name))value=cache[name];else{for(var intermediateValue,names,index,context=this,lookupHit=!1;context;){if(name.indexOf(".")>0)for(intermediateValue=context.view,names=name.split("."),index=0;null!=intermediateValue&&index<names.length;)index===names.length-1&&(lookupHit=hasProperty(intermediateValue,names[index])||(primitive=intermediateValue,propName=names[index],null!=primitive&&"object"!==_typeof(primitive)&&primitive.hasOwnProperty&&primitive.hasOwnProperty(propName))),intermediateValue=intermediateValue[names[index++]];else intermediateValue=context.view[name],lookupHit=hasProperty(context.view,name);if(lookupHit){value=intermediateValue;break}context=context.parent}cache[name]=value}return isFunction(value)&&(value=value.call(this.view)),value},Writer.prototype.clearCache=function(){this.cache={}},Writer.prototype.parse=function(template,tags){var cache=this.cache,cacheKey=template+":"+(tags||mustache.tags).join(":"),tokens=cache[cacheKey];return null==tokens&&(tokens=cache[cacheKey]=function(template,tags){if(!template)return[];var openingTagRe,closingTagRe,closingCurlyRe,lineHasNonSpace=!1,sections=[],tokens=[],spaces=[],hasTag=!1,nonSpace=!1,indentation="",tagIndex=0;function stripSpace(){if(hasTag&&!nonSpace)for(;spaces.length;)delete tokens[spaces.pop()];else spaces=[];hasTag=!1,nonSpace=!1}function compileTags(tagsToCompile){if("string"==typeof tagsToCompile&&(tagsToCompile=tagsToCompile.split(spaceRe,2)),!isArray(tagsToCompile)||2!==tagsToCompile.length)throw new Error("Invalid tags: "+tagsToCompile);openingTagRe=new RegExp(escapeRegExp(tagsToCompile[0])+"\\s*"),closingTagRe=new RegExp("\\s*"+escapeRegExp(tagsToCompile[1])),closingCurlyRe=new RegExp("\\s*"+escapeRegExp("}"+tagsToCompile[1]))}compileTags(tags||mustache.tags);for(var start,type,value,chr,token,openSection,scanner=new Scanner(template);!scanner.eos();){if(start=scanner.pos,value=scanner.scanUntil(openingTagRe))for(var i=0,valueLength=value.length;i<valueLength;++i)isWhitespace(chr=value.charAt(i))?(spaces.push(tokens.length),indentation+=chr):(nonSpace=!0,lineHasNonSpace=!0,indentation+=" "),tokens.push(["text",chr,start,start+1]),start+=1,"\n"===chr&&(stripSpace(),indentation="",tagIndex=0,lineHasNonSpace=!1);if(!scanner.scan(openingTagRe))break;if(hasTag=!0,type=scanner.scan(tagRe)||"name",scanner.scan(whiteRe),"="===type?(value=scanner.scanUntil(equalsRe),scanner.scan(equalsRe),scanner.scanUntil(closingTagRe)):"{"===type?(value=scanner.scanUntil(closingCurlyRe),scanner.scan(curlyRe),scanner.scanUntil(closingTagRe),type="&"):value=scanner.scanUntil(closingTagRe),!scanner.scan(closingTagRe))throw new Error("Unclosed tag at "+scanner.pos);if(token=">"==type?[type,value,start,scanner.pos,indentation,tagIndex,lineHasNonSpace]:[type,value,start,scanner.pos],tagIndex++,tokens.push(token),"#"===type||"^"===type||"$"===type||"<"===type)sections.push(token);else if("/"===type){if(!(openSection=sections.pop()))throw new Error('Unopened section "'+value+'" at '+start);if(openSection[1]!==value)throw new Error('Unclosed section "'+openSection[1]+'" at '+start)}else"name"===type||"{"===type||"&"===type?nonSpace=!0:"="===type&&compileTags(value)}if(stripSpace(),openSection=sections.pop())throw new Error('Unclosed section "'+openSection[1]+'" at '+scanner.pos);return function(tokens){for(var token,nestedTokens=[],collector=nestedTokens,sections=[],i=0,numTokens=tokens.length;i<numTokens;++i)switch((token=tokens[i])[0]){case"$":case"<":case"#":case"^":collector.push(token),sections.push(token),collector=token[4]=[];break;case"/":sections.pop()[5]=token[2],collector=sections.length>0?sections[sections.length-1][4]:nestedTokens;break;default:collector.push(token)}return nestedTokens}(function(tokens){for(var token,lastToken,squashedTokens=[],i=0,numTokens=tokens.length;i<numTokens;++i)(token=tokens[i])&&("text"===token[0]&&lastToken&&"text"===lastToken[0]?(lastToken[1]+=token[1],lastToken[3]=token[3]):(squashedTokens.push(token),lastToken=token));return squashedTokens}(tokens))}(template,tags)),tokens},Writer.prototype.render=function(template,view,partials,tags){var tokens=this.parse(template,tags),context=view instanceof Context?view:new Context(view);return this.renderTokens(tokens,context,partials,template,tags)},Writer.prototype.renderTokens=function(tokens,context,partials,originalTemplate,tags){for(var token,symbol,value,buffer="",i=0,numTokens=tokens.length;i<numTokens;++i)value=void 0,"#"===(symbol=(token=tokens[i])[0])?value=this.renderSection(token,context,partials,originalTemplate):"^"===symbol?value=this.renderInverted(token,context,partials,originalTemplate):">"===symbol?value=this.renderPartial(token,context,partials,tags):"<"===symbol?value=this.renderBlock(token,context,partials,originalTemplate):"$"===symbol?value=this.renderBlockVariable(token,context,partials,originalTemplate):"&"===symbol?value=this.unescapedValue(token,context):"name"===symbol?value=this.escapedValue(token,context):"text"===symbol&&(value=this.rawValue(token)),void 0!==value&&(buffer+=value);return buffer},Writer.prototype.renderSection=function(token,context,partials,originalTemplate){var self=this,buffer="",value=context.lookup(token[1]);if(value){if(isArray(value))for(var j=0,valueLength=value.length;j<valueLength;++j)buffer+=this.renderTokens(token[4],context.push(value[j]),partials,originalTemplate);else if("object"===_typeof(value)||"string"==typeof value||"number"==typeof value)buffer+=this.renderTokens(token[4],context.push(value),partials,originalTemplate);else if(isFunction(value)){if("string"!=typeof originalTemplate)throw new Error("Cannot use higher-order sections without the original template");null!=(value=value.call(context.view,originalTemplate.slice(token[3],token[5]),(function(template){return self.render(template,context,partials)})))&&(buffer+=value)}else buffer+=this.renderTokens(token[4],context,partials,originalTemplate);return buffer}},Writer.prototype.renderInverted=function(token,context,partials,originalTemplate){var value=context.lookup(token[1]);if(!value||isArray(value)&&0===value.length)return this.renderTokens(token[4],context,partials,originalTemplate)},Writer.prototype.indentPartial=function(partial,indentation,lineHasNonSpace){for(var filteredIndentation=indentation.replace(/[^ \t]/g,""),partialByNl=partial.split("\n"),i=0;i<partialByNl.length;i++)partialByNl[i].length&&(i>0||!lineHasNonSpace)&&(partialByNl[i]=filteredIndentation+partialByNl[i]);return partialByNl.join("\n")},Writer.prototype.renderPartial=function(token,context,partials,tags){if(partials){var value=isFunction(partials)?partials(token[1]):partials[token[1]];if(null!=value){var lineHasNonSpace=token[6],tagIndex=token[5],indentation=token[4],indentedValue=value;return 0==tagIndex&&indentation&&(indentedValue=this.indentPartial(value,indentation,lineHasNonSpace)),this.renderTokens(this.parse(indentedValue,tags),context,partials,indentedValue)}}},Writer.prototype.renderBlock=function(token,context,partials,originalTemplate){if(partials){var value=isFunction(partials)?partials(token[1]):partials[token[1]];null!=value&&context.clearBlockVars(),this.renderTokens(token[4],context,partials,originalTemplate);var result=this.renderTokens(this.parse(value),context,partials,value);return context.clearBlockVars(),result}},Writer.prototype.renderBlockVariable=function(token,context,partials,originalTemplate){var value=token[1],exists=context.getBlockVar(value);return exists?this.renderTokens(this.parse(exists),context,partials,exists):(context.setBlockVar(value,originalTemplate.slice(token[3],token[5])),this.renderTokens(token[4],context,partials,originalTemplate))},Writer.prototype.unescapedValue=function(token,context){var value=context.lookup(token[1]);if(null!=value)return value},Writer.prototype.escapedValue=function(token,context){var value=context.lookup(token[1]);if(null!=value)return mustache.escape(value)},Writer.prototype.rawValue=function(token){return token[1]},mustache.name="mustache.js",mustache.version="3.1.0",mustache.tags=["{{","}}"];var defaultWriter=new Writer;return mustache.clearCache=function(){return defaultWriter.clearCache()},mustache.parse=function(template,tags){return defaultWriter.parse(template,tags)},mustache.render=function(template,view,partials,tags){if("string"!=typeof template)throw new TypeError('Invalid template! Template should be a "string" but "'+(isArray(obj=template)?"array":_typeof(obj))+'" was given as the first argument for mustache#render(template, view, partials)');var obj;return defaultWriter.render(template,view,partials,tags)},mustache.to_html=function(template,view,partials,send){var result=mustache.render(template,view,partials);if(!isFunction(send))return result;send(result)},mustache.escape=function(string){return String(string).replace(/[&<>"'`=\/]/g,(function(s){return entityMap[s]}))},mustache.Scanner=Scanner,mustache.Context=Context,mustache.Writer=Writer,mustache},"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&exports&&"string"!=typeof exports.nodeName?factory(exports):"function"==typeof define&&define.amd?define("core/mustache",["exports"],factory):(global.Mustache={},factory(global.Mustache));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)
/**
 * A javascript module to handle list items drag and drop
 *
 * Example of usage:
 *
 * Create a list (for example <ul> or <tbody>) where each draggable element has a drag handle.
 * The best practice is to use the template core/drag_handle:
 * $OUTPUT->render_from_template('core/drag_handle', ['movetitle' => get_string('movecontent', 'moodle', ELEMENTNAME)]);
 *
 * Attach this JS module to this list:
 *
 * Space between define and ( critical in comment but not allowed in code in order to function
 * correctly with Moodle's requirejs.php
 *
 * define (['jquery', 'core/sortable_list'], function($, SortableList) {
 *     var list = new SortableList('ul.my-awesome-list'); // source list (usually <ul> or <tbody>) - selector or element
 *
 *     // Listen to the events when element is dragged.
 *     $('ul.my-awesome-list > *').on(SortableList.EVENTS.DROP, function(evt, info) {
 *         console.log(info);
 *     });
 *
 *     // Advanced usage. Overwrite methods getElementName, getDestinationName, moveDialogueTitle, for example:
 *     list.getElementName = function(element) {
 *         return $.Deferred().resolve(element.attr('data-name'));
 *     }
 * }
 *
 * More details: https://docs.moodle.org/dev/Sortable_list
 *
 * For the full list of possible parameters see var defaultParameters below.
 *
 * The following jQuery events are fired:
 * - SortableList.EVENTS.DRAGSTART : when user started dragging a list element
 * - SortableList.EVENTS.DRAG : when user dragged a list element to a new position
 * - SortableList.EVENTS.DROP : when user dropped a list element
 * - SortableList.EVENTS.DROPEND : when user finished dragging - either fired right after dropping or
 *                          if "Esc" was pressed during dragging
 *
 * @module     core/sortable_list
 * @class      sortable_list
 * @package    core
 * @copyright  2018 Marina Glancy
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */}define("core/sortable_list",["jquery","core/log","core/autoscroll","core/str","core/modal_factory","core/modal_events","core/notification"],(function($,log,autoScroll,str,ModalFactory,ModalEvents,Notification){var defaultParameters={targetListSelector:null,moveHandlerSelector:"[data-drag-type=move]",isHorizontal:!1,autoScroll:!0},CSS_keyboardDragClass="dragdrop-keyboard-drag",CSS_isDraggedClass="sortable-list-is-dragged",CSS_currentPositionClass="sortable-list-current-position",CSS_targetListClass="sortable-list-target",CSS_overElementClass="sortable-list-over-element",registerNotPassiveListeners=function(eventname){return{setup:function(x,ns,handle){return!!ns.includes("notPassive")&&(this.addEventListener(eventname,handle,{passive:!1}),!0)}}};(function(){var options,passivesupported=!1;try{options=Object.defineProperty({},"passive",{get:function(){passivesupported=!0}}),document.addEventListener("testpassiveeventoptions",options,options),document.removeEventListener("testpassiveeventoptions",options,options)}catch(err){passivesupported=!1}return passivesupported})&&($.event.special.touchstart=registerNotPassiveListeners("touchstart"),$.event.special.touchmove=registerNotPassiveListeners("touchmove"),$.event.special.touchend=registerNotPassiveListeners("touchend"));var SortableList=function(root,config){this.info=null,this.proxy=null,this.proxyDelta=null,this.dragCounter=0,this.lastEvent=null,this.config=$.extend({},defaultParameters,config||{}),this.config.listSelector=root,this.config.targetListSelector||(this.config.targetListSelector=root),"object"===_typeof(this.config.listSelector)?$(this.config.listSelector).on("mousedown touchstart.notPassive",$.proxy(this.dragStartHandler,this)):$("body").on("mousedown touchstart.notPassive",this.config.listSelector,$.proxy(this.dragStartHandler,this)),null!==this.config.moveHandlerSelector&&$("body").on("click keypress",this.config.moveHandlerSelector,$.proxy(this.clickHandler,this))};return SortableList.EVENTS={DRAGSTART:"sortablelist-dragstart",DRAG:"sortablelist-drag",DROP:"sortablelist-drop",DRAGEND:"sortablelist-dragend"},SortableList.prototype.resetDraggedClasses=function(){var classes=[CSS_isDraggedClass,CSS_currentPositionClass,CSS_overElementClass,CSS_targetListClass];for(var i in classes)$("."+classes[i]).removeClass(classes[i]);this.proxy&&(this.proxy.remove(),this.proxy=$())},SortableList.prototype.calculatePositionOnPage=function(evt){if(evt.originalEvent&&evt.originalEvent.touches&&void 0!==evt.originalEvent.touches[0]){var touch=evt.originalEvent.touches[0];evt.pageX=touch.pageX,evt.pageY=touch.pageY}void 0===evt.pageX?(evt.pageX=this.lastEvent.pageX,evt.pageY=this.lastEvent.pageY):this.lastEvent=evt,void 0===evt.clientX&&(evt.clientX=Math.round(evt.pageX-$(window).scrollLeft()),evt.clientY=Math.round(evt.pageY-$(window).scrollTop()))},SortableList.prototype.dragStartHandler=function(evt){if(null!==this.info){if("click"===this.info.type||"touchend"===this.info.type)return;this.moveElement(this.info.sourceList,this.info.sourceNextElement),this.finishDragging()}if("mousedown"!==evt.type||1===evt.which){this.calculatePositionOnPage(evt);var movedElement=$(evt.target).closest($(evt.currentTarget).children());if(movedElement.length&&(null===this.config.moveHandlerSelector||$(evt.target).closest(this.config.moveHandlerSelector,movedElement).length)){evt.stopPropagation(),evt.preventDefault(),this.dragCounter++,this.info={element:movedElement,sourceNextElement:movedElement.next(),sourceList:movedElement.parent(),targetNextElement:movedElement.next(),targetList:movedElement.parent(),type:evt.type,dropped:!1,startX:evt.pageX,startY:evt.pageY,startTime:(new Date).getTime()},$(this.config.targetListSelector).addClass(CSS_targetListClass);var offset=movedElement.offset();movedElement.addClass(CSS_currentPositionClass),this.proxyDelta={x:offset.left-evt.pageX,y:offset.top-evt.pageY},this.proxy=$();var thisDragCounter=this.dragCounter;setTimeout($.proxy((function(){null!==this.info&&"click"!==this.info.type&&"keypress"!==this.info.type&&this.dragCounter===thisDragCounter&&this.createProxy()}),this),500),$(window).on("mousemove touchmove.notPassive mouseup touchend.notPassive",$.proxy(this.dragHandler,this)),$(window).on("keypress",$.proxy(this.dragcancelHandler,this)),this.config.autoScroll&&autoScroll.start((function(){$(window).trigger("mousemove")})),this.executeCallback(SortableList.EVENTS.DRAGSTART)}}},SortableList.prototype.createProxy=function(){this.proxy=this.info.element.clone(),this.info.sourceList.append(this.proxy),this.proxy.removeAttr("id").removeClass(CSS_currentPositionClass).addClass(CSS_isDraggedClass).css({position:"fixed"}),this.proxy.offset({top:this.proxyDelta.y+this.lastEvent.pageY,left:this.proxyDelta.x+this.lastEvent.pageX})},SortableList.prototype.clickHandler=function(evt){if(("keypress"!==evt.type||13===evt.originalEvent.keyCode||32===evt.originalEvent.keyCode)&&null===this.info){var clickedElement=$(evt.target).closest(this.config.moveHandlerSelector),sourceList=clickedElement.closest(this.config.listSelector),movedElement=clickedElement.closest(sourceList.children());movedElement.length&&(evt.preventDefault(),evt.stopPropagation(),this.dragCounter++,this.info={element:movedElement,sourceNextElement:movedElement.next(),sourceList:sourceList,targetNextElement:movedElement.next(),targetList:sourceList,dropped:!1,type:evt.type,startTime:(new Date).getTime()},this.executeCallback(SortableList.EVENTS.DRAGSTART),this.displayMoveDialogue(clickedElement))}},SortableList.prototype.getPositionInNode=function(pageX,pageY,element){if(!element.length)return null;var rect=element[0].getBoundingClientRect(),y=pageY-(rect.top+window.scrollY),x=pageX-(rect.left+window.scrollX);return x>=-0&&x<=rect.width+0&&y>=-0&&y<=rect.height+0?{x:x,y:y,xRatio:rect.width?x/rect.width:0,yRatio:rect.height?y/rect.height:0}:null},SortableList.prototype.isListHorizontal=function(element){var isHorizontal=this.config.isHorizontal;return!0===isHorizontal||!1===isHorizontal?isHorizontal:isHorizontal(element)},SortableList.prototype.dragHandler=function(evt){evt.preventDefault(),evt.stopPropagation(),this.calculatePositionOnPage(evt),this.proxy.offset({top:-1e3,left:-1e3});var element=$(document.elementFromPoint(evt.clientX,evt.clientY)),mainElement=this.info.element[0],isNotSelf=function(){return this!==mainElement},current=element.closest("."+CSS_targetListClass+" > :not(."+CSS_isDraggedClass+")").filter(isNotSelf),currentList=element.closest("."+CSS_targetListClass),proxy=this.proxy,isNotProxy=function(){return!proxy||!proxy.length||this!==proxy[0]};if($("."+CSS_overElementClass).removeClass(CSS_overElementClass),current.addClass(CSS_overElementClass),this.proxy.offset({top:this.proxyDelta.y+evt.pageY,left:this.proxyDelta.x+evt.pageX}),currentList.length&&!currentList.children().filter(isNotProxy).length)this.moveElement(currentList,$());else if(1===current.length&&!this.info.element.find(current[0]).length){var coordinates=this.getPositionInNode(evt.pageX,evt.pageY,current);if(coordinates){var parent=current.parent(),ratio=this.isListHorizontal(parent)?coordinates.xRatio:coordinates.yRatio,subList=current.find("."+CSS_targetListClass),subListEmpty=!subList.children().filter(isNotProxy).filter(isNotSelf).length;subList.length&&subListEmpty&&ratio>.2&&ratio<.8?this.moveElement(subList,$()):ratio>.5?this.moveElement(parent,current.next().filter(isNotProxy)):this.moveElement(parent,current)}}if("mouseup"===evt.type||"touchend"===evt.type){this.info.endX=evt.pageX,this.info.endY=evt.pageY,this.info.endTime=(new Date).getTime(),this.info.dropped=!0,this.info.positionChanged=this.hasPositionChanged(this.info);var oldinfo=this.info;this.executeCallback(SortableList.EVENTS.DROP),this.finishDragging(),"touchend"===evt.type&&null!==this.config.moveHandlerSelector&&oldinfo.endTime-oldinfo.startTime<500&&!oldinfo.positionChanged&&this.clickHandler(evt)}},SortableList.prototype.hasPositionChanged=function(info){return info.sourceList[0]!==info.targetList[0]||info.sourceNextElement.length!==info.targetNextElement.length||info.sourceNextElement.length&&info.sourceNextElement[0]!==info.targetNextElement[0]},SortableList.prototype.moveElement=function(parentElement,beforeElement){var dragEl=this.info.element;beforeElement.length&&beforeElement[0]===dragEl[0]||parentElement[0]===this.info.targetList[0]&&beforeElement.length===this.info.targetNextElement.length&&beforeElement[0]===this.info.targetNextElement[0]||(beforeElement.length?parentElement[0].insertBefore(dragEl[0],beforeElement[0]):this.proxy&&this.proxy.parent().length&&this.proxy.parent()[0]===parentElement[0]?parentElement[0].insertBefore(dragEl[0],this.proxy[0]):parentElement[0].appendChild(dragEl[0]),this.info.targetList=parentElement,this.info.targetNextElement=beforeElement,this.executeCallback(SortableList.EVENTS.DRAG))},SortableList.prototype.finishDragging=function(){this.resetDraggedClasses(),this.config.autoScroll&&autoScroll.stop(),$(window).off("mousemove touchmove.notPassive mouseup touchend.notPassive",$.proxy(this.dragHandler,this)),$(window).off("keypress",$.proxy(this.dragcancelHandler,this)),this.executeCallback(SortableList.EVENTS.DRAGEND),this.info=null},SortableList.prototype.executeCallback=function(eventName){this.info.element.trigger(eventName,this.info)},SortableList.prototype.dragcancelHandler=function(evt){"keypress"===evt.type&&27===evt.originalEvent.keyCode&&(this.moveElement(this.info.sourceList,this.info.sourceNextElement),this.finishDragging())},SortableList.prototype.getElementName=function(element){return $.Deferred().resolve(element.text())},SortableList.prototype.getDestinationName=function(parentElement,afterElement){return afterElement.length?this.getElementName(afterElement).then((function(name){return str.get_string("movecontentafter","moodle",name)})):str.get_string("movecontenttothetop","moodle")},SortableList.prototype.getMoveDialogueTitle=function(element,handler){return handler.attr("title")?$.Deferred().resolve(handler.attr("title")):this.getElementName(element).then((function(name){return str.get_string("movecontent","moodle",name)}))},SortableList.prototype.getDestinationsList=function(){var addedLists=[],targets=$(this.config.targetListSelector),destinations=$("<ul/>").addClass(CSS_keyboardDragClass),result=$.when().then((function(){return destinations})),createLink=$.proxy((function(parentElement,beforeElement,afterElement){beforeElement.is(this.info.element)||afterElement.is(this.info.element)||$.contains(this.info.element[0],parentElement[0])||(result=result.then($.proxy((function(){return this.getDestinationName(parentElement,afterElement)}),this)).then((function(txt){var li=$("<li/>").appendTo(destinations);return $('<a href="#"/>').attr("data-core_sortable_list-quickmove",1).appendTo(li).data("parent-element",parentElement).data("before-element",beforeElement).text(txt),destinations})))}),this);return targets.each((function addList(){if(-1===$.inArray(this,addedLists)){addedLists.push(this);var list=$(this),children=list.children();children.each((function(){var element=$(this);createLink(list,element,element.prev()),element.find(targets).each(addList)})),createLink(list,$(),children.last())}})),result},SortableList.prototype.displayMoveDialogue=function(clickedElement){ModalFactory.create({type:ModalFactory.types.CANCEL,title:this.getMoveDialogueTitle(this.info.element,clickedElement),body:this.getDestinationsList()}).then($.proxy((function(modal){var quickMoveHandler=$.proxy((function(e){e.preventDefault(),e.stopPropagation(),this.moveElement($(e.currentTarget).data("parent-element"),$(e.currentTarget).data("before-element")),this.info.endTime=(new Date).getTime(),this.info.positionChanged=this.hasPositionChanged(this.info),this.info.dropped=!0,clickedElement.focus(),this.executeCallback(SortableList.EVENTS.DROP),modal.hide()}),this);return modal.getRoot().on("click","[data-core_sortable_list-quickmove]",quickMoveHandler),modal.getRoot().on(ModalEvents.hidden,$.proxy((function(){modal.getRoot().off("click","[data-core_sortable_list-quickmove]",quickMoveHandler),modal.destroy(),this.finishDragging()}),this)),modal.setLarge(),modal.show(),modal}),this)).catch(Notification.exception)},SortableList}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core/modal_cancel",["exports","core/modal"],(function(_exports,_modal){var obj;function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(target,property,receiver){var base=_superPropBase(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(arguments.length<3?target:receiver):desc.value}},_get.apply(this,arguments)}function _superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=_getPrototypeOf(object)););return object}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&("object"===_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;var _default=function(_Modal){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}(_default,_Modal);var Constructor,protoProps,staticProps,_super=_createSuper(_default);function _default(root){var _this;return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,_default),(_this=_super.call(this,root)).getFooter().find(_this.getActionSelector("cancel")).length||Notification.exception({message:"No cancel button found"}),_this}return Constructor=_default,(protoProps=[{key:"registerEventListeners",value:function(){_get(_getPrototypeOf(_default.prototype),"registerEventListeners",this).call(this),this.registerCloseOnCancel()}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),_default}((_modal=(obj=_modal)&&obj.__esModule?obj:{default:obj}).default);return _exports.default=_default,_exports.default}));
/**
 * Chart output base.
 *
 * This takes a chart object and draws it.
 *
 * @package    core
 * @copyright  2016 Frdric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @module     core/chart_output_base
 */
define("core/chart_output_base",["jquery"],(function($){function Base(node,chart){this._node=$(node),this._chart=chart}return Base.prototype.update=function(){throw new Error("Not supported.")},Base}));
/**
 * Course selector adaptor for auto-complete form element.
 *
 * @module     core/form-course-selector
 * @class      form-course-selector
 * @package    core
 * @copyright  2016 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("core/form-course-selector",["core/ajax","jquery"],(function(ajax,$){return{processResults:function(selector,data){var results=[],i=0,excludelist=String($(selector).data("exclude")).split(",");for(i=0;i<data.courses.length;i++)-1===excludelist.indexOf(String(data.courses[i].id))&&results.push({value:data.courses[i].id,label:data.courses[i].displayname});return results},transport:function(selector,query,success,failure){var el=$(selector),requiredcapabilities=el.data("requiredcapabilities");requiredcapabilities=""!==requiredcapabilities.trim()?requiredcapabilities.split(","):[];var promises,limittoenrolled=el.data("limittoenrolled"),includefrontpage=el.data("includefrontpage"),onlywithcompletion=el.data("onlywithcompletion");void 0===query&&(query="");var calls=[{methodname:"core_course_search_courses",args:{criterianame:"search",criteriavalue:query,page:0,perpage:100,requiredcapabilities:requiredcapabilities,limittoenrolled:limittoenrolled,onlywithcompletion:onlywithcompletion}}];includefrontpage&&calls.push({methodname:"core_course_get_courses",args:{options:{ids:[includefrontpage]}}}),promises=ajax.call(calls),$.when.apply($.when,promises).done((function(data,site){if(site&&1==site.length){var frontpage=site.pop();(""===query||frontpage.fullname.toUpperCase().indexOf(query.toUpperCase())>-1||frontpage.shortname.toUpperCase().indexOf(query.toUpperCase())>-1)&&data.courses.splice(0,0,frontpage)}success(data)})).fail(failure)}}}));
/**
 * Chart output.
 *
 * Proxy to the default output module.
 *
 * @package    core
 * @copyright  2016 Frdric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/chart_output",["core/chart_output_chartjs"],(function(Output){return Output}));
/**
 * Wrap an instance of the browser's local or session storage to handle
 * cache expiry, key namespacing and other helpful things.
 *
 * @module     core/storagewrapper
 * @package    core
 * @copyright  2017 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/storagewrapper",["core/config"],(function(config){var Wrapper=function(storage){this.storage=storage,this.supported=this.detectSupport(),this.hashSource=config.wwwroot+"/"+config.jsrev,this.hash=this.hashString(this.hashSource),this.prefix=this.hash+"/",this.jsrevPrefix=this.hashString(config.wwwroot)+"/jsrev",this.validateCache()};return Wrapper.prototype.detectSupport=function(){if(-1==config.jsrev)return!1;if(void 0===this.storage)return!1;try{return null!==this.storage&&(this.storage.setItem("test","1"),this.storage.removeItem("test"),!0)}catch(ex){return!1}},Wrapper.prototype.prefixKey=function(key){return this.prefix+key},Wrapper.prototype.validateCache=function(){var cacheVersion=this.storage.getItem(this.jsrevPrefix);null!==cacheVersion?config.jsrev!=cacheVersion&&(this.storage.clear(),this.storage.setItem(this.jsrevPrefix,config.jsrev)):this.storage.setItem(this.jsrevPrefix,config.jsrev)},Wrapper.prototype.hashString=function(source){var i,len,hash=0;if(0===source.length)return hash;for(i=0,len=source.length;i<len;i++)hash=(hash<<5)-hash+source.charCodeAt(i),hash|=0;return hash},Wrapper.prototype.get=function(key){return!!this.supported&&(key=this.prefixKey(key),this.storage.getItem(key))},Wrapper.prototype.set=function(key,value){if(!this.supported)return!1;key=this.prefixKey(key);try{this.storage.setItem(key,value)}catch(e){return!1}return!0},Wrapper}));
define("core/local/aria/focuslock",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.untrapFocus=_exports.trapFocus=void 0;
/**
   * Tab locking system.
   *
   * This is based on code and examples provided in the ARIA specification.
   * https://www.w3.org/TR/wai-aria-practices/examples/dialog-modal/dialog.html
   *
   * @module     core/tablock
   * @class      tablock
   * @package    core
   * @copyright  2019 Andrew Nicols <andrew@nicols.co.uk>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
var selectors_focusable='input:not([type="hidden"]), a[href], button, textarea, select, [tabindex]',lockRegionStack=[],initialFocusElementStack=[],finalFocusElementStack=[],lastFocus=null,ignoreFocusChanges=!1,isLocked=!1,lockHandler=function(event){if(!ignoreFocusChanges){var lockRegion=getCurrentLockRegion();lockRegion.parentNode||untrapFocus(),lockRegion.contains(event.target)?lastFocus=event.target:(focusFirstDescendant(),lastFocus==document.activeElement&&focusLastDescendant(),lastFocus=document.activeElement)}},focusFirstDescendant=function(){var lockRegion=getCurrentLockRegion(),focusableElements=Array.from(lockRegion.querySelectorAll(selectors_focusable));return focusableElements.unshift(lockRegion),focusableElements.some((function(focusableElement){return attemptFocus(focusableElement)}))},focusLastDescendant=function(){var lockRegion=getCurrentLockRegion(),focusableElements=Array.from(lockRegion.querySelectorAll(selectors_focusable)).reverse();return focusableElements.push(lockRegion),focusableElements.some((function(focusableElement){return attemptFocus(focusableElement)}))},attemptFocus=function(focusTarget){if(!function(focusTarget){if(focusTarget.tabIndex>0||0===focusTarget.tabIndex&&null!==focusTarget.getAttribute("tabIndex"))return!0;if(focusTarget.disabled)return!1;switch(focusTarget.nodeName){case"A":return!!focusTarget.href&&"ignore"!=focusTarget.rel;case"INPUT":return"hidden"!=focusTarget.type&&"file"!=focusTarget.type;case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}}(focusTarget))return!1;ignoreFocusChanges=!0;try{focusTarget.focus()}catch(e){}return ignoreFocusChanges=!1,document.activeElement===focusTarget},getCurrentLockRegion=function(){return lockRegionStack[lockRegionStack.length-1]};_exports.trapFocus=function(newLockRegion){if(function(newLockRegion){if(newLockRegion!==getCurrentLockRegion()){lockRegionStack.push(newLockRegion);var currentLockRegion=getCurrentLockRegion(),element=document.createElement("div");element.tabIndex=0,element.style.position="fixed",element.style.top=0,element.style.left=0;var initialNode=element.cloneNode();currentLockRegion.parentNode.insertBefore(initialNode,currentLockRegion),initialFocusElementStack.push(initialNode);var finalNode=element.cloneNode();currentLockRegion.parentNode.insertBefore(finalNode,currentLockRegion.nextSibling),finalFocusElementStack.push(finalNode)}}(newLockRegion),isLocked||document.addEventListener("focus",lockHandler,!0),!focusFirstDescendant()){var currentLockRegion=getCurrentLockRegion(),originalRegionTabIndex=currentLockRegion.tabIndex;currentLockRegion.tabIndex=0,attemptFocus(currentLockRegion),currentLockRegion.tabIndex=originalRegionTabIndex}lastFocus=document.activeElement,isLocked=!0};var untrapFocus=function(){!function(){lockRegionStack.pop();var finalNode=finalFocusElementStack.pop();finalNode&&finalNode.remove();var initialNode=initialFocusElementStack.pop();initialNode&&initialNode.remove()}(),lockRegionStack.length||(document.removeEventListener("focus",lockHandler,!0),lastFocus=null,ignoreFocusChanges=!1,isLocked=!1)};_exports.untrapFocus=untrapFocus}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core/local/modal/alert",["exports","core/modal"],(function(_exports,_modal){var obj;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(target,property,receiver){var base=_superPropBase(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(arguments.length<3?target:receiver):desc.value}},_get.apply(this,arguments)}function _superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=_getPrototypeOf(object)););return object}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&("object"===_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;var _default=function(_Modal){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}(_default,_Modal);var Constructor,protoProps,staticProps,_super=_createSuper(_default);function _default(){return _classCallCheck(this,_default),_super.apply(this,arguments)}return Constructor=_default,(protoProps=[{key:"registerEventListeners",value:function(){_get(_getPrototypeOf(_default.prototype),"registerEventListeners",this).call(this),this.registerCloseOnCancel()}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),_default}((_modal=(obj=_modal)&&obj.__esModule?obj:{default:obj}).default);return _exports.default=_default,_exports.default}));
/**
 * Javascript to enhance the paged content paging bar.
 *
 * @module     core/paging_bar
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/paged_content_paging_bar",["jquery","core/custom_interaction_events","core/paged_content_events","core/str","core/pubsub","core/pending"],(function($,CustomEvents,PagedContentEvents,Str,PubSub,Pending){var SELECTORS_PAGE="[data-page]",SELECTORS_PAGE_ITEM='[data-region="page-item"]',SELECTORS_PAGE_LINK='[data-region="page-link"]',SELECTORS_FIRST_BUTTON='[data-control="first"]',SELECTORS_LAST_BUTTON='[data-control="last"]',SELECTORS_NEXT_BUTTON='[data-control="next"]',SELECTORS_PREVIOUS_BUTTON='[data-control="previous"]',SELECTORS_DOTS_BUTTONS="[data-dots]",SELECTORS_BEGINNING_DOTS_BUTTON='[data-dots="beginning"]',SELECTORS_ENDING_DOTS_BUTTON='[data-dots="ending"]',getPageByNumber=function(root,pageNumber){return root.find(SELECTORS_PAGE_ITEM+'[data-page-number="'+pageNumber+'"]')},setLastPageNumber=function(root,number){root.attr("data-last-page-number",number)},getLastPageNumber=function(root){return parseInt(root.attr("data-last-page-number"),10)},getActivePageNumber=function(root){return parseInt(root.attr("data-active-page-number"),10)},setActivePageNumber=function(root,number){root.attr("data-active-page-number",number)},getPageNumber=function(root,page){if(null!=page.attr("data-page"))return parseInt(page.attr("data-page-number"),10);var pageNumber=1,activePageNumber=null;switch(page.attr("data-control")){case"first":default:pageNumber=1;break;case"last":pageNumber=getLastPageNumber(root);break;case"next":activePageNumber=getActivePageNumber(root);var lastPage=getLastPageNumber(root);pageNumber=lastPage?activePageNumber&&activePageNumber<lastPage?activePageNumber+1:lastPage:activePageNumber+1;break;case"previous":pageNumber=(activePageNumber=getActivePageNumber(root))&&activePageNumber>1?activePageNumber-1:1}return parseInt(pageNumber,10)},show=function(root){root.removeClass("hidden")},hide=function(root){root.addClass("hidden")},disableNextControlButtons=function(root){var nextButton=root.find(SELECTORS_NEXT_BUTTON),lastButton=root.find(SELECTORS_LAST_BUTTON);nextButton.addClass("disabled"),nextButton.attr("aria-disabled",!0),lastButton.addClass("disabled"),lastButton.attr("aria-disabled",!0)},enableNextControlButtons=function(root){var nextButton=root.find(SELECTORS_NEXT_BUTTON),lastButton=root.find(SELECTORS_LAST_BUTTON);nextButton.removeClass("disabled"),nextButton.removeAttr("aria-disabled"),lastButton.removeClass("disabled"),lastButton.removeAttr("aria-disabled")},disablePreviousControlButtons=function(root){var previousButton=root.find(SELECTORS_PREVIOUS_BUTTON),firstButton=root.find(SELECTORS_FIRST_BUTTON);previousButton.addClass("disabled"),previousButton.attr("aria-disabled",!0),firstButton.addClass("disabled"),firstButton.attr("aria-disabled",!0)},adjustPagingBarSize=function(root){var activePageNumber=getActivePageNumber(root),lastPageNumber=getLastPageNumber(root),dotsButtons=root.find(SELECTORS_DOTS_BUTTONS),beginningDotsButton=root.find(SELECTORS_BEGINNING_DOTS_BUTTON),endingDotsButton=root.find(SELECTORS_ENDING_DOTS_BUTTON),pages=root.find(SELECTORS_PAGE),barSize=parseInt(root.attr("data-bar-size"),10);if(barSize&&lastPageNumber>barSize){var minpage=Math.max(activePageNumber-Math.round(barSize/2),1),maxpage=minpage+barSize-1;maxpage>=lastPageNumber&&(minpage=(maxpage=lastPageNumber)-barSize+1),minpage>1?(show(beginningDotsButton),minpage++):hide(beginningDotsButton),maxpage<lastPageNumber?(show(endingDotsButton),maxpage--):hide(endingDotsButton),dotsButtons.addClass("disabled"),dotsButtons.attr("aria-disabled",!0),hide(pages),pages.each((function(index,page){page=$(page),index+1>=minpage&&index+1<=maxpage&&show(page)}))}else hide(dotsButtons)},enablePreviousControlButtons=function(root){var previousButton=root.find(SELECTORS_PREVIOUS_BUTTON),firstButton=root.find(SELECTORS_FIRST_BUTTON);previousButton.removeClass("disabled"),previousButton.removeAttr("aria-disabled"),firstButton.removeClass("disabled"),firstButton.removeAttr("aria-disabled")},showPage=function(root,pageNumber,id){var pendingPromise=new Pending("core/paged_content_paging_bar:showPage"),lastPageNumber=getLastPageNumber(root),isSamePage=pageNumber==getActivePageNumber(root),limit=function(root){return parseInt(root.attr("data-items-per-page"),10)}(root),offset=(pageNumber-1)*limit;if(!isSamePage){root.find(SELECTORS_PAGE_ITEM).removeClass("active").removeAttr("aria-current");var page=getPageByNumber(root,pageNumber);page.addClass("active"),page.attr("aria-current",!0),setActivePageNumber(root,pageNumber),adjustPagingBarSize(root)}lastPageNumber&&pageNumber>=lastPageNumber?disableNextControlButtons(root):enableNextControlButtons(root),pageNumber>1?enablePreviousControlButtons(root):disablePreviousControlButtons(root),function(root){var pageAriaLabelComponents=function(root){return root.attr("data-aria-label-components-pagination-item").split(",").map((function(component){return component.trim()}))}(root),activePageAriaLabelComponents=function(root){return root.attr("data-aria-label-components-pagination-active-item").split(",").map((function(component){return component.trim()}))}(root),activePageNumber=getActivePageNumber(root),pageItems=root.find(SELECTORS_PAGE_ITEM),stringRequests=pageItems.map((function(index,page){page=$(page);var pageNumber=getPageNumber(root,page);return pageNumber===activePageNumber?{key:activePageAriaLabelComponents[0],component:activePageAriaLabelComponents[1],param:pageNumber}:{key:pageAriaLabelComponents[0],component:pageAriaLabelComponents[1],param:pageNumber}}));Str.get_strings(stringRequests).then((function(strings){return pageItems.each((function(index,page){page=$(page);var string=strings[index];page.attr("aria-label",string),page.find(SELECTORS_PAGE_LINK).attr("aria-label",string)})),strings})).catch((function(){}))}(root),PubSub.publish(id+PagedContentEvents.SHOW_PAGES,[{pageNumber:pageNumber,limit:limit,offset:offset}]),pendingPromise.resolve()};return{init:function(root,id){var pages=(root=$(root)).find(SELECTORS_PAGE);if(function(root,items){var lastPageNumber=0;setActivePageNumber(root,0),items.each((function(index,item){var pageNumber=index+1;(item=$(item)).attr("data-page-number",pageNumber),lastPageNumber++,item.hasClass("active")&&setActivePageNumber(root,pageNumber)})),setLastPageNumber(root,lastPageNumber)}(root,pages),function(root,id){var ignoreControlWhileLoading=root.attr("data-ignore-control-while-loading"),loading=!1;""==ignoreControlWhileLoading&&(ignoreControlWhileLoading=!0),CustomEvents.define(root,[CustomEvents.events.activate]),root.on(CustomEvents.events.activate,SELECTORS_PAGE_ITEM,(function(e,data){if(data.originalEvent.preventDefault(),data.originalEvent.stopPropagation(),!ignoreControlWhileLoading||!loading){var page=$(e.target).closest(SELECTORS_PAGE_ITEM);if(!page.hasClass("disabled")){var pageNumber=getPageNumber(root,page);showPage(root,pageNumber,id),loading=!0}}})),PubSub.subscribe(id+PagedContentEvents.ALL_ITEMS_LOADED,(function(pageNumber){loading=!1;var currentLastPage=getLastPageNumber(root);(!currentLastPage||pageNumber<currentLastPage)&&setLastPageNumber(root,pageNumber),1===pageNumber&&root.attr("data-hide-control-on-single-page")?(hide(root),disableNextControlButtons(root),disablePreviousControlButtons(root)):(show(root),disableNextControlButtons(root))})),PubSub.subscribe(id+PagedContentEvents.PAGES_SHOWN,(function(){loading=!1})),PubSub.subscribe(id+PagedContentEvents.SET_ITEMS_PER_PAGE_LIMIT,(function(limit){!function(root,limit){root.attr("data-items-per-page",limit)}(root,limit),setLastPageNumber(root,0),setActivePageNumber(root,0),show(root),showPage(root,1,id)}))}(root,id),function(root){var number=getActivePageNumber(root);return!isNaN(number)&&0!=number}(root)){var activePageNumber=getActivePageNumber(root);getPageByNumber(root,activePageNumber).click(),1==activePageNumber&&disablePreviousControlButtons(root)}else(function(root){return root.find(SELECTORS_NEXT_BUTTON)})(root).click();adjustPagingBarSize(root)},disableNextControlButtons:disableNextControlButtons,enableNextControlButtons:enableNextControlButtons,disablePreviousControlButtons:disablePreviousControlButtons,enablePreviousControlButtons:enablePreviousControlButtons,showPage:showPage,rootSelector:'[data-region="paging-bar"]'}}));
/**
 * Chart.js loader.
 *
 * @package    core
 * @copyright  2016 Frdric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/chartjs",["core/chartjs-lazy"],(function(ChartJS){return ChartJS}));
define("core/fullscreen",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.getElement=void 0;_exports.getElement=function(){var element=null;return document.fullscreenElement?element=document.fullscreenElement:document.mozFullscreenElement?element=document.mozFullscreenElement:document.msFullscreenElement?element=document.msFullscreenElement:document.webkitFullscreenElement&&(element=document.webkitFullscreenElement),element}}));
/*
 * @package    core
 * @class      permissionmanager
 * @copyright  2015 Martin Mastny <mastnym@vscht.cz>
 * @since      3.0
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/permissionmanager",["jquery","core/config","core/notification","core/templates","core/yui"],(function($,config,notification,templates,Y){var contextid,contextname,adminurl,overideableroles,SELECTORS_ADDROLE="a.allowlink, a.prohibitlink",SELECTORS_REMOVEROLE="a.preventlink, a.unprohibitlink",SELECTORS_UNPROHIBIT="a.unprohibitlink",rolesloadedevent=$.Event("rolesloaded"),panel=null,_loadOverideableRoles=function(){var params={contextid:contextid,getroles:1,sesskey:config.sesskey};$.post(adminurl+"roles/ajax.php",params,null,"json").done((function(data){try{overideableroles=data,(_loadOverideableRoles=function(){$("body").trigger(rolesloadedevent)})()}catch(err){notification.exception(err)}})).fail((function(jqXHR,status,error){notification.exception(error)}))},changePermissions=function(row,roleid,action){var params={contextid:contextid,roleid:roleid,sesskey:M.cfg.sesskey,action:action,capability:row.data("name")};$.post(adminurl+"roles/ajax.php",params,null,"json").done((function(data){var action=data;try{var templatedata={rolename:overideableroles[roleid],roleid:roleid,adminurl:adminurl,imageurl:M.util.image_url("t/delete","moodle")};switch(action){case"allow":templatedata.spanclass="allowed",templatedata.linkclass="preventlink",templatedata.action="prevent",templatedata.icon="t/delete",templatedata.iconalt=M.util.get_string("deletexrole","core_role",overideableroles[roleid]);break;case"prohibit":templatedata.spanclass="forbidden",templatedata.linkclass="unprohibitlink",templatedata.action="unprohibit",templatedata.icon="t/delete",templatedata.iconalt=M.util.get_string("deletexrole","core_role",overideableroles[roleid]);break;case"prevent":return void row.find('a[data-role-id="'+roleid+'"]').first().closest(".allowed").remove();case"unprohibit":return void row.find('a[data-role-id="'+roleid+'"]').first().closest(".forbidden").remove();default:return}templates.render("core/permissionmanager_role",templatedata).done((function(content){if("allow"==action)$(content).insertBefore(row.find(".allowmore").first());else if("prohibit"==action){$(content).insertBefore(row.find(".prohibitmore").first());var allowedLink=row.find(".allowedroles").first().find('a[data-role-id="'+roleid+'"]');allowedLink&&allowedLink.first().closest(".allowed").remove()}panel.hide()})).fail(notification.exception)}catch(err){notification.exception(err)}})).fail((function(jqXHR,status,error){notification.exception(error)}))},handleAddRole=function(e){e.preventDefault();var link=$(e.currentTarget);$("body").one("rolesloaded",(function(){Y.use("moodle-core-notification-dialogue",(function(){var i,existingrolelinks,action=link.data("action"),row=link.closest("tr.rolecap"),confirmationDetails={cap:row.data("humanname"),context:contextname},message=M.util.get_string("role"+action+"info","core_role",confirmationDetails);null===panel&&(panel=new M.core.dialogue({draggable:!0,modal:!0,closeButton:!0,width:"450px"})),panel.set("headerContent",M.util.get_string("role"+action+"header","core_role"));var roles=[];switch(action){case"allow":existingrolelinks=row.find(SELECTORS_REMOVEROLE);break;case"prohibit":existingrolelinks=row.find(SELECTORS_UNPROHIBIT)}for(i in overideableroles){var disabled="";existingrolelinks.filter("[data-role-id='"+i+"']").length&&(disabled="disabled");var roledetails={roleid:i,rolename:overideableroles[i],disabled:disabled};roles.push(roledetails)}templates.render("core/permissionmanager_panelcontent",{message:message,roles:roles}).done((function(content){panel.set("bodyContent",content),panel.show(),$("div.role_buttons").on("click","button",(function(e){var roleid=$(e.currentTarget).data("role-id");changePermissions(row,roleid,action)}))})).fail(notification.exception)}))})),_loadOverideableRoles()},handleRemoveRole=function(e){e.preventDefault();var link=$(e.currentTarget);$("body").one("rolesloaded",(function(){var action=link.data("action"),roleid=link.data("role-id"),row=link.closest("tr.rolecap"),questionDetails={role:overideableroles[roleid],cap:row.data("humanname"),context:contextname};notification.confirm(M.util.get_string("confirmunassigntitle","core_role"),M.util.get_string("confirmrole"+action,"core_role",questionDetails),M.util.get_string("confirmunassignyes","core_role"),M.util.get_string("confirmunassignno","core_role"),(function(){changePermissions(row,roleid,action)}))})),_loadOverideableRoles()};return{initialize:function(args){contextid=args.contextid,contextname=args.contextname,adminurl=args.adminurl;var body=$("body");body.on("click",SELECTORS_ADDROLE,handleAddRole),body.on("click",SELECTORS_REMOVEROLE,handleRemoveRole)}}}));
define("core/prefetch",["exports","core/config"],(function(_exports,_config){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_config=(obj=_config)&&obj.__esModule?obj:{default:obj};var _systemImportTransformerGlobalIdentifier="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var prefetchTimer,initialPrefetchComplete=!1,templateList=[],stringList={},fetchQueue=function(){if(templateList){var templatesToLoad=templateList.slice();templateList=[],("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core/templates"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core/templates")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core/templates"])).then((function(Templates){return Templates.prefetchTemplates(templatesToLoad)})).catch()}var mappedStringsToFetch=stringList;stringList={};var stringsToFetch=[];Object.keys(mappedStringsToFetch).forEach((function(component){stringsToFetch.push.apply(stringsToFetch,_toConsumableArray(mappedStringsToFetch[component].map((function(key){return{component:component,key:key}}))))})),stringsToFetch&&("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core/str"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core/str")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core/str"])).then((function(Str){return Str.get_strings(stringsToFetch)})).catch()},processQueue=function(){prefetchTimer||(initialPrefetchComplete?fetchQueue():prefetchTimer=setTimeout((function(){initialPrefetchComplete=!0,prefetchTimer=null,("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require([_config.default.iconsystemmodule],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require(_config.default.iconsystemmodule)):Promise.resolve(_systemImportTransformerGlobalIdentifier[_config.default.iconsystemmodule])).then((function(IconSystem){var iconSystem=new IconSystem;return prefetchTemplate(iconSystem.getTemplateName()),iconSystem})).then((function(iconSystem){fetchQueue(),iconSystem.init()})).catch()}),500))},prefetchTemplates=function(templatesNames){templateList=templateList.concat(templatesNames),processQueue()},prefetchTemplate=function(templateName){return prefetchTemplates([templateName])},prefetchStrings=function(component,keys){stringList[component]||(stringList[component]=[]),stringList[component]=stringList[component].concat(keys),processQueue()};prefetchTemplates([].concat(["core/loading"],["core/modal"],["core/modal_backdrop"])),prefetchStrings("core",["cancel","closebuttontitle","loading","savechanges"]),prefetchStrings("core_form",["showless","showmore"]);var _default={prefetchTemplate:prefetchTemplate,prefetchTemplates:prefetchTemplates,prefetchString:function(component,key){stringList[component]||(stringList[component]=[]),stringList[component].push(key),processQueue()},prefetchStrings:prefetchStrings};return _exports.default=_default,_exports.default}));
/**
 * Course selector adaptor for auto-complete form element.
 *
 * @module     core/form-cohort-selector
 * @class      form-cohort-selector
 * @package    core
 * @copyright  2016 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("core/form-cohort-selector",["core/ajax","jquery"],(function(ajax,$){return{processResults:function(selector,data){var results=[],i=0,excludelist=String($(selector).data("exclude")).split(",");for(i=0;i<data.cohorts.length;i++)-1===excludelist.indexOf(String(data.cohorts[i].id))&&results.push({value:data.cohorts[i].id,label:data.cohorts[i].name});return results},transport:function(selector,query,success,failure){var promises;void 0===query&&(query="");var calls=[{methodname:"core_cohort_search_cohorts",args:{query:query,includes:"parents",limitfrom:0,limitnum:100,context:{contextid:$(selector).data("contextid")}}}];promises=ajax.call(calls),$.when.apply($.when,promises).done((function(data){success(data)})).fail(failure)}}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}var root,definition;root=window,definition=function(){var noop=function(){},isIE="undefined"!==("undefined"==typeof window?"undefined":_typeof(window))&&/Trident\/|MSIE /.test(window.navigator.userAgent),logMethods=["trace","debug","info","warn","error"];function bindMethod(obj,methodName){var method=obj[methodName];if("function"==typeof method.bind)return method.bind(obj);try{return Function.prototype.bind.call(method,obj)}catch(e){return function(){return Function.prototype.apply.apply(method,[obj,arguments])}}}function traceForIE(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function realMethod(methodName){return"debug"===methodName&&(methodName="log"),"undefined"!==("undefined"==typeof console?"undefined":_typeof(console))&&("trace"===methodName&&isIE?traceForIE:void 0!==console[methodName]?bindMethod(console,methodName):void 0!==console.log?bindMethod(console,"log"):noop)}function replaceLoggingMethods(level,loggerName){for(var i=0;i<logMethods.length;i++){var methodName=logMethods[i];this[methodName]=i<level?noop:this.methodFactory(methodName,level,loggerName)}this.log=this.debug}function enableLoggingWhenConsoleArrives(methodName,level,loggerName){return function(){"undefined"!==("undefined"==typeof console?"undefined":_typeof(console))&&(replaceLoggingMethods.call(this,level,loggerName),this[methodName].apply(this,arguments))}}function defaultMethodFactory(methodName,level,loggerName){return realMethod(methodName)||enableLoggingWhenConsoleArrives.apply(this,arguments)}function Logger(name,defaultLevel,factory){var currentLevel,self=this,storageKey="loglevel";function getPersistedLevel(){var storedLevel;if("undefined"!==("undefined"==typeof window?"undefined":_typeof(window))){try{storedLevel=window.localStorage[storageKey]}catch(ignore){}if("undefined"===_typeof(storedLevel))try{var cookie=window.document.cookie,location=cookie.indexOf(encodeURIComponent(storageKey)+"=");-1!==location&&(storedLevel=/^([^;]+)/.exec(cookie.slice(location))[1])}catch(ignore){}return void 0===self.levels[storedLevel]&&(storedLevel=void 0),storedLevel}}name&&(storageKey+=":"+name),self.name=name,self.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},self.methodFactory=factory||defaultMethodFactory,self.getLevel=function(){return currentLevel},self.setLevel=function(level,persist){if("string"==typeof level&&void 0!==self.levels[level.toUpperCase()]&&(level=self.levels[level.toUpperCase()]),!("number"==typeof level&&level>=0&&level<=self.levels.SILENT))throw"log.setLevel() called with invalid level: "+level;if(currentLevel=level,!1!==persist&&function(levelNum){var levelName=(logMethods[levelNum]||"silent").toUpperCase();if("undefined"!==("undefined"==typeof window?"undefined":_typeof(window))){try{return void(window.localStorage[storageKey]=levelName)}catch(ignore){}try{window.document.cookie=encodeURIComponent(storageKey)+"="+levelName+";"}catch(ignore){}}}(level),replaceLoggingMethods.call(self,level,name),"undefined"===("undefined"==typeof console?"undefined":_typeof(console))&&level<self.levels.SILENT)return"No console available for logging"},self.setDefaultLevel=function(level){getPersistedLevel()||self.setLevel(level,!1)},self.enableAll=function(persist){self.setLevel(self.levels.TRACE,persist)},self.disableAll=function(persist){self.setLevel(self.levels.SILENT,persist)};var initialLevel=getPersistedLevel();null==initialLevel&&(initialLevel=null==defaultLevel?"WARN":defaultLevel),self.setLevel(initialLevel,!1)}var defaultLogger=new Logger,_loggersByName={};defaultLogger.getLogger=function(name){if("string"!=typeof name||""===name)throw new TypeError("You must supply a name when creating a logger.");var logger=_loggersByName[name];return logger||(logger=_loggersByName[name]=new Logger(name,defaultLogger.getLevel(),defaultLogger.methodFactory)),logger};var _log="undefined"!==("undefined"==typeof window?"undefined":_typeof(window))?window.log:void 0;return defaultLogger.noConflict=function(){return"undefined"!==("undefined"==typeof window?"undefined":_typeof(window))&&window.log===defaultLogger&&(window.log=_log),defaultLogger},defaultLogger.getLoggers=function(){return _loggersByName},defaultLogger},"function"==typeof define&&define.amd?define("core/loglevel",definition):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=definition():root.log=definition();
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)
/**
 * Contain the logic for modals.
 *
 * @module     core/modal
 * @class      modal
 * @package    core
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */}define("core/modal",["jquery","core/templates","core/notification","core/key_codes","core/custom_interaction_events","core/modal_backdrop","core/event","core/modal_events","core/local/aria/focuslock","core/pending","core/fullscreen"],(function($,Templates,Notification,KeyCodes,CustomEvents,ModalBackdrop,Event,ModalEvents,FocusLock,Pending,Fullscreen){var backdropPromise,SELECTORS_CONTAINER='[data-region="modal-container"]',SELECTORS_MODAL='[data-region="modal"]',SELECTORS_HEADER='[data-region="header"]',SELECTORS_TITLE='[data-region="title"]',SELECTORS_BODY='[data-region="body"]',SELECTORS_FOOTER='[data-region="footer"]',SELECTORS_HIDE='[data-action="hide"]',SELECTORS_DIALOG="[role=dialog]",SELECTORS_FORM="form",SELECTORS_MENU_BAR="[role=menubar]",SELECTORS_HAS_Z_INDEX=".moodle-has-zindex",TEMPLATES_LOADING="core/loading",TEMPLATES_BACKDROP="core/modal_backdrop",modalCounter=0,Modal=function(root){this.root=$(root),this.modal=this.root.find(SELECTORS_MODAL),this.header=this.modal.find(SELECTORS_HEADER),this.headerPromise=$.Deferred(),this.title=this.header.find(SELECTORS_TITLE),this.titlePromise=$.Deferred(),this.body=this.modal.find(SELECTORS_BODY),this.bodyPromise=$.Deferred(),this.footer=this.modal.find(SELECTORS_FOOTER),this.footerPromise=$.Deferred(),this.hiddenSiblings=[],this.isAttached=!1,this.bodyJS=null,this.footerJS=null,this.modalCount=modalCounter++,this.attachmentPoint=document.createElement("div"),document.body.append(this.attachmentPoint),this.root.is(SELECTORS_CONTAINER)||Notification.exception({message:"Element is not a modal container"}),this.modal.length||Notification.exception({message:"Container does not contain a modal"}),this.header.length||Notification.exception({message:"Modal is missing a header region"}),this.title.length||Notification.exception({message:"Modal header is missing a title region"}),this.body.length||Notification.exception({message:"Modal is missing a body region"}),this.footer.length||Notification.exception({message:"Modal is missing a footer region"}),this.registerEventListeners()};return Modal.prototype.attachToDOM=function(){this.getAttachmentPoint().append(this.root),this.isAttached||(FocusLock.trapFocus(this.root[0]),this.bodyJS&&(Templates.runTemplateJS(this.bodyJS),this.bodyJS=null),this.footerJS&&(Templates.runTemplateJS(this.footerJS),this.footerJS=null),this.isAttached=!0)},Modal.prototype.countOtherVisibleModals=function(){var count=0;return $("body").find(SELECTORS_CONTAINER).each(function(index,element){element=$(element),!this.root.is(element)&&element.hasClass("show")&&count++}.bind(this)),count},Modal.prototype.getBackdrop=function(){return backdropPromise||(backdropPromise=Templates.render(TEMPLATES_BACKDROP,{}).then((function(html){var element=$(html);return new ModalBackdrop(element)})).fail(Notification.exception)),backdropPromise},Modal.prototype.getRoot=function(){return this.root},Modal.prototype.getModal=function(){return this.modal},Modal.prototype.getTitle=function(){return this.title},Modal.prototype.getBody=function(){return this.body},Modal.prototype.getFooter=function(){return this.footer},Modal.prototype.getTitlePromise=function(){return this.titlePromise},Modal.prototype.getBodyPromise=function(){return this.bodyPromise},Modal.prototype.getFooterPromise=function(){return this.footerPromise},Modal.prototype.getModalCount=function(){return this.modalCount},Modal.prototype.setTitle=function(value){var title=this.getTitle();this.titlePromise=$.Deferred(),this.asyncSet(value,title.html.bind(title)).then(function(){this.titlePromise.resolve(title)}.bind(this)).catch(Notification.exception)},Modal.prototype.setBody=function(value){this.bodyPromise=$.Deferred();var body=this.getBody();if("string"==typeof value)body.html(value),Event.notifyFilterContentUpdated(body),this.getRoot().trigger(ModalEvents.bodyRendered,this),this.bodyPromise.resolve(body);else{var jsPendingId="amd-modal-js-pending-id-"+this.getModalCount();M.util.js_pending(jsPendingId);var contentPromise=null;if(body.css("overflow","hidden"),"pending"==(value=$.when(value)).state()){var height=body.innerHeight();height<100&&(height=100),body.animate({height:height+"px"},150),body.html(""),contentPromise=Templates.render(TEMPLATES_LOADING,{}).then((function(html){var loadingIcon=$(html).hide();return body.html(loadingIcon),loadingIcon.fadeIn(150),$.when(loadingIcon.promise(),value)})).then((function(loadingIcon){return loadingIcon.fadeOut(100).promise()})).then((function(){return value}))}else contentPromise=value;contentPromise.then(function(html,js){var result=null;if(this.isVisible()){body.css("opacity",0);var currentHeight=body.innerHeight();body.html(html),body.css("height","");var newHeight=body.innerHeight();body.css("height",currentHeight+"px"),result=body.animate({height:newHeight+"px",opacity:1},{duration:150,queue:!1}).promise()}else body.html(html);return js&&(this.isAttached?Templates.runTemplateJS(js):this.bodyJS=js),result}.bind(this)).then(function(result){return Event.notifyFilterContentUpdated(body),this.getRoot().trigger(ModalEvents.bodyRendered,this),result}.bind(this)).then(function(){this.bodyPromise.resolve(body)}.bind(this)).fail(Notification.exception).always((function(){body.css("height",""),body.css("overflow",""),body.css("opacity",""),M.util.js_complete(jsPendingId)})).fail(Notification.exception)}},Modal.prototype.setFooter=function(value){this.showFooter(),this.footerPromise=$.Deferred();var footer=this.getFooter();"string"==typeof value?(footer.html(value),this.footerPromise.resolve(footer)):Templates.render(TEMPLATES_LOADING,{}).then((function(html){return footer.html(html),value})).then(function(html,js){return footer.html(html),js&&(this.isAttached?Templates.runTemplateJS(js):this.footerJS=js),footer}.bind(this)).then(function(footer){this.footerPromise.resolve(footer)}.bind(this)).catch(Notification.exception)},Modal.prototype.hasFooterContent=function(){return!!this.getFooter().children().length},Modal.prototype.hideFooter=function(){this.getFooter().addClass("hidden")},Modal.prototype.showFooter=function(){this.getFooter().removeClass("hidden")},Modal.prototype.setLarge=function(){this.isLarge()||this.getModal().addClass("modal-lg")},Modal.prototype.isLarge=function(){return this.getModal().hasClass("modal-lg")},Modal.prototype.setSmall=function(){this.isSmall()||this.getModal().removeClass("modal-lg")},Modal.prototype.isSmall=function(){return!this.getModal().hasClass("modal-lg")},Modal.prototype.calculateZIndex=function(){var items=$(SELECTORS_DIALOG+", "+SELECTORS_MENU_BAR+", "+SELECTORS_HAS_Z_INDEX),zIndex=parseInt(this.root.css("z-index"));return items.each((function(index,item){var itemZIndex=(item=$(item)).css("z-index")?parseInt(item.css("z-index")):0;itemZIndex>zIndex&&(zIndex=itemZIndex)})),zIndex},Modal.prototype.isVisible=function(){return this.root.hasClass("show")},Modal.prototype.hasFocus=function(){var target=$(document.activeElement);return this.root.is(target)||this.root.has(target).length},Modal.prototype.hasTransitions=function(){return this.getRoot().hasClass("fade")},Modal.prototype.getAttachmentPoint=function(){return $(Fullscreen.getElement()||this.attachmentPoint)},Modal.prototype.show=function(){if(this.isVisible())return $.Deferred().resolve();var pendingPromise=new Pending("core/modal:show");return this.hasFooterContent()?this.showFooter():this.hideFooter(),this.attachToDOM(),this.getBackdrop().then(function(backdrop){var newIndex=this.calculateZIndex()+2,newBackdropIndex=newIndex-1;this.root.css("z-index",newIndex),backdrop.setZIndex(newBackdropIndex),backdrop.show(),this.root.removeClass("hide").addClass("show"),this.accessibilityShow(),this.getModal().focus(),$("body").addClass("modal-open"),this.root.trigger(ModalEvents.shown,this)}.bind(this)).then(pendingPromise.resolve)},Modal.prototype.hideIfNotForm=function(){0==this.modal.find(SELECTORS_FORM).length&&this.hide()},Modal.prototype.hide=function(){this.getBackdrop().done(function(backdrop){FocusLock.untrapFocus(),this.countOtherVisibleModals()||(backdrop.hide(),$("body").removeClass("modal-open"));var currentIndex=parseInt(this.root.css("z-index"));this.root.css("z-index",""),backdrop.setZIndex(currentIndex-3),this.accessibilityHide(),this.hasTransitions()?this.getRoot().one("transitionend webkitTransitionEnd oTransitionEnd",function(){this.getRoot().removeClass("show").addClass("hide")}.bind(this)):this.getRoot().removeClass("show").addClass("hide"),$(document.body).find(this.getRoot()).length&&$(document.body).append(this.getRoot()),this.root.trigger(ModalEvents.hidden,this)}.bind(this))},Modal.prototype.destroy=function(){this.hide(),this.root.remove(),this.root.trigger(ModalEvents.destroyed,this),this.attachmentPoint.remove()},Modal.prototype.accessibilityShow=function(){$("body").children().each(function(index,child){if(!this.root.is(child)){var hidden=(child=$(child)).attr("aria-hidden");"true"!==hidden&&(child.data("previous-aria-hidden",hidden),this.hiddenSiblings.push(child),child.attr("aria-hidden","true"))}}.bind(this)),this.root.attr("aria-hidden","false")},Modal.prototype.accessibilityHide=function(){this.root.attr("aria-hidden","true"),$.each(this.hiddenSiblings,(function(index,sibling){var previousValue=(sibling=$(sibling)).data("previous-aria-hidden");void 0===previousValue?sibling.removeAttr("aria-hidden"):sibling.attr("aria-hidden",previousValue)})),this.hiddenSiblings=[]},Modal.prototype.registerEventListeners=function(){this.getRoot().on("keydown",function(e){this.isVisible()&&e.keyCode==KeyCodes.escape&&(this.removeOnClose?this.destroy():this.hide())}.bind(this)),this.getRoot().click(function(e){$(e.target).closest(SELECTORS_MODAL).length||$(e.target).closest(SELECTORS_CONTAINER).length&&this.hideIfNotForm()}.bind(this)),CustomEvents.define(this.getModal(),[CustomEvents.events.activate]),this.getModal().on(CustomEvents.events.activate,SELECTORS_HIDE,function(e,data){this.hide(),data.originalEvent.preventDefault()}.bind(this))},Modal.prototype.registerCloseOnCancel=function(){this.getModal().on(CustomEvents.events.activate,this.getActionSelector("cancel"),function(e,data){var cancelEvent=$.Event(ModalEvents.cancel);this.getRoot().trigger(cancelEvent,this),cancelEvent.isDefaultPrevented()||(data.originalEvent.preventDefault(),this.removeOnClose?this.destroy():this.hide())}.bind(this))},Modal.prototype.registerCloseOnSave=function(){this.getModal().on(CustomEvents.events.activate,this.getActionSelector("save"),function(e,data){var saveEvent=$.Event(ModalEvents.save);this.getRoot().trigger(saveEvent,this),saveEvent.isDefaultPrevented()||(data.originalEvent.preventDefault(),this.removeOnClose?this.destroy():this.hide())}.bind(this))},Modal.prototype.asyncSet=function(value,setFunction){var p=value;return"object"===_typeof(value)&&value.hasOwnProperty("then")||(p=$.Deferred()).resolve(value),p.then((function(content){setFunction(content)})).fail(Notification.exception),p},Modal.prototype.setButtonText=function(action,value){var button=this.getFooter().find(this.getActionSelector(action));if(!button)throw new Error("Unable to find the '"+action+"' button");return this.asyncSet(value,button.text.bind(button))},Modal.prototype.getActionSelector=function(action){return"[data-action='"+action+"']"},Modal.prototype.setRemoveOnClose=function(remove){this.removeOnClose=remove},Modal}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)
/**
 * Chart series.
 *
 * @package    core
 * @copyright  2016 Frdric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @module     core/chart_series
 */}define("core/chart_series",[],(function(){function Series(label,values){if("string"!=typeof label)throw new Error("Invalid label for series.");if("object"!==_typeof(values))throw new Error("Values for a series must be an array.");if(values.length<1)throw new Error("Invalid values received for series.");this._colors=[],this._label=label,this._values=values}return Series.prototype.TYPE_DEFAULT=null,Series.prototype.TYPE_LINE="line",Series.prototype._colors=null,Series.prototype._fill=!1,Series.prototype._label=null,Series.prototype._labels=null,Series.prototype._smooth=!1,Series.prototype._type=Series.prototype.TYPE_DEFAULT,Series.prototype._values=null,Series.prototype._xaxis=null,Series.prototype._yaxis=null,Series.prototype.create=function(obj){var s=new Series(obj.label,obj.values);return s.setType(obj.type),s.setXAxis(obj.axes.x),s.setYAxis(obj.axes.y),s.setLabels(obj.labels),obj.colors&&obj.colors.length>1?s.setColors(obj.colors):s.setColor(obj.colors[0]),s.setFill(obj.fill),s.setSmooth(obj.smooth),s},Series.prototype.getColor=function(){return this._colors[0]||null},Series.prototype.getColors=function(){return this._colors},Series.prototype.getCount=function(){return this._values.length},Series.prototype.getFill=function(){return this._fill},Series.prototype.getLabel=function(){return this._label},Series.prototype.getLabels=function(){return this._labels},Series.prototype.getSmooth=function(){return this._smooth},Series.prototype.getType=function(){return this._type},Series.prototype.getValues=function(){return this._values},Series.prototype.getXAxis=function(){return this._xaxis},Series.prototype.getYAxis=function(){return this._yaxis},Series.prototype.hasColoredValues=function(){return this._colors.length==this.getCount()},Series.prototype.setColor=function(color){this._colors=[color]},Series.prototype.setColors=function(colors){if(colors&&colors.length!=this.getCount())throw new Error("When setting multiple colors there must be one per value.");this._colors=colors||[]},Series.prototype.setFill=function(fill){this._fill=void 0===fill?null:fill},Series.prototype.setLabels=function(labels){this._validateLabels(labels),labels=void 0===labels?null:labels,this._labels=labels},Series.prototype.setSmooth=function(smooth){smooth=void 0===smooth?null:smooth,this._smooth=smooth},Series.prototype.setType=function(type){if(type!=this.TYPE_DEFAULT&&type!=this.TYPE_LINE)throw new Error("Invalid serie type.");this._type=type||null},Series.prototype.setXAxis=function(index){this._xaxis=index||null},Series.prototype.setYAxis=function(index){this._yaxis=index||null},Series.prototype._validateLabels=function(labels){if(labels&&labels.length>0&&labels.length!=this.getCount())throw new Error("Series labels must match series values.")},Series}));
/**
 * Fetch and render dates from timestamps.
 *
 * @module     core/user_date
 * @package    core
 * @copyright  2017 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/user_date",["jquery","core/ajax","core/sessionstorage","core/config"],(function($,Ajax,Storage,Config){var promisesCache={},getKey=function(request){return"core_user_date/"+$("html").attr("lang").replace(/-/g,"_")+"/"+Config.usertimezone+"/"+request.timestamp+"/"+request.format},loadDatesFromServer=function(dates){var args=dates.map((function(data){var fixDay=data.hasOwnProperty("fixday")?data.fixday:1,fixHour=data.hasOwnProperty("fixhour")?data.fixhour:1;return{timestamp:data.timestamp,format:data.format,type:data.type||null,fixday:fixDay,fixhour:fixHour}})),request={methodname:"core_get_user_dates",args:{contextid:Config.contextid,timestamps:args}};return Ajax.call([request],!0,!0)[0].then((function(results){results.dates.forEach((function(value,index){var date=dates[index];!function(key,value){Storage.set(key,value)}(getKey(date),value),date.deferred.resolve(value)}))})).catch((function(ex){dates.forEach((function(date){date.deferred.reject(ex)}))}))};return{get:function(requests){var ajaxRequests=[],promises=[];return requests.forEach((function(request){var key=getKey(request);if(function(key){return void 0!==promisesCache[key]}(key))promises.push(function(key){return promisesCache[key]}(key));else{var deferred=$.Deferred(),cached=function(key){return Storage.get(key)}(key);cached?deferred.resolve(cached):(request.deferred=deferred,ajaxRequests.push(request)),function(key,promise){promisesCache[key]=promise}(key,deferred.promise()),promises.push(deferred.promise())}})),ajaxRequests.length&&loadDatesFromServer(ajaxRequests),$.when.apply($,promises).then((function(){return 1===arguments.length?[arguments[0]]:Array.apply(null,arguments)}))},getUserMidnightForTimestamp:function(timestamp,todayMidnight){var future=timestamp>todayMidnight,diffSeconds=Math.abs(timestamp-todayMidnight),diffDaysInSeconds=86400*(future?Math.floor(diffSeconds/86400):Math.ceil(diffSeconds/86400));return future?todayMidnight+diffDaysInSeconds:todayMidnight-diffDaysInSeconds}}}));
define("core/userfeedback",["exports","core/ajax","core/notification"],(function(_exports,_ajax,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Handle clicking on action links of the feedback alert.
   *
   * @module     core/cta_feedback
   * @copyright  2020 Shamim Rezaie <shamim@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.registerEventListeners=void 0,_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification);var Selectors={regions:{root:'[data-region="core/userfeedback"]'},actions:{}};Selectors.actions.give="".concat(Selectors.regions.root,' [data-action="give"]'),Selectors.actions.remind="".concat(Selectors.regions.root,' [data-action="remind"]');_exports.registerEventListeners=function(){document.addEventListener("click",(function(e){var giveAction=e.target.closest(Selectors.actions.give);if(giveAction){if(e.preventDefault(),!window.open(giveAction.href))throw new Error("Unable to open popup");Promise.resolve(giveAction).then(hideRoot).then(recordAction).catch(_notification.default.exception)}var remindAction=e.target.closest(Selectors.actions.remind);remindAction&&(e.preventDefault(),Promise.resolve(remindAction).then(hideRoot).then(recordAction).catch(_notification.default.exception))}))};var recordAction=function(clickedItem){return clickedItem.dataset.record?_ajax.default.call([{methodname:"core_create_userfeedback_action_record",args:{action:clickedItem.dataset.action,contextid:M.cfg.contextid}}])[0]:Promise.resolve()},hideRoot=function(clickedItem){return clickedItem.dataset.hide&&clickedItem.closest(Selectors.regions.root).remove(),clickedItem}}));
/**
 * Events for the paged content element.
 *
 * @module     core/paged_content_events
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/paged_content_events",[],(function(){return{SHOW_PAGES:"core-paged-content-show-pages",PAGES_SHOWN:"core-paged-content-pages-shown",ALL_ITEMS_LOADED:"core-paged-content-all-items-loaded",SET_ITEMS_PER_PAGE_LIMIT:"core-paged-content-set-items-per-page-limit"}}));
define("core/tooltip",["jquery"],(function($){var Tooltip=function(selector){this._regionSelector=selector,$(this._regionSelector).each(function(index,element){var tooltipId=$(element).attr("aria-describedby");if(tooltipId){var tooltipele=document.getElementById(tooltipId);if(tooltipele)"tooltip"==$(tooltipele).attr("role")&&($(tooltipele).hide(),$(element).attr("tabindex","0")),$(element).on("focus",this._handleFocus.bind(this)),$(element).on("mouseover",this._handleMouseOver.bind(this)),$(element).on("mouseout",this._handleMouseOut.bind(this)),$(element).on("blur",this._handleBlur.bind(this)),$(element).on("keydown",this._handleKeyDown.bind(this))}}.bind(this))};return Tooltip.prototype._regionSelector=null,Tooltip.prototype._showTooltip=function(e){var triggerElement=$(e.target),tooltipId=triggerElement.attr("aria-describedby");if(tooltipId){var tooltipele=$(document.getElementById(tooltipId));if(tooltipele.show(),tooltipele.attr("aria-hidden","false"),!tooltipele.is(".tooltip")){var inner=$('<div class="tooltip-inner"></div>');inner.append(tooltipele.contents()),tooltipele.append(inner),tooltipele.addClass("tooltip"),tooltipele.addClass("bottom"),tooltipele.append('<div class="tooltip-arrow"></div>')}var pos=triggerElement.offset();pos.top+=triggerElement.height()+10,$(tooltipele).offset(pos)}},Tooltip.prototype._hideTooltip=function(e){var tooltipId=$(e.target).attr("aria-describedby");if(tooltipId){var tooltipele=document.getElementById(tooltipId);$(tooltipele).hide(),$(tooltipele).attr("aria-hidden","true")}},Tooltip.prototype._handleFocus=function(e){this._showTooltip(e)},Tooltip.prototype._handleKeyDown=function(e){27==e.which&&this._hideTooltip(e)},Tooltip.prototype._handleMouseOver=function(e){this._showTooltip(e)},Tooltip.prototype._handleMouseOut=function(e){$(e.target).is(":focus")||this._hideTooltip(e)},Tooltip.prototype._handleBlur=function(e){this._hideTooltip(e)},Tooltip}));
/**
 * Template renderer for Moodle. Load and render Moodle templates with Mustache.
 *
 * @module     core/templates
 * @package    core
 * @class      templates
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      2.9
 */
define("core/templates",["core/mustache","jquery","core/ajax","core/str","core/notification","core/url","core/config","core/localstorage","core/icon_system","core/event","core/yui","core/log","core/truncate","core/user_date","core/pending"],(function(mustache,$,ajax,str,notification,coreurl,config,storage,IconSystem,event,Y,Log,Truncate,UserDate,Pending){var uniqInstances=0,templateCache={},templatePromises={},cachePartialPromises={},iconSystem={},loadTemplateBuffer=[],isLoadingTemplates=!1,blacklistedNestedHelpers=["js"],getNormalisedComponent=function(component){return component&&"moodle"!==component&&"core"!==component?component:"core"},getTemplatePromiseFromCache=function(searchKey){if(searchKey in templatePromises)return templatePromises[searchKey];if(searchKey in templateCache)return templatePromises[searchKey]=$.Deferred().resolve(templateCache[searchKey]).promise(),templatePromises[searchKey];if(M.cfg.templaterev<=0)return null;var cached=storage.get("core_template/"+M.cfg.templaterev+":"+searchKey);return cached?(templateCache[searchKey]=cached,templatePromises[searchKey]=$.Deferred().resolve(cached).promise(),templatePromises[searchKey]):null},processLoadTemplateBuffer=function processLoadTemplateBuffer(){if(loadTemplateBuffer.length&&!isLoadingTemplates){isLoadingTemplates=!0;var templatesToLoad=loadTemplateBuffer.slice(),serverRequestsDeferred=$.Deferred(),requests=[],templatePromises=templatesToLoad.map((function(templateData){var component=getNormalisedComponent(templateData.component),name=templateData.name,searchKey=templateData.searchKey,theme=templateData.theme,templateDeferred=templateData.deferred,promise=null,cachedPromise=getTemplatePromiseFromCache(searchKey);if(cachedPromise)promise=cachedPromise;else{requests.push({methodname:"core_output_load_template_with_dependencies",args:{component:component,template:name,themename:theme,lang:$("html").attr("lang").replace(/-/g,"_")}});var index=requests.length-1;promise=serverRequestsDeferred.promise().then((function(promises){return templatePromises[searchKey]=promises[index].then((function(response){var templateSource=null;return response.templates.forEach((function(data){data.component=getNormalisedComponent(data.component);var tempSearchKey=[theme,data.component,data.name].join("/");templateCache[tempSearchKey]=data.value,M.cfg.templaterev>0&&storage.set("core_template/"+M.cfg.templaterev+":"+tempSearchKey,data.value),data.component==component&&data.name==name&&(templateSource=data.value)})),response.strings.length&&str.cache_strings(response.strings.map((function(data){return{component:getNormalisedComponent(data.component),key:data.name,value:data.value}}))),templateSource})),templatePromises[searchKey]}))}return promise.then((function(source){return templateDeferred.resolve(source)})).catch((function(error){throw templateDeferred.reject(error),error}))}));requests.length?serverRequestsDeferred.resolve(ajax.call(requests,!0,!1,!1,0,M.cfg.templaterev)):serverRequestsDeferred.resolve(),$.when.apply(null,templatePromises).then((function(){loadTemplateBuffer.splice(0,templatesToLoad.length),isLoadingTemplates=!1,processLoadTemplateBuffer()})).catch((function(){loadTemplateBuffer.splice(0,templatesToLoad.length),isLoadingTemplates=!1,processLoadTemplateBuffer()}))}},Renderer=function(){this.requiredStrings=[],this.requiredJS=[],this.requiredDates=[],this.currentThemeName=""};Renderer.prototype.requiredStrings=null,Renderer.prototype.requiredDates=[],Renderer.prototype.requiredJS=null,Renderer.prototype.currentThemeName="",Renderer.prototype.getTemplate=function(templateName){var currentTheme=this.currentThemeName,searchKey=currentTheme+"/"+templateName,cachedPromise=getTemplatePromiseFromCache(searchKey);if(cachedPromise)return cachedPromise;var existingBufferRecords=loadTemplateBuffer.filter((function(record){return record.searchKey==searchKey}));if(existingBufferRecords.length)return existingBufferRecords[0].deferred.promise();var parts=templateName.split("/"),component=getNormalisedComponent(parts.shift()),name=parts.join("/"),deferred=$.Deferred();return loadTemplateBuffer.push({component:component,name:name,theme:currentTheme,searchKey:searchKey,deferred:deferred}),processLoadTemplateBuffer(),deferred.promise()},Renderer.prototype.prefetchTemplates=function(templateNames,currentTheme){templateNames.forEach((function(templateName){var searchKey=currentTheme+"/"+templateName;if(!getTemplatePromiseFromCache(searchKey)&&!loadTemplateBuffer.filter((function(record){return record.searchKey==searchKey})).length){var parts=templateName.split("/"),component=getNormalisedComponent(parts.shift()),name=parts.join("/");loadTemplateBuffer.push({component:component,name:name,theme:currentTheme,searchKey:searchKey,deferred:$.Deferred()})}})),processLoadTemplateBuffer()},Renderer.prototype.partialHelper=function(name){var searchKey=this.currentThemeName+"/"+name;return searchKey in templateCache||notification.exception(new Error("Failed to pre-fetch the template: "+name)),templateCache[searchKey]},Renderer.prototype.renderIcon=function(key,component,title){var modulename=config.iconsystemmodule;component=getNormalisedComponent(component);var ready=$.Deferred();return require([modulename],(function(System){var system=new System;system instanceof IconSystem?(iconSystem=system,system.init().then(ready.resolve).catch(notification.exception)):ready.reject("Invalid icon system specified"+config.iconsystemmodule)})),ready.then(function(iconSystem){return this.getTemplate(iconSystem.getTemplateName())}.bind(this)).then((function(template){return iconSystem.renderIcon(key,component,title,template)}))},Renderer.prototype.pixHelper=function(context,sectionText,helper){var parts=sectionText.split(","),key="",component="",text="";parts.length>0&&(key=helper(parts.shift().trim(),context)),parts.length>0&&(component=helper(parts.shift().trim(),context)),parts.length>0&&(text=helper(parts.join(",").trim(),context));var templateName=iconSystem.getTemplateName(),searchKey=this.currentThemeName+"/"+templateName,template=templateCache[searchKey];return component=getNormalisedComponent(component),key=key.replace(/&#x2F;/gi,"/"),iconSystem.renderIcon(key,component,text,template)},Renderer.prototype.jsHelper=function(context,sectionText,helper){return this.requiredJS.push(helper(sectionText,context)),""},Renderer.prototype.stringHelper=function(context,sectionText,helper){var parts=sectionText.split(","),key="",component="",param="";parts.length>0&&(key=parts.shift().trim()),parts.length>0&&(component=parts.shift().trim()),parts.length>0&&(param=parts.join(",").trim()),component=getNormalisedComponent(component),""!==param&&(param=helper(param,context)),0===param.indexOf("{")&&0!==param.indexOf("{{")&&(param=JSON.parse(param));var index=this.requiredStrings.length;return this.requiredStrings.push({key:key,component:component,param:param}),"[[_s"+index+"]]"},Renderer.prototype.quoteHelper=function(context,sectionText,helper){var content=helper(sectionText.trim(),context);return'"'+(content=content.replace(/"/g,'\\"').replace(/([{}]{2,3})/g,"{{=<% %>=}}$1<%={{ }}=%>").replace(/(\r\n|\r|\n)/g,"&#x0a;"))+'"'},Renderer.prototype.shortenTextHelper=function(context,sectionText,helper){var parts=sectionText.match(/(.*?),(.*)/),length=parts[1].trim(),content=helper(parts[2].trim(),context);return Truncate.truncate(content,{length:length,words:!0,ellipsis:"..."})},Renderer.prototype.userDateHelper=function(context,sectionText,helper){var parts=sectionText.match(/(.*?),(.*)/),timestamp=helper(parts[1].trim(),context),format=helper(parts[2].trim(),context),index=this.requiredDates.length;return this.requiredDates.push({timestamp:timestamp,format:format}),"[[_t_"+index+"]]"},Renderer.prototype.addHelperFunction=function(helperFunction,context){return function(){return function(sectionText,helper){var originalHelpers=blacklistedNestedHelpers.reduce((function(carry,name){return context.hasOwnProperty(name)&&(carry[name]=context[name]),carry}),{});blacklistedNestedHelpers.forEach((function(helperName){context[helperName]=function(){return""}}));var result=helperFunction.apply(this,[context,sectionText,helper]);for(var name in originalHelpers)context[name]=originalHelpers[name];return result}.bind(this)}.bind(this)},Renderer.prototype.addHelpers=function(context,themeName){this.currentThemeName=themeName,this.requiredStrings=[],this.requiredJS=[],context.uniqid=uniqInstances++,context.str=this.addHelperFunction(this.stringHelper,context),context.pix=this.addHelperFunction(this.pixHelper,context),context.js=this.addHelperFunction(this.jsHelper,context),context.quote=this.addHelperFunction(this.quoteHelper,context),context.shortentext=this.addHelperFunction(this.shortenTextHelper,context),context.userdate=this.addHelperFunction(this.userDateHelper,context),context.globals={config:config},context.currentTheme=themeName},Renderer.prototype.getJS=function(){var js="";return this.requiredJS.length>0&&(js=this.requiredJS.join(";\n")),js},Renderer.prototype.treatStringsInContent=function(content,strings){var treated,index,strIndex,walker,char,strFinal,pattern=/\[\[_s\d+\]\]/;do{for(treated="",index=content.search(pattern);index>-1;){treated+=content.substring(0,index),strIndex="",walker=4,char=(content=content.substr(index)).substr(walker,1);do{strIndex+=char,walker++,char=content.substr(walker,1)}while("]"!=char);void 0===(strFinal=strings[parseInt(strIndex,10)])&&(Log.debug("Could not find string for pattern [[_s"+strIndex+"]]."),strFinal=""),treated+=strFinal,index=(content=content.substr(6+strIndex.length)).search(pattern)}index=(content=treated+content).search(pattern)}while(index>-1);return content},Renderer.prototype.treatDatesInContent=function(content,dates){return dates.forEach((function(date,index){var re=new RegExp("\\[\\[_t_"+index+"\\]\\]","g");content=content.replace(re,date)})),content},Renderer.prototype.doRender=function(templateSource,context,themeName){this.currentThemeName=themeName;var iconTemplate=iconSystem.getTemplateName(),pendingPromise=new Pending("core/templates:doRender");return this.getTemplate(iconTemplate).then(function(){this.addHelpers(context,themeName);var result=mustache.render(templateSource,context,this.partialHelper.bind(this));return $.Deferred().resolve(result.trim(),this.getJS()).promise()}.bind(this)).then(function(html,js){return this.requiredStrings.length>0?str.get_strings(this.requiredStrings).then(function(strings){return this.requiredDates=this.requiredDates.map(function(date){return{timestamp:this.treatStringsInContent(date.timestamp,strings),format:this.treatStringsInContent(date.format,strings)}}.bind(this)),html=this.treatStringsInContent(html,strings),js=this.treatStringsInContent(js,strings),$.Deferred().resolve(html,js).promise()}.bind(this)):$.Deferred().resolve(html,js).promise()}.bind(this)).then(function(html,js){return this.requiredDates.length>0?UserDate.get(this.requiredDates).then(function(dates){return html=this.treatDatesInContent(html,dates),js=this.treatDatesInContent(js,dates),$.Deferred().resolve(html,js).promise()}.bind(this)):$.Deferred().resolve(html,js).promise()}.bind(this)).then((function(html,js){return pendingPromise.resolve(),$.Deferred().resolve(html,js).promise()}))};var runTemplateJS=function(source){if(""!==source.trim()){var newscript=$("<script>").attr("type","text/javascript").html(source);$("head").append(newscript)}},domReplace=function(element,newHTML,newJS,replaceChildNodes){var replaceNode=$(element);if(replaceNode.length){var newNodes=$(newHTML);return replaceChildNodes?(new Y.NodeList(replaceNode.children().get()).destroy(!0),replaceNode.empty(),replaceNode.append(newNodes)):(new Y.NodeList(replaceNode.get()).destroy(!0),replaceNode.replaceWith(newNodes)),runTemplateJS(newJS),event.notifyFilterContentUpdated(newNodes),newNodes.get()}return[]};Renderer.prototype.scanForPartials=function(templateSource){var partials=[];return function findPartial(tokens,partials){var i,token;for(i=0;i<tokens.length;i++)">"!=(token=tokens[i])[0]&&"<"!=token[0]||partials.push(token[1]),token.length>4&&findPartial(token[4],partials)}(mustache.parse(templateSource),partials),partials},Renderer.prototype.cachePartials=function(templateName,parentage){var searchKey=this.currentThemeName+"/"+templateName;return searchKey in cachePartialPromises||(parentage=parentage||[searchKey],cachePartialPromises[searchKey]=$.Deferred(),this.getTemplate(templateName).then(function(templateSource){var fetchThemAll=this.scanForPartials(templateSource).filter(function(partialName){return!(parentage.indexOf(this.currentThemeName+"/"+partialName)>=0)&&partialName!=templateName}.bind(this)).map(function(partialName){return parentage.push(this.currentThemeName+"/"+partialName),this.cachePartials(partialName,parentage)}.bind(this));return $.when.apply($,fetchThemAll).then((function(){return cachePartialPromises[searchKey].resolve(templateSource)}))}.bind(this)).catch(cachePartialPromises[searchKey].reject)),cachePartialPromises[searchKey]},Renderer.prototype.render=function(templateName,context,themeName){void 0===themeName&&(themeName=config.theme),this.currentThemeName=themeName;var modulename=config.iconsystemmodule,ready=$.Deferred();return require([modulename],(function(System){var system=new System;system instanceof IconSystem?(iconSystem=system,system.init().then(ready.resolve).catch(notification.exception)):ready.reject("Invalid icon system specified"+config.iconsystem)})),ready.then(function(){return this.cachePartials(templateName)}.bind(this)).then(function(templateSource){return this.doRender(templateSource,context,themeName)}.bind(this))};return{render:function(templateName,context,themeName){return(new Renderer).render(templateName,context,themeName)},prefetchTemplates:function(templateNames,themeName){var renderer=new Renderer;return void 0===themeName&&(themeName=config.theme),renderer.prefetchTemplates(templateNames,themeName)},renderForPromise:function(templateName,context,themeName){return(new Renderer).render(templateName,context,themeName).then((function(html,js){return{html:html,js:js}}))},renderPix:function(key,component,title){return(new Renderer).renderIcon(key,getNormalisedComponent(component),title)},runTemplateJS:runTemplateJS,replaceNodeContents:function(element,newHTML,newJS){return domReplace(element,newHTML,newJS,!0)},replaceNode:function(element,newHTML,newJS){return domReplace(element,newHTML,newJS,!1)},prependNodeContents:function(element,html,js){return function(element,html,js){var node=$(element);if(node.length){var newContent=$(html);return node.prepend(newContent),runTemplateJS(js),event.notifyFilterContentUpdated(node),newContent.get()}return[]}(element,html,js)},appendNodeContents:function(element,html,js){return function(element,html,js){var node=$(element);if(node.length){var newContent=$(html);return node.append(newContent),runTemplateJS(js),event.notifyFilterContentUpdated(node),newContent.get()}return[]}(element,html,js)}}}));
function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}
/**
 * Create a modal.
 *
 * @module     core/modal_factory
 * @class      modal_factory
 * @package    core
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}define("core/modal_factory",["jquery","core/modal_events","core/modal_registry","core/modal","core/modal_save_cancel","core/modal_cancel","core/local/modal/alert","core/templates","core/notification","core/custom_interaction_events","core/pending"],(function($,ModalEvents,ModalRegistry,Modal,ModalSaveCancel,ModalCancel,ModalAlert,Templates,Notification,CustomEvents,Pending){var TEMPLATES_DEFAULT="core/modal",TEMPLATES_SAVE_CANCEL="core/modal_save_cancel",TEMPLATES_CANCEL="core/modal_cancel",TEMPLATES_ALERT="core/local/modal/alert",TYPES={DEFAULT:"DEFAULT",SAVE_CANCEL:"SAVE_CANCEL",CANCEL:"CANCEL",ALERT:"ALERT"};ModalRegistry.register(TYPES.DEFAULT,Modal,TEMPLATES_DEFAULT),ModalRegistry.register(TYPES.SAVE_CANCEL,ModalSaveCancel,TEMPLATES_SAVE_CANCEL),ModalRegistry.register(TYPES.CANCEL,ModalCancel,TEMPLATES_CANCEL),ModalRegistry.register(TYPES.ALERT,ModalAlert,TEMPLATES_ALERT);var createFromType=function(registryConf,templateContext){var templateName=registryConf.template,modalPromise=Templates.render(templateName,templateContext).then((function(html){var modalElement=$(html);return function(registryConf,modalElement){return modalElement=$(modalElement),new(0,registryConf.module)(modalElement)}(registryConf,modalElement)})).fail(Notification.exception);return modalPromise};return{create:function(modalConfig,triggerElement){var registryConf,type=modalConfig.type||TYPES.DEFAULT,isLarge=!!modalConfig.large,templateContext={};(registryConf=ModalRegistry.get(type))||Notification.exception({message:"Unable to find modal of type: "+type}),void 0!==modalConfig.templateContext&&(templateContext=modalConfig.templateContext);var modalPromise=createFromType(registryConf,templateContext).then((function(modal){return void 0!==modalConfig.title&&modal.setTitle(modalConfig.title),void 0!==modalConfig.body&&modal.setBody(modalConfig.body),void 0!==modalConfig.footer&&modal.setFooter(modalConfig.footer),modalConfig.buttons&&Object.entries(modalConfig.buttons).forEach((function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];modal.setButtonText(key,value)})),isLarge&&modal.setLarge(),void 0!==modalConfig.removeOnClose&&modal.setRemoveOnClose(modalConfig.removeOnClose),modal}));return void 0!==triggerElement&&function(modalPromise,triggerElement,modalConfig){var actualTriggerElement=null,hasPreShowCallback="function"==typeof modalConfig.preShowCallback,triggeredCallback=function(e,data){var pendingPromise=new Pending("core/modal_factory:setUpTrigger:triggeredCallback");actualTriggerElement=$(e.currentTarget),modalPromise.then((function(modal){return hasPreShowCallback&&modalConfig.preShowCallback(actualTriggerElement,modal),modal.show(),modal})).then(pendingPromise.resolve),data.originalEvent.preventDefault()};if(Array.isArray(triggerElement)){var selector=triggerElement[1];triggerElement=triggerElement[0],CustomEvents.define(triggerElement,[CustomEvents.events.activate]),triggerElement.on(CustomEvents.events.activate,selector,triggeredCallback)}else CustomEvents.define(triggerElement,[CustomEvents.events.activate]),triggerElement.on(CustomEvents.events.activate,triggeredCallback);modalPromise.then((function(modal){return modal.getRoot().on(ModalEvents.hidden,(function(){null!==actualTriggerElement&&actualTriggerElement.focus()})),modal}))}(modalPromise,triggerElement,modalConfig),modalPromise},types:TYPES}}));
/**
 * Provide global helper code to enhance page elements.
 *
 * @module     core/page_global
 * @package    core
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/page_global",["jquery","core/custom_interaction_events","core/str","core/network"],(function($,CustomEvents,Str,Network){return{init:function(){var body;body=$("body"),CustomEvents.define(body,[CustomEvents.events.activate]),body.on(CustomEvents.events.activate,"[data-show-active-item]",(function(e){var option=$(e.target).closest(".dropdown-item"),menuContainer=option.closest("[data-show-active-item]");if(option.hasClass("dropdown-item")&&!option.hasClass("active")){var dropdownItems=menuContainer.find(".dropdown-item");dropdownItems.removeClass("active"),dropdownItems.removeAttr("aria-current"),menuContainer.attr("data-skip-active-class")||option.addClass("active"),option.attr("aria-current",!0);var activeOptionText=option.text(),dropdownToggle=menuContainer.parent().find('[data-toggle="dropdown"]'),dropdownToggleText=dropdownToggle.find("[data-active-item-text]");dropdownToggleText.length?dropdownToggleText.html(activeOptionText):dropdownToggle.html(activeOptionText);var activeItemAriaLabelComponent=menuContainer.attr("data-active-item-button-aria-label-components");if(activeItemAriaLabelComponent){var strParams=activeItemAriaLabelComponent.split(",");strParams.push(activeOptionText),Str.get_string(strParams[0].trim(),strParams[1].trim(),strParams[2].trim()).then((function(string){return dropdownToggle.attr("aria-label",string),string})).catch((function(){return!1}))}}})),Network.init()}}}));
/**
 * Competency rule points module.
 *
 * @package    core
 * @copyright  2017 Damyon Wiese
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/icon_system_standard",["core/icon_system","core/url","core/mustache"],(function(IconSystem,CoreUrl,Mustache){var IconSystemStandard=function(){IconSystem.apply(this,arguments)};return(IconSystemStandard.prototype=Object.create(IconSystem.prototype)).renderIcon=function(key,component,title,template){var templatecontext={attributes:[{name:"src",value:CoreUrl.imageUrl(key,component)},{name:"alt",value:title},{name:"title",value:title}]};return void 0!==title&&""!=title||templatecontext.attributes.push({name:"aria-hidden",value:"true"}),Mustache.render(template,templatecontext).trim()},IconSystemStandard.prototype.getTemplateName=function(){return"core/pix_icon"},IconSystemStandard}));
/**
 * Global registry of core events that can be triggered/listened for.
 *
 * @module     core/event
 * @package    core
 * @class      event
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.0
 */
define("core/event",["jquery","core/yui"],(function($,Y){return{Events:{FORM_FIELD_VALIDATION:"core_form-field-validation"},getLegacyEvents:function(){var result=$.Deferred();return Y.use("event","moodle-core-event",(function(){result.resolve(window.M.core.event)})),result.promise()},notifyFilterContentUpdated:function(nodes){nodes=$(nodes),Y.use("event","moodle-core-event",(function(Y){$(document).trigger(M.core.event.FILTER_CONTENT_UPDATED,[nodes]);var yuiNodes=new Y.NodeList(nodes.get());Y.fire(M.core.event.FILTER_CONTENT_UPDATED,{nodes:yuiNodes})}))},notifyFormSubmitAjax:function(form,skipValidation){skipValidation=skipValidation||!1,Y.use("event","moodle-core-event",(function(Y){skipValidation&&(window.skipClientValidation=!0),$(form).trigger(M.core.event.FORM_SUBMIT_AJAX),Y.one(form).fire(M.core.event.FORM_SUBMIT_AJAX,{currentTarget:Y.one(form)}),skipValidation&&(window.skipClientValidation=!1)}))},notifyEditorContentRestored:function(){Y.use("event","moodle-core-event",(function(Y){$(document).trigger(M.core.event.EDITOR_CONTENT_RESTORED),Y.fire(M.core.event.EDITOR_CONTENT_RESTORED)}))}}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core/modal_save_cancel",["exports","core/modal"],(function(_exports,_modal){var obj;function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(target,property,receiver){var base=_superPropBase(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(arguments.length<3?target:receiver):desc.value}},_get.apply(this,arguments)}function _superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=_getPrototypeOf(object)););return object}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&("object"===_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;var _default=function(_Modal){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}(_default,_Modal);var Constructor,protoProps,staticProps,_super=_createSuper(_default);function _default(root){var _this;return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,_default),(_this=_super.call(this,root)).getFooter().find(_this.getActionSelector("save")).length||Notification.exception({message:"No save button found"}),_this.getFooter().find(_this.getActionSelector("cancel")).length||Notification.exception({message:"No cancel button found"}),_this}return Constructor=_default,(protoProps=[{key:"registerEventListeners",value:function(){_get(_getPrototypeOf(_default.prototype),"registerEventListeners",this).call(this),this.registerCloseOnSave(),this.registerCloseOnCancel()}},{key:"setFooter",value:function(){Notification.exception({message:"Can not change the footer of a save cancel modal"})}},{key:"setSaveButtonText",value:function(value){return this.setButtonText("save",value)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),_default}((_modal=(obj=_modal)&&obj.__esModule?obj:{default:obj}).default);return _exports.default=_default,_exports.default}));
/**
 * Chart builder.
 *
 * @package    core
 * @copyright  2016 Frdric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/chart_builder",["jquery"],(function($){return{make:function(data){var deferred=$.Deferred();return require(["core/chart_"+data.type],(function(Klass){var instance=Klass.prototype.create(Klass,data);deferred.resolve(instance)})),deferred.promise()}}}));
/**
 * URL utility functions.
 *
 * @module     core/url
 * @package    core
 * @class      url
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      2.9
 */
define("core/url",["jquery","core/config"],(function($,config){return{fileUrl:function(relativeScript,slashArg){var url=config.wwwroot+relativeScript;return"/"!=slashArg.charAt(0)&&(slashArg="/"+slashArg),config.slasharguments?url+=slashArg:url+="?file="+encodeURIComponent(slashArg),url},relativeUrl:function(relativePath,params,includeSessKey){if(0===relativePath.indexOf("http:")||0===relativePath.indexOf("https:")||relativePath.indexOf("://")>=0)throw new Error("relativeUrl function does not accept absolute urls");"/"!=relativePath.charAt(0)&&(relativePath="/"+relativePath),"admin"!==config.admin&&(relativePath=relativePath.replace(/^\/admin\//,"/"+config.admin+"/")),params=params||{},includeSessKey&&(params.sesskey=config.sesskey);var queryString="";return Object.keys(params).length&&(queryString=$.map(params,(function(value,param){return param+"="+value})).join("&")),""!==queryString?config.wwwroot+relativePath+"?"+queryString:config.wwwroot+relativePath},imageUrl:function(imagename,component){return M.util.image_url(imagename,component)}}}));
/**
 * This module provides a wrapper to encapsulate a lot of the common combinations of
 * user interaction we use in Moodle.
 *
 * @module     core/custom_interaction_events
 * @class      custom_interaction_events
 * @package    core
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.2
 */
define("core/custom_interaction_events",["jquery","core/key_codes"],(function($,keyCodes){var events={activate:"cie:activate",keyboardActivate:"cie:keyboardactivate",escape:"cie:escape",down:"cie:down",up:"cie:up",home:"cie:home",end:"cie:end",next:"cie:next",previous:"cie:previous",asterix:"cie:asterix",scrollLock:"cie:scrollLock",scrollTop:"cie:scrollTop",scrollBottom:"cie:scrollBottom",ctrlPageUp:"cie:ctrlPageUp",ctrlPageDown:"cie:ctrlPageDown",enter:"cie:enter",accessibleChange:"cie:accessibleChange"},triggeredEvents={},isModifierPressed=function(e){return e.shiftKey||e.metaKey||e.altKey||e.ctrlKey},triggerEvent=function(eventName,e){var eventTypeKey="";return e.hasOwnProperty("originalEvent")?(eventTypeKey="triggeredCustom_"+eventName,e.originalEvent.hasOwnProperty(eventTypeKey)?void 0:(e.originalEvent[eventTypeKey]=!0,void $(e.target).trigger(eventName,[{originalEvent:e}]))):(eventTypeKey=""+eventName+e.type+e.timeStamp,void(triggeredEvents.hasOwnProperty(eventTypeKey)||(triggeredEvents[eventTypeKey]=!0,$(e.target).trigger(eventName,[{originalEvent:e}]))))},addKeyboardEvent=function(element,event,keyCode){element.off("keydown."+event).on("keydown."+event,(function(e){isModifierPressed(e)||e.keyCode==keyCode&&triggerEvent(event,e)}))},addActivateListener=function(element){element.off("click.cie.activate").on("click.cie.activate",(function(e){triggerEvent(events.activate,e)})),element.off("keydown.cie.activate").on("keydown.cie.activate",(function(e){isModifierPressed(e)||e.keyCode!=keyCodes.enter&&e.keyCode!=keyCodes.space||triggerEvent(events.activate,e)}))},addKeyboardActivateListener=function(element){element.off("keydown.cie.keyboardactivate").on("keydown.cie.keyboardactivate",(function(e){isModifierPressed(e)||e.keyCode!=keyCodes.enter&&e.keyCode!=keyCodes.space||triggerEvent(events.keyboardActivate,e)}))},addEscapeListener=function(element){addKeyboardEvent(element,events.escape,keyCodes.escape)},addDownListener=function(element){addKeyboardEvent(element,events.down,keyCodes.arrowDown)},addUpListener=function(element){addKeyboardEvent(element,events.up,keyCodes.arrowUp)},addHomeListener=function(element){addKeyboardEvent(element,events.home,keyCodes.home)},addEndListener=function(element){addKeyboardEvent(element,events.end,keyCodes.end)},addNextListener=function(element){var keyCode="rtl"==$("html").attr("dir")?keyCodes.arrowLeft:keyCodes.arrowRight;addKeyboardEvent(element,events.next,keyCode)},addPreviousListener=function(element){var keyCode="rtl"==$("html").attr("dir")?keyCodes.arrowRight:keyCodes.arrowLeft;addKeyboardEvent(element,events.previous,keyCode)},addAsterixListener=function(element){addKeyboardEvent(element,events.asterix,keyCodes.asterix)},addScrollTopListener=function(element){element.off("scroll.cie.scrollTop").on("scroll.cie.scrollTop",(function(e){0===element.scrollTop()&&triggerEvent(events.scrollTop,e)}))},addScrollBottomListener=function(element){element.off("scroll.cie.scrollBottom").on("scroll.cie.scrollBottom",(function(e){element.scrollTop()+element.innerHeight()>=element[0].scrollHeight&&triggerEvent(events.scrollBottom,e)}))},addScrollLockListener=function(element){element.off("DOMMouseScroll.cie.DOMMouseScrollLock mousewheel.cie.mousewheelLock").on("DOMMouseScroll.cie.DOMMouseScrollLock mousewheel.cie.mousewheelLock",(function(e){var scrollTop=element.scrollTop(),scrollHeight=element[0].scrollHeight,height=element.height(),delta="DOMMouseScroll"==e.type?-40*e.originalEvent.detail:e.originalEvent.wheelDelta,up=delta>0;return!up&&-delta>scrollHeight-height-scrollTop?(element.scrollTop(scrollHeight),e.stopPropagation(),e.preventDefault(),e.returnValue=!1,triggerEvent(events.scrollLock,e),!1):!(up&&delta>scrollTop)||(element.scrollTop(0),e.stopPropagation(),e.preventDefault(),e.returnValue=!1,triggerEvent(events.scrollLock,e),!1)}))},addCtrlPageUpListener=function(element){element.off("keydown.cie.ctrlpageup").on("keydown.cie.ctrlpageup",(function(e){e.ctrlKey&&e.keyCode==keyCodes.pageUp&&triggerEvent(events.ctrlPageUp,e)}))},addCtrlPageDownListener=function(element){element.off("keydown.cie.ctrlpagedown").on("keydown.cie.ctrlpagedown",(function(e){e.ctrlKey&&e.keyCode==keyCodes.pageDown&&triggerEvent(events.ctrlPageDown,e)}))},addEnterListener=function(element){addKeyboardEvent(element,events.enter,keyCodes.enter)},addAccessibleChangeListener=function(element){var onMac=-1!==navigator.userAgent.indexOf("Macintosh"),touchEnabled="ontouchstart"in window||"msMaxTouchPoints"in navigator&&navigator.msMaxTouchPoints>0;if(onMac||touchEnabled)element.on("change",(function(e){triggerEvent(events.accessibleChange,e)}));else{var checkAndTriggerAccessibleChange=function(e){"initValue"in e.target.dataset&&e.target.value!==e.target.dataset.initValue&&(e.target.dataset.initValue=e.target.value,triggerEvent(events.accessibleChange,e))},nativeElement=element.get()[0];nativeElement.addEventListener("focus",(function(e){var target;(target=e.target).dataset.initValue=target.value}),!0),nativeElement.addEventListener("blur",(function(e){checkAndTriggerAccessibleChange(e)}),!0),element.on("keydown",(function(e){var target;e.which===keyCodes.enter?checkAndTriggerAccessibleChange(e):e.which===keyCodes.escape?("initValue"in(target=e.target).dataset&&(target.value=target.dataset.initValue),e.target.dataset.ignoreChange=!0):e.target.dataset.ignoreChange=!0})),element.on("change",(function(e){e.target.dataset.ignoreChange||checkAndTriggerAccessibleChange(e)})),element.on("keyup",(function(e){delete e.target.dataset.ignoreChange})),element.on("click",(function(e){checkAndTriggerAccessibleChange(e)}))}};return{define:function(element,include){var handlers;(element=$(element),include=include||[],element.length&&include.length)&&$.each(((handlers={})[events.activate]=addActivateListener,handlers[events.keyboardActivate]=addKeyboardActivateListener,handlers[events.escape]=addEscapeListener,handlers[events.down]=addDownListener,handlers[events.up]=addUpListener,handlers[events.home]=addHomeListener,handlers[events.end]=addEndListener,handlers[events.next]=addNextListener,handlers[events.previous]=addPreviousListener,handlers[events.asterix]=addAsterixListener,handlers[events.scrollLock]=addScrollLockListener,handlers[events.scrollTop]=addScrollTopListener,handlers[events.scrollBottom]=addScrollBottomListener,handlers[events.ctrlPageUp]=addCtrlPageUpListener,handlers[events.ctrlPageDown]=addCtrlPageDownListener,handlers[events.enter]=addEnterListener,handlers[events.accessibleChange]=addAccessibleChangeListener,handlers),(function(eventType,handler){(function(eventType,include){return!(!(include=include||[]).length||-1===include.indexOf(eventType))})(eventType,include)&&handler(element)}))},events:events}}));
/**
 * Contain the logic for the loading icon.
 *
 * @module     core/loading_icon
 * @class      loading_icon
 * @package    core
 * @copyright  2019 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/loadingicon",["jquery","core/templates"],(function($,Templates){var TEMPLATES_LOADING="core/loading",getIcon=function(){return Templates.render(TEMPLATES_LOADING,{})},addIconToContainerRemoveOnCompletion=function(container,loadingIconPromise){return getIcon().then((function(html){var loadingIcon=$(html).hide();return $(container).append(loadingIcon),loadingIcon.fadeIn(150),$.when(loadingIcon.promise(),loadingIconPromise)})).then((function(loadingIcon){return loadingIcon.fadeOut(100).promise()})).then((function(loadingIcon){loadingIcon.remove()}))};return{getIcon:getIcon,addIconToContainer:function(container){return getIcon().then((function(html){var loadingIcon=$(html).hide();return $(container).append(loadingIcon),loadingIcon.fadeIn(150),loadingIcon}))},addIconToContainerWithPromise:function(container){var loadingIconPromise=$.Deferred();return addIconToContainerRemoveOnCompletion(container,loadingIconPromise),loadingIconPromise},addIconToContainerRemoveOnCompletion:addIconToContainerRemoveOnCompletion}}));
/**
 * Simple API for set/get to localstorage, with cacherev expiration.
 *
 * @module     core/localstorage
 * @package    core
 * @class      localstorage
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      2.9
 */
define("core/localstorage",["core/config","core/storagewrapper"],(function(config,StorageWrapper){var storage=new StorageWrapper(window.localStorage);return{get:function(key){return storage.get(key)},set:function(key,value){return storage.set(key,value)}}}));
/**
 * Controls the popover region element.
 *
 * See template: core/popover_region
 *
 * @module     core/popover_region_controller
 * @class      popover_region_controller
 * @package    core
 * @copyright  2015 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.2
 */
define("core/popover_region_controller",["jquery","core/str","core/custom_interaction_events"],(function($,str,customEvents){var SELECTORS_CONTENT=".popover-region-content",SELECTORS_CONTENT_CONTAINER=".popover-region-content-container",SELECTORS_MENU_CONTAINER=".popover-region-container",SELECTORS_MENU_TOGGLE=".popover-region-toggle",SELECTORS_CAN_RECEIVE_FOCUS='input:not([type="hidden"]), a[href], button, textarea, select, [tabindex]',PopoverRegionController=function(element){this.root=$(element),this.content=this.root.find(SELECTORS_CONTENT),this.contentContainer=this.root.find(SELECTORS_CONTENT_CONTAINER),this.menuContainer=this.root.find(SELECTORS_MENU_CONTAINER),this.menuToggle=this.root.find(SELECTORS_MENU_TOGGLE),this.isLoading=!1,this.promises={closeHandlers:$.Deferred(),navigationHandlers:$.Deferred()},this.registerBaseEventListeners()};return PopoverRegionController.prototype.events=function(){return{menuOpened:"popoverregion:menuopened",menuClosed:"popoverregion:menuclosed",startLoading:"popoverregion:startLoading",stopLoading:"popoverregion:stopLoading"}},PopoverRegionController.prototype.getContentContainer=function(){return this.contentContainer},PopoverRegionController.prototype.getContent=function(){return this.content},PopoverRegionController.prototype.isMenuOpen=function(){return!this.root.hasClass("collapsed")},PopoverRegionController.prototype.toggleMenu=function(){this.isMenuOpen()?this.closeMenu():this.openMenu()},PopoverRegionController.prototype.closeMenu=function(){this.isMenuOpen()&&(this.root.addClass("collapsed"),this.menuContainer.attr("aria-expanded","false"),this.menuContainer.attr("aria-hidden","true"),this.updateButtonAriaLabel(),this.root.trigger(this.events().menuClosed))},PopoverRegionController.prototype.openMenu=function(){this.isMenuOpen()||(this.root.removeClass("collapsed"),this.menuContainer.attr("aria-expanded","true"),this.menuContainer.attr("aria-hidden","false"),this.updateButtonAriaLabel(),this.promises.closeHandlers.resolve(),this.promises.navigationHandlers.resolve(),this.root.trigger(this.events().menuOpened))},PopoverRegionController.prototype.updateButtonAriaLabel=function(){this.isMenuOpen()?str.get_string("hidepopoverwindow").done(function(string){this.menuToggle.attr("aria-label",string)}.bind(this)):str.get_string("showpopoverwindow").done(function(string){this.menuToggle.attr("aria-label",string)}.bind(this))},PopoverRegionController.prototype.startLoading=function(){this.isLoading=!0,this.getContentContainer().addClass("loading"),this.getContentContainer().attr("aria-busy","true"),this.root.trigger(this.events().startLoading)},PopoverRegionController.prototype.stopLoading=function(){this.isLoading=!1,this.getContentContainer().removeClass("loading"),this.getContentContainer().attr("aria-busy","false"),this.root.trigger(this.events().stopLoading)},PopoverRegionController.prototype.focusMenuToggle=function(){this.menuToggle.focus()},PopoverRegionController.prototype.contentItemHasFocus=function(){return this.getContentItemWithFocus().length>0},PopoverRegionController.prototype.getContentItemWithFocus=function(){var currentFocus=$(document.activeElement),items=this.getContent().children(),currentItem=items.filter(currentFocus);return currentItem.length||(currentItem=items.has(currentFocus)),currentItem},PopoverRegionController.prototype.focusContentItem=function(item){item.is(SELECTORS_CAN_RECEIVE_FOCUS)?item.focus():item.find(SELECTORS_CAN_RECEIVE_FOCUS).first().focus()},PopoverRegionController.prototype.focusFirstContentItem=function(){this.focusContentItem(this.getContent().children().first())},PopoverRegionController.prototype.focusLastContentItem=function(){this.focusContentItem(this.getContent().children().last())},PopoverRegionController.prototype.focusNextContentItem=function(){var currentItem=this.getContentItemWithFocus();currentItem.length&&currentItem.next()&&this.focusContentItem(currentItem.next())},PopoverRegionController.prototype.focusPreviousContentItem=function(){var currentItem=this.getContentItemWithFocus();currentItem.length&&currentItem.prev()&&this.focusContentItem(currentItem.prev())},PopoverRegionController.prototype.registerBaseEventListeners=function(){customEvents.define(this.root,[customEvents.events.activate,customEvents.events.escape]),this.root.on(customEvents.events.activate,SELECTORS_MENU_TOGGLE,function(){this.toggleMenu()}.bind(this)),this.promises.closeHandlers.done(function(){this.root.on(customEvents.events.escape,function(){this.closeMenu(),this.focusMenuToggle()}.bind(this)),$("html").click(function(e){var target=$(e.target);this.root.is(target)||this.root.has(target).length||this.closeMenu()}.bind(this)),customEvents.define(this.getContentContainer(),[customEvents.events.scrollBottom])}.bind(this))},PopoverRegionController.prototype.registerListNavigationEventListeners=function(){customEvents.define(this.root,[customEvents.events.down]),this.root.on(customEvents.events.down,function(e,data){this.isMenuOpen()?this.contentItemHasFocus()?this.focusNextContentItem():this.focusFirstContentItem():(this.openMenu(),this.focusFirstContentItem()),data.originalEvent.preventDefault()}.bind(this)),this.promises.navigationHandlers.done(function(){customEvents.define(this.root,[customEvents.events.up,customEvents.events.home,customEvents.events.end]),this.root.on(customEvents.events.up,function(e,data){this.focusPreviousContentItem(),data.originalEvent.preventDefault()}.bind(this)),this.root.on(customEvents.events.home,function(e,data){this.focusFirstContentItem(),data.originalEvent.preventDefault()}.bind(this)),this.root.on(customEvents.events.end,function(e,data){this.focusLastContentItem(),data.originalEvent.preventDefault()}.bind(this))}.bind(this))},PopoverRegionController}));
/**
 * Simple API for set/get to sessionstorage, with cacherev expiration.
 *
 * Session storage will only persist for as long as the browser window
 * stays open.
 *
 * See:
 * https://developer.mozilla.org/en-US/docs/Web/API/Window/sessionStorage
 *
 * @module     core/sessionstorage
 * @package    core
 * @copyright  2017 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/sessionstorage",["core/config","core/storagewrapper"],(function(config,StorageWrapper){var storage=new StorageWrapper(window.sessionStorage);return{get:function(key){return storage.get(key)},set:function(key,value){return storage.set(key,value)}}}));
/**
 * A module to help with toggle select/deselect all.
 *
 * @module     core/checkbox-toggleall
 * @copyright  2019 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/checkbox-toggleall",["jquery","core/pubsub"],(function($,PubSub){var registered=!1,events={checkboxToggled:"core/checkbox-toggleall:checkboxToggled"},getToggleGroupElements=function(root,toggleGroup,exactMatch){return exactMatch?root.find('[data-action="toggle"][data-togglegroup="'+toggleGroup+'"]'):root.find('[data-action="toggle"][data-togglegroup^="'+toggleGroup+'"]')},getAllSlaveCheckboxes=function(root,toggleGroup){return getToggleGroupElements(root,toggleGroup,!1).filter('[data-toggle="slave"]')},getControlCheckboxes=function(root,toggleGroup,exactMatch){return getToggleGroupElements(root,toggleGroup,exactMatch).filter('[data-toggle="master"]')},toggleSlavesFromMasters=function(e){var targetState,root=e.data.root,target=$(e.target),toggleGroupName=target.data("togglegroup");targetState=target.is(":checkbox")?target.is(":checked"):1===target.data("checkall"),toggleSlavesToState(root,toggleGroupName,targetState)},toggleMastersAndActionElements=function(root,toggleGroupName){var toggleGroupSlaves=getAllSlaveCheckboxes(root,toggleGroupName);if(toggleGroupSlaves.length>0){var toggleGroupCheckedSlaves=toggleGroupSlaves.filter(":checked"),targetState=toggleGroupSlaves.length===toggleGroupCheckedSlaves.length;setMasterStates(root,toggleGroupName,targetState,!0),setActionElementStates(root,toggleGroupName,!toggleGroupCheckedSlaves.length)}},getToggleGroupLevels=function(toggleGroupName){var toggleGroups=toggleGroupName.split(" "),toggleGroupLevels=[],toggleGroupLevel="";return toggleGroups.forEach((function(toggleGroupName){toggleGroupLevel+=" "+toggleGroupName,toggleGroupLevels.push(toggleGroupLevel.trim())})),toggleGroupLevels},toggleSlavesToState=function(root,toggleGroupName,targetState){var slaves=getAllSlaveCheckboxes(root,toggleGroupName);slaves.prop("checked",targetState).trigger("change");var checkedSlaves=slaves.filter(":checked");setMasterStates(root,toggleGroupName,targetState,!1),setActionElementStates(root,toggleGroupName,!checkedSlaves.length),getToggleGroupLevels(toggleGroupName).filter((function(toggleGroupLevel){return toggleGroupLevel!==toggleGroupName})).forEach((function(toggleGroupLevel){toggleMastersAndActionElements(root,toggleGroupLevel)})),PubSub.publish(events.checkboxToggled,{root:root,toggleGroupName:toggleGroupName,slaves:slaves,checkedSlaves:checkedSlaves,anyChecked:targetState})},toggleMastersFromSlaves=function(e){var root=e.data.root,toggleGroupName=$(e.target).data("togglegroup"),slaves=getAllSlaveCheckboxes(root,toggleGroupName),checkedSlaves=slaves.filter(":checked");getToggleGroupLevels(toggleGroupName).forEach((function(toggleGroupLevel){toggleMastersAndActionElements(root,toggleGroupLevel)})),PubSub.publish(events.checkboxToggled,{root:root,toggleGroupName:toggleGroupName,slaves:slaves,checkedSlaves:checkedSlaves,anyChecked:!!checkedSlaves.length})},setActionElementStates=function(root,toggleGroupName,disableActionElements){(function(root,toggleGroup){return getToggleGroupElements(root,toggleGroup,!0).filter('[data-toggle="action"]')})(root,toggleGroupName).prop("disabled",disableActionElements)},setMasterStates=function(root,toggleGroupName,targetState,exactMatch){var masters=getControlCheckboxes(root,toggleGroupName,exactMatch);masters.prop("checked",targetState),masters.each((function(i,masterElement){var targetString;if(masterElement=$(masterElement),targetString=targetState?masterElement.data("toggle-deselectall"):masterElement.data("toggle-selectall"),masterElement.is(":checkbox")){var masterLabel=root.find('[for="'+masterElement.attr("id")+'"]');masterLabel.length&&masterLabel.html()!==targetString&&masterLabel.html(targetString)}else masterElement.text(targetString),masterElement.data("checkall",targetState?0:1)}))};return{init:function(){!function(){if(!registered){registered=!0;var root=$(document.body);root.on("click",'[data-action="toggle"][data-toggle="master"]',{root:root},toggleSlavesFromMasters),root.on("click",'[data-action="toggle"][data-toggle="slave"]',{root:root},toggleMastersFromSlaves)}}()},events:events,setGroupState:function(root,toggleGroupName,targetState){root=$(root),setMasterStates(root,toggleGroupName,targetState,!0),toggleSlavesToState(root,toggleGroupName,targetState)},updateSlavesFromMasterState:function(root,toggleGroupName){root=$(root);var targetState,target=getControlCheckboxes(root,toggleGroupName,!1);targetState=target.is(":checkbox")?target.is(":checked"):1===target.data("checkall"),toggleSlavesToState(root,toggleGroupName,targetState)}}}));
/**
 * Poll the server to keep the session alive.
 *
 * @module     core/network
 * @package    core
 * @copyright  2019 Damyon Wiese
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/network",["jquery","core/ajax","core/config","core/notification","core/str"],(function($,Ajax,Config,Notification,Str){var started=!1,warningDisplayed=!1,keepAliveFrequency=0,requestTimeout=0,keepAliveMessage=!1,sessionTimeout=!1,checkFrequency=1e3*Math.min(Config.sessiontimeout/10,600),warningLimit=2*checkFrequency,timeoutSessionExpired=function(){sessionTimeout=!0},touchSession=function touchSession(){return sessionTimeout?Str.get_strings([{key:"sessionexpired",component:"error"},{key:"sessionerroruser",component:"error"}]).then((function(strings){return Notification.alert(strings[0],strings[1]),!0})).fail(Notification.exception):Ajax.call([{methodname:"core_session_touch",args:{}}],!0,!0,!1,requestTimeout)[0].then((function(){return keepAliveFrequency>0&&setTimeout(touchSession,keepAliveFrequency),!0})).fail((function(){Notification.alert("",keepAliveMessage)}))},checkSession=function checkSession(){return sessionTimeout=!1,Ajax.call([{methodname:"core_session_time_remaining",args:{}}],!0,!0,!0)[0].then((function(args){return!(args.userid<=0)&&(args.timeremaining<0?Str.get_strings([{key:"sessionexpired",component:"error"},{key:"sessionerroruser",component:"error"}]).then((function(strings){return Notification.alert(strings[0],strings[1]),!0})).fail(Notification.exception):1e3*args.timeremaining<warningLimit&&!warningDisplayed?(setTimeout(timeoutSessionExpired,1e3*args.timeremaining),warningDisplayed=!0,Str.get_strings([{key:"norecentactivity",component:"moodle"},{key:"sessiontimeoutsoon",component:"moodle"},{key:"extendsession",component:"moodle"},{key:"cancel",component:"moodle"}]).then((function(strings){return Notification.confirm(strings[0],strings[1],strings[2],strings[3],(function(){return touchSession(),warningDisplayed=!1,setTimeout(checkSession,5*checkFrequency),!0}),(function(){warningDisplayed=!1,setTimeout(checkSession,checkFrequency)})),!0})).fail(Notification.exception)):setTimeout(checkSession,checkFrequency),!0)}))},start=function(){keepAliveFrequency>0?setTimeout(touchSession,keepAliveFrequency):setTimeout(checkSession,5*checkFrequency)};return{keepalive:function(freq,timeout,message){started||(started=!0,keepAliveFrequency=1e3*freq,keepAliveMessage=message,requestTimeout=1e3*timeout,start())},init:function(){started||(started=!0,start())}}}));
/*
 * JavaScript to handle drag operations, including automatic scrolling.
 *
 * Note: this module is defined statically. It is a singleton. You
 * can only have one use of it active at any time. However, you
 * can only drag one thing at a time, this is not a problem in practice.
 *
 * @module     core/dragdrop
 * @class      dragdrop
 * @package    core
 * @copyright  2016 The Open University
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.6
 */
define("core/dragdrop",["jquery","core/autoscroll"],(function($,autoScroll){var dragdrop={eventCaptureOptions:{passive:!1,capture:!0},dragProxy:null,onMove:null,onDrop:null,initialPosition:null,initialX:null,initialY:null,touching:null,prepare:function(event){if(event.preventDefault(),"touchstart"===event.type?null===dragdrop.touching&&event.changedTouches.length>0:1===event.which){var details=dragdrop.getEventXY(event);return details.start=!0,details}return{start:!1}},start:function(event,dragProxy,onMove,onDrop){var xy=dragdrop.getEventXY(event);switch(dragdrop.initialX=xy.x,dragdrop.initialY=xy.y,dragdrop.initialPosition=dragProxy.offset(),dragdrop.dragProxy=dragProxy,dragdrop.onMove=onMove,dragdrop.onDrop=onDrop,event.type){case"mousedown":dragdrop.addEventSpecial("mousemove",dragdrop.mouseMove),dragdrop.addEventSpecial("mouseup",dragdrop.mouseUp);break;case"touchstart":dragdrop.addEventSpecial("touchend",dragdrop.touchEnd),dragdrop.addEventSpecial("touchcancel",dragdrop.touchEnd),dragdrop.addEventSpecial("touchmove",dragdrop.touchMove),dragdrop.touching=event.changedTouches[0].identifier;break;default:throw new Error("Unexpected event type: "+event.type)}autoScroll.start(dragdrop.scroll)},addEventSpecial:function(event,handler){try{window.addEventListener(event,handler,dragdrop.eventCaptureOptions)}catch(ex){dragdrop.eventCaptureOptions=!0,window.addEventListener(event,handler,dragdrop.eventCaptureOptions)}},getEventXY:function(event){switch(event.type){case"touchstart":return{x:event.changedTouches[0].pageX,y:event.changedTouches[0].pageY};case"mousedown":return{x:event.pageX,y:event.pageY};default:throw new Error("Unexpected event type: "+event.type)}},touchMove:function(e){e.preventDefault();for(var i=0;i<e.changedTouches.length;i++)e.changedTouches[i].identifier===dragdrop.touching&&dragdrop.handleMove(e.changedTouches[i].pageX,e.changedTouches[i].pageY)},mouseMove:function(e){dragdrop.handleMove(e.pageX,e.pageY)},handleMove:function(pageX,pageY){var current=dragdrop.dragProxy.offset(),topOffset=current.top-parseInt(dragdrop.dragProxy.css("top")),leftOffset=current.left-parseInt(dragdrop.dragProxy.css("left")),maxY=$(document).height()-dragdrop.dragProxy.outerHeight()-topOffset,maxX=$(document).width()-dragdrop.dragProxy.outerWidth()-leftOffset,minY=-topOffset,minX=-leftOffset,initial=dragdrop.initialPosition,position={top:Math.max(minY,Math.min(maxY,initial.top+(pageY-dragdrop.initialY)-topOffset)),left:Math.max(minX,Math.min(maxX,initial.left+(pageX-dragdrop.initialX)-leftOffset))};dragdrop.dragProxy.css(position),dragdrop.onMove(pageX,pageY,dragdrop.dragProxy)},touchEnd:function(e){e.preventDefault();for(var i=0;i<e.changedTouches.length;i++)e.changedTouches[i].identifier===dragdrop.touching&&dragdrop.handleEnd(e.changedTouches[i].pageX,e.changedTouches[i].pageY)},mouseUp:function(e){dragdrop.handleEnd(e.pageX,e.pageY)},handleEnd:function(pageX,pageY){null!==dragdrop.touching?(window.removeEventListener("touchend",dragdrop.touchEnd,dragdrop.eventCaptureOptions),window.removeEventListener("touchcancel",dragdrop.touchEnd,dragdrop.eventCaptureOptions),window.removeEventListener("touchmove",dragdrop.touchMove,dragdrop.eventCaptureOptions),dragdrop.touching=null):(window.removeEventListener("mousemove",dragdrop.mouseMove,dragdrop.eventCaptureOptions),window.removeEventListener("mouseup",dragdrop.mouseUp,dragdrop.eventCaptureOptions)),autoScroll.stop(),dragdrop.onDrop(pageX,pageY,dragdrop.dragProxy)},scroll:function(offset){var maxY=$(document).height()-dragdrop.dragProxy.outerHeight(),currentPosition=dragdrop.dragProxy.offset();currentPosition.top=Math.min(maxY,currentPosition.top+offset),dragdrop.dragProxy.css(currentPosition)}};return{prepare:dragdrop.prepare,start:dragdrop.start}}));
/**
 * Contain the logic for modal backdrops.
 *
 * @module     core/modal_backdrop
 * @class      modal_backdrop
 * @package    core
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/modal_backdrop",["jquery","core/templates","core/notification","core/fullscreen"],(function($,Templates,Notification,Fullscreen){var SELECTORS_ROOT='[data-region="modal-backdrop"]',ModalBackdrop=function(root){this.root=$(root),this.isAttached=!1,this.attachmentPoint=document.createElement("div"),document.body.append(this.attachmentPoint),this.root.is(SELECTORS_ROOT)||Notification.exception({message:"Element is not a modal backdrop"})};return ModalBackdrop.prototype.getRoot=function(){return this.root},ModalBackdrop.prototype.getAttachmentPoint=function(){return $(Fullscreen.getElement()||this.attachmentPoint)},ModalBackdrop.prototype.attachToDOM=function(){this.getAttachmentPoint().append(this.root),this.isAttached||(this.isAttached=!0)},ModalBackdrop.prototype.setZIndex=function(value){this.root.css("z-index",value)},ModalBackdrop.prototype.isVisible=function(){return this.root.hasClass("show")},ModalBackdrop.prototype.hasTransitions=function(){return this.getRoot().hasClass("fade")},ModalBackdrop.prototype.show=function(){this.isVisible()||(this.attachToDOM(),this.root.removeClass("hide").addClass("show"))},ModalBackdrop.prototype.hide=function(){this.isVisible()&&(this.hasTransitions()?this.getRoot().one("transitionend webkitTransitionEnd oTransitionEnd",function(){this.getRoot().removeClass("show").addClass("hide")}.bind(this)):this.getRoot().removeClass("show").addClass("hide"),$(document.body).find(this.getRoot()).length&&$(document.body).append(this.getRoot()))},ModalBackdrop.prototype.destroy=function(){this.root.remove(),this.attachmentPoint.remove()},ModalBackdrop}));
/**
 * Contain the events a modal can fire.
 *
 * @module     core/modal_events
 * @class      modal_events
 * @package    core
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/modal_events",[],(function(){return{shown:"modal:shown",hidden:"modal:hidden",destroyed:"modal:destroyed",bodyRendered:"modal:bodyRendered",save:"modal-save-cancel:save",cancel:"modal-save-cancel:cancel"}}));
/**
 * Chart output for HTML table.
 *
 * @package    core
 * @copyright  2016 Frdric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @module     core/chart_output_htmltable
 */
define("core/chart_output_htmltable",["jquery","core/chart_output_base"],(function($,Base){function Output(){Base.prototype.constructor.apply(this,arguments),this._build()}return Output.prototype=Object.create(Base.prototype),Output.prototype._build=function(){this._node.empty(),this._node.append(this._makeTable())},Output.prototype._makeTable=function(){var node,value,tbl=$("<table>"),c=this._chart,labels=c.getLabels(),hasLabel=labels.length>0,series=c.getSeries(),rowCount=series[0].getCount();tbl.addClass("chart-output-htmltable generaltable"),null!==c.getTitle()&&tbl.append($("<caption>").text(c.getTitle())),node=$("<tr>"),hasLabel&&node.append($("<td>")),series.forEach((function(serie){node.append($("<th>").text(serie.getLabel()).attr("scope","col"))})),tbl.append(node);for(var rowId=0;rowId<rowCount;rowId++){node=$("<tr>"),labels.length>0&&node.append($("<th>").text(labels[rowId]).attr("scope","row"));for(var serieId=0;serieId<series.length;serieId++)value=series[serieId].getValues()[rowId],null!==series[serieId].getLabels()&&(value=series[serieId].getLabels()[rowId]),node.append($("<td>").text(value));tbl.append(node)}return tbl},Output.prototype.update=function(){this._build()},Output}));
/**
 * Competency rule points module.
 *
 * @package    core
 * @copyright  2017 Damyon Wiese
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/icon_system_fontawesome",["core/icon_system","jquery","core/ajax","core/mustache","core/localstorage","core/url"],(function(IconSystem,$,Ajax,Mustache,LocalStorage,Url){var staticMap=null,fetchMap=null,IconSystemFontawesome=function(){IconSystem.apply(this,arguments)};return(IconSystemFontawesome.prototype=Object.create(IconSystem.prototype)).init=function(){var currTheme=M.cfg.theme;if(staticMap)return $.when(this);var map=LocalStorage.get("core_iconsystem/theme/"+currTheme+"/core/iconmap-fontawesome");return map&&(map=JSON.parse(map)),map?(staticMap=map,$.when(this)):(null===fetchMap&&(fetchMap=Ajax.call([{methodname:"core_output_load_fontawesome_icon_system_map",args:{themename:M.cfg.theme}}],!0,!1,!1,0,M.cfg.themerev)[0]),fetchMap.then(function(map){return staticMap={},$.each(map,(function(index,value){staticMap[value.component+"/"+value.pix]=value.to})),LocalStorage.set("core_iconsystem/theme/"+currTheme+"/core/iconmap-fontawesome",JSON.stringify(staticMap)),this}.bind(this)))},IconSystemFontawesome.prototype.renderIcon=function(key,component,title,template){var mappedIcon=staticMap[component+"/"+key],unmappedIcon=!1;void 0===mappedIcon&&(unmappedIcon={attributes:[{name:"src",value:Url.imageUrl(key,component)},{name:"alt",value:title},{name:"title",value:title}]});var context={key:mappedIcon,title:title,alt:title,unmappedIcon:unmappedIcon};return void 0!==title&&""!==title||(context["aria-hidden"]=!0),Mustache.render(template,context).trim()},IconSystemFontawesome.prototype.getTemplateName=function(){return"core/pix_icon_fontawesome"},IconSystemFontawesome}));
/**
 * Show an add block modal instead of doing it on a separate page.
 *
 * @module     core/addblockmodal
 * @class      addblockmodal
 * @package    core
 * @copyright  2016 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/addblockmodal",["jquery","core/modal_factory","core/templates","core/str","core/notification"],(function($,ModalFactory,Templates,Str,Notification){return{init:function(context){var addblocklink=$("[data-key=addblock]"),titlerequests=context.blocks.map((function(blockName){return{key:"pluginname",component:"block_"+blockName}})),bodyPromise=Str.get_strings(titlerequests).then((function(titles){return titles.map((function(title,index){return{name:context.blocks[index],title:title}}))})).then((function(blocks){return context.blocks=blocks,Templates.render("core/add_block_body",context)})).fail(Notification.exception),titlePromise=Str.get_string("addblock").fail(Notification.exception);ModalFactory.create({title:titlePromise,body:bodyPromise,type:"CANCEL"},addblocklink)}}}));
/**
 * A helper to manage pendingJS checks.
 *
 * @module     core/pending
 * @package    core
 * @copyright  2018 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.6
 */
define("core/pending",["jquery"],(function($){var request=function(pendingKey){var pendingPromise=$.Deferred();return pendingKey=pendingKey||{},M.util.js_pending(pendingKey),pendingPromise.then((function(){return M.util.js_complete(pendingKey)})).catch(),pendingPromise};return request.prototype.constructor=request,request}));
/**
 * A way to call HTML fragments to be inserted as required via JavaScript.
 *
 * @module     core/fragment
 * @class      fragment
 * @package    core
 * @copyright  2016 Adrian Greeve <adrian@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("core/fragment",["jquery","core/ajax"],(function($,ajax){return{loadFragment:function(component,callback,contextid,params){var promise=$.Deferred();return function(component,callback,contextid,params){var formattedparams=[];for(var index in params)formattedparams.push({name:index,value:params[index]});return ajax.call([{methodname:"core_get_fragment",args:{component:component,callback:callback,contextid:contextid,args:formattedparams}}])[0]}(component,callback,contextid,params).then((function(data){var jsNodes=$(data.javascript),allScript="";jsNodes.each((function(index,scriptNode){var tagName=(scriptNode=$(scriptNode)).prop("tagName");if(tagName&&"script"==tagName.toLowerCase())if(scriptNode.attr("src")){var exists=!1;$("script").each((function(index,s){return $(s).attr("src")==scriptNode.attr("src")&&(exists=!0),!exists})),exists||(allScript+=" { ",allScript+=' node = document.createElement("script"); ',allScript+=' node.type = "text/javascript"; ',allScript+=' node.src = decodeURI("'+encodeURI(scriptNode.attr("src"))+'"); ',allScript+=' document.getElementsByTagName("head")[0].appendChild(node); ',allScript+=" } ")}else allScript+=" "+scriptNode.text()})),promise.resolve(data.html,allScript)})).fail((function(ex){promise.reject(ex)})),promise.promise()}}}));
/**
 * Module for text truncation.
 *
 * Implementation provided by Pathable (thanks!).
 * See: https://github.com/pathable/truncate
 *
 * @module     core/truncate
 * @package    core
 * @class      truncate
 * @copyright  2017 Pathable
 *             2017 Mathias Bynens
 *             2017 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/truncate",["jquery"],(function($){var chop=/(\s*\S+|\s)$/,start=/^(\S*)/,space=/\s/,charLengthAt=function(text,position){var string=String(text),size=string.length,index=position?Number(position):0;if(index!=index&&(index=0),index<=-1||index>=size)return"";index|=0;var cuSecond,cuFirst=string.charCodeAt(index),nextIndex=index+1,len=1;return cuFirst>=55296&&cuFirst<=56319&&size>nextIndex&&(cuSecond=string.charCodeAt(nextIndex))>=56320&&cuSecond<=57343&&(len=2),len},lengthMultiByte=function(text){for(var count=0,i=0;i<text.length;i+=charLengthAt(text,i))count++;return count},getSliceLength=function(text,amount){if(!text.length)return 0;var length=0,count=0;do{length+=charLengthAt(text,length),count++}while(length<text.length&&count<amount);return length};return $.truncate=function(html,options){return $("<div></div>").append(html).truncate(options).html()},$.fn.truncate=function(options){isNaN(parseFloat(options))||(options={length:options});var o=$.extend({},$.truncate.defaults,options);return this.each((function(){var self=$(this);o.noBreaks&&self.find("br").replaceWith(" ");var ellipsisLength=o.ellipsis.length,text=self.text(),textLength=lengthMultiByte(text),excess=textLength-o.length+ellipsisLength;if(!(textLength<o.length)){if(o.stripTags&&self.text(text),o.words&&excess>0){var sliced=text.slice(0,getSliceLength(text,o.length-ellipsisLength)+1),replaced=sliced.replace(chop,""),truncated=lengthMultiByte(replaced),oneWord=!sliced.match(space);excess=o.keepFirstWord&&0===truncated?textLength-lengthMultiByte(start.exec(text)[0])-ellipsisLength:oneWord&&0===truncated?textLength-o.length+ellipsisLength:textLength-truncated-1}excess>textLength&&(excess=textLength-o.length),excess<0||!excess&&!o.truncated||$.each(self.contents().get().reverse(),(function(i,el){var $el=$(el),text=$el.text(),length=lengthMultiByte(text);if(length<=excess)return o.truncated=!0,excess-=length,void $el.remove();if(3===el.nodeType){var splitAmount=length-excess;return splitAmount=splitAmount>=0?getSliceLength(text,splitAmount):0,$(el.splitText(splitAmount)).replaceWith(o.ellipsis),!1}return $el.truncate($.extend(o,{length:length-excess+ellipsisLength})),!1}))}}))},$.truncate.defaults={stripTags:!1,words:!1,keepFirstWord:!1,noBreaks:!1,length:1/0,ellipsis:""},{truncate:$.truncate}}));
/**
 * A registry for the different types of modal.
 *
 * @module     core/modal_registry
 * @class      modal_registry
 * @package    core
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/modal_registry",["core/notification","core/prefetch"],(function(Notification,Prefetch){var registry={},get=function(type){return registry[type]};return{register:function(type,module,template){get(type)&&Notification.exception({message:"Modal of  type '"+type+"' is already registered"}),module&&"function"==typeof module||Notification.exception({message:"You must provide a modal module"}),template||Notification.exception({message:"You must provide a modal template"}),registry[type]={module:module,template:template},Prefetch.prefetchTemplate(template)},get:get}}));
/**
 * This is an empty module, that is required before all other modules.
 * Because every module is returned from a request for any other module, this
 * forces the loading of all modules with a single request.
 *
 * This function also sets up the listeners for ajax requests so we can tell
 * if any requests are still in progress.
 *
 * @module     core/first
 * @package    core
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      2.9
 */
define("core/first",["jquery"],(function($){$(document).bind("ajaxStart",(function(){M.util.js_pending("jq")})).bind("ajaxStop",(function(){M.util.js_complete("jq")}))}));
/**
 * Javascript for dynamically changing the page limits.
 *
 * @module     core/paged_content_paging_bar_limit_selector
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/paged_content_paging_bar_limit_selector",["jquery","core/custom_interaction_events","core/paged_content_events","core/pubsub"],(function($,CustomEvents,PagedContentEvents,PubSub){var SELECTORS_LIMIT_OPTION="[data-limit]";return{init:function(root,id){root=$(root),CustomEvents.define(root,[CustomEvents.events.activate]),root.on(CustomEvents.events.activate,SELECTORS_LIMIT_OPTION,(function(e,data){var optionElement=$(e.target).closest(SELECTORS_LIMIT_OPTION);if(!optionElement.hasClass("active")){var limit=parseInt(optionElement.attr("data-limit"),10);PubSub.publish(id+PagedContentEvents.SET_ITEMS_PER_PAGE_LIMIT,limit),data.originalEvent.preventDefault()}}))},rootSelector:'[data-region="paging-control-limit-container"]'}}));
/**
 * Javascript for showing/hiding pages of content.
 *
 * @module     core/paged_content_pages
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/paged_content_pages",["jquery","core/templates","core/notification","core/pubsub","core/paged_content_events","core/pending"],(function($,Templates,Notification,PubSub,PagedContentEvents,Pending){var SELECTORS_PAGE_REGION='[data-region="paged-content-page"]',TEMPLATES_PAGING_CONTENT_ITEM="core/paged_content_page",TEMPLATES_LOADING="core/overlay_loading",findPage=function(root,pageNumber){return root.find('[data-page="'+pageNumber+'"]')},showPages=function(root,pagesData,id,renderPagesContentCallback){var pendingPromise=new Pending("core/paged_content_pages:showPages"),existingPages=[],newPageData=[],newPagesPromise=$.Deferred();if(pagesData.forEach((function(pageData){var pageNumber=pageData.pageNumber,existingPage=findPage(root,pageNumber);existingPage.length?existingPages.push(existingPage):newPageData.push(pageData)})),newPageData.length&&"function"==typeof renderPagesContentCallback){var renderPagePromises=renderPagesContentCallback(newPageData,{allItemsLoaded:function(lastPageNumber){PubSub.publish(id+PagedContentEvents.ALL_ITEMS_LOADED,lastPageNumber)}}).map((function(promise,index){return function(root,pagePromise,pageNumber){var deferred=$.Deferred();return pagePromise.then((function(html,pageJS){pageJS=pageJS||"",Templates.render(TEMPLATES_PAGING_CONTENT_ITEM,{page:pageNumber,content:html}).then((function(html){Templates.appendNodeContents(root,html,pageJS);var page=findPage(root,pageNumber);deferred.resolve(page)})).fail((function(exception){deferred.reject(exception)})).fail(Notification.exception)})).fail((function(exception){deferred.reject(exception)})).fail(Notification.exception),deferred.promise()}(root,promise,newPageData[index].pageNumber)}));$.when.apply($,renderPagePromises).then((function(){var newPages=Array.prototype.slice.call(arguments);newPagesPromise.resolve(newPages)})).fail((function(exception){newPagesPromise.reject(exception)})).fail(Notification.exception)}else newPagesPromise.resolve([]);var loadingPromise=function(root){var deferred=$.Deferred();root.attr("aria-busy",!0);var pendingPromise=new Pending("core/paged_content_pages:startLoading");return Templates.render(TEMPLATES_LOADING,{visible:!0}).then((function(html){var loadingSpinner=$(html),timerId=setTimeout((function(){root.css("position","relative"),loadingSpinner.appendTo(root)}),300);deferred.always((function(){clearTimeout(timerId),loadingSpinner.remove(),root.css("position",""),root.removeAttr("aria-busy"),pendingPromise.resolve()}))})).fail(Notification.exception),deferred}(root);newPagesPromise.then((function(newPages){var pagesToShow=existingPages.concat(newPages);root.find(SELECTORS_PAGE_REGION).addClass("hidden"),pagesToShow.forEach((function(page){page.removeClass("hidden")}))})).then((function(){PubSub.publish(id+PagedContentEvents.PAGES_SHOWN,pagesData)})).fail(Notification.exception).always((function(){loadingPromise.resolve(),pendingPromise.resolve()})).catch()};return{init:function(root,id,renderPagesContentCallback){root=$(root),PubSub.subscribe(id+PagedContentEvents.SHOW_PAGES,(function(pagesData){showPages(root,pagesData,id,renderPagesContentCallback)})),PubSub.subscribe(id+PagedContentEvents.SET_ITEMS_PER_PAGE_LIMIT,(function(){root.empty()}))},rootSelector:'[data-region="page-container"]'}}));
/**
 * Chart axis.
 *
 * @package    core
 * @copyright  2016 Frdric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @module     core/chart_axis
 */
define("core/chart_axis",[],(function(){function Axis(){}return Axis.prototype.POS_DEFAULT=null,Axis.prototype.POS_BOTTOM="bottom",Axis.prototype.POS_LEFT="left",Axis.prototype.POS_RIGHT="right",Axis.prototype.POS_TOP="top",Axis.prototype._label=null,Axis.prototype._labels=null,Axis.prototype._max=null,Axis.prototype._min=null,Axis.prototype._position=null,Axis.prototype._stepSize=null,Axis.prototype.create=function(obj){var s=new Axis;return s.setPosition(obj.position),s.setLabel(obj.label),s.setStepSize(obj.stepSize),s.setMax(obj.max),s.setMin(obj.min),s.setLabels(obj.labels),s},Axis.prototype.getLabel=function(){return this._label},Axis.prototype.getLabels=function(){return this._labels},Axis.prototype.getMax=function(){return this._max},Axis.prototype.getMin=function(){return this._min},Axis.prototype.getPosition=function(){return this._position},Axis.prototype.getStepSize=function(){return this._stepSize},Axis.prototype.setLabel=function(label){this._label=label||null},Axis.prototype.setLabels=function(labels){this._labels=labels||null,null===this._labels||null!==this._stepSize||null!==this._min&&0!==this._min||null!==this._max||(this.setStepSize(1),this.setMin(0),this.setMax(labels.length-1))},Axis.prototype.setMax=function(max){this._max=void 0!==max?max:null},Axis.prototype.setMin=function(min){this._min=void 0!==min?min:null},Axis.prototype.setPosition=function(position){if(position!=this.POS_DEFAULT&&position!=this.POS_BOTTOM&&position!=this.POS_LEFT&&position!=this.POS_RIGHT&&position!=this.POS_TOP)throw new Error("Invalid axis position.");this._position=position},Axis.prototype.setStepSize=function(stepSize){if(null==stepSize)stepSize=null;else{if(isNaN(Number(stepSize)))throw new Error("Value for stepSize is not a number.");stepSize=Number(stepSize)}this._stepSize=stepSize},Axis}));
/**
 * Search box.
 *
 * @module     core/search-input
 * @class      search-input
 * @package    core
 * @copyright  2016 David Monllao {@link http://www.davidmonllao.com}
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      Moodle 3.1
 */
define("core/search-input",["jquery"],(function($){var wrapper=null,toggleForm=function(ev){wrapper.hasClass("expanded")?hideForm():showForm(ev)},showForm=function(ev){var windowWidth=$(document).width();"keydown"===ev.type&&13!==ev.keyCode&&32!==ev.keyCode||(windowWidth<=767&&("click"===ev.type||"keydown"===ev.type)?submitForm():windowWidth<=767||("keydown"===ev.type&&ev.preventDefault(),wrapper.addClass("expanded"),wrapper.find("form").addClass("expanded"),wrapper.find("input").focus()))},hideForm=function(){wrapper.removeClass("expanded"),wrapper.find("form").removeClass("expanded")},submitForm=function(){wrapper.find("form").submit()};return{init:function(id){(wrapper=$("#"+id)).on("click mouseover keydown","div",toggleForm)}}}));
/**
 * Autocomplete wrapper for select2 library.
 *
 * @module     core/form-autocomplete
 * @class      autocomplete
 * @package    core
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.0
 */
define("core/form-autocomplete",["jquery","core/log","core/str","core/templates","core/notification","core/loadingicon"],(function($,log,str,templates,notification,LoadingIcon){var KEYS_DOWN=40,KEYS_ENTER=13,KEYS_SPACE=32,KEYS_ESCAPE=27,KEYS_COMMA=44,KEYS_UP=38,KEYS_LEFT=37,KEYS_RIGHT=39,uniqueId=Date.now(),activateSelection=function(index,state){var selectionElement=$(document.getElementById(state.selectionId)),length=selectionElement.children("[aria-selected=true]").length;for(index%=length;index<0;)index+=length;var element=$(selectionElement.children("[aria-selected=true]").get(index)),itemId=state.selectionId+"-"+index;return selectionElement.children().attr("data-active-selection",null).attr("id",""),element.attr("data-active-selection",!0).attr("id",itemId),selectionElement.attr("aria-activedescendant",itemId),selectionElement.attr("data-active-value",element.attr("data-value")),$.Deferred().resolve()},updateActiveSelectionFromState=function(state){var activeElement=function(state){var selectionRegion=$(document.getElementById(state.selectionId)),activeId=selectionRegion.attr("aria-activedescendant");if(activeId){var activeElement=$(document.getElementById(activeId));if(activeElement.length)return activeElement}var activeValue=selectionRegion.attr("data-active-value");return selectionRegion.find('[data-value="'+activeValue+'"]')}(state),activeValue=activeElement.attr("data-value"),selectionRegion=$(document.getElementById(state.selectionId));if(activeValue){var activeIndex=selectionRegion.find("[aria-selected=true]").index(activeElement);if(-1!==activeIndex)return void activateSelection(activeIndex,state)}activateSelection(0,state)},updateSelectionList=function(options,state,originalSelect){var pendingKey="form-autocomplete-updateSelectionList-"+state.inputId;M.util.js_pending(pendingKey);var items=[],newSelection=$(document.getElementById(state.selectionId));if(originalSelect.children("option").each((function(index,ele){var label;$(ele).prop("selected")&&(""!==(label=$(ele).data("html")?$(ele).data("html"):$(ele).html())&&items.push({label:label,value:$(ele).attr("value")}))})),!hasItemListChanged(state,items))return M.util.js_complete(pendingKey),Promise.resolve();state.items=items;var context=$.extend(options,state);return templates.render(options.templates.items,context).then((function(html,js){templates.replaceNodeContents(newSelection,html,js),updateActiveSelectionFromState(state)})).then((function(){return M.util.js_complete(pendingKey)})).catch(notification.exception)},hasItemListChanged=function(state,items){return state.items.length!==items.length||state.items.filter((function(item){return-1===items.indexOf(item)})).length>0},notifyChange=function(originalSelect){var event;void 0!==M.core_formchangechecker&&M.core_formchangechecker.set_form_changed(),"function"==typeof Event?event=new Event("change"):(event=document.createEvent("Event")).initEvent("change",!0,!0),originalSelect[0].dispatchEvent(event)},deselectItem=function(options,state,item,originalSelect){var selectedItemValue=$(item).attr("data-value");return originalSelect.children("option").each((function(index,ele){$(ele).attr("value")==selectedItemValue&&($(ele).prop("selected",!1),$(ele).attr("data-iscustom")&&$(ele).remove())})),updateSelectionList(options,state,originalSelect).then((function(){notifyChange(originalSelect)}))},activateItem=function(index,state){var inputElement=$(document.getElementById(state.inputId)),suggestionsElement=$(document.getElementById(state.suggestionsId)),length=suggestionsElement.children("[aria-hidden=false]").length;for(index%=length;index<0;)index+=length;var element=$(suggestionsElement.children("[aria-hidden=false]").get(index)),globalIndex=$(suggestionsElement.children("[role=option]")).index(element),itemId=state.suggestionsId+"-"+globalIndex;suggestionsElement.children().attr("aria-selected",!1).attr("id",""),element.attr("aria-selected",!0).attr("id",itemId),inputElement.attr("aria-activedescendant",itemId);var scrollPos=element.offset().top-suggestionsElement.offset().top+suggestionsElement.scrollTop()-suggestionsElement.height()/2;return suggestionsElement.animate({scrollTop:scrollPos},100).promise()},closeSuggestions=function(state){var inputElement=$(document.getElementById(state.inputId)),suggestionsElement=$(document.getElementById(state.suggestionsId));return"true"===inputElement.attr("aria-expanded")&&inputElement.attr("aria-expanded",!1),inputElement.attr("aria-activedescendant",state.selectionId),suggestionsElement.hide().attr("aria-hidden",!0),$.Deferred().resolve()},updateSuggestions=function(options,state,query,originalSelect){var pendingKey="form-autocomplete-updateSuggestions-"+state.inputId;M.util.js_pending(pendingKey);var inputElement=$(document.getElementById(state.inputId)),suggestionsElement=$(document.getElementById(state.suggestionsId)),matchingElements=!1,suggestions=[];originalSelect.children("option").each((function(index,option){!0!==$(option).prop("selected")&&(suggestions[suggestions.length]={label:option.innerHTML,value:$(option).attr("value")})}));var searchquery=state.caseSensitive?query:query.toLocaleLowerCase(),context=$.extend({options:suggestions},options,state);return templates.render("core/form_autocomplete_suggestions",context).then((function(html,js){return templates.replaceNode(suggestionsElement,html,js),(suggestionsElement=$(document.getElementById(state.suggestionsId))).show().attr("aria-hidden",!1),suggestionsElement.children().each((function(index,node){node=$(node),options.caseSensitive&&node.text().indexOf(searchquery)>-1||!options.caseSensitive&&node.text().toLocaleLowerCase().indexOf(searchquery)>-1?(node.show().attr("aria-hidden",!1),matchingElements=!0):node.hide().attr("aria-hidden",!0)})),inputElement.attr("aria-expanded",!0),originalSelect.attr("data-notice")?suggestionsElement.html(originalSelect.attr("data-notice")):matchingElements?options.tags||activateItem(0,state):str.get_string("nosuggestions","form").done((function(nosuggestionsstr){suggestionsElement.html(nosuggestionsstr)})),suggestionsElement})).then((function(){return M.util.js_complete(pendingKey)})).catch(notification.exception)},createItem=function(options,state,originalSelect){var inputElement=$(document.getElementById(state.inputId)),tags=inputElement.val().split(","),found=!1;return $.each(tags,(function(tagindex,tag){if(""!==(tag=tag.trim())&&(options.multiple||originalSelect.children("option").prop("selected",!1),originalSelect.children("option").each((function(index,ele){$(ele).attr("value")==tag&&(found=!0,$(ele).prop("selected",!0))})),!found)){var option=$("<option>");option.append(document.createTextNode(tag)),option.attr("value",tag),originalSelect.append(option),option.prop("selected",!0),option.attr("data-iscustom",!0)}})),updateSelectionList(options,state,originalSelect).then((function(){notifyChange(originalSelect)})).then((function(){inputElement.val("")})).then((function(){return closeSuggestions(state)}))},selectCurrentItem=function(options,state,originalSelect){var inputElement=$(document.getElementById(state.inputId)),selectedItemValue=$(document.getElementById(state.suggestionsId)).children("[aria-selected=true]").attr("data-value");return options.multiple||originalSelect.children("option").prop("selected",!1),originalSelect.children("option").each((function(index,ele){$(ele).attr("value")==selectedItemValue&&$(ele).prop("selected",!0)})),updateSelectionList(options,state,originalSelect).then((function(){notifyChange(originalSelect)})).then((function(){return options.closeSuggestionsOnSelect?(inputElement.val(""),closeSuggestions(state)):(inputElement.focus(),updateSuggestions(options,state,inputElement.val(),originalSelect))}))},updateAjax=function(e,options,state,originalSelect,ajaxHandler){var pendingPromise=addPendingJSPromise("updateAjax"),parentElement=$(document.getElementById(state.selectId)).parent();LoadingIcon.addIconToContainerRemoveOnCompletion(parentElement,pendingPromise);var query=$(e.currentTarget).val();return ajaxHandler.transport(options.selector,query,(function(results){var processedResults=ajaxHandler.processResults(options.selector,results),existingValues=[];if(options.multiple||originalSelect.children("option").remove(),originalSelect.children("option").each((function(optionIndex,option){(option=$(option)).prop("selected")?existingValues.push(String(option.attr("value"))):option.remove()})),!options.multiple&&0===originalSelect.children("option").length){var option=$("<option>");originalSelect.append(option)}$.isArray(processedResults)?($.each(processedResults,(function(resultIndex,result){if(-1===existingValues.indexOf(String(result.value))){var option=$("<option>");option.append(result.label),option.attr("value",result.value),originalSelect.append(option)}})),originalSelect.attr("data-notice","")):originalSelect.attr("data-notice",processedResults),pendingPromise.resolve(updateSuggestions(options,state,"",originalSelect))}),(function(error){pendingPromise.reject(error)})),pendingPromise},addNavigation=function(options,state,originalSelect){var inputElement=$(document.getElementById(state.inputId));(inputElement.on("keydown",(function(e){var pendingJsPromise=addPendingJSPromise("addNavigation-"+state.inputId+"-"+e.keyCode);switch(e.keyCode){case KEYS_DOWN:return options.showSuggestions?("true"===inputElement.attr("aria-expanded")?pendingJsPromise.resolve(function(state){var suggestionsElement=$(document.getElementById(state.suggestionsId)),element=suggestionsElement.children("[aria-selected=true]"),current=suggestionsElement.children("[aria-hidden=false]").index(element);return activateItem(current+1,state)}(state)):!inputElement.val()&&options.ajax?require([options.ajax],(function(ajaxHandler){pendingJsPromise.resolve(updateAjax(e,options,state,originalSelect,ajaxHandler))})):pendingJsPromise.resolve(updateSuggestions(options,state,inputElement.val(),originalSelect)),e.preventDefault(),!1):(pendingJsPromise.resolve(),!0);case KEYS_UP:return pendingJsPromise.resolve(function(state){var suggestionsElement=$(document.getElementById(state.suggestionsId)),element=suggestionsElement.children("[aria-selected=true]"),current=suggestionsElement.children("[aria-hidden=false]").index(element);return activateItem(current-1,state)}(state)),e.preventDefault(),!1;case KEYS_ENTER:var suggestionsElement=$(document.getElementById(state.suggestionsId));return"true"===inputElement.attr("aria-expanded")&&suggestionsElement.children("[aria-selected=true]").length>0?pendingJsPromise.resolve(selectCurrentItem(options,state,originalSelect)):options.tags?pendingJsPromise.resolve(createItem(options,state,originalSelect)):pendingJsPromise.resolve(),e.preventDefault(),!1;case KEYS_ESCAPE:return"true"===inputElement.attr("aria-expanded")?pendingJsPromise.resolve(closeSuggestions(state)):pendingJsPromise.resolve(),e.preventDefault(),!1}return pendingJsPromise.resolve(),!0})),inputElement.on("keypress",(function(e){return e.keyCode!==KEYS_COMMA||(options.tags&&addPendingJSPromise("keypress-"+e.keyCode).resolve(createItem(options,state,originalSelect)),e.preventDefault(),!1)})),inputElement.closest("form").on("submit",(function(){return options.tags&&addPendingJSPromise("form-autocomplete-submit").resolve(createItem(options,state,originalSelect)),!0})),inputElement.on("blur",(function(){var pendingPromise=addPendingJSPromise("form-autocomplete-blur");window.setTimeout((function(){var focusElement=$(document.activeElement),timeoutPromise=$.Deferred();focusElement.is(document.getElementById(state.suggestionsId))?inputElement.focus():!focusElement.is(inputElement)&&$(document.getElementById(state.inputId)).length&&(options.tags&&timeoutPromise.then((function(){return createItem(options,state,originalSelect)})).catch(),timeoutPromise.then((function(){return closeSuggestions(state)})).catch()),timeoutPromise.then((function(){return pendingPromise.resolve()})).catch(),timeoutPromise.resolve()}),500)})),options.showSuggestions)&&$(document.getElementById(state.downArrowId)).on("click",(function(e){var pendingPromise=addPendingJSPromise("form-autocomplete-show-suggestions");inputElement.focus(),!inputElement.val()&&options.ajax?require([options.ajax],(function(ajaxHandler){pendingPromise.resolve(updateAjax(e,options,state,originalSelect,ajaxHandler))})):pendingPromise.resolve(updateSuggestions(options,state,inputElement.val(),originalSelect))}));var suggestionsElement=$(document.getElementById(state.suggestionsId));suggestionsElement.parent().prop("onclick",null).off("click"),suggestionsElement.parent().on("click","#".concat(state.suggestionsId," [role=option]"),(function(e){var pendingPromise=addPendingJSPromise("form-autocomplete-parent"),element=$(e.currentTarget).closest("[role=option]"),current=$(document.getElementById(state.suggestionsId)).children("[aria-hidden=false]").index(element);activateItem(current,state).then((function(){return selectCurrentItem(options,state,originalSelect)})).then((function(){return pendingPromise.resolve()})).catch()}));var selectionElement=$(document.getElementById(state.selectionId));selectionElement.on("click","[role=option]",(function(e){addPendingJSPromise("form-autocomplete-clicks").resolve(deselectItem(options,state,$(e.currentTarget),originalSelect))})),selectionElement.on("focus",(function(){updateActiveSelectionFromState(state)})),selectionElement.on("keydown",(function(e){var pendingPromise=addPendingJSPromise("form-autocomplete-keydown-"+e.keyCode);switch(e.keyCode){case KEYS_RIGHT:case KEYS_DOWN:return e.preventDefault(),void pendingPromise.resolve(function(state){var selectionsElement=$(document.getElementById(state.selectionId)),element=selectionsElement.children("[data-active-selection]"),current=0;return element?(current=selectionsElement.children("[aria-selected=true]").index(element),current+=1):current=0,activateSelection(current,state)}(state));case KEYS_LEFT:case KEYS_UP:return e.preventDefault(),void pendingPromise.resolve(function(state){var selectionsElement=$(document.getElementById(state.selectionId)),element=selectionsElement.children("[data-active-selection]");if(!element)return activateSelection(0,state);var current=selectionsElement.children("[aria-selected=true]").index(element);return activateSelection(current-1,state)}(state));case KEYS_SPACE:case KEYS_ENTER:var selectedItem=$(document.getElementById(state.selectionId)).children("[data-active-selection]");return void(selectedItem&&(e.preventDefault(),pendingPromise.resolve(deselectItem(options,state,selectedItem,originalSelect))))}pendingPromise.resolve()})),options.showSuggestions&&(inputElement.on("focus",(function(e){var query=$(e.currentTarget).val();$(e.currentTarget).data("last-value",query)})),options.ajax?require([options.ajax],(function(ajaxHandler){var throttleTimeout=null,inProgress=!1,pendingKey="autocomplete-throttledhandler",handler=function(e){throttleTimeout=null,inProgress=!0,updateAjax(e,options,state,originalSelect,ajaxHandler).then((function(){return null===throttleTimeout&&M.util.js_complete(pendingKey),inProgress=!1,arguments[0]})).catch(notification.exception)},throttledHandler=function throttledHandler(e){window.clearTimeout(throttleTimeout),inProgress?throttleTimeout=window.setTimeout(throttledHandler.bind(this,e),100):(null===throttleTimeout&&M.util.js_pending(pendingKey),throttleTimeout=window.setTimeout(handler.bind(this,e),300))};inputElement.on("input",(function(e){var query=$(e.currentTarget).val();$(e.currentTarget).data("last-value")!==query&&throttledHandler(e),$(e.currentTarget).data("last-value",query)}))})):inputElement.on("input",(function(e){var query=$(e.currentTarget).val();$(e.currentTarget).data("last-value")!==query&&updateSuggestions(options,state,query,originalSelect),$(e.currentTarget).data("last-value",query)})))},addPendingJSPromise=function(key){var pendingKey="form-autocomplete:"+key;M.util.js_pending(pendingKey);var pendingPromise=$.Deferred();return pendingPromise.then((function(){return M.util.js_complete(pendingKey),arguments[0]})).catch(notification.exception),pendingPromise};return{enhance:function(selector,tags,ajax,placeholder,caseSensitive,showSuggestions,noSelectionString,closeSuggestionsOnSelect,templateOverrides){var options={selector:selector,tags:!1,ajax:!1,placeholder:placeholder,caseSensitive:!1,showSuggestions:!0,noSelectionString:noSelectionString,templates:$.extend({input:"core/form_autocomplete_input",items:"core/form_autocomplete_selection_items",layout:"core/form_autocomplete_layout",selection:"core/form_autocomplete_selection",suggestions:"core/form_autocomplete_suggestions"},templateOverrides)},pendingKey="autocomplete-setup-"+selector;M.util.js_pending(pendingKey),void 0!==tags&&(options.tags=tags),void 0!==ajax&&(options.ajax=ajax),void 0!==caseSensitive&&(options.caseSensitive=caseSensitive),void 0!==showSuggestions&&(options.showSuggestions=showSuggestions),void 0===noSelectionString&&str.get_string("noselection","form").done((function(result){options.noSelectionString=result})).fail(notification.exception);var originalSelect=$(selector);if(!originalSelect)return log.debug("Selector not found: "+selector),M.util.js_complete(pendingKey),!1;originalSelect.css("visibility","hidden").attr("aria-hidden",!0);var state={selectId:originalSelect.attr("id"),inputId:"form_autocomplete_input-"+uniqueId,suggestionsId:"form_autocomplete_suggestions-"+uniqueId,selectionId:"form_autocomplete_selection-"+uniqueId,downArrowId:"form_autocomplete_downarrow-"+uniqueId,items:[]};uniqueId++,options.multiple=originalSelect.attr("multiple"),options.multiple||originalSelect.prepend("<option>"),options.closeSuggestionsOnSelect=void 0!==closeSuggestionsOnSelect?closeSuggestionsOnSelect:!options.multiple;var originalLabel=$("[for="+state.selectId+"]"),suggestions=[];originalSelect.children("option").each((function(index,option){suggestions[index]={label:option.innerHTML,value:$(option).attr("value")}}));var context=$.extend({},options,state);context.options=suggestions,context.items=[];var collectedjs="",renderLayout=templates.render(options.templates.layout,{}).then((function(html){return $(html)})),renderInput=templates.render(options.templates.input,context).then((function(html,js){return collectedjs+=js,$(html)})),renderDatalist=templates.render(options.templates.suggestions,context).then((function(html,js){return collectedjs+=js,$(html)})),renderSelection=templates.render(options.templates.selection,context).then((function(html,js){return collectedjs+=js,$(html)}));return $.when(renderLayout,renderInput,renderDatalist,renderSelection).then((function(layout,input,suggestions,selection){originalSelect.hide();var container=originalSelect.parent();$(input).find("input").attr("data-fieldtype","autocomplete"),container.append(layout),container.find('[data-region="form_autocomplete-input"]').replaceWith(input),container.find('[data-region="form_autocomplete-suggestions"]').replaceWith(suggestions),container.find('[data-region="form_autocomplete-selection"]').replaceWith(selection),templates.runTemplateJS(collectedjs),originalLabel.attr("for",state.inputId),addNavigation(options,state,originalSelect),$(document.getElementById(state.suggestionsId)).hide().attr("aria-hidden",!0)})).then((function(){return updateSelectionList(options,state,originalSelect)})).then((function(){return M.util.js_complete(pendingKey)})).catch((function(error){M.util.js_complete(pendingKey),notification.exception(error)}))}}}));
/**
 * Chart line.
 *
 * @package    core
 * @copyright  2016 Frdric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @module     core/chart_line
 */
define("core/chart_line",["core/chart_base"],(function(Base){function Line(){Base.prototype.constructor.apply(this,arguments)}return Line.prototype=Object.create(Base.prototype),Line.prototype.TYPE="line",Line.prototype._smooth=!1,Line.prototype.create=function(Klass,data){var chart=Base.prototype.create.apply(this,arguments);return chart.setSmooth(data.smooth),chart},Line.prototype.getSmooth=function(){return this._smooth},Line.prototype.setSmooth=function(smooth){this._smooth=Boolean(smooth)},Line}));
/**
 * Icon System base module.
 *
 * @package    core
 * @copyright  2017 Damyon Wiese
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core/icon_system",["jquery"],(function($){var IconSystem=function(){};return IconSystem.prototype.init=function(){return $.when(this)},IconSystem.prototype.renderIcon=function(key,component,title,template){throw new Error("Abstract function not implemented.")},IconSystem.prototype.getTemplateName=function(){throw new Error("Abstract function not implemented.")},IconSystem}));
define("core/drawer_events",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;return _exports.default={DRAWER_SHOWN:"drawer-shown",DRAWER_HIDDEN:"drawer-hidden"},_exports.default}));
define("core/str",["exports","jquery","core/ajax","core/localstorage"],(function(_exports,_jquery,_ajax,_localstorage){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.get_strings=_exports.get_string=_exports.cache_strings=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax),_localstorage=_interopRequireDefault(_localstorage);var promiseCache=[];_exports.get_string=function(key,component,param,lang){return get_strings([{key:key,component:component,param:param,lang:lang}]).then((function(results){return results[0]}))};var get_strings=function(requests){var requestData=[],pageLang=(0,_jquery.default)("html").attr("lang").replace(/-/g,"_"),stringPromises=requests.map((function(request){var cacheKey=function(_ref){var key=_ref.key,component=_ref.component,_ref$lang=_ref.lang,lang=void 0===_ref$lang?pageLang:_ref$lang;return component||(component="core"),"core_str/".concat(key,"/").concat(component,"/").concat(lang)}(request),component=request.component,key=request.key,param=request.param,_request$lang=request.lang,lang=void 0===_request$lang?pageLang:_request$lang,buildReturn=function(promise){return promiseCache[cacheKey]=promise,promise};if(component in M.str&&key in M.str[component])return buildReturn(new Promise((function(resolve){resolve(M.util.get_string(key,component,param,lang))})));var cached=_localstorage.default.get(cacheKey);return cached?(M.str[component]=_objectSpread(_objectSpread({},M.str[component]),{},_defineProperty({},key,cached)),buildReturn(new Promise((function(resolve){resolve(M.util.get_string(key,component,param,lang))})))):cacheKey in promiseCache?buildReturn(promiseCache[cacheKey]).then((function(){return M.util.get_string(key,component,param,lang)})):buildReturn(new Promise((function(resolve,reject){requestData.push({methodname:"core_get_string",args:{stringid:key,stringparams:[],component:component,lang:lang},done:function(str){M.str[component]=_objectSpread(_objectSpread({},M.str[component]),{},_defineProperty({},key,str)),_localstorage.default.set(cacheKey,str),resolve(M.util.get_string(key,component,param,lang))},fail:reject})})))}));return requestData.length&&_ajax.default.call(requestData,!0,!1,!1,0,M.cfg.langrev),_jquery.default.when.apply(_jquery.default,stringPromises).then((function(){for(var _len=arguments.length,strings=new Array(_len),_key=0;_key<_len;_key++)strings[_key]=arguments[_key];return strings}))};_exports.get_strings=get_strings;_exports.cache_strings=function(strings){var defaultLang=(0,_jquery.default)("html").attr("lang").replace(/-/g,"_");strings.forEach((function(_ref2){var key=_ref2.key,component=_ref2.component,value=_ref2.value,_ref2$lang=_ref2.lang,cacheKey=["core_str",key,component,void 0===_ref2$lang?defaultLang:_ref2$lang].join("/");component in M.str&&key in M.str[component]||(component in M.str||(M.str[component]={}),M.str[component][key]=value),_localstorage.default.get(cacheKey)||_localstorage.default.set(cacheKey,value),cacheKey in promiseCache||(promiseCache[cacheKey]=_jquery.default.Deferred().resolve(value).promise())}))}}));
/**
 * Standard Ajax wrapper for Moodle. It calls the central Ajax script,
 * which can call any existing webservice using the current session.
 * In addition, it can batch multiple requests and return multiple responses.
 *
 * @module     core/ajax
 * @class      ajax
 * @package    core
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      2.9
 */
define("core/ajax",["jquery","core/config","core/log","core/url"],(function($,config,Log,URL){var unloading=!1,requestSuccess=function(responses){var request,response,nosessionupdate,exception=null,i=0;if(responses.error)for(;i<this.length;i++)(request=this[i]).deferred.reject(responses);else{for(i=0;i<this.length;i++){if(request=this[i],void 0===(response=responses[i])){exception=new Error("missing response");break}if(!1!==response.error){exception=response.exception,nosessionupdate=this[i].nosessionupdate;break}request.deferred.resolve(response.data)}null!==exception&&("servicerequireslogin"!==exception.errorcode||nosessionupdate?this.forEach((function(request){request.deferred.reject(exception)})):window.location=URL.relativeUrl("/login/index.php"))}},requestFail=function(jqXHR,textStatus,exception){var i=0;for(i=0;i<this.length;i++){var request=this[i];unloading?(Log.error("Page unloaded."),Log.error(exception)):request.deferred.reject(exception)}};return{call:function(requests,async,loginrequired,nosessionupdate,timeout,cachekey){$(window).bind("beforeunload",(function(){unloading=!0}));var i,ajaxRequestData=[],promises=[],methodInfo=[],requestInfo="";for(void 0===loginrequired&&(loginrequired=!0),void 0===async&&(async=!0),void 0===timeout&&(timeout=0),void 0===cachekey||(cachekey=parseInt(cachekey))<=0?cachekey=null:cachekey||(cachekey=null),void 0===nosessionupdate&&(nosessionupdate=!1),i=0;i<requests.length;i++){var request=requests[i];ajaxRequestData.push({index:i,methodname:request.methodname,args:request.args}),request.nosessionupdate=nosessionupdate,request.deferred=$.Deferred(),promises.push(request.deferred.promise()),void 0!==request.done&&request.deferred.done(request.done),void 0!==request.fail&&request.deferred.fail(request.fail),request.index=i,methodInfo.push(request.methodname)}requestInfo=methodInfo.length<=5?methodInfo.sort().join():methodInfo.length+"-method-calls",ajaxRequestData=JSON.stringify(ajaxRequestData);var settings={type:"POST",context:requests,dataType:"json",processData:!1,async:async,contentType:"application/json",timeout:timeout},script="service.php",url=config.wwwroot+"/lib/ajax/";if(loginrequired?url+=script+"?sesskey="+config.sesskey+"&info="+requestInfo:(url+=(script="service-nologin.php")+"?info="+requestInfo,cachekey&&(url+="&cachekey="+cachekey,settings.type="GET")),nosessionupdate&&(url+="&nosessionupdate=true"),"POST"===settings.type)settings.data=ajaxRequestData;else{var urlUseGet=url+"&args="+encodeURIComponent(ajaxRequestData);urlUseGet.length>2e3?(settings.type="POST",settings.data=ajaxRequestData):url=urlUseGet}return async?$.ajax(url,settings).done(requestSuccess).fail(requestFail):(settings.success=requestSuccess,settings.error=requestFail,$.ajax(url,settings)),promises}}}));
/**
 * A list of human readable names for the keycodes.
 *
 * @module     core/key_codes
 * @class      key_codes
 * @package    core
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.2
 */
define("core/key_codes",(function(){return{tab:9,enter:13,shift:16,ctrl:17,alt:18,escape:27,space:32,end:35,home:36,arrowLeft:37,arrowUp:38,arrowRight:39,arrowDown:40,8:56,asterix:106,pageUp:33,pageDown:34}}));
/**
 * This module updates the UI during an asynchronous
 * backup or restore process.
 *
 * @module     backup/util/async_backup
 * @package    core
 * @copyright  2018 Matt Porritt <mattp@catalyst-au.net>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.7
 */
define("core_backup/async_backup",["jquery","core/ajax","core/str","core/notification","core/templates"],(function($,ajax,Str,notification,Templates){var backupid,contextid,restoreurl,typeid,backupintervalid,allbackupintervalid,allcopyintervalid,Asyncbackup={},checkdelay=15e3;function updateElement(backupid,type,percentage){var percentagewidth=Math.round(percentage)+"%",elementbar=document.querySelectorAll("[data-"+type+"id="+CSS.escape(backupid)+"]")[0],percentagetext=percentage.toFixed(2)+"%";elementbar.setAttribute("aria-valuenow",percentagewidth),elementbar.style.width=percentagewidth,elementbar.innerHTML=percentagetext}function updateInterval(intervalid,callback,value){return clearInterval(intervalid),setInterval(callback,value)}function updateProgressAll(progress){progress.forEach((function(element){var percentage=100*element.progress,backupid=element.backupid,type=element.operation,elementbar=document.querySelectorAll("[data-"+type+"id="+CSS.escape(backupid)+"]")[0];800==element.status?(elementbar.classList.add("bg-success"),updateElement(backupid,type,percentage)):900==element.status?(elementbar.classList.add("bg-danger"),elementbar.classList.add("complete"),elementbar.classList.remove("bg-success"),updateElement(backupid,type,100)):1e3==element.status&&(elementbar.classList.add("bg-success"),elementbar.classList.add("complete"),updateElement(backupid,type,100),"backup"==type?function(backupid){var statuscell=$("#"+backupid+"_bar").parent().parent(),tablerow=statuscell.parent(),cellsiblings=statuscell.siblings(),timecell=cellsiblings[1],timevalue=$(timecell).text(),filenamecell=cellsiblings[0],filename=$(filenamecell).text();ajax.call([{methodname:"core_backup_get_async_backup_links_backup",args:{filename:filename,contextid:contextid}}])[0].done((function(response){var context={filename:filename,time:timevalue,size:response.filesize,fileurl:response.fileurl,restoreurl:response.restoreurl};Templates.render("core/async_backup_progress_row",context).then((function(html,js){Templates.replaceNodeContents(tablerow,html,js)})).fail((function(){notification.exception(new Error("Failed to load table row"))}))}))}(backupid):function(backupid){var statuscell=$("#"+backupid+"_bar").parent().parent(),tablerow=statuscell.parent(),cellsiblings=statuscell.siblings(),coursecell=cellsiblings[0],timecell=cellsiblings[1],timevalue=$(timecell).text();ajax.call([{methodname:"core_backup_get_async_backup_links_restore",args:{backupid:backupid,contextid:contextid}}])[0].done((function(response){var context={resourcename:$(coursecell).text(),restoreurl:response.restoreurl,time:timevalue};Templates.render("core/async_restore_progress_row",context).then((function(html,js){Templates.replaceNodeContents(tablerow,html,js)})).fail((function(){notification.exception(new Error("Failed to load table row"))}))}))}(backupid))}))}function updateProgressCopy(progress){progress.forEach((function(element){var percentage=100*element.progress,backupid=element.backupid,type=element.operation,elementbar=document.querySelectorAll("[data-"+type+"id="+CSS.escape(backupid)+"]")[0];if("restore"==type){var restorecell=elementbar.closest("tr").children[3];Str.get_string("restore").then((function(content){restorecell.innerHTML=content})).catch((function(){notification.exception(new Error("Failed to load string: restore"))}))}800==element.status?(elementbar.classList.add("bg-success"),updateElement(backupid,type,percentage)):900==element.status?(elementbar.classList.add("bg-danger"),elementbar.classList.add("complete"),elementbar.classList.remove("bg-success"),updateElement(backupid,type,100)):1e3==element.status&&"restore"==type&&(elementbar.classList.add("bg-success"),elementbar.classList.add("complete"),updateElement(backupid,type,100),function(backupid){var elementbar=document.querySelectorAll("[data-restoreid="+CSS.escape(backupid)+"]")[0],restorecourse=elementbar.closest("tr").children[1],coursename=restorecourse.innerHTML,courselink=document.createElement("a"),elementbarparent=elementbar.closest("td"),operation=elementbarparent.previousElementSibling;Str.get_string("complete").then((function(content){operation.innerHTML=content})).catch((function(){notification.exception(new Error("Failed to load string: complete"))})),Templates.render("core/async_copy_complete_cell",{}).then((function(html,js){Templates.replaceNodeContents(elementbarparent,html,js)})).fail((function(){notification.exception(new Error("Failed to load table cell"))})),ajax.call([{methodname:"core_backup_get_async_backup_links_restore",args:{backupid:backupid,contextid:0}}])[0].done((function(response){courselink.setAttribute("href",response.restoreurl),courselink.innerHTML=coursename,restorecourse.innerHTML=null,restorecourse.appendChild(courselink)})).fail((function(){notification.exception(new Error("Failed to update table row"))}))}(backupid))}))}function getBackupProgress(){ajax.call([{methodname:"core_backup_get_async_backup_progress",args:{backupids:[backupid],contextid:contextid}}],!0,!0,!1,2e3)[0].done((function(response){!function(progress){var stringRequests,percentage=100*progress.progress,type="backup",elementbar=document.querySelectorAll("[data-backupid="+CSS.escape(backupid)+"]")[0],elementstatus=$("#"+backupid+"_status"),elementdetail=$("#"+backupid+"_detail"),elementbutton=$("#"+backupid+"_button");if(800==progress.status){elementbar.classList.add("bg-success"),updateElement(backupid,type,percentage);var strProcessing="async"+typeid+"processing";Str.get_string(strProcessing,"backup").then((function(title){elementstatus.text(title)})).catch((function(){notification.exception(new Error("Failed to load string: backup "+strProcessing))}))}else if(900==progress.status)elementbar.classList.add("bg-danger"),elementbar.classList.remove("bg-success"),updateElement(backupid,type,100),stringRequests=[{key:"async"+typeid+"error",component:"backup"},{key:"async"+typeid+"errordetail",component:"backup"}],Str.get_strings(stringRequests).then((function(strings){elementstatus.text(strings[0]),elementdetail.text(strings[1])})).catch((function(){notification.exception(new Error("Failed to load string"))})),$(".backup_progress").children("span").removeClass("backup_stage_current"),$(".backup_progress").children("span").last().addClass("backup_stage_current"),clearInterval(backupintervalid);else if(1e3==progress.status){elementbar.classList.add("bg-success"),updateElement(backupid,type,100);var strComplete="async"+typeid+"complete";Str.get_string(strComplete,"backup").then((function(title){elementstatus.text(title)})).catch((function(){notification.exception(new Error("Failed to load string: backup "+strComplete))})),"restore"==typeid?ajax.call([{methodname:"core_backup_get_async_backup_links_restore",args:{backupid:backupid,contextid:contextid}}])[0].done((function(response){var strButton="async"+typeid+"completebutton",stringRequests=[{key:"async"+typeid+"completedetail",component:"backup",param:response.restoreurl},{key:strButton,component:"backup"}];Str.get_strings(stringRequests).then((function(strings){elementdetail.html(strings[0]),elementbutton.text(strings[1]),elementbutton.attr("href",response.restoreurl)})).catch((function(){notification.exception(new Error("Failed to load string"))}))})):(stringRequests=[{key:"async"+typeid+"completedetail",component:"backup",param:restoreurl},{key:"async"+typeid+"completebutton",component:"backup"}],Str.get_strings(stringRequests).then((function(strings){elementdetail.html(strings[0]),elementbutton.text(strings[1]),elementbutton.attr("href",restoreurl)})).catch((function(){notification.exception(new Error("Failed to load string"))}))),$(".backup_progress").children("span").removeClass("backup_stage_current"),$(".backup_progress").children("span").last().addClass("backup_stage_current"),clearInterval(backupintervalid)}}(response[0]),checkdelay=15e3,backupintervalid=updateInterval(backupintervalid,getBackupProgress,15e3)})).fail((function(){backupintervalid=updateInterval(backupintervalid,getBackupProgress,checkdelay*=1.5)}))}function getAllBackupProgress(){var backupids=[];$(".progress").find(".progress-bar").not(".complete").each((function(){backupids.push(this.id.substring(0,32))})),backupids.length>0?ajax.call([{methodname:"core_backup_get_async_backup_progress",args:{backupids:backupids,contextid:contextid}}],!0,!0,!1,2e3)[0].done((function(response){updateProgressAll(response),checkdelay=15e3,allbackupintervalid=updateInterval(allbackupintervalid,getAllBackupProgress,15e3)})).fail((function(){allbackupintervalid=updateInterval(allbackupintervalid,getAllBackupProgress,checkdelay*=1.5)})):clearInterval(allbackupintervalid)}function getAllCopyProgress(){var copyids=[];$(".progress").find(".progress-bar[data-operation][data-backupid][data-restoreid]").not(".complete").each((function(){var progressvars={backupid:this.dataset.backupid,restoreid:this.dataset.restoreid,operation:this.dataset.operation};copyids.push(progressvars)})),copyids.length>0?ajax.call([{methodname:"core_backup_get_copy_progress",args:{copies:copyids}}],!0,!0,!1,2e3)[0].done((function(response){updateProgressCopy(response),checkdelay=15e3,allcopyintervalid=updateInterval(allcopyintervalid,getAllCopyProgress,15e3)})).fail((function(){allcopyintervalid=updateInterval(allcopyintervalid,getAllCopyProgress,checkdelay*=1.5)})):clearInterval(allcopyintervalid)}return Asyncbackup.asyncBackupAllStatus=function(context){contextid=context,allbackupintervalid=setInterval(getAllBackupProgress,checkdelay)},Asyncbackup.asyncCopyAllStatus=function(){allcopyintervalid=setInterval(getAllCopyProgress,checkdelay)},Asyncbackup.asyncBackupStatus=function(backup,context,restore,type){backupid=backup,contextid=context,restoreurl=restore,typeid="backup"==type?"backup":"restore",$(".backup_progress").children("a").removeAttr("href"),backupintervalid=setInterval(getBackupProgress,checkdelay)},Asyncbackup}));
define("core_badges/backpackactions",["exports","jquery","core_badges/selectors","core/str","core/pending","core/modal_factory","core/modal_events","core/config"],(function(_exports,_jquery,_selectors,_str,_pending,_modal_factory,_modal_events,_config){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_selectors=_interopRequireDefault(_selectors),_pending=_interopRequireDefault(_pending),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_config=_interopRequireDefault(_config);_exports.init=function(){var pendingPromise=new _pending.default,root=(0,_jquery.default)(_selectors.default.elements.main);registerListenerEvents(root),pendingPromise.resolve()};var _ref2,_ref3,registerListenerEvents=function(root){var _ref;root.on("click",_selectors.default.actions.deletebackpack,(_ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(e){var link,modal;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return e.preventDefault(),link=(0,_jquery.default)(e.currentTarget),_context.next=4,buildModal(link);case 4:modal=_context.sent,displayModal(modal,link);case 6:case"end":return _context.stop()}}),_callee)}))),function(_x){return _ref.apply(this,arguments)}))},buildModal=(_ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(link){var backpackurl;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return backpackurl=link.closest(_selectors.default.elements.backpackurl).attr("data-backpackurl"),_context2.t0=_modal_factory.default,_context2.next=4,(0,_str.get_string)("delexternalbackpack","core_badges");case 4:return _context2.t1=_context2.sent,_context2.next=7,(0,_str.get_string)("delexternalbackpackconfirm","core_badges",backpackurl);case 7:return _context2.t2=_context2.sent,_context2.t3=_modal_factory.default.types.SAVE_CANCEL,_context2.t4={title:_context2.t1,body:_context2.t2,type:_context2.t3},_context2.abrupt("return",_context2.t0.create.call(_context2.t0,_context2.t4));case 11:case"end":return _context2.stop()}}),_callee2)}))),function(_x2){return _ref2.apply(this,arguments)}),displayModal=(_ref3=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(modal,link){return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.t0=modal,_context3.next=3,(0,_str.get_string)("delete","core");case 3:_context3.t1=_context3.sent,_context3.t0.setSaveButtonText.call(_context3.t0,_context3.t1),modal.getRoot().on(_modal_events.default.save,(function(){window.location.href=link.attr("href")+"&sesskey="+_config.default.sesskey+"&confirm=1"})),modal.getRoot().on(_modal_events.default.hidden,(function(){modal.destroy()})),modal.show();case 8:case"end":return _context3.stop()}}),_callee3)}))),function(_x3,_x4){return _ref3.apply(this,arguments)})}));
define("core_badges/selectors",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;
/**
   * Define all of the selectors we will be using on the backpack interface.
   *
   * @module     core_badges/selectors
   * @package    core_badges
   * @copyright  2020 Sara Arjona <sara@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
var name,value,_default={actions:{deletebackpack:(name="action",value="deletebackpack","[data-".concat(name,'="').concat(value,'"]'))},elements:{clearsearch:".input-group-append .clear-icon",main:"#backpacklist",backpackurl:"[data-backpackurl]"}};return _exports.default=_default,_exports.default}));
/**
 * This module is the highest level module for the calendar. It is
 * responsible for initialising all of the components required for
 * the calendar to run. It also coordinates the interaction between
 * components by listening for and responding to different events
 * triggered within the calendar UI.
 *
 * @module     core_calendar/calendar
 * @package    core_calendar
 * @copyright  2017 Simey Lameze <simey@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/calendar",["jquery","core/ajax","core/str","core/templates","core/notification","core/custom_interaction_events","core/modal_events","core/modal_factory","core_calendar/modal_event_form","core_calendar/summary_modal","core_calendar/repository","core_calendar/events","core_calendar/view_manager","core_calendar/crud","core_calendar/selectors"],(function($,Ajax,Str,Templates,Notification,CustomEvents,ModalEvents,ModalFactory,ModalEventForm,SummaryModal,CalendarRepository,CalendarEvents,CalendarViewManager,CalendarCrud,CalendarSelectors){var SELECTORS_DAY="[data-region='day']",SELECTORS_DAY_CONTENT="[data-region='day-content']",SELECTORS_LOADING_ICON=".loading-icon",SELECTORS_VIEW_DAY_LINK="[data-action='view-day-link']",SELECTORS_CALENDAR_MONTH_WRAPPER=".calendarwrapper",handleMoveEvent=function(e,eventId,originElement,destinationElement){var originTimestamp=null,destinationTimestamp=destinationElement.attr("data-day-timestamp");originElement&&(originTimestamp=originElement.attr("data-day-timestamp")),originElement&&originTimestamp==destinationTimestamp||Templates.render("core/loading",{}).then((function(html,js){destinationElement.find(SELECTORS_DAY_CONTENT).addClass("hidden"),Templates.appendNodeContents(destinationElement,html,js),originElement&&(originElement.find(SELECTORS_DAY_CONTENT).addClass("hidden"),Templates.appendNodeContents(originElement,html,js))})).then((function(){return CalendarRepository.updateEventStartDay(eventId,destinationTimestamp)})).then((function(){$("body").trigger(CalendarEvents.eventMoved,[eventId,originElement,destinationElement])})).always((function(){var destinationLoadingElement=destinationElement.find(SELECTORS_LOADING_ICON);if(destinationElement.find(SELECTORS_DAY_CONTENT).removeClass("hidden"),Templates.replaceNode(destinationLoadingElement,"",""),originElement){var originLoadingElement=originElement.find(SELECTORS_LOADING_ICON);originElement.find(SELECTORS_DAY_CONTENT).removeClass("hidden"),Templates.replaceNode(originLoadingElement,"","")}})).fail(Notification.exception)},registerEventListeners=function(root){root.on("click",SELECTORS_VIEW_DAY_LINK,(function(e){var dayLink=$(e.target),year=dayLink.data("year"),month=dayLink.data("month"),day=dayLink.data("day"),courseId=dayLink.data("courseid"),categoryId=dayLink.data("categoryid");CalendarViewManager.refreshDayContent(root,year,month,day,courseId,categoryId,root,"core_calendar/calendar_day").then((function(){e.preventDefault();var url="?view=day&time="+dayLink.data("timestamp");return window.history.pushState({},"",url)})).fail(Notification.exception)})),root.on("change",CalendarSelectors.elements.courseSelector,(function(){var courseId=$(this).val();CalendarViewManager.reloadCurrentMonth(root,courseId,null).then((function(){return root.find(CalendarSelectors.elements.courseSelector).val(courseId)})).fail(Notification.exception)}));var eventFormPromise=CalendarCrud.registerEventFormModal(root),contextId=$(SELECTORS_CALENDAR_MONTH_WRAPPER).data("context-id");!function(root,eventFormModalPromise){var body=$("body");body.on(CalendarEvents.created,(function(){CalendarViewManager.reloadCurrentMonth(root)})),body.on(CalendarEvents.deleted,(function(){CalendarViewManager.reloadCurrentMonth(root)})),body.on(CalendarEvents.updated,(function(){CalendarViewManager.reloadCurrentMonth(root)})),body.on(CalendarEvents.editActionEvent,(function(e,url){window.location.assign(url)})),body.on(CalendarEvents.moveEvent,handleMoveEvent),body.on(CalendarEvents.eventMoved,(function(){CalendarViewManager.reloadCurrentMonth(root)})),CalendarCrud.registerEditListeners(root,eventFormModalPromise)}(root,eventFormPromise),contextId&&root.on("click",SELECTORS_DAY,(function(e){var target=$(e.target);if(!target.is(SELECTORS_VIEW_DAY_LINK)){var startTime=$(this).attr("data-new-event-timestamp");eventFormPromise.then((function(modal){var wrapper=target.closest(CalendarSelectors.wrapper);modal.setCourseId(wrapper.data("courseid"));var categoryId=wrapper.data("categoryid");void 0!==categoryId&&modal.setCategoryId(categoryId),modal.setContextId(wrapper.data("contextId")),modal.setStartTime(startTime),modal.show()})).fail(Notification.exception),e.preventDefault()}}))};return{init:function(root){root=$(root),CalendarViewManager.init(root),registerEventListeners(root)}}}));
/**
 * Contain the events the calendar component can fire.
 *
 * @module     core_calendar/events
 * @class      calendar_events
 * @package    core_calendar
 * @copyright  2017 Simey Lameze <simey@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/events",[],(function(){return{created:"calendar-events:created",deleted:"calendar-events:deleted",deleteAll:"calendar-events:delete_all",updated:"calendar-events:updated",editEvent:"calendar-events:edit_event",editActionEvent:"calendar-events:edit_action_event",eventMoved:"calendar-events:event_moved",dayChanged:"calendar-events:day_changed",monthChanged:"calendar-events:month_changed",moveEvent:"calendar-events:move_event",filterChanged:"calendar-events:filter_changed",viewUpdated:"calendar-events:view_updated"}}));
/**
 * A javascript module to store calendar drag and drop data.
 *
 * This module is unfortunately required because of the limitations
 * of the HTML5 drag and drop API and it's ability to provide data
 * between the different stages of the drag/drop lifecycle.
 *
 * @module     core_calendar/drag_drop_data_store
 * @package    core_calendar
 * @copyright  2017 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/drag_drop_data_store",[],(function(){var eventId=null,durationDays=null,minTimestart=null,maxTimestart=null,minError=null,maxError=null,setEventId=function(id){eventId=id},setDurationDays=function(days){durationDays=days},setMinTimestart=function(timestamp){minTimestart=timestamp},setMaxTimestart=function(timestamp){maxTimestart=timestamp},setMinError=function(message){minError=message},setMaxError=function(message){maxError=message};return{setEventId:setEventId,getEventId:function(){return eventId},hasEventId:function(){return null!==eventId},setDurationDays:setDurationDays,getDurationDays:function(){return durationDays},setMinTimestart:setMinTimestart,getMinTimestart:function(){return minTimestart},hasMinTimestart:function(){return null!==minTimestart},setMaxTimestart:setMaxTimestart,getMaxTimestart:function(){return maxTimestart},hasMaxTimestart:function(){return null!==maxTimestart},setMinError:setMinError,getMinError:function(){return minError},setMaxError:setMaxError,getMaxError:function(){return maxError},clearAll:function(){setEventId(null),setDurationDays(null),setMinTimestart(null),setMaxTimestart(null),setMinError(null),setMaxError(null)}}}));
/**
 * Contain the logic for the quick add or update event modal.
 *
 * @module     calendar/modal_quick_add_event
 * @class      modal_quick_add_event
 * @package    core
 * @copyright  2017 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/modal_event_form",["jquery","core/event","core/str","core/notification","core/templates","core/custom_interaction_events","core/modal","core/modal_registry","core/fragment","core_calendar/events","core_calendar/repository"],(function($,Event,Str,Notification,Templates,CustomEvents,Modal,ModalRegistry,Fragment,CalendarEvents,Repository){var registered=!1,SELECTORS_SAVE_BUTTON='[data-action="save"]',SELECTORS_LOADING_ICON_CONTAINER='[data-region="loading-icon-container"]',ModalEventForm=function(root){Modal.call(this,root),this.eventId=null,this.startTime=null,this.courseId=null,this.categoryId=null,this.contextId=null,this.reloadingBody=!1,this.reloadingTitle=!1,this.saveButton=this.getFooter().find(SELECTORS_SAVE_BUTTON)};return ModalEventForm.TYPE="core_calendar-modal_event_form",(ModalEventForm.prototype=Object.create(Modal.prototype)).constructor=ModalEventForm,ModalEventForm.prototype.setContextId=function(id){this.contextId=id},ModalEventForm.prototype.getContextId=function(){return this.contextId},ModalEventForm.prototype.setCourseId=function(id){this.courseId=id},ModalEventForm.prototype.getCourseId=function(){return this.courseId},ModalEventForm.prototype.setCategoryId=function(id){this.categoryId=id},ModalEventForm.prototype.getCategoryId=function(){return this.categoryId},ModalEventForm.prototype.hasCourseId=function(){return null!==this.courseId},ModalEventForm.prototype.hasCategoryId=function(){return null!==this.categoryId},ModalEventForm.prototype.setEventId=function(id){this.eventId=id},ModalEventForm.prototype.getEventId=function(){return this.eventId},ModalEventForm.prototype.hasEventId=function(){return null!==this.eventId},ModalEventForm.prototype.setStartTime=function(time){this.startTime=time},ModalEventForm.prototype.getStartTime=function(){return this.startTime},ModalEventForm.prototype.hasStartTime=function(){return null!==this.startTime},ModalEventForm.prototype.getForm=function(){return this.getBody().find("form")},ModalEventForm.prototype.disableButtons=function(){this.saveButton.prop("disabled",!0)},ModalEventForm.prototype.enableButtons=function(){this.saveButton.prop("disabled",!1)},ModalEventForm.prototype.reloadTitleContent=function(){return this.reloadingTitle||(this.reloadingTitle=!0,this.hasEventId()?this.titlePromise=Str.get_string("editevent","calendar"):this.titlePromise=Str.get_string("newevent","calendar"),this.titlePromise.then(function(string){return this.setTitle(string),string}.bind(this)).always(function(){this.reloadingTitle=!1}.bind(this)).fail(Notification.exception)),this.titlePromise},ModalEventForm.prototype.reloadBodyContent=function(formData){if(this.reloadingBody)return this.bodyPromise;this.reloadingBody=!0,this.disableButtons();var args={};return this.hasEventId()&&(args.eventid=this.getEventId()),this.hasStartTime()&&(args.starttime=this.getStartTime()),this.hasCourseId()&&(args.courseid=this.getCourseId()),this.hasCategoryId()&&(args.categoryid=this.getCategoryId()),void 0!==formData&&(args.formdata=formData),this.bodyPromise=Fragment.loadFragment("calendar","event_form",this.getContextId(),args),this.setBody(this.bodyPromise),this.bodyPromise.then(function(){this.enableButtons()}.bind(this)).fail(Notification.exception).always(function(){this.reloadingBody=!1}.bind(this)).fail(Notification.exception),this.bodyPromise},ModalEventForm.prototype.reloadAllContent=function(){return $.when(this.reloadTitleContent(),this.reloadBodyContent())},ModalEventForm.prototype.show=function(){this.reloadAllContent(),Modal.prototype.show.call(this)},ModalEventForm.prototype.hide=function(){Modal.prototype.hide.call(this),this.setEventId(null),this.setStartTime(null),this.setCourseId(null),this.setCategoryId(null)},ModalEventForm.prototype.getFormData=function(){return this.getForm().serialize()},ModalEventForm.prototype.save=function(){var invalid,loadingContainer=this.saveButton.find(SELECTORS_LOADING_ICON_CONTAINER);if(!(invalid=this.getForm().find('[aria-invalid="true"]')).length){loadingContainer.removeClass("hidden"),this.disableButtons();var formData=this.getFormData();return Repository.submitCreateUpdateForm(formData).then(function(response){if(response.validationerror)this.reloadBodyContent(formData);else{var isExisting=this.hasEventId();this.hide(),isExisting?$("body").trigger(CalendarEvents.updated,[response.event]):$("body").trigger(CalendarEvents.created,[response.event])}}.bind(this)).always(function(){loadingContainer.addClass("hidden"),this.enableButtons()}.bind(this)).fail(Notification.exception)}invalid.first().focus()},ModalEventForm.prototype.registerEventListeners=function(){Modal.prototype.registerEventListeners.call(this),this.getModal().on(CustomEvents.events.activate,SELECTORS_SAVE_BUTTON,function(e,data){this.getForm().submit(),data.originalEvent.preventDefault(),e.stopPropagation()}.bind(this)),this.getModal().on("submit",function(e){Event.notifyFormSubmitAjax(this.getForm()[0]),this.save(),e.preventDefault(),e.stopPropagation()}.bind(this))},registered||(ModalRegistry.register(ModalEventForm.TYPE,ModalEventForm,"calendar/modal_event_form"),registered=!0),ModalEventForm}));
/**
 * A module to handle CRUD operations within the UI.
 *
 * @module     core_calendar/crud
 * @package    core_calendar
 * @copyright  2017 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/crud",["jquery","core/str","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/modal_factory","core/modal_events","core_calendar/modal_event_form","core_calendar/repository","core_calendar/events","core_calendar/modal_delete","core_calendar/selectors","core/pending"],(function($,Str,Notification,CustomEvents,Modal,ModalRegistry,ModalFactory,ModalEvents,ModalEventForm,CalendarRepository,CalendarEvents,ModalDelete,CalendarSelectors,Pending){return{registerRemove:function(root){root.on("click",CalendarSelectors.actions.remove,(function(e){var eventSource=$(this).closest(CalendarSelectors.eventItem);!function(eventId,eventTitle,eventCount){var deletePromise,pendingPromise=new Pending("core_calendar/crud:confirmDeletion"),deleteStrings=[{key:"deleteevent",component:"calendar"}],isRepeatedEvent=(eventCount=parseInt(eventCount,10))>1;isRepeatedEvent?(deleteStrings.push({key:"confirmeventseriesdelete",component:"calendar",param:{name:eventTitle,count:eventCount}}),deletePromise=ModalFactory.create({type:ModalDelete.TYPE})):(deleteStrings.push({key:"confirmeventdelete",component:"calendar",param:eventTitle}),deletePromise=ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL}));var stringsPromise=Str.get_strings(deleteStrings);$.when(stringsPromise,deletePromise).then((function(strings,deleteModal){return deleteModal.setRemoveOnClose(!0),deleteModal.setTitle(strings[0]),deleteModal.setBody(strings[1]),isRepeatedEvent||deleteModal.setSaveButtonText(strings[0]),deleteModal.show(),deleteModal.getRoot().on(ModalEvents.save,(function(){var pendingPromise=new Pending("calendar/crud:initModal:deletedevent");CalendarRepository.deleteEvent(eventId,!1).then((function(){$("body").trigger(CalendarEvents.deleted,[eventId,!1])})).then(pendingPromise.resolve).catch(Notification.exception)})),deleteModal.getRoot().on(CalendarEvents.deleteAll,(function(){var pendingPromise=new Pending("calendar/crud:initModal:deletedallevent");CalendarRepository.deleteEvent(eventId,!0).then((function(){$("body").trigger(CalendarEvents.deleted,[eventId,!0])})).then(pendingPromise.resolve).catch(Notification.exception)})),deleteModal})).then((function(modal){return pendingPromise.resolve(),modal})).catch(Notification.exception)}(eventSource.data("eventId"),eventSource.data("eventTitle"),eventSource.data("eventCount")),e.preventDefault()}))},registerEditListeners:function(root,eventFormModalPromise){var pendingPromise=new Pending("core_calendar/crud:registerEditListeners");return eventFormModalPromise.then((function(modal){return $("body").on(CalendarEvents.editEvent,(function(e,eventId){var calendarWrapper=root.find(CalendarSelectors.wrapper);modal.setEventId(eventId),modal.setContextId(calendarWrapper.data("contextId")),modal.show(),e.stopImmediatePropagation()})),modal})).then((function(modal){return pendingPromise.resolve(),modal})).catch(Notification.exception)},registerEventFormModal:function(root){var eventFormPromise=ModalFactory.create({type:ModalEventForm.TYPE,large:!0});return root.on("click",CalendarSelectors.actions.create,(function(e){eventFormPromise.then((function(modal){var wrapper=root.find(CalendarSelectors.wrapper),categoryId=wrapper.data("categoryid");void 0!==categoryId&&modal.setCategoryId(categoryId);var today=root.find(CalendarSelectors.today),firstDay=root.find(CalendarSelectors.day);!today.length&&firstDay.length&&modal.setStartTime(firstDay.data("newEventTimestamp")),modal.setContextId(wrapper.data("contextId")),modal.setCourseId(wrapper.data("courseid")),modal.show()})).fail(Notification.exception),e.preventDefault()})),root.on("click",CalendarSelectors.actions.edit,(function(e){e.preventDefault();var target=$(e.currentTarget),calendarWrapper=target.closest(CalendarSelectors.wrapper),eventWrapper=target.closest(CalendarSelectors.eventItem);eventFormPromise.then((function(modal){modal.setEventId(eventWrapper.data("eventId")),modal.setContextId(calendarWrapper.data("contextId")),modal.show(),e.stopImmediatePropagation()})).fail(Notification.exception)})),eventFormPromise}}}));
/**
 * Contain the logic for the save/cancel modal.
 *
 * @module     core_calendar/modal_delete
 * @class      modal_delete
 * @package    core_calendar
 * @copyright  2017 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/modal_delete",["jquery","core/notification","core/custom_interaction_events","core/modal","core/modal_events","core/modal_registry","core_calendar/events"],(function($,Notification,CustomEvents,Modal,ModalEvents,ModalRegistry,CalendarEvents){var registered=!1,SELECTORS_DELETE_ONE_BUTTON='[data-action="deleteone"]',SELECTORS_DELETE_ALL_BUTTON='[data-action="deleteall"]',SELECTORS_CANCEL_BUTTON='[data-action="cancel"]',ModalDelete=function(root){Modal.call(this,root),this.setRemoveOnClose(!0)};return ModalDelete.TYPE="core_calendar-modal_delete",(ModalDelete.prototype=Object.create(Modal.prototype)).constructor=ModalDelete,ModalDelete.prototype.registerEventListeners=function(){Modal.prototype.registerEventListeners.call(this),this.getModal().on(CustomEvents.events.activate,SELECTORS_DELETE_ONE_BUTTON,function(e,data){var saveEvent=$.Event(ModalEvents.save);this.getRoot().trigger(saveEvent,this),saveEvent.isDefaultPrevented()||(this.hide(),data.originalEvent.preventDefault())}.bind(this)),this.getModal().on(CustomEvents.events.activate,SELECTORS_DELETE_ALL_BUTTON,function(e,data){var saveEvent=$.Event(CalendarEvents.deleteAll);this.getRoot().trigger(saveEvent,this),saveEvent.isDefaultPrevented()||(this.hide(),data.originalEvent.preventDefault())}.bind(this)),this.getModal().on(CustomEvents.events.activate,SELECTORS_CANCEL_BUTTON,function(e,data){var cancelEvent=$.Event(ModalEvents.cancel);this.getRoot().trigger(cancelEvent,this),cancelEvent.isDefaultPrevented()||(this.hide(),data.originalEvent.preventDefault())}.bind(this))},registered||(ModalRegistry.register(ModalDelete.TYPE,ModalDelete,"calendar/event_delete_modal"),registered=!0),ModalDelete}));
/**
 * A javascript module to handle summary modal.
 *
 * @module     core_calendar/summary_modal
 * @package    core_calendar
 * @copyright  2017 Simey Lameze <simey@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/summary_modal",["jquery","core/str","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/modal_factory","core/modal_events","core_calendar/repository","core_calendar/events","core_calendar/crud"],(function($,Str,Notification,CustomEvents,Modal,ModalRegistry,ModalFactory,ModalEvents,CalendarRepository,CalendarEvents,CalendarCrud){var registered=!1,SELECTORS_ROOT="[data-region='summary-modal-container']",SELECTORS_EDIT_BUTTON='[data-action="edit"]',SELECTORS_DELETE_BUTTON='[data-action="delete"]',ModalEventSummary=function(root){Modal.call(this,root)};return ModalEventSummary.TYPE="core_calendar-event_summary",(ModalEventSummary.prototype=Object.create(Modal.prototype)).constructor=ModalEventSummary,ModalEventSummary.prototype.getEditButton=function(){return void 0===this.editButton&&(this.editButton=this.getFooter().find(SELECTORS_EDIT_BUTTON)),this.editButton},ModalEventSummary.prototype.getDeleteButton=function(){return void 0===this.deleteButton&&(this.deleteButton=this.getFooter().find(SELECTORS_DELETE_BUTTON)),this.deleteButton},ModalEventSummary.prototype.getEventId=function(){return this.getBody().find(SELECTORS_ROOT).attr("data-event-id")},ModalEventSummary.prototype.getEventTitle=function(){return this.getBody().find(SELECTORS_ROOT).attr("data-event-title")},ModalEventSummary.prototype.getEventCount=function(){return this.getBody().find(SELECTORS_ROOT).attr("data-event-count")},ModalEventSummary.prototype.getEditUrl=function(){return this.getBody().find(SELECTORS_ROOT).attr("data-edit-url")},ModalEventSummary.prototype.isActionEvent=function(){return"true"==this.getBody().find(SELECTORS_ROOT).attr("data-action-event")},ModalEventSummary.prototype.registerEventListeners=function(){Modal.prototype.registerEventListeners.call(this),M.util.js_pending("core_calendar/summary_modal:registerEventListeners:bodyRendered"),this.getRoot().on(ModalEvents.bodyRendered,function(){this.getModal().data({eventTitle:this.getEventTitle(),eventId:this.getEventId(),eventCount:this.getEventCount()}).attr("data-type","event"),CalendarCrud.registerRemove(this.getModal()),M.util.js_complete("core_calendar/summary_modal:registerEventListeners:bodyRendered")}.bind(this)),$("body").on(CalendarEvents.deleted,function(){this.hide()}.bind(this)),CustomEvents.define(this.getEditButton(),[CustomEvents.events.activate]),this.getEditButton().on(CustomEvents.events.activate,function(e,data){this.isActionEvent()?$("body").trigger(CalendarEvents.editActionEvent,[this.getEditUrl()]):$("body").trigger(CalendarEvents.editEvent,[this.getEventId()]),this.hide(),e.preventDefault(),e.stopPropagation(),data.originalEvent.preventDefault(),data.originalEvent.stopPropagation()}.bind(this))},registered||(ModalRegistry.register(ModalEventSummary.TYPE,ModalEventSummary,"core_calendar/event_summary_modal"),registered=!0),ModalEventSummary}));
/**
 * This module is responsible for the calendar filter.
 *
 * @module     core_calendar/calendar_filter
 * @package    core_calendar
 * @copyright  2017 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/calendar_filter",["jquery","core_calendar/selectors","core_calendar/events","core/str","core/templates"],(function($,CalendarSelectors,CalendarEvents,Str,Templates){var toggleFilter=function(target){var data=getFilterData(target);return data.hidden=!data.hidden,M.util.js_pending("core_calendar/calendar_filter:toggleFilter"),Str.get_string("eventtype"+data.eventtype,"calendar").then((function(nameStr){return data.name=nameStr,data.icon=!0,data.key="i/"+data.eventtype+"event",data.component="core",data})).then((function(context){return Templates.render("core_calendar/event_filter_key",context)})).then((function(html,js){return Templates.replaceNode(target,html,js)})).then((function(){fireFilterChangedEvent(data),M.util.js_complete("core_calendar/calendar_filter:toggleFilter")}))},fireFilterChangedEvent=function(data){M.util.js_pending("month-mini-filterChanged"),$("body").trigger(CalendarEvents.filterChanged,{type:data.eventtype,hidden:data.hidden}),M.util.js_complete("month-mini-filterChanged")},getFilterData=function(target){return{eventtype:target.data("eventtype"),hidden:target.data("eventtype-hidden")}};return{init:function(root){!function(root){root.on("click",CalendarSelectors.eventFilterItem,(function(e){var target=$(e.currentTarget);toggleFilter(target),e.preventDefault()})),$("body").on(CalendarEvents.viewUpdated,(function(){root.find(CalendarSelectors.eventFilterItem).each((function(i,filter){if((filter=$(filter)).data("eventtype-hidden")){var data=getFilterData(filter);fireFilterChangedEvent(data)}}))}))}(root=$(root))}}}));
/**
 * A javascript module to handle calendar drag and drop in the calendar
 * month view navigation.
 *
 * This code is run each time the calendar month view is re-rendered. We
 * only register the event handlers once per page load so that the in place
 * DOM updates that happen on month change don't continue to register handlers.
 *
 * @module     core_calendar/month_navigation_drag_drop
 * @class      month_navigation_drag_drop
 * @package    core_calendar
 * @copyright  2017 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/month_navigation_drag_drop",["jquery","core_calendar/drag_drop_data_store"],(function($,DataStore){var SELECTORS_DRAGGABLE='[draggable="true"][data-region="event-item"]',SELECTORS_DROP_ZONE='[data-drop-zone="nav-link"]',registered=!1,hoverTimer=null,root=null,updateHoverState=function(target,hovered){hovered?target.addClass("bg-primary text-white"):target.removeClass("bg-primary text-white")},addDropZoneIndicator=function(){root.find(SELECTORS_DROP_ZONE).addClass("drop-target")},removeDropZoneIndicator=function(){root.find(SELECTORS_DROP_ZONE).removeClass("drop-target")},getTargetFromEvent=function(e){var target=$(e.target).closest(SELECTORS_DROP_ZONE);return target.length?target:null},dragstartHandler=function(e){$(e.target).closest(SELECTORS_DRAGGABLE).length&&addDropZoneIndicator()},dragoverHandler=function(e){if(DataStore.hasEventId()){e.preventDefault();var target=getTargetFromEvent(e);target&&DataStore.hasEventId()&&(hoverTimer||(hoverTimer=setTimeout((function(){target.click(),hoverTimer=null}),1e3)),updateHoverState(target,!0),removeDropZoneIndicator())}},dragleaveHandler=function(e){if(DataStore.hasEventId()){var target=getTargetFromEvent(e);target&&(hoverTimer&&(clearTimeout(hoverTimer),hoverTimer=null),updateHoverState(target,!1),addDropZoneIndicator(),e.preventDefault())}},dropHandler=function(e){if(DataStore.hasEventId()){removeDropZoneIndicator();var target=getTargetFromEvent(e);target&&(updateHoverState(target,!1),e.preventDefault())}};return{init:function(rootElement){registered||(document.addEventListener("dragstart",dragstartHandler,!1),document.addEventListener("dragover",dragoverHandler,!1),document.addEventListener("dragleave",dragleaveHandler,!1),document.addEventListener("drop",dropHandler,!1),document.addEventListener("dragend",removeDropZoneIndicator,!1),registered=!0),root=$(rootElement),DataStore.hasEventId()&&addDropZoneIndicator()}}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core_calendar/view_manager",["exports","jquery","core/templates","core/notification","core_calendar/repository","core_calendar/events","core_calendar/selectors","core/modal_factory","core/modal_events","core_calendar/summary_modal","core/custom_interaction_events","core/pending"],(function(_exports,_jquery,_templates,_notification,CalendarRepository,_events,CalendarSelectors,_modal_factory,_modal_events,_summary_modal,_custom_interaction_events,_pending){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * A javascript module to handler calendar view changes.
   *
   * @module     core_calendar/view_manager
   * @package    core_calendar
   * @copyright  2017 Andrew Nicols <andrew@nicols.co.uk>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.reloadCurrentUpcoming=_exports.reloadCurrentMonth=_exports.reloadCurrentDay=_exports.refreshMonthContent=_exports.refreshDayContent=_exports.init=_exports.changeMonth=_exports.changeDay=void 0,_jquery=_interopRequireDefault(_jquery),_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification),CalendarRepository=_interopRequireWildcard(CalendarRepository),_events=_interopRequireDefault(_events),CalendarSelectors=_interopRequireWildcard(CalendarSelectors),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_summary_modal=_interopRequireDefault(_summary_modal),_custom_interaction_events=_interopRequireDefault(_custom_interaction_events),_pending=_interopRequireDefault(_pending);var refreshMonthContent=function(root,year,month,courseId,categoryId){var target=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,template=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",day=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1;startLoading(root),target=target||root.find(CalendarSelectors.wrapper),template=template||root.attr("data-template"),M.util.js_pending([root.get("id"),year,month,courseId].join("-"));var includenavigation=root.data("includenavigation"),mini=root.data("mini");return CalendarRepository.getCalendarMonthData(year,month,courseId,categoryId,includenavigation,mini,day).then((function(context){return context.viewingmonth=!0,_templates.default.render(template,context)})).then((function(html,js){return _templates.default.replaceNode(target,html,js)})).then((function(){document.querySelector("body").dispatchEvent(new CustomEvent(_events.default.viewUpdated))})).always((function(){return M.util.js_complete([root.get("id"),year,month,courseId].join("-")),stopLoading(root)})).fail(_notification.default.exception)};_exports.refreshMonthContent=refreshMonthContent;var changeMonth=function(root,url,year,month,courseId,categoryId){var day=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return refreshMonthContent(root,year,month,courseId,categoryId,null,"",day).then((function(){url.length&&"#"!==url&&window.history.pushState({},"",url);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return args})).then((function(){(0,_jquery.default)("body").trigger(_events.default.monthChanged,[year,month,courseId,categoryId]);for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];return args}))};_exports.changeMonth=changeMonth;_exports.reloadCurrentMonth=function(root){var courseId=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,categoryId=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,year=root.find(CalendarSelectors.wrapper).data("year"),month=root.find(CalendarSelectors.wrapper).data("month"),day=root.find(CalendarSelectors.wrapper).data("day");return courseId=courseId||root.find(CalendarSelectors.wrapper).data("courseid"),categoryId=categoryId||root.find(CalendarSelectors.wrapper).data("categoryid"),refreshMonthContent(root,year,month,courseId,categoryId,null,"",day)};var refreshDayContent=function(root,year,month,day,courseId,categoryId){var target=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,template=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"";startLoading(root),target=target||root.find(CalendarSelectors.wrapper),template=template||root.attr("data-template"),M.util.js_pending([root.get("id"),year,month,day,courseId,categoryId].join("-"));var includenavigation=root.data("includenavigation");return CalendarRepository.getCalendarDayData(year,month,day,courseId,categoryId,includenavigation).then((function(context){return context.viewingday=!0,_templates.default.render(template,context)})).then((function(html,js){return _templates.default.replaceNode(target,html,js)})).then((function(){document.querySelector("body").dispatchEvent(new CustomEvent(_events.default.viewUpdated))})).always((function(){return M.util.js_complete([root.get("id"),year,month,day,courseId,categoryId].join("-")),stopLoading(root)})).fail(_notification.default.exception)};_exports.refreshDayContent=refreshDayContent;_exports.reloadCurrentDay=function(root){var courseId=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,categoryId=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,wrapper=root.find(CalendarSelectors.wrapper),year=wrapper.data("year"),month=wrapper.data("month"),day=wrapper.data("day");return courseId=courseId||root.find(CalendarSelectors.wrapper).data("courseid"),categoryId=categoryId||root.find(CalendarSelectors.wrapper).data("categoryid"),refreshDayContent(root,year,month,day,courseId,categoryId)};var changeDay=function(root,url,year,month,day,courseId,categoryId){return refreshDayContent(root,year,month,day,courseId,categoryId).then((function(){url.length&&"#"!==url&&window.history.pushState({},"",url);for(var _len3=arguments.length,args=new Array(_len3),_key3=0;_key3<_len3;_key3++)args[_key3]=arguments[_key3];return args})).then((function(){(0,_jquery.default)("body").trigger(_events.default.dayChanged,[year,month,courseId,categoryId]);for(var _len4=arguments.length,args=new Array(_len4),_key4=0;_key4<_len4;_key4++)args[_key4]=arguments[_key4];return args}))};_exports.changeDay=changeDay;var startLoading=function(root){root.find(CalendarSelectors.containers.loadingIcon).removeClass("hidden")},stopLoading=function(root){root.find(CalendarSelectors.containers.loadingIcon).addClass("hidden")},reloadCurrentUpcoming=function(root){var courseId=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,categoryId=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,target=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,template=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return startLoading(root),target=target||root.find(CalendarSelectors.wrapper),template=template||root.attr("data-template"),courseId=courseId||root.find(CalendarSelectors.wrapper).data("courseid"),categoryId=categoryId||root.find(CalendarSelectors.wrapper).data("categoryid"),CalendarRepository.getCalendarUpcomingData(courseId,categoryId).then((function(context){return context.viewingupcoming=!0,_templates.default.render(template,context)})).then((function(html,js){return _templates.default.replaceNode(target,html,js)})).then((function(){document.querySelector("body").dispatchEvent(new CustomEvent(_events.default.viewUpdated))})).always((function(){return stopLoading(root)})).fail(_notification.default.exception)};_exports.reloadCurrentUpcoming=reloadCurrentUpcoming;var renderEventSummaryModal=function(eventId){var pendingPromise=new _pending.default("core_calendar/view_manager:renderEventSummaryModal");return CalendarRepository.getEventById(eventId).then((function(getEventResponse){if(!getEventResponse.event)throw new Error("Error encountered while trying to fetch calendar event with ID: "+eventId);return getEventResponse.event})).then((function(eventData){var eventType,modalParams={title:eventData.name,type:_summary_modal.default.TYPE,body:_templates.default.render("core_calendar/event_summary_body",eventData),templateContext:{canedit:eventData.canedit,candelete:eventData.candelete,headerclasses:(eventType=eventData.normalisedeventtype,"calendar_event_"+eventType),isactionevent:eventData.isactionevent,url:eventData.url,action:eventData.action}};return _modal_factory.default.create(modalParams)})).then((function(modal){return modal.getRoot().on(_modal_events.default.hidden,(function(){modal.destroy()})),modal.show(),modal})).then((function(modal){return pendingPromise.resolve(),modal})).catch(_notification.default.exception)};_exports.init=function(root,view){!function(root){(root=(0,_jquery.default)(root)).on("click",CalendarSelectors.links.eventLink,(function(e){var target=e.target,eventLink=null,eventId=null,pendingPromise=new _pending.default("core_calendar/view_manager:eventLink:click");(eventId=(eventLink=target.matches(CalendarSelectors.actions.viewEvent)?target:target.closest(CalendarSelectors.actions.viewEvent))?eventLink.dataset.eventId:target.querySelector(CalendarSelectors.actions.viewEvent).dataset.eventId)?(e.preventDefault(),e.stopPropagation(),renderEventSummaryModal(eventId).then(pendingPromise.resolve).catch()):pendingPromise.resolve()})),root.on("click",CalendarSelectors.links.navLink,(function(e){var wrapper=root.find(CalendarSelectors.wrapper),view=wrapper.data("view"),courseId=wrapper.data("courseid"),categoryId=wrapper.data("categoryid"),link=e.currentTarget;"month"===view?(changeMonth(root,link.href,link.dataset.year,link.dataset.month,courseId,categoryId,link.dataset.day),e.preventDefault()):"day"===view&&(changeDay(root,link.href,link.dataset.year,link.dataset.month,link.dataset.day,courseId,categoryId),e.preventDefault())}));var viewSelector=root.find(CalendarSelectors.viewSelector);_custom_interaction_events.default.define(viewSelector,[_custom_interaction_events.default.events.activate]),viewSelector.on(_custom_interaction_events.default.events.activate,(function(e){e.preventDefault();var option=e.target;if(!option.classList.contains("active")){var view=option.dataset.view,year=option.dataset.year,month=option.dataset.month,day=option.dataset.day,courseId=option.dataset.courseid,categoryId=option.dataset.categoryid;"month"==view?refreshMonthContent(root,year,month,courseId,categoryId,root,"core_calendar/calendar_month",day).then((function(){return window.history.pushState({},"","?view=month")})).fail(_notification.default.exception):"day"==view?refreshDayContent(root,year,month,day,courseId,categoryId,root,"core_calendar/calendar_day").then((function(){return window.history.pushState({},"","?view=day")})).fail(_notification.default.exception):"upcoming"==view&&reloadCurrentUpcoming(root,courseId,categoryId,root,"core_calendar/calendar_upcoming").then((function(){return window.history.pushState({},"","?view=upcoming")})).fail(_notification.default.exception)}}))}(root)}}));
/**
 * A javascript module to handle calendar drag and drop in the calendar
 * month view.
 *
 * @module     core_calendar/month_view_drag_drop
 * @class      month_view_drag_drop
 * @package    core_calendar
 * @copyright  2017 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/month_view_drag_drop",["jquery","core/notification","core/str","core_calendar/events","core_calendar/drag_drop_data_store"],(function($,Notification,Str,CalendarEvents,DataStore){var SELECTORS_ROOT="[data-region='calendar']",SELECTORS_DRAGGABLE='[draggable="true"][data-region="event-item"]',SELECTORS_DROP_ZONE='[data-drop-zone="month-view-day"]',SELECTORS_WEEK='[data-region="month-view-week"]',ALL_CLASSES="bg-faded bg-danger text-white bg-primary text-white",registered=!1,getDropZoneFromEvent=function(e){var dropZone=$(e.target).closest(SELECTORS_DROP_ZONE);return dropZone.length?dropZone:null},isValidDropZone=function(dropZone){var dropTimestamp=dropZone.attr("data-day-timestamp"),minTimestart=DataStore.getMinTimestart(),maxTimestart=DataStore.getMaxTimestart();return!(minTimestart&&minTimestart>dropTimestamp)&&!(maxTimestart&&maxTimestart<dropTimestamp)},clearAllDropZonesState=function(){$(SELECTORS_ROOT).find(SELECTORS_DROP_ZONE).each((function(index,dropZone){(dropZone=$(dropZone)).removeClass(ALL_CLASSES)}))},updateHoverState=function updateHoverState(dropZone,hovered,count){void 0===count&&(count=DataStore.getDurationDays());var valid=isValidDropZone(dropZone);if(dropZone.removeClass(ALL_CLASSES),hovered?valid?dropZone.addClass("bg-primary text-white"):dropZone.addClass("bg-danger text-white"):(dropZone.removeClass("bg-primary text-white bg-danger text-white"),valid||dropZone.addClass("bg-faded")),--count>0){var nextDropZone=dropZone.next();if(!nextDropZone.length){var nextWeek=dropZone.closest(SELECTORS_WEEK).next();nextWeek.length&&(nextDropZone=nextWeek.children(SELECTORS_DROP_ZONE).first())}nextDropZone.length&&updateHoverState(nextDropZone,hovered,count)}},updateAllDropZonesState=function(){$(SELECTORS_ROOT).find(SELECTORS_DROP_ZONE).each((function(index,dropZone){dropZone=$(dropZone),isValidDropZone(dropZone)||updateHoverState(dropZone,!1)}))},dragstartHandler=function(e){var draggableElement=$(e.target).closest(SELECTORS_DRAGGABLE);if(draggableElement.length){var eventId=draggableElement.find("[data-event-id]").attr("data-event-id"),minTimestart=draggableElement.attr("data-min-day-timestamp"),maxTimestart=draggableElement.attr("data-max-day-timestamp"),minError=draggableElement.attr("data-min-day-error"),maxError=draggableElement.attr("data-max-day-error"),duration=$(SELECTORS_ROOT+' [data-event-id="'+eventId+'"]').length;DataStore.setEventId(eventId),DataStore.setDurationDays(duration),minTimestart&&DataStore.setMinTimestart(minTimestart),maxTimestart&&DataStore.setMaxTimestart(maxTimestart),minError&&DataStore.setMinError(minError),maxError&&DataStore.setMaxError(maxError),e.dataTransfer.effectAllowed="move",e.dataTransfer.dropEffect="move",e.dataTransfer.setData("text/plain",eventId),e.dropEffect="move",updateAllDropZonesState()}},dragoverHandler=function(e){if(DataStore.hasEventId()){e.preventDefault();var dropZone=getDropZoneFromEvent(e);dropZone&&updateHoverState(dropZone,!0)}},dragleaveHandler=function(e){if(DataStore.hasEventId()){var dropZone=getDropZoneFromEvent(e);dropZone&&(updateHoverState(dropZone,!1),e.preventDefault())}},dropHandler=function(e){if(DataStore.hasEventId()){var dropZone=getDropZoneFromEvent(e);if(!dropZone)return DataStore.clearAll(),void clearAllDropZonesState();if(isValidDropZone(dropZone)){var eventId=DataStore.getEventId(),eventElement=$(SELECTORS_ROOT+' [data-event-id="'+eventId+'"]'),origin=null;eventElement.length&&(origin=eventElement.closest(SELECTORS_DROP_ZONE)),$("body").trigger(CalendarEvents.moveEvent,[eventId,origin,dropZone])}else{var message=function(dropZone){var dropTimestamp=dropZone.attr("data-day-timestamp"),minTimestart=DataStore.getMinTimestart(),maxTimestart=DataStore.getMaxTimestart();return minTimestart&&minTimestart>dropTimestamp?DataStore.getMinError():maxTimestart&&maxTimestart<dropTimestamp?DataStore.getMaxError():null}(dropZone);Str.get_string("errorinvaliddate","calendar").then((function(string){Notification.exception({name:string,message:message||string})}))}DataStore.clearAll(),clearAllDropZonesState(),e.preventDefault()}},dragendHandler=function(){DataStore.clearAll(),clearAllDropZonesState()},calendarMonthChangedHandler=function(){updateAllDropZonesState()};return{init:function(){registered||(document.addEventListener("dragstart",dragstartHandler,!1),document.addEventListener("dragover",dragoverHandler,!1),document.addEventListener("dragleave",dragleaveHandler,!1),document.addEventListener("drop",dropHandler,!1),document.addEventListener("dragend",dragendHandler,!1),$("body").on(CalendarEvents.monthChanged,calendarMonthChangedHandler),registered=!0)}}}));
/**
 * A javascript module to enhance the event form.
 *
 * @module     core_calendar/event_form
 * @package    core_calendar
 * @copyright  2017 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/event_form",["jquery","core_calendar/repository"],(function($,CalendarRepository){var SELECTORS_EVENT_GROUP_COURSE_ID='[name="groupcourseid"]',SELECTORS_EVENT_GROUP_ID='[name="groupid"]',SELECTORS_SELECT_OPTION="option",addCourseGroupSelectListeners=function(formElement){var courseGroupSelect=formElement.find(SELECTORS_EVENT_GROUP_COURSE_ID);courseGroupSelect.on("change",(function(){var courseId=formElement.find(SELECTORS_EVENT_GROUP_COURSE_ID).val();CalendarRepository.getCourseGroupsData(courseId).then((function(groups){return function(groups){var groupSelect=formElement.find(SELECTORS_EVENT_GROUP_ID),groupSelectOptions=groupSelect.find(SELECTORS_SELECT_OPTION),courseGroups=$(groups);groupSelectOptions.remove(),groupSelect.prop("disabled",!1),courseGroups.each((function(id,group){$(groupSelect).append($("<option></option>").attr("value",group.id).text(group.name))}))}(groups)})).catch(Notification.exception)}))};return{init:function(formId){var formElement=$("#"+formId);addCourseGroupSelectListeners(formElement)}}}));
/**
 * This module handles display of multiple mini calendars in a view, and
 * movement through them.
 *
 * @module     core_calendar/calendar_threemonth
 * @package    core_calendar
 * @copyright  2017 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/calendar_threemonth",["jquery","core/notification","core_calendar/selectors","core_calendar/events","core/templates","core_calendar/view_manager"],(function($,Notification,CalendarSelectors,CalendarEvents,Templates,CalendarViewManager){return{init:function(root){!function(root){$("body").on([CalendarEvents.monthChanged,CalendarEvents.dayChanged].join(" "),(function(e,year,month,courseId,categoryId){root.queue((function(next){return processRequest(e,year,month,courseId,categoryId).then((function(){return next()})).fail(Notification.exception)}))}));var processRequest=function(e,year,month,courseId,categoryId){var newParent=root.find('[data-year="'+year+'"][data-month="'+month+'"]').closest(CalendarSelectors.calendarPeriods.month),allMonths=root.find(CalendarSelectors.calendarPeriods.month),previousMonth=$(allMonths[0]),nextMonth=$(allMonths[2]),placeHolder=$("<span>");placeHolder.attr("data-template","core_calendar/threemonth_month"),placeHolder.attr("data-includenavigation",!1),placeHolder.attr("data-mini",!0);var requestYear,requestMonth,oldMonth,placeHolderContainer=$("<div>");if(placeHolderContainer.hide(),placeHolderContainer.append(placeHolder),newParent.is(previousMonth))placeHolderContainer.insertBefore(previousMonth),requestYear=previousMonth.data("previousYear"),requestMonth=previousMonth.data("previousMonth"),oldMonth=nextMonth;else{if(!newParent.is(nextMonth))return $.Deferred().resolve();placeHolderContainer.insertAfter(nextMonth),requestYear=nextMonth.data("nextYear"),requestMonth=nextMonth.data("nextMonth"),oldMonth=previousMonth}return CalendarViewManager.refreshMonthContent(placeHolder,requestYear,requestMonth,courseId,categoryId,placeHolder).then((function(){var slideUpPromise=$.Deferred(),slideDownPromise=$.Deferred();return oldMonth.slideUp("fast",(function(){$(this).remove(),slideUpPromise.resolve()})),placeHolderContainer.slideDown("fast",(function(){slideDownPromise.resolve()})),$.when(slideUpPromise,slideDownPromise)}))};root.on("click",CalendarSelectors.links.miniDayLink,(function(e){var miniDayLink=$(e.target),year=miniDayLink.data("year"),month=miniDayLink.data("month"),day=miniDayLink.text(),courseId=miniDayLink.data("courseid"),categoryId=miniDayLink.data("categoryid"),calendarRoot=$("body").find(CalendarSelectors.calendarMain);CalendarViewManager.refreshDayContent(calendarRoot,year,month,day,courseId,categoryId,calendarRoot,"core_calendar/calendar_day"),e.preventDefault(),window.history.pushState({},"","?view=day")}))}(root=$(root))}}}));
/**
 * This module is responsible for handle calendar day and upcoming view.
 *
 * @module     core_calendar/calendar
 * @package    core_calendar
 * @copyright  2017 Simey Lameze <simey@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/calendar_view",["jquery","core/str","core/notification","core_calendar/selectors","core_calendar/events","core_calendar/view_manager","core_calendar/repository","core/modal_factory","core_calendar/modal_event_form","core/modal_events","core_calendar/crud"],(function($,Str,Notification,CalendarSelectors,CalendarEvents,CalendarViewManager,CalendarRepository,ModalFactory,ModalEventForm,ModalEvents,CalendarCrud){return{init:function(root,type){root=$(root),CalendarViewManager.init(root,type),function(root,type){var body=$("body");CalendarCrud.registerRemove(root);var reloadFunction="reloadCurrent"+type.charAt(0).toUpperCase()+type.slice(1);body.on(CalendarEvents.created,(function(){CalendarViewManager[reloadFunction](root)})),body.on(CalendarEvents.deleted,(function(){CalendarViewManager[reloadFunction](root)})),body.on(CalendarEvents.updated,(function(){CalendarViewManager[reloadFunction](root)})),root.on("change",CalendarSelectors.courseSelector,(function(){var courseId=$(this).val();CalendarViewManager[reloadFunction](root,courseId,null).then((function(){return root.find(CalendarSelectors.courseSelector).val(courseId)})).then((function(){window.history.pushState({},"","?view=upcoming&course="+courseId)})).fail(Notification.exception)})),body.on(CalendarEvents.filterChanged,(function(e,data){var daysWithEvent=root.find(CalendarSelectors.eventType[data.type]);1==data.hidden?daysWithEvent.addClass("hidden"):daysWithEvent.removeClass("hidden")}));var eventFormPromise=CalendarCrud.registerEventFormModal(root);CalendarCrud.registerEditListeners(root,eventFormPromise)}(root,type)}}}));
/**
 * This module is responsible for the calendar filter.
 *
 * @module     core_calendar/calendar_selectors
 * @package    core_calendar
 * @copyright  2017 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/selectors",[],(function(){return{eventFilterItem:"[data-action='filter-event-type']",eventType:{site:"[data-eventtype-site]",category:"[data-eventtype-category]",course:"[data-eventtype-course]",group:"[data-eventtype-group]",user:"[data-eventtype-user]",other:"[data-eventtype-other]"},popoverType:{site:"[data-popover-eventtype-site]",category:"[data-popover-eventtype-category]",course:"[data-popover-eventtype-course]",group:"[data-popover-eventtype-group]",user:"[data-popover-eventtype-user]",other:"[data-popover-eventtype-other]"},calendarPeriods:{month:"[data-period='month']"},courseSelector:'select[name="course"]',viewSelector:'div[data-region="view-selector"]',actions:{create:'[data-action="new-event-button"]',edit:'[data-action="edit"]',remove:'[data-action="delete"]',viewEvent:'[data-action="view-event"]'},elements:{courseSelector:'select[name="course"]'},today:".today",day:'[data-region="day"]',calendarMain:'[data-region="calendar"]',wrapper:".calendarwrapper",eventItem:'[data-type="event"]',links:{navLink:".calendarwrapper .arrow_link",eventLink:"[data-region='event-item']",miniDayLink:"[data-region='mini-day-link']"},containers:{loadingIcon:'[data-region="overlay-icon-container"]'}}}));
/**
 * This module is the highest level module for the calendar. It is
 * responsible for initialising all of the components required for
 * the calendar to run. It also coordinates the interaction between
 * components by listening for and responding to different events
 * triggered within the calendar UI.
 *
 * @module     core_calendar/calendar_mini
 * @package    core_calendar
 * @copyright  2017 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_calendar/calendar_mini",["jquery","core_calendar/selectors","core_calendar/events","core_calendar/view_manager"],(function($,CalendarSelectors,CalendarEvents,CalendarViewManager){var reloadMonth=function(e){var root=e.data,body=$("body"),namespace="."+root.attr("id");root.is(":visible")?CalendarViewManager.reloadCurrentMonth(root):(body.off(CalendarEvents.created+namespace),body.off(CalendarEvents.deleted+namespace),body.off(CalendarEvents.updated+namespace),body.off(CalendarEvents.eventMoved+namespace))};return{init:function(root,loadOnInit){root=$(root),CalendarViewManager.init(root),function(root){$("body").on(CalendarEvents.filterChanged,(function(e,data){root.find(CalendarSelectors.eventType[data.type]).toggleClass("calendar_event_"+data.type,!data.hidden)}));var namespace="."+root.attr("id");$("body").on("change"+namespace,CalendarSelectors.elements.courseSelector,(function(){if(root.is(":visible")){var courseId=$(this).val();CalendarViewManager.reloadCurrentMonth(root,courseId,null)}else $("body").off("change"+namespace)}))}(root),function(root){var body=$("body"),namespace="."+root.attr("id");body.on(CalendarEvents.created+namespace,root,reloadMonth),body.on(CalendarEvents.deleted+namespace,root,reloadMonth),body.on(CalendarEvents.updated+namespace,root,reloadMonth),body.on(CalendarEvents.eventMoved+namespace,root,reloadMonth)}(root),loadOnInit&&CalendarViewManager.reloadCurrentMonth(root)}}}));
define("core_calendar/repository",["exports","core/ajax"],(function(_exports,_ajax){var obj;
/**
   * A javascript module to handle calendar ajax actions.
   *
   * @module     core_calendar/repository
   * @class      repository
   * @package    core_calendar
   * @copyright  2017 Simey Lameze <lameze@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.updateEventStartDay=_exports.submitCreateUpdateForm=_exports.getEventById=_exports.getCourseGroupsData=_exports.getCalendarUpcomingData=_exports.getCalendarMonthData=_exports.getCalendarDayData=_exports.deleteEvent=void 0,_ajax=(obj=_ajax)&&obj.__esModule?obj:{default:obj};_exports.deleteEvent=function(eventId){var deleteSeries=arguments.length>1&&void 0!==arguments[1]&&arguments[1],request={methodname:"core_calendar_delete_calendar_events",args:{events:[{eventid:eventId,repeat:deleteSeries}]}};return _ajax.default.call([request])[0]};_exports.getEventById=function(eventId){var request={methodname:"core_calendar_get_calendar_event_by_id",args:{eventid:eventId}};return _ajax.default.call([request])[0]};_exports.submitCreateUpdateForm=function(formData){var request={methodname:"core_calendar_submit_create_update_form",args:{formdata:formData}};return _ajax.default.call([request])[0]};_exports.getCalendarMonthData=function(year,month,courseId,categoryId,includeNavigation,mini){var day=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,request={methodname:"core_calendar_get_calendar_monthly_view",args:{year:year,month:month,courseid:courseId,categoryid:categoryId,includenavigation:includeNavigation,mini:mini,day:day}};return _ajax.default.call([request])[0]};_exports.getCalendarDayData=function(year,month,day,courseId,categoryId){var request={methodname:"core_calendar_get_calendar_day_view",args:{year:year,month:month,day:day,courseid:courseId,categoryid:categoryId}};return _ajax.default.call([request])[0]};_exports.updateEventStartDay=function(eventId,dayTimestamp){var request={methodname:"core_calendar_update_event_start_day",args:{eventid:eventId,daytimestamp:dayTimestamp}};return _ajax.default.call([request])[0]};_exports.getCalendarUpcomingData=function(courseId,categoryId){var request={methodname:"core_calendar_get_calendar_upcoming_view",args:{courseid:courseId,categoryid:categoryId}};return _ajax.default.call([request])[0]};_exports.getCourseGroupsData=function(courseId){var request={methodname:"core_group_get_course_groups",args:{courseid:courseId}};return _ajax.default.call([request])[0]}}));
define("core_contentbank/search",["exports","jquery","core_contentbank/selectors","core/str","core/pending","core/utils"],(function(_exports,_jquery,_selectors,_str,_pending,_utils){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_selectors=_interopRequireDefault(_selectors),_pending=_interopRequireDefault(_pending);_exports.init=function(){var pendingPromise=new _pending.default,root=(0,_jquery.default)(_selectors.default.regions.contentbank);registerListenerEvents(root),pendingPromise.resolve()};var fn,_ref,registerListenerEvents=function(root){var searchInput=root.find(_selectors.default.elements.searchinput)[0];root.on("click",_selectors.default.actions.search,(function(e){e.preventDefault(),toggleSearchResultsView(root,searchInput.value)})),root.on("click",_selectors.default.actions.clearSearch,(function(e){e.preventDefault(),searchInput.value="",searchInput.focus(),toggleSearchResultsView(root,searchInput.value)})),searchInput.addEventListener("input",(0,_utils.debounce)((function(){toggleSearchResultsView(root,searchInput.value)}),300))},toggleSearchResultsView=(fn=regeneratorRuntime.mark((function _callee(body,searchQuery){var clearSearchButton,searchIcon,navbarBreadcrumb,navbarTotal,filteredContents;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(clearSearchButton=body.find(_selectors.default.elements.clearsearch)[0],searchIcon=body.find(_selectors.default.elements.searchicon)[0],navbarBreadcrumb=body.find(_selectors.default.elements.cbnavbarbreadcrumb)[0],navbarTotal=body.find(_selectors.default.elements.cbnavbartotalsearch)[0],filteredContents=filterContents(body,searchQuery),!(searchQuery.length>0)){_context.next=15;break}return searchIcon.classList.add("d-none"),clearSearchButton.classList.remove("d-none"),navbarBreadcrumb.classList.add("d-none"),_context.next=11,(0,_str.get_string)("itemsfound","core_contentbank",filteredContents.length);case 11:navbarTotal.innerHTML=_context.sent,navbarTotal.classList.remove("d-none"),_context.next=19;break;case 15:clearSearchButton.classList.add("d-none"),searchIcon.classList.remove("d-none"),navbarBreadcrumb.classList.remove("d-none"),navbarTotal.classList.add("d-none");case 19:case"end":return _context.stop()}}),_callee)})),_ref=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(_x,_x2){return _ref.apply(this,arguments)}),filterContents=function(body,searchTerm){var contents=Array.from(body.find(_selectors.default.elements.listitem)),searchResults=[];return contents.forEach((function(content){var contentName=content.getAttribute("data-name");""===searchTerm||contentName.toLowerCase().includes(searchTerm.toLowerCase())?(searchResults.push(content),content.querySelector(_selectors.default.regions.cbcontentname).innerHTML=highlight(contentName,searchTerm),content.classList.remove("d-none")):content.classList.add("d-none")})),searchResults},highlight=function(text,highlightText){var result=text;if(""!==highlightText){var pos=text.toLowerCase().indexOf(highlightText.toLowerCase());pos>-1&&(result=text.substr(0,pos)+'<span class="matchtext">'+text.substr(pos,highlightText.length)+"</span>"+text.substr(pos+highlightText.length))}return result}}));
/**
 * Module to manage content bank actions, such as delete or rename.
 *
 * @module     core_contentbank/actions
 * @package    core_contentbank
 * @copyright  2020 Sara Arjona <sara@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_contentbank/actions",["jquery","core/ajax","core/notification","core/str","core/templates","core/url","core/modal_factory","core/modal_events"],(function($,Ajax,Notification,Str,Templates,Url,ModalFactory,ModalEvents){var ACTIONS_DELETE_CONTENT='[data-action="deletecontent"]',ACTIONS_RENAME_CONTENT='[data-action="renamecontent"]',Actions=function(){this.registerEvents()};return Actions.prototype.registerEvents=function(){$(ACTIONS_DELETE_CONTENT).click((function(e){e.preventDefault();var contentname=$(this).data("contentname"),contentid=$(this).data("contentid"),contextid=$(this).data("contextid"),strings=[{key:"deletecontent",component:"core_contentbank"},{key:"deletecontentconfirm",component:"core_contentbank",param:{name:contentname}},{key:"delete",component:"core"}],deleteButtonText="";Str.get_strings(strings).then((function(langStrings){var modalTitle=langStrings[0],modalContent=langStrings[1];return deleteButtonText=langStrings[2],ModalFactory.create({title:modalTitle,body:modalContent,type:ModalFactory.types.SAVE_CANCEL,large:!0})})).done((function(modal){modal.setSaveButtonText(deleteButtonText),modal.getRoot().on(ModalEvents.save,(function(){return function(contentid,contextid){var request={methodname:"core_contentbank_delete_content",args:{contentids:{contentid:contentid}}},requestType="success";Ajax.call([request])[0].then((function(data){return data.result?"contentdeleted":(requestType="error","contentnotdeleted")})).done((function(message){var params={contextid:contextid};"success"==requestType?params.statusmsg=message:params.errormsg=message,window.location.href=Url.relativeUrl("contentbank/index.php",params,!1)})).fail(Notification.exception)}(contentid,contextid)})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.show()})).catch(Notification.exception)})),$(ACTIONS_RENAME_CONTENT).click((function(e){e.preventDefault();var contentname=$(this).data("contentname"),contentid=$(this).data("contentid"),saveButtonText="";Str.get_strings([{key:"renamecontent",component:"core_contentbank"},{key:"rename",component:"core_contentbank"}]).then((function(langStrings){var modalTitle=langStrings[0];return saveButtonText=langStrings[1],ModalFactory.create({title:modalTitle,body:Templates.render("core_contentbank/renamecontent",{contentid:contentid,name:contentname}),type:ModalFactory.types.SAVE_CANCEL})})).then((function(modal){modal.setSaveButtonText(saveButtonText),modal.getRoot().on(ModalEvents.save,(function(e){var newname=$("#newname").val().trim();if(newname)!function(contentid,name){var request={methodname:"core_contentbank_rename_content",args:{contentid:contentid,name:name}},requestType="success";Ajax.call([request])[0].then((function(data){return data.result?"contentrenamed":(requestType="error",data.warnings[0].message)})).then((function(message){var params=null;"success"==requestType?(params={id:contentid,statusmsg:message},window.location.href=Url.relativeUrl("contentbank/view.php",params,!1)):(Notification.addNotification({message:message,type:"error"}),Notification.fetchNotifications())})).catch(Notification.exception)}(contentid,newname);else{Str.get_strings([{key:"error"},{key:"emptynamenotallowed",component:"core_contentbank"}]).then((function(langStrings){Notification.alert(langStrings[0],langStrings[1])})).catch(Notification.exception),e.preventDefault()}})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.show()})).catch(Notification.exception)}))},{init:function(){return new Actions}}}));
define("core_contentbank/sort",["exports","./selectors","core/str","core/prefetch","core/ajax","core/notification"],(function(_exports,_selectors,_str,_prefetch,_ajax,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Content bank UI actions.
   *
   * @module     core_contentbank/sort
   * @package    core_contentbank
   * @copyright  2020 Bas Brands <bas@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_selectors=_interopRequireDefault(_selectors),_prefetch=_interopRequireDefault(_prefetch),_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification);_exports.init=function(){var contentBank=document.querySelector(_selectors.default.regions.contentbank);_prefetch.default.prefetchStrings("contentbank",["contentname","lastmodified","size","type"]),_prefetch.default.prefetchStrings("moodle",["sortbyx","sortbyxreverse"]),registerListenerEvents(contentBank)};var registerListenerEvents=function(contentBank){var fileArea=document.querySelector(_selectors.default.regions.filearea),shownItems=fileArea.querySelectorAll(_selectors.default.elements.listitem),viewGrid=contentBank.querySelector(_selectors.default.actions.viewgrid),viewList=contentBank.querySelector(_selectors.default.actions.viewlist);viewGrid.addEventListener("click",(function(){contentBank.classList.remove("view-list"),contentBank.classList.add("view-grid"),viewGrid.classList.add("active"),viewList.classList.remove("active"),setViewListPreference(!1)})),viewList.addEventListener("click",(function(){contentBank.classList.remove("view-grid"),contentBank.classList.add("view-list"),viewList.classList.add("active"),viewGrid.classList.remove("active"),setViewListPreference(!0)}));var sortByName=contentBank.querySelector(_selectors.default.actions.sortname);sortByName.addEventListener("click",(function(){var ascending=updateSortButtons(contentBank,sortByName);updateSortOrder(fileArea,shownItems,"data-file",ascending)}));var sortByDate=contentBank.querySelector(_selectors.default.actions.sortdate);sortByDate.addEventListener("click",(function(){var ascending=updateSortButtons(contentBank,sortByDate);updateSortOrder(fileArea,shownItems,"data-timemodified",ascending)}));var sortBySize=contentBank.querySelector(_selectors.default.actions.sortsize);sortBySize.addEventListener("click",(function(){var ascending=updateSortButtons(contentBank,sortBySize);updateSortOrder(fileArea,shownItems,"data-bytes",ascending)}));var sortByType=contentBank.querySelector(_selectors.default.actions.sorttype);sortByType.addEventListener("click",(function(){var ascending=updateSortButtons(contentBank,sortByType);updateSortOrder(fileArea,shownItems,"data-type",ascending)}))},setViewListPreference=function(viewList){!1===viewList&&(viewList=null);var request={methodname:"core_user_update_user_preferences",args:{preferences:[{type:"core_contentbank_view_list",value:viewList}]}};return _ajax.default.call([request])[0].catch(_notification.default.exception)},updateSortButtons=function(contentBank,sortButton){contentBank.querySelectorAll(_selectors.default.elements.sortbutton).forEach((function(button){button!==sortButton&&(button.classList.remove("dir-asc"),button.classList.remove("dir-desc"),button.classList.add("dir-none"),updateButtonTitle(button,!1))}));var ascending=!0;return sortButton.classList.contains("dir-none")?(sortButton.classList.remove("dir-none"),sortButton.classList.add("dir-asc")):sortButton.classList.contains("dir-asc")?(sortButton.classList.remove("dir-asc"),sortButton.classList.add("dir-desc"),ascending=!1):sortButton.classList.contains("dir-desc")&&(sortButton.classList.remove("dir-desc"),sortButton.classList.add("dir-asc")),updateButtonTitle(sortButton,ascending),ascending},updateButtonTitle=function(button,ascending){var sortString=ascending?"sortbyxreverse":"sortbyx";return(0,_str.get_string)(button.dataset.string,"contentbank").then((function(columnName){return(0,_str.get_string)(sortString,"core",columnName)})).then((function(sortByString){return button.setAttribute("title",sortByString),sortByString})).catch()},updateSortOrder=function(fileArea,itemList,attribute,ascending){[].slice.call(itemList).sort((function(a,b){var aa=a.getAttribute(attribute),bb=b.getAttribute(attribute);return isNaN(aa)||(aa=parseInt(aa),bb=parseInt(bb)),ascending?aa>bb?1:-1:aa<bb?1:-1})).forEach((function(listItem){return fileArea.appendChild(listItem)}))}}));
define("core_contentbank/selectors",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;
/**
   * Define all of the selectors we will be using on the contentbank interface.
   *
   * @module     core_contentbank/selectors
   * @package    core_contentbank
   * @copyright  2020 Sara Arjona <sara@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
var getDataSelector=function(name,value){return"[data-".concat(name,'="').concat(value,'"]')},_default={regions:{cbcontentname:getDataSelector("region","cb-content-name"),contentbank:getDataSelector("region","contentbank"),filearea:getDataSelector("region","filearea")},actions:{search:getDataSelector("action","searchcontent"),clearSearch:getDataSelector("action","clearsearchcontent"),viewgrid:getDataSelector("action","viewgrid"),viewlist:getDataSelector("action","viewlist"),sortname:getDataSelector("action","sortname"),sortdate:getDataSelector("action","sortdate"),sortsize:getDataSelector("action","sortsize"),sorttype:getDataSelector("action","sorttype")},elements:{listitem:".cb-listitem",cbnavbarbreadcrumb:".cb-navbar-breadbrumb",cbnavbartotalsearch:".cb-navbar-totalsearch",clearsearch:".input-group-append .clear-icon",searchicon:".input-group-append .search-icon",searchinput:"#searchinput",sortbutton:".cb-btnsort"}};return _exports.default=_default,_exports.default}));
/**
 * Contain the events the course component can trigger.
 *
 * @module     core_course/events
 * @package    core_course
 * @copyright  2018 Simey Lameze <simey@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_course/events",[],(function(){return{favourited:"core_course:favourited",unfavorited:"core_course:unfavorited"}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core_course/activitychooser",["exports","core_course/local/activitychooser/dialogue","core_course/local/activitychooser/repository","core_course/local/activitychooser/selectors","core/custom_interaction_events","core/templates","core/modal_factory","core/str","core/pending"],(function(_exports,ChooserDialogue,Repository,_selectors,_custom_interaction_events,Templates,ModalFactory,_str,_pending){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,ChooserDialogue=_interopRequireWildcard(ChooserDialogue),Repository=_interopRequireWildcard(Repository),_selectors=_interopRequireDefault(_selectors),_custom_interaction_events=_interopRequireDefault(_custom_interaction_events),Templates=_interopRequireWildcard(Templates),ModalFactory=_interopRequireWildcard(ModalFactory),_pending=_interopRequireDefault(_pending);_exports.init=function(courseId,chooserConfig){var pendingPromise=new _pending.default;registerListenerEvents(courseId,chooserConfig),pendingPromise.resolve()};var registerListenerEvents=function(courseId,chooserConfig){var innerPromise,footerInnerPromise,events=["click",_custom_interaction_events.default.events.activate,_custom_interaction_events.default.events.keyboardActivate],fetchModuleData=(innerPromise=null,function(){return innerPromise||(innerPromise=new Promise((function(resolve){resolve(Repository.activityModules(courseId))}))),innerPromise}),fetchFooterData=(footerInnerPromise=null,function(sectionId){return footerInnerPromise||(footerInnerPromise=new Promise((function(resolve){resolve(Repository.fetchFooterData(courseId,sectionId))}))),footerInnerPromise});_custom_interaction_events.default.define(document,events),events.forEach((function(event){var _ref;document.addEventListener(event,(_ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(e){var caller,sectionDiv,button,bodyPromiseResolver,bodyPromise,footerData,sectionModal,data,builtModuleData;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(!e.target.closest(_selectors.default.elements.sectionmodchooser)){_context2.next=21;break}return sectionDiv=e.target.closest(_selectors.default.elements.section),button=e.target.closest(_selectors.default.elements.sectionmodchooser),caller=null!==sectionDiv&&sectionDiv.hasAttribute("data-sectionid")?sectionDiv:button,bodyPromise=new Promise((function(resolve){bodyPromiseResolver=resolve})),_context2.next=7,fetchFooterData(caller.dataset.sectionid);case 7:return footerData=_context2.sent,sectionModal=buildModal(bodyPromise,footerData),_context2.next=11,fetchModuleData().catch(function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee(e){var errorTemplateData;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return errorTemplateData={errormessage:e.message},_context.t0=bodyPromiseResolver,_context.next=4,Templates.render("core_course/local/activitychooser/error",errorTemplateData);case 4:_context.t1=_context.sent,(0,_context.t0)(_context.t1);case 6:case"end":return _context.stop()}}),_callee)})));return function(_x2){return _ref2.apply(this,arguments)}}());case 11:if(data=_context2.sent){_context2.next=14;break}return _context2.abrupt("return");case 14:return builtModuleData=sectionIdMapper(data,caller.dataset.sectionid,caller.dataset.sectionreturnid),ChooserDialogue.displayChooser(sectionModal,builtModuleData,partiallyAppliedFavouriteManager(data,caller.dataset.sectionid),footerData),_context2.t0=bodyPromiseResolver,_context2.next=19,Templates.render("core_course/activitychooser",templateDataBuilder(builtModuleData,chooserConfig));case 19:_context2.t1=_context2.sent,(0,_context2.t0)(_context2.t1);case 21:case"end":return _context2.stop()}}),_callee2)}))),function(_x){return _ref.apply(this,arguments)}))}))},sectionIdMapper=function(webServiceData,id,sectionreturnid){var newData=JSON.parse(JSON.stringify(webServiceData));return newData.content_items.forEach((function(module){module.link+="&section="+id+"&sr="+(null!=sectionreturnid?sectionreturnid:0)})),newData.content_items},templateDataBuilder=function(data,chooserConfig){var activities=[],resources=[],showAll=!0,showActivities=!1,showResources=!1,tabMode=parseInt(chooserConfig.tabmode),favourites=data.filter((function(mod){return!0===mod.favourite})),recommended=data.filter((function(mod){return!0===mod.recommended}));0!==tabMode&&2!==tabMode||1===tabMode||(activities=data.filter((function(mod){return 0===mod.archetype})),resources=data.filter((function(mod){return 1===mod.archetype})),showActivities=!0,showResources=!0,2===tabMode&&(showAll=!1));var favouritesFirst=!!favourites.length;return{default:data,showAll:showAll,activities:activities,showActivities:showActivities,activitiesFirst:!1===showAll&&!1===favouritesFirst,resources:resources,showResources:showResources,favourites:favourites,recommended:recommended,favouritesFirst:favouritesFirst,fallback:!0===showAll&&!1===favouritesFirst}},buildModal=function(bodyPromise,footer){return ModalFactory.create({type:ModalFactory.types.DEFAULT,title:(0,_str.get_string)("addresourceoractivity"),body:bodyPromise,footer:footer.customfootertemplate,large:!0,templateContext:{classes:"modchooser"}}).then((function(modal){return modal.show(),modal}))},nullFavouriteDomManager=function(favouriteTabNav,modalBody){if(favouriteTabNav.tabIndex=-1,favouriteTabNav.classList.add("d-none"),favouriteTabNav.classList.contains("active")){favouriteTabNav.classList.remove("active"),favouriteTabNav.setAttribute("aria-selected","false"),modalBody.querySelector(_selectors.default.regions.favouriteTab).classList.remove("active");var defaultTabNav=modalBody.querySelector(_selectors.default.regions.defaultTabNav),activitiesTabNav=modalBody.querySelector(_selectors.default.regions.activityTabNav);if(!1===defaultTabNav.classList.contains("d-none"))defaultTabNav.classList.add("active"),defaultTabNav.setAttribute("aria-selected","true"),defaultTabNav.tabIndex=0,defaultTabNav.focus(),modalBody.querySelector(_selectors.default.regions.defaultTab).classList.add("active");else activitiesTabNav.classList.add("active"),activitiesTabNav.setAttribute("aria-selected","true"),activitiesTabNav.tabIndex=0,activitiesTabNav.focus(),modalBody.querySelector(_selectors.default.regions.activityTab).classList.add("active")}},partiallyAppliedFavouriteManager=function(moduleData,sectionId){return _ref3=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(internal,favourite,modalBody){var favouriteArea,favouriteButtons,favouriteTabNav,result,newFaves,builtFaves,_yield$Templates$rend,html,js,nodeToRemove;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(favouriteArea=modalBody.querySelector(_selectors.default.render.favourites),favouriteButtons=modalBody.querySelectorAll('[data-internal="'.concat(internal,'"] ').concat(_selectors.default.actions.optionActions.manageFavourite)),favouriteTabNav=modalBody.querySelector(_selectors.default.regions.favouriteTabNav),result=moduleData.content_items.find((function(_ref4){return _ref4.name===internal})),newFaves={},!result){_context3.next=27;break}if(!favourite){_context3.next=21;break}return result.favourite=!0,newFaves.content_items=moduleData.content_items.filter((function(mod){return!0===mod.favourite})),builtFaves=sectionIdMapper(newFaves,sectionId),_context3.next=12,Templates.renderForPromise("core_course/local/activitychooser/favourites",{favourites:builtFaves});case 12:return _yield$Templates$rend=_context3.sent,html=_yield$Templates$rend.html,js=_yield$Templates$rend.js,_context3.next=17,Templates.replaceNodeContents(favouriteArea,html,js);case 17:Array.from(favouriteButtons).forEach((function(element){element.classList.remove("text-muted"),element.classList.add("text-primary"),element.dataset.favourited="true",element.setAttribute("aria-pressed",!0),element.firstElementChild.classList.remove("fa-star-o"),element.firstElementChild.classList.add("fa-star")})),favouriteTabNav.classList.remove("d-none"),_context3.next=27;break;case 21:result.favourite=!1,(nodeToRemove=favouriteArea.querySelector('[data-internal="'.concat(internal,'"]'))).parentNode.removeChild(nodeToRemove),Array.from(favouriteButtons).forEach((function(element){element.classList.add("text-muted"),element.classList.remove("text-primary"),element.dataset.favourited="false",element.setAttribute("aria-pressed",!1),element.firstElementChild.classList.remove("fa-star"),element.firstElementChild.classList.add("fa-star-o")})),0===moduleData.content_items.filter((function(mod){return!0===mod.favourite})).length&&nullFavouriteDomManager(favouriteTabNav,modalBody);case 27:case"end":return _context3.stop()}}),_callee3)}))),function(_x3,_x4,_x5){return _ref3.apply(this,arguments)};var _ref3}}));
define("core_course/recommendations",["exports","core/ajax","core/notification"],(function(_exports,_ajax,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * A javascript module to handle toggling activity chooser recommendations.
   *
   * @module     core_course/recommendations
   * @copyright  2020 Adrian Greeve <adrian@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification);var toggleRecommendation=function(e){var data={methodname:"core_course_toggle_activity_recommendation",args:{area:e.currentTarget.dataset.area,id:e.currentTarget.dataset.id}};_ajax.default.call([data])[0].fail(_notification.default.exception)};_exports.init=function(){document.querySelectorAll("[data-area]").forEach((function(checkbox){checkbox.addEventListener("change",toggleRecommendation)}))}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core_course/local/activitychooser/dialogue",["exports","jquery","core/modal_events","core_course/local/activitychooser/selectors","core/templates","core/key_codes","core/loadingicon","core_course/local/activitychooser/repository","core/notification","core/utils"],(function(_exports,_jquery,ModalEvents,_selectors,Templates,_key_codes,_loadingicon,Repository,_notification,_utils){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.displayChooser=void 0,_jquery=_interopRequireDefault(_jquery),ModalEvents=_interopRequireWildcard(ModalEvents),_selectors=_interopRequireDefault(_selectors),Templates=_interopRequireWildcard(Templates),Repository=_interopRequireWildcard(Repository),_notification=_interopRequireDefault(_notification);var _systemImportTransformerGlobalIdentifier="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var _ref3,_ref6,_ref7,getPlugin=function(pluginName){return"function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require([pluginName],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require(pluginName)):Promise.resolve(_systemImportTransformerGlobalIdentifier[pluginName])},showModuleHelp=function(carousel,moduleData){var modal=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null!==modal&&!0===moduleData.showFooter&&modal.setFooter(Templates.render("core_course/local/activitychooser/footer_partial",moduleData));var help=carousel.find(_selectors.default.regions.help)[0];help.innerHTML="",help.classList.add("m-auto");var spinnerPromise=(0,_loadingicon.addIconToContainer)(help),transitionPromiseResolver=null,transitionPromise=new Promise((function(resolve){transitionPromiseResolver=resolve})),contentPromise=Templates.renderForPromise("core_course/local/activitychooser/help",moduleData);Promise.all([contentPromise,spinnerPromise,transitionPromise]).then((function(_ref){var _ref2$=_slicedToArray(_ref,1)[0],html=_ref2$.html,js=_ref2$.js;return Templates.replaceNodeContents(help,html,js)})).then((function(){return help.querySelector(_selectors.default.regions.chooserSummary.header).focus(),help})).catch(_notification.default.exception),carousel.one("slid.bs.carousel",(function(){transitionPromiseResolver()})),carousel.carousel("next")},manageFavouriteState=(_ref3=_asyncToGenerator(regeneratorRuntime.mark((function _callee(modalBody,caller,partialFavourite){var isFavourite,id,name,internal;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(isFavourite=caller.dataset.favourited,id=caller.dataset.id,name=caller.dataset.name,internal=caller.dataset.internal,"true"!==isFavourite){_context.next=10;break}return _context.next=7,Repository.unfavouriteModule(name,id);case 7:partialFavourite(internal,!1,modalBody),_context.next=13;break;case 10:return _context.next=12,Repository.favouriteModule(name,id);case 12:partialFavourite(internal,!0,modalBody);case 13:case"end":return _context.stop()}}),_callee)}))),function(_x,_x2,_x3){return _ref3.apply(this,arguments)}),initChooserOptionsKeyboardNavigation=function(body,mappedModules,chooserOptionsContainer){var modal=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,chooserOptions=chooserOptionsContainer.querySelectorAll(_selectors.default.regions.chooserOption.container);Array.from(chooserOptions).forEach((function(element){return element.addEventListener("keydown",(function(e){if((e.keyCode===_key_codes.enter||e.keyCode===_key_codes.space)&&e.target.matches(_selectors.default.actions.optionActions.showSummary)){e.preventDefault();var moduleName=e.target.closest(_selectors.default.regions.chooserOption.container).dataset.modname,moduleData=mappedModules.get(moduleName),carousel=(0,_jquery.default)(body.querySelector(_selectors.default.regions.carousel));carousel.carousel({interval:!1,pause:!0,keyboard:!1}),moduleData.showFooter=modal.hasFooterContent(),showModuleHelp(carousel,moduleData,modal)}if(e.keyCode===_key_codes.arrowRight){e.preventDefault();var currentOption=e.target.closest(_selectors.default.regions.chooserOption.container),nextOption=currentOption.nextElementSibling,firstOption=chooserOptionsContainer.firstElementChild,toFocusOption=clickErrorHandler(nextOption,firstOption);focusChooserOption(toFocusOption,currentOption)}if(e.keyCode===_key_codes.arrowLeft){e.preventDefault();var _currentOption=e.target.closest(_selectors.default.regions.chooserOption.container),previousOption=_currentOption.previousElementSibling,lastOption=chooserOptionsContainer.lastElementChild,_toFocusOption=clickErrorHandler(previousOption,lastOption);focusChooserOption(_toFocusOption,_currentOption)}if(e.keyCode===_key_codes.home){e.preventDefault();var _currentOption2=e.target.closest(_selectors.default.regions.chooserOption.container),_firstOption=chooserOptionsContainer.firstElementChild;focusChooserOption(_firstOption,_currentOption2)}if(e.keyCode===_key_codes.end){e.preventDefault();var _currentOption3=e.target.closest(_selectors.default.regions.chooserOption.container),_lastOption=chooserOptionsContainer.lastElementChild;focusChooserOption(_lastOption,_currentOption3)}}))}))},focusChooserOption=function(currentChooserOption){var previousChooserOption=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null!==previousChooserOption&&toggleFocusableChooserOption(previousChooserOption,!1),toggleFocusableChooserOption(currentChooserOption,!0),currentChooserOption.focus()},toggleFocusableChooserOption=function(chooserOption,isFocusable){var chooserOptionLink=chooserOption.querySelector(_selectors.default.actions.addChooser),chooserOptionHelp=chooserOption.querySelector(_selectors.default.actions.optionActions.showSummary),chooserOptionFavourite=chooserOption.querySelector(_selectors.default.actions.optionActions.manageFavourite);isFocusable?(chooserOption.tabIndex=0,chooserOptionLink.tabIndex=0,chooserOptionHelp.tabIndex=0,chooserOptionFavourite.tabIndex=0):(chooserOption.tabIndex=-1,chooserOptionLink.tabIndex=-1,chooserOptionHelp.tabIndex=-1,chooserOptionFavourite.tabIndex=-1)},clickErrorHandler=function(item,fallback){return null!==item?item:fallback},renderSearchResults=(_ref6=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(searchResultsContainer,searchResultsData){var templateData,_yield$Templates$rend,html,js;return regeneratorRuntime.wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return templateData={searchresultsnumber:searchResultsData.length,searchresults:searchResultsData},_context4.next=3,Templates.renderForPromise("core_course/local/activitychooser/search_results",templateData);case 3:return _yield$Templates$rend=_context4.sent,html=_yield$Templates$rend.html,js=_yield$Templates$rend.js,_context4.next=8,Templates.replaceNodeContents(searchResultsContainer,html,js);case 8:case"end":return _context4.stop()}}),_callee4)}))),function(_x6,_x7){return _ref6.apply(this,arguments)}),toggleSearchResultsView=(_ref7=_asyncToGenerator(regeneratorRuntime.mark((function _callee5(modal,mappedModules,searchQuery){var modalBody,searchResultsContainer,chooserContainer,clearSearchButton,searchIcon,searchResultsData,searchResultItemsContainer,firstSearchResultItem;return regeneratorRuntime.wrap((function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(modalBody=modal.getBody()[0],searchResultsContainer=modalBody.querySelector(_selectors.default.regions.searchResults),chooserContainer=modalBody.querySelector(_selectors.default.regions.chooser),clearSearchButton=modalBody.querySelector(_selectors.default.elements.clearsearch),searchIcon=modalBody.querySelector(_selectors.default.elements.searchicon),!(searchQuery.length>0)){_context5.next=18;break}return searchResultsData=searchModules(mappedModules,searchQuery),_context5.next=9,renderSearchResults(searchResultsContainer,searchResultsData);case 9:searchResultItemsContainer=searchResultsContainer.querySelector(_selectors.default.regions.searchResultItems),(firstSearchResultItem=searchResultItemsContainer.querySelector(_selectors.default.regions.chooserOption.container))&&(toggleFocusableChooserOption(firstSearchResultItem,!0),initChooserOptionsKeyboardNavigation(modalBody,mappedModules,searchResultItemsContainer,modal)),searchIcon.classList.add("d-none"),clearSearchButton.classList.remove("d-none"),chooserContainer.setAttribute("hidden","hidden"),searchResultsContainer.removeAttribute("hidden"),_context5.next=22;break;case 18:clearSearchButton.classList.add("d-none"),searchIcon.classList.remove("d-none"),searchResultsContainer.setAttribute("hidden","hidden"),chooserContainer.removeAttribute("hidden");case 22:case"end":return _context5.stop()}}),_callee5)}))),function(_x8,_x9,_x10){return _ref7.apply(this,arguments)}),searchModules=function(modules,searchTerm){if(""===searchTerm)return modules;searchTerm=searchTerm.toLowerCase();var searchResults=[];return modules.forEach((function(activity){var activityName=activity.title.toLowerCase(),activityDesc=activity.help.toLowerCase();(activityName.includes(searchTerm)||activityDesc.includes(searchTerm))&&searchResults.push(activity)})),searchResults},disableFocusAllChooserOptions=function(sectionChooserOptions){sectionChooserOptions.querySelectorAll(_selectors.default.regions.chooserOption.container).forEach((function(chooserOption){toggleFocusableChooserOption(chooserOption,!1)}))};_exports.displayChooser=function(modalPromise,sectionModules,partialFavourite,footerData){var mappedModules=new Map;sectionModules.forEach((function(module){mappedModules.set(module.componentname+"_"+module.link,module)})),modalPromise.then((function(modal){return function(modal,mappedModules,partialFavourite,footerData){var _ref4,_ref5,bodyClickListener=(_ref4=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(e){var carousel,module,moduleName,moduleData,caller,activeSectionId,sectionChooserOptions,firstChooserOption,_carousel,searchInput;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(e.target.closest(_selectors.default.actions.optionActions.showSummary)&&(carousel=(0,_jquery.default)(modal.getBody()[0].querySelector(_selectors.default.regions.carousel)),module=e.target.closest(_selectors.default.regions.chooserOption.container),moduleName=module.dataset.modname,(moduleData=mappedModules.get(moduleName)).showFooter=modal.hasFooterContent(),showModuleHelp(carousel,moduleData,modal)),!e.target.closest(_selectors.default.actions.optionActions.manageFavourite)){_context2.next=10;break}return caller=e.target.closest(_selectors.default.actions.optionActions.manageFavourite),_context2.next=5,manageFavouriteState(modal.getBody()[0],caller,partialFavourite);case 5:activeSectionId=modal.getBody()[0].querySelector(_selectors.default.elements.activetab).getAttribute("href"),sectionChooserOptions=modal.getBody()[0].querySelector(_selectors.default.regions.getSectionChooserOptions(activeSectionId)),firstChooserOption=sectionChooserOptions.querySelector(_selectors.default.regions.chooserOption.container),toggleFocusableChooserOption(firstChooserOption,!0),initChooserOptionsKeyboardNavigation(modal.getBody()[0],mappedModules,sectionChooserOptions,modal);case 10:e.target.matches(_selectors.default.actions.closeOption)&&((_carousel=(0,_jquery.default)(modal.getBody()[0].querySelector(_selectors.default.regions.carousel))).carousel("prev"),_carousel.on("slid.bs.carousel",(function(){modal.getBody()[0].querySelector(_selectors.default.regions.modules).querySelector(_selectors.default.regions.getModuleSelector(e.target.dataset.modname)).focus()}))),e.target.closest(_selectors.default.actions.clearSearch)&&((searchInput=modal.getBody()[0].querySelector(_selectors.default.actions.search)).value="",searchInput.focus(),toggleSearchResultsView(modal,mappedModules,searchInput.value));case 12:case"end":return _context2.stop()}}),_callee2)}))),function(_x4){return _ref4.apply(this,arguments)}),footerClickListener=(_ref5=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(e){var footerjs;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(!0!==footerData.footer){_context3.next=6;break}return _context3.next=3,getPlugin(footerData.customfooterjs);case 3:return footerjs=_context3.sent,_context3.next=6,footerjs.footerClickListener(e,footerData,modal);case 6:case"end":return _context3.stop()}}),_callee3)}))),function(_x5){return _ref5.apply(this,arguments)});modal.getBodyPromise().then((function(body){return body[0]})).then((function(body){return(0,_jquery.default)(body.querySelector(_selectors.default.regions.carousel)).carousel({interval:!1,pause:!0,keyboard:!1}),body})).then((function(body){return body.addEventListener("click",bodyClickListener),body})).then((function(body){var searchInput=body.querySelector(_selectors.default.actions.search);return searchInput.addEventListener("input",(0,_utils.debounce)((function(){toggleSearchResultsView(modal,mappedModules,searchInput.value)}),300)),body})).then((function(body){var activeSectionId=body.querySelector(_selectors.default.elements.activetab).getAttribute("href"),sectionChooserOptions=body.querySelector(_selectors.default.regions.getSectionChooserOptions(activeSectionId)),firstChooserOption=sectionChooserOptions.querySelector(_selectors.default.regions.chooserOption.container);return toggleFocusableChooserOption(firstChooserOption,!0),initChooserOptionsKeyboardNavigation(body,mappedModules,sectionChooserOptions,modal),body})).catch(),modal.getFooterPromise().then((function(footer){return footer[0]})).then((function(footer){return footer.addEventListener("click",footerClickListener),footer})).catch()}(modal,mappedModules,partialFavourite,footerData),function(modal,mappedModules){modal.getModal()[0].tabIndex=-1,modal.getBodyPromise().then((function(body){(0,_jquery.default)(_selectors.default.elements.tab).on("shown.bs.tab",(function(e){var activeSectionId=e.target.getAttribute("href"),activeSectionChooserOptions=body[0].querySelector(_selectors.default.regions.getSectionChooserOptions(activeSectionId)),firstChooserOption=activeSectionChooserOptions.querySelector(_selectors.default.regions.chooserOption.container),prevActiveSectionId=e.relatedTarget.getAttribute("href"),prevActiveSectionChooserOptions=body[0].querySelector(_selectors.default.regions.getSectionChooserOptions(prevActiveSectionId));disableFocusAllChooserOptions(prevActiveSectionChooserOptions),toggleFocusableChooserOption(firstChooserOption,!0),initChooserOptionsKeyboardNavigation(body[0],mappedModules,activeSectionChooserOptions,modal)}))})).catch(_notification.default.exception)}(modal,mappedModules),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal})).catch()}}));
define("core_course/local/activitychooser/selectors",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;
/**
   * Define all of the selectors we will be using on the grading interface.
   *
   * @module     core_course/local/chooser/selectors
   * @package    core_course
   * @copyright  2019 Mathew May <mathew.solutions>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
var getDataSelector=function(name,value){return"[data-".concat(name,'="').concat(value,'"]')},_default={regions:{chooser:getDataSelector("region","chooser-container"),getSectionChooserOptions:function(containerid){return"".concat(containerid," ").concat(getDataSelector("region","chooser-options-container"))},chooserOption:{container:getDataSelector("region","chooser-option-container"),actions:getDataSelector("region","chooser-option-actions-container"),info:getDataSelector("region","chooser-option-info-container")},chooserSummary:{container:getDataSelector("region","chooser-option-summary-container"),content:getDataSelector("region","chooser-option-summary-content-container"),header:getDataSelector("region","summary-header"),actions:getDataSelector("region","chooser-option-summary-actions-container")},carousel:getDataSelector("region","carousel"),help:getDataSelector("region","help"),modules:getDataSelector("region","modules"),favouriteTabNav:getDataSelector("region","favourite-tab-nav"),defaultTabNav:getDataSelector("region","default-tab-nav"),activityTabNav:getDataSelector("region","activity-tab-nav"),favouriteTab:getDataSelector("region","favourites"),recommendedTab:getDataSelector("region","recommended"),defaultTab:getDataSelector("region","default"),activityTab:getDataSelector("region","activity"),resourceTab:getDataSelector("region","resources"),getModuleSelector:function(modname){return'[role="menuitem"][data-modname="'.concat(modname,'"]')},searchResults:getDataSelector("region","search-results-container"),searchResultItems:getDataSelector("region","search-result-items-container")},actions:{optionActions:{showSummary:getDataSelector("action","show-option-summary"),manageFavourite:getDataSelector("action","manage-module-favourite")},addChooser:getDataSelector("action","add-chooser-option"),closeOption:getDataSelector("action","close-chooser-option-summary"),hide:getDataSelector("action","hide"),search:getDataSelector("action","search"),clearSearch:getDataSelector("action","clearsearch")},render:{favourites:getDataSelector("render","favourites-area")},elements:{section:".section",sectionmodchooser:"button.section-modchooser-link",sitemenu:".block_site_main_menu",sitetopic:"div.sitetopic",tab:'a[data-toggle="tab"]',activetab:'a[data-toggle="tab"][aria-selected="true"]',visibletabs:'a[data-toggle="tab"]:not(.d-none)',searchicon:".input-group-append .search-icon",clearsearch:".input-group-append .clear"}};return _exports.default=_default,_exports.default}));
define("core_course/local/activitychooser/repository",["exports","core/ajax"],(function(_exports,_ajax){var obj;
/**
   *
   * @module     core_course/repository
   * @package    core_course
   * @copyright  2019 Mathew May <mathew.solutions>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.unfavouriteModule=_exports.fetchFooterData=_exports.favouriteModule=_exports.activityModules=void 0,_ajax=(obj=_ajax)&&obj.__esModule?obj:{default:obj};_exports.activityModules=function(courseid){var request={methodname:"core_course_get_course_content_items",args:{courseid:courseid}};return _ajax.default.call([request])[0]};_exports.favouriteModule=function(modName,modID){var request={methodname:"core_course_add_content_item_to_user_favourites",args:{componentname:modName,contentitemid:modID}};return _ajax.default.call([request])[0]};_exports.unfavouriteModule=function(modName,modID){var request={methodname:"core_course_remove_content_item_from_user_favourites",args:{componentname:modName,contentitemid:modID}};return _ajax.default.call([request])[0]};_exports.fetchFooterData=function(courseid,sectionid){var request={methodname:"core_course_get_activity_chooser_footer",args:{courseid:courseid,sectionid:sectionid}};return _ajax.default.call([request])[0]}}));
/**
 * This module provides the course copy modal from the course and
 * category management screen.
 *
 * @module     course
 * @package    core
 * @copyright  2020 onward The Moodle Users Association <https://moodleassociation.org/>
 * @author     Matt Porritt <mattp@catalyst-au.net>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.9
 */
define("core_course/copy_modal",["jquery","core/str","core/modal_factory","core/modal_events","core/ajax","core/fragment","core/notification","core/config"],(function($,Str,ModalFactory,ModalEvents,ajax,Fragment,Notification,Config){var contextid,course,modalObj,CopyModal={},spinner='<p class="text-center"><i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i></p>';function updateModalBody(formdata){void 0===formdata&&(formdata={});var params={jsonformdata:JSON.stringify(formdata),courseid:course.id};modalObj.setBody(spinner),Str.get_string("copycoursetitle","backup",course.shortname).then((function(title){modalObj.setTitle(title),modalObj.setBody(Fragment.loadFragment("course","new_base_form",contextid,params))})).catch((function(){Notification.exception(new Error("Failed to load string: copycoursetitle"))}))}function processModalForm(e){e.preventDefault();var copyform=modalObj.getRoot().find("form").serialize(),formjson=JSON.stringify(copyform),invalid=$.merge(modalObj.getRoot().find('[aria-invalid="true"]'),modalObj.getRoot().find(".error"));invalid.length?invalid.first().focus():ajax.call([{methodname:"core_backup_submit_copy_form",args:{jsonformdata:formjson}}])[0].done((function(){if(modalObj.setBody(spinner),modalObj.hide(),1==e.formredirect){var redirect=Config.wwwroot+"/backup/copyprogress.php?id="+course.id;window.location.assign(redirect)}})).fail((function(){updateModalBody(copyform)}))}return CopyModal.init=function(context){contextid=context,Str.get_string("loading").then((function(title){ModalFactory.create({type:ModalFactory.types.DEFAULT,title:title,body:spinner,large:!0}).done((function(modal){(modalObj=modal).getRoot().on("click","#id_submitreturn",processModalForm),modalObj.getRoot().on("click","#id_submitdisplay",(function(e){e.formredirect=!0,processModalForm(e)})),modalObj.getRoot().on("click","#id_cancel",(function(e){e.preventDefault(),modalObj.setBody(spinner),modalObj.hide()}))}))})).catch((function(){Notification.exception(new Error("Failed to load string: loading"))})),$(".action-copy").on("click",(function(e){e.preventDefault();var url=new URL(this.getAttribute("href")),courseid=new URLSearchParams(url.search).get("id");ajax.call([{methodname:"core_course_get_courses",args:{options:{ids:[courseid]}}}])[0].done((function(response){course=response[0],updateModalBody()})).fail((function(){Notification.exception(new Error("Failed to load course"))})),modalObj.show()}))},CopyModal}));
/**
 * Various actions on modules and sections in the editing mode - hiding, duplicating, deleting, etc.
 *
 * @module     core_course/actions
 * @package    core
 * @copyright  2016 Marina Glancy
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.3
 */
define("core_course/actions",["jquery","core/ajax","core/templates","core/notification","core/str","core/url","core/yui","core/modal_factory","core/modal_events","core/key_codes","core/log"],(function($,ajax,templates,notification,str,url,Y,ModalFactory,ModalEvents,KeyCodes,log){var CSS_EDITINPROGRESS="editinprogress",CSS_EDITINGMOVE="editing_move",SELECTOR={ACTIVITYLI:"li.activity",ACTIONAREA:".actions",ACTIVITYACTION:"a.cm-edit-action",MENU:".moodle-actionmenu[data-enhance=moodle-core-actionmenu]",TOGGLE:".toggle-display,.dropdown-toggle",SECTIONLI:"li.section",SECTIONACTIONMENU:".section_action_menu",ADDSECTIONS:"#changenumsections [data-add-sections]"};Y.use("moodle-course-coursebase",(function(){var courseformatselector=M.course.format.get_section_selector();courseformatselector&&(SELECTOR.SECTIONLI=courseformatselector)}));var getModuleId=function(element){var id;return Y.use("moodle-course-util",(function(Y){id=Y.Moodle.core_course.util.cm.getId(Y.Node(element.get(0)))})),id},addActivitySpinner=function(activity){activity.addClass(CSS_EDITINPROGRESS);var actionarea=activity.find(SELECTOR.ACTIONAREA).get(0);if(actionarea){var spinner=M.util.add_spinner(Y,Y.Node(actionarea));return spinner.show(),spinner}return null},addSectionLightbox=function(sectionelement){var lightbox=M.util.add_lightbox(Y,Y.Node(sectionelement.get(0)));return lightbox.show(),lightbox},removeSpinner=function(element,spinner,delay){window.setTimeout((function(){element.removeClass(CSS_EDITINPROGRESS),spinner&&spinner.hide()}),delay)},removeLightbox=function(lightbox,delay){lightbox&&window.setTimeout((function(){lightbox.hide()}),delay)},initActionMenu=function(elementid){Y.use("moodle-course-coursebase",(function(){M.course.coursebase.invoke_function("setup_for_resource","#"+elementid)})),M.core.actionmenu&&M.core.actionmenu.newDOMNode&&M.core.actionmenu.newDOMNode(Y.one("#"+elementid))},editModule=function(moduleElement,cmid,target){var lightbox,action=target.attr("data-action"),spinner=addActivitySpinner(moduleElement),promises=ajax.call([{methodname:"core_course_edit_module",args:{id:cmid,action:action,sectionreturn:target.attr("data-sectionreturn")?target.attr("data-sectionreturn"):0}}],!0);"duplicate"===action&&(lightbox=addSectionLightbox(target.closest(SELECTOR.SECTIONLI))),$.when.apply($,promises).done((function(data){var mainElement,tabables,isInside,foundElement,elementToFocus=(mainElement=moduleElement,tabables=$("a:visible"),isInside=!1,foundElement=null,tabables.each((function(){if($.contains(mainElement[0],this))isInside=!0;else if(isInside)return foundElement=this,!1})),foundElement);moduleElement.replaceWith(data),$("<div>"+data+"</div>").find(SELECTOR.ACTIVITYLI).each((function(index){initActionMenu($(this).attr("id")),0===index&&(!function(elementId,action){var mainelement=$("#"+elementId),selector="[data-action="+action+"]";"groupsseparate"!==action&&"groupsvisible"!==action&&"groupsnone"!==action||(selector="[data-action=groupsseparate],[data-action=groupsvisible],[data-action=groupsnone]"),mainelement.find(selector).is(":visible")?mainelement.find(selector).focus():mainelement.find(SELECTOR.MENU).find(SELECTOR.TOGGLE).focus()}($(this).attr("id"),action),elementToFocus=null)})),elementToFocus&&elementToFocus.focus(),removeSpinner(moduleElement,spinner,400),removeLightbox(lightbox,400),moduleElement.trigger($.Event("coursemoduleedited",{ajaxreturn:data,action:action}))})).fail((function(ex){removeSpinner(moduleElement,spinner),removeLightbox(lightbox);var e=$.Event("coursemoduleeditfailed",{exception:ex,action:action});moduleElement.trigger(e),e.isDefaultPrevented()||notification.exception(ex)}))},confirmDeleteModule=function(mainelement,onconfirm){var element,name,modtypename=mainelement.attr("class").match(/modtype_([^\s]*)/)[1],modulename=(element=mainelement,Y.use("moodle-course-util",(function(Y){name=Y.Moodle.core_course.util.cm.getName(Y.Node(element.get(0)))})),name);str.get_string("pluginname",modtypename).done((function(pluginname){var plugindata={type:pluginname,name:modulename};str.get_strings([{key:"confirm"},{key:null===modulename?"deletechecktype":"deletechecktypename",param:plugindata},{key:"yes"},{key:"no"}]).done((function(s){notification.confirm(s[0],s[1],s[2],s[3],onconfirm)}))}))},replaceActionItem=function(actionitem,image,stringname,stringcomponent,newaction){var stringRequests=[{key:stringname,component:stringcomponent}];return str.get_strings(stringRequests).then((function(strings){return actionitem.find("span.menu-action-text").html(strings[0]),templates.renderPix(image,"core")})).then((function(pixhtml){actionitem.find(".icon").replaceWith(pixhtml),actionitem.attr("data-action",newaction)})).catch(notification.exception)},replaceActivityHtmlWith=function(activityHTML){$("<div>"+activityHTML+"</div>").find(SELECTOR.ACTIVITYLI).each((function(){var id=$(this).attr("id");$(SELECTOR.ACTIVITYLI+"#"+id).replaceWith(activityHTML),initActionMenu(id)}))},editSection=function(sectionElement,sectionid,target,courseformat){var action=target.attr("data-action"),sectionreturn=target.attr("data-sectionreturn")?target.attr("data-sectionreturn"):0,spinner=function(sectionelement){sectionelement.addClass(CSS_EDITINPROGRESS);var actionarea=sectionelement.find(SELECTOR.SECTIONACTIONMENU).get(0);if(actionarea){var spinner=M.util.add_spinner(Y,Y.Node(actionarea));return spinner.show(),spinner}return null}(sectionElement),promises=ajax.call([{methodname:"core_course_edit_section",args:{id:sectionid,action:action,sectionreturn:sectionreturn}}],!0),lightbox=addSectionLightbox(sectionElement);$.when.apply($,promises).done((function(dataencoded){var data=$.parseJSON(dataencoded);removeSpinner(sectionElement,spinner),removeLightbox(lightbox),sectionElement.find(SELECTOR.SECTIONACTIONMENU).find(SELECTOR.TOGGLE).focus();var e=$.Event("coursesectionedited",{ajaxreturn:data,action:action});sectionElement.trigger(e),e.isDefaultPrevented()||function(sectionElement,actionItem,data,courseformat){var action=actionItem.attr("data-action");if("hide"===action||"show"===action){if("hide"===action?(sectionElement.addClass("hidden"),replaceActionItem(actionItem,"i/show","showfromothers","format_"+courseformat,"show")):(sectionElement.removeClass("hidden"),replaceActionItem(actionItem,"i/hide","hidefromothers","format_"+courseformat,"hide")),void 0!==data.modules)for(var i in data.modules)replaceActivityHtmlWith(data.modules[i]);void 0!==data.section_availability&&sectionElement.find(".section_availability").first().replaceWith(data.section_availability)}else if("setmarker"===action){var oldmarker=$(SELECTOR.SECTIONLI+".current"),oldActionItem=oldmarker.find(SELECTOR.SECTIONACTIONMENU+" a[data-action=removemarker]");oldmarker.removeClass("current"),replaceActionItem(oldActionItem,"i/marker","highlight","core","setmarker"),sectionElement.addClass("current"),replaceActionItem(actionItem,"i/marked","highlightoff","core","removemarker")}else"removemarker"===action&&(sectionElement.removeClass("current"),replaceActionItem(actionItem,"i/marker","highlight","core","setmarker"))}(sectionElement,target,data,courseformat)})).fail((function(ex){removeSpinner(sectionElement,spinner),removeLightbox(lightbox);var e=$.Event("coursesectioneditfailed",{exception:ex,action:action});sectionElement.trigger(e),e.isDefaultPrevented()||notification.exception(ex)}))};return Y.use("moodle-course-coursebase",(function(){M.course.coursebase.register_module({set_visibility_resource_ui:function(args){var mainelement=$(args.element.getDOMNode()),cmid=getModuleId(mainelement);if(cmid){var sectionreturn=mainelement.find("."+CSS_EDITINGMOVE).attr("data-sectionreturn");!function(activityElement,cmid,sectionreturn){var spinner=addActivitySpinner(activityElement),promises=ajax.call([{methodname:"core_course_get_module",args:{id:cmid,sectionreturn:sectionreturn}}],!0);$.when.apply($,promises).done((function(data){removeSpinner(activityElement,spinner,400),replaceActivityHtmlWith(data)})).fail((function(){removeSpinner(activityElement,spinner)}))}(mainelement,cmid,sectionreturn)}}})})),{initCoursePage:function(courseformat){$("body").on("click keypress",SELECTOR.ACTIVITYLI+" "+SELECTOR.ACTIVITYACTION+"[data-action]",(function(e){if("keypress"!==e.type||13===e.keyCode){var actionItem=$(this),moduleElement=actionItem.closest(SELECTOR.ACTIVITYLI),action=actionItem.attr("data-action"),moduleId=getModuleId(moduleElement);switch(action){case"moveleft":case"moveright":case"delete":case"duplicate":case"hide":case"stealth":case"show":case"groupsseparate":case"groupsvisible":case"groupsnone":break;default:return}moduleId&&(e.preventDefault(),"delete"===action?confirmDeleteModule(moduleElement,(function(){editModule(moduleElement,moduleId,actionItem)})):editModule(moduleElement,moduleId,actionItem))}})),$("body").on("click keypress",SELECTOR.SECTIONLI+" "+SELECTOR.SECTIONACTIONMENU+"[data-sectionid] a[data-action]",(function(e){if("keypress"!==e.type||13===e.keyCode){var message,onconfirm,actionItem=$(this),sectionElement=actionItem.closest(SELECTOR.SECTIONLI),sectionId=actionItem.closest(SELECTOR.SECTIONACTIONMENU).attr("data-sectionid");e.preventDefault(),actionItem.attr("data-confirm")?(message=actionItem.attr("data-confirm"),onconfirm=function(){editSection(sectionElement,sectionId,actionItem,courseformat)},str.get_strings([{key:"confirm"},{key:"yes"},{key:"no"}]).done((function(s){notification.confirm(s[0],message,s[1],s[2],onconfirm)}))):editSection(sectionElement,sectionId,actionItem,courseformat)}})),str.get_string("numberweeks").done((function(strNumberSections){var trigger=$(SELECTOR.ADDSECTIONS),modalTitle=trigger.attr("data-add-sections"),newSections=trigger.attr("data-new-sections"),modalBody=$('<div><label for="add_section_numsections"></label> <input id="add_section_numsections" type="number" min="1" max="'+newSections+'" value="1"></div>');modalBody.find("label").html(strNumberSections),ModalFactory.create({title:modalTitle,type:ModalFactory.types.SAVE_CANCEL,body:modalBody.html()},trigger).done((function(modal){var numSections=$(modal.getBody()).find("#add_section_numsections"),addSections=function(){""+parseInt(numSections.val())===numSections.val()&&parseInt(numSections.val())>=1&&(document.location=trigger.attr("href")+"&numsections="+parseInt(numSections.val()))};modal.setSaveButtonText(modalTitle),modal.getRoot().on(ModalEvents.shown,(function(){numSections.focus().select().on("keydown",(function(e){e.keyCode===KeyCodes.enter&&addSections()}))})),modal.getRoot().on(ModalEvents.save,(function(e){e.preventDefault(),addSections()}))}))}))},replaceSectionActionItem:function(sectionelement,selector,image,stringname,stringcomponent,newaction){log.debug("replaceSectionActionItem() is deprecated and will be removed.");var actionitem=sectionelement.find(SELECTOR.SECTIONACTIONMENU+" "+selector);replaceActionItem(actionitem,image,stringname,stringcomponent,newaction)}}}));
/**
 * A javascript module to handle course ajax actions.
 *
 * @module     core_course/repository
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_course/repository",["jquery","core/ajax"],(function($,Ajax){return{getEnrolledCoursesByTimelineClassification:function(classification,limit,offset,sort){var args={classification:classification};void 0!==limit&&(args.limit=limit),void 0!==offset&&(args.offset=offset),void 0!==sort&&(args.sort=sort);var request={methodname:"core_course_get_enrolled_courses_by_timeline_classification",args:args};return Ajax.call([request])[0]},getLastAccessedCourses:function(userid,limit,offset,sort){var args={};void 0!==userid&&(args.userid=userid),void 0!==limit&&(args.limit=limit),void 0!==offset&&(args.offset=offset),void 0!==sort&&(args.sort=sort);var request={methodname:"core_course_get_recent_courses",args:args};return Ajax.call([request])[0]},getUsersFromCourseModuleID:function(cmid,groupID){var request={methodname:"core_course_get_enrolled_users_by_cmid",args:{cmid:cmid,groupid:groupID}};return Ajax.call([request])[0]}}}));
/**
 * This module depends on the real jquery - and returns the non-global version of it.
 *
 * @module     core_customfield/form
 * @package    core_customfield
 * @copyright  2018 Toni Barbera
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_customfield/form",["jquery","core/str","core/notification","core/ajax","core/templates","core/sortable_list","core/pending","core/inplace_editable"],(function($,Str,Notification,Ajax,Templates,SortableList,Pending){var confirmDelete=function(id,type,component,area,itemid){var pendingPromise=new Pending("core_customfield/form:confirmDelete");Str.get_strings([{key:"confirm"},{key:"confirmdelete"+type,component:"core_customfield"},{key:"yes"},{key:"no"}]).then((function(s){Notification.confirm(s[0],s[1],s[2],s[3],(function(){var pendingDeletePromise=new Pending("core_customfield/form:confirmDelete"),func="field"===type?"core_customfield_delete_field":"core_customfield_delete_category";Ajax.call([{methodname:func,args:{id:id}},{methodname:"core_customfield_reload_template",args:{component:component,area:area,itemid:itemid}}])[1].then((function(response){return Templates.render("core_customfield/list",response)})).then((function(html,js){return Templates.replaceNode($('[data-region="list-page"]'),html,js),null})).then(pendingDeletePromise.resolve).catch(Notification.exception)}))})).then(pendingPromise.resolve).catch(Notification.exception)};return{init:function(){var mainlist=$("#customfield_catlist"),component=mainlist.attr("data-component"),area=mainlist.attr("data-area"),itemid=mainlist.attr("data-itemid");$("[data-role=deletefield]").on("click",(function(e){confirmDelete($(this).attr("data-id"),"field",component,area,itemid),e.preventDefault()})),$("[data-role=deletecategory]").on("click",(function(e){confirmDelete($(this).attr("data-id"),"category",component,area,itemid),e.preventDefault()})),$("[data-role=addnewcategory]").on("click",(function(){!function(component,area,itemid){var categoryid,pendingPromise=new Pending("core_customfield/form:confirmDelete"),promises=Ajax.call([{methodname:"core_customfield_create_category",args:{component:component,area:area,itemid:itemid}},{methodname:"core_customfield_reload_template",args:{component:component,area:area,itemid:itemid}}]);promises[0].then((function(response){return categoryid=response,null})).catch(Notification.exception),promises[1].then((function(response){return Templates.render("core_customfield/list",response)})).then((function(html,js){return Templates.replaceNode($('[data-region="list-page"]'),html,js),window.location.href="#category-"+categoryid,null})).catch(Notification.exception),Promise.all(promises).then(pendingPromise.resolve).catch()}(component,area,itemid)}));var categoryName=function(element){return element.closest("[data-category-id]").find("[data-inplaceeditable][data-itemtype=category][data-component=core_customfield]").attr("data-value")};new SortableList($("#customfield_catlist .categorieslist"),{moveHandlerSelector:".movecategory [data-drag-type=move]"}).getElementName=function(el){return $.Deferred().resolve(categoryName(el))},$("[data-category-id]").on("sortablelist-drop",(function(evt,info){if(info.positionChanged){var pendingPromise=new Pending("core_customfield/form:categoryid:on:sortablelist-drop");Ajax.call([{methodname:"core_customfield_move_category",args:{id:info.element.data("category-id"),beforeid:info.targetNextElement.data("category-id")}}])[0].then(pendingPromise.resolve).catch(Notification.exception)}evt.stopPropagation()})),new SortableList($("#customfield_catlist .fieldslist tbody"),{moveHandlerSelector:".movefield [data-drag-type=move]"}).getDestinationName=function(parentElement,afterElement){return afterElement.length?afterElement.attr("data-field-name")?Str.get_string("afterfield","customfield",afterElement.attr("data-field-name")):$.Deferred().resolve(""):Str.get_string("totopofcategory","customfield",categoryName(parentElement))},$("[data-field-name]").on("sortablelist-drop",(function(evt,info){if(evt.stopPropagation(),info.positionChanged){var pendingPromise=new Pending("core_customfield/form:fieldname:on:sortablelist-drop");Ajax.call([{methodname:"core_customfield_move_field",args:{id:info.element.data("field-id"),beforeid:info.targetNextElement.data("field-id"),categoryid:Number(info.targetList.closest("[data-category-id]").attr("data-category-id"))}}])[0].then(pendingPromise.resolve).catch(Notification.exception)}})),$("[data-field-name]").on("sortablelist-drag",(function(evt){var pendingPromise=new Pending("core_customfield/form:fieldname:on:sortablelist-drag");evt.stopPropagation(),Str.get_string("therearenofields","core_customfield").then((function(s){return $("#customfield_catlist .categorieslist").children().each((function(){var fields=$(this).find($(".field")),nofields=$(this).find($(".nofields"));fields.length||nofields.length||$(this).find("tbody").append('<tr class="nofields"><td colspan="5">'+s+"</td></tr>"),fields.length&&nofields.length&&nofields.remove()})),null})).then(pendingPromise.resolve).catch(Notification.exception)})),$("[data-category-id], [data-field-name]").on("sortablelist-dragstart",(function(evt,info){setTimeout((function(){$(".sortable-list-is-dragged").width(info.element.width())}),501)}))}}}));
define("core_form/events",["exports","core/str"],(function(_exports,_str){
/**
   * Contain the events the form component can trigger.
   *
   * @module core_form/events
   * @package core_form
   * @copyright 2021 Huong Nguyen <huongnv13@gmail.com>
   * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   * @since 3.10
   */
var changesMadeString;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.triggerUploadStarted=_exports.triggerUploadCompleted=_exports.formEventTypes=void 0,(0,_str.get_string)("changesmadereallygoaway","moodle").then((function(string){return changesMadeString=string,string})).catch();var changesMadeCheck=function(e){e&&(e.returnValue=changesMadeString)},formEventTypes={uploadStarted:"core_form/uploadStarted",uploadCompleted:"core_form/uploadCompleted"};_exports.formEventTypes=formEventTypes;_exports.triggerUploadStarted=function(elementId){window.addEventListener("beforeunload",changesMadeCheck);var customEvent=new CustomEvent(formEventTypes.uploadStarted,{bubbles:!0,cancellable:!1});return document.getElementById(elementId).dispatchEvent(customEvent),customEvent};_exports.triggerUploadCompleted=function(elementId){window.removeEventListener("beforeunload",changesMadeCheck);var customEvent=new CustomEvent(formEventTypes.uploadCompleted,{bubbles:!0,cancellable:!1});return document.getElementById(elementId).dispatchEvent(customEvent),customEvent}}));
/**
 * Functionality for the form element defaultcustom
 *
 * @module     core_form/defaultcustom
 * @package    core_form
 * @class      defaultcustom
 * @copyright  2017 Marina Glancy
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.3
 */
define("core_form/defaultcustom",["jquery"],(function($){$("body").on("change","input[data-defaultcustom=true]",(function(event){var element=$(event.target),defaultvalue=JSON.parse(element.attr("data-defaultvalue")),customvalue=JSON.parse(element.attr("data-customvalue")),type=element.attr("data-type"),form=element.closest("form"),elementName=element.attr("name").replace(/\[customize\]$/,"[value]"),newvalue=element.prop("checked")?customvalue:defaultvalue;"text"===type?form.find('[name="'+elementName+'"]').val(newvalue):"date_selector"===type?(form.find('[name="'+elementName+'[day]"]').val(newvalue.day),form.find('[name="'+elementName+'[month]"]').val(newvalue.month),form.find('[name="'+elementName+'[year]"]').val(newvalue.year)):"date_time_selector"===type&&(form.find('[name="'+elementName+'[day]"]').val(newvalue.day),form.find('[name="'+elementName+'[month]"]').val(newvalue.month),form.find('[name="'+elementName+'[year]"]').val(newvalue.year),form.find('[name="'+elementName+'[hour]"]').val(newvalue.hour),form.find('[name="'+elementName+'[minute]"]').val(newvalue.minute))}))}));
/**
 * Password Unmask functionality.
 *
 * @module     core_form/passwordunmask
 * @package    core_form
 * @class      passwordunmask
 * @copyright  2016 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.2
 */
define("core_form/passwordunmask",["jquery","core/templates"],(function($,Template){var PasswordUnmask=function(elementid){this.wrapperSelector='[data-passwordunmask="wrapper"][data-passwordunmaskid="'+elementid+'"]',this.wrapper=$(this.wrapperSelector),this.editorSpace=this.wrapper.find('[data-passwordunmask="editor"]'),this.editLink=this.wrapper.find('a[data-passwordunmask="edit"]'),this.editInstructions=this.wrapper.find('[data-passwordunmask="instructions"]'),this.displayValue=this.wrapper.find('[data-passwordunmask="displayvalue"]'),this.inputFieldLabel=$('label[for="'+elementid+'"]'),this.inputField=this.editorSpace.find(document.getElementById(elementid)),this.inputField.attr("type","hidden"),this.inputField.removeClass("hiddenifjs"),this.editInstructions.attr("id")||this.editInstructions.attr("id",elementid+"_instructions"),this.editInstructions.hide(),this.setDisplayValue(),this.addListeners()};return PasswordUnmask.prototype.addListeners=function(){return this.wrapper.on("click keypress",'[data-passwordunmask="edit"]',$.proxy((function(e){"keypress"===e.type&&13!==e.keyCode||(e.stopImmediatePropagation(),e.preventDefault(),"hidden"!==this.inputField.attr("type")?"click"===e.type||$(e.relatedTarget).is(":input")?this.turnEditingOff(!1):this.turnEditingOff(!0):this.turnEditingOn())}),this)),this.wrapper.on("click keypress",'[data-passwordunmask="unmask"]',$.proxy((function(e){"keypress"===e.type&&13!==e.keyCode||(e.stopImmediatePropagation(),e.preventDefault(),this.wrapper.data("unmasked",!this.wrapper.data("unmasked")),this.setDisplayValue())}),this)),this.wrapper.on("keydown","input",$.proxy((function(e){"keydown"===e.type&&13!==e.keyCode||(e.stopImmediatePropagation(),e.preventDefault(),this.turnEditingOff(!0))}),this)),this.inputFieldLabel.on("click",$.proxy((function(e){e.preventDefault(),this.turnEditingOn()}),this)),this},PasswordUnmask.prototype.checkFocusOut=function(e){this.isEditing()&&window.setTimeout($.proxy((function(){var relatedTarget=e.relatedTarget||document.activeElement;this.wrapper.has($(relatedTarget)).length||this.turnEditingOff(!$(relatedTarget).is(":input,a"))}),this),100)},PasswordUnmask.prototype.passwordVisible=function(){return!!this.wrapper.data("unmasked")},PasswordUnmask.prototype.isEditing=function(){return"hidden"!==this.inputField.attr("type")},PasswordUnmask.prototype.turnEditingOn=function(){var value=this.getDisplayValue();return this.passwordVisible()?this.inputField.attr("type","text"):this.inputField.attr("type","password"),this.inputField.val(value),this.inputField.attr("size",this.inputField.attr("data-size")),this.editInstructions.length&&(this.inputField.attr("aria-describedby",this.editInstructions.attr("id")),this.editInstructions.show()),this.wrapper.attr("data-passwordunmask-visible",1),this.editLink.hide(),this.inputField.focus().select(),$("body").on("focusout",this.wrapperSelector,$.proxy(this.checkFocusOut,this)),this},PasswordUnmask.prototype.turnEditingOff=function(focusOnEditLink){$("body").off("focusout",this.wrapperSelector,this.checkFocusOut);var value=this.getDisplayValue();return this.inputField.attr("type","hidden").attr("aria-describedby",null),this.inputField.val(value),this.editInstructions.hide(),this.wrapper.removeAttr("data-passwordunmask-visible"),this.inputField.removeAttr("size"),this.editLink.show(),this.setDisplayValue(),focusOnEditLink&&this.editLink.focus(),this},PasswordUnmask.prototype.getDisplayValue=function(){return this.inputField.val()},PasswordUnmask.prototype.setDisplayValue=function(){var value=this.getDisplayValue();return this.isEditing()&&(this.wrapper.data("unmasked")?this.inputField.attr("type","text"):this.inputField.attr("type","password"),this.inputField.val(value)),value&&this.wrapper.data("unmasked")?this.displayValue.text(value):(value||(value=""),Template.render("core_form/element-passwordunmask-fill",{element:{frozen:this.inputField.is("[readonly]"),value:value,valuechars:value.split("")}}).done($.proxy((function(html,js){this.displayValue.html(html),Template.runTemplateJS(js)}),this))),this},PasswordUnmask}));
define("core_form/submit",["exports","core_form/events"],(function(_exports,_events){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0;
/**
   * Submit button JavaScript. All submit buttons will be automatically disabled once the form is
   * submitted, unless that submission results in an error/cancelling the submit.
   *
   * @module core_form/submit
   * @package core_form
   * @copyright 2019 The Open University
   * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   * @since 3.8
   */
var cookieListener=0,cookieListeningButtons=[],getCookieName=function(){return"moodledownload_"+M.cfg.sesskey},clearDownloadCookie=function(){document.cookie=encodeURIComponent(getCookieName())+"=deleted; expires="+new Date(0).toUTCString()};_exports.init=function(elementId){var button=document.getElementById(elementId);document.addEventListener(_events.formEventTypes.uploadStarted,(function(e){window.console.log(e.target),button.disabled=!0})),document.addEventListener(_events.formEventTypes.uploadCompleted,(function(e){window.console.log(e.target),button.disabled=!1})),"off"!==button.form.dataset.doubleSubmitProtection&&button.form.addEventListener("submit",(function(event){var disableAction=function(){event.defaultPrevented||button.disabled||(button.disabled=!0,clearDownloadCookie(),function(button){cookieListeningButtons.push(button),cookieListener||(cookieListener=setInterval((function(){2==document.cookie.split(getCookieName()+"=").length&&(clearDownloadCookie(),clearInterval(cookieListener),cookieListener=0,cookieListeningButtons.forEach((function(button){button.disabled=!1})))}),500))}(button))};window.addEventListener("beforeunload",disableAction),setTimeout((function(){window.removeEventListener("beforeunload",disableAction)}),0)}),!1)}}));
/**
 * A class to help show and hide advanced form content.
 *
 * @module     core_form/showadvanced
 * @class      showadvanced
 * @package    core_form
 * @copyright  2016 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_form/showadvanced",["jquery","core/log","core/str","core/notification"],(function($,Log,Strings,Notification){var SELECTORS_FIELDSETCONTAINSADVANCED="fieldset.containsadvancedelements",SELECTORS_DIVFITEMADVANCED="div.fitem.advanced",SELECTORS_DIVADVANCEDSECTION="div#form-advanced-div",SELECTORS_MORELESSLINK="fieldset.containsadvancedelements .moreless-toggler",CSS_SHOW="show",CSS_MORELESSACTIONS="moreless-actions",CSS_MORELESSTOGGLER="moreless-toggler",CSS_SHOWLESS="moreless-less",WRAPPERS_FITEM='<div class="fitem"></div>',WRAPPERS_FELEMENT='<div class="felement"></div>',WRAPPERS_ADVANCEDDIV='<div id="form-advanced-div"></div>',uniqIdSeed=0,ShowAdvanced=function(id){this.id=id;var form=$(document.getElementById(id));this.enhanceForm(form)};return ShowAdvanced.prototype.id="",ShowAdvanced.prototype.enhanceForm=function(form){return form.find(SELECTORS_FIELDSETCONTAINSADVANCED).each(function(index,item){this.enhanceFieldset($(item))}.bind(this)),form.on("click",SELECTORS_MORELESSLINK,this.switchState),form.on("keydown",SELECTORS_MORELESSLINK,function(e){return 13!=e.which&&32!=e.which||this.switchState(e)}.bind(this)),this},ShowAdvanced.prototype.generateId=function(node){var id=node.prop("id");return void 0===id&&(id="showadvancedid-"+uniqIdSeed++,node.prop("id",id)),id},ShowAdvanced.prototype.enhanceFieldset=function(fieldset){var statuselement=$("input[name=mform_showmore_"+fieldset.prop("id")+"]");return statuselement.length?(Strings.get_strings([{key:"showmore",component:"core_form"},{key:"showless",component:"core_form"}]).then(function(results){var showmore=results[0],showless=results[1],morelesslink=$('<a href="#"></a>');morelesslink.addClass(CSS_MORELESSTOGGLER),"0"===statuselement.val()?(morelesslink.html(showmore),morelesslink.attr("aria-expanded","false")):(morelesslink.html(showless),morelesslink.attr("aria-expanded","true"),morelesslink.addClass(CSS_SHOWLESS),fieldset.find(SELECTORS_DIVFITEMADVANCED).addClass(CSS_SHOW));var idlist=[];fieldset.find(SELECTORS_DIVFITEMADVANCED).each(function(index,node){idlist[idlist.length]=this.generateId($(node))}.bind(this)),morelesslink.attr("role","button"),morelesslink.attr("aria-controls","form-advanced-div");var formadvancedsection=$(WRAPPERS_ADVANCEDDIV);fieldset.find(SELECTORS_DIVFITEMADVANCED).wrapAll(formadvancedsection);var fitem=$(WRAPPERS_FITEM);fitem.addClass(CSS_MORELESSACTIONS);var felement=$(WRAPPERS_FELEMENT);return felement.append(morelesslink),fitem.append(felement),fieldset.find(SELECTORS_DIVADVANCEDSECTION).before(fitem),!0}.bind(this)).fail(Notification.exception),this):(Log.debug("M.form.showadvanced::processFieldset was called on an fieldset without a status field: '"+fieldset.prop("id")+"'"),this)},ShowAdvanced.prototype.switchState=function(e){return e.preventDefault(),Strings.get_strings([{key:"showmore",component:"core_form"},{key:"showless",component:"core_form"}]).then((function(results){var showmore=results[0],showless=results[1],fieldset=$(e.target).closest(SELECTORS_FIELDSETCONTAINSADVANCED);fieldset.find(SELECTORS_DIVFITEMADVANCED).toggleClass(CSS_SHOW);var statuselement=$("input[name=mform_showmore_"+fieldset.prop("id")+"]");return"0"===statuselement.val()?(statuselement.val(1),$(e.target).addClass(CSS_SHOWLESS),$(e.target).html(showless),$(e.target).attr("aria-expanded","true")):(statuselement.val(0),$(e.target).removeClass(CSS_SHOWLESS),$(e.target).html(showmore),$(e.target).attr("aria-expanded","false")),!0})).fail(Notification.exception),this},{init:function(formid){return new ShowAdvanced(formid)}}}));
/**
 * This module allows to enhance the form elements MoodleQuickForm_filetypes
 *
 * @module     core_form/filetypes
 * @package    core_form
 * @copyright  2017 David Mudrak <david@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.3
 */
define("core_form/filetypes",["jquery","core/log","core/str","core/modal_factory","core/modal_events","core/ajax","core/templates","core/tree"],(function($,Log,Str,ModalFactory,ModalEvents,Ajax,Templates,Tree){var FileTypes=function(elementId,elementLabel,onlyTypes,allowAll){this.elementId=elementId,this.elementLabel=elementLabel,this.onlyTypes=onlyTypes,this.allowAll=allowAll,this.inputField=$("#"+elementId),this.wrapperBrowserTrigger=$('[data-filetypesbrowser="'+elementId+'"]'),this.wrapperDescriptions=$('[data-filetypesdescriptions="'+elementId+'"]'),this.wrapperBrowserTrigger.length&&(this.inputField.length&&this.wrapperDescriptions.length?this.prepareBrowserTrigger().then(function(){return this.prepareBrowserModal()}.bind(this)).then(function(){return this.prepareBrowserTree()}.bind(this)):Log.error("core_form/filetypes: Unexpected DOM structure, unable to enhance filetypes field "+elementId))};return FileTypes.prototype.prepareBrowserTrigger=function(){return Templates.render("core_form/filetypes-trigger",{}).then(function(html){this.wrapperBrowserTrigger.html(html),this.browserTrigger=this.wrapperBrowserTrigger.find('[data-filetypeswidget="browsertrigger"]')}.bind(this))},FileTypes.prototype.prepareBrowserModal=function(){return ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:this.elementLabel}).then(function(modal){this.browserModal=modal}.bind(this)).then(function(){this.browserModal.getRoot().on(ModalEvents.hidden,function(){this.browserTrigger.focus()}.bind(this)),this.browserModal.getRoot().on(ModalEvents.save,function(){this.saveBrowserModal()}.bind(this))}.bind(this))},FileTypes.prototype.prepareBrowserTree=function(){return this.browserTrigger.on("click",function(e){if(e.preventDefault(),!this.inputField.is("[disabled]")){var bodyContent=this.loadBrowserModalBody();bodyContent.then(function(){this.browserTree=new Tree(this.browserModal.getBody()),this.browserTree.handleKeyDown=function(item,e){e.keyCode==this.browserTree.keys.enter||e.keyCode==this.browserTree.keys.space?(e.preventDefault(),e.stopPropagation(),this.toggleCheckbox(item.attr("data-filetypesbrowserkey"))):Tree.prototype.handleKeyDown.call(this.browserTree,item,e)}.bind(this),this.allowAll&&(this.hideOrShowItemsDependingOnAllowAll(this.browserModal.getRoot().find('input[type="checkbox"][data-filetypesbrowserkey="*"]').first()),this.browserModal.getRoot().on("change",'input[type="checkbox"][data-filetypesbrowserkey="*"]',function(e){this.hideOrShowItemsDependingOnAllowAll($(e.currentTarget))}.bind(this))),this.browserModal.getRoot().on("change",'input[type="checkbox"][data-filetypesbrowserkey]',function(e){var checkbox=$(e.currentTarget),key=checkbox.attr("data-filetypesbrowserkey");this.browserModal.getRoot().find('input[type="checkbox"][data-filetypesbrowserkey="'+key+'"]').prop("checked",checkbox.prop("checked"))}.bind(this))}.bind(this)).then(function(){this.browserModal.show()}.bind(this)),this.browserModal.setBody(bodyContent)}}.bind(this)),$.when()},FileTypes.prototype.loadBrowserModalBody=function(){var args={onlytypes:this.onlyTypes.join(),allowall:this.allowAll,current:this.inputField.val()};return Ajax.call([{methodname:"core_form_get_filetypes_browser_data",args:args}])[0].then(function(browserData){return Templates.render("core_form/filetypes-browser",{elementid:this.elementId,groups:browserData.groups})}.bind(this))},FileTypes.prototype.toggleCheckbox=function(key){var checkbox=this.browserModal.getRoot().find('input[type="checkbox"][data-filetypesbrowserkey="'+key+'"]').first();checkbox.prop("checked",!checkbox.prop("checked"))},FileTypes.prototype.saveBrowserModal=function(){if(this.allowAll){var allcheckbox=this.browserModal.getRoot().find('input[type="checkbox"][data-filetypesbrowserkey="*"]');if(allcheckbox.length&&allcheckbox.prop("checked"))return this.inputField.val("*"),void this.updateDescriptions(["*"])}var newvalue=[];this.browserModal.getRoot().find('input[type="checkbox"]').each((function(){var checkbox=$(this),key=checkbox.attr("data-filetypesbrowserkey");checkbox.prop("checked")&&newvalue.push(key)})),newvalue=newvalue.filter((function(x,i,a){return a.indexOf(x)==i})),this.inputField.val(newvalue.join(" ")),this.updateDescriptions(newvalue)},FileTypes.prototype.updateDescriptions=function(keys){var descriptions=[];keys.forEach(function(key){descriptions.push({description:this.browserModal.getRoot().find('[data-filetypesname="'+key+'"]').first().text().trim(),extensions:this.browserModal.getRoot().find('[data-filetypesextensions="'+key+'"]').first().text().trim()})}.bind(this));var templatedata={hasdescriptions:descriptions.length>0,descriptions:descriptions};return Templates.render("core_form/filetypes-descriptions",templatedata).then(function(html){this.wrapperDescriptions.html(html)}.bind(this))},FileTypes.prototype.hideOrShowItemsDependingOnAllowAll=function(allcheckbox){var others=this.browserModal.getRoot().find('[role="treeitem"][data-filetypesbrowserkey!="*"]');allcheckbox.prop("checked")?others.hide():others.show()},{init:function(elementId,elementLabel,onlyTypes,allowAll){new FileTypes(elementId,elementLabel,onlyTypes,allowAll)}}}));
define("core_grades/grades/grader/gradingpanel/point",["exports","./repository","core_grades/grades/grader/gradingpanel/comparison","jquery","./normalise"],(function(_exports,_repository,_comparison,_jquery,_normalise){var obj;function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.storeCurrentGrade=_exports.fetchCurrentGrade=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};_exports.fetchCurrentGrade=function(){return(0,_repository.fetchGrade)("point").apply(void 0,arguments)};var fn,_ref,storeCurrentGrade=(fn=regeneratorRuntime.mark((function _callee(component,context,itemname,userId,notifyUser,rootNode){var form,grade;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(form=rootNode.querySelector("form"),(grade=form.querySelector('input[name="grade"]')).checkValidity()&&grade.value.trim()){_context.next=4;break}return _context.abrupt("return",_normalise.invalidResult);case 4:if(!0!==(0,_comparison.compareData)(form)){_context.next=10;break}return _context.next=7,(0,_repository.saveGrade)("point")(component,context,itemname,userId,notifyUser,(0,_jquery.default)(form).serialize());case 7:return _context.abrupt("return",_context.sent);case 10:return _context.abrupt("return","");case 11:case"end":return _context.stop()}}),_callee)})),_ref=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(_x,_x2,_x3,_x4,_x5,_x6){return _ref.apply(this,arguments)});_exports.storeCurrentGrade=storeCurrentGrade}));
define("core_grades/grades/grader/gradingpanel/scale",["exports","./repository","core_grades/grades/grader/gradingpanel/comparison","jquery","./normalise"],(function(_exports,_repository,_comparison,_jquery,_normalise){var obj;
/**
   * Grading panel for simple direct grading.
   *
   * @module     core_grades/grades/grader/gradingpanel/scale
   * @package    core_grades
   * @copyright  2019 Andrew Nicols <andrew@nicols.co.uk>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.storeCurrentGrade=_exports.fetchCurrentGrade=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};_exports.fetchCurrentGrade=function(){return(0,_repository.fetchGrade)("scale").apply(void 0,arguments)};_exports.storeCurrentGrade=function(component,context,itemname,userId,notifyUser,rootNode){var form=rootNode.querySelector("form"),grade=form.querySelector('select[name="grade"]');return grade.checkValidity()&&grade.value.trim()?!0===(0,_comparison.compareData)(form)?(0,_repository.saveGrade)("scale")(component,context,itemname,userId,notifyUser,(0,_jquery.default)(form).serialize()):"":_normalise.invalidResult}}));
define("core_grades/grades/grader/gradingpanel/comparison",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.fillInitialValues=_exports.compareData=void 0;
/**
   * Compare a given form's values and its previously set data attributes.
   *
   * @module     core_grades/grades/grader/gradingpanel/comparison
   * @package    core_grades
   * @copyright  2019 Mathew May <mathew.solutions>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
var fillInitialValues=function(form){Array.prototype.forEach.call(form.elements,(function(input){"submit"!==input.type&&"button"!==input.type&&("radio"===input.type||"checkbox"===input.type?input.dataset.initialValue=JSON.stringify(input.checked):void 0!==input.value?input.dataset.initialValue=JSON.stringify(input.value):"select-one"===input.type&&Array.prototype.forEach.call(input.options,(function(option){option.dataset.initialValue=JSON.stringify(option.selected)})))}))};_exports.fillInitialValues=fillInitialValues;_exports.compareData=function(form){var result=Array.prototype.some.call(form.elements,(function(input){if("submit"===input.type||"button"===input.type)return!1;if("radio"===input.type||"checkbox"===input.type){if(void 0!==input.dataset.initialValue)return input.dataset.initialValue!==JSON.stringify(input.checked)}else if(void 0!==input.value){if(void 0!==input.dataset.initialValue)return input.dataset.initialValue!==JSON.stringify(input.value)}else if("select-one"===input.type)return Array.prototype.some.call(input.options,(function(option){return void 0!==option.dataset.initialValue&&option.dataset.initialValue!==JSON.stringify(option.selected)}));return!0}));return fillInitialValues(form),result}}));
define("core_grades/grades/grader/gradingpanel/normalise",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.normaliseResult=_exports.invalidResult=_exports.failedUpdate=void 0;_exports.normaliseResult=function(result){return{result:result,failed:!!result.warnings.length,success:!result.warnings.length,error:null}};_exports.invalidResult=function(){return{success:!1,failed:!1,result:{},error:null}};_exports.failedUpdate=function(error){return{success:!1,failed:!0,result:{},error:error}}}));
define("core_grades/grades/grader/gradingpanel/repository",["exports","core/ajax","./normalise"],(function(_exports,_ajax,_normalise){function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.saveGrade=_exports.fetchGrade=void 0;_exports.fetchGrade=function(type){return function(component,contextid,itemname,gradeduserid){return(0,_ajax.call)([{methodname:"core_grades_grader_gradingpanel_".concat(type,"_fetch"),args:{component:component,contextid:contextid,itemname:itemname,gradeduserid:gradeduserid}}])[0]}};_exports.saveGrade=function(type){return fn=regeneratorRuntime.mark((function _callee(component,contextid,itemname,gradeduserid,notifyUser,formdata){return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.t0=_normalise.normaliseResult,_context.next=3,(0,_ajax.call)([{methodname:"core_grades_grader_gradingpanel_".concat(type,"_store"),args:{component:component,contextid:contextid,itemname:itemname,gradeduserid:gradeduserid,notifyuser:notifyUser,formdata:formdata}}])[0];case 3:return _context.t1=_context.sent,_context.abrupt("return",(0,_context.t0)(_context.t1));case 5:case"end":return _context.stop()}}),_callee)})),_ref=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(_x,_x2,_x3,_x4,_x5,_x6){return _ref.apply(this,arguments)};var fn,_ref}}));
/**
 * Enhance the gradebook tree setup with various facilities.
 *
 * @module     core_grades/edittree_index
 * @package    core_grades
 * @copyright  2016 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_grades/edittree_index",["jquery"],(function($){var edittree=function edittree(){$("body").on("change",".weightoverride",edittree.toggleWeightInput),$("#menumoveafter").on("change",(function(){var form=$(this).closest("form");form.find("#bulkmoveinput").val(1),form.submit()}))};return edittree.toggleWeightInput=function(e){e.preventDefault();var node=$(this),row=node.closest("tr");$('input[name="weight_'+row.data("itemid")+'"]').prop("disabled",!node.prop("checked"))},{enhance:edittree}}));
define("core_h5p/editor_display",["exports","jquery"],(function(_exports,_jquery){var obj;
/**
   * This module handles the display of the H5P authoring tool.
   *
   * @module     core_h5p/editor_display
   * @package    core_h5p
   * @copyright  2020 Victor Deniz <victor@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};_exports.init=function(elementId){var editorwrapper=(0,_jquery.default)("#"+elementId),editor=(0,_jquery.default)(".h5p-editor"),mform=editor.closest("form"),editorupload=(0,_jquery.default)("h5p-editor-upload"),h5plibrary=(0,_jquery.default)('input[name="h5plibrary"]'),h5pparams=(0,_jquery.default)('input[name="h5pparams"]'),inputname=(0,_jquery.default)('input[name="name"]'),h5paction=(0,_jquery.default)('input[name="h5paction"]');h5paction.val("create"),H5PEditor.init(mform,h5paction,editorupload,editorwrapper,editor,h5plibrary,h5pparams,"",inputname,(function($button){return $button.is('[name="cancel"]')})),document.querySelector("#"+elementId+" iframe").setAttribute("name","h5p-editor")}}));
/**
 * Controls the message drawer.
 *
 * @module     core_message/message_drawer
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer",["jquery","core/custom_interaction_events","core/pubsub","core_message/message_drawer_view_contact","core_message/message_drawer_view_contacts","core_message/message_drawer_view_conversation","core_message/message_drawer_view_group_info","core_message/message_drawer_view_overview","core_message/message_drawer_view_search","core_message/message_drawer_view_settings","core_message/message_drawer_router","core_message/message_drawer_routes","core_message/message_drawer_events","core/pending","core/drawer"],(function($,CustomEvents,PubSub,ViewContact,ViewContacts,ViewConversation,ViewGroupInfo,ViewOverview,ViewSearch,ViewSettings,Router,Routes,Events,Pending,Drawer){var SELECTORS_DRAWER='[data-region="right-hand-drawer"]',SELECTORS_JUMPTO='.popover-region [data-region="jumpto"]',SELECTORS_PANEL_BODY_CONTAINER='[data-region="panel-body-container"]',SELECTORS_PANEL_HEADER_CONTAINER='[data-region="panel-header-container"]',SELECTORS_VIEW_CONTACT='[data-region="view-contact"]',SELECTORS_VIEW_CONTACTS='[data-region="view-contacts"]',SELECTORS_VIEW_CONVERSATION='[data-region="view-conversation"]',SELECTORS_VIEW_GROUP_INFO='[data-region="view-group-info"]',SELECTORS_VIEW_OVERVIEW='[data-region="view-overview"]',SELECTORS_VIEW_SEARCH='[data-region="view-search"]',SELECTORS_VIEW_SETTINGS='[data-region="view-settings"]',SELECTORS_ROUTES="[data-route]",SELECTORS_ROUTES_BACK="[data-route-back]",SELECTORS_HEADER_CONTAINER='[data-region="header-container"]',SELECTORS_BODY_CONTAINER='[data-region="body-container"]',SELECTORS_FOOTER_CONTAINER='[data-region="footer-container"]',SELECTORS_CLOSE_BUTTON='[data-action="closedrawer"]',routes=[[Routes.VIEW_CONTACT,SELECTORS_VIEW_CONTACT,ViewContact.show,ViewContact.description],[Routes.VIEW_CONTACTS,SELECTORS_VIEW_CONTACTS,ViewContacts.show,ViewContacts.description],[Routes.VIEW_CONVERSATION,SELECTORS_VIEW_CONVERSATION,ViewConversation.show,ViewConversation.description],[Routes.VIEW_GROUP_INFO,SELECTORS_VIEW_GROUP_INFO,ViewGroupInfo.show,ViewGroupInfo.description],[Routes.VIEW_OVERVIEW,SELECTORS_VIEW_OVERVIEW,ViewOverview.show,ViewOverview.description],[Routes.VIEW_SEARCH,SELECTORS_VIEW_SEARCH,ViewSearch.show,ViewSearch.description],[Routes.VIEW_SETTINGS,SELECTORS_VIEW_SETTINGS,ViewSettings.show,ViewSettings.description]],createRoutes=function(namespace,root){routes.forEach((function(route){Router.add(namespace,route[0],function(namespace,root,selector){var header=root.find(SELECTORS_HEADER_CONTAINER).find(selector);header.length||(header=root.find(SELECTORS_PANEL_HEADER_CONTAINER).find(selector));var body=root.find(SELECTORS_BODY_CONTAINER).find(selector);body.length||(body=root.find(SELECTORS_PANEL_BODY_CONTAINER).find(selector));var footer=root.find(SELECTORS_FOOTER_CONTAINER).find(selector);return[namespace,header.length?header:null,body.length?body:null,footer.length?footer:null]}(namespace,root,route[1]),route[2],route[3])}))},show=function(namespace,root){root.attr("data-shown")||(Router.go(namespace,Routes.VIEW_OVERVIEW),root.attr("data-shown",!0));var drawerRoot=Drawer.getDrawerRoot(root);drawerRoot.length&&Drawer.show(drawerRoot)},hide=function(root){var drawerRoot=Drawer.getDrawerRoot(root);drawerRoot.length&&Drawer.hide(drawerRoot)},setJumpFrom=function(buttonid){$(SELECTORS_DRAWER).attr("data-origin",buttonid)},registerEventListeners=function(namespace,root,alwaysVisible){CustomEvents.define(root,[CustomEvents.events.activate]);var paramRegex=/^data-route-param-?(\d*)$/;root.on(CustomEvents.events.activate,SELECTORS_ROUTES,(function(e,data){for(var element=$(e.target).closest(SELECTORS_ROUTES),route=element.attr("data-route"),attributes=[],i=0;i<element[0].attributes.length;i++)attributes.push(element[0].attributes[i]);var paramAttributes=attributes.filter((function(attribute){var name=attribute.nodeName;return paramRegex.test(name)}));paramAttributes.sort((function(a,b){var aParts=paramRegex.exec(a.nodeName),bParts=paramRegex.exec(b.nodeName),aIndex=aParts.length>1?aParts[1]:0,bIndex=bParts.length>1?bParts[1]:0;return aIndex<bIndex?-1:bIndex<aIndex?1:0}));var params=paramAttributes.map((function(attribute){return attribute.nodeValue})),routeParams=[namespace,route].concat(params);Router.go.apply(null,routeParams),data.originalEvent.preventDefault()})),root.on(CustomEvents.events.activate,SELECTORS_ROUTES_BACK,(function(e,data){Router.back(namespace),data.originalEvent.preventDefault()})),root.on("hide.bs.collapse",".collapse",(function(e){var pendingPromise=new Pending;$(e.target).one("hidden.bs.collapse",(function(){pendingPromise.resolve()}))})),root.on("show.bs.collapse",".collapse",(function(e){var pendingPromise=new Pending;$(e.target).one("shown.bs.collapse",(function(){pendingPromise.resolve()}))})),$(SELECTORS_JUMPTO).focus((function(){var firstInput=$(SELECTORS_HEADER_CONTAINER).find("input:visible");firstInput.length?firstInput.focus():$(SELECTORS_HEADER_CONTAINER).find(SELECTORS_ROUTES_BACK).focus()})),$(SELECTORS_DRAWER).focus((function(){var button=$(this).attr("data-origin");button&&$("#"+button).focus()})),alwaysVisible||(PubSub.subscribe(Events.SHOW,(function(){show(namespace,root)})),PubSub.subscribe(Events.HIDE,(function(){hide(root)})),PubSub.subscribe(Events.TOGGLE_VISIBILITY,(function(buttonid){!function(root){var drawerRoot=Drawer.getDrawerRoot(root);return!drawerRoot.length||Drawer.isVisible(drawerRoot)}(root)?(show(namespace,root),setJumpFrom(buttonid),$(SELECTORS_JUMPTO).attr("tabindex",0)):(hide(root),$(SELECTORS_JUMPTO).attr("tabindex",-1))}))),PubSub.subscribe(Events.SHOW_CONVERSATION,(function(args){setJumpFrom(args.buttonid),show(namespace,root),Router.go(namespace,Routes.VIEW_CONVERSATION,args.conversationid)})),root.find(SELECTORS_CLOSE_BUTTON).on(CustomEvents.events.activate,(function(){PubSub.publish(Events.TOGGLE_VISIBILITY)})),PubSub.subscribe(Events.CREATE_CONVERSATION_WITH_USER,(function(args){setJumpFrom(args.buttonid),show(namespace,root),Router.go(namespace,Routes.VIEW_CONVERSATION,null,"create",args.userid)})),PubSub.subscribe(Events.SHOW_SETTINGS,(function(){show(namespace,root),Router.go(namespace,Routes.VIEW_SETTINGS)})),PubSub.subscribe(Events.PREFERENCES_UPDATED,(function(preferences){var filteredPreferences=preferences.filter((function(preference){return"message_entertosend"==preference.type})),enterToSendPreference=filteredPreferences.length?filteredPreferences[0]:null;enterToSendPreference&&root.find(SELECTORS_FOOTER_CONTAINER).find(SELECTORS_VIEW_CONVERSATION).attr("data-enter-to-send",enterToSendPreference.value)}))};return{init:function(root,uniqueId,alwaysVisible,route){if(root=$(root),createRoutes(uniqueId,root),registerEventListeners(uniqueId,root,alwaysVisible),alwaysVisible&&(show(uniqueId,root),route)){var routeParams=route.params||[];routeParams=[uniqueId,route.path].concat(routeParams),Router.go.apply(null,routeParams)}}}}));
/**
 * Retrieves messages from the server.
 *
 * @module     core_message/message_repository
 * @class      message_repository
 * @package    message
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_repository",["jquery","core/ajax","core/notification","core_message/message_drawer_view_conversation_constants"],(function($,Ajax,Notification,Constants){var CONVERSATION_TYPES=Constants.CONVERSATION_TYPES,sendMessagesToUser=function(toUserId,messages){var request={methodname:"core_message_send_instant_messages",args:{messages:messages.map((function(message){return{touserid:toUserId,text:message}}))}};return Ajax.call([request])[0].then((function(results){var errors=results.reduce((function(carry,result){return result.errormessage&&carry.push(result.errormessage),carry}),[]);if(errors.length)throw new Error(errors.join("\n"));return results})).then((function(results){return results.map((function(result){return{id:result.msgid,text:result.text,timecreated:result.timecreated,useridfrom:result.useridfrom,conversationid:result.conversationid,candeletemessagesforallusers:result.candeletemessagesforallusers}}))}))},sendMessagesToConversation=function(conversationId,messages){var request={methodname:"core_message_send_messages_to_conversation",args:{conversationid:conversationId,messages:messages.map((function(message){return{text:message}}))}};return Ajax.call([request])[0]};return{query:function(args){void 0===args.limit&&(args.limit=0),void 0===args.offset&&(args.offset=0),void 0===args.type&&(args.type=null),void 0===args.favouritesonly&&(args.favouritesonly=!1),args.limitfrom=args.offset,args.limitnum=args.limit,delete args.limit,delete args.offset;var request={methodname:"core_message_data_for_messagearea_conversations",args:args},promise=Ajax.call([request])[0];return promise.fail(Notification.exception),promise},countUnreadConversations:function(args){var request={methodname:"core_message_get_unread_conversations_count",args:args},promise=Ajax.call([request])[0];return promise.fail(Notification.exception),promise},markAllAsRead:function(args){var request={methodname:"core_message_mark_all_messages_as_read",args:args},promise=Ajax.call([request])[0];return promise.fail(Notification.exception),promise},getContacts:function(userId,limit,offset){var args={userid:userId};void 0!==limit&&(args.limitnum=limit),void 0!==offset&&(args.limitfrom=offset);var request={methodname:"core_message_get_user_contacts",args:args};return Ajax.call([request])[0]},getProfile:function(userId,profileUserId){var request={methodname:"core_message_data_for_messagearea_get_profile",args:{currentuserid:userId,otheruserid:profileUserId}};return Ajax.call([request])[0]},blockUser:function(userId,blockedUserId){var requests=[{methodname:"core_message_block_user",args:{userid:userId,blockeduserid:blockedUserId}},{methodname:"core_message_get_member_info",args:{referenceuserid:userId,userids:[blockedUserId],includecontactrequests:!0,includeprivacyinfo:!0}}];return $.when.apply(null,Ajax.call(requests)).then((function(reponse1,profiles){return profiles.length?profiles[0]:{}}))},unblockUser:function(userId,unblockedUserId){var requests=[{methodname:"core_message_unblock_user",args:{userid:userId,unblockeduserid:unblockedUserId}},{methodname:"core_message_get_member_info",args:{referenceuserid:userId,userids:[unblockedUserId],includecontactrequests:!0,includeprivacyinfo:!0}}];return $.when.apply(null,Ajax.call(requests)).then((function(reponse1,profiles){return profiles.length?profiles[0]:{}}))},createContactRequest:function(userId,requestUserIds){var request={methodname:"core_message_create_contact_request",args:{userid:userId,requesteduserid:requestUserIds}};return Ajax.call([request])[0]},deleteContacts:function(userId,contactUserIds){var requests=[{methodname:"core_message_delete_contacts",args:{userid:userId,userids:contactUserIds}},{methodname:"core_message_get_member_info",args:{referenceuserid:userId,userids:contactUserIds,includecontactrequests:!0,includeprivacyinfo:!0}}];return $.when.apply(null,Ajax.call(requests)).then((function(response1,profiles){return profiles}))},getMessages:function(currentUserId,conversationId,limit,offset,newestFirst,timeFrom){var args={currentuserid:currentUserId,convid:conversationId,newest:!!newestFirst};void 0!==limit&&(args.limitnum=limit),void 0!==offset&&(args.limitfrom=offset),void 0!==timeFrom&&(args.timefrom=timeFrom);var request={methodname:"core_message_get_conversation_messages",args:args};return Ajax.call([request])[0]},searchUsers:function(userId,searchString,limit,offset){var args={userid:userId,search:searchString};void 0!==limit&&(args.limitnum=limit),void 0!==offset&&(args.limitfrom=offset);var request={methodname:"core_message_message_search_users",args:args};return Ajax.call([request])[0]},searchMessages:function(userId,searchString,limit,offset){var args={userid:userId,search:searchString};void 0!==limit&&(args.limitnum=limit),void 0!==offset&&(args.limitfrom=offset);var request={methodname:"core_message_data_for_messagearea_search_messages",args:args};return Ajax.call([request])[0]},sendMessagesToUser:sendMessagesToUser,sendMessageToUser:function(toUserId,text){return sendMessagesToUser(toUserId,[text]).then((function(results){return results[0]}))},sendMessagesToConversation:sendMessagesToConversation,sendMessageToConversation:function(conversationId,text){return sendMessagesToConversation(conversationId,[text]).then((function(result){return result[0]}))},savePreferences:function(userId,preferences){var request={methodname:"core_user_update_user_preferences",args:{userid:userId,preferences:preferences}};return Ajax.call([request])[0]},getPreferences:function(userId){var request={methodname:"core_user_get_user_preferences",args:{userid:userId}};return Ajax.call([request])[0]},deleteMessages:function(userId,messageIds){return $.when.apply(null,Ajax.call(messageIds.map((function(messageId){return{methodname:"core_message_delete_message",args:{messageid:messageId,userid:userId}}}))))},deleteMessagesForAllUsers:function(userId,messageIds){return $.when.apply(null,Ajax.call(messageIds.map((function(messageId){return{methodname:"core_message_delete_message_for_all_users",args:{messageid:messageId,userid:userId}}}))))},deleteConversation:function(userId,conversationId){var request={methodname:"core_message_delete_conversations_by_id",args:{userid:userId,conversationids:[conversationId]}};return Ajax.call([request])[0]},getContactRequests:function(userId){var request={methodname:"core_message_get_contact_requests",args:{userid:userId}};return Ajax.call([request])[0]},acceptContactRequest:function(sendingUserId,recipientUserId){var requests=[{methodname:"core_message_confirm_contact_request",args:{userid:sendingUserId,requesteduserid:recipientUserId}},{methodname:"core_message_get_member_info",args:{referenceuserid:recipientUserId,userids:[sendingUserId],includecontactrequests:!0,includeprivacyinfo:!0}}];return $.when.apply(null,Ajax.call(requests)).then((function(reponse1,profiles){return profiles.length?profiles[0]:{}}))},declineContactRequest:function(sendingUserId,recipientUserId){var requests=[{methodname:"core_message_decline_contact_request",args:{userid:sendingUserId,requesteduserid:recipientUserId}},{methodname:"core_message_get_member_info",args:{referenceuserid:recipientUserId,userids:[sendingUserId],includecontactrequests:!0,includeprivacyinfo:!0}}];return $.when.apply(null,Ajax.call(requests)).then((function(reponse1,profiles){return profiles.length?profiles[0]:{}}))},getConversation:function(loggedInUserId,conversationId,includeContactRequests,includePrivacyInfo,memberLimit,memberOffset,messageLimit,messageOffset,newestMessagesFirst){var args={userid:loggedInUserId,conversationid:conversationId};null!=includeContactRequests&&(args.includecontactrequests=includeContactRequests),null!=includePrivacyInfo&&(args.includeprivacyinfo=includePrivacyInfo),null!=memberLimit&&(args.memberlimit=memberLimit),null!=memberOffset&&(args.memberoffset=memberOffset),null!=messageLimit&&(args.messagelimit=messageLimit),null!=messageOffset&&(args.messageoffset=messageOffset),null!=newestMessagesFirst&&(args.newestmessagesfirst=newestMessagesFirst);var request={methodname:"core_message_get_conversation",args:args};return Ajax.call([request])[0]},getConversationBetweenUsers:function(loggedInUserId,otherUserId,includeContactRequests,includePrivacyInfo,memberLimit,memberOffset,messageLimit,messageOffset,newestMessagesFirst){var args={userid:loggedInUserId,otheruserid:otherUserId};null!=includeContactRequests&&(args.includecontactrequests=includeContactRequests),null!=includePrivacyInfo&&(args.includeprivacyinfo=includePrivacyInfo),null!=memberLimit&&(args.memberlimit=memberLimit),null!=memberOffset&&(args.memberoffset=memberOffset),null!=messageLimit&&(args.messagelimit=messageLimit),null!=messageOffset&&(args.messageoffset=messageOffset),null!=newestMessagesFirst&&(args.newestmessagesfirst=newestMessagesFirst);var request={methodname:"core_message_get_conversation_between_users",args:args};return Ajax.call([request])[0]},getSelfConversation:function(loggedInUserId,messageLimit,messageOffset,newestMessagesFirst){var args={userid:loggedInUserId};null!=messageLimit&&(args.messagelimit=messageLimit),null!=messageOffset&&(args.messageoffset=messageOffset),null!=newestMessagesFirst&&(args.newestmessagesfirst=newestMessagesFirst);var request={methodname:"core_message_get_self_conversation",args:args};return Ajax.call([request])[0]},getConversations:function(userId,type,limit,offset,favourites,mergeself){var args={userid:userId,type:type};null!=limit&&(args.limitnum=limit),null!=offset&&(args.limitfrom=offset),null!=favourites&&(args.favourites=favourites),null!=mergeself&&(args.mergeself=mergeself);var request={methodname:"core_message_get_conversations",args:args};return Ajax.call([request])[0].then((function(result){return result.conversations.length&&(result.conversations=result.conversations.map((function(conversation){if(conversation.type==CONVERSATION_TYPES.PRIVATE||conversation.type==CONVERSATION_TYPES.SELF){var otherUser=conversation.members.length?conversation.members[0]:null;otherUser&&(conversation.name=conversation.name?conversation.name:otherUser.fullname,conversation.imageurl=conversation.imageurl?conversation.imageurl:otherUser.profileimageurl)}return conversation}))),result}))},getConversationMembers:function(conversationId,loggedInUserId,limit,offset,includeContactRequests){var args={userid:loggedInUserId,conversationid:conversationId};null!=limit&&(args.limitnum=limit),null!=offset&&(args.limitfrom=offset),null!=includeContactRequests&&(args.includecontactrequests=includeContactRequests);var request={methodname:"core_message_get_conversation_members",args:args};return Ajax.call([request])[0]},setFavouriteConversations:function(userId,conversationIds){var request={methodname:"core_message_set_favourite_conversations",args:{userid:userId,conversations:conversationIds}};return Ajax.call([request])[0]},setMutedConversations:function(userId,conversationIds){var request={methodname:"core_message_mute_conversations",args:{userid:userId,conversationids:conversationIds}};return Ajax.call([request])[0]},unsetFavouriteConversations:function(userId,conversationIds){var request={methodname:"core_message_unset_favourite_conversations",args:{userid:userId,conversations:conversationIds}};return Ajax.call([request])[0]},unsetMutedConversations:function(userId,conversationIds){var request={methodname:"core_message_unmute_conversations",args:{userid:userId,conversationids:conversationIds}};return Ajax.call([request])[0]},getMemberInfo:function(referenceUserId,userIds,includeContactRequests,includePrivacyInfo){var args={referenceuserid:referenceUserId,userids:userIds};void 0!==includeContactRequests&&(args.includecontactrequests=includeContactRequests),void 0!==includePrivacyInfo&&(args.includeprivacyinfo=includePrivacyInfo);var request={methodname:"core_message_get_member_info",args:args};return Ajax.call([request])[0]},markAllConversationMessagesAsRead:function(userId,conversationId){var request={methodname:"core_message_mark_all_conversation_messages_as_read",args:{userid:userId,conversationid:conversationId}};return Ajax.call([request])[0]},getUserMessagePreferences:function(userId){var request={methodname:"core_message_get_user_message_preferences",args:{userid:userId}};return Ajax.call([request])[0]},getTotalConversationCounts:function(userId){var request={methodname:"core_message_get_conversation_counts",args:{userid:userId}};return Ajax.call([request])[0]},getUnreadConversationCounts:function(userId){var request={methodname:"core_message_get_unread_conversation_counts",args:{userid:userId}};return Ajax.call([request])[0]},getAllConversationCounts:function(userId){var requests=[{methodname:"core_message_get_conversation_counts",args:{userid:userId}},{methodname:"core_message_get_unread_conversation_counts",args:{userid:userId}}];return $.when.apply(null,Ajax.call(requests)).then((function(total,unread){return{total:total,unread:unread}}))}}}));
/**
 * Module to add/remove contact using ajax.
 *
 * @module     core_message/toggle_contact_button
 * @class      toggle_contact_button
 * @package    message
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/toggle_contact_button",["jquery","core/ajax","core/templates","core/notification","core/custom_interaction_events"],(function($,Ajax,Templates,Notification,CustomEvents){var getUserId=function(element){return element.attr("data-userid")},isLoading=function(element){return element.hasClass("loading")||element.attr("disabled")},sendRequest=function(element,request){return isLoading(element)?$.Deferred():(element.addClass("loading"),element.attr("disabled","disabled"),Ajax.call([request])[0].fail(Notification.exception).always((function(){element.removeClass("loading"),element.removeAttr("disabled")})))};return{enhance:function(element){(element=$(element)).children(".loading-icon").length||Templates.render("core/loading",{}).done((function(html,js){element.append(html,js)})),CustomEvents.define(element,[CustomEvents.events.activate]),element.on(CustomEvents.events.activate,(function(e,data){!function(element){return"1"==element.attr("data-is-contact")}(element)?function(element){if(!isLoading(element)){var request={methodname:"core_message_create_contacts",args:{userids:[getUserId(element)]}};sendRequest(element,request).done((function(){!function(element){element.attr("data-is-contact","1")}(element),Templates.render("message/remove_contact_button",{}).done((function(html,js){Templates.replaceNodeContents(element,html,js)}))}))}}(element):function(element){if(!isLoading(element)){var request={methodname:"core_message_delete_contacts",args:{userids:[getUserId(element)]}};sendRequest(element,request).done((function(){!function(element){element.attr("data-is-contact","0")}(element),Templates.render("message/add_contact_button",{}).done((function(html,js){Templates.replaceNodeContents(element,html,js)}))}))}}(element),e.preventDefault(),data.originalEvent.preventDefault()}))}}}));
/**
 * Controls the settings page in the message drawer.
 *
 * @module     core_message/message_drawer_view_settings
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_view_settings",["jquery","core/notification","core/str","core/pubsub","core/templates","core_message/message_repository","core/custom_interaction_events","core_message/message_drawer_events"],(function($,Notification,Str,PubSub,Templates,Repository,CustomEvents,MessageDrawerEvents){var SELECTORS_CHECKBOX='input[type="checkbox"]',SELECTORS_SETTINGS='[data-region="settings"]',SELECTORS_PRIVACY_PREFERENCE='[data-preference="blocknoncontacts"] input[type="radio"]',SELECTORS_NOTIFICATIONS_PREFERENCE='[data-preference="notifications"] input[type="checkbox"]',SELECTORS_ENTER_TO_SEND_PREFERENCE='[data-preference="entertosend"] input[type="checkbox"]',SELECTORS_NOTIFICATION_PREFERENCES_CONTAINER='[data-region="notification-preference-container"]',SELECTORS_CONTENT_CONTAINER='[data-region="content-container"]',SELECTORS_PLACEHOLDER_CONTAINER='[data-region="placeholder-container"]',TEMPLATES_NOTIFICATION_PREFERENCES="core_message/message_drawer_view_settings_body_content_notification_preferences",savePreferences=function(loggedInUserId,preferences){return Repository.savePreferences(loggedInUserId,preferences).then((function(){PubSub.publish(MessageDrawerEvents.PREFERENCES_UPDATED,preferences)})).catch(Notification.exception)},init=function(body,loggedInUserId){Repository.getUserMessagePreferences(loggedInUserId).then((function(response){!function(body,value){body.find(SELECTORS_PRIVACY_PREFERENCE).each((function(index,input){(input=$(input)).val()==value?input.prop("checked",!0):input.prop("checked",!1)}))}(body,response.blocknoncontacts),function(body,value){var checkbox=body.find(SELECTORS_ENTER_TO_SEND_PREFERENCE);value?checkbox.prop("checked",!0):checkbox.prop("checked",!1)}(body,response.entertosend);var notificationProcessors=[];response.preferences.components.length&&response.preferences.components.forEach((function(component){if(component.notifications.length&&component.notifications.filter((function(notification){return"message_provider_moodle_instantmessage"==notification.preferencekey})).length){var configuration=component.notifications[0];notificationProcessors=configuration.processors.map((function(processor){var checked=processor.loggedin.checked||processor.loggedoff.checked;return{displayname:processor.displayname,name:processor.name,checked:checked,locked:processor.locked,lockedmessage:processor.lockedmessage||null}}))}}));var container=body.find(SELECTORS_NOTIFICATION_PREFERENCES_CONTAINER);return!notificationProcessors.length||(container.removeClass("hidden"),Templates.render(TEMPLATES_NOTIFICATION_PREFERENCES,{processors:notificationProcessors}).then((function(html){return container.append(html),html})))})).then((function(){body.find(SELECTORS_CONTENT_CONTAINER).removeClass("hidden"),body.find(SELECTORS_PLACEHOLDER_CONTAINER).addClass("hidden"),function(body,loggedInUserId){var settingsContainer=body.find(SELECTORS_SETTINGS);CustomEvents.define(settingsContainer,[CustomEvents.events.activate]),settingsContainer.on(CustomEvents.events.activate,SELECTORS_NOTIFICATIONS_PREFERENCE,(function(e){var checkboxes=$(e.target).closest(SELECTORS_NOTIFICATION_PREFERENCES_CONTAINER).find(SELECTORS_CHECKBOX);if(checkboxes.length){var values=checkboxes.toArray().reduce((function(carry,checkbox){return(checkbox=$(checkbox)).prop("checked")&&carry.push(checkbox.attr("data-name")),carry}),[]),newValue=values.length?values.join(","):"none";savePreferences(loggedInUserId,[{type:"message_provider_moodle_instantmessage_loggedoff",value:newValue},{type:"message_provider_moodle_instantmessage_loggedin",value:newValue}])}})),settingsContainer.on("change",SELECTORS_PRIVACY_PREFERENCE,(function(e){var newValue=$(e.target).val();savePreferences(loggedInUserId,[{type:"message_blocknoncontacts",value:newValue}])})),settingsContainer.on(CustomEvents.events.activate,SELECTORS_ENTER_TO_SEND_PREFERENCE,(function(e){var newValue=$(e.target).prop("checked");savePreferences(loggedInUserId,[{type:"message_entertosend",value:newValue}])}))}(body,loggedInUserId)})).catch(Notification.exception)};return{show:function(namespace,header,body,footer,loggedInUserId){return body.attr("data-init")||(init(body,loggedInUserId),body.attr("data-init",!0)),$.Deferred().resolve().promise()},description:function(){return Str.get_string("messagedrawerviewsettings","core_message")}}}));
/**
 * Controls the requests section of the contacts page.
 *
 * @module     core_message/message_drawer_view_contacts_section_requests
 * @package    message
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_view_contacts_section_requests",["jquery","core/notification","core/pubsub","core/templates","core_message/message_repository","core_message/message_drawer_events","core_message/message_drawer_lazy_load_list"],(function($,Notification,PubSub,Templates,MessageRepository,MessageDrawerEvents,LazyLoadList){var SELECTORS_CONTACT_REQUEST='[data-region="contact-request"]',TEMPLATES_REQUESTS_LIST="core_message/message_drawer_view_contacts_body_section_requests_list",render=function(contentContainer,requests){var formattedRequests=requests.map((function(request){return{id:request.id,profileimageurl:request.profileimageurl,fullname:request.fullname}}));return Templates.render(TEMPLATES_REQUESTS_LIST,{requests:formattedRequests}).then((function(html){return contentContainer.append(html),html})).catch(Notification.exception)},load=function(listRoot,userId){return MessageRepository.getContactRequests(userId).then((function(requests){return LazyLoadList.setLoadedAll(listRoot,!0),requests})).catch(Notification.exception)},handleContactRequestProcessed=function(root){return function(request){root.find('[data-request-id="'+request.userid+'"]').remove(),root.find(SELECTORS_CONTACT_REQUEST).length||(LazyLoadList.showEmptyMessage(root),LazyLoadList.hideContent(root))}};return{show:function(root){root.attr("data-contacts-init")||(!function(root){PubSub.subscribe(MessageDrawerEvents.CONTACT_REQUEST_ACCEPTED,handleContactRequestProcessed(root)),PubSub.subscribe(MessageDrawerEvents.CONTACT_REQUEST_DECLINED,handleContactRequestProcessed(root))}(root),root.attr("data-contacts-init",!0)),LazyLoadList.show(root,load,render)}}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)
/**
 * Controls the search page of the message drawer.
 *
 * @module     core_message/message_drawer_view_search
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */}define("core_message/message_drawer_view_search",["jquery","core/custom_interaction_events","core/notification","core/pubsub","core/str","core/templates","core_message/message_repository","core_message/message_drawer_events"],(function($,CustomEvents,Notification,PubSub,Str,Templates,Repository,Events){var SELECTORS_BLOCK_ICON_CONTAINER='[data-region="block-icon-container"]',SELECTORS_CANCEL_SEARCH_BUTTON='[data-action="cancel-search"]',SELECTORS_CONTACTS_CONTAINER='[data-region="contacts-container"]',SELECTORS_CONTACTS_LIST='[data-region="contacts-container"] [data-region="list"]',SELECTORS_EMPTY_MESSAGE_CONTAINER='[data-region="empty-message-container"]',SELECTORS_LIST='[data-region="list"]',SELECTORS_LOADING_ICON_CONTAINER='[data-region="loading-icon-container"]',SELECTORS_LOADING_PLACEHOLDER='[data-region="loading-placeholder"]',SELECTORS_MESSAGES_LIST='[data-region="messages-container"] [data-region="list"]',SELECTORS_MESSAGES_CONTAINER='[data-region="messages-container"]',SELECTORS_NON_CONTACTS_CONTAINER='[data-region="non-contacts-container"]',SELECTORS_NON_CONTACTS_LIST='[data-region="non-contacts-container"] [data-region="list"]',SELECTORS_SEARCH_ICON_CONTAINER='[data-region="search-icon-container"]',SELECTORS_SEARCH_ACTION='[data-action="search"]',SELECTORS_SEARCH_INPUT='[data-region="search-input"]',SELECTORS_SEARCH_RESULTS_CONTAINER='[data-region="search-results-container"]',SELECTORS_LOAD_MORE_USERS='[data-action="load-more-users"]',SELECTORS_LOAD_MORE_MESSAGES='[data-action="load-more-messages"]',SELECTORS_BUTTON_TEXT='[data-region="button-text"]',SELECTORS_NO_RESULTS_CONTAINTER='[data-region="no-results-container"]',SELECTORS_ALL_CONTACTS_CONTAINER='[data-region="all-contacts-container"]',TEMPLATES_CONTACTS_LIST="core_message/message_drawer_contacts_list",TEMPLATES_NON_CONTACTS_LIST="core_message/message_drawer_non_contacts_list",TEMPLATES_MESSAGES_LIST="core_message/message_drawer_messages_list",getLoggedInUserId=function(body){return body.attr("data-user-id")},getEmptyMessageContainer=function(body){return body.find(SELECTORS_EMPTY_MESSAGE_CONTAINER)},getLoadingIconContainer=function(header){return header.find(SELECTORS_LOADING_ICON_CONTAINER)},getLoadingPlaceholder=function(body){return body.find(SELECTORS_LOADING_PLACEHOLDER)},getSearchIconContainer=function(header){return header.find(SELECTORS_SEARCH_ICON_CONTAINER)},getSearchInput=function(header){return header.find(SELECTORS_SEARCH_INPUT)},getSearchResultsContainer=function(body){return body.find(SELECTORS_SEARCH_RESULTS_CONTAINER)},getContactsContainer=function(body){return body.find(SELECTORS_CONTACTS_CONTAINER)},getNonContactsContainer=function(body){return body.find(SELECTORS_NON_CONTACTS_CONTAINER)},hideEmptyMessage=function(body){getEmptyMessageContainer(body).addClass("hidden")},hideLoadingIcon=function(header){getLoadingIconContainer(header).addClass("hidden")},hideLoadingPlaceholder=function(body){getLoadingPlaceholder(body).addClass("hidden")},showSearchIcon=function(header){getSearchIconContainer(header).removeClass("hidden")},hideSearchResults=function(body){getSearchResultsContainer(body).addClass("hidden")},clearAllSearchResults=function(body){body.find(SELECTORS_CONTACTS_LIST).empty(),body.find(SELECTORS_NON_CONTACTS_LIST).empty(),body.find(SELECTORS_MESSAGES_LIST).empty(),function(body){var container=getSearchResultsContainer(body);container.find(SELECTORS_ALL_CONTACTS_CONTAINER).removeClass("hidden"),container.find(SELECTORS_MESSAGES_CONTAINER).removeClass("hidden"),container.find(SELECTORS_NO_RESULTS_CONTAINTER).addClass("hidden")}(body),function(body){getSearchResultsContainer(body).find(SELECTORS_ALL_CONTACTS_CONTAINER).removeClass("hidden")}(body),function(body){getSearchResultsContainer(body).find(SELECTORS_CONTACTS_CONTAINER).removeClass("hidden")}(body),function(body){getSearchResultsContainer(body).find(SELECTORS_NON_CONTACTS_CONTAINER).removeClass("hidden")}(body),function(body){getSearchResultsContainer(body).find(SELECTORS_MESSAGES_CONTAINER).removeClass("hidden")}(body),showLoadMoreUsersButton(body),showLoadMoreMessagesButton(body)},startLoading=function(header,body){!function(header){getSearchIconContainer(header).addClass("hidden")}(header),hideEmptyMessage(body),hideSearchResults(body),function(header){getLoadingIconContainer(header).removeClass("hidden")}(header),function(body){getLoadingPlaceholder(body).removeClass("hidden")}(body),function(header){getSearchInput(header).prop("disabled",!0)}(header)},stopLoading=function(header,body){showSearchIcon(header),hideEmptyMessage(body),function(body){getSearchResultsContainer(body).removeClass("hidden")}(body),hideLoadingIcon(header),hideLoadingPlaceholder(body),function(header){getSearchInput(header).prop("disabled",!1)}(header)},hideUsersLoadingIcon=function(root){var button=root.find(SELECTORS_LOAD_MORE_USERS);button.prop("disabled",!1),button.find(SELECTORS_BUTTON_TEXT).removeClass("hidden"),button.find(SELECTORS_LOADING_ICON_CONTAINER).addClass("hidden")},showLoadMoreUsersButton=function(root){root.find(SELECTORS_LOAD_MORE_USERS).removeClass("hidden")},hideMessagesLoadingIcon=function(root){var button=root.find(SELECTORS_LOAD_MORE_MESSAGES);button.prop("disabled",!1),button.find(SELECTORS_BUTTON_TEXT).removeClass("hidden"),button.find(SELECTORS_LOADING_ICON_CONTAINER).addClass("hidden")},showLoadMoreMessagesButton=function(root){root.find(SELECTORS_LOAD_MORE_MESSAGES).removeClass("hidden")},findContact=function(root,userId){return root.find('[data-contact-user-id="'+userId+'"]')},highlightSearch=function(content,searchText){if(!content)return"";var regex=new RegExp("("+searchText+")","gi");return content.replace(regex,'<span class="matchtext">$1</span>')},renderMessages=function(root,messages){var container=root.find(SELECTORS_MESSAGES_CONTAINER),frompanel=root.attr("data-in-panel"),list=container.find(SELECTORS_LIST);return Templates.render(TEMPLATES_MESSAGES_LIST,{messages:messages,frompanel:frompanel}).then((function(html){return list.append(html),html}))},loadMoreUsers=function(root,loggedInUserId,text,limit,offset){var loadedAll=!1;return function(root){var button=root.find(SELECTORS_LOAD_MORE_USERS);button.prop("disabled",!0),button.find(SELECTORS_BUTTON_TEXT).addClass("hidden"),button.find(SELECTORS_LOADING_ICON_CONTAINER).removeClass("hidden")}(root),Repository.searchUsers(loggedInUserId,text,limit+1,offset).then((function(results){var contacts=results.contacts,noncontacts=results.noncontacts;return contacts.length<=limit&&noncontacts.length<=limit?(loadedAll=!0,{contacts:contacts,noncontacts:noncontacts}):{contacts:contacts.slice(0,limit),noncontacts:noncontacts.slice(0,limit)}})).then((function(results){var contactsCount=results.contacts.length,nonContactsCount=results.noncontacts.length;return contactsCount&&results.contacts.forEach((function(contact){contact.highlight=highlightSearch(contact.fullname,text)})),nonContactsCount&&results.noncontacts.forEach((function(contact){contact.highlight=highlightSearch(contact.fullname,text)})),$.when(!contactsCount||function(root,contacts){var container=getContactsContainer(root),frompanel=root.attr("data-in-panel"),list=container.find(SELECTORS_LIST);return Templates.render(TEMPLATES_CONTACTS_LIST,{contacts:contacts,frompanel:frompanel}).then((function(html){return list.append(html),html}))}(root,results.contacts),!nonContactsCount||function(root,nonContacts){var container=getNonContactsContainer(root),frompanel=root.attr("data-in-panel"),list=container.find(SELECTORS_LIST);return Templates.render(TEMPLATES_NON_CONTACTS_LIST,{noncontacts:nonContacts,frompanel:frompanel}).then((function(html){return list.append(html),html}))}(root,results.noncontacts)).then((function(){return{contactsCount:contactsCount,nonContactsCount:nonContactsCount}}))})).then((function(counts){return hideUsersLoadingIcon(root),loadedAll&&function(root){root.find(SELECTORS_LOAD_MORE_USERS).addClass("hidden")}(root),counts})).catch((function(error){throw hideUsersLoadingIcon(root),error}))},loadMoreMessages=function(root,loggedInUserId,text,limit,offset){var loadedAll=!1;return function(root){var button=root.find(SELECTORS_LOAD_MORE_MESSAGES);button.prop("disabled",!0),button.find(SELECTORS_BUTTON_TEXT).addClass("hidden"),button.find(SELECTORS_LOADING_ICON_CONTAINER).removeClass("hidden")}(root),Repository.searchMessages(loggedInUserId,text,limit+1,offset).then((function(results){var messages=results.contacts;return messages.length<=limit?(loadedAll=!0,messages):messages.slice(0,limit)})).then((function(messages){return messages.length?(messages.forEach((function(message){message.lastmessage=highlightSearch(message.lastmessage,text)})),renderMessages(root,messages).then((function(){return messages.length}))):messages.length})).then((function(count){return hideMessagesLoadingIcon(root),loadedAll&&function(root){root.find(SELECTORS_LOAD_MORE_MESSAGES).addClass("hidden")}(root),count})).catch((function(error){throw hideMessagesLoadingIcon(root),error}))},search=function(header,body,searchText,usersLimit,usersOffset,messagesLimit,messagesOffset){var loggedInUserId=getLoggedInUserId(body);return startLoading(header,body),clearAllSearchResults(body),$.when(loadMoreUsers(body,loggedInUserId,searchText,usersLimit,usersOffset),loadMoreMessages(body,loggedInUserId,searchText,messagesLimit,messagesOffset)).then((function(userCounts,messagesCount){var contactsCount=userCounts.contactsCount,nonContactsCount=userCounts.nonContactsCount;stopLoading(header,body),contactsCount||nonContactsCount||messagesCount?(contactsCount||nonContactsCount?(contactsCount||function(body){getSearchResultsContainer(body).find(SELECTORS_CONTACTS_CONTAINER).addClass("hidden")}(body),nonContactsCount||function(body){getSearchResultsContainer(body).find(SELECTORS_NON_CONTACTS_CONTAINER).addClass("hidden")}(body)):function(body){getSearchResultsContainer(body).find(SELECTORS_ALL_CONTACTS_CONTAINER).addClass("hidden")}(body),messagesCount||function(body){getSearchResultsContainer(body).find(SELECTORS_MESSAGES_CONTAINER).addClass("hidden")}(body)):function(body){var container=getSearchResultsContainer(body);container.find(SELECTORS_ALL_CONTACTS_CONTAINER).addClass("hidden"),container.find(SELECTORS_MESSAGES_CONTAINER).addClass("hidden"),container.find(SELECTORS_NO_RESULTS_CONTAINTER).removeClass("hidden")}(body)}))},registerEventListeners=function(header,body){var loggedInUserId=getLoggedInUserId(body),searchInput=getSearchInput(header),searchText="",messagesOffset=0,usersOffset=0,searchEventHandler=function(e,data){""!==(searchText=searchInput.val().trim())&&search(header,body,searchText,3,usersOffset=0,50,messagesOffset=0).then((function(){searchInput.focus(),usersOffset+=3,messagesOffset+=50})).catch(Notification.exception),data.originalEvent.preventDefault()};CustomEvents.define(searchInput,[CustomEvents.events.enter]),CustomEvents.define(header,[CustomEvents.events.activate]),CustomEvents.define(body,[CustomEvents.events.activate]),searchInput.on(CustomEvents.events.enter,searchEventHandler),header.on(CustomEvents.events.activate,SELECTORS_SEARCH_ACTION,searchEventHandler),body.on(CustomEvents.events.activate,SELECTORS_LOAD_MORE_MESSAGES,(function(e,data){""!==searchText&&loadMoreMessages(body,loggedInUserId,searchText,50,messagesOffset).then((function(){messagesOffset+=50})).catch(Notification.exception),data.originalEvent.preventDefault()})),body.on(CustomEvents.events.activate,SELECTORS_LOAD_MORE_USERS,(function(e,data){""!==searchText&&loadMoreUsers(body,loggedInUserId,searchText,50,usersOffset).then((function(){usersOffset+=50})).catch(Notification.exception),data.originalEvent.preventDefault()})),header.on(CustomEvents.events.activate,SELECTORS_CANCEL_SEARCH_BUTTON,(function(){!function(header){getSearchInput(header).val("")}(header),function(body){getEmptyMessageContainer(body).removeClass("hidden")}(body),showSearchIcon(header),hideSearchResults(body),hideLoadingIcon(header),hideLoadingPlaceholder(body),usersOffset=0,messagesOffset=0})),PubSub.subscribe(Events.CONTACT_ADDED,(function(userId){!function(root,contact){var nonContactsContainer=getNonContactsContainer(root),nonContact=findContact(nonContactsContainer,contact.userid);if(nonContact.length){nonContact.remove();var contactsContainer=getContactsContainer(root);contactsContainer.removeClass("hidden"),contactsContainer.find(SELECTORS_LIST).append(nonContact)}nonContactsContainer.find(SELECTORS_LIST).children().length||nonContactsContainer.addClass("hidden")}(body,userId)})),PubSub.subscribe(Events.CONTACT_REMOVED,(function(userId){!function(root,userId){var contactsContainer=getContactsContainer(root),contact=findContact(contactsContainer,userId);if(contact.length){contact.remove();var nonContactsContainer=getNonContactsContainer(root);nonContactsContainer.removeClass("hidden"),nonContactsContainer.find(SELECTORS_LIST).append(contact)}contactsContainer.find(SELECTORS_LIST).children().length||contactsContainer.addClass("hidden")}(body,userId)})),PubSub.subscribe(Events.CONTACT_BLOCKED,(function(userId){!function(root,userId){var contact=findContact(root,userId);contact.length&&contact.find(SELECTORS_BLOCK_ICON_CONTAINER).removeClass("hidden")}(body,userId)})),PubSub.subscribe(Events.CONTACT_UNBLOCKED,(function(userId){!function(root,userId){var contact=findContact(root,userId);contact.length&&contact.find(SELECTORS_BLOCK_ICON_CONTAINER).addClass("hidden")}(body,userId)}))};return{show:function(namespace,header,body){return body.attr("data-init")||(registerEventListeners(header,body),body.attr("data-init",!0)),getSearchInput(header).focus(),$.Deferred().resolve().promise()},description:function(namespace,header){if("object"!==_typeof(header))return Str.get_string("messagedrawerviewsearch","core_message");var searchText=getSearchInput(header).val().trim();return Str.get_string("messagedrawerviewsearch","core_message",searchText)}}}));
/**
 * Load the settings for a message processor.
 *
 * @module     core_message/notification_processor_settings
 * @class      notification_processor_settings
 * @package    message
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/notification_processor_settings",["jquery","core/ajax","core/str","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/fragment"],(function($,Ajax,Str,Notification,CustomEvents,Modal,ModalRegistry,Fragment){var registered=!1,SELECTORS_SAVE_BUTTON='[data-action="save"]',SELECTORS_CANCEL_BUTTON='[data-action="cancel"]',SELECTORS_PROCESSOR="[data-processor-name]",SELECTORS_PREFERENCE_ROW='[data-region="preference-row"]',NotificationProcessorSettings=function(root){Modal.call(this,root),this.name=null,this.userId=null,this.contextId=null,this.element=null,this.saveButton=this.getFooter().find(SELECTORS_SAVE_BUTTON),this.cancelButton=this.getFooter().find(SELECTORS_CANCEL_BUTTON)};return NotificationProcessorSettings.TYPE="core_message-notification_processor_settings",(NotificationProcessorSettings.prototype=Object.create(Modal.prototype)).constructor=NotificationProcessorSettings,NotificationProcessorSettings.prototype.setUserId=function(id){this.userId=id},NotificationProcessorSettings.prototype.getUserId=function(){return this.userId},NotificationProcessorSettings.prototype.setElement=function(element){this.element=element},NotificationProcessorSettings.prototype.getElement=function(){return this.element},NotificationProcessorSettings.prototype.setName=function(name){this.name=name},NotificationProcessorSettings.prototype.getName=function(){return this.name},NotificationProcessorSettings.prototype.setContextId=function(id){this.contextId=id},NotificationProcessorSettings.prototype.getContextId=function(){return this.contextId},NotificationProcessorSettings.prototype.getForm=function(){return this.getBody().find("form")},NotificationProcessorSettings.prototype.disableButtons=function(){this.saveButton.prop("disabled",!0),this.cancelButton.prop("disabled",!0)},NotificationProcessorSettings.prototype.enableButtons=function(){this.saveButton.prop("disabled",!1),this.cancelButton.prop("disabled",!1)},NotificationProcessorSettings.prototype.loadTitleContent=function(){return this.titlePromise=Str.get_string("processorsettings","message"),this.setTitle(this.titlePromise),this.titlePromise},NotificationProcessorSettings.prototype.loadBodyContent=function(){this.disableButtons();var args={userid:this.getUserId(),type:this.getName()};return this.bodyPromise=Fragment.loadFragment("message","processor_settings",this.getContextId(),args),this.setBody(this.bodyPromise),this.bodyPromise.then(function(){this.enableButtons()}.bind(this)).fail(Notification.exception),this.bodyPromise},NotificationProcessorSettings.prototype.loadAllContent=function(){return $.when(this.loadTitleContent(),this.loadBodyContent())},NotificationProcessorSettings.prototype.show=function(){this.loadAllContent(),Modal.prototype.show.call(this)},NotificationProcessorSettings.prototype.hide=function(){Modal.prototype.hide.call(this),this.setContextId(null),this.setName(null),this.setUserId(null)},NotificationProcessorSettings.prototype.updateConfiguredStatus=function(){var processorHeader=$(this.getElement()).closest(SELECTORS_PROCESSOR);if(!processorHeader.hasClass("unconfigured"))return!1;var processorName=processorHeader.attr("data-processor-name"),request={methodname:"core_message_get_message_processor",args:{name:processorName,userid:this.userId}};return Ajax.call([request])[0].fail(Notification.exception).done((function(result){if(result.userconfigured){var notifications=$(SELECTORS_PREFERENCE_ROW+' [data-processor-name="'+processorName+'"]');processorHeader.removeClass("unconfigured"),notifications.removeClass("disabled")}}))},NotificationProcessorSettings.prototype.registerEventListeners=function(){Modal.prototype.registerEventListeners.call(this),this.getModal().on(CustomEvents.events.activate,SELECTORS_SAVE_BUTTON,function(e,data){this.getForm().submit(),data.originalEvent.preventDefault()}.bind(this)),this.getModal().on("mpp:formsubmitted",function(e){this.hide(),this.updateConfiguredStatus(),e.stopPropagation()}.bind(this)),this.getModal().on(CustomEvents.events.activate,SELECTORS_CANCEL_BUTTON,function(e,data){this.hide(),data.originalEvent.preventDefault(),e.stopPropagation()}.bind(this))},registered||(ModalRegistry.register(NotificationProcessorSettings.TYPE,NotificationProcessorSettings,"core/modal_save_cancel"),registered=!0),NotificationProcessorSettings}));
/**
 * Controls the preference for an individual notification type on the
 * message preference page.
 *
 * @module     core_message/notification_preference
 * @class      notification_preference
 * @package    message
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/notification_preference",["jquery","core/ajax","core/notification","core_message/notification_processor"],(function($,Ajax,Notification,NotificationProcessor){var SELECTORS_PROCESSOR="[data-processor-name]",SELECTORS_STATE_INPUTS="[data-state] input",NotificationPreference=function(element,userId){this.root=$(element),this.userId=userId};return NotificationPreference.prototype.getPreferenceKey=function(){return this.root.attr("data-preference-key")},NotificationPreference.prototype.getLoggedInPreferenceKey=function(){return this.getPreferenceKey()+"_loggedin"},NotificationPreference.prototype.getLoggedOffPreferenceKey=function(){return this.getPreferenceKey()+"_loggedoff"},NotificationPreference.prototype.getProcessors=function(){return this.root.find(SELECTORS_PROCESSOR).map((function(index,element){return new NotificationProcessor($(element))}))},NotificationPreference.prototype.startLoading=function(){this.root.addClass("loading"),this.root.find(SELECTORS_STATE_INPUTS).prop("disabled",!0)},NotificationPreference.prototype.stopLoading=function(){this.root.removeClass("loading"),this.root.find(SELECTORS_STATE_INPUTS).prop("disabled",!1)},NotificationPreference.prototype.isLoading=function(){return this.root.hasClass("loading")},NotificationPreference.prototype.save=function(){if(this.isLoading())return $.Deferred().resolve();this.startLoading();var loggedInValue="",loggedOffValue="";this.getProcessors().each((function(index,processor){processor.isLoggedInEnabled()&&(""===loggedInValue?loggedInValue=processor.getName():loggedInValue+=","+processor.getName()),processor.isLoggedOffEnabled()&&(""===loggedOffValue?loggedOffValue=processor.getName():loggedOffValue+=","+processor.getName())})),""===loggedInValue&&(loggedInValue="none"),""===loggedOffValue&&(loggedOffValue="none");var request={methodname:"core_user_update_user_preferences",args:{userid:this.userId,preferences:[{type:this.getLoggedInPreferenceKey(),value:loggedInValue},{type:this.getLoggedOffPreferenceKey(),value:loggedOffValue}]}};return Ajax.call([request])[0].fail(Notification.exception).always(function(){this.stopLoading()}.bind(this))},NotificationPreference}));
/**
 * Controls the message preference page.
 *
 * @module     core_message/message_preferences
 * @class      message_preferences
 * @package    message
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_preferences",["jquery","core/ajax","core/notification","core_message/message_notification_preference","core/custom_interaction_events"],(function($,Ajax,Notification,MessageNotificationPreference,CustomEvents){var SELECTORS_PREFERENCE="[data-state]",SELECTORS_PREFERENCES_CONTAINER='[data-region="preferences-container"]',SELECTORS_CONTACTABLE_PRIVACY_CONTAINER='[data-region="privacy-setting-container"]',MessagePreferences=function(element){this.root=$(element),this.userId=this.root.find(SELECTORS_PREFERENCES_CONTAINER).attr("data-user-id"),this.registerEventListeners()};return MessagePreferences.prototype.preferencesDisabled=function(){return this.root.find(SELECTORS_PREFERENCES_CONTAINER).hasClass("disabled")},MessagePreferences.prototype.saveContactablePrivacySetting=function(){var container=this.root.find(SELECTORS_CONTACTABLE_PRIVACY_CONTAINER),value=$("input[type='radio']:checked").val();if(container.hasClass("loading"))return $.Deferred().resolve();container.addClass("loading");var request={methodname:"core_user_update_user_preferences",args:{userid:this.userId,preferences:[{type:container.attr("data-preference-key"),value:value}]}};return Ajax.call([request])[0].fail(Notification.exception).always((function(){container.removeClass("loading")}))},MessagePreferences.prototype.registerEventListeners=function(){CustomEvents.define(this.root,[CustomEvents.events.activate]),this.root.on("change",function(e){if("message_blocknoncontacts"==e.target.name)this.saveContactablePrivacySetting();else if(!this.preferencesDisabled()){var preferencesContainer=$(e.target).closest(SELECTORS_PREFERENCES_CONTAINER),preferenceElement=$(e.target).closest(SELECTORS_PREFERENCE),messagePreference=new MessageNotificationPreference(preferencesContainer,this.userId);preferenceElement.addClass("loading"),messagePreference.save().always((function(){preferenceElement.removeClass("loading")}))}}.bind(this))},MessagePreferences}));
/**
 * Module to message a user from their profile page.
 *
 * @module     core_message/message_user_button
 * @copyright  2019 Mark Nelson <markn@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_user_button",["jquery","core/custom_interaction_events","core_message/message_drawer_helper","core/templates"],(function($,CustomEvents,MessageDrawerHelper,Templates){var SELECTORS_MESSAGE_TEXTAREA='[data-region="send-message-txt"]',SELECTORS_MESSAGE_USER_BUTTON="#message-user-button",TEMPLATES_CONTENT="core_message/message_jumpto",getUserId=function(element){return parseInt(element.attr("data-userid"))},getConversationId=function(element){return parseInt(element.attr("data-conversationid"))};return{send:function(element){element=$(element);var args={conversationid:getConversationId(element),buttonid:$(element).attr("id"),userid:getUserId(element)};Templates.render(TEMPLATES_CONTENT,{}).then((function(html){element.after(html)})).then((function(){$(SELECTORS_MESSAGE_USER_BUTTON).next().focus((function(){$(SELECTORS_MESSAGE_TEXTAREA).focus()}))})),CustomEvents.define(element,[CustomEvents.events.activate]),element.on(CustomEvents.events.activate,(function(e,data){$(e.target).hasClass("active")?(MessageDrawerHelper.hide(),$(SELECTORS_MESSAGE_USER_BUTTON).next().attr("tabindex",-1)):($(SELECTORS_MESSAGE_USER_BUTTON).next().attr("tabindex",0),args.conversationid?MessageDrawerHelper.showConversation(args):MessageDrawerHelper.createConversationWithUser(args)),$(e.target).focus(),$(e.target).toggleClass("active"),e.preventDefault(),data.originalEvent.preventDefault()}))}}}));
/**
 * Controls the contacts page of the message drawer.
 *
 * @module     core_message/message_drawer_view_contacts
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_view_contacts",["jquery","core/pubsub","core/str","core_message/message_drawer_events","core_message/message_drawer_view_contacts_section_contacts","core_message/message_drawer_view_contacts_section_requests"],(function($,PubSub,Str,MessageDrawerEvents,ContactsSection,RequestsSection){var SELECTORS_ACTION_SHOW_CONTACTS_SECTION='[data-action="show-contacts-section"]',SELECTORS_ACTION_SHOW_REQUESTS_SECTION='[data-action="show-requests-section"]',SELECTORS_CONTACT_REQUEST_COUNT='[data-region="contact-request-count"]',SELECTORS_CONTACTS_SECTION_CONTAINER='[data-section="contacts"]',SELECTORS_REQUESTS_SECTION_CONTAINER='[data-section="requests"]',getContactsSectionContainer=function(body){return body.find(SELECTORS_CONTACTS_SECTION_CONTAINER)},getRequestsSectionContainer=function(body){return body.find(SELECTORS_REQUESTS_SECTION_CONTAINER)},getShowContactsAction=function(body){return body.find(SELECTORS_ACTION_SHOW_CONTACTS_SECTION)},getShowRequestsAction=function(body){return body.find(SELECTORS_ACTION_SHOW_REQUESTS_SECTION)},decrementContactRequestCount=function(body){return function(){var countContainer=body.find(SELECTORS_CONTACT_REQUEST_COUNT),count=parseInt(countContainer.text(),10);(count=isNaN(count)?0:count-1)<=0?countContainer.addClass("hidden"):countContainer.text(count)}};return{show:function(namespace,header,body,footer,tab){(body=$(body)).attr("data-contacts-init")||(!function(body){var contactsSection=getContactsSectionContainer(body),requestsSection=getRequestsSectionContainer(body),showContactsAction=getShowContactsAction(body),showRequestsAction=getShowRequestsAction(body);showContactsAction.on("show.bs.tab",(function(){ContactsSection.show(contactsSection)})),showRequestsAction.on("show.bs.tab",(function(){RequestsSection.show(requestsSection)})),PubSub.subscribe(MessageDrawerEvents.CONTACT_REQUEST_ACCEPTED,decrementContactRequestCount(body)),PubSub.subscribe(MessageDrawerEvents.CONTACT_REQUEST_DECLINED,decrementContactRequestCount(body))}(body),body.attr("data-contacts-init",!0));var contactsSection=getContactsSectionContainer(body),requestsSection=getRequestsSectionContainer(body);if(tab){var showContactsAction=getShowContactsAction(body),showRequestsAction=getShowRequestsAction(body);"requests"==tab?(showContactsAction.removeClass("active"),contactsSection.removeClass("show active"),showRequestsAction.addClass("active"),requestsSection.addClass("show active")):(showRequestsAction.removeClass("active"),requestsSection.removeClass("show active"),showContactsAction.addClass("active"),contactsSection.addClass("show active"))}return contactsSection.hasClass("active")?ContactsSection.show(contactsSection):RequestsSection.show(requestsSection),$.Deferred().resolve().promise()},description:function(){return Str.get_string("messagedrawerviewcontacts","core_message")}}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)
/**
 * Controls the conversation page in the message drawer.
 *
 * This function handles all of the user actions that the user can take
 * when interacting with the conversation page.
 *
 * It maintains a view state which is a data representation of the view
 * and only operates on that data.
 *
 * The view state is immutable and should never be modified directly. Instead
 * all changes to the view state should be done using the StateManager which
 * will generate a new version of the view state with the requested changes.
 *
 * After any changes to the view state the module will call the render function
 * to ask the renderer to update the UI.
 *
 * General rules for this module:
 * 1.) Never modify viewState directly. All changes should be via the StateManager.
 * 2.) Call render() with the new state when you want to update the UI
 * 3.) Never modify the UI directly in this module. This module is only concerned
 *     with the data in the view state.
 *
 * The general flow for a user interaction will be something like:
 * User interaction: User clicks "confirm block" button to block the other user
 *      1.) This module is hears the click
 *      2.) This module sends a request to the server to block the user
 *      3.) The server responds with the new user profile
 *      4.) This module generates a new state using the StateManager with the updated
 *          user profile.
 *      5.) This module asks the Patcher to generate a patch from the current state and
 *          the newly generated state. This patch tells the renderer what has changed
 *          between the states.
 *      6.) This module gives the Renderer the generated patch. The renderer updates
 *          the UI with changes according to the patch.
 *
 * @module     core_message/message_drawer_view_conversation
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */}define("core_message/message_drawer_view_conversation",["jquery","core/auto_rows","core/backoff_timer","core/custom_interaction_events","core/notification","core/pending","core/pubsub","core/str","core_message/message_repository","core_message/message_drawer_events","core_message/message_drawer_view_conversation_constants","core_message/message_drawer_view_conversation_patcher","core_message/message_drawer_view_conversation_renderer","core_message/message_drawer_view_conversation_state_manager","core_message/message_drawer_router","core_message/message_drawer_routes","core/emoji/auto_complete","core/emoji/picker"],(function($,AutoRows,BackOffTimer,CustomEvents,Notification,Pending,PubSub,Str,Repository,MessageDrawerEvents,Constants,Patcher,Renderer,StateManager,MessageDrawerRouter,MessageDrawerRoutes,initialiseEmojiAutoComplete,initialiseEmojiPicker){var stateCache={},viewState=null,loadedAllMessages=!1,messagesOffset=0,newMessagesPollTimer=null,isRendering=!1,renderBuffer=[],isResetting=!0,isSendingMessage=!1,isDeletingConversationContent=!1,sendMessageBuffer=[],render=null,renderers=[],NEWEST_FIRST=Constants.NEWEST_MESSAGES_FIRST,LOAD_MESSAGE_LIMIT=Constants.LOAD_MESSAGE_LIMIT,MILLISECONDS_IN_SEC=Constants.MILLISECONDS_IN_SEC,SELECTORS=Constants.SELECTORS,CONVERSATION_TYPES=Constants.CONVERSATION_TYPES,getOtherUserId=function(){if(!viewState||viewState.type==CONVERSATION_TYPES.PUBLIC)return null;var loggedInUserId=viewState.loggedInUserId;if(viewState.type==CONVERSATION_TYPES.SELF)return loggedInUserId;var otherUserIds=Object.keys(viewState.members).filter((function(userId){return loggedInUserId!=userId}));return otherUserIds.length?otherUserIds[0]:null},getMessagesOffset=function(){return messagesOffset},setMessagesOffset=function(value){messagesOffset=value,stateCache[viewState.id].messagesOffset=value},hasLoadedAllMessages=function(){return loadedAllMessages},setLoadedAllMessages=function(value){loadedAllMessages=value,stateCache[viewState.id].loadedAllMessages=value},formatConversationForEvent=function(state){return{id:state.id,name:state.name,subname:state.subname,imageUrl:state.imageUrl,isFavourite:state.isFavourite,isMuted:state.isMuted,type:state.type,totalMemberCount:state.totalMemberCount,loggedInUserId:state.loggedInUserId,messages:state.messages.map((function(message){return $.extend({},message)})),members:Object.keys(state.members).map((function(id){var formattedMember=$.extend({},state.members[id]);return formattedMember.contactrequests=state.members[id].contactrequests.map((function(request){return $.extend({},request)})),formattedMember}))}},updateStateFromConversation=function(conversation,loggedInUserId){var otherUser=null;if(conversation.type==CONVERSATION_TYPES.PRIVATE){var otherUsers=conversation.members.filter((function(member){return member.id!=loggedInUserId}));otherUser=otherUsers.length?otherUsers[0]:null}else conversation.type==CONVERSATION_TYPES.SELF&&(otherUser=conversation.members[0]);var name=conversation.name,imageUrl=conversation.imageurl;conversation.type!=CONVERSATION_TYPES.PUBLIC&&(name=name||otherUser?otherUser.fullname:"",imageUrl=imageUrl||otherUser?otherUser.profileimageurl:"");var newState=StateManager.addMembers(viewState,conversation.members);return newState=StateManager.setName(newState,name),newState=StateManager.setSubname(newState,conversation.subname),newState=StateManager.setType(newState,conversation.type),newState=StateManager.setImageUrl(newState,imageUrl),newState=StateManager.setTotalMemberCount(newState,conversation.membercount),newState=StateManager.setIsFavourite(newState,conversation.isfavourite),newState=StateManager.setIsMuted(newState,conversation.ismuted),newState=StateManager.addMessages(newState,conversation.messages),newState=StateManager.setCanDeleteMessagesForAllUsers(newState,conversation.candeletemessagesforallusers)},loadMessages=function(conversationId,limit,offset,newestFirst,ignoreList,timeFrom){return Repository.getMessages(viewState.loggedInUserId,conversationId,limit?limit+1:limit,offset,newestFirst,timeFrom).then((function(result){return result.id!=viewState.id&&(result.messages=[],result.id in stateCache&&delete stateCache[result.id]),result})).then((function(result){return result.messages.length&&ignoreList.length&&(result.messages=result.messages.filter((function(message){return ignoreList.indexOf(parseInt(message.id,10))<0}))),result})).then((function(result){return limit?(result.messages.length>limit?result.messages=result.messages.slice(0,-1):setLoadedAllMessages(!0),result):result})).then((function(result){var membersToAdd=result.members.filter((function(member){return!(member.id in viewState.members)})),newState=StateManager.addMembers(viewState,membersToAdd);return newState=StateManager.addMessages(newState,result.messages),newState=StateManager.setLoadingMessages(newState,!1),render(newState).then((function(){return result}))})).catch((function(error){var newState=StateManager.setLoadingMessages(viewState,!1);throw render(newState),error}))},markConversationAsRead=function(conversationId){var loggedInUserId=viewState.loggedInUserId,pendingPromise=new Pending("core_message/message_drawer_view_conversation:markConversationAsRead");return Repository.markAllConversationMessagesAsRead(loggedInUserId,conversationId).then((function(){var newState=StateManager.markMessagesAsRead(viewState,viewState.messages);return PubSub.publish(MessageDrawerEvents.CONVERSATION_READ,conversationId),render(newState)})).then((function(result){return pendingPromise.resolve(),result}))},requestBlockUser=function(userId){cancelRequest(userId);var newState=StateManager.addPendingBlockUsersById(viewState,[userId]);render(newState)},blockUser=function(userId){var newState=StateManager.setLoadingConfirmAction(viewState,!0),pendingPromise=new Pending("core_message/message_drawer_view_conversation:blockUser");return render(newState),Repository.blockUser(viewState.loggedInUserId,userId).then((function(profile){var newState=StateManager.addMembers(viewState,[profile]);return newState=StateManager.removePendingBlockUsersById(newState,[userId]),newState=StateManager.setLoadingConfirmAction(newState,!1),PubSub.publish(MessageDrawerEvents.CONTACT_BLOCKED,userId),render(newState)})).then((function(result){return pendingPromise.resolve(),result}))},requestUnblockUser=function(userId){cancelRequest(userId);var newState=StateManager.addPendingUnblockUsersById(viewState,[userId]);render(newState)},unblockUser=function(userId){var newState=StateManager.setLoadingConfirmAction(viewState,!0),pendingPromise=new Pending("core_message/message_drawer_view_conversation:unblockUser");return render(newState),Repository.unblockUser(viewState.loggedInUserId,userId).then((function(profile){var newState=StateManager.addMembers(viewState,[profile]);return newState=StateManager.removePendingUnblockUsersById(newState,[userId]),newState=StateManager.setLoadingConfirmAction(newState,!1),PubSub.publish(MessageDrawerEvents.CONTACT_UNBLOCKED,userId),render(newState)})).then((function(result){return pendingPromise.resolve(),result}))},requestRemoveContact=function(userId){cancelRequest(userId);var newState=StateManager.addPendingRemoveContactsById(viewState,[userId]);render(newState)},removeContact=function(userId){var newState=StateManager.setLoadingConfirmAction(viewState,!0),pendingPromise=new Pending("core_message/message_drawer_view_conversation:removeContact");return render(newState),Repository.deleteContacts(viewState.loggedInUserId,[userId]).then((function(profiles){var newState=StateManager.addMembers(viewState,profiles);return newState=StateManager.removePendingRemoveContactsById(newState,[userId]),newState=StateManager.setLoadingConfirmAction(newState,!1),PubSub.publish(MessageDrawerEvents.CONTACT_REMOVED,userId),render(newState)})).then((function(result){return pendingPromise.resolve(),result}))},requestAddContact=function(userId){cancelRequest(userId);var newState=StateManager.addPendingAddContactsById(viewState,[userId]);render(newState)},addContact=function(userId){var newState=StateManager.setLoadingConfirmAction(viewState,!0),pendingPromise=new Pending("core_message/message_drawer_view_conversation:addContactRequests");return render(newState),Repository.createContactRequest(viewState.loggedInUserId,userId).then((function(response){if(!response.request)throw new Error(response.warnings[0].message);return response.request})).then((function(request){var newState=StateManager.removePendingAddContactsById(viewState,[userId]);return newState=StateManager.addContactRequests(newState,[request]),newState=StateManager.setLoadingConfirmAction(newState,!1),render(newState)})).then((function(result){return pendingPromise.resolve(),result}))},requestDeleteSelectedMessages=function(userId){var selectedMessageIds=viewState.selectedMessageIds;cancelRequest(userId);var newState=StateManager.addPendingDeleteMessagesById(viewState,selectedMessageIds);render(newState)},deleteSelectedMessages=function(){var pendingPromise=new Pending("core_message/message_drawer_view_conversation:deleteSelectedMessages"),messageIds=viewState.pendingDeleteMessageIds,sentMessages=viewState.messages.filter((function(message){return messageIds.indexOf(message.id)>=0&&("sent"==message.sendState||null===message.sendState)})),newState=StateManager.setLoadingConfirmAction(viewState,!0);render(newState);var deleteMessagesPromise=$.Deferred().resolve().promise();if(sentMessages.length){var sentMessageIds=sentMessages.map((function(message){return message.id}));deleteMessagesPromise=newState.deleteMessagesForAllUsers?Repository.deleteMessagesForAllUsers(viewState.loggedInUserId,sentMessageIds):Repository.deleteMessages(viewState.loggedInUserId,sentMessageIds)}return isDeletingConversationContent=!0,newMessagesPollTimer&&newMessagesPollTimer.stop(),deleteMessagesPromise.then((function(){var newState=StateManager.removeMessagesById(viewState,messageIds);newState=StateManager.removePendingDeleteMessagesById(newState,messageIds),newState=StateManager.removeSelectedMessagesById(newState,messageIds),newState=StateManager.setLoadingConfirmAction(newState,!1),newState=StateManager.setDeleteMessagesForAllUsers(newState,!1);var prevLastMessage=viewState.messages[viewState.messages.length-1],newLastMessage=newState.messages.length?newState.messages[newState.messages.length-1]:null;if(newLastMessage&&newLastMessage.id!=prevLastMessage.id){var conversation=formatConversationForEvent(newState);PubSub.publish(MessageDrawerEvents.CONVERSATION_NEW_LAST_MESSAGE,conversation)}else newState.messages.length||PubSub.publish(MessageDrawerEvents.CONVERSATION_DELETED,newState.id);return isDeletingConversationContent=!1,render(newState)})).then((function(result){return pendingPromise.resolve(),result})).catch(Notification.exception)},requestDeleteConversation=function(userId){cancelRequest(userId);var newState=StateManager.setPendingDeleteConversation(viewState,!0);render(newState)},deleteConversation=function(){var pendingPromise=new Pending("core_message/message_drawer_view_conversation:markConversationAsRead"),newState=StateManager.setLoadingConfirmAction(viewState,!0);return render(newState),isDeletingConversationContent=!0,newMessagesPollTimer&&newMessagesPollTimer.stop(),Repository.deleteConversation(viewState.loggedInUserId,viewState.id).then((function(){var newState=StateManager.removeMessages(viewState,viewState.messages);return newState=StateManager.removeSelectedMessagesById(newState,viewState.selectedMessageIds),newState=StateManager.setPendingDeleteConversation(newState,!1),newState=StateManager.setLoadingConfirmAction(newState,!1),PubSub.publish(MessageDrawerEvents.CONVERSATION_DELETED,newState.id),isDeletingConversationContent=!1,render(newState)})).then((function(result){return pendingPromise.resolve(),result}))},cancelRequest=function(userId){var pendingDeleteMessageIds=viewState.pendingDeleteMessageIds,newState=StateManager.removePendingAddContactsById(viewState,[userId]);newState=StateManager.removePendingRemoveContactsById(newState,[userId]),newState=StateManager.removePendingUnblockUsersById(newState,[userId]),newState=StateManager.removePendingBlockUsersById(newState,[userId]),newState=StateManager.removePendingDeleteMessagesById(newState,pendingDeleteMessageIds),newState=StateManager.setPendingDeleteConversation(newState,!1),newState=StateManager.setDeleteMessagesForAllUsers(newState,!1),render(newState)},acceptContactRequest=function(userId){var pendingPromise=new Pending("core_message/message_drawer_view_conversation:acceptContactRequest"),loggedInUserId=viewState.loggedInUserId,requests=viewState.members[userId].contactrequests.filter((function(request){return request.requesteduserid==loggedInUserId})),request=requests[0],newState=StateManager.setLoadingConfirmAction(viewState,!0);return render(newState),Repository.acceptContactRequest(userId,loggedInUserId).then((function(profile){var newState=StateManager.removeContactRequests(viewState,[request]);return newState=StateManager.addMembers(viewState,[profile]),newState=StateManager.setLoadingConfirmAction(newState,!1),render(newState)})).then((function(){PubSub.publish(MessageDrawerEvents.CONTACT_ADDED,viewState.members[userId]),PubSub.publish(MessageDrawerEvents.CONTACT_REQUEST_ACCEPTED,request)})).then((function(result){return pendingPromise.resolve(),result}))},declineContactRequest=function(userId){var pendingPromise=new Pending("core_message/message_drawer_view_conversation:declineContactRequest"),loggedInUserId=viewState.loggedInUserId,requests=viewState.members[userId].contactrequests.filter((function(request){return request.requesteduserid==loggedInUserId})),request=requests[0],newState=StateManager.setLoadingConfirmAction(viewState,!0);return render(newState),Repository.declineContactRequest(userId,loggedInUserId).then((function(profile){var newState=StateManager.removeContactRequests(viewState,[request]);return newState=StateManager.addMembers(viewState,[profile]),newState=StateManager.setLoadingConfirmAction(newState,!1),render(newState)})).then((function(){PubSub.publish(MessageDrawerEvents.CONTACT_REQUEST_DECLINED,request)})).then((function(result){return pendingPromise.resolve(),result}))},processSendMessageBuffer=function processSendMessageBuffer(){if(!isSendingMessage&&sendMessageBuffer.length){var pendingPromise=new Pending("core_message/message_drawer_view_conversation:processSendMessageBuffer");isSendingMessage=!0;var messagesToSend=sendMessageBuffer.slice();sendMessageBuffer=[];var conversationId=viewState.id,newConversationId=null,messagesText=messagesToSend.map((function(message){return message.text})),messageIds=messagesToSend.map((function(message){return message.id})),sendMessagePromise=null,newCanDeleteMessagesForAllUsers=null;if(conversationId||viewState.type==CONVERSATION_TYPES.PUBLIC)sendMessagePromise=Repository.sendMessagesToConversation(conversationId,messagesText);else{var otherUserId=getOtherUserId();sendMessagePromise=Repository.sendMessagesToUser(otherUserId,messagesText).then((function(messages){return messages.length&&(newConversationId=parseInt(messages[0].conversationid,10),newCanDeleteMessagesForAllUsers=messages[0].candeletemessagesforallusers),messages}))}sendMessagePromise.then((function(messages){var newMessageIds=messages.map((function(message){return message.id})),data=[],selectedToRemove=[],selectedToAdd=[];messagesToSend.forEach((function(oldMessage,index){var newMessage=messages[index];data.push([oldMessage,newMessage]),viewState.selectedMessageIds.indexOf(oldMessage.id)>=0&&(selectedToRemove.push(oldMessage.id),selectedToAdd.push(newMessage.id))}));var newState=StateManager.updateMessages(viewState,data);newState=StateManager.setMessagesSendSuccessById(newState,newMessageIds),selectedToRemove.length&&(newState=StateManager.removeSelectedMessagesById(newState,selectedToRemove)),selectedToAdd.length&&(newState=StateManager.addSelectedMessagesById(newState,selectedToAdd));var conversation=formatConversationForEvent(newState);newState.id||(newState=StateManager.setId(newState,newConversationId),conversation.id=newConversationId,resetMessagePollTimer(newConversationId),PubSub.publish(MessageDrawerEvents.CONVERSATION_CREATED,conversation),newState=StateManager.setCanDeleteMessagesForAllUsers(newState,newCanDeleteMessagesForAllUsers)),render(newState),isSendingMessage=!1,processSendMessageBuffer(),PubSub.publish(MessageDrawerEvents.CONVERSATION_NEW_LAST_MESSAGE,conversation)})).then((function(result){return pendingPromise.resolve(),result})).catch((function(e){var errorMessage;errorMessage=e.message?$.Deferred().resolve(e.message).promise():Str.get_string("unknownerror","core");var handleFailedMessages=function(errorMessage){var newState=StateManager.setMessagesSendFailById(viewState,messageIds,errorMessage);render(newState),isSendingMessage=!1,processSendMessageBuffer()};errorMessage.then(handleFailedMessages).then((function(result){return pendingPromise.resolve(),result})).catch((function(e){var finalError=e.message||"Something went wrong!";handleFailedMessages(finalError)}))}))}},previewText=function(text){var plaintext=text.replace(/<style([\s\S]*?)<\/style>/gi,"");return(plaintext=(plaintext=(plaintext=(plaintext=(plaintext=(plaintext=(plaintext=(plaintext=(plaintext=plaintext.replace(/<script([\s\S]*?)<\/script>/gi,"")).replace(/<\/div>/gi,"\n")).replace(/<\/li>/gi,"\n")).replace(/<li>/gi,"  *  ")).replace(/<\/ul>/gi,"\n")).replace(/<\/p>/gi,"\n")).replace(/<br[^>]*>/gi,"\n")).replace(/<[^>]+>/gi,"")).replace(/\n+/gi,"\n")).replace(/\n/gi,"<br>")},processRenderBuffer=function processRenderBuffer(header,body,footer){if(!isRendering&&renderBuffer.length){isRendering=!0;var renderable=renderBuffer.shift(),renderPromises=renderers.map((function(renderFunc){return renderFunc(renderable.patch)}));$.when.apply(null,renderPromises).then((function(){isRendering=!1,renderable.deferred.resolve(!0),processRenderBuffer(header,body,footer)})).catch((function(error){isRendering=!1,renderable.deferred.reject(error),Notification.exception(error)}))}},generateRenderFunction=function(header,body,footer,isNewConversation){var rendererFunc=function(patch){return Renderer.render(header,body,footer,patch)};if(!isNewConversation){var initialState=StateManager.buildInitialState(viewState.midnight,viewState.loggedInUserId,viewState.id);rendererFunc(Patcher.buildPatch(initialState,viewState))}return renderers.push(rendererFunc),function(newState){var patch=Patcher.buildPatch(viewState,newState),deferred=$.Deferred();return Object.keys(patch).length?renderBuffer.push({patch:patch,deferred:deferred}):deferred.resolve(!0),viewState=newState,newState.id&&(stateCache[newState.id]={state:newState,messagesOffset:getMessagesOffset(),loadedAllMessages:hasLoadedAllMessages()}),processRenderBuffer(header,body,footer),deferred.promise()}},generateConfirmActionHandler=function(actionCallback){return function(e,data){if(!viewState.loadingConfirmAction){actionCallback(getOtherUserId());var newState=StateManager.setLoadingConfirmAction(viewState,!1);render(newState)}data.originalEvent.preventDefault()}},handleSendMessage=function(e,data){var textArea=$(e.target).closest(SELECTORS.FOOTER_CONTAINER).find(SELECTORS.MESSAGE_TEXT_AREA),text=textArea.val().trim();""!==text&&(!function(text){var id="temp"+Date.now(),loadingmessage={id:id,useridfrom:viewState.loggedInUserId,text:previewText(text),timecreated:null},newState=StateManager.addMessages(viewState,[loadingmessage]);render(newState);var message={id:id,useridfrom:viewState.loggedInUserId,text:text,timecreated:null};sendMessageBuffer.push(message),processSendMessageBuffer()}(text),textArea.val(""),textArea.focus()),data.originalEvent.preventDefault()},handleSelectMessage=function(e,data){var selection=window.getSelection(),target=$(e.target);""==selection.toString()&&(target.is("a")||(!function(messageId){var newState=viewState;newState=viewState.selectedMessageIds.indexOf(messageId)>-1?StateManager.removeSelectedMessagesById(viewState,[messageId]):StateManager.addSelectedMessagesById(viewState,[messageId]),render(newState)}(target.closest(SELECTORS.MESSAGE).attr("data-message-id")),data.originalEvent.preventDefault()))},handleRetrySendMessage=function(e,data){var messageId=$(e.target).closest(SELECTORS.MESSAGE).attr("data-message-id"),messages=viewState.messages.filter((function(message){return message.id==messageId})),message=messages.length?messages[0]:null;message&&function(message){var newState=StateManager.setMessagesSendPendingById(viewState,[message.id]);render(newState),sendMessageBuffer.push(message),processSendMessageBuffer()}(message),data.originalEvent.preventDefault(),data.originalEvent.stopPropagation(),e.stopPropagation()},handleCancelEditMode=function(e,data){!function(){cancelRequest(getOtherUserId());var newState=StateManager.removeSelectedMessagesById(viewState,viewState.selectedMessageIds);render(newState)}(),data.originalEvent.preventDefault()},generateHandleViewContact=function(namespace){return function(e,data){var otherUserId=getOtherUserId(),otherUser=viewState.members[otherUserId];MessageDrawerRouter.go(namespace,MessageDrawerRoutes.VIEW_CONTACT,otherUser),data.originalEvent.preventDefault()}},handleSetFavourite=function(e,data){var userId,conversationId,pendingPromise;(userId=viewState.loggedInUserId,conversationId=viewState.id,pendingPromise=new Pending("core_message/message_drawer_view_conversation:setFavourite"),Repository.setFavouriteConversations(userId,[conversationId]).then((function(){var newState=StateManager.setIsFavourite(viewState,!0);return render(newState)})).then((function(){return PubSub.publish(MessageDrawerEvents.CONVERSATION_SET_FAVOURITE,formatConversationForEvent(viewState))})).then((function(result){return pendingPromise.resolve(),result}))).catch(Notification.exception),data.originalEvent.preventDefault()},handleUnsetFavourite=function(e,data){var userId,conversationId,pendingPromise;(userId=viewState.loggedInUserId,conversationId=viewState.id,pendingPromise=new Pending("core_message/message_drawer_view_conversation:unsetFavourite"),Repository.unsetFavouriteConversations(userId,[conversationId]).then((function(){var newState=StateManager.setIsFavourite(viewState,!1);return render(newState)})).then((function(){return PubSub.publish(MessageDrawerEvents.CONVERSATION_UNSET_FAVOURITE,formatConversationForEvent(viewState))})).then((function(result){return pendingPromise.resolve(),result}))).catch(Notification.exception),data.originalEvent.preventDefault()},handleSetMuted=function(e,data){var userId,conversationId,pendingPromise;(userId=viewState.loggedInUserId,conversationId=viewState.id,pendingPromise=new Pending("core_message/message_drawer_view_conversation:markConversationAsRead"),Repository.setMutedConversations(userId,[conversationId]).then((function(){var newState=StateManager.setIsMuted(viewState,!0);return render(newState)})).then((function(){return PubSub.publish(MessageDrawerEvents.CONVERSATION_SET_MUTED,formatConversationForEvent(viewState))})).then((function(result){return pendingPromise.resolve(),result}))).catch(Notification.exception),data.originalEvent.preventDefault()},handleUnsetMuted=function(e,data){var userId,conversationId;(userId=viewState.loggedInUserId,conversationId=viewState.id,Repository.unsetMutedConversations(userId,[conversationId]).then((function(){var newState=StateManager.setIsMuted(viewState,!1);return render(newState)})).then((function(){return PubSub.publish(MessageDrawerEvents.CONVERSATION_UNSET_MUTED,formatConversationForEvent(viewState))}))).catch(Notification.exception),data.originalEvent.preventDefault()},handleDeleteMessagesForAllUsersToggle=function(e){var newValue=$(e.target).prop("checked"),newState=StateManager.setDeleteMessagesForAllUsers(viewState,newValue);render(newState)},generateHandleViewGroupInfo=function(namespace){return function(e,data){MessageDrawerRouter.go(namespace,MessageDrawerRoutes.VIEW_GROUP_INFO,{id:viewState.id,name:viewState.name,subname:viewState.subname,imageUrl:viewState.imageUrl,totalMemberCount:viewState.totalMemberCount},viewState.loggedInUserId),data.originalEvent.preventDefault()}},handleToggleEmojiPicker=function(e,data){var newState=StateManager.setShowEmojiPicker(viewState,!viewState.showEmojiPicker);render(newState),data.originalEvent.preventDefault()},handleCloseEmojiPicker=function(e){var target=$(e.target);if(viewState.showEmojiPicker&&!target.closest(SELECTORS.EMOJI_PICKER_CONTAINER).length&&!target.closest(SELECTORS.TOGGLE_EMOJI_PICKER_BUTTON).length){var newState=StateManager.setShowEmojiPicker(viewState,!1);render(newState)}},registerEventListeners=function(namespace,header,body,footer){var isLoadingMoreMessages=!1,messagesContainer=function(body){return body.find(SELECTORS.MESSAGES_CONTAINER)}(body),emojiPickerElement=footer.find(SELECTORS.EMOJI_PICKER),emojiAutoCompleteContainer=footer.find(SELECTORS.EMOJI_AUTO_COMPLETE_CONTAINER),messageTextArea=footer.find(SELECTORS.MESSAGE_TEXT_AREA),headerActivateHandlers=[[SELECTORS.ACTION_REQUEST_BLOCK,generateConfirmActionHandler(requestBlockUser)],[SELECTORS.ACTION_REQUEST_UNBLOCK,generateConfirmActionHandler(requestUnblockUser)],[SELECTORS.ACTION_REQUEST_ADD_CONTACT,generateConfirmActionHandler(requestAddContact)],[SELECTORS.ACTION_REQUEST_REMOVE_CONTACT,generateConfirmActionHandler(requestRemoveContact)],[SELECTORS.ACTION_REQUEST_DELETE_CONVERSATION,generateConfirmActionHandler(requestDeleteConversation)],[SELECTORS.ACTION_CANCEL_EDIT_MODE,handleCancelEditMode],[SELECTORS.ACTION_VIEW_CONTACT,generateHandleViewContact(namespace)],[SELECTORS.ACTION_VIEW_GROUP_INFO,generateHandleViewGroupInfo(namespace)],[SELECTORS.ACTION_CONFIRM_FAVOURITE,handleSetFavourite],[SELECTORS.ACTION_CONFIRM_MUTE,handleSetMuted],[SELECTORS.ACTION_CONFIRM_UNFAVOURITE,handleUnsetFavourite],[SELECTORS.ACTION_CONFIRM_UNMUTE,handleUnsetMuted]],bodyActivateHandlers=[[SELECTORS.ACTION_CANCEL_CONFIRM,generateConfirmActionHandler(cancelRequest)],[SELECTORS.ACTION_CONFIRM_BLOCK,generateConfirmActionHandler(blockUser)],[SELECTORS.ACTION_CONFIRM_UNBLOCK,generateConfirmActionHandler(unblockUser)],[SELECTORS.ACTION_CONFIRM_ADD_CONTACT,generateConfirmActionHandler(addContact)],[SELECTORS.ACTION_CONFIRM_REMOVE_CONTACT,generateConfirmActionHandler(removeContact)],[SELECTORS.ACTION_CONFIRM_DELETE_SELECTED_MESSAGES,generateConfirmActionHandler(deleteSelectedMessages)],[SELECTORS.ACTION_CONFIRM_DELETE_CONVERSATION,generateConfirmActionHandler(deleteConversation)],[SELECTORS.ACTION_OKAY_CONFIRM,generateConfirmActionHandler(cancelRequest)],[SELECTORS.ACTION_REQUEST_ADD_CONTACT,generateConfirmActionHandler(requestAddContact)],[SELECTORS.ACTION_ACCEPT_CONTACT_REQUEST,generateConfirmActionHandler(acceptContactRequest)],[SELECTORS.ACTION_DECLINE_CONTACT_REQUEST,generateConfirmActionHandler(declineContactRequest)],[SELECTORS.MESSAGE,handleSelectMessage],[SELECTORS.DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE,handleDeleteMessagesForAllUsersToggle],[SELECTORS.RETRY_SEND,handleRetrySendMessage]],footerActivateHandlers=[[SELECTORS.SEND_MESSAGE_BUTTON,handleSendMessage],[SELECTORS.TOGGLE_EMOJI_PICKER_BUTTON,handleToggleEmojiPicker],[SELECTORS.ACTION_REQUEST_DELETE_SELECTED_MESSAGES,generateConfirmActionHandler(requestDeleteSelectedMessages)],[SELECTORS.ACTION_REQUEST_ADD_CONTACT,generateConfirmActionHandler(requestAddContact)],[SELECTORS.ACTION_REQUEST_UNBLOCK,generateConfirmActionHandler(requestUnblockUser)]];AutoRows.init(footer),emojiAutoCompleteContainer.length&&initialiseEmojiAutoComplete(emojiAutoCompleteContainer[0],messageTextArea[0],(function(hasSuggestions){var newState=StateManager.setShowEmojiAutoComplete(viewState,hasSuggestions);render(newState)}),(function(emoji){var newState=StateManager.setShowEmojiAutoComplete(viewState,!1);render(newState),messageTextArea.focus();var cursorPos=messageTextArea.prop("selectionStart"),currentText=messageTextArea.val(),textBefore=currentText.substring(0,cursorPos).replace(/\S*$/,""),textAfter=currentText.substring(cursorPos).replace(/^\S*/,"");messageTextArea.val(textBefore+emoji+textAfter),messageTextArea.prop("selectionStart",textBefore.length+emoji.length),messageTextArea.prop("selectionEnd",textBefore.length+emoji.length)})),emojiPickerElement.length&&initialiseEmojiPicker(emojiPickerElement[0],(function(emoji){var newState=StateManager.setShowEmojiPicker(viewState,!viewState.showEmojiPicker);render(newState),messageTextArea.focus();var cursorPos=messageTextArea.prop("selectionStart"),currentText=messageTextArea.val(),textBefore=currentText.substring(0,cursorPos),textAfter=currentText.substring(cursorPos,currentText.length);messageTextArea.val(textBefore+emoji+textAfter),messageTextArea.prop("selectionStart",cursorPos+emoji.length),messageTextArea.prop("selectionEnd",cursorPos+emoji.length)})),CustomEvents.define(header,[CustomEvents.events.activate]),CustomEvents.define(body,[CustomEvents.events.activate]),CustomEvents.define(footer,[CustomEvents.events.activate,CustomEvents.events.enter,CustomEvents.events.escape]),CustomEvents.define(messagesContainer,[CustomEvents.events.scrollTop,CustomEvents.events.scrollLock]),messagesContainer.on(CustomEvents.events.scrollTop,(function(e,data){var hasMembers=Object.keys(viewState.members).length>1;if(!isResetting&&!isLoadingMoreMessages&&!hasLoadedAllMessages()&&hasMembers){isLoadingMoreMessages=!0;var newState=StateManager.setLoadingMessages(viewState,!0);render(newState),loadMessages(viewState.id,LOAD_MESSAGE_LIMIT,getMessagesOffset(),NEWEST_FIRST,[]).then((function(){isLoadingMoreMessages=!1,setMessagesOffset(getMessagesOffset()+LOAD_MESSAGE_LIMIT)})).catch((function(error){isLoadingMoreMessages=!1,Notification.exception(error)}))}data.originalEvent.preventDefault()})),headerActivateHandlers.forEach((function(handler){var selector=handler[0],handlerFunction=handler[1];header.on(CustomEvents.events.activate,selector,handlerFunction)})),bodyActivateHandlers.forEach((function(handler){var selector=handler[0],handlerFunction=handler[1];body.on(CustomEvents.events.activate,selector,handlerFunction)})),footerActivateHandlers.forEach((function(handler){var selector=handler[0],handlerFunction=handler[1];footer.on(CustomEvents.events.activate,selector,handlerFunction)})),footer.on(CustomEvents.events.enter,SELECTORS.MESSAGE_TEXT_AREA,(function(e,data){var enterToSend=footer.attr("data-enter-to-send");enterToSend&&"false"!=enterToSend&&"0"!=enterToSend&&handleSendMessage(e,data)})),footer.on(CustomEvents.events.escape,SELECTORS.EMOJI_PICKER_CONTAINER,handleToggleEmojiPicker),$(document.body).on("click",handleCloseEmojiPicker),PubSub.subscribe(MessageDrawerEvents.ROUTE_CHANGED,(function(newRouteData){newMessagesPollTimer&&newRouteData.route!=MessageDrawerRoutes.VIEW_CONVERSATION&&newMessagesPollTimer.stop()}))},resetMessagePollTimer=function(conversationId){newMessagesPollTimer&&newMessagesPollTimer.stop(),newMessagesPollTimer=new BackOffTimer(function(conversationId,newestFirst){return function(){var messages=viewState.messages,mostRecentMessage=messages.length?messages[messages.length-1]:null,lastTimeCreated=mostRecentMessage?mostRecentMessage.timeCreated:null;if(lastTimeCreated&&!isResetting&&!isSendingMessage&&!isDeletingConversationContent){for(var ignoreMessageIds=[],i=messages.length-1;i>=0;i--){var message=messages[i];if(message.timeCreated!==lastTimeCreated)break;ignoreMessageIds.push(message.id)}return loadMessages(conversationId,0,0,newestFirst,ignoreMessageIds,lastTimeCreated).then((function(result){if(result.messages.length){newMessagesPollTimer.restart();var conversation=formatConversationForEvent(viewState);return PubSub.publish(MessageDrawerEvents.CONVERSATION_NEW_LAST_MESSAGE,conversation),markConversationAsRead(conversationId)}return result}))}return $.Deferred().resolve().promise()}}(conversationId,NEWEST_FIRST),BackOffTimer.getIncrementalCallback(viewState.messagePollMin*MILLISECONDS_IN_SEC,MILLISECONDS_IN_SEC,viewState.messagePollMax*MILLISECONDS_IN_SEC,viewState.messagePollAfterMax*MILLISECONDS_IN_SEC)),newMessagesPollTimer.start()},resetState=function(body,conversationId,loggedInUserProfile){newMessagesPollTimer&&newMessagesPollTimer.stop(),loadedAllMessages=!1,messagesOffset=0,newMessagesPollTimer=null,isRendering=!1,renderBuffer=[],isResetting=!0,isSendingMessage=!1,isDeletingConversationContent=!1,sendMessageBuffer=[];var loggedInUserId=loggedInUserProfile.id,midnight=parseInt(body.attr("data-midnight"),10),messagePollMin=parseInt(body.attr("data-message-poll-min"),10),messagePollMax=parseInt(body.attr("data-message-poll-max"),10),messagePollAfterMax=parseInt(body.attr("data-message-poll-after-max"),10),initialState=StateManager.buildInitialState(midnight,loggedInUserId,conversationId,messagePollMin,messagePollMax,messagePollAfterMax);viewState||(viewState=initialState),render(initialState)},resetNoConversation=function(body,loggedInUserProfile,otherUserId){resetState(body,null,loggedInUserProfile);return(loggedInUserProfile.id!=otherUserId?Repository.getConversationBetweenUsers(loggedInUserProfile.id,otherUserId,!0,!0,0,0,LOAD_MESSAGE_LIMIT,0,NEWEST_FIRST):Repository.getSelfConversation(loggedInUserProfile.id,LOAD_MESSAGE_LIMIT,0,NEWEST_FIRST)).then((function(conversation){return resetByConversation(body,conversation,loggedInUserProfile)})).catch((function(){return function(loggedInUserProfile,otherUserId){var loggedInUserId=loggedInUserProfile.id,conversationType=loggedInUserId==otherUserId?CONVERSATION_TYPES.SELF:CONVERSATION_TYPES.PRIVATE,newState=StateManager.setLoadingMembers(viewState,!0);return newState=StateManager.setLoadingMessages(newState,!0),render(newState),Repository.getMemberInfo(loggedInUserId,[otherUserId],!0,!0).then((function(profiles){if(profiles.length)return profiles[0];throw new Error("Unable to load other user profile")})).then((function(profile){var members=conversationType==CONVERSATION_TYPES.SELF?[profile]:[profile,loggedInUserProfile],newState=StateManager.addMembers(viewState,members);return newState=StateManager.setLoadingMembers(newState,!1),newState=StateManager.setLoadingMessages(newState,!1),newState=StateManager.setName(newState,profile.fullname),newState=StateManager.setType(newState,conversationType),newState=StateManager.setImageUrl(newState,profile.profileimageurl),newState=StateManager.setTotalMemberCount(newState,members.length),render(newState),profile})).catch((function(error){var newState=StateManager.setLoadingMembers(viewState,!1);render(newState),Notification.exception(error)}))}(loggedInUserProfile,otherUserId)}))},resetById=function(body,conversationId,loggedInUserProfile){var cache=null;conversationId in stateCache&&(cache=stateCache[conversationId]),resetState(body,conversationId,loggedInUserProfile);var promise=$.Deferred().resolve({}).promise();if(cache){var newState=cache.state;newState=StateManager.setLoadingMessages(newState,!1),newState=StateManager.setLoadingMembers(newState,!1),setMessagesOffset(cache.messagesOffset),setLoadedAllMessages(cache.loadedAllMessages),render(newState)}else promise=function(conversationId,loggedInUserProfile,messageLimit,messageOffset,newestFirst){var loggedInUserId=loggedInUserProfile.id,newState=StateManager.setLoadingMembers(viewState,!0);return newState=StateManager.setLoadingMessages(newState,!0),render(newState),Repository.getConversation(loggedInUserId,conversationId,!0,!0,0,0,messageLimit+1,messageOffset,newestFirst).then((function(conversation){return conversation.messages.length>messageLimit?conversation.messages=conversation.messages.slice(1):setLoadedAllMessages(!0),setMessagesOffset(messageOffset+messageLimit),conversation})).then((function(conversation){conversation.members.filter((function(member){return member.id==loggedInUserProfile.id})).length<1&&(conversation.members=conversation.members.concat([loggedInUserProfile]));var newState=updateStateFromConversation(conversation,loggedInUserProfile.id);return newState=StateManager.setLoadingMembers(newState,!1),newState=StateManager.setLoadingMessages(newState,!1),render(newState).then((function(){return conversation}))})).then((function(){return markConversationAsRead(conversationId)})).catch((function(error){var newState=StateManager.setLoadingMembers(viewState,!1);newState=StateManager.setLoadingMessages(newState,!1),render(newState),Notification.exception(error)}))}(conversationId,loggedInUserProfile,LOAD_MESSAGE_LIMIT,0,NEWEST_FIRST);return promise.then((function(){return resetMessagePollTimer(conversationId)}))},resetByConversation=function(body,conversation,loggedInUserProfile){var cache=null;conversation.id in stateCache&&(cache=stateCache[conversation.id]),resetState(body,conversation.id,loggedInUserProfile);var promise=$.Deferred().resolve({}).promise();if(cache){var newState=cache.state;newState=StateManager.setLoadingMessages(newState,!1),newState=StateManager.setLoadingMembers(newState,!1),setMessagesOffset(cache.messagesOffset),setLoadedAllMessages(cache.loadedAllMessages),render(newState)}else promise=function(conversation,loggedInUserProfile,messageLimit,newestFirst){conversation.members.filter((function(member){return member.id==loggedInUserProfile.id})).length<1&&(conversation.members=conversation.members.concat([loggedInUserProfile]));var messageCount=conversation.messages.length,hasLoadedEnoughMessages=messageCount>=messageLimit,newState=updateStateFromConversation(conversation,loggedInUserProfile.id);return newState=StateManager.setLoadingMembers(newState,!1),newState=StateManager.setLoadingMessages(newState,!hasLoadedEnoughMessages),render(newState).then((function(){return hasLoadedEnoughMessages?{messages:conversation.messages}:loadMessages(conversation.id,messageLimit,messageCount,newestFirst,[])})).then((function(){var messages=viewState.messages;return setMessagesOffset(messages.length),markConversationAsRead(viewState.id),messages})).catch(Notification.exception)}(conversation,loggedInUserProfile,LOAD_MESSAGE_LIMIT,NEWEST_FIRST);return promise.then((function(){return resetMessagePollTimer(conversation.id)}))};return{show:function(namespace,header,body,footer,conversationOrId,action,otherUserId){var userId,conversation=null,conversationId=null;conversationOrId&&null!==conversationOrId&&"object"==_typeof(conversationOrId)?(conversation=conversationOrId,conversationId=parseInt(conversation.id,10)):(conversation=null,conversationId=parseInt(conversationOrId,10),conversationId=isNaN(conversationId)?null:conversationId),!conversationId&&action&&otherUserId&&(userId=otherUserId,conversationId=Object.keys(stateCache).reduce((function(carry,id){if(!carry){var state=stateCache[id].state;state.type!=CONVERSATION_TYPES.PUBLIC&&userId in state.members&&(carry=state.id)}return carry}),null));var isNewConversation=!viewState||viewState.id!=conversationId||otherUserId&&otherUserId!=getOtherUserId();if(body.attr("data-init")||(render=generateRenderFunction(header,body,footer,isNewConversation),registerEventListeners(namespace,header,body,footer),body.attr("data-init",!0)),isNewConversation){var loggedInUserProfile=function(body){return{id:parseInt(body.attr("data-user-id"),10),fullname:null,profileimageurl:null,profileimageurlsmall:null,isonline:null,showonlinestatus:null,isblocked:null,iscontact:null,isdeleted:null,canmessage:null,canmessageevenifblocked:null,requirescontact:null,contactrequests:[]}}(body);return(conversation?resetByConversation(body,conversation,loggedInUserProfile,otherUserId):conversationId?resetById(body,conversationId,loggedInUserProfile):resetNoConversation(body,loggedInUserProfile,otherUserId)).then((function(){isResetting=!1,header.find(Constants.SELECTORS.CAN_RECEIVE_FOCUS).first().focus()})).catch((function(error){isResetting=!1,Notification.exception(error)}))}if(resetMessagePollTimer(conversationId),viewState.type==CONVERSATION_TYPES.PRIVATE&&action){var currentOtherUserId=getOtherUserId();switch(action){case"block":return requestBlockUser(currentOtherUserId);case"unblock":return requestUnblockUser(currentOtherUserId);case"add-contact":return requestAddContact(currentOtherUserId);case"remove-contact":return requestRemoveContact(currentOtherUserId)}}return $.Deferred().resolve().promise()},description:function(){return Str.get_string("messagedrawerviewconversation","core_message",viewState.name)}}}));
/**
 * Controls the overview page of the message drawer.
 *
 * @module     core_message/message_drawer_view_overview
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_view_overview",["jquery","core/key_codes","core/pubsub","core/str","core_message/message_drawer_router","core_message/message_drawer_routes","core_message/message_drawer_events","core_message/message_drawer_view_overview_section","core_message/message_repository","core_message/message_drawer_view_conversation_constants"],(function($,KeyCodes,PubSub,Str,Router,Routes,MessageDrawerEvents,Section,MessageRepository,Constants){var SELECTORS_CONTACT_REQUEST_COUNT='[data-region="contact-request-count"]',SELECTORS_FAVOURITES='[data-region="view-overview-favourites"]',SELECTORS_GROUP_MESSAGES='[data-region="view-overview-group-messages"]',SELECTORS_MESSAGES='[data-region="view-overview-messages"]',SELECTORS_SEARCH_INPUT='[data-region="view-overview-search-input"]',SELECTORS_SECTION_TOGGLE_BUTTON="[data-toggle]",OVERVIEW_SECTION_TYPES={PRIVATE:[Constants.CONVERSATION_TYPES.PRIVATE,Constants.CONVERSATION_TYPES.SELF],PUBLIC:[Constants.CONVERSATION_TYPES.PUBLIC],FAVOURITE:null},loadAllCountsPromise=null,filterCountsByTypes=function(counts,types,includeFavourites){var total=0;return types&&types.length&&(total=types.reduce((function(carry,type){return carry+counts.types[type]}),total)),includeFavourites&&(total+=counts.favourites),total},getSearchInput=function(header){return header.find(SELECTORS_SEARCH_INPUT)},decrementContactRequestCount=function(header){return function(){var countContainer=header.find(SELECTORS_CONTACT_REQUEST_COUNT),count=parseInt(countContainer.text(),10);(count=isNaN(count)?0:count-1)<=0?countContainer.addClass("hidden"):countContainer.text(count)}};return{show:function(namespace,header,body){header.attr("data-init")||(!function(namespace,header){var searchInput=getSearchInput(header),ignoredKeys=[KeyCodes.tab,KeyCodes.shift,KeyCodes.ctrl,KeyCodes.alt];searchInput.on("click",(function(){Router.go(namespace,Routes.VIEW_SEARCH)})),searchInput.on("keydown",(function(e){ignoredKeys.indexOf(e.keyCode)<0&&"Meta"!=e.key&&Router.go(namespace,Routes.VIEW_SEARCH)})),PubSub.subscribe(MessageDrawerEvents.CONTACT_REQUEST_ACCEPTED,decrementContactRequestCount(header)),PubSub.subscribe(MessageDrawerEvents.CONTACT_REQUEST_DECLINED,decrementContactRequestCount(header))}(namespace,header),header.attr("data-init",!0));var fromPanel=header.attr("data-in-panel")?"frompanel":null;getSearchInput(header).val("");var loggedInUserId=function(body){return body.attr("data-user-id")}(body),allCounts=function(loggedInUserId){return null===loadAllCountsPromise&&(loadAllCountsPromise=MessageRepository.getAllConversationCounts(loggedInUserId)),loadAllCountsPromise}(loggedInUserId),sections=[[body.find(SELECTORS_FAVOURITES),OVERVIEW_SECTION_TYPES.FAVOURITE,!0],[body.find(SELECTORS_GROUP_MESSAGES),OVERVIEW_SECTION_TYPES.PUBLIC,!1],[body.find(SELECTORS_MESSAGES),OVERVIEW_SECTION_TYPES.PRIVATE,!1]];return sections.forEach((function(args){var sectionRoot=args[0],sectionTypes=args[1],includeFavourites=args[2],totalCountPromise=allCounts.then((function(result){return filterCountsByTypes(result.total,sectionTypes,includeFavourites)})),unreadCountPromise=allCounts.then((function(result){return filterCountsByTypes(result.unread,sectionTypes,includeFavourites)}));Section.show(namespace,null,sectionRoot,null,sectionTypes,includeFavourites,totalCountPromise,unreadCountPromise,fromPanel)})),allCounts.then((function(result){return function(sections){sections.some((function(section){var sectionRoot=section[0];return Section.isVisible(sectionRoot)}))||(sections.sort((function(a,b){var aTotal=a[1],aUnread=a[2],bTotal=b[1],bUnread=b[2];return aUnread>0&&0==bUnread?-1:0==aUnread&&bUnread>0?1:aTotal>0&&0==bTotal?-1:0==aTotal&&bTotal>0?1:0})),sections[0][0].find(SELECTORS_SECTION_TOGGLE_BUTTON).click())}(sections.map((function(section){var sectionRoot=section[0],sectionTypes=section[1],includeFavourites=section[2];return[sectionRoot,filterCountsByTypes(result.total,sectionTypes,includeFavourites),filterCountsByTypes(result.unread,sectionTypes,includeFavourites)]})))}))},description:function(){return Str.get_string("messagedrawerviewoverview","core_message")}}}));
/**
 * Available routes for the message drawer.
 *
 * @module     core_message/message_drawer_routes
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_routes",[],(function(){return{VIEW_CONTACT:"view-contact",VIEW_CONTACTS:"view-contacts",VIEW_CONVERSATION:"view-conversation",VIEW_GROUP_INFO:"view-group-info",VIEW_OVERVIEW:"view-overview",VIEW_SEARCH:"view-search",VIEW_SETTINGS:"view-settings"}}));
/**
 * Constant values for the conversation page in the message drawer.
 *
 * @module     core_message/message_drawer_view_conversation_constants
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_view_conversation_constants",[],(function(){return{SELECTORS:{ACTION_ACCEPT_CONTACT_REQUEST:'[data-action="accept-contact-request"]',ACTION_CANCEL_CONFIRM:'[data-action="cancel-confirm"]',ACTION_OKAY_CONFIRM:'[data-action="okay-confirm"]',ACTION_CANCEL_EDIT_MODE:'[data-action="cancel-edit-mode"]',ACTION_CONFIRM_ADD_CONTACT:'[data-action="confirm-add-contact"]',ACTION_CONFIRM_BLOCK:'[data-action="confirm-block"]',ACTION_CONFIRM_DELETE_SELECTED_MESSAGES:'[data-action="confirm-delete-selected-messages"]',ACTION_CONFIRM_DELETE_CONVERSATION:'[data-action="confirm-delete-conversation"]',ACTION_CONFIRM_FAVOURITE:'[data-action="confirm-favourite"]',ACTION_CONFIRM_MUTE:'[data-action="confirm-mute"]',ACTION_CONFIRM_UNFAVOURITE:'[data-action="confirm-unfavourite"]',ACTION_CONFIRM_REMOVE_CONTACT:'[data-action="confirm-remove-contact"]',ACTION_CONFIRM_UNBLOCK:'[data-action="confirm-unblock"]',ACTION_CONFIRM_UNMUTE:'[data-action="confirm-unmute"]',ACTION_DECLINE_CONTACT_REQUEST:'[data-action="decline-contact-request"]',ACTION_REQUEST_ADD_CONTACT:'[data-action="request-add-contact"]',ACTION_REQUEST_BLOCK:'[data-action="request-block"]',ACTION_REQUEST_DELETE_CONVERSATION:'[data-action="request-delete-conversation"]',ACTION_REQUEST_DELETE_SELECTED_MESSAGES:'[data-action="delete-selected-messages"]',ACTION_REQUEST_REMOVE_CONTACT:'[data-action="request-remove-contact"]',ACTION_REQUEST_UNBLOCK:'[data-action="request-unblock"]',ACTION_VIEW_CONTACT:'[data-action="view-contact"]',ACTION_VIEW_GROUP_INFO:'[data-action="view-group-info"]',CAN_RECEIVE_FOCUS:'input:not([type="hidden"]), a[href], button, textarea, select, [tabindex]',CONFIRM_DIALOGUE:'[data-region="confirm-dialogue"]',CONFIRM_DIALOGUE_BUTTON_TEXT:'[data-region="dialogue-button-text"]',CONFIRM_DIALOGUE_CANCEL_BUTTON:'[data-action="cancel-confirm"]',CONFIRM_DIALOGUE_CONTAINER:'[data-region="confirm-dialogue-container"]',CONFIRM_DIALOGUE_HEADER:'[data-region="dialogue-header"]',CONFIRM_DIALOGUE_OKAY_BUTTON:'[data-action="okay-confirm"]',CONFIRM_DIALOGUE_TEXT:'[data-region="dialogue-text"]',CONTACT_REQUEST_SENT_MESSAGE_CONTAINER:'[data-region="contact-request-sent-message-container"]',CONTENT_PLACEHOLDER_CONTAINER:'[data-region="content-placeholder"]',CONTENT_CONTAINER:'[data-region="content-container"]',CONTENT_MESSAGES_CONTAINER:'[data-region="content-message-container"]',CONTENT_MESSAGES_FOOTER_CONTAINER:'[data-region="content-messages-footer-container"]',CONTENT_MESSAGES_FOOTER_EDIT_MODE_CONTAINER:'[data-region="content-messages-footer-edit-mode-container"]',CONTENT_MESSAGES_FOOTER_REQUIRE_CONTACT_CONTAINER:'[data-region="content-messages-footer-require-contact-container"]',CONTENT_MESSAGES_FOOTER_REQUIRE_UNBLOCK_CONTAINER:'[data-region="content-messages-footer-require-unblock-container"]',CONTENT_MESSAGES_FOOTER_UNABLE_TO_MESSAGE_CONTAINER:'[data-region="content-messages-footer-unable-to-message"]',DAY_MESSAGES_CONTAINER:'[data-region="day-messages-container"]',DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE:'[data-region="delete-messages-for-all-users-toggle"]',DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE_CONTAINER:'[data-region="delete-messages-for-all-users-toggle-container"]',EMOJI_AUTO_COMPLETE_CONTAINER:'[data-region="emoji-auto-complete-container"]',EMOJI_PICKER_CONTAINER:'[data-region="emoji-picker-container"]',EMOJI_PICKER:'[data-region="emoji-picker"]',EMOJI_PICKER_SEARCH_INPUT:'[data-region="search-input"]',ERROR_MESSAGE_CONTAINER:'[data-region="error-message-container"]',ERROR_MESSAGE:'[data-region="error-message"]',FAVOURITE_ICON_CONTAINER:'[data-region="favourite-icon-container"]',FOOTER_CONTAINER:'[data-region="content-messages-footer-container"]',HEADER:'[data-region="header-content"]',HEADER_EDIT_MODE:'[data-region="header-edit-mode"]',HEADER_PLACEHOLDER_CONTAINER:'[data-region="header-placeholder"]',LOADING_ICON_CONTAINER:'[data-region="loading-icon-container"]',MESSAGE:'[data-region="message"]',MESSAGE_NOT_SELECTED:'[data-region="message"][aria-checked="false"]',MESSAGE_NOT_SELECTED_ICON:'[data-region="not-selected-icon"]',MESSAGE_SELECTED_ICON:'[data-region="selected-icon"]',MESSAGES:'[data-region="content-message-container"]',MESSAGES_CONTAINER:'[data-region="content-message-container"]',MESSAGES_SELECTED_COUNT:'[data-region="message-selected-court"]',MESSAGE_TEXT_AREA:'[data-region="send-message-txt"]',MORE_MESSAGES_LOADING_ICON_CONTAINER:'[data-region="more-messages-loading-icon-container"]',MUTED_ICON_CONTAINER:'[data-region="muted-icon-container"]',PLACEHOLDER_CONTAINER:'[data-region="placeholder-container"]',RETRY_SEND:'[data-region="retry-send"]',SELF_CONVERSATION_MESSAGE_CONTAINER:'[data-region="self-conversation-message-container"]',SEND_MESSAGE_BUTTON:'[data-action="send-message"]',SEND_MESSAGE_ICON_CONTAINER:'[data-region="send-icon-container"]',TEXT:'[data-region="text"]',TEXT_CONTAINER:'[data-region="text-container"]',TIME_CREATED:'[data-region="time-created"]',TITLE:'[data-region="title"]',TOGGLE_EMOJI_PICKER_BUTTON:'[data-action="toggle-emoji-picker"]'},TEMPLATES:{HEADER_PRIVATE:"core_message/message_drawer_view_conversation_header_content_type_private",HEADER_PRIVATE_NO_CONTROLS:"core_message/message_drawer_view_conversation_header_content_type_private_no_controls",HEADER_PUBLIC:"core_message/message_drawer_view_conversation_header_content_type_public",HEADER_SELF:"core_message/message_drawer_view_conversation_header_content_type_self",DAY:"core_message/message_drawer_view_conversation_body_day",MESSAGE:"core_message/message_drawer_view_conversation_body_message",MESSAGES:"core_message/message_drawer_view_conversation_body_messages"},CONVERSATION_TYPES:{PRIVATE:1,PUBLIC:2,SELF:3},NEWEST_MESSAGES_FIRST:!0,LOAD_MESSAGE_LIMIT:100,MILLISECONDS_IN_SEC:1e3}}));
/**
 * Controls the preferences for the list of notification types on the
 * message preference page
 *
 * @module     core_message/preferences_notifications_list_controller
 * @class      preferences_notifications_list_controller
 * @package    message
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/preferences_notifications_list_controller",["jquery","core/ajax","core/notification","core/custom_interaction_events","core_message/notification_preference","core_message/notification_processor_settings","core/modal_factory"],(function($,Ajax,Notification,CustomEvents,NotificationPreference,NotificationProcessorSettings,ModalFactory){var SELECTORS_DISABLE_NOTIFICATIONS='[data-region="disable-notification-container"] [data-disable-notifications]',SELECTORS_DISABLE_NOTIFICATIONS_CONTAINER='[data-region="disable-notification-container"]',SELECTORS_PREFERENCE="[data-state]",SELECTORS_PREFERENCE_ROW='[data-region="preference-row"]',SELECTORS_PREFERENCE_INPUT="[data-state] input",SELECTORS_PROCESSOR_SETTING="[data-processor-setting]",PreferencesController=function(element){this.root=$(element),this.userId=this.root.attr("data-user-id"),this.registerEventListeners()};return PreferencesController.prototype.isDisabled=function(){return this.root.hasClass("disabled")},PreferencesController.prototype.setDisabled=function(){this.root.addClass("disabled"),this.root.find(SELECTORS_PREFERENCE_INPUT).prop("disabled",!0)},PreferencesController.prototype.setEnabled=function(){this.root.removeClass("disabled"),this.root.find(SELECTORS_PREFERENCE_INPUT).prop("disabled",!1)},PreferencesController.prototype.toggleDisableAllStatus=function(){var checkbox=$(SELECTORS_DISABLE_NOTIFICATIONS),container=$(SELECTORS_DISABLE_NOTIFICATIONS_CONTAINER),ischecked=checkbox.prop("checked");if(container.hasClass("loading"))return $.Deferred().resolve();container.addClass("loading");var request={methodname:"core_user_update_user_preferences",args:{userid:this.userId,emailstop:ischecked?1:0}};return Ajax.call([request])[0].done(function(){ischecked?this.setDisabled():this.setEnabled()}.bind(this)).always((function(){container.removeClass("loading")})).fail(Notification.exception)},PreferencesController.prototype.registerEventListeners=function(){var disabledNotificationsElement=$(SELECTORS_DISABLE_NOTIFICATIONS);CustomEvents.define(this.root,[CustomEvents.events.activate]),this.root.on("change",function(e){if(!this.isDisabled()){var preferenceElement=$(e.target).closest(SELECTORS_PREFERENCE),preferenceRow=$(e.target).closest(SELECTORS_PREFERENCE_ROW),preference=new NotificationPreference(preferenceRow,this.userId);preferenceElement.addClass("loading"),preference.save().always((function(){preferenceElement.removeClass("loading")}))}}.bind(this));var eventFormPromise=ModalFactory.create({type:NotificationProcessorSettings.TYPE});this.root.on(CustomEvents.events.activate,SELECTORS_PROCESSOR_SETTING,(function(e){var element=$(e.target).closest(SELECTORS_PROCESSOR_SETTING);e.preventDefault(),eventFormPromise.then((function(modal){modal.setUserId($(element).attr("data-user-id")),modal.setName($(element).attr("data-name")),modal.setContextId($(element).attr("data-context-id")),modal.setElement(element),modal.show(),e.stopImmediatePropagation()})).fail(Notification.exception)})),CustomEvents.define(disabledNotificationsElement,[CustomEvents.events.activate]),disabledNotificationsElement.on(CustomEvents.events.activate,function(){this.toggleDisableAllStatus()}.bind(this))},PreferencesController}));
/**
 * Provides some helper functions to trigger actions in the message drawer.
 *
 * @module     core_message/message_drawer_helper
 * @package    message
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_helper",["core/pubsub","core_message/message_drawer_events"],(function(PubSub,MessageDrawerEvents){return{createConversationWithUser:function(args){PubSub.publish(MessageDrawerEvents.CREATE_CONVERSATION_WITH_USER,args)},hide:function(){PubSub.publish(MessageDrawerEvents.HIDE)},show:function(){PubSub.publish(MessageDrawerEvents.SHOW)},showConversation:function(args){PubSub.publish(MessageDrawerEvents.SHOW_CONVERSATION,args)},showSettings:function(){PubSub.publish(MessageDrawerEvents.SHOW_SETTINGS)}}}));
/**
 * Events for the message drawer.
 *
 * @module     core_message/message_drawer_events
 * @package    message
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_events",[],(function(){return{CREATE_CONVERSATION_WITH_USER:"message-drawer-create-conversation-with-user",CONTACT_BLOCKED:"message-drawer-contact-blocked",CONTACT_UNBLOCKED:"message-drawer-contact-unblocked",CONTACT_ADDED:"message-drawer-contact-added",CONTACT_REMOVED:"message-drawer-contact-removed",CONTACT_REQUEST_ACCEPTED:"message-drawer-contact-request-accepted",CONTACT_REQUEST_DECLINED:"message-drawer-contact-request-declined",CONVERSATION_CREATED:"message-drawer-conversation-created",CONVERSATION_NEW_LAST_MESSAGE:"message-drawer-conversation-new-last-message",CONVERSATION_DELETED:"message-drawer-conversation-deleted",CONVERSATION_READ:"message-drawer-conversation-read",CONVERSATION_SET_FAVOURITE:"message-drawer-conversation-set-favourite",CONVERSATION_SET_MUTED:"message-drawer-conversation-set-muted",CONVERSATION_UNSET_FAVOURITE:"message-drawer-conversation-unset-favourite",CONVERSATION_UNSET_MUTED:"message-drawer-conversation-unset-muted",PREFERENCES_UPDATED:"message-drawer-preferences-updated",ROUTE_CHANGED:"message-drawer-route-change",SHOW:"message-drawer-show",HIDE:"message-drawer-hide",TOGGLE_VISIBILITY:"message-drawer-toggle",SHOW_CONVERSATION:"message-drawer-show-conversation",SHOW_SETTINGS:"message-drawer-show-settings"}}));
/**
 * Controls the contact page in the message drawer.
 *
 * @module     core_message/message_drawer_view_contact
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_view_contact",["jquery","core/str","core/templates"],(function($,Str,Templates){var SELECTORS_CONTENT_CONTAINER='[data-region="content-container"]',TEMPLATES_CONTENT="core_message/message_drawer_view_contact_body_content",getContentContainer=function(root){return root.find(SELECTORS_CONTENT_CONTAINER)};return{show:function(namespace,header,body,footer,contact){var root=$(body);return getContentContainer(root).empty(),function(root,profile){return Templates.render(TEMPLATES_CONTENT,profile).then((function(html){return getContentContainer(root).append(html),html}))}(root,contact)},description:function(root,contact){return Str.get_string("messagedrawerviewcontact","core_message",contact.fullname)}}}));
/**
 * Manages the processor form on the message preferences page.
 *
 * @module     core_message/preferences_processor_form
 * @class      preferences_processor_form
 * @package    message
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/preferences_processor_form",["jquery","core/ajax","core/notification"],(function($,Ajax,Notification){var ProcessorForm=function(element){this.root=$(element),this.userId=this.root.attr("data-user-id"),this.name=this.root.attr("data-processor-name"),this.root.find("form").on("submit",function(e){e.preventDefault(),this.save().done((function(){$(element).trigger("mpp:formsubmitted")}))}.bind(this))};return ProcessorForm.prototype.startLoading=function(){this.root.addClass("loading")},ProcessorForm.prototype.stopLoading=function(){this.root.removeClass("loading")},ProcessorForm.prototype.isLoading=function(){return this.root.hasClass("loading")},ProcessorForm.prototype.save=function(){if(this.isLoading())return $.Deferred();this.startLoading();var data=this.root.find("form").serializeArray(),request={methodname:"core_message_message_processor_config_form",args:{userid:this.userId,name:this.name,formvalues:data}};return Ajax.call([request])[0].fail(Notification.exception).always(function(){this.stopLoading()}.bind(this))},ProcessorForm}));
function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}
/**
 * Controls a section of the overview page in the message drawer.
 *
 * @module     core_message/message_drawer_view_overview_section
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_view_overview_section",["jquery","core/custom_interaction_events","core/notification","core/pubsub","core/str","core/pending","core/templates","core/user_date","core_message/message_repository","core_message/message_drawer_events","core_message/message_drawer_router","core_message/message_drawer_routes","core_message/message_drawer_lazy_load_list","core_message/message_drawer_view_conversation_constants"],(function($,CustomEvents,Notification,PubSub,Str,Pending,Templates,UserDate,MessageRepository,MessageDrawerEvents,MessageDrawerRouter,MessageDrawerRoutes,LazyLoadList,MessageDrawerViewConversationContants){var SELECTORS_TOGGLE='[data-region="toggle"]',SELECTORS_CONVERSATION="[data-conversation-id]",SELECTORS_BLOCKED_ICON_CONTAINER='[data-region="contact-icon-blocked"]',SELECTORS_MUTED_ICON_CONTAINER='[data-region="muted-icon-container"]',SELECTORS_UNREAD_COUNT='[data-region="unread-count"]',SELECTORS_SECTION_TOTAL_COUNT='[data-region="section-total-count"]',SELECTORS_SECTION_TOTAL_COUNT_CONTAINER='[data-region="section-total-count-container"]',SELECTORS_SECTION_UNREAD_COUNT='[data-region="section-unread-count"]',SELECTORS_PLACEHOLDER_CONTAINER='[data-region="placeholder-container"]',TEMPLATES_CONVERSATIONS_LIST="core_message/message_drawer_conversations_list",TEMPLATES_CONVERSATIONS_LIST_ITEMS_PLACEHOLDER="core_message/message_drawer_conversations_list_items_placeholder",loadedConversationsById={},deletedConversationsById={},loadedTotalCounts=!1,loadedUnreadCounts=!1,isVisible=function(root){return LazyLoadList.getRoot(root).hasClass("show")},setExpanded=function(root){root.addClass("expanded")},formatConversationFromEvent=function(conversation){var formatted=function recursivelyLowercaseKeys(object){return Object.keys(object).reduce((function(carry,key){return $.isArray(object[key])?carry[key.toLowerCase()]=object[key].map(recursivelyLowercaseKeys):carry[key.toLowerCase()]=object[key],carry}),{})}(conversation);return formatted.messages=formatted.messages.map((function(message){return message.useridfrom=message.userfrom.id,message})),formatted},render=function(conversations,userId){var fn,_ref,pending=new Pending,formatMessagePreview=(fn=regeneratorRuntime.mark((function _callee(lastMessage){var tmpElement,messagePreview,pix,label,labelString,icon;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(lastMessage){_context.next=2;break}return _context.abrupt("return",null);case 2:if((tmpElement=document.createElement("element")).innerHTML=lastMessage.text.replace(/<img /g,"<noimg "),tmpElement.querySelector("[src]")){_context.next=10;break}if(!(messagePreview=$(lastMessage.text).text())){_context.next=10;break}if(-1!=messagePreview.indexOf("<")){_context.next=10;break}return _context.abrupt("return",messagePreview);case 10:return pix="i/messagecontentmultimediageneral",label="messagecontentmultimediageneral",lastMessage.text.includes("<img")?(pix="i/messagecontentimage",label="messagecontentimage"):lastMessage.text.includes("<video")?(pix="i/messagecontentvideo",label="messagecontentvideo"):lastMessage.text.includes("<audio")&&(pix="i/messagecontentaudio",label="messagecontentaudio"),_context.prev=13,_context.next=16,Str.get_string(label,"core_message");case 16:return labelString=_context.sent,_context.next=19,Templates.renderPix(pix,"core",labelString);case 19:return icon=_context.sent,_context.abrupt("return",icon+" "+labelString);case 23:return _context.prev=23,_context.t0=_context.catch(13),Notification.exception(_context.t0),_context.abrupt("return",null);case 27:case"end":return _context.stop()}}),_callee,null,[[13,23]])})),_ref=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(_x){return _ref.apply(this,arguments)}),mapPromises=conversations.map((function(conversation){var lastMessage=conversation.messages.length?conversation.messages[conversation.messages.length-1]:null;return formatMessagePreview(lastMessage).then((function(messagePreview){var formattedConversation={id:conversation.id,imageurl:conversation.imageurl,name:conversation.name,subname:conversation.subname,unreadcount:conversation.unreadcount,ismuted:conversation.ismuted,lastmessagedate:lastMessage?lastMessage.timecreated:null,sentfromcurrentuser:lastMessage?lastMessage.useridfrom==userId:null,lastmessage:messagePreview},otherUser=null;return conversation.type==MessageDrawerViewConversationContants.CONVERSATION_TYPES.SELF?otherUser=conversation.members[0]:conversation.type==MessageDrawerViewConversationContants.CONVERSATION_TYPES.PRIVATE&&(otherUser=conversation.members.reduce((function(carry,member){return carry||member.id==userId||(carry=member),carry}),null)),null!==otherUser&&(formattedConversation.userid=otherUser.id,formattedConversation.showonlinestatus=otherUser.showonlinestatus,formattedConversation.isonline=otherUser.isonline,formattedConversation.isblocked=otherUser.isblocked),conversation.type==MessageDrawerViewConversationContants.CONVERSATION_TYPES.PUBLIC&&(formattedConversation.lastsendername=conversation.members.reduce((function(carry,member){return!carry&&lastMessage&&member.id==lastMessage.useridfrom&&(carry=member.fullname),carry}),null)),formattedConversation})).catch(Notification.exception)}));return Promise.all(mapPromises).then((function(formattedConversations){return formattedConversations.forEach((function(conversation){(new Date).toDateString()==new Date(1e3*conversation.lastmessagedate).toDateString()&&(conversation.istoday=!0)})),Templates.render(TEMPLATES_CONVERSATIONS_LIST,{conversations:formattedConversations})})).then((function(html,js){return pending.resolve(),$.Deferred().resolve(html,js)})).catch((function(error){pending.resolve(),Notification.exception(error)}))},getTotalConversationCountElement=function(root){return root.find(SELECTORS_SECTION_TOTAL_COUNT)},decrementTotalUnreadConversationCount=function(root){if(loadedUnreadCounts){var element=function(root){return root.find(SELECTORS_SECTION_UNREAD_COUNT)}(root),count=parseInt(element.text());count-=1,element.text(count),count<1&&element.addClass("hidden")}},getConversationElement=function(root,conversationId){return root.find('[data-conversation-id="'+conversationId+'"]')},getConversationElementFromUserId=function(root,userId){return root.find('[data-user-id="'+userId+'"]')},createNewConversationFromEvent=function(root,conversation,userId){if(!root.find(SELECTORS_CONVERSATION).length){var listRoot=LazyLoadList.getRoot(root);LazyLoadList.showContent(listRoot),LazyLoadList.hideEmptyMessage(listRoot)}return loadedConversationsById[conversation.id]=conversation,render([conversation],userId).then((function(html){return LazyLoadList.getContentContainer(root).prepend(html)})).then((function(){return function(root){if(loadedTotalCounts){var element=getTotalConversationCountElement(root),count=parseInt(element.text());count+=1,element.text(count)}}(root)})).catch(Notification.exception)},deleteConversation=function(root,conversationElement){if(conversationElement.remove(),function(root){if(loadedTotalCounts){var element=getTotalConversationCountElement(root),count=parseInt(element.text());count-=1,element.text(count)}}(root),!root.find(SELECTORS_CONVERSATION).length){var listRoot=LazyLoadList.getRoot(root);LazyLoadList.hideContent(listRoot),LazyLoadList.showEmptyMessage(listRoot)}},registerEventListeners=function(namespace,root,loadCallback,types,includeFavourites,fromPanel){var listRoot=LazyLoadList.getRoot(root),conversationBelongsToThisSection=function(conversation){var conversationType=parseInt(conversation.type,10);return!(types&&types.indexOf(conversationType)<0||includeFavourites&&!conversation.isFavourite||!includeFavourites&&conversation.isFavourite)},toggle=root.find(SELECTORS_TOGGLE);root.css("min-height",toggle.outerHeight()),root.on("show.bs.collapse",(function(){setExpanded(root),LazyLoadList.show(listRoot,loadCallback,(function(contentContainer,conversations,userId){return render(conversations,userId).then((function(html){return contentContainer.append(html),html})).catch(Notification.exception)}))})),root.on("hidden.bs.collapse",(function(){!function(root){root.removeClass("expanded")}(root)})),PubSub.subscribe(MessageDrawerEvents.CONTACT_BLOCKED,(function(userId){var conversationElement=getConversationElementFromUserId(root,userId);conversationElement.length&&function(conversationElement){conversationElement.find(SELECTORS_BLOCKED_ICON_CONTAINER).removeClass("hidden")}(conversationElement)})),PubSub.subscribe(MessageDrawerEvents.CONTACT_UNBLOCKED,(function(userId){var conversationElement=getConversationElementFromUserId(root,userId);conversationElement.length&&function(conversationElement){conversationElement.find(SELECTORS_BLOCKED_ICON_CONTAINER).addClass("hidden")}(conversationElement)})),PubSub.subscribe(MessageDrawerEvents.CONVERSATION_SET_MUTED,(function(conversation){var conversationId=conversation.id,conversationElement=getConversationElement(root,conversationId);conversationElement.length&&function(conversationElement){conversationElement.find(SELECTORS_MUTED_ICON_CONTAINER).removeClass("hidden")}(conversationElement)})),PubSub.subscribe(MessageDrawerEvents.CONVERSATION_UNSET_MUTED,(function(conversation){var conversationId=conversation.id,conversationElement=getConversationElement(root,conversationId);conversationElement.length&&function(conversationElement){conversationElement.find(SELECTORS_MUTED_ICON_CONTAINER).addClass("hidden")}(conversationElement)})),PubSub.subscribe(MessageDrawerEvents.CONVERSATION_NEW_LAST_MESSAGE,(function(conversation){if(conversationBelongsToThisSection(conversation)){var pendingPromise=new Pending("core_message/message_drawer_view_overview_section:new"),loggedInUserId=conversation.loggedInUserId,conversationId=conversation.id,element=getConversationElement(root,conversationId);if(conversation=formatConversationFromEvent(conversation),element.length){var contentContainer=LazyLoadList.getContentContainer(root);render([conversation],loggedInUserId).then((function(html){deletedConversationsById[conversationId]&&conversation.messages[0].timeadded<deletedConversationsById[conversationId]||(contentContainer.prepend(html),element.remove())})).then(pendingPromise.resolve).catch(Notification.exception)}else conversation.messages.length?createNewConversationFromEvent(root,conversation,loggedInUserId).then(pendingPromise.resolve).catch():pendingPromise.resolve()}})),PubSub.subscribe(MessageDrawerEvents.CONVERSATION_DELETED,(function(conversationId){var conversationElement=getConversationElement(root,conversationId);delete loadedConversationsById[conversationId],deletedConversationsById[conversationId]=new Date,conversationElement.length&&deleteConversation(root,conversationElement)})),PubSub.subscribe(MessageDrawerEvents.CONVERSATION_READ,(function(conversationId){var conversationElement=getConversationElement(root,conversationId);conversationElement.length&&function(root,conversationElement){var unreadCount=conversationElement.find(SELECTORS_UNREAD_COUNT);unreadCount.text("0"),unreadCount.addClass("hidden"),decrementTotalUnreadConversationCount(root)}(root,conversationElement)})),PubSub.subscribe(MessageDrawerEvents.CONVERSATION_SET_FAVOURITE,(function(conversation){var conversationElement=null;conversationBelongsToThisSection(conversation)?(conversationElement=getConversationElement(root,conversation.id)).length||createNewConversationFromEvent(root,formatConversationFromEvent(conversation),conversation.loggedInUserId):(conversationElement=getConversationElement(root,conversation.id)).length&&deleteConversation(root,conversationElement)})),PubSub.subscribe(MessageDrawerEvents.CONVERSATION_UNSET_FAVOURITE,(function(conversation){var conversationElement=null;conversationBelongsToThisSection(conversation)?(conversationElement=getConversationElement(root,conversation.id)).length||createNewConversationFromEvent(root,formatConversationFromEvent(conversation),conversation.loggedInUserId):(conversationElement=getConversationElement(root,conversation.id)).length&&deleteConversation(root,conversationElement)})),CustomEvents.define(root,[CustomEvents.events.activate]),root.on(CustomEvents.events.activate,SELECTORS_CONVERSATION,(function(e,data){var conversationId=$(e.target).closest(SELECTORS_CONVERSATION).attr("data-conversation-id"),conversation=loadedConversationsById[conversationId];MessageDrawerRouter.go(namespace,MessageDrawerRoutes.VIEW_CONVERSATION,conversation,fromPanel),data.originalEvent.preventDefault()}))};return{show:function(namespace,header,body,footer,types,includeFavourites,totalCountPromise,unreadCountPromise,fromPanel){var root=$(body);if(!root.attr("data-init")){var loadCallback=function(types,includeFavourites,offset){var type=null,includeSelfConversations=!0;if(types&&types.length){var nonSelfConversationTypes=types.filter((function(candidate){return candidate!=MessageDrawerViewConversationContants.CONVERSATION_TYPES.SELF}));includeSelfConversations=types.length!=nonSelfConversationTypes.length,type=nonSelfConversationTypes[0]}return function(root,userId){return MessageRepository.getConversations(userId,type,51,offset,includeFavourites,includeSelfConversations).then((function(response){var conversations=response.conversations;return conversations.length>50?conversations=conversations.slice(0,-1):LazyLoadList.setLoadedAll(root,!0),offset+=50,conversations.forEach((function(conversation){loadedConversationsById[conversation.id]=conversation})),conversations})).catch(Notification.exception)}}(types,includeFavourites,0);if(registerEventListeners(namespace,root,loadCallback,types,includeFavourites,fromPanel),isVisible(root)){setExpanded(root);var listRoot=LazyLoadList.getRoot(root);LazyLoadList.show(listRoot,loadCallback,(function(contentContainer,conversations,userId){return render(conversations,userId).then((function(html){return contentContainer.append(html),html})).catch(Notification.exception)}))}totalCountPromise.then((function(count){!function(root,count){var container=root.find(SELECTORS_SECTION_TOTAL_COUNT_CONTAINER);container.find(SELECTORS_SECTION_TOTAL_COUNT).text(count),container.removeClass("hidden"),Str.get_string("totalconversations","core_message",count).done((function(string){container.attr("aria-label",string)}));var numPlaceholders=count>20?20:count,placeholders=Array.apply(null,Array(numPlaceholders)).map((function(){return!0}));Templates.render(TEMPLATES_CONVERSATIONS_LIST_ITEMS_PLACEHOLDER,{placeholders:placeholders}).then((function(html){root.find(SELECTORS_PLACEHOLDER_CONTAINER).html(html)})).catch((function(){}))}(root,count),loadedTotalCounts=!0})).catch((function(){})),unreadCountPromise.then((function(count){!function(root,count){var countElement=root.find(SELECTORS_SECTION_UNREAD_COUNT);countElement.text(count),Str.get_string("unreadconversations","core_message",count).done((function(string){countElement.attr("aria-label",string)})),count>0&&countElement.removeClass("hidden")}(root,count),loadedUnreadCounts=!0})).catch((function(){})),root.attr("data-init",!0)}},isVisible:isVisible}}));
/**
 * Controls the group info page of the message drawer.
 *
 * @module     core_message/message_drawer_view_group_info
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_view_group_info",["jquery","core/str","core/templates","core_message/message_repository","core_message/message_drawer_lazy_load_list"],(function($,Str,Templates,Repository,LazyLoadList){var SELECTORS_CONTENT_CONTAINER='[data-region="group-info-content-container"]',TEMPLATES_CONTENT="core_message/message_drawer_view_group_info_body_content",TEMPLATES_MEMBERS_LIST="core_message/message_drawer_view_group_info_participants_list",getContentContainer=function(root){return root.find(SELECTORS_CONTENT_CONTAINER)},renderMembersCallback=function(contentContainer,members){return Templates.render(TEMPLATES_MEMBERS_LIST,{contacts:members}).then((function(html){return contentContainer.append(html),html}))};return{show:function(namespace,header,body,footer,conversation,loggedInUserId){var root=$(body);return getContentContainer(root).empty(),function(root,conversation,loggedInUserId){var placeholderCount=conversation.totalMemberCount>50?50:conversation.totalMemberCount,placeholders=Array.apply(null,Array(placeholderCount)).map((function(){return!0})),templateContext={name:conversation.name,subname:conversation.subname,imageurl:conversation.imageUrl,placeholders:placeholders,loggedinuser:{id:loggedInUserId}};return Templates.render(TEMPLATES_CONTENT,templateContext).then((function(html){return getContentContainer(root).append(html),html}))}(root,conversation,loggedInUserId).then((function(){var listRoot=LazyLoadList.getRoot(root);LazyLoadList.show(listRoot,function(conversation,limit,offset){return function(root,userId){return Repository.getConversationMembers(conversation.id,userId,limit+1,offset).then((function(members){return members.length>limit?members=members.slice(0,-1):LazyLoadList.setLoadedAll(root,!0),offset+=limit,members.filter((function(member){return member.id!=userId}))}))}}(conversation,50,0),renderMembersCallback)}))},description:function(root,conversation){return Str.get_string("messagedrawerviewgroupinfo","core_message",conversation.name)}}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)
/**
 * A simple router for the message drawer that allows navigating between
 * the "pages" in the drawer.
 *
 * This module will maintain a linear history of the unique pages access
 * to allow navigating back.
 *
 * @module     core_message/message_drawer_router
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */}define("core_message/message_drawer_router",["jquery","core/pubsub","core/str","core_message/message_drawer_events"],(function($,PubSub,Str,MessageDrawerEvents){var routes={},history={},SELECTORS_CAN_RECEIVE_FOCUS='input:not([type="hidden"]), a[href], button, textarea, select, [tabindex]',SELECTORS_ROUTES_BACK="[data-route-back]",changeRoute=function(namespace,newRoute){var newConfig,fromPanel=[].slice.call(arguments).some((function(arg){return"frompanel"==arg})),args=[].slice.call(arguments,2),renderPromise=$.Deferred().resolve().promise();if(Object.keys(routes[namespace]).forEach((function(route){var config=routes[namespace][route],isMatch=route===newRoute;isMatch&&(newConfig=config),config.parameters.forEach((function(element){"object"===_typeof(element)&&null!==element&&(element.removeClass("previous"),element.attr("data-from-panel",!1),isMatch?(fromPanel&&element.attr("data-from-panel",!0),element.removeClass("hidden"),element.attr("aria-hidden",!1)):element.attr("data-in-panel")&&"view-search"!=newRoute&&"view-overview"!=newRoute||(element.addClass("hidden"),element.attr("aria-hidden",!0)))}))})),newConfig&&newConfig.onGo){renderPromise=newConfig.onGo.apply(void 0,newConfig.parameters.concat(args));for(var currentFocusElement=$(document.activeElement),hasFocus=!1,firstFocusable=null,i=1;i<newConfig.parameters.length;i++){var element=newConfig.parameters[i];if("object"===_typeof(element)&&null!==element&&(firstFocusable||(firstFocusable=element),element.has(currentFocusElement).length)){hasFocus=!0;break}}hasFocus||firstFocusable.find(SELECTORS_CAN_RECEIVE_FOCUS).filter(":visible").first().focus()}var record={route:newRoute,params:args,renderPromise:renderPromise};return PubSub.publish(MessageDrawerEvents.ROUTE_CHANGED,record),record},go=function(namespace){var currentFocusElement=$(document.activeElement),record=changeRoute.apply(namespace,arguments),inHistory=!1;history[namespace]||(history[namespace]=[]),history[namespace]=history[namespace].reduce((function(carry,previous){return previous.route===record.route&&(inHistory=!0),inHistory||carry.push(previous),carry}),[]);var historylength=history[namespace].length,previousRecord=historylength?history[namespace][historylength-1]:null;if(previousRecord){for(var prevConfig=routes[namespace][previousRecord.route],elements=prevConfig.parameters,i=1;i<elements.length;i++)"object"===_typeof(elements[i])&&null!==elements[i]&&elements[i].addClass("previous");previousRecord.focusElement=currentFocusElement,prevConfig.getDescription&&prevConfig.getDescription.apply(null,prevConfig.parameters.concat(previousRecord.params)).then((function(description){return Str.get_string("backto","core_message",description)})).then((function(label){return record.renderPromise.then((function(){routes[namespace][record.route].parameters.forEach((function(element){"object"===_typeof(element)&&element&&element.find(SELECTORS_ROUTES_BACK).attr("aria-label",label)}))}))})).catch((function(){}))}return history[namespace].push(record),record};return{add:function(namespace,route,parameters,onGo,getDescription){routes[namespace]||(routes[namespace]=[]),routes[namespace][route]={parameters:parameters,onGo:onGo,getDescription:getDescription}},go:go,back:function(namespace){if(history[namespace].length){history[namespace].pop();var previous=history[namespace].pop();previous&&(go.apply(void 0,[namespace,previous.route].concat(previous.params)),window.setTimeout((function(){previous.focusElement.focus()}),50))}}}}));
/**
 * Represents the notification processor (e.g. email, popup, jabber)
 *
 * @module     core_message/notification_processor
 * @class      notification_processor
 * @package    message
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/notification_processor",["jquery"],(function($){var SELECTORS_STATE_NONE='[data-state="none"]',SELECTORS_STATE_BOTH='[data-state="both"]',SELECTORS_STATE_LOGGED_IN='[data-state="loggedin"]',SELECTORS_STATE_LOGGED_OFF='[data-state="loggedoff"]',NotificationProcessor=function(element){this.root=$(element)};return NotificationProcessor.prototype.getName=function(){return this.root.attr("data-processor-name")},NotificationProcessor.prototype.isLoggedInEnabled=function(){if(this.root.find(SELECTORS_STATE_NONE).find("input").prop("checked"))return!1;var both=this.root.find(SELECTORS_STATE_BOTH).find("input");return this.root.find(SELECTORS_STATE_LOGGED_IN).find("input").prop("checked")||both.prop("checked")},NotificationProcessor.prototype.isLoggedOffEnabled=function(){if(this.root.find(SELECTORS_STATE_NONE).find("input").prop("checked"))return!1;var both=this.root.find(SELECTORS_STATE_BOTH).find("input");return this.root.find(SELECTORS_STATE_LOGGED_OFF).find("input").prop("checked")||both.prop("checked")},NotificationProcessor}));
/**
 * This module updates the UI for the conversation page in the message
 * drawer.
 *
 * The module will take a patch from the message_drawer_view_conversation_patcher
 * module and update the UI to reflect the changes.
 *
 * This is the only module that ever modifies the UI of the conversation page.
 *
 * @module     core_message/message_drawer_view_conversation_renderer
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_view_conversation_renderer",["jquery","core/notification","core/str","core/templates","core/user_date","core_message/message_drawer_view_conversation_constants"],(function($,Notification,Str,Templates,UserDate,Constants){var SELECTORS=Constants.SELECTORS,TEMPLATES=Constants.TEMPLATES,CONVERSATION_TYPES=Constants.CONVERSATION_TYPES,getMessagesContainer=function(body){return body.find(SELECTORS.CONTENT_MESSAGES_CONTAINER)},getSelfConversationMessageContainer=function(body){return body.find(SELECTORS.SELF_CONVERSATION_MESSAGE_CONTAINER)},getContactRequestSentContainer=function(body){return body.find(SELECTORS.CONTACT_REQUEST_SENT_MESSAGE_CONTAINER)},getFooterContentContainer=function(footer){return footer.find(SELECTORS.CONTENT_MESSAGES_FOOTER_CONTAINER)},getFooterEditModeContainer=function(footer){return footer.find(SELECTORS.CONTENT_MESSAGES_FOOTER_EDIT_MODE_CONTAINER)},getFooterPlaceholderContainer=function(footer){return footer.find(SELECTORS.PLACEHOLDER_CONTAINER)},showFooterPlaceholder=function(footer){getFooterPlaceholderContainer(footer).removeClass("hidden")},getFooterRequireContactContainer=function(footer){return footer.find(SELECTORS.CONTENT_MESSAGES_FOOTER_REQUIRE_CONTACT_CONTAINER)},getFooterRequireUnblockContainer=function(footer){return footer.find(SELECTORS.CONTENT_MESSAGES_FOOTER_REQUIRE_UNBLOCK_CONTAINER)},getFooterUnableToMessageContainer=function(footer){return footer.find(SELECTORS.CONTENT_MESSAGES_FOOTER_UNABLE_TO_MESSAGE_CONTAINER)},hideAllFooterElements=function(footer){!function(footer){getFooterContentContainer(footer).addClass("hidden")}(footer),function(footer){getFooterEditModeContainer(footer).addClass("hidden")}(footer),function(footer){getFooterPlaceholderContainer(footer).addClass("hidden")}(footer),function(footer){getFooterRequireContactContainer(footer).addClass("hidden")}(footer),function(footer){getFooterRequireUnblockContainer(footer).addClass("hidden")}(footer),function(footer){getFooterUnableToMessageContainer(footer).addClass("hidden")}(footer)},getContentPlaceholderContainer=function(body){return body.find(SELECTORS.CONTENT_PLACEHOLDER_CONTAINER)},getHeaderContent=function(header){return header.find(SELECTORS.HEADER)},showHeaderContent=function(header){getHeaderContent(header).removeClass("hidden")},hideHeaderContent=function(header){getHeaderContent(header).addClass("hidden")},getHeaderEditMode=function(header){return header.find(SELECTORS.HEADER_EDIT_MODE)},hideHeaderEditMode=function(header){getHeaderEditMode(header).addClass("hidden")},getHeaderPlaceholderContainer=function(header){return header.find(SELECTORS.HEADER_PLACEHOLDER_CONTAINER)},showHeaderPlaceholder=function(header){getHeaderPlaceholderContainer(header).removeClass("hidden")},hideHeaderPlaceholder=function(header){getHeaderPlaceholderContainer(header).addClass("hidden")},getMessageElement=function(body,messageId){return getMessagesContainer(body).find('[data-message-id="'+messageId+'"]')},getDayElement=function(body,dayTimeCreated){return getMessagesContainer(body).find('[data-day-id="'+dayTimeCreated+'"]')},getMoreMessagesLoadingIconContainer=function(body){return body.find(SELECTORS.MORE_MESSAGES_LOADING_ICON_CONTAINER)},getConfirmDialogueContainer=function(root){return root.find(SELECTORS.CONFIRM_DIALOGUE_CONTAINER)},showConfirmDialogueContainer=function(root){var container=getConfirmDialogueContainer(root),siblings=container.siblings(":not(.hidden)");siblings.attr("aria-hidden",!0),siblings.attr("tabindex",-1),siblings.attr("data-confirm-dialogue-hidden",!0),container.removeClass("hidden")},hideConfirmDialogueContainer=function(root){var container=getConfirmDialogueContainer(root),siblings=container.siblings('[data-confirm-dialogue-hidden="true"]');siblings.removeAttr("aria-hidden"),siblings.removeAttr("tabindex"),siblings.removeAttr("data-confirm-dialogue-hidden"),container.addClass("hidden")},formatMessagesForTemplate=function(messages,datesCache){return messages.map((function(message){return{id:message.id,isread:message.isRead,fromloggedinuser:message.fromLoggedInUser,userfrom:message.userFrom,text:message.text,formattedtime:message.timeCreated?datesCache[message.timeCreated]:null}}))},renderConversation=function(header,body,footer,data){var renderingPromises=[],hasAddDays=data.days.add.length>0,hasAddMessages=data.messages.add.length>0,hasUpdateMessages=data.messages.update.length>0,timestampsToFormat=[],datesCachePromise=$.Deferred().resolve({}).promise();return hasAddDays&&(timestampsToFormat=timestampsToFormat.concat(data.days.add.reduce((function(carry,day){return carry.concat(day.value.messages.reduce((function(timestamps,message){return message.timeCreated&&timestamps.push(message.timeCreated),timestamps}),[]))}),[]))),hasAddMessages&&(timestampsToFormat=timestampsToFormat.concat(data.messages.add.reduce((function(timestamps,message){return message.value.timeCreated&&timestamps.push(message.value.timeCreated),timestamps}),[]))),hasUpdateMessages&&(timestampsToFormat=timestampsToFormat.concat(data.messages.update.reduce((function(timestamps,message){return message.before.timeCreated!=message.after.timeCreated&&timestamps.push(message.after.timeCreated),timestamps}),[]))),timestampsToFormat.length&&(datesCachePromise=Str.get_string("strftimetime24","core_langconfig").then((function(format){var requests=timestampsToFormat.map((function(timestamp){return{timestamp:timestamp,format:format}}));return UserDate.get(requests)})).then((function(formattedTimes){return timestampsToFormat.reduce((function(carry,timestamp,index){return carry[timestamp]=formattedTimes[index],carry}),{})}))),hasAddDays&&renderingPromises.push(datesCachePromise.then((function(datesCache){return function(header,body,footer,days,datesCache){var messagesContainer=getMessagesContainer(body),daysRenderPromises=days.map((function(data){return Templates.render(TEMPLATES.DAY,{timestamp:data.value.timestamp,messages:formatMessagesForTemplate(data.value.messages,datesCache)})}));return $.when.apply($,daysRenderPromises).then((function(){days.forEach((function(data,index){daysRenderPromises[index].then((function(html){if(data.before){var element=getDayElement(body,data.before.timestamp);return $(html).insertBefore(element)}return messagesContainer.append(html)})).catch((function(){}))}))}))}(0,body,0,data.days.add,datesCache)}))),hasAddMessages&&renderingPromises.push(datesCachePromise.then((function(datesCache){return function(header,body,footer,messages,datesCache){var messagesData=messages.map((function(data){return data.value})),formattedMessages=formatMessagesForTemplate(messagesData,datesCache);return Templates.render(TEMPLATES.MESSAGES,{messages:formattedMessages}).then((function(html){var messageList=$(html);messages.forEach((function(data){var messageHtml=messageList.find('[data-message-id="'+data.value.id+'"]');if(data.before){var element=getMessageElement(body,data.before.id);return messageHtml.insertBefore(element)}return getDayElement(body,data.day.timestamp).find(SELECTORS.DAY_MESSAGES_CONTAINER).append(messageHtml)}))}))}(0,body,0,data.messages.add,datesCache)}))),hasUpdateMessages&&renderingPromises.push(datesCachePromise.then((function(datesCache){return function(header,body,footer,messages,datesCache){messages.forEach((function(message){var before=message.before,after=message.after,element=getMessageElement(body,before.id);if(before.id!=after.id&&element.attr("data-message-id",after.id),before.timeCreated!=after.timeCreated){var formattedTime=datesCache[after.timeCreated];element.find(SELECTORS.LOADING_ICON_CONTAINER).addClass("hidden"),element.find(SELECTORS.TIME_CREATED).text(formattedTime).removeClass("hidden")}if(before.sendState!=after.sendState){var loading=element.find(SELECTORS.LOADING_ICON_CONTAINER),time=element.find(SELECTORS.TIME_CREATED),retry=element.find(SELECTORS.RETRY_SEND);switch(loading.addClass("hidden"),loading.attr("aria-hidden","true"),time.addClass("hidden"),time.attr("aria-hidden","true"),retry.addClass("hidden"),retry.attr("aria-hidden","true"),element.removeClass("border border-danger"),after.sendState){case"pending":loading.removeClass("hidden"),loading.attr("aria-hidden","false");break;case"error":retry.removeClass("hidden"),retry.attr("aria-hidden","false"),element.addClass("border border-danger");break;case"sent":time.removeClass("hidden"),time.attr("aria-hidden","false")}}if(before.text!=after.text&&element.find(SELECTORS.TEXT_CONTAINER).html(after.text),before.errorMessage!=after.errorMessage){var messageContainer=element.find(SELECTORS.ERROR_MESSAGE_CONTAINER);message=messageContainer.find(SELECTORS.ERROR_MESSAGE),after.errorMessage?(messageContainer.removeClass("hidden"),messageContainer.attr("aria-hidden","false"),message.text(after.errorMessage)):(messageContainer.addClass("hidden"),messageContainer.attr("aria-hidden","true"),message.text(""))}}))}(0,body,0,data.messages.update,datesCache)}))),data.days.remove.length>0&&function(body,days){days.forEach((function(data){getDayElement(body,data.timestamp).remove()}))}(body,data.days.remove),data.messages.remove.length>0&&function(body,messages){messages.forEach((function(data){getMessageElement(body,data.id).remove()}))}(body,data.messages.remove),$.when.apply($,renderingPromises)},renderHeader=function(header,body,footer,data){var headerContainer=getHeaderContent(header),template=TEMPLATES.HEADER_PUBLIC;return data.context.showrouteback="false"===header.attr("data-from-panel"),data.type==CONVERSATION_TYPES.PRIVATE?template=data.showControls?TEMPLATES.HEADER_PRIVATE:TEMPLATES.HEADER_PRIVATE_NO_CONTROLS:data.type==CONVERSATION_TYPES.SELF&&(template=TEMPLATES.HEADER_SELF),Templates.render(template,data.context).then((function(html,js){Templates.replaceNodeContents(headerContainer,html,js)}))},renderFooter=function(header,body,footer,data){switch(hideAllFooterElements(footer),data.type){case"placeholder":return showFooterPlaceholder(footer);case"add-contact":return Str.get_strings([{key:"requirecontacttomessage",component:"core_message",param:data.user.fullname},{key:"isnotinyourcontacts",component:"core_message",param:data.user.fullname}]).then((function(strings){var title=strings[1],text=strings[0],footerContainer=getFooterRequireContactContainer(footer);return footerContainer.find(SELECTORS.TITLE).text(title),footerContainer.find(SELECTORS.TEXT).text(text),function(footer){getFooterRequireContactContainer(footer).removeClass("hidden")}(footer),strings}));case"edit-mode":return function(footer){getFooterEditModeContainer(footer).removeClass("hidden")}(footer);case"content":return function(footer){getFooterContentContainer(footer).removeClass("hidden")}(footer);case"unblock":return function(footer){getFooterRequireUnblockContainer(footer).removeClass("hidden")}(footer);case"unable-to-message":return function(footer){getFooterUnableToMessageContainer(footer).removeClass("hidden")}(footer)}return!0},renderScrollToMessage=function(header,body,footer,messageId){var messagesContainer=getMessagesContainer(body),position=getMessageElement(body,messageId).position();if(position){var scrollTop=messagesContainer.scrollTop()+position.top;messagesContainer.scrollTop(scrollTop)}},renderLoadingMembers=function(header,body,footer,isLoadingMembers){isLoadingMembers?(hideHeaderContent(header),showHeaderPlaceholder(header)):(showHeaderContent(header),hideHeaderPlaceholder(header))},renderLoadingFirstMessages=function(header,body,footer,isLoadingFirstMessages){isLoadingFirstMessages?(function(body){getMessagesContainer(body).addClass("hidden")}(body),function(body){getContentPlaceholderContainer(body).removeClass("hidden")}(body)):(function(body){getMessagesContainer(body).removeClass("hidden")}(body),function(body){getContentPlaceholderContainer(body).addClass("hidden")}(body))},renderLoadingMessages=function(header,body,footer,isLoading){isLoading?function(body){getMoreMessagesLoadingIconContainer(body).removeClass("hidden")}(body):function(body){getMoreMessagesLoadingIconContainer(body).addClass("hidden")}(body)},renderShowEmojiPicker=function(header,body,footer,show){var container=function(footer){return footer.find(SELECTORS.EMOJI_PICKER_CONTAINER)}(footer);show?(container.removeClass("hidden"),container.attr("aria-hidden",!1),container.find(SELECTORS.EMOJI_PICKER_SEARCH_INPUT).focus()):(container.addClass("hidden"),container.attr("aria-hidden",!0))},renderShowEmojiAutoComplete=function(header,body,footer,show){var container=function(footer){return footer.find(SELECTORS.EMOJI_AUTO_COMPLETE_CONTAINER)}(footer);show?(container.removeClass("hidden"),container.attr("aria-hidden",!1)):(container.addClass("hidden"),container.attr("aria-hidden",!0))},showConfirmDialogue=function(header,body,footer,buttonSelectors,bodyText,headerText,canCancel,skipHeader,showOk){var dialogue=getConfirmDialogueContainer(body),buttons=buttonSelectors.map((function(selector){return dialogue.find(selector)})),cancelButton=dialogue.find(SELECTORS.CONFIRM_DIALOGUE_CANCEL_BUTTON),okayButton=dialogue.find(SELECTORS.CONFIRM_DIALOGUE_OKAY_BUTTON),text=dialogue.find(SELECTORS.CONFIRM_DIALOGUE_TEXT),dialogueHeader=dialogue.find(SELECTORS.CONFIRM_DIALOGUE_HEADER);(dialogue.find("button").addClass("hidden"),canCancel?cancelButton.removeClass("hidden"):cancelButton.addClass("hidden"),showOk?okayButton.removeClass("hidden"):okayButton.addClass("hidden"),headerText)?((dialogueHeader=$('<h3 class="h6" data-region="dialogue-header"></h3>')).text(headerText),dialogue.find(SELECTORS.CONFIRM_DIALOGUE).prepend(dialogueHeader)):dialogueHeader.length&&dialogueHeader.remove();buttons.forEach((function(button){button.removeClass("hidden")})),text.text(bodyText),showConfirmDialogueContainer(footer),showConfirmDialogueContainer(body),skipHeader||showConfirmDialogueContainer(header),dialogue.find(SELECTORS.CAN_RECEIVE_FOCUS).filter(":visible").first().focus()},hideConfirmDialogue=function(header,body,footer){var dialogue=getConfirmDialogueContainer(body),cancelButton=dialogue.find(SELECTORS.CONFIRM_DIALOGUE_CANCEL_BUTTON),okayButton=dialogue.find(SELECTORS.CONFIRM_DIALOGUE_OKAY_BUTTON),text=dialogue.find(SELECTORS.CONFIRM_DIALOGUE_TEXT),dialogueHeader=dialogue.find(SELECTORS.CONFIRM_DIALOGUE_HEADER);return hideCheckDeleteDialogue(body),hideConfirmDialogueContainer(body),hideConfirmDialogueContainer(footer),hideConfirmDialogueContainer(header),dialogue.find("button").addClass("hidden"),cancelButton.removeClass("hidden"),okayButton.removeClass("hidden"),text.text(""),dialogueHeader.length&&dialogueHeader.remove(),header.find(SELECTORS.CAN_RECEIVE_FOCUS).first().focus(),!0},renderConfirmBlockUser=function(header,body,footer,user){return user?user.canmessageevenifblocked?Str.get_string("cantblockuser","core_message",user.fullname).then((function(string){return showConfirmDialogue(header,body,footer,[],string,"",!1,!1,!0)})):Str.get_string("blockuserconfirm","core_message",user.fullname).then((function(string){return showConfirmDialogue(header,body,footer,[SELECTORS.ACTION_CONFIRM_BLOCK],string,"",!0,!1)})):hideConfirmDialogue(header,body,footer)},renderConfirmUnblockUser=function(header,body,footer,user){return user?Str.get_string("unblockuserconfirm","core_message",user.fullname).then((function(string){return showConfirmDialogue(header,body,footer,[SELECTORS.ACTION_CONFIRM_UNBLOCK],string,"",!0,!1)})):hideConfirmDialogue(header,body,footer)},renderConfirmAddContact=function(header,body,footer,user){return user?Str.get_string("addcontactconfirm","core_message",user.fullname).then((function(string){return showConfirmDialogue(header,body,footer,[SELECTORS.ACTION_CONFIRM_ADD_CONTACT],string,"",!0,!1)})):hideConfirmDialogue(header,body,footer)},renderConfirmRemoveContact=function(header,body,footer,user){return user?Str.get_string("removecontactconfirm","core_message",user.fullname).then((function(string){return showConfirmDialogue(header,body,footer,[SELECTORS.ACTION_CONFIRM_REMOVE_CONTACT],string,"",!0,!1)})):hideConfirmDialogue(header,body,footer)},renderConfirmDeleteSelectedMessages=function(header,body,footer,data){var showmessage=null;return data.type==CONVERSATION_TYPES.SELF?showmessage="deleteselectedmessagesconfirmselfconversation":data.canDeleteMessagesForAllUsers?(showCheckDeleteDialogue(body),showmessage="deleteforeveryoneselectedmessagesconfirm"):showmessage="deleteselectedmessagesconfirm",data.show?Str.get_string(showmessage,"core_message").then((function(string){return showConfirmDialogue(header,body,footer,[SELECTORS.ACTION_CONFIRM_DELETE_SELECTED_MESSAGES],string,"",!0,!1)})):hideConfirmDialogue(header,body,footer)},renderConfirmDeleteConversation=function(header,body,footer,type){var showmessage=null;return type==CONVERSATION_TYPES.SELF?showmessage="deleteallselfconfirm":type&&(showmessage="deleteallconfirm"),showmessage?Str.get_string(showmessage,"core_message").then((function(string){return showConfirmDialogue(header,body,footer,[SELECTORS.ACTION_CONFIRM_DELETE_CONVERSATION],string,"",!0,!1)})):hideConfirmDialogue(header,body,footer)},renderConfirmContactRequest=function(header,body,footer,user){return user?Str.get_string("userwouldliketocontactyou","core_message",user.fullname).then((function(string){var buttonSelectors=[SELECTORS.ACTION_ACCEPT_CONTACT_REQUEST,SELECTORS.ACTION_DECLINE_CONTACT_REQUEST];return showConfirmDialogue(header,body,footer,buttonSelectors,string,"",!1,!0)})):hideConfirmDialogue(header,body,footer)},showCheckDeleteDialogue=function(body){getConfirmDialogueContainer(body).find(SELECTORS.DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE_CONTAINER).removeClass("hidden")},hideCheckDeleteDialogue=function(body){var dialogue=getConfirmDialogueContainer(body),checkboxRegion=dialogue.find(SELECTORS.DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE_CONTAINER);dialogue.find(SELECTORS.DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE).prop("checked",!1),checkboxRegion.addClass("hidden")},renderIsBlocked=function(header,body,footer,isBlocked){isBlocked?(header.find(SELECTORS.ACTION_REQUEST_BLOCK).addClass("hidden"),header.find(SELECTORS.ACTION_REQUEST_UNBLOCK).removeClass("hidden")):(header.find(SELECTORS.ACTION_REQUEST_BLOCK).removeClass("hidden"),header.find(SELECTORS.ACTION_REQUEST_UNBLOCK).addClass("hidden"))},renderIsFavourite=function(header,body,footer,state){var favouriteIcon=header.find(SELECTORS.FAVOURITE_ICON_CONTAINER),addFavourite=header.find(SELECTORS.ACTION_CONFIRM_FAVOURITE),removeFavourite=header.find(SELECTORS.ACTION_CONFIRM_UNFAVOURITE);switch(state){case"hide":favouriteIcon.addClass("hidden"),addFavourite.addClass("hidden"),removeFavourite.addClass("hidden");break;case"show-add":favouriteIcon.addClass("hidden"),addFavourite.removeClass("hidden"),removeFavourite.addClass("hidden");break;case"show-remove":favouriteIcon.removeClass("hidden"),addFavourite.addClass("hidden"),removeFavourite.removeClass("hidden")}},renderIsMuted=function(header,body,footer,state){var muteIcon=header.find(SELECTORS.MUTED_ICON_CONTAINER),setMuted=header.find(SELECTORS.ACTION_CONFIRM_MUTE),unsetMuted=header.find(SELECTORS.ACTION_CONFIRM_UNMUTE);switch(state){case"hide":muteIcon.addClass("hidden"),setMuted.addClass("hidden"),unsetMuted.addClass("hidden");break;case"show-mute":muteIcon.addClass("hidden"),setMuted.removeClass("hidden"),unsetMuted.addClass("hidden");break;case"show-unmute":muteIcon.removeClass("hidden"),setMuted.addClass("hidden"),unsetMuted.removeClass("hidden")}},renderIsContact=function(header,body,footer,state){var addContact=header.find(SELECTORS.ACTION_REQUEST_ADD_CONTACT),removeContact=header.find(SELECTORS.ACTION_REQUEST_REMOVE_CONTACT);switch(state){case"pending-contact":addContact.addClass("hidden"),removeContact.addClass("hidden");break;case"contact":addContact.addClass("hidden"),removeContact.removeClass("hidden");break;case"non-contact":addContact.removeClass("hidden"),removeContact.addClass("hidden")}},renderLoadingConfirmAction=function(header,body,footer,isLoading){var dialogue=getConfirmDialogueContainer(body),buttons=dialogue.find("button"),buttonText=dialogue.find(SELECTORS.CONFIRM_DIALOGUE_BUTTON_TEXT),loadingIcon=dialogue.find(SELECTORS.LOADING_ICON_CONTAINER);isLoading?(buttons.prop("disabled",!0),buttonText.addClass("hidden"),loadingIcon.removeClass("hidden")):(buttons.prop("disabled",!1),buttonText.removeClass("hidden"),loadingIcon.addClass("hidden"))},renderInEditMode=function(header,body,footer,inEditMode){var messages=null;inEditMode?((messages=body.find(SELECTORS.MESSAGE_NOT_SELECTED)).find(SELECTORS.MESSAGE_NOT_SELECTED_ICON).removeClass("hidden"),hideHeaderContent(header),function(header){getHeaderEditMode(header).removeClass("hidden")}(header)):((messages=getMessagesContainer(body)).find(SELECTORS.MESSAGE_NOT_SELECTED_ICON).addClass("hidden"),messages.find(SELECTORS.MESSAGE_SELECTED_ICON).addClass("hidden"),showHeaderContent(header),hideHeaderEditMode(header))},renderSelectedMessages=function(header,body,footer,data){var hasSelectedMessages=data.count>0;data.add.length&&data.add.forEach((function(messageId){var message=getMessageElement(body,messageId);message.find(SELECTORS.MESSAGE_NOT_SELECTED_ICON).addClass("hidden"),message.find(SELECTORS.MESSAGE_SELECTED_ICON).removeClass("hidden"),message.attr("aria-checked",!0)})),data.remove.length&&data.remove.forEach((function(messageId){var message=getMessageElement(body,messageId);hasSelectedMessages&&message.find(SELECTORS.MESSAGE_NOT_SELECTED_ICON).removeClass("hidden"),message.find(SELECTORS.MESSAGE_SELECTED_ICON).addClass("hidden"),message.attr("aria-checked",!1)})),function(header,value){getHeaderEditMode(header).find(SELECTORS.MESSAGES_SELECTED_COUNT).text(value)}(header,data.count)},renderRequireAddContact=function(header,body,footer,data){return data.show&&!data.hasMessages?Str.get_strings([{key:"requirecontacttomessage",component:"core_message",param:data.user.fullname},{key:"isnotinyourcontacts",component:"core_message",param:data.user.fullname}]).then((function(strings){var title=strings[1],text=strings[0];return showConfirmDialogue(header,body,footer,[SELECTORS.ACTION_REQUEST_ADD_CONTACT],text,title,!1,!0)})):hideConfirmDialogue(header,body,footer)},renderSelfConversationMessage=function(header,body,footer,displayMessage){var container=getSelfConversationMessageContainer(body);return displayMessage?container.removeClass("hidden"):container.addClass("hidden"),!0},renderContactRequestSent=function(header,body,footer,userFullName){var container=getContactRequestSentContainer(body);return userFullName?Str.get_string("yourcontactrequestpending","core_message",userFullName).then((function(string){return container.find(SELECTORS.TEXT).text(string),container.removeClass("hidden"),string})):(container.addClass("hidden"),!0)},renderReset=function(header,body,footer){return hideConfirmDialogue(header,body,footer),function(body){getContactRequestSentContainer(body).addClass("hidden")}(body),function(body){getSelfConversationMessageContainer(body).addClass("hidden")}(body),function(header){hideHeaderContent(header),hideHeaderEditMode(header),hideHeaderPlaceholder(header)}(header),showHeaderPlaceholder(header),hideAllFooterElements(footer),showFooterPlaceholder(footer),!0};return{render:function(header,body,footer,patch){var configs=[{reset:renderReset},{conversation:renderConversation,header:renderHeader,footer:renderFooter,confirmBlockUser:renderConfirmBlockUser,confirmUnblockUser:renderConfirmUnblockUser,confirmAddContact:renderConfirmAddContact,confirmRemoveContact:renderConfirmRemoveContact,confirmDeleteSelectedMessages:renderConfirmDeleteSelectedMessages,confirmDeleteConversation:renderConfirmDeleteConversation,confirmContactRequest:renderConfirmContactRequest,requireAddContact:renderRequireAddContact,selfConversationMessage:renderSelfConversationMessage,contactRequestSent:renderContactRequestSent},{loadingMembers:renderLoadingMembers,loadingFirstMessages:renderLoadingFirstMessages,loadingMessages:renderLoadingMessages,isBlocked:renderIsBlocked,isContact:renderIsContact,isFavourite:renderIsFavourite,isMuted:renderIsMuted,loadingConfirmAction:renderLoadingConfirmAction,inEditMode:renderInEditMode,showEmojiPicker:renderShowEmojiPicker,showEmojiAutoComplete:renderShowEmojiAutoComplete},{scrollToMessage:renderScrollToMessage,selectedMessages:renderSelectedMessages}],processConfig=function(config){var results=[];for(var key in patch)if(config.hasOwnProperty(key)){var renderFunc=config[key],patchValue=patch[key];results.push(renderFunc(header,body,footer,patchValue))}return results},renderingPromises=processConfig(configs[0]);return renderingPromises=renderingPromises.concat(processConfig(configs[1])),$.when.apply($,renderingPromises).then((function(){for(var i=2;i<configs.length;i++)processConfig(configs[i])})).catch(Notification.exception)}}}));
define("core_message/message_send_bulk",["exports","core/str","core/modal_factory","core/templates","core/modal_events","core/ajax","core/notification"],(function(_exports,_str,_modal_factory,_templates,_modal_events,_ajax,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Send bulk message to the given user ids.
   *
   * @module     core_message/message_send_bulk
   * @copyright  2019 Shamim Rezaie <shamim@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.showModal=_exports.sendMessage=void 0,_modal_factory=_interopRequireDefault(_modal_factory),_templates=_interopRequireDefault(_templates),_modal_events=_interopRequireDefault(_modal_events),_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification);_exports.showModal=function(users){var callback=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!users.length)return Promise.resolve();var titlePromise=null;return titlePromise=1==users.length?(0,_str.get_string)("sendbulkmessagesingle","core_message"):(0,_str.get_string)("sendbulkmessage","core_message",users.length),_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,body:_templates.default.render("core_message/send_bulk_message",{}),title:titlePromise}).then((function(modal){return modal.setSaveButtonText(titlePromise),modal.getRoot().on(_modal_events.default.hidden,(function(){callback&&callback(),modal.getRoot().remove()})),modal.getRoot().on(_modal_events.default.save,(function(){var messageText=modal.getRoot().find("form textarea").val();sendMessage(messageText,users)})),modal.show(),modal}))};var sendMessage=function(messageText,users){var messages=[];return users.forEach((function(user){messages.push({touserid:user,text:messageText})})),_ajax.default.call([{methodname:"core_message_send_instant_messages",args:{messages:messages}}])[0].then((function(messageIds){return 1==messageIds.length?(0,_str.get_string)("sendbulkmessagesentsingle","core_message"):(0,_str.get_string)("sendbulkmessagesent","core_message",messageIds.length)})).then((function(msg){return _notification.default.addNotification({message:msg,type:"success"}),!0})).catch(_notification.default.exception)};_exports.sendMessage=sendMessage}));
/**
 * Controls the message popover in the nav bar.
 *
 * @module     core_message/message_popover
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_popover",["jquery","core/custom_interaction_events","core/pubsub","core_message/message_drawer_events"],(function($,CustomEvents,PubSub,MessageDrawerEvents){var SELECTORS_COUNT_CONTAINER='[data-region="count-container"]',handleDecrementConversationCount=function(button){return function(){var countContainer=button.find(SELECTORS_COUNT_CONTAINER),count=parseInt(countContainer.text(),10);isNaN(count)||!count||count<2?countContainer.addClass("hidden"):(count-=1,countContainer.text(count))}},registerEventListeners=function(button){CustomEvents.define(button,[CustomEvents.events.activate]),button.on(CustomEvents.events.activate,(function(e,data){var buttonid;buttonid=button.attr("id"),PubSub.publish(MessageDrawerEvents.TOGGLE_VISIBILITY,buttonid),button.focus(),data.originalEvent.preventDefault()})),PubSub.subscribe(MessageDrawerEvents.CONVERSATION_READ,handleDecrementConversationCount(button)),PubSub.subscribe(MessageDrawerEvents.CONTACT_REQUEST_ACCEPTED,handleDecrementConversationCount(button)),PubSub.subscribe(MessageDrawerEvents.CONTACT_REQUEST_DECLINED,handleDecrementConversationCount(button))};return{init:function(button){button=$(button),registerEventListeners(button)}}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)
/**
 * This module will take 2 view states from the message_drawer_view_conversation
 * module and generate a patch that can be given to the
 * message_drawer_view_conversation_renderer module to update the UI.
 *
 * This module should never modify either state. It's purely a read only
 * module.
 *
 * @module     core_message/message_drawer_view_conversation_patcher
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */}define("core_message/message_drawer_view_conversation_patcher",["jquery","core/user_date","core_message/message_drawer_view_conversation_constants"],(function($,UserDate,Constants){var sortMessagesByDay=function(messages,midnight){var messagesByDay=messages.reduce((function(carry,message){var timeCreated=message.timeCreated?message.timeCreated:midnight,dayTimestamp=UserDate.getUserMidnightForTimestamp(timeCreated,midnight);return carry.hasOwnProperty(dayTimestamp)?carry[dayTimestamp].push(message):carry[dayTimestamp]=[message],carry}),{});return Object.keys(messagesByDay).map((function(dayTimestamp){return{timestamp:dayTimestamp,messages:messagesByDay[dayTimestamp]}}))},diffArrays=function(a,b,matchFunction){b=b.slice();var missingFromB=[],matches=[];return a.forEach((function(current){for(var found=!1,index=0;index<b.length;index++){var next=b[index];if(matchFunction(current,next)){found=!0,matches.push({a:current,b:next});break}}found?b.splice(index,1):missingFromB.push(current)})),{missingFromA:b,missingFromB:missingFromB,matches:matches}},findPositionInArray=function(array,breakFunction){for(var i=0;i<array.length;i++){var candidate=array[i];if(breakFunction(candidate))return candidate}return null},isArrayEqual=function(a,b){a=a.slice(),b=b.slice(),a.sort(),b.sort();var aLength=a.length,bLength=b.length;return aLength<1&&bLength<1||aLength==bLength&&a.every((function(item,index){return item==b[index]}))},isObjectEqual=function isObjectEqual(a,b){var aKeys=Object.keys(a),bKeys=Object.keys(b);return aKeys.length==bKeys.length&&aKeys.every((function(key){var aVal=a[key],bVal=b[key],aType=_typeof(aVal),bType=_typeof(bVal);if(bType=null===aVal?"null":bType,(aType="object"===(aType=null===aVal?"null":aType)&&Array.isArray(aType)?"array":aType)!==(bType="object"===bType&&Array.isArray(bType)?"array":bType))return!1;switch(aType){case"object":return isObjectEqual(aVal,bVal);case"array":return isArrayEqual(aVal,bVal);default:return a[key]==b[key]}}))},isMessageEqual=function(a,b){return isObjectEqual({id:a.id,state:a.sendState,text:a.text,timeCreated:a.timeCreated},{id:b.id,state:b.sendState,text:b.text,timeCreated:b.timeCreated})},buildDaysPatch=function(current,remove,add){return{remove:remove,add:add.map((function(day){return{before:findPositionInArray(current,(function(candidate){return day.timestamp<candidate.timestamp})),value:day}}))}},buildConversationPatch=function(state,newState){var matchingDays,remove,add,update,diff=diffArrays(state.messages,newState.messages,isMessageEqual);if(diff.missingFromA.length||diff.missingFromB.length){var current=sortMessagesByDay(state.messages,state.midnight),next=sortMessagesByDay(newState.messages,newState.midnight),daysDiff=diffArrays(current,next,(function(dayCurrent,dayNext){return dayCurrent.timestamp==dayNext.timestamp}));return{days:buildDaysPatch(current,daysDiff.missingFromB,daysDiff.missingFromA),messages:(matchingDays=daysDiff.matches,remove=[],add=[],update=[],matchingDays.forEach((function(days){var dayCurrent=days.a,dayNext=days.b,messagesDiff=diffArrays(dayCurrent.messages,dayNext.messages,isMessageEqual),patch=diffArrays(messagesDiff.missingFromB,messagesDiff.missingFromA,(function(a,b){return a.id==b.id||a.sendState!=b.sendState&&a.timeAdded==b.timeAdded}));remove=remove.concat(patch.missingFromB),patch.missingFromA.forEach((function(message){var before=null;message.timeCreated&&(before=findPositionInArray(dayCurrent.messages,(function(candidate){return message.timeCreated==candidate.timeCreated?message.id<candidate.id:message.timeCreated<candidate.timeCreated}))),add.push({before:before,value:message,day:dayCurrent})})),update=update.concat(patch.matches.map((function(message){return{before:message.a,after:message.b}})))})),{add:add,remove:remove,update:update})}}return null},buildHeaderPatchTypePrivate=function(state,newState){var requireAddContact=buildRequireAddContact(state,newState),confirmContactRequest=buildConfirmContactRequest(state,newState),oldOtherUser=getOtherUserFromState(state),newOtherUser=getOtherUserFromState(newState),requiresAddContact=requireAddContact&&requireAddContact.show&&!requireAddContact.hasMessages,requiredAddContact=requireAddContact&&!requireAddContact.show,shouldRenderHeader=!oldOtherUser&&newOtherUser;return(shouldRenderHeader=(shouldRenderHeader=shouldRenderHeader||requiresAddContact||requiredAddContact)||null!==confirmContactRequest)?{type:Constants.CONVERSATION_TYPES.PRIVATE,showControls:!requiresAddContact&&!confirmContactRequest,context:{id:newState.id,name:newState.name,subname:newState.subname,totalmembercount:newState.totalMemberCount,imageurl:newState.imageUrl,isfavourite:newState.isFavourite,ismuted:newState.isMuted,showfavourite:null!==newState.id,userid:newOtherUser.id,showonlinestatus:newOtherUser.showonlinestatus,isonline:newOtherUser.isonline,isblocked:newOtherUser.isblocked,iscontact:newOtherUser.iscontact}}:null},buildHeaderPatchTypeSelf=function(state,newState){return null===state.name&&null!==newState.name?{type:Constants.CONVERSATION_TYPES.SELF,showControls:!1,context:{id:newState.id,name:newState.name,subname:newState.subname,imageurl:newState.imageUrl,isfavourite:newState.isFavourite,showfavourite:null!==newState.id,showonlinestatus:!0}}:null},buildHeaderPatchTypePublic=function(state,newState){return state.totalMemberCount!=newState.totalMemberCount?{type:Constants.CONVERSATION_TYPES.PUBLIC,showControls:!0,context:{id:newState.id,name:newState.name,subname:newState.subname,totalmembercount:newState.totalMemberCount,imageurl:newState.imageUrl,isfavourite:newState.isFavourite,ismuted:newState.isMuted,showfavourite:null!==newState.id}}:null},buildScrollToMessagePatch=function(state,newState){var oldMessages=state.messages,newMessages=newState.messages;if(newMessages.length<1)return null;if(oldMessages.length<1)return newMessages[newMessages.length-1].id;var previousNewest=oldMessages[state.messages.length-1],currentNewest=newMessages[newMessages.length-1],previousOldest=oldMessages[0],currentOldest=newMessages[0];return previousNewest.id!=currentNewest.id?currentNewest.id:previousOldest.id!=currentOldest.id?previousOldest.id:null},buildLoadingMembersPatch=function(state,newState){return!(state.loadingMembers||!newState.loadingMembers)||!(state.loadingMembers&&!newState.loadingMembers)&&null},buildLoadingFirstMessages=function(state,newState){return state.hasTriedToLoadMessages===newState.hasTriedToLoadMessages?null:!(newState.hasTriedToLoadMessages||!newState.loadingMessages)||!(newState.hasTriedToLoadMessages&&!newState.loadingMessages)&&null},buildLoadingMessages=function(state,newState){return!(state.loadingMessages||!newState.loadingMessages)||!(state.loadingMessages&&!newState.loadingMessages)&&null},buildShowEmojiPicker=function(state,newState){return!(state.showEmojiPicker||!newState.showEmojiPicker)||!(state.showEmojiPicker&&!newState.showEmojiPicker)&&null},buildShowEmojiAutoComplete=function(state,newState){return!(state.showEmojiAutoComplete||!newState.showEmojiAutoComplete)||!(state.showEmojiAutoComplete&&!newState.showEmojiAutoComplete)&&null},buildConfirmBlockUser=function(state,newState){if(newState.pendingBlockUserIds.length){var userId=newState.pendingBlockUserIds[0];return newState.members[userId]}return!state.pendingBlockUserIds.length&&null},buildConfirmUnblockUser=function(state,newState){if(newState.pendingUnblockUserIds.length){var userId=newState.pendingUnblockUserIds[0];return newState.members[userId]}return!state.pendingUnblockUserIds.length&&null},buildConfirmAddContact=function(state,newState){if(newState.pendingAddContactIds.length){var userId=newState.pendingAddContactIds[0];return newState.members[userId]}return!state.pendingAddContactIds.length&&null},buildConfirmRemoveContact=function(state,newState){if(newState.pendingRemoveContactIds.length){var userId=newState.pendingRemoveContactIds[0];return newState.members[userId]}return!state.pendingRemoveContactIds.length&&null},buildConfirmDeleteSelectedMessages=function(state,newState){var oldPendingCount=state.pendingDeleteMessageIds.length,newPendingCount=newState.pendingDeleteMessageIds.length;return newPendingCount&&!oldPendingCount?{show:!0,type:newState.type,canDeleteMessagesForAllUsers:newState.canDeleteMessagesForAllUsers}:oldPendingCount&&!newPendingCount?{show:!1}:null},buildConfirmDeleteConversation=function(state,newState){return!state.pendingDeleteConversation&&newState.pendingDeleteConversation?newState.type:!(state.pendingDeleteConversation&&!newState.pendingDeleteConversation)&&null},buildConfirmContactRequest=function(state,newState){var loggedInUserId=state.loggedInUserId,oldOtherUser=getOtherUserFromState(state),newOtherUser=getOtherUserFromState(newState),oldReceivedRequests=oldOtherUser?oldOtherUser.contactrequests.filter((function(request){return request.requesteduserid==loggedInUserId&&request.userid==oldOtherUser.id})):[],newReceivedRequests=newOtherUser?newOtherUser.contactrequests.filter((function(request){return request.requesteduserid==loggedInUserId&&request.userid==newOtherUser.id})):[],oldRequest=oldReceivedRequests.length?oldReceivedRequests[0]:null,newRequest=newReceivedRequests.length?newReceivedRequests[0]:null;return!oldRequest&&newRequest?newOtherUser:!(oldRequest&&!newRequest)&&null},buildIsBlocked=function(state,newState){var oldOtherUser=getOtherUserFromState(state),newOtherUser=getOtherUserFromState(newState);return oldOtherUser||newOtherUser?!oldOtherUser&&newOtherUser?!!newOtherUser.isblocked||null:!newOtherUser&&oldOtherUser?!oldOtherUser.isblocked&&null:!(oldOtherUser.isblocked&&!newOtherUser.isblocked)&&(!(oldOtherUser.isblocked||!newOtherUser.isblocked)||null):null},buildIsFavourite=function(state,newState){var oldIsFavourite=state.isFavourite,newIsFavourite=newState.isFavourite;return null===state.id&&null===newState.id?null:null===state.id&&null!==newState.id?"show-add":null!==state.id&&null===newState.id?"hide":oldIsFavourite==newIsFavourite?null:!oldIsFavourite&&newIsFavourite?"show-remove":oldIsFavourite&&!newIsFavourite?"show-add":null},buildIsMuted=function(state,newState){var oldIsMuted=state.isMuted,newIsMuted=newState.isMuted;return null===state.id&&null===newState.id?null:null===state.id&&null!==newState.id?"show-mute":null!==state.id&&null===newState.id?"hide":oldIsMuted==newIsMuted?null:!oldIsMuted&&newIsMuted?"show-unmute":oldIsMuted&&!newIsMuted?"show-mute":null},buildIsContact=function(state,newState){var loggedInUserId=state.loggedInUserId,oldOtherUser=getOtherUserFromState(state),newOtherUser=getOtherUserFromState(newState),oldContactRequests=oldOtherUser?oldOtherUser.contactrequests.filter((function(request){return request.userid==loggedInUserId&&request.requesteduserid==oldOtherUser.id||request.userid==oldOtherUser.id&&request.requesteduserid==loggedInUserId})):[],newContactRequests=newOtherUser?newOtherUser.contactrequests.filter((function(request){return request.userid==loggedInUserId&&request.requesteduserid==newOtherUser.id||request.userid==newOtherUser.id&&request.requesteduserid==loggedInUserId})):[],oldHasContactRequests=oldContactRequests.length>0,newHasContactRequests=newContactRequests.length>0;return oldOtherUser||newOtherUser?oldHasContactRequests&&newHasContactRequests?null:oldHasContactRequests||!newHasContactRequests||newOtherUser.iscontact?!oldOtherUser&&newOtherUser?newOtherUser.iscontact?"contact":null:!newOtherUser&&oldOtherUser?oldOtherUser.iscontact?"non-contact":null:oldOtherUser.iscontact&&!newOtherUser.iscontact?newHasContactRequests?"pending-contact":"non-contact":!oldOtherUser.iscontact&&newOtherUser.iscontact?"contact":null:"pending-contact":null},buildLoadingConfirmationAction=function(state,newState){return!(state.loadingConfirmAction||!newState.loadingConfirmAction)||!(state.loadingConfirmAction&&!newState.loadingConfirmAction)&&null},buildInEditMode=function(state,newState){var oldHasSelectedMessages=state.selectedMessageIds.length>0,newHasSelectedMessages=newState.selectedMessageIds.length>0,numberOfMessagesHasChanged=state.messages.length!=newState.messages.length;return!(oldHasSelectedMessages||!newHasSelectedMessages)||!(oldHasSelectedMessages&&!newHasSelectedMessages)&&(!(!oldHasSelectedMessages||!numberOfMessagesHasChanged)||null)},buildSelectedMessages=function(state,newState){var oldSelectedMessages=state.selectedMessageIds,newSelectedMessages=newState.selectedMessageIds;if(isArrayEqual(oldSelectedMessages,newSelectedMessages))return null;var diff=diffArrays(oldSelectedMessages,newSelectedMessages,(function(a,b){return a==b}));return{count:newSelectedMessages.length,add:diff.missingFromA,remove:diff.missingFromB}},getOtherUserFromState=function(state){return Object.keys(state.members).reduce((function(carry,userId){return userId==state.loggedInUserId||carry||(carry=state.members[userId]),carry}),null)},requiresContactRequest=function(loggedInUserId,user){if(user.canmessage)return!1;var hasSentContactRequest=user.contactrequests.filter((function(request){return request.userid==loggedInUserId||request.requesteduserid})).length>0;return user.requirescontact&&!user.iscontact&&!hasSentContactRequest},buildRequireAddContact=function(state,newState){var oldOtherUser=getOtherUserFromState(state),newOtherUser=getOtherUserFromState(newState),hadMessages=state.messages.length>0,hasMessages=newState.messages.length>0,loggedInUserId=newState.loggedInUserId,prevRequiresContactRequest=oldOtherUser&&requiresContactRequest(loggedInUserId,oldOtherUser),nextRequiresContactRequest=newOtherUser&&requiresContactRequest(loggedInUserId,newOtherUser),finishedAddContact=!1===buildConfirmAddContact(state,newState);if(!state.hasTriedToLoadMessages&&!newState.hasTriedToLoadMessages)return null;if(!oldOtherUser&&!newOtherUser)return null;if(!oldOtherUser&&nextRequiresContactRequest)return{show:!0,hasMessages:hasMessages,user:newOtherUser};if(finishedAddContact&&nextRequiresContactRequest)return{show:!0,hasMessages:hasMessages,user:newOtherUser};if(state.hasTriedToLoadMessages&&newState.hasTriedToLoadMessages){if(!prevRequiresContactRequest&&nextRequiresContactRequest)return{show:!0,hasMessages:hasMessages,user:newOtherUser};if(prevRequiresContactRequest&&!nextRequiresContactRequest)return{show:!1,hasMessages:hasMessages}}return!state.hasTriedToLoadMessages&&newState.hasTriedToLoadMessages&&nextRequiresContactRequest?{show:!0,hasMessages:hasMessages,user:newOtherUser}:state.hasTriedToLoadMessages&&!newState.hasTriedToLoadMessages&&prevRequiresContactRequest?{show:!1,hasMessages:hadMessages}:null},buildFooterPatchTypePrivate=function(state,newState){var loadingFirstMessages=buildLoadingFirstMessages(state,newState),inEditMode=buildInEditMode(state,newState),requireAddContact=buildRequireAddContact(state,newState),requireUnblock=function(state,newState){var oldOtherUser=getOtherUserFromState(state),newOtherUser=getOtherUserFromState(newState);return oldOtherUser||newOtherUser?oldOtherUser&&!newOtherUser?!oldOtherUser.isblocked&&null:!oldOtherUser&&newOtherUser?!!newOtherUser.isblocked||null:!(oldOtherUser.isblocked||!newOtherUser.isblocked)||!(oldOtherUser.isblocked&&!newOtherUser.isblocked)&&null:null}(state,newState),unableToMessage=function(state,newState){var oldOtherUser=getOtherUserFromState(state),newOtherUser=getOtherUserFromState(newState);return newState.type==Constants.CONVERSATION_TYPES.SELF?null:oldOtherUser||newOtherUser?oldOtherUser&&!newOtherUser?!oldOtherUser.canmessage||null:!oldOtherUser&&newOtherUser?!newOtherUser.canmessage||null:!(!oldOtherUser.canmessage&&newOtherUser.canmessage)&&(!(!oldOtherUser.canmessage||newOtherUser.canmessage)||null):null}(state,newState),showRequireAddContact=null!==requireAddContact?requireAddContact.show&&requireAddContact.hasMessages:null,otherUser=getOtherUserFromState(newState),generateReturnValue=function(checkValue,successReturn){if(checkValue)return successReturn;if(null!==checkValue&&!checkValue){if(!otherUser)return{type:"content"};if(otherUser.isblocked)return{type:"unblock"};if(newState.messages.length&&requiresContactRequest(newState.loggedInUserId,otherUser))return{type:"add-contact",user:otherUser};if(!otherUser.canmessage&&otherUser.requirescontact&&!otherUser.iscontact)return{type:"unable-to-message"}}return null};if(null===loadingFirstMessages&&null===inEditMode&&null===requireAddContact&&null===requireUnblock)return null;for(var checks=[[loadingFirstMessages,{type:"placeholder"}],[inEditMode,{type:"edit-mode"}],[unableToMessage,{type:"unable-to-message"}],[requireUnblock,{type:"unblock"}],[showRequireAddContact,{type:"add-contact",user:otherUser}]],i=0;i<checks.length;i++){var result=generateReturnValue(checks[i][0],checks[i][1]);if(null!==result)return result}return{type:"content"}},buildFooterPatchTypePublic=function(state,newState){var loadingFirstMessages=buildLoadingFirstMessages(state,newState),inEditMode=buildInEditMode(state,newState);return null===loadingFirstMessages&&null===inEditMode?null:loadingFirstMessages?{type:"placeholder"}:inEditMode?{type:"edit-mode"}:{type:"content"}},buildReset=function(state,newState){var oldType=state.type,newType=newState.type,oldConversationId=state.id,newConversationId=newState.id,oldMemberIds=Object.keys(state.members),newMemberIds=Object.keys(newState.members);oldMemberIds.sort(),newMemberIds.sort();var membersUnchanged=oldMemberIds.every((function(id,index){return id==newMemberIds[index]}));return oldType!=newType||(!(!oldConversationId||newConversationId)||(!(!oldConversationId||!newConversationId||oldConversationId==newConversationId)||(!(oldConversationId||newConversationId||membersUnchanged)||null)))},buildSelfConversationMessage=function(state,newState){return state.type!=newState.type?newState.type==Constants.CONVERSATION_TYPES.SELF:null},buildContactRequestSent=function(state,newState){var loggedInUserId=newState.loggedInUserId,oldOtherUser=getOtherUserFromState(state),newOtherUser=getOtherUserFromState(newState),oldSentRequests=oldOtherUser?oldOtherUser.contactrequests.filter((function(request){return request.userid==loggedInUserId})):[],newSentRequests=newOtherUser?newOtherUser.contactrequests.filter((function(request){return request.userid==loggedInUserId})):[],oldRequest=oldSentRequests.length>0,newRequest=newSentRequests.length>0,hadMessages=state.messages.length>0,hasMessages=state.messages.length>0;return oldRequest||!newRequest||newOtherUser.iscontact||hasMessages?!(oldOtherUser&&!oldOtherUser.iscontact&&newRequest&&newOtherUser.iscontact)&&(!(oldRequest&&!newRequest)&&(!(!hadMessages&&hasMessages)&&null)):newOtherUser.fullname};return{buildPatch:function(state,newState){var config={all:{reset:buildReset,conversation:buildConversationPatch,scrollToMessage:buildScrollToMessagePatch,loadingMembers:buildLoadingMembersPatch,loadingFirstMessages:buildLoadingFirstMessages,loadingMessages:buildLoadingMessages,confirmDeleteSelectedMessages:buildConfirmDeleteSelectedMessages,inEditMode:buildInEditMode,selectedMessages:buildSelectedMessages,isFavourite:buildIsFavourite,isMuted:buildIsMuted,showEmojiPicker:buildShowEmojiPicker,showEmojiAutoComplete:buildShowEmojiAutoComplete}};config[Constants.CONVERSATION_TYPES.PRIVATE]={header:buildHeaderPatchTypePrivate,footer:buildFooterPatchTypePrivate,confirmBlockUser:buildConfirmBlockUser,confirmUnblockUser:buildConfirmUnblockUser,confirmAddContact:buildConfirmAddContact,confirmRemoveContact:buildConfirmRemoveContact,confirmContactRequest:buildConfirmContactRequest,confirmDeleteConversation:buildConfirmDeleteConversation,isBlocked:buildIsBlocked,isContact:buildIsContact,loadingConfirmAction:buildLoadingConfirmationAction,requireAddContact:buildRequireAddContact,contactRequestSent:buildContactRequestSent},config[Constants.CONVERSATION_TYPES.PUBLIC]={header:buildHeaderPatchTypePublic,footer:buildFooterPatchTypePublic},config[Constants.CONVERSATION_TYPES.SELF]={header:buildHeaderPatchTypeSelf,footer:buildFooterPatchTypePublic,confirmDeleteConversation:buildConfirmDeleteConversation,selfConversationMessage:buildSelfConversationMessage};var patchConfig=$.extend({},config.all);return newState.type&&newState.type in config&&(patchConfig=$.extend(patchConfig,config[newState.type])),Object.keys(patchConfig).reduce((function(patch,key){var value=(0,patchConfig[key])(state,newState);return null!==value&&(patch[key]=value),patch}),{})}}}));
/**
 * Lazy loaded list of items.
 *
 * @module     core_message/message_drawer_lazy_load_list
 * @package    message
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_lazy_load_list",["jquery","core/custom_interaction_events"],(function($,CustomEvents){var SELECTORS_ROOT='[data-region="lazy-load-list"]',SELECTORS_LOADING_ICON_CONTAINER='[data-region="loading-icon-container"]',SELECTORS_CONTENT_CONTAINER='[data-region="content-container"]',SELECTORS_EMPTY_MESSAGE='[data-region="empty-message-container"]',SELECTORS_PLACEHOLDER='[data-region="placeholder-container"]',stopLoading=function(root){root.attr("data-loading",!1)},getContentContainer=function(root){return root.find(SELECTORS_CONTENT_CONTAINER)},hideLoadingIcon=function(root){root.find(SELECTORS_LOADING_ICON_CONTAINER).addClass("hidden")},showEmptyMessage=function(root){root.find(SELECTORS_EMPTY_MESSAGE).removeClass("hidden")},hidePlaceholder=function(root){root.find(SELECTORS_PLACEHOLDER).addClass("hidden")},showContent=function(root){getContentContainer(root).removeClass("hidden")},hideContent=function(root){getContentContainer(root).addClass("hidden")},setLoadedAll=function(root,value){root.attr("data-loaded-all",value)},loadAndRender=function(root,loadCallback,renderCallback){var userId=function(root){return root.attr("data-user-id")}(root);return function(root){root.attr("data-loading",!0)}(root),loadCallback(root,userId).then((function(items){if(items.length>0){var contentContainer=getContentContainer(root);return renderCallback(contentContainer,items,userId).then((function(){return items}))}return items})).then((function(items){return stopLoading(root),root.attr("data-seen",!0),items.length||setLoadedAll(root,!0),items})).catch((function(){stopLoading(root),root.attr("data-seen",!0)}))},initialLoadAndRender=function(root,loadCallback,renderCallback){return getContentContainer(root).empty(),function(root){root.find(SELECTORS_PLACEHOLDER).removeClass("hidden")}(root),hideContent(root),loadAndRender(root,loadCallback,renderCallback).then((function(items){hidePlaceholder(root),items.length?showContent(root):showEmptyMessage(root)})).catch((function(){hidePlaceholder(root),showContent(root)}))},registerEventListeners=function(root,loadCallback,renderCallback){CustomEvents.define(root,[CustomEvents.events.scrollBottom]),root.on(CustomEvents.events.scrollBottom,(function(){(function(root){return!function(root){return"true"==root.attr("data-loaded-all")}(root)&&!function(root){return"true"===root.attr("data-loading")}(root)})(root)&&(!function(root){root.find(SELECTORS_LOADING_ICON_CONTAINER).removeClass("hidden")}(root),loadAndRender(root,loadCallback,renderCallback).then((function(){return hideLoadingIcon(root)})).catch((function(){return hideLoadingIcon(root)})))}))};return{show:function(root,loadCallback,renderCallback){(root=$(root)).attr("data-init")||(registerEventListeners(root,loadCallback,renderCallback),initialLoadAndRender(root,loadCallback,renderCallback),root.attr("data-init",!0))},getContentContainer:getContentContainer,getRoot:function(containerElement){return containerElement.find(SELECTORS_ROOT)},setLoadedAll:setLoadedAll,showEmptyMessage:showEmptyMessage,hideEmptyMessage:function(root){root.find(SELECTORS_EMPTY_MESSAGE).addClass("hidden")},showContent:showContent,hideContent:hideContent}}));
/**
 * Controls the preference for an individual notification type on the
 * message preference page.
 *
 * @module     core_message/message_notification_preference
 * @class      message_notification_preference
 * @package    message
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_notification_preference",["jquery","core_message/notification_preference"],(function($,NotificationPreference){var SELECTORS_PREFERENCE_KEY="[data-preference-key]",MessageNotificationPreference=function(element,userId){NotificationPreference.call(this,element,userId)};return(MessageNotificationPreference.prototype=Object.create(NotificationPreference.prototype)).constructor=MessageNotificationPreference,MessageNotificationPreference.prototype.getPreferenceKey=function(){return this.root.find(SELECTORS_PREFERENCE_KEY).attr("data-preference-key")},MessageNotificationPreference}));
/**
 * Controls the contacts section of the contacts page.
 *
 * @module     core_message/message_drawer_view_contacts_section_contacts
 * @package    message
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_view_contacts_section_contacts",["jquery","core/notification","core/pubsub","core/templates","core_message/message_repository","core_message/message_drawer_events","core_message/message_drawer_lazy_load_list"],(function($,Notification,PubSub,Templates,MessageRepository,Events,LazyLoadList){var SELECTORS_BLOCK_ICON_CONTAINER='[data-region="block-icon-container"]',SELECTORS_CONTACT='[data-region="contact"]',TEMPLATES_CONTACTS_LIST="core_message/message_drawer_contacts_list",findContact=function(body,userId){return body.find('[data-contact-user-id="'+userId+'"]')},render=function(contentContainer,contacts){var formattedContacts=contacts.map((function(contact){return $.extend(contact,{id:contact.userid})}));return Templates.render(TEMPLATES_CONTACTS_LIST,{contacts:formattedContacts}).then((function(html){return contentContainer.append(html),html})).catch(Notification.exception)},registerEventListeners=function(root){PubSub.subscribe(Events.CONTACT_ADDED,(function(profile){var listContentContainer=LazyLoadList.getContentContainer(root);render(listContentContainer,[profile]),LazyLoadList.hideEmptyMessage(root),LazyLoadList.showContent(root)})),PubSub.subscribe(Events.CONTACT_REMOVED,(function(userId){!function(body,userId){findContact(body,userId).remove()}(root,userId),root.find(SELECTORS_CONTACT).length||(LazyLoadList.hideContent(root),LazyLoadList.showEmptyMessage(root))})),PubSub.subscribe(Events.CONTACT_BLOCKED,(function(userId){!function(body,userId){var contact=findContact(body,userId);contact.length&&contact.find(SELECTORS_BLOCK_ICON_CONTAINER).removeClass("hidden")}(root,userId)})),PubSub.subscribe(Events.CONTACT_UNBLOCKED,(function(userId){!function(body,userId){var contact=findContact(body,userId);contact.length&&contact.find(SELECTORS_BLOCK_ICON_CONTAINER).addClass("hidden")}(root,userId)}))};return{show:function(root){var offset;root.attr("data-contacts-init")||(registerEventListeners(root),root.attr("data-contacts-init",!0)),LazyLoadList.show(root,(offset=0,function(listRoot,userId){return MessageRepository.getContacts(userId,101,offset).then((function(result){return result})).then((function(contacts){return contacts.length>100?contacts.pop():LazyLoadList.setLoadedAll(listRoot,!0),contacts})).then((function(contacts){return offset+=100,contacts})).catch(Notification.exception)}),render)}}}));
/**
 * This module operates on the view states from the message_drawer_view_conversation module.
 * It exposes functions that can be used to generate new version of the state.
 *
 * Important notes for this module:
 * 1.) The existing state is always immutable. It should never be modified.
 * 2.) All functions that operate on the state should always clone the state and
 *     modify the cloned state before returning it.
 *
 * It's important that the states remain immutable because they are diff'd in
 * the message_drawer_view_conversation_patcher module in order to work out what
 * has changed.
 *
 * @module     core_message/message_drawer_view_conversation_state_manager
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_message/message_drawer_view_conversation_state_manager",["jquery"],(function($){var cloneState=function(state){return $.extend(!0,{},state)},formatMessages=function(messages,loggedInUserId,members){return messages.map((function(message){var fromLoggedInUser=message.useridfrom==loggedInUserId;return{id:""+message.id,fromLoggedInUser:fromLoggedInUser,userFrom:members[message.useridfrom],text:message.text,timeCreated:message.timecreated?parseInt(message.timecreated,10):null}}))};return{buildInitialState:function(midnight,loggedInUserId,id,messagePollMin,messagePollMax,messagePollAfterMax){return{midnight:midnight,loggedInUserId:loggedInUserId,id:id,messagePollMin:messagePollMin,messagePollMax:messagePollMax,messagePollAfterMax:messagePollAfterMax,name:null,subname:null,type:null,totalMemberCount:null,imageUrl:null,isFavourite:null,isMuted:null,canDeleteMessagesForAllUsers:!1,deleteMessagesForAllUsers:!1,members:{},messages:[],hasTriedToLoadMessages:!1,loadingMessages:!0,loadingMembers:!0,loadingConfirmAction:!1,pendingBlockUserIds:[],pendingUnblockUserIds:[],pendingRemoveContactIds:[],pendingAddContactIds:[],pendingDeleteMessageIds:[],pendingSendMessageIds:[],pendingDeleteConversation:!1,selectedMessageIds:[],showEmojiAutoComplete:!1,showEmojiPicker:!1}},addMessages:function(state,messages){var newState=cloneState(state),formattedMessages=formatMessages(messages,state.loggedInUserId,state.members);formattedMessages=formattedMessages.map((function(message){return message.sendState=null,message.timeAdded=Date.now(),message.errorMessage=null,message}));var allMessages=state.messages.concat(formattedMessages);return allMessages.sort((function(a,b){if(null===a.timeCreated&&null===b.timeCreated){if(a.timeAdded<b.timeAdded)return-1;if(a.timeAdded>b.timeAdded)return 1}return null===a.timeCreated&&null!==b.timeCreated?1:null!==a.timeCreated&&null===b.timeCreated||a.timeCreated<b.timeCreated?-1:a.timeCreated>b.timeCreated?1:a.id<b.id?-1:a.id>b.id?1:0})),newState.messages=allMessages.filter((function(message,index,sortedMessages){return!index||message.id!=sortedMessages[index-1].id})),newState},updateMessages:function(state,data){var newState=cloneState(state),updatesById=data.reduce((function(carry,messageData){var oldMessage=messageData[0],newMessage=messageData[1],formattedMessage=formatMessages([newMessage],state.loggedInUserId,state.members)[0];return carry[oldMessage.id]=formattedMessage,carry}),{});return newState.messages=newState.messages.map((function(message){return message.id in updatesById?$.extend(message,updatesById[message.id]):message})),newState},removeMessages:function(state,messages){var newState=cloneState(state),removeMessageIds=messages.map((function(message){return""+message.id}));return newState.messages=newState.messages.filter((function(message){return removeMessageIds.indexOf(message.id)<0})),newState},removeMessagesById:function(state,messageIds){var newState=cloneState(state);return messageIds=messageIds.map((function(id){return""+id})),newState.messages=newState.messages.filter((function(message){return messageIds.indexOf(message.id)<0})),newState},addMembers:function(state,members){var newState=cloneState(state),formattedMembers=function(members){return members.map((function(member){return{id:member.id,fullname:member.fullname,profileurl:member.profileurl,profileimageurl:member.profileimageurl,profileimageurlsmall:member.profileimageurlsmall,isonline:member.isonline,showonlinestatus:member.showonlinestatus,isblocked:member.isblocked,iscontact:member.iscontact,isdeleted:member.isdeleted,canmessage:member.canmessage,canmessageevenifblocked:member.canmessageevenifblocked,requirescontact:member.requirescontact,contactrequests:member.contactrequests||[]}}))}(members);return formattedMembers.forEach((function(member){newState.members[member.id]=member})),newState},removeMembers:function(state,members){var newState=cloneState(state);return members.forEach((function(member){delete newState.members[member.id]})),newState},setLoadingMessages:function(state,value){var newState=cloneState(state);return newState.loadingMessages=value,state.loadingMessages&&!value&&(newState.hasTriedToLoadMessages=!0),newState},setLoadingMembers:function(state,value){var newState=cloneState(state);return newState.loadingMembers=value,newState},setId:function(state,value){var newState=cloneState(state);return newState.id=value,newState},setName:function(state,value){var newState=cloneState(state);return newState.name=value,newState},setSubname:function(state,value){var newState=cloneState(state);return newState.subname=value,newState},setType:function(state,type){var newState=cloneState(state);return newState.type=type,newState},setIsFavourite:function(state,isFavourite){var newState=cloneState(state);return newState.isFavourite=isFavourite,newState},setIsMuted:function(state,isMuted){var newState=cloneState(state);return newState.isMuted=isMuted,newState},setCanDeleteMessagesForAllUsers:function(state,value){var newState=cloneState(state);return newState.canDeleteMessagesForAllUsers=value,newState},setDeleteMessagesForAllUsers:function(state,value){var newState=cloneState(state);return newState.deleteMessagesForAllUsers=value,newState},setTotalMemberCount:function(state,count){var newState=cloneState(state);return newState.totalMemberCount=count,newState},setImageUrl:function(state,url){var newState=cloneState(state);return newState.imageUrl=url,newState},setLoadingConfirmAction:function(state,value){var newState=cloneState(state);return newState.loadingConfirmAction=value,newState},setPendingDeleteConversation:function(state,value){var newState=cloneState(state);return newState.pendingDeleteConversation=value,newState},setMessagesSendPendingById:function(state,messageIds){var newState=cloneState(state);return messageIds=messageIds.map((function(id){return""+id})),newState.messages.forEach((function(message){messageIds.indexOf(message.id)>=0&&(message.sendState="pending",message.errorMessage=null)})),newState},setMessagesSendSuccessById:function(state,messageIds){var newState=cloneState(state);return messageIds=messageIds.map((function(id){return""+id})),newState.messages.forEach((function(message){messageIds.indexOf(message.id)>=0&&(message.sendState="sent",message.errorMessage=null)})),newState},setMessagesSendFailById:function(state,messageIds,errorMessage){var newState=cloneState(state);return messageIds=messageIds.map((function(id){return""+id})),newState.messages.forEach((function(message){messageIds.indexOf(message.id)>=0&&(message.sendState="error",message.errorMessage=errorMessage)})),newState},setShowEmojiAutoComplete:function(state,show){var newState=cloneState(state);return newState.showEmojiAutoComplete=show,newState},setShowEmojiPicker:function(state,show){var newState=cloneState(state);return newState.showEmojiPicker=show,newState},addPendingBlockUsersById:function(state,userIds){var newState=cloneState(state);return userIds.forEach((function(id){newState.pendingBlockUserIds.push(id)})),newState},addPendingRemoveContactsById:function(state,userIds){var newState=cloneState(state);return userIds.forEach((function(id){newState.pendingRemoveContactIds.push(id)})),newState},addPendingUnblockUsersById:function(state,userIds){var newState=cloneState(state);return userIds.forEach((function(id){newState.pendingUnblockUserIds.push(id)})),newState},addPendingAddContactsById:function(state,userIds){var newState=cloneState(state);return userIds.forEach((function(id){newState.pendingAddContactIds.push(id)})),newState},addPendingDeleteMessagesById:function(state,messageIds){var newState=cloneState(state);return messageIds.forEach((function(id){newState.pendingDeleteMessageIds.push(id)})),newState},removePendingBlockUsersById:function(state,userIds){var newState=cloneState(state);return newState.pendingBlockUserIds=newState.pendingBlockUserIds.filter((function(id){return userIds.indexOf(id)<0})),newState},removePendingRemoveContactsById:function(state,userIds){var newState=cloneState(state);return newState.pendingRemoveContactIds=newState.pendingRemoveContactIds.filter((function(id){return userIds.indexOf(id)<0})),newState},removePendingUnblockUsersById:function(state,userIds){var newState=cloneState(state);return newState.pendingUnblockUserIds=newState.pendingUnblockUserIds.filter((function(id){return userIds.indexOf(id)<0})),newState},removePendingAddContactsById:function(state,userIds){var newState=cloneState(state);return newState.pendingAddContactIds=newState.pendingAddContactIds.filter((function(id){return userIds.indexOf(id)<0})),newState},removePendingDeleteMessagesById:function(state,messageIds){var newState=cloneState(state);return messageIds=messageIds.map((function(id){return""+id})),newState.pendingDeleteMessageIds=newState.pendingDeleteMessageIds.filter((function(id){return messageIds.indexOf(id)<0})),newState},addSelectedMessagesById:function(state,messageIds){var newState=cloneState(state);return messageIds=messageIds.map((function(id){return""+id})),newState.selectedMessageIds=newState.selectedMessageIds.concat(messageIds),newState},removeSelectedMessagesById:function(state,messageIds){var newState=cloneState(state);return messageIds=messageIds.map((function(id){return""+id})),newState.selectedMessageIds=newState.selectedMessageIds.filter((function(id){return messageIds.indexOf(id)<0})),newState},markMessagesAsRead:function(state,readMessages){var newState=cloneState(state),readMessageIds=readMessages.map((function(message){return message.id}));return newState.messages=newState.messages.map((function(message){return readMessageIds.indexOf(message.id)>=0&&(message.isRead=!0),message})),newState},addContactRequests:function(state,requests){var newState=cloneState(state);return requests.forEach((function(request){var fromUserId=request.userid,toUserId=request.requesteduserid;newState.members[fromUserId].contactrequests.push(request),newState.members[toUserId].contactrequests.push(request)})),newState},removeContactRequests:function(state,requests){var newState=cloneState(state);return requests.forEach((function(request){var fromUserId=request.userid,toUserId=request.requesteduserid;newState.members[fromUserId].contactrequests=newState.members[fromUserId].contactrequests.filter((function(existing){return existing.userid!=fromUserId})),newState.members[toUserId].contactrequests=newState.members[toUserId].contactrequests.filter((function(existing){return existing.requesteduserid!=toUserId}))})),newState}}}));
/**
 * A javascript module to handle question tags editing.
 *
 * @module     core_question/edit_tags
 * @copyright  2018 Simey Lameze <simey@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_question/edit_tags",["jquery","core/fragment","core/str","core/modal_events","core/modal_factory","core/notification","core/custom_interaction_events","core_question/repository","core_question/selectors"],(function($,Fragment,Str,ModalEvents,ModalFactory,Notification,CustomEvents,Repository,QuestionSelectors){var enableSaveButton=function(root){root.find(QuestionSelectors.actions.save).prop("disabled",!1)},disableSaveButton=function(root){root.find(QuestionSelectors.actions.save).prop("disabled",!0)},startLoading=function(root){root.find(QuestionSelectors.containers.loadingIcon).removeClass("hidden")},stopLoading=function(root){root.find(QuestionSelectors.containers.loadingIcon).addClass("hidden")},save=function(modal,root){disableSaveButton(root),startLoading(root);var formData=function(modal){return modal.getBody().find("form").serialize()}(modal),questionId=function(modal){return modal.getBody().data("questionid")}(modal),contextId=function(modal){return modal.getBody().data("contextid")}(modal);return Repository.submitTagCreateUpdateForm(questionId,contextId,formData).always((function(){stopLoading(root),enableSaveButton(root)})).fail(Notification.exception)};return{init:function(root){!function(root){var modalPromise=ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,large:!1},[root,QuestionSelectors.actions.edittags]).then((function(modal){return Str.get_string("questiontags","question").then((function(string){return modal.setTitle(string),string})).fail(Notification.exception),modal.getRoot().on(ModalEvents.save,(function(e){modal.getBody().find("form").submit(),e.preventDefault()})),modal.getRoot().on("submit","form",(function(e){save(modal,root).then((function(){modal.hide(),location.reload()})).fail(Notification.exception),e.preventDefault(),e.stopPropagation()})),modal}));root.on(CustomEvents.events.activate,QuestionSelectors.actions.edittags,(function(e){var currentTarget=$(e.currentTarget),questionId=currentTarget.data("questionid"),canTag=!!currentTarget.data("cantag"),contextId=currentTarget.data("contextid");modalPromise.then((function(modal){disableSaveButton(root),startLoading(root);var args={id:questionId},tagsFragment=Fragment.loadFragment("question","tags_form",contextId,args);return modal.setBody(tagsFragment),tagsFragment.then((function(){enableSaveButton(root)})).always((function(){stopLoading(root)})).fail(Notification.exception),canTag?modal.getRoot().find(QuestionSelectors.actions.save).show():modal.getRoot().find(QuestionSelectors.actions.save).hide(),function(modal,questionId){modal.getBody().attr("data-questionid",questionId)}(modal,questionId),function(modal,contextId){modal.getBody().attr("data-contextid",contextId)}(modal,contextId),modal})).fail(Notification.exception),e.preventDefault()}))}(root=$(root))}}}));
/**
 * The purpose of this module is to centralize selectors related to question.
 *
 * @module     core_question/question_selectors
 * @package    core_question
 * @copyright  2018 Simey Lameze <lameze@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_question/selectors",[],(function(){return{actions:{save:'[data-action="save"]',edittags:'[data-action="edittags"]'},containers:{loadingIcon:'[data-region="overlay-icon-container"]'}}}));
/**
 * A javascript module to handle question ajax actions.
 *
 * @module     core_question/repository
 * @class      repository
 * @package    core_question
 * @copyright  2017 Simey Lameze <lameze@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_question/repository",["jquery","core/ajax"],(function($,Ajax){return{submitTagCreateUpdateForm:function(questionId,contextId,formdata){var request={methodname:"core_question_submit_tags_form",args:{questionid:questionId,contextid:contextId,formdata:formdata}};return Ajax.call([request])[0]}}}));
/**
 * Search user selector module.
 *
 * @module core_search/form-search-user-selector
 * @class form-search-user-selector
 * @package core_search
 * @copyright 2017 The Open University
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_search/form-search-user-selector",["jquery","core/ajax","core/templates"],(function($,Ajax,Templates){return{processResults:function(selector,results){var users=[];return $.each(results,(function(index,user){users.push({value:user.id,label:user._label})})),users},transport:function(selector,query,success,failure){var args={query:query},courseid=$(selector).attr("withincourseid");void 0!==courseid&&""!==$("#id_searchwithin").val()?args.courseid=courseid:args.courseid=0,Ajax.call([{methodname:"core_search_get_relevant_users",args:args}])[0].then((function(results){var promises=[];return $.each(results,(function(index,user){promises.push(Templates.render("core_search/form-user-selector-suggestion",user))})),$.when.apply($.when,promises).then((function(){var args=arguments,i=0;$.each(results,(function(index,user){user._label=args[i++]})),success(results)}))})).fail(failure)}}}));
define("core_table/local/dynamic/events",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;
/**
   * Dynamic table selectors.
   *
   * @module     core_table/local/dynamic/events
   * @package    core_table
   * @copyright  2020 Andrew Nicols <andrew@nicols.co.uk>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
var eventName,_default={tableContentRefreshed:(eventName="tableContentRefreshed","core_table/dynamic:".concat(eventName))};return _exports.default=_default,_exports.default}));
define("core_table/local/dynamic/selectors",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;return _exports.default={main:{region:'[data-region="core_table/dynamic"]',fromRegionId:function(regionId){return'[data-region="core_table/dynamic"][data-table-uniqueid="'.concat(regionId,'"]')}},table:{links:{sortableColumn:'a[data-sortable="1"]',hide:'a[data-action="hide"]',show:'a[data-action="show"]'}},initialsBar:{links:{firstInitial:".firstinitial [data-initial]",lastInitial:".lastinitial [data-initial]"}},paginationBar:{links:{pageItem:".pagination [data-page-number]"}}},_exports.default}));
define("core_table/local/dynamic/repository",["exports","core/ajax"],(function(_exports,_ajax){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.fetch=void 0;_exports.fetch=function(component,handler,uniqueid){var _ref=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},_ref$sortData=_ref.sortData,sortData=void 0===_ref$sortData?[]:_ref$sortData,_ref$joinType=_ref.joinType,joinType=void 0===_ref$joinType?null:_ref$joinType,_ref$filters=_ref.filters,filters=void 0===_ref$filters?{}:_ref$filters,_ref$firstinitial=_ref.firstinitial,firstinitial=void 0===_ref$firstinitial?null:_ref$firstinitial,_ref$lastinitial=_ref.lastinitial,lastinitial=void 0===_ref$lastinitial?null:_ref$lastinitial,_ref$pageNumber=_ref.pageNumber,pageNumber=void 0===_ref$pageNumber?null:_ref$pageNumber,_ref$pageSize=_ref.pageSize,pageSize=void 0===_ref$pageSize?null:_ref$pageSize,_ref$hiddenColumns=_ref.hiddenColumns,hiddenColumns=void 0===_ref$hiddenColumns?{}:_ref$hiddenColumns,resetPreferences=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return(0,_ajax.call)([{methodname:"core_table_get_dynamic_table_content",args:{component:component,handler:handler,uniqueid:uniqueid,sortdata:sortData,jointype:joinType,filters:filters,firstinitial:firstinitial,lastinitial:lastinitial,pagenumber:pageNumber,pagesize:pageSize,hiddencolumns:hiddenColumns,resetpreferences:resetPreferences}}])[0]}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core_table/dynamic",["exports","core_table/local/dynamic/selectors","./local/dynamic/events","core/pending","core/loadingicon","core_table/local/dynamic/repository","core/notification"],(function(_exports,Selectors,_events,_pending,_loadingicon,_repository,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}Object.defineProperty(_exports,"__esModule",{value:!0}),Object.defineProperty(_exports,"Events",{enumerable:!0,get:function(){return _events.default}}),_exports.updateTable=_exports.showColumn=_exports.setSortOrder=_exports.setPageSize=_exports.setPageNumber=_exports.setLastInitial=_exports.setFirstInitial=_exports.setFilters=_exports.refreshTableContent=_exports.init=_exports.hideColumn=_exports.getTableFromId=_exports.getPageSize=_exports.getPageNumber=_exports.getLastInitial=_exports.getFirstInitial=_exports.getFilters=void 0,Selectors=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Selectors),_events=_interopRequireDefault(_events),_pending=_interopRequireDefault(_pending),_notification=_interopRequireDefault(_notification);var watching=!1,checkTableIsDynamic=function(tableRoot){if(!tableRoot)throw new Error("The table specified is not a dynamic table and cannot be updated");if(!tableRoot.matches(Selectors.main.region))throw new Error("The table specified is not a dynamic table and cannot be updated");return!0},getFiltersetFromTable=function(tableRoot){return JSON.parse(tableRoot.dataset.tableFilters)},refreshTableContent=function(tableRoot){var resetContent=arguments.length>1&&void 0!==arguments[1]&&arguments[1],filterset=getFiltersetFromTable(tableRoot);(0,_loadingicon.addIconToContainer)(tableRoot);var pendingPromise=new _pending.default("core_table/dynamic:refreshTableContent");return(0,_repository.fetch)(tableRoot.dataset.tableComponent,tableRoot.dataset.tableHandler,tableRoot.dataset.tableUniqueid,{sortData:JSON.parse(tableRoot.dataset.tableSortData),joinType:filterset.jointype,filters:filterset.filters,firstinitial:tableRoot.dataset.tableFirstInitial,lastinitial:tableRoot.dataset.tableLastInitial,pageNumber:tableRoot.dataset.tablePageNumber,pageSize:tableRoot.dataset.tablePageSize,hiddenColumns:JSON.parse(tableRoot.dataset.tableHiddenColumns)},resetContent).then((function(data){var placeholder=document.createElement("div");return placeholder.innerHTML=data.html,tableRoot.replaceWith.apply(tableRoot,_toConsumableArray(placeholder.childNodes)),getTableFromId(tableRoot.dataset.tableUniqueid)})).then((function(tableRoot){return tableRoot.dispatchEvent(new CustomEvent(_events.default.tableContentRefreshed,{bubbles:!0})),tableRoot})).then((function(tableRoot){return pendingPromise.resolve(),tableRoot}))};_exports.refreshTableContent=refreshTableContent;var updateTable=function(tableRoot){var _ref=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},_ref$sortBy=_ref.sortBy,sortBy=void 0===_ref$sortBy?null:_ref$sortBy,_ref$sortOrder=_ref.sortOrder,sortOrder=void 0===_ref$sortOrder?null:_ref$sortOrder,_ref$filters=_ref.filters,filters=void 0===_ref$filters?null:_ref$filters,_ref$firstInitial=_ref.firstInitial,firstInitial=void 0===_ref$firstInitial?null:_ref$firstInitial,_ref$lastInitial=_ref.lastInitial,lastInitial=void 0===_ref$lastInitial?null:_ref$lastInitial,_ref$pageNumber=_ref.pageNumber,pageNumber=void 0===_ref$pageNumber?null:_ref$pageNumber,_ref$pageSize=_ref.pageSize,pageSize=void 0===_ref$pageSize?null:_ref$pageSize,_ref$hiddenColumns=_ref.hiddenColumns,hiddenColumns=void 0===_ref$hiddenColumns?null:_ref$hiddenColumns,refreshContent=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];checkTableIsDynamic(tableRoot);var pendingPromise=new _pending.default("core_table/dynamic:updateTable"),tableConfigChanged=!1;if(sortBy&&sortOrder){tableConfigChanged=!0;var sortData=JSON.parse(tableRoot.dataset.tableSortData);sortData.unshift({sortby:sortBy,sortorder:parseInt(sortOrder,10)}),tableRoot.dataset.tableSortData=JSON.stringify(sortData)}if(null!==firstInitial&&(tableRoot.dataset.tableFirstInitial!==firstInitial&&(tableConfigChanged=!0),tableRoot.dataset.tableFirstInitial=firstInitial),null!==lastInitial&&(tableRoot.dataset.tableLastInitial!==lastInitial&&(tableConfigChanged=!0),tableRoot.dataset.tableLastInitial=lastInitial),null!==pageSize&&(tableRoot.dataset.tablePageSize!=pageSize&&(tableConfigChanged=!0),tableRoot.dataset.tablePageSize=pageSize),filters){var filterJson=JSON.stringify(filters);tableRoot.dataset.tableFilters!==filterJson&&(tableConfigChanged=!0),tableRoot.dataset.tableFilters=filterJson}if(tableConfigChanged&&(pageNumber=1),hiddenColumns){var columnJson=JSON.stringify(hiddenColumns);tableRoot.dataset.tableHiddenColumns!==columnJson&&(tableConfigChanged=!0),tableRoot.dataset.tableHiddenColumns=columnJson}return null!==pageNumber&&(tableRoot.dataset.tablePageNumber!=pageNumber&&(tableConfigChanged=!0),tableRoot.dataset.tablePageNumber=pageNumber),refreshContent&&tableConfigChanged?refreshTableContent(tableRoot).then((function(tableRoot){return pendingPromise.resolve(),tableRoot})):(pendingPromise.resolve(),Promise.resolve(tableRoot))};_exports.updateTable=updateTable;var getTableData=function(tableRoot){return checkTableIsDynamic(tableRoot),tableRoot.dataset};_exports.setFilters=function(tableRoot,filters){var refreshContent=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return updateTable(tableRoot,{filters:filters},refreshContent)};_exports.getFilters=function(tableRoot){return checkTableIsDynamic(tableRoot),getFiltersetFromTable(tableRoot)};var setSortOrder=function(tableRoot,sortBy,sortOrder){var refreshContent=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return updateTable(tableRoot,{sortBy:sortBy,sortOrder:sortOrder},refreshContent)};_exports.setSortOrder=setSortOrder;var setPageNumber=function(tableRoot,pageNumber){var refreshContent=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return updateTable(tableRoot,{pageNumber:pageNumber},refreshContent)};_exports.setPageNumber=setPageNumber;_exports.getPageNumber=function(tableRoot){return getTableData(tableRoot).tablePageNumber};_exports.setPageSize=function(tableRoot,pageSize){var refreshContent=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return updateTable(tableRoot,{pageSize:pageSize,pageNumber:1},refreshContent)};_exports.getPageSize=function(tableRoot){return getTableData(tableRoot).tablePageSize};var setFirstInitial=function(tableRoot,firstInitial){var refreshContent=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return updateTable(tableRoot,{firstInitial:firstInitial},refreshContent)};_exports.setFirstInitial=setFirstInitial;_exports.getFirstInitial=function(tableRoot){return getTableData(tableRoot).tableFirstInitial};var setLastInitial=function(tableRoot,lastInitial){var refreshContent=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return updateTable(tableRoot,{lastInitial:lastInitial},refreshContent)};_exports.setLastInitial=setLastInitial;_exports.getLastInitial=function(tableRoot){return getTableData(tableRoot).tableLastInitial};var hideColumn=function(tableRoot,columnToHide){var refreshContent=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],hiddenColumns=JSON.parse(tableRoot.dataset.tableHiddenColumns);return hiddenColumns.push(columnToHide),updateTable(tableRoot,{hiddenColumns:hiddenColumns},refreshContent)};_exports.hideColumn=hideColumn;var showColumn=function(tableRoot,columnToShow){var refreshContent=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],hiddenColumns=JSON.parse(tableRoot.dataset.tableHiddenColumns);return hiddenColumns=hiddenColumns.filter((function(columnName){return columnName!==columnToShow})),updateTable(tableRoot,{hiddenColumns:hiddenColumns},refreshContent)};_exports.showColumn=showColumn;_exports.init=function(){watching||(watching=!0,document.addEventListener("click",(function(e){var tableRoot=e.target.closest(Selectors.main.region);if(tableRoot){var sortableLink=e.target.closest(Selectors.table.links.sortableColumn);sortableLink&&(e.preventDefault(),setSortOrder(tableRoot,sortableLink.dataset.sortby,sortableLink.dataset.sortorder).catch(_notification.default.exception));var firstInitialLink=e.target.closest(Selectors.initialsBar.links.firstInitial);null!==firstInitialLink&&(e.preventDefault(),setFirstInitial(tableRoot,firstInitialLink.dataset.initial).catch(_notification.default.exception));var lastInitialLink=e.target.closest(Selectors.initialsBar.links.lastInitial);null!==lastInitialLink&&(e.preventDefault(),setLastInitial(tableRoot,lastInitialLink.dataset.initial).catch(_notification.default.exception));var pageItem=e.target.closest(Selectors.paginationBar.links.pageItem);pageItem&&(e.preventDefault(),setPageNumber(tableRoot,pageItem.dataset.pageNumber).catch(_notification.default.exception));var hide=e.target.closest(Selectors.table.links.hide);hide&&(e.preventDefault(),hideColumn(tableRoot,hide.dataset.column).catch(_notification.default.exception));var show=e.target.closest(Selectors.table.links.show);show&&(e.preventDefault(),showColumn(tableRoot,show.dataset.column).catch(_notification.default.exception)),e.target.closest(".resettable a")&&(e.preventDefault(),function(tableRoot){return refreshTableContent(tableRoot,!0)}(tableRoot).catch(_notification.default.exception))}})))};var getTableFromId=function(tableRegionId){var tableRoot=document.querySelector(Selectors.main.fromRegionId(tableRegionId));if(!tableRoot)throw new Error("The table specified is not a dynamic table and cannot be updated");return tableRoot};_exports.getTableFromId=getTableFromId}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core_user/participants",["exports","core_table/dynamic","core/str","core/checkbox-toggleall","core/custom_interaction_events","core_table/local/dynamic/selectors","core/modal_events","core/notification","core/pending","jquery","core_user/local/participants/bulkactions"],(function(_exports,DynamicTable,Str,_checkboxToggleall,_custom_interaction_events,_selectors,_modal_events,_notification,_pending,_jquery,_bulkactions){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,DynamicTable=_interopRequireWildcard(DynamicTable),Str=_interopRequireWildcard(Str),_checkboxToggleall=_interopRequireDefault(_checkboxToggleall),_custom_interaction_events=_interopRequireDefault(_custom_interaction_events),_selectors=_interopRequireDefault(_selectors),_modal_events=_interopRequireDefault(_modal_events),_notification=_interopRequireDefault(_notification),_pending=_interopRequireDefault(_pending),_jquery=_interopRequireDefault(_jquery);var Selectors_bulkActionSelect="#formactionid",Selectors_bulkUserSelectedCheckBoxes="input[data-togglegroup='participants-table'][data-toggle='slave']:checked",Selectors_checkCountButton="#checkall",Selectors_showCountText='[data-region="participant-count"]',Selectors_showCountToggle='[data-action="showcount"]',Selectors_stateHelpIcon='[data-region="state-help-icon"]',Selectors_tableForm=function(uniqueId){return'form[data-table-unique-id="'.concat(uniqueId,'"]')};_exports.init=function(_ref){var uniqueid=_ref.uniqueid,_ref$noteStateNames=_ref.noteStateNames,noteStateNames=void 0===_ref$noteStateNames?{}:_ref$noteStateNames,root=document.querySelector(Selectors_tableForm(uniqueid)),getTableFromUniqueId=function(uniqueId){return root.querySelector(_selectors.default.main.fromRegionId(uniqueId))},resetBulkAction=function(bulkActionSelect){bulkActionSelect.value=""};_custom_interaction_events.default.define(Selectors_bulkActionSelect,[_custom_interaction_events.default.events.accessibleChange]),(0,_jquery.default)(Selectors_bulkActionSelect).on(_custom_interaction_events.default.events.accessibleChange,(function(e){var bulkActionSelect=e.target.closest("select"),action=bulkActionSelect.value,checkboxes=getTableFromUniqueId(uniqueid).querySelectorAll(Selectors_bulkUserSelectedCheckBoxes),pendingPromise=new _pending.default("core_user/participants:bulkActionSelect");if(-1!==action.indexOf("#")){e.preventDefault();var bulkAction,ids=[];if(checkboxes.forEach((function(checkbox){ids.push(checkbox.getAttribute("name").replace("user",""))})),"#messageselect"===action?bulkAction=(0,_bulkactions.showSendMessage)(ids):"#addgroupnote"===action&&(bulkAction=(0,_bulkactions.showAddNote)(root.dataset.courseId,ids,noteStateNames,root.querySelector(Selectors_stateHelpIcon))),bulkAction){var pendingBulkAction=new _pending.default("core_user/participants:bulkActionSelected");bulkAction.then((function(modal){return modal.getRoot().on(_modal_events.default.hidden,(function(){bulkActionSelect.focus()})),pendingBulkAction.resolve(),modal})).catch(_notification.default.exception)}}else""!==action&&checkboxes.length&&bulkActionSelect.form.submit();resetBulkAction(bulkActionSelect),pendingPromise.resolve()})),root.addEventListener("click",(function(e){var showCountLink=root.querySelector(Selectors_showCountToggle),checkCountButton=root.querySelector(Selectors_checkCountButton),showCountLinkClicked=showCountLink&&showCountLink.contains(e.target),checkCountButtonClicked=checkCountButton&&checkCountButton.contains(e.target);if(showCountLinkClicked||checkCountButtonClicked){e.preventDefault();var tableRoot=getTableFromUniqueId(uniqueid);DynamicTable.setPageSize(tableRoot,showCountLink.dataset.targetPageSize).then((function(tableRoot){return _checkboxToggleall.default.setGroupState(root,"participants-table",checkCountButtonClicked),tableRoot})).catch(_notification.default.exception)}})),root.addEventListener(DynamicTable.Events.tableContentRefreshed,(function(e){var showCountLink=root.querySelector(Selectors_showCountToggle),checkCountButton=root.querySelector(Selectors_checkCountButton),tableRoot=e.target,defaultPageSize=parseInt(root.dataset.tableDefaultPerPage,10),currentPageSize=parseInt(tableRoot.dataset.tablePageSize,10),totalRowCount=parseInt(tableRoot.dataset.tableTotalRows,10);_checkboxToggleall.default.updateSlavesFromMasterState(root,"participants-table");var pageCountStrings=[{key:"countparticipantsfound",component:"core_user",param:totalRowCount}];totalRowCount<=defaultPageSize?(showCountLink.classList.add("hidden"),checkCountButton&&checkCountButton.classList.add("hidden")):totalRowCount<=currentPageSize?(pageCountStrings.push({key:"showperpage",component:"core",param:defaultPageSize}),pageCountStrings.push({key:"selectalluserswithcount",component:"core",param:defaultPageSize}),showCountLink.classList.remove("hidden"),showCountLink.dataset.targetPageSize=defaultPageSize,checkCountButton&&checkCountButton.classList.add("hidden")):(pageCountStrings.push({key:"showall",component:"core",param:totalRowCount}),pageCountStrings.push({key:"selectalluserswithcount",component:"core",param:totalRowCount}),showCountLink.classList.remove("hidden"),showCountLink.dataset.targetPageSize=totalRowCount,checkCountButton&&checkCountButton.classList.remove("hidden")),Str.get_strings(pageCountStrings).then((function(_ref2){var _ref3=_slicedToArray(_ref2,3),showingParticipantCountString=_ref3[0],showCountString=_ref3[1],selectCountString=_ref3[2];root.querySelector(Selectors_showCountText).innerHTML=showingParticipantCountString,showCountString&&(showCountLink.innerHTML=showCountString),selectCountString&&checkCountButton&&(checkCountButton.value=selectCountString)})).catch(_notification.default.exception)}))}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core_user/status_field",["exports","core_table/dynamic","./repository","core/str","core_table/local/dynamic/selectors","core/fragment","core/modal_events","core/modal_factory","core/notification","core/templates","core/toast"],(function(_exports,DynamicTable,Repository,Str,_selectors,_fragment,_modal_events,_modal_factory,_notification,_templates,_toast){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,DynamicTable=_interopRequireWildcard(DynamicTable),Repository=_interopRequireWildcard(Repository),Str=_interopRequireWildcard(Str),_selectors=_interopRequireDefault(_selectors),_fragment=_interopRequireDefault(_fragment),_modal_events=_interopRequireDefault(_modal_events),_modal_factory=_interopRequireDefault(_modal_factory),_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates);var Selectors_editEnrolment='[data-action="editenrolment"]',Selectors_showDetails='[data-action="showdetails"]',Selectors_unenrol='[data-action="unenrol"]',Selectors_statusElement="[data-status]",getDynamicTableFromLink=function(link){return link.closest(_selectors.default.main.region)},getStatusContainer=function(link){return link.closest(Selectors_statusElement)},getUserEnrolmentIdFromLink=function(link){return link.getAttribute("rel")},showEditDialogue=function(link,getBody){var container=getStatusContainer(link),userEnrolmentId=getUserEnrolmentIdFromLink(link);_modal_factory.default.create({large:!0,title:Str.get_string("edituserenrolment","enrol",container.dataset.fullname),type:_modal_factory.default.types.SAVE_CANCEL,body:getBody(userEnrolmentId)}).then((function(modal){return modal.getRoot().on(_modal_events.default.save,(function(e){e.preventDefault(),submitEditFormAjax(link,getBody,modal,userEnrolmentId,container.dataset)})),modal.getRoot().on(_modal_events.default.hidden,(function(){modal.destroy()})),modal.show(),modal})).catch(_notification.default.exception)},showUnenrolConfirmation=function(link){var container=getStatusContainer(link),userEnrolmentId=getUserEnrolmentIdFromLink(link);_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL}).then((function(modal){modal.getRoot().on(_modal_events.default.save,(function(e){e.preventDefault(),submitUnenrolFormAjax(link,modal,{ueid:userEnrolmentId},container.dataset)})),modal.getRoot().on(_modal_events.default.hidden,(function(){modal.destroy()})),modal.show();var stringData=[{key:"unenrol",component:"enrol"},{key:"unenrolconfirm",component:"enrol",param:{user:container.dataset.fullname,course:container.dataset.coursename,enrolinstancename:container.dataset.enrolinstancename}}];return Promise.all([Str.get_strings(stringData),modal])})).then((function(_ref){var _ref2=_slicedToArray(_ref,2),strings=_ref2[0],modal=_ref2[1];return modal.setTitle(strings[0]),modal.setSaveButtonText(strings[0]),modal.setBody(strings[1]),modal})).catch(_notification.default.exception)},showStatusDetails=function(link){var container=getStatusContainer(link),context=function(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}({editenrollink:"",statusclass:container.querySelector("span.badge").getAttribute("class")},container.dataset),editEnrolLink=container.querySelector(Selectors_editEnrolment);editEnrolLink&&(context.editenrollink=editEnrolLink.outerHTML),_modal_factory.default.create({large:!0,type:_modal_factory.default.types.CANCEL,title:Str.get_string("enroldetails","enrol"),body:_templates.default.render("core_user/status_details",context)}).then((function(modal){return editEnrolLink&&modal.getRoot().on("click",Selectors_editEnrolment,(function(e){e.preventDefault(),modal.hide(),editEnrolLink.click()})),modal.show(),modal.getRoot().on(_modal_events.default.hidden,(function(){return modal.destroy()})),modal})).catch(_notification.default.exception)},submitEditFormAjax=function(clickedLink,getBody,modal,userEnrolmentId,userData){var form=modal.getRoot().find("form");Repository.submitUserEnrolmentForm(form.serialize()).then((function(data){if(!data.result)throw data.result;return modal.hide(),modal.destroy(),data})).then((function(){return DynamicTable.refreshTableContent(getDynamicTableFromLink(clickedLink)).catch(_notification.default.exception),Str.get_string("enrolmentupdatedforuser","core_enrol",userData)})).then((function(notificationString){(0,_toast.add)(notificationString)})).catch((function(){return modal.setBody(getBody(userEnrolmentId,JSON.stringify(form.serialize()))),modal}))},submitUnenrolFormAjax=function(clickedLink,modal,args,userData){Repository.unenrolUser(args.ueid).then((function(data){return data.result?(modal.hide(),modal.destroy(),data):(_notification.default.alert(data.errors[0].key,data.errors[0].message),data)})).then((function(){return DynamicTable.refreshTableContent(getDynamicTableFromLink(clickedLink)).catch(_notification.default.exception),Str.get_string("unenrolleduser","core_enrol",userData)})).then((function(notificationString){(0,_toast.add)(notificationString)})).catch(_notification.default.exception)},getBody=function(contextId,ueid){var formdata=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return _fragment.default.loadFragment("enrol","user_enrolment_form",contextId,{ueid:ueid,formdata:formdata})};_exports.init=function(_ref3){var contextId,uniqueId,getBodyFunction,contextid=_ref3.contextid,uniqueid=_ref3.uniqueid;contextId=contextid,uniqueId=uniqueid,getBodyFunction=function(userEnrolmentId,formData){return getBody(contextId,userEnrolmentId,formData)},document.addEventListener("click",(function(e){if(e.target.closest(_selectors.default.main.fromRegionId(uniqueId))){var editLink=e.target.closest(Selectors_editEnrolment);editLink&&(e.preventDefault(),showEditDialogue(editLink,getBodyFunction));var unenrolLink=e.target.closest(Selectors_unenrol);unenrolLink&&(e.preventDefault(),showUnenrolConfirmation(unenrolLink));var showDetailsLink=e.target.closest(Selectors_showDetails);showDetailsLink&&(e.preventDefault(),showStatusDetails(showDetailsLink))}}))}}));
define("core_user/local/participantsfilter/filter",["exports","core/form-autocomplete","./selectors","core/str"],(function(_exports,_formAutocomplete,_selectors,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_formAutocomplete=_interopRequireDefault(_formAutocomplete),_selectors=_interopRequireDefault(_selectors);var _default=function(){function _default(filterType,rootNode,initialValues){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,_default),this.filterType=filterType,this.rootNode=rootNode,this.addValueSelector(initialValues)}var Constructor,protoProps,staticProps,fn,_addValueSelector;return Constructor=_default,protoProps=[{key:"tearDown",value:function(){}},{key:"placeholder",get:function(){return(0,_str.get_string)("placeholdertypeorselect","core_user")}},{key:"showSuggestions",get:function(){return!0}},{key:"addValueSelector",value:(fn=regeneratorRuntime.mark((function _callee(){var initialValues,filterValueNode,dataSource,filterValueLabel,_this=this,_args=arguments;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return initialValues=_args.length>0&&void 0!==_args[0]?_args[0]:[],(filterValueNode=this.getFilterValueNode()).innerHTML=this.getSourceDataForFilter().outerHTML,(dataSource=filterValueNode.querySelector("select")).id="filter-value-"+dataSource.getAttribute("data-field-name"),(filterValueLabel=document.createElement("label")).setAttribute("for",dataSource.id),filterValueLabel.classList.add("sr-only"),filterValueLabel.innerText=dataSource.getAttribute("data-field-title"),filterValueNode.appendChild(filterValueLabel),initialValues.forEach((function(filterValue){var selectedOption=dataSource.querySelector('option[value="'.concat(filterValue,'"]'));selectedOption?selectedOption.selected=!0:_this.showSuggestions||((selectedOption=document.createElement("option")).value=filterValue,selectedOption.innerHTML=filterValue,selectedOption.selected=!0,dataSource.append(selectedOption))})),_context.t0=_formAutocomplete.default,_context.t1=dataSource,_context.t2="1"==dataSource.dataset.allowCustom,_context.next=16,this.placeholder;case 16:_context.t3=_context.sent,_context.t4=this.showSuggestions,_context.t5=!dataSource.multiple,_context.t6={items:"core_user/local/participantsfilter/autocomplete_selection_items",layout:"core_user/local/participantsfilter/autocomplete_layout",selection:"core_user/local/participantsfilter/autocomplete_selection"},_context.t0.enhance.call(_context.t0,_context.t1,_context.t2,null,_context.t3,!1,_context.t4,null,_context.t5,_context.t6);case 21:case"end":return _context.stop()}}),_callee,this)})),_addValueSelector=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(){return _addValueSelector.apply(this,arguments)})},{key:"filterRoot",get:function(){return this.rootNode.querySelector(_selectors.default.filter.byName(this.filterType))}},{key:"getSourceDataForFilter",value:function(){return this.rootNode.querySelector(_selectors.default.filterset.regions.datasource).querySelector(_selectors.default.data.fields.byName(this.filterType))}},{key:"getFilterValueNode",value:function(){return this.filterRoot.querySelector(_selectors.default.filter.regions.values)}},{key:"name",get:function(){return this.filterType}},{key:"jointype",get:function(){return parseInt(this.filterRoot.querySelector(_selectors.default.filter.fields.join).value,10)}},{key:"rawValues",get:function(){var select,filterValueSelect=this.getFilterValueNode().querySelector("select");return Object.values((select=filterValueSelect,select.querySelectorAll(":checked"))).map((function(option){return option.value}))}},{key:"values",get:function(){return this.rawValues.map((function(option){return parseInt(option,10)}))}},{key:"filterValue",get:function(){return{name:this.name,jointype:this.jointype,values:this.values}}}],protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),_default}();return _exports.default=_default,_exports.default}));
define("core_user/local/participantsfilter/selectors",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;
/**
   * Module containing the selectors for user filters.
   *
   * @module     core_user/local/user_filter/selectors
   * @package    core_user
   * @copyright  2020 Michael Hawkins <michaelh@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
var getFilterRegion=function(region){return'[data-filterregion="'.concat(region,'"]')},getFilterAction=function(action){return'[data-filteraction="'.concat(action,'"]')},getFilterField=function(field){return'[data-filterfield="'.concat(field,'"]')},_default={filter:{region:getFilterRegion("filter"),actions:{remove:getFilterAction("remove")},fields:{join:getFilterField("join"),type:getFilterField("type")},regions:{values:getFilterRegion("value")},byName:function(name){return"".concat(getFilterRegion("filter"),'[data-filter-type="').concat(name,'"]')}},filterset:{region:getFilterRegion("actions"),actions:{addRow:getFilterAction("add"),applyFilters:getFilterAction("apply"),resetFilters:getFilterAction("reset")},regions:{filtermatch:getFilterRegion("filtermatch"),filterlist:getFilterRegion("filters"),datasource:getFilterRegion("filtertypedata")},fields:{join:"".concat(getFilterRegion("filtermatch")," ").concat(getFilterField("join"))}},data:{fields:{byName:function(name){return'[data-field-name="'.concat(name,'"]')},all:"".concat(getFilterRegion("filtertypedata")," [data-field-name]")},typeList:getFilterRegion("filtertypelist"),typeListSelect:"select".concat(getFilterRegion("filtertypelist"))}};return _exports.default=_default,_exports.default}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core_user/local/participantsfilter/filtertypes/courseid",["exports","../filter"],(function(_exports,_filter){var obj;function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&("object"===_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;var _default=function(_Filter){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}(_default,_Filter);var Constructor,protoProps,staticProps,fn,_addValueSelector,_super=_createSuper(_default);function _default(filterType,filterSet){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,_default),_super.call(this,filterType,filterSet)}return Constructor=_default,protoProps=[{key:"addValueSelector",value:(fn=regeneratorRuntime.mark((function _callee(){return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:case"end":return _context.stop()}}),_callee)})),_addValueSelector=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(){return _addValueSelector.apply(this,arguments)})},{key:"filterValue",get:function(){return{name:this.name,jointype:1,values:[parseInt(this.rootNode.dataset.tableCourseId,10)]}}}],protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),_default}((_filter=(obj=_filter)&&obj.__esModule?obj:{default:obj}).default);return _exports.default=_default,_exports.default}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core_user/local/participantsfilter/filtertypes/keyword",["exports","../filter","core/str"],(function(_exports,_filter,_str){var obj;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&("object"===_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;var _default=function(_Filter){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}(_default,_Filter);var Constructor,protoProps,staticProps,_super=_createSuper(_default);function _default(){return _classCallCheck(this,_default),_super.apply(this,arguments)}return Constructor=_default,(protoProps=[{key:"values",get:function(){return this.rawValues}},{key:"placeholder",get:function(){return(0,_str.get_string)("placeholdertype","core_user")}},{key:"showSuggestions",get:function(){return!1}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),_default}((_filter=(obj=_filter)&&obj.__esModule?obj:{default:obj}).default);return _exports.default=_default,_exports.default}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core_user/local/participants/bulkactions",["exports","core_user/repository","core/str","core/modal_events","core/modal_factory","core/notification","core/templates","core/toast"],(function(_exports,Repository,Str,_modal_events,_modal_factory,_notification,_templates,_toast){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}
/**
   * Bulk actions for lists of participants.
   *
   * @module     core_user/local/participants/bulkactions
   * @package    core_user
   * @copyright  2020 Andrew Nicols <andrew@nicols.co.uk>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.showSendMessage=_exports.showAddNote=void 0,Repository=_interopRequireWildcard(Repository),Str=_interopRequireWildcard(Str),_modal_events=_interopRequireDefault(_modal_events),_modal_factory=_interopRequireDefault(_modal_factory),_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates);_exports.showAddNote=function(courseid,users,noteStateNames,stateHelpIcon){if(!users.length)return Promise.resolve();var states=[];for(var key in noteStateNames)switch(key){case"draft":states.push({value:"personal",label:noteStateNames[key]});break;case"public":states.push({value:"course",label:noteStateNames[key],selected:1});break;case"site":states.push({value:key,label:noteStateNames[key]})}var context={stateNames:states,stateHelpIcon:stateHelpIcon.innerHTML},titlePromise=null;return titlePromise=1===users.length?Str.get_string("addbulknotesingle","core_notes"):Str.get_string("addbulknote","core_notes",users.length),_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,body:_templates.default.render("core_user/add_bulk_note",context),title:titlePromise,buttons:{save:titlePromise},removeOnClose:!0}).then((function(modal){return modal.getRoot().on(_modal_events.default.save,(function(){return submitAddNote(courseid,users,modal)})),modal.show(),modal}))};var submitAddNote=function(courseid,users,modal){var text=modal.getRoot().find("form textarea").val(),publishstate=modal.getRoot().find("form select").val(),notes=users.map((function(userid){return{userid:userid,text:text,courseid:courseid,publishstate:publishstate}}));return Repository.createNotesForUsers(notes).then((function(noteIds){return 1===noteIds.length?Str.get_string("addbulknotedonesingle","core_notes"):Str.get_string("addbulknotedone","core_notes",noteIds.length)})).then((function(msg){return(0,_toast.add)(msg)})).catch(_notification.default.exception)};_exports.showSendMessage=function(users){return users.length?(titlePromise=1===users.length?Str.get_string("sendbulkmessagesingle","core_message"):Str.get_string("sendbulkmessage","core_message",users.length),_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,body:_templates.default.render("core_user/send_bulk_message",{}),title:titlePromise,buttons:{save:titlePromise},removeOnClose:!0}).then((function(modal){return modal.getRoot().on(_modal_events.default.save,(function(e){var text=modal.getRoot().find("form textarea").val();if(""===text.trim())return modal.getRoot().find('[data-role="messagetextrequired"]').removeAttr("hidden"),void e.preventDefault();submitSendMessage(modal,users,text)})),modal.show(),modal}))):Promise.resolve();var titlePromise};var submitSendMessage=function(modal,users,text){var messages=users.map((function(touserid){return{touserid:touserid,text:text}}));return Repository.sendMessagesToUsers(messages).then((function(messageIds){return 1==messageIds.length?Str.get_string("sendbulkmessagesentsingle","core_message"):Str.get_string("sendbulkmessagesent","core_message",messageIds.length)})).then((function(msg){return(0,_toast.add)(msg)})).catch(_notification.default.exception)}}));
/**
 * Datasource for the core_user/unified_filter.
 * @deprecated since Moodle 3.9 MDL-68612 - user unified filter replaced by participants filter.
 *
 * This module is compatible with core/form-autocomplete.
 *
 * @package    core_user
 * @copyright  2017 Jun Pataleta
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_user/unified_filter_datasource",["jquery","core/ajax","core/notification"],(function($,Ajax,Notification){return{list:function(selector,query){var filteredOptions=[],el=$(selector),originalOptions=$(selector).data("originaloptionsjson"),selectedFilters=el.val();$.each(originalOptions,(function(index,option){return""!==query.trim()&&-1===option.label.toLocaleLowerCase().indexOf(query.toLocaleLowerCase())||$.inArray(option.value,selectedFilters)>-1||filteredOptions.push(option),!0}));var deferred=new $.Deferred;return deferred.resolve(filteredOptions),deferred.promise()},processResults:function(selector,results){var options=[];return $.each(results,(function(index,data){options.push({value:data.value,label:data.label})})),options},transport:function(selector,query,callback){this.list(selector,query).then(callback).catch(Notification.exception)}}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("core_user/participantsfilter",["exports","./local/participantsfilter/filtertypes/courseid","core_table/dynamic","./local/participantsfilter/filter","core/str","core/notification","core/pending","./local/participantsfilter/selectors","core/templates","core/custom_interaction_events","jquery"],(function(_exports,_courseid,DynamicTable,_filter,_str,_notification,_pending,_selectors,_templates,_custom_interaction_events,_jquery){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_courseid=_interopRequireDefault(_courseid),DynamicTable=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(DynamicTable),_filter=_interopRequireDefault(_filter),_notification=_interopRequireDefault(_notification),_pending=_interopRequireDefault(_pending),_selectors=_interopRequireDefault(_selectors),_templates=_interopRequireDefault(_templates),_custom_interaction_events=_interopRequireDefault(_custom_interaction_events),_jquery=_interopRequireDefault(_jquery);var _systemImportTransformerGlobalIdentifier="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||_unsupportedIterableToArray(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||_unsupportedIterableToArray(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}_exports.init=function(participantsRegionId){var _ref2,_ref3,_ref9,filterSet=document.querySelector("#".concat(participantsRegionId)),activeFilters={courseid:new _courseid.default("courseid",filterSet)},getFilterRegion=function(){return filterSet.querySelector(_selectors.default.filterset.regions.filterlist)},addFilterRow=function(){var pendingPromise=new _pending.default("core_user/participantsfilter:addFilterRow"),rownum=1+getFilterRegion().querySelectorAll(_selectors.default.filter.region).length;return _templates.default.renderForPromise("core_user/local/participantsfilter/filterrow",{rownumber:rownum}).then((function(_ref){var html=_ref.html,js=_ref.js;return _templates.default.appendNodeContents(getFilterRegion(),html,js)})).then((function(filterRow){var typeList=filterSet.querySelector(_selectors.default.data.typeList);return filterRow.forEach((function(contentNode){var contentTypeList=contentNode.querySelector(_selectors.default.filter.fields.type);contentTypeList&&(contentTypeList.innerHTML=typeList.innerHTML)})),filterRow})).then((function(filterRow){return updateFiltersOptions(),filterRow})).then((function(result){return pendingPromise.resolve(),result})).catch(_notification.default.exception)},getFilterDataSource=function(filterType){return filterSet.querySelector(_selectors.default.filterset.regions.datasource).querySelector(_selectors.default.data.fields.byName(filterType))},addFilter=(_ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee(filterRow,filterType,initialFilterValues){var filterDataNode,Filter,typeField;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(filterRow.dataset.filterType=filterType,filterDataNode=getFilterDataSource(filterType),Filter=_filter.default,!filterDataNode.dataset.filterTypeClass){_context.next=7;break}return _context.next=6,"function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require([filterDataNode.dataset.filterTypeClass],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require(filterDataNode.dataset.filterTypeClass)):Promise.resolve(_systemImportTransformerGlobalIdentifier[filterDataNode.dataset.filterTypeClass]);case 6:Filter=_context.sent;case 7:return activeFilters[filterType]=new Filter(filterType,filterSet,initialFilterValues),(typeField=filterRow.querySelector(_selectors.default.filter.fields.type)).value=filterType,typeField.disabled="disabled",updateFiltersOptions(),_context.abrupt("return",activeFilters[filterType]);case 13:case"end":return _context.stop()}}),_callee)}))),function(_x,_x2,_x3){return _ref2.apply(this,arguments)}),removeOrReplaceFilterRow=function(filterRow,refreshContent){1===getFilterRegion().querySelectorAll(_selectors.default.filter.region).length?replaceFilterRow(filterRow,refreshContent):removeFilterRow(filterRow,refreshContent)},removeFilterRow=(_ref3=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(filterRow){var refreshContent,filterType,hasFilterValue,filterLegends,_args2=arguments;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return refreshContent=!(_args2.length>1&&void 0!==_args2[1])||_args2[1],filterType=filterRow.querySelector(_selectors.default.filter.fields.type),hasFilterValue=!!filterType.value,removeFilterObject(filterRow.dataset.filterType),filterRow.remove(),updateFiltersOptions(),hasFilterValue&&refreshContent&&updateTableFromFilter(),_context2.next=9,getAvailableFilterLegends();case 9:filterLegends=_context2.sent,getFilterRegion().querySelectorAll(_selectors.default.filter.region).forEach((function(filterRow,index){filterRow.querySelector("legend").innerText=filterLegends[index]}));case 11:case"end":return _context2.stop()}}),_callee2)}))),function(_x4){return _ref3.apply(this,arguments)}),replaceFilterRow=function(filterRow){var refreshContent=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],rowNum=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return removeFilterObject(filterRow.dataset.filterType),_templates.default.renderForPromise("core_user/local/participantsfilter/filterrow",{rownumber:rowNum}).then((function(_ref4){var html=_ref4.html,js=_ref4.js;return _templates.default.replaceNode(filterRow,html,js)})).then((function(filterRow){var typeList=filterSet.querySelector(_selectors.default.data.typeList);return filterRow.forEach((function(contentNode){var contentTypeList=contentNode.querySelector(_selectors.default.filter.fields.type);contentTypeList&&(contentTypeList.innerHTML=typeList.innerHTML)})),filterRow})).then((function(filterRow){return updateFiltersOptions(),filterRow})).then((function(filterRow){return refreshContent?updateTableFromFilter():filterRow})).catch(_notification.default.exception)},removeFilterObject=function(filterName){if(filterName){var filter=activeFilters[filterName];filter&&(filter.tearDown(),delete activeFilters[filterName])}},updateFiltersOptions=function(){var filters=getFilterRegion().querySelectorAll(_selectors.default.filter.region);filters.forEach((function(filterRow){filterRow.querySelectorAll(_selectors.default.filter.fields.type+" option").forEach((function(option){option.value===filterRow.dataset.filterType?(option.classList.remove("hidden"),option.disabled=!1):activeFilters[option.value]?(option.classList.add("hidden"),option.disabled=!0):(option.classList.remove("hidden"),option.disabled=!1)}))}));var addRowButton=filterSet.querySelector(_selectors.default.filterset.actions.addRow);filterSet.querySelectorAll(_selectors.default.data.fields.all).length<=filters.length?addRowButton.setAttribute("disabled","disabled"):addRowButton.removeAttribute("disabled"),1===filters.length?(filterSet.querySelector(_selectors.default.filterset.regions.filtermatch).classList.add("hidden"),filterSet.querySelector(_selectors.default.filterset.fields.join).value=1,filterSet.dataset.filterverb=1):filterSet.querySelector(_selectors.default.filterset.regions.filtermatch).classList.remove("hidden")},updateTableFromFilter=function(){var pendingPromise=new _pending.default("core_user/participantsfilter:updateTableFromFilter"),filters={};return Object.values(activeFilters).forEach((function(filter){filters[filter.filterValue.name]=filter.filterValue})),DynamicTable.setFilters(DynamicTable.getTableFromId(filterSet.dataset.tableRegion),{jointype:parseInt(filterSet.querySelector(_selectors.default.filterset.fields.join).value,10),filters:filters}).then((function(result){return pendingPromise.resolve(),result})).catch(_notification.default.exception)},getAvailableFilterLegends=(_ref9=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(){var maxFilters,requests,legendStrings;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return maxFilters=document.querySelector(_selectors.default.data.typeListSelect).length-1,requests=[],_toConsumableArray(Array(maxFilters)).forEach((function(_,rowIndex){requests.push({key:"filterrowlegend",component:"core_user",param:rowIndex+1})})),_context3.next=5,(0,_str.get_strings)(requests).then((function(fetchedStrings){return fetchedStrings})).catch(_notification.default.exception);case 5:return legendStrings=_context3.sent,_context3.abrupt("return",legendStrings);case 7:case"end":return _context3.stop()}}),_callee3)}))),function(){return _ref9.apply(this,arguments)});filterSet.querySelector(_selectors.default.filterset.region).addEventListener("click",(function(e){var pendingPromise;e.target.closest(_selectors.default.filterset.actions.addRow)&&(e.preventDefault(),addFilterRow()),e.target.closest(_selectors.default.filterset.actions.applyFilters)&&(e.preventDefault(),updateTableFromFilter()),e.target.closest(_selectors.default.filterset.actions.resetFilters)&&(e.preventDefault(),pendingPromise=new _pending.default("core_user/participantsfilter:setFilterFromConfig"),getFilterRegion().querySelectorAll(_selectors.default.filter.region).forEach((function(filterRow){return removeOrReplaceFilterRow(filterRow,!1)})),updateTableFromFilter().then((function(result){return pendingPromise.resolve(),result})))})),filterSet.querySelector(_selectors.default.filterset.regions.filterlist).addEventListener("click",(function(e){e.target.closest(_selectors.default.filter.actions.remove)&&(e.preventDefault(),removeOrReplaceFilterRow(e.target.closest(_selectors.default.filter.region),!0))}));var filterRegion=(0,_jquery.default)(getFilterRegion());_custom_interaction_events.default.define(filterRegion,[_custom_interaction_events.default.events.accessibleChange]),filterRegion.on(_custom_interaction_events.default.events.accessibleChange,(function(e){var typeField=e.target.closest(_selectors.default.filter.fields.type);if(typeField&&typeField.value){var filter=e.target.closest(_selectors.default.filter.region);addFilter(filter,typeField.value)}})),filterSet.querySelector(_selectors.default.filterset.fields.join).addEventListener("change",(function(e){filterSet.dataset.filterverb=e.target.value}));var tableRoot=DynamicTable.getTableFromId(filterSet.dataset.tableRegion),initialFilters=DynamicTable.getFilters(tableRoot);if(initialFilters){var initialFilterPromise=new _pending.default("core_user/participantsfilter:setFilterFromConfig");(function(config){var filterConfig=Object.entries(config.filters);if(!filterConfig.length)return Promise.resolve();filterSet.querySelector(_selectors.default.filterset.fields.join).value=config.jointype;var filterPromises=filterConfig.map((function(_ref5){var _ref6=_slicedToArray(_ref5,2),filterType=_ref6[0],filterData=_ref6[1];if("courseid"===filterType)return!1;var filterValues=filterData.values;return!!filterValues.length&&addFilterRow().then((function(_ref7){var filterRow=_slicedToArray(_ref7,1)[0];return addFilter(filterRow,filterType,filterValues)}))})).filter((function(promise){return promise}));return filterPromises.length?Promise.all(filterPromises).then((function(){getFilterRegion().querySelectorAll(_selectors.default.filter.region).forEach((function(filterRow){filterRow.querySelector(_selectors.default.filter.fields.type).value||removeOrReplaceFilterRow(filterRow,!1)}))})).then(updateFiltersOptions).then(updateTableFromFilter):Promise.resolve()})(initialFilters).then((function(){return initialFilterPromise.resolve()})).catch()}}}));
/**
 * Unified filter page JS module for the course participants page.
 *
 * @deprecated since Moodle 3.9 MDL-68612 - user unified filter replaced by participants filter.
 * @module     core_user/unified_filter
 * @package    core_user
 * @copyright  2017 Jun Pataleta
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("core_user/unified_filter",["jquery","core/form-autocomplete","core/str","core/notification"],(function($,Autocomplete,Str,Notification){var SELECTORS_UNIFIED_FILTERS="#unified-filters";return{init:function(){!function(){M.util.js_pending("unified_filter_datasource"),Str.get_strings([{key:"userfilterplaceholder",component:"moodle"},{key:"nofiltersapplied",component:"moodle"}]).done((function(langstrings){var placeholder=langstrings[0],noSelectionString=langstrings[1];Autocomplete.enhance(SELECTORS_UNIFIED_FILTERS,!0,"core_user/unified_filter_datasource",placeholder,!1,!0,noSelectionString,!0).then((function(){M.util.js_complete("unified_filter_datasource")})).fail(Notification.exception)})).fail(Notification.exception);var last=$(SELECTORS_UNIFIED_FILTERS).val();$(SELECTORS_UNIFIED_FILTERS).on("change",(function(){var current=$(this).val(),listoffilters=[],textfilters=[],updatedselectedfilters=!1;if($.each(current,(function(index,catoption){var catandoption=catoption.split(":",2);if(2!==catandoption.length)return textfilters.push(catoption),!0;var category=catandoption[0],option=catandoption[1];return void 0!==listoffilters[category]&&(updatedselectedfilters=!0),listoffilters[category]=option,!0})),updatedselectedfilters){var updatefilters=[];for(var category in listoffilters)updatefilters.push(category+":"+listoffilters[category]);updatefilters=updatefilters.concat(textfilters),$(this).val(updatefilters)}last.join(",")!=current.join(",")&&this.form.submit()}))}()},getForm:function(){return $(SELECTORS_UNIFIED_FILTERS).closest("form")}}}));
define("core_user/repository",["exports","core/ajax"],(function(_exports,_ajax){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.unenrolUser=_exports.submitUserEnrolmentForm=_exports.sendMessagesToUsers=_exports.createNotesForUsers=void 0;_exports.unenrolUser=function(userEnrolmentId){return(0,_ajax.call)([{methodname:"core_enrol_unenrol_user_enrolment",args:{ueid:userEnrolmentId}}])[0]};_exports.submitUserEnrolmentForm=function(formdata){return(0,_ajax.call)([{methodname:"core_enrol_submit_user_enrolment_form",args:{formdata:formdata}}])[0]};_exports.createNotesForUsers=function(notes){return(0,_ajax.call)([{methodname:"core_notes_create_notes",args:{notes:notes}}])[0]};_exports.sendMessagesToUsers=function(messages){return(0,_ajax.call)([{methodname:"core_message_send_instant_messages",args:{messages:messages}}])[0]}}));
define ("qtype_coderunner/ajaxquestionloader",["jquery"],function(a){return{loadQuestionText:function(b,c,d){var e=a("#"+c);if(1!=e.length){e.append("<div style=\"colour:red\">Failed to load problem spec<div>");return}a.getJSON(M.cfg.wwwroot+"/question/type/coderunner/problemspec.php",{questionid:b,sesskey:M.cfg.sesskey,filename:d},function(a){if(a.filecontentsb64){e.append("<div><a download href=\"data:application/pdf;base64,"+a.filecontentsb64+"\">Problem spec</a></div>")}else{e.append("<div style=\"colour:red\">Failed to load problem spec<div>")}}).fail(function(){e.append("<div style=\"colour:red\">Failed to load problem spec<div>")})}}});
define ("qtype_coderunner/ui_ace_mini_ide",["jquery","core/ajax"],function(a,b){function c(b,c,d,e){var f=a(document.getElementById(b)),g=a(document.getElementById(b+"_wrapper")),h=f[0]===document.activeElement,i=e.lang,j=a("<button type=\"button\" class=\"qtype-coderunner-ide-button\">Run code</button>"),k=a("<div class=\"qtype-coderunner-ide-buttons\"></div>"),l,m,n=this;try{window.ace.require("ace/ext/language_tools");this.modelist=window.ace.require("ace/ext/modelist");this.textarea=f;this.enabled=!1;this.contents_changed=!1;this.capturingTab=!1;this.clickInProgress=!1;this.language=i;this.editNode=a("<div></div>");this.editor=window.ace.edit(this.editNode.get(0));if(f.prop("readonly")){this.editor.setReadOnly(!0)}this.editor.setOptions({enableBasicAutocompletion:!0,newLineMode:"unix"});this.editor.$blockScrolling=1/0;this.workArea=a("<div></div>");this.workArea.append(this.editNode);this.button=j;k.append(j);this.workArea.append(k);this.ide_response=a("<textarea rows=\"5\" class=\"edit_code\" style=\"width:100%\"></textarea>");m=a("<div></div>");m.append(this.ide_response);this.workArea.append(m);this.editNode.css({resize:"none",height:d/2,width:"100%"});l=this.editor.getSession();l.setValue(this.textarea.val());if(e.theme){this.editor.setTheme("ace/theme/"+e.theme)}this.setLanguage(i);this.setEventHandlers();this.setMiniIdeHandlers();this.captureTab();this.editor.renderer.on("afterRender",function(){var a=g.find(".ace_gutter");if(a.hasClass("moodle-has-zindex")){return}a.addClass("moodle-has-zindex");if(h){n.editor.focus();n.editor.navigateFileEnd()}n.aceLabel=g.find(".answerprompt");n.aceLabel.attr("for","ace_"+b);n.aceTextarea=g.find(".ace_text-input");n.aceTextarea.attr("id","ace_"+b)});this.fail=!1}catch(a){alert(a);this.fail=!0}}c.prototype.failed=function(){return this.fail};c.prototype.failMessage=function(){return"ace_ui_notready"};c.prototype.sync=function(){};c.prototype.syncIntervalSecs=function(){return 0};c.prototype.setLanguage=function(a){var b=this.editor.getSession(),c=this.findMode(a);if(c){b.setMode(c.mode)}this.language=a};c.prototype.getElement=function(){return this.workArea};c.prototype.captureTab=function(){this.capturingTab=!0;this.editor.commands.bindKeys({Tab:"indent","Shift-Tab":"outdent"})};c.prototype.releaseTab=function(){this.capturingTab=!1;this.editor.commands.bindKeys({Tab:null,"Shift-Tab":null})};c.prototype.setEventHandlers=function(){var a=this;this.editor.getSession().on("change",function(){a.textarea.val(a.editor.getSession().getValue());a.contents_changed=!0});this.editor.on("blur",function(){if(a.contents_changed){a.textarea.trigger("change")}});this.editor.on("mousedown",function(){a.clickInProgress=!0});this.editor.on("focus",function(){if(a.clickInProgress){a.captureTab()}else{a.releaseTab()}});this.editor.on("click",function(){a.clickInProgress=!1});this.editor.container.addEventListener("keydown",function(b){if(b.which===void 0||0!==b.which){if(b.keyCode===77&&b.ctrlKey&&!b.altKey){if(a.capturingTab){a.releaseTab()}else{a.captureTab()}b.preventDefault()}else if(b.keyCode===27){a.releaseTab()}else if(!(b.shiftKey||b.ctrlKey||b.altKey||b.keyCode==9)){a.captureTab()}}},!0)};c.prototype.setMiniIdeHandlers=function(){var a=this;this.button.on("click",function(){var c=a.textarea.val();b.call([{methodname:"qtype_coderunner_run_in_sandbox",args:{sourcecode:c,language:a.language,stdin:""},done:function done(b){var c=JSON.parse(b),d=c.cmpinfo+c.output+c.stderr;a.ide_response.val(d)},fail:function fail(a){alert("We're dead, Fred: "+a)}}])})};c.prototype.destroy=function(){var b;if(!this.fail){b=this.editor.isFocused();this.textarea.val(this.editor.getSession().getValue());this.editor.destroy();a(this.workArea).remove();if(b){this.textarea.focus();this.textarea[0].selectionStart=this.textarea[0].value.length}}};c.prototype.hasFocus=function(){return this.editor.isFocused()};c.prototype.findMode=function(a){var b,c,d,e=[],f={octave:"matlab",nodejs:"javascript","c#":"cs"};if("string"!=typeof a){return}if(a.toLowerCase()in f){a=f[a.toLowerCase()]}e=[a,a.replace(/\d+$/,"")];for(var g=0;g<e.length;g++){b=e[g];c="input."+b;d=this.modelist.modesByName[b]||this.modelist.modesByName[b.toLowerCase()]||this.modelist.getModeForPath(c)||this.modelist.getModeForPath(c.toLowerCase());if(d&&"text"!==d.name){return d}}};c.prototype.resize=function(a,b){this.workArea.outerHeight(b);this.workArea.outerWidth(a);this.editNode.css({resize:"none",height:b/2,width:"100%"});this.ide_response.css({resize:"none",height:b/2,width:"100%"});this.editor.resize()};return{Constructor:c}});
define ("qtype_coderunner/ui_gapfiller",["jquery"],function(a){function b(b,c,d,e){var f;this.textArea=a(document.getElementById(b));this.readOnly=this.textArea.prop("readonly");this.uiParams=e;this.fail=!1;this.htmlDiv=null;this.source=e.ui_source||"globalextra";if("globalextra"!==this.source&&"test0"!==this.source){alert("Invalid source for HTML in ui_gapfiller");this.source="globalextra"}if("globalextra"==this.source){f=this.textArea.attr("data-globalextra")}else{f=this.textArea.attr("data-test0")}this.html=f.replace("<","&lt;");this.reload()}b.prototype.failed=function(){return this.fail};b.prototype.sync=function(){var b=[],c=!0;this.getFields().each(function(){var d,e;d=a(this).attr("name");if("cr_gapfiller_field"!==d){alert("Unexpected UI element found in answer box")}else{e=a(this).val();b.push(e);if(""!==e){c=!1}}});if(c){this.textArea.val("")}else{this.textArea.val(JSON.stringify(b))}};b.prototype.getElement=function(){return this.htmlDiv};b.prototype.getFields=function(){return a(this.htmlDiv).find(".coderunner-ui-element")};b.prototype.setField=function(a,b){if("checkbox"===a.attr("type")||"radio"===a.attr("type")){a.prop("checked",a.val()===b)}else{a.val(b)}};b.prototype.markedUpHtml=function(){function a(a){for(var b,d="{[(*+\\",e="",f=0;f<a.length;f++){b=a[f];for(var g=0;g<d.length;g++){if(b===d[g]){b="\\"+b}}e+=b}return e}var b=a("{["),c=a("]}"),d=new RegExp(b+" *((?:\\d+)|(?:\\d+, *\\d+)) *"+c),e=this.html.split(d),f="<pre>"+e[0],g;for(g=1;g<e.length;g+=2){f+=this.markUp(e[g]);if(g+1<e.length){f+=e[g+1]}}f=f+"</pre>";return f};b.prototype.markUp=function(a){var d,e="";function b(a){return"<input name=\"cr_gapfiller_field\" class=\"coderunner-ui-element\" size=\""+a+"\">"}function c(a,b){return"<textarea name=\"cr_gapfiller_field\" class =\"coderunner-ui-element\" rows=\""+a+"\" cols=\""+b+"\" style=\"width:auto;\"></textarea>"}d=a.split(",");if(1==d.length){e=b(parseInt(d[0]))}else{e=c(parseInt(d[0]),parseInt(d[1]))}return e};b.prototype.reload=function(){var b=a(this.textArea).val(),c,d,e,f;this.htmlDiv=a("<div style='height:fit-content' class='qtype-coderunner-html-outer-div'>"+this.markedUpHtml()+"</div>");if(b){try{d=JSON.parse(b);f=this.getFields();for(e=0;e<f.length;e++){c=e<d.length?d[e]:"???";this.setField(a(f[e]),c)}}catch(a){}}};b.prototype.resize=function(){};b.prototype.hasFocus=function(){var a=!1;this.getFields().each(function(){if(this===document.activeElement){a=!0}});return a};b.prototype.destroy=function(){this.sync();a(this.htmlDiv).remove();this.htmlDiv=null};return{Constructor:b}});
define ("qtype_coderunner/ui_ace_gapfiller",["jquery"],function(a){var d,f=/[ !"#$%&'()*+,`\-./0-9:;<=>?@A-Z\[\]\\^_a-z{}|~]/;function b(b,c,e,g){this.textArea=a(document.getElementById(b));var h=a(document.getElementById(b+"_wrapper")),i=this.textArea[0]===document.activeElement,j=g.lang,k=this,l="";this.uiParams=g;this.gaps=[];this.source=g.ui_source||"globalextra";this.nextGapIndex=0;if("globalextra"!==this.source&&"test0"!==this.source){alert("Invalid source for code in ui_ace_gapfiller");this.source="globalextra"}if("globalextra"==this.source){l=this.textArea.attr("data-globalextra")}else{l=this.textArea.attr("data-test0")}try{window.ace.require("ace/ext/language_tools");d=window.ace.require("ace/range").Range;this.modelist=window.ace.require("ace/ext/modelist");this.enabled=!1;this.contents_changed=!1;this.capturingTab=!1;this.clickInProgress=!1;this.editNode=a("<div></div>");this.editNode.css({resize:"none",height:e,width:"100%"});this.editor=window.ace.edit(this.editNode.get(0));if(this.textArea.prop("readonly")){this.editor.setReadOnly(!0)}this.editor.setOptions({displayIndentGuides:!1,dragEnabled:!1,enableBasicAutocompletion:!0,newLineMode:"unix"});this.editor.$blockScrolling=1/0;if(g.theme){this.editor.setTheme("ace/theme/"+g.theme)}this.setLanguage(j);this.setEventHandlers(this.textArea);this.captureTab();this.editor.renderer.on("afterRender",function(){var a=h.find(".ace_gutter");if(a.hasClass("moodle-has-zindex")){return}a.addClass("moodle-has-zindex");if(i){k.editor.focus();k.editor.navigateFileEnd()}k.aceLabel=h.find(".answerprompt");k.aceLabel.attr("for","ace_"+b);k.aceTextarea=h.find(".ace_text-input");k.aceTextarea.attr("id","ace_"+b)});this.createGaps(l);this.editor.commands.on("exec",function(a){var b=k.editor.selection.getCursor(),c=a.command.name,e=k.editor.getSelectionRange(),g=k.findCursorGap(b);if(c.startsWith("go")){if(null!==g&&"gotoright"===c&&b.column===g.range.start.column+g.textSize){k.editor.moveCursorTo(b.row,g.range.end.column+1)}else{return}}if(null===g){if("selectall"===c){k.editor.selection.selectAll()}}else if("indent"===c){var h=k.gaps[(g.index+1)%k.gaps.length];k.editor.moveCursorTo(h.range.start.row,h.range.start.column+h.textSize);k.editor.selection.clearSelection()}else if("selectall"===c){k.editor.selection.setSelectionRange(new d(g.range.start.row,g.range.start.column,g.range.start.row,g.range.end.column),!1)}else if(k.editor.selection.isEmpty()){if("insertstring"===c){var i=a.args;if(f.test(i)){g.insertChar(k.gaps,b,i)}}else if("backspace"===c){if(b.column>g.range.start.column&&0<g.textSize){g.deleteChar(k.gaps,{row:b.row,column:b.column-1})}}else if("del"===c){if(b.column<g.range.start.column+g.textSize&&0<g.textSize){g.deleteChar(k.gaps,b)}}k.editor.selection.clearSelection()}else if(!k.editor.selection.isEmpty()&&g.cursorInGap(e.start)&&g.cursorInGap(e.end)){if("insertstring"===c||"backspace"===c||"del"===c||"paste"===c||"cut"===c){g.deleteRange(k.gaps,e.start.column,e.end.column);k.editor.selection.clearSelection()}if("insertstring"===c){var j=a.args;if(f.test(j)){g.insertChar(k.gaps,e.start,j)}}}if(null!==g&&"paste"===c){g.insertText(k.gaps,e.start.column,a.args.text)}a.preventDefault();a.stopPropagation()});k.editor.selection.on("changeCursor",function(){var a=k.editor.selection.getCursor(),b=k.findCursorGap(a);if(null!==b){if(a.column>b.range.start.column+b.textSize){k.editor.moveCursorTo(b.range.start.row,b.range.start.column+b.textSize)}}});this.gapToSelect=null;this.editor.on("tripleclick",function(a){var b=k.editor.selection.getCursor(),c=k.findCursorGap(b);if(null!==c){k.editor.selection.setSelectionRange(new d(c.range.start.row,c.range.start.column,c.range.start.row,c.range.end.column),!1);k.gapToSelect=c;a.preventDefault();a.stopPropagation()}});this.editor.on("click",function(a){if(k.gapToSelect){k.editor.moveCursorTo(k.gapToSelect.range.start.row,k.gapToSelect.range.start.column+k.gapToSelect.textSize);k.gapToSelect=null;a.preventDefault();a.stopPropagation()}});this.fail=!1;this.reload()}catch(a){this.fail=!0}}b.prototype.createGaps=function(a){this.gaps=[];function b(a){for(var b,d="{[(*+\\",e="",f=0;f<a.length;f++){b=a[f];for(var g=0;g<d.length;g++){if(b===d[g]){b="\\"+b}}e+=b}return e}for(var d=a.split(/\r?\n/),e=b("{["),f=b("]}"),g=new RegExp(e+" *((?:\\d+)|(?:\\d+- *\\d+)) *"+f),h="",k=0,l;k<d.length;k++){l=d[k].split(g);h+=l[0];for(var m=l[0].length,n=1;n<l.length;n+=2){var o=l[n].split("-"),p=parseInt(o[0]),q=1<o.length?parseInt(o[1]):1/0,r=new c(this.editor,k,m,p,q);r.index=this.nextGapIndex;this.nextGapIndex+=1;this.gaps.push(r);m+=p;h+=" ".repeat(p);if(n+1<l.length){h+=l[n+1];m+=l[n+1].length}}if(k<d.length-1){h+="\n"}}this.editor.session.setValue(h)};b.prototype.findCursorGap=function(a){for(var b=0,c;b<this.gaps.length;b++){c=this.gaps[b];if(c.cursorInGap(a)){return c}}return null};b.prototype.failed=function(){return this.fail};b.prototype.failMessage=function(){return"ace_ui_notready"};b.prototype.sync=function(){for(var a=[],b=!0,c=0;c<this.gaps.length;c++){var d=this.gaps[c],e=d.getText();a.push(e);if(""!==e){b=!1}}if(b){this.textArea.val("")}else{this.textArea.val(JSON.stringify(a))}};b.prototype.reload=function(){var a=this.textArea.val();if(a){try{for(var b=JSON.parse(a),c=0,d;c<this.gaps.length;c++){d=c<b.length?b[c]:"???";this.gaps[c].insertText(this.gaps,this.gaps[c].range.start.column,d)}}catch(a){}}};b.prototype.setLanguage=function(a){var b=this.editor.getSession(),c=this.findMode(a);if(c){b.setMode(c.mode)}};b.prototype.getElement=function(){return this.editNode};b.prototype.captureTab=function(){this.capturingTab=!0;this.editor.commands.bindKeys({Tab:"indent","Shift-Tab":"outdent"})};b.prototype.releaseTab=function(){this.capturingTab=!1;this.editor.commands.bindKeys({Tab:null,"Shift-Tab":null})};b.prototype.setEventHandlers=function(){var a=this;this.editor.getSession().on("change",function(){a.contents_changed=!0});this.editor.on("blur",function(){if(a.contents_changed){a.textArea.trigger("change")}});this.editor.on("mousedown",function(){a.clickInProgress=!0});this.editor.on("focus",function(){if(a.clickInProgress){a.captureTab()}else{a.releaseTab()}});this.editor.on("click",function(){a.clickInProgress=!1});this.editor.container.addEventListener("keydown",function(b){if(b.which===void 0||0!==b.which){if(b.keyCode===77&&b.ctrlKey&&!b.altKey){if(a.capturingTab){a.releaseTab()}else{a.captureTab()}b.preventDefault()}else if(b.keyCode===27){a.releaseTab()}else if(!(b.shiftKey||b.ctrlKey||b.altKey||b.keyCode==9)){a.captureTab()}}},!0)};b.prototype.destroy=function(){this.sync();var b;if(!this.fail){b=this.editor.isFocused();this.editor.destroy();a(this.editNode).remove();if(b){this.textArea.focus();this.textArea[0].selectionStart=this.textArea[0].value.length}}};b.prototype.hasFocus=function(){return this.editor.isFocused()};b.prototype.findMode=function(a){var b,c,d,e=[],f={octave:"matlab",nodejs:"javascript","c#":"cs"};if("string"!=typeof a){return}if(a.toLowerCase()in f){a=f[a.toLowerCase()]}e=[a,a.replace(/\d+$/,"")];for(var g=0;g<e.length;g++){b=e[g];c="input."+b;d=this.modelist.modesByName[b]||this.modelist.modesByName[b.toLowerCase()]||this.modelist.getModeForPath(c)||this.modelist.getModeForPath(c.toLowerCase());if(d&&"text"!==d.name){return d}}};b.prototype.resize=function(a,b){this.editNode.outerHeight(b);this.editNode.outerWidth(a);this.editor.resize()};function c(a,b,c,e){var f=4<arguments.length&&arguments[4]!==void 0?arguments[4]:1/0;this.editor=a;this.minWidth=e;this.maxWidth=f;this.range=new d(b,c,b,c+e);this.textSize=0;this.editor.session.addMarker(this.range,"ace-gap-outline","text",!0);this.editor.session.addMarker(this.range,"ace-gap-background","text",!1)}c.prototype.cursorInGap=function(a){return a.row>=this.range.start.row&&a.column>=this.range.start.column&&a.row<=this.range.end.row&&a.column<=this.range.end.column};c.prototype.getWidth=function(){return this.range.end.column-this.range.start.column};c.prototype.changeWidth=function(a,b){this.range.end.column+=b;for(var c=0,d;c<a.length;c++){d=a[c];if(d.range.start.row===this.range.start.row&&d.range.start.column>this.range.end.column){d.range.start.column+=b;d.range.end.column+=b}}this.editor.$onChangeBackMarker();this.editor.$onChangeFrontMarker()};c.prototype.insertChar=function(a,b,c){if(this.textSize===this.getWidth()&&this.getWidth()<this.maxWidth){this.changeWidth(a,1);this.textSize+=1;this.editor.session.insert(b,c)}else if(this.textSize<this.maxWidth){this.editor.session.remove(new d(b.row,this.range.end.column-1,b.row,this.range.end.column));this.textSize+=1;this.editor.session.insert(b,c)}};c.prototype.deleteChar=function(a,b){this.textSize-=1;this.editor.session.remove(new d(b.row,b.column,b.row,b.column+1));if(this.textSize>=this.minWidth){this.changeWidth(a,-1)}else{this.editor.session.insert({row:b.row,column:this.range.end.column-1}," ")}};c.prototype.deleteRange=function(a,b,c){for(var d=b;d<c;d++){if(b<this.range.start.column+this.textSize){this.deleteChar(a,{row:this.range.start.row,column:b})}}};c.prototype.insertText=function(a,b,c){for(var d=0;d<c.length;d++){if(b+d<this.range.start.column+this.maxWidth){this.insertChar(a,{row:this.range.start.row,column:b+d},c[d])}}};c.prototype.getText=function(){return this.editor.session.getTextRange(new d(this.range.start.row,this.range.start.column,this.range.end.row,this.range.start.column+this.textSize))};return{Constructor:b}});
define ("qtype_coderunner/authorform",["jquery","qtype_coderunner/userinterfacewrapper","core/str"],function(a,b,c){var d={template:["#id_template","value",""],iscombinatortemplate:["#id_iscombinatortemplate","checked","",function(a){return"1"===a?!0:!1}],cputimelimitsecs:["#id_cputimelimitsecs","value",""],memlimitmb:["#id_memlimitmb","value",""],sandbox:["#id_sandbox","value","DEFAULT"],sandboxparams:["#id_sandboxparams","value",""],testsplitterre:["#id_testsplitterre","value","",function(a){return a.replace("\n","\\n")}],allowmultiplestdins:["#id_allowmultiplestdins","checked","",function(a){return"1"===a?!0:!1}],grader:["#id_grader","value","EqualityGrader"],resultcolumns:["#id_resultcolumns","value",""],language:["#id_language","value",""],acelang:["#id_acelang","value",""],uiplugin:["#id_uiplugin","value","ace"]};return{initEditForm:function(){var u=a("#id_coderunnertype"),v=a("#id_template"),w=a("#id_templateparamsevalpertry"),x=a("#id_globalextra"),y=a("#id_prototypeextra"),z=a("#id_useace"),A=a("#id_language"),B=a("#id_acelang"),C=a("#id_customise"),D=a("#id_iscombinatortemplate"),E=a("#id_testsplitterre"),F=a("#id_allowmultiplestdins"),G=a("#id_customisationheader"),H=a("#id_advancedcustomisationheader"),I=C.prop("checked"),J=a("#id_prototypetype"),K=a("#id_answerpreloadhdr"),L=a("#id_typename"),N=a("input[name=\"courseid\"]").prop("value"),O=a("#qtype-help"),P=a("select#id_precheck"),Q=a("div.testtype"),R=a("#id_broken_question"),S=a("#id_uiplugin"),T=a("#id_uiparameters");function e(c,d){var e=a(document.getElementById(c)),f,g=e.attr("data-lang"),h=e.attr("data-params"),i={},j;e.attr("data-prototypeextra",y.val());e.attr("data-globalextra",x.val());e.attr("data-test0",a("#id_testcode_0").val());try{i=JSON.parse(h)}catch(a){}d=d.toLowerCase();if("none"===d){d=""}if("id_templateparams"==c||"id_uiparameters"==c){f=""}else{f=A.prop("value");if("id_template"!==c&&B.prop("value")){f=n(B.prop("value"))}}j=e.data("current-ui-wrapper");if(j&&j.uiname===d&&g==f){return}e.attr("data-lang",f);if(!j){j=new b.InterfaceWrapper(d,c)}else{i.lang=f;j.loadUi(d,i)}}function f(){var a=S.val(),b=!0;if("html"===a&&""!==T.val().trim()){try{var c=JSON.parse(T.val());if(!1===c.enable_in_editor){b=!1}}catch(a){alert("Invalid UI parameters.")}}if(b){e("id_answer",a);e("id_answerpreload",a)}}function g(a){var b=a?"block":"none";G.css("display",b);H.css("display",b);if(a&&z.prop("checked")){e("id_template","ace")}}function h(b){var c=["id_template","id_uiparameters"],d,e;if(z.prop("checked")){for(var f=0;f<c.length;f++){e=a(document.getElementById(c[f]));d=e.data("current-ui-wrapper");if(d&&b){d.restart()}else if(d&&!b){d.stop()}}}}function i(){var a=D.prop("checked");E.prop("disabled",!a);F.prop("disabled",!a)}function j(b,e){var f,j,k;h(!1);for(var m in d){f=d[m];j=e[m]?e[m]:f[2];if(3<f.length){k=f[3];j=k(j)}a(f[0]).prop(f[1],j)}L.prop("value",b);C.prop("checked",!1);c.get_string("coderunner_question_type","qtype_coderunner").then(function(a){O.html(l(b,a,e.questiontext))});g(!1);i()}function k(a,b){m("prototype_load_failure",b);c.get_string("prototype_error","qtype_coderunner").then(function(c){var d=c+"\n";d+=b+"\n";d+="CourseId: "+N+", qtype: "+a;v.prop("value",d)})}function l(a,b,c){var d="<p class=\"question-type-details-header\">";d+=b;d+=a+"</p>\n"+c;return d}function m(a,b){c.get_string(a,"qtype_coderunner").then(function(a){var c=a.replace(/\n/g," ");if(b){c+="\n"+b}alert(c)})}function n(a){var b,c;if(0>a.indexOf(",")){return a}else{b=a.split(",");for(c=0;c<b.length;c++){if(b[c].endsWith("*")){return b[c].substr(0,b[c].length-1)}}return 0<b.length?b[0]:""}}function o(){var b=u.children("option:selected").text();if(""!==b&&"Undefined"!==b){u.children("option:first-child").prop("disabled","disabled");a.getJSON(M.cfg.wwwroot+"/question/type/coderunner/ajax.php",{qtype:b,courseid:N,sesskey:M.cfg.sesskey},function(a){if(a.success){j(b,a);f()}else{k(b,a.error)}}).fail(function(){m("error_loading_prototype");v.prop("value","*** AJAX ERROR. DON'T SAVE THIS! ***");c.get_string("ajax_error","qtype_coderunner").then(function(a){v.prop("value",a)})})}}function p(a){var b="<div class=\"uiparamtablediv\"><table class=\"uiparamtable\">\n",c=a.columnheaders,d,e;b+="<tr><th>"+c[0]+"</th><th>"+c[1]+"</th><th>"+c[2]+"</th></tr>\n";for(e=0;e<a.uiparamstable.length;e++){d=a.uiparamstable[e];b+="<tr><td>"+d[0]+"</td><td>"+d[1]+"</td><td>"+d[2]+"</td></tr>\n"}b+="</table></div>\n";return b}function q(){var b=S.children("option:selected").text();a.getJSON(M.cfg.wwwroot+"/question/type/coderunner/ajax.php",{uiplugin:b,courseid:N,sesskey:M.cfg.sesskey},function(b){var c=T.val(),d=a(".ui_parameters_descr"),f=a("<button type=\"button\" class=\"toggleuidetails\">"+b.showdetails+"</button>"),g;d.empty();d.append(b.header);if(0==b.uiparamstable.length&&""===c.trim()){T.val("");a("#fgroup_id_uiparametergroup").hide()}else{if(0!=b.uiparamstable.length){d.append(f);g=a(p(b));d.append(g);g.hide();f.click(function(){if(f.html()==b.showdetails){g.show();f.html(b.hidedetails)}else{g.hide();f.html(b.showdetails)}})}a("#fgroup_id_uiparametergroup").show();if(z.prop("checked")){e("id_uiparameters","ace")}}}).fail(function(){m("error_loading_ui_descr")})}function r(){if("3"===P.val()){Q.show()}else{Q.hide()}}function s(){if("ace"===S.val()){f()}}function t(){if(z.prop("checked")){e("id_template","ace")}}if(1==J.prop("value")){c.get_string("proceed_at_own_risk","qtype_coderunner").then(function(a){alert(a)});J.prop("disabled",!0);u.prop("disabled",!0);C.prop("disabled",!0)}(function(){var b=R.prop("value"),c=null;if(""!==b){c=a("<p>"+R.prop("value")+"</p>");a("#id_qtype_coderunner_error_div").append(c)}})();g(I);if(!I){o()}else{f();c.get_string("info_unavailable","qtype_coderunner").then(function(a){O.html("<p>"+a+"</p>")})}r();if(z.prop("checked")){e("id_templateparams","ace");e("id_uiparameters","ace")}q();C.on("change",function(){var a=C.prop("checked");if(a){g(!0)}else{c.get_string("confirm_proceed","qtype_coderunner").then(function(a){if(window.confirm(a)){g(!1)}else{C.prop("checked",!0)}})}});B.on("change",s);A.on("change",function(){t();s()});u.on("change",function(){if(C.prop("checked")){c.get_string("question_type_changed","qtype_coderunner").then(function(a){if(window.confirm(a)){o()}})}else{o()}});z.on("change",function(){var a=z.prop("checked");if(a){e("id_template","ace");e("id_templateparams","ace");e("id_uiparameters","ace")}else{e("id_template","");e("id_templateparams","");e("id_uiparameters","")}});w.on("change",function(){if(w.is(":checked")){m("templateparamsusingsandbox")}});S.on("change",function(){f();q()});P.on("change",r);var U=new MutationObserver(function(){f()});U.observe(K.get(0),{attributes:!0});a("button.replaceexpectedwithgot").click(function(){var b=a(this).prev("pre[id^=\"id_got_\"]"),c=b.attr("id").replace("id_got_","");a("#id_expected_"+c).val(b.text());a("#id_fail_expected_"+c).html(b.text());a(".failrow_"+c).addClass("fixed");a(this).prop("disabled",!0)})}}});
define ("qtype_coderunner/multilanguagequestion",["jquery"],function(a){function b(b){var c=a(document.getElementById(b)),d=a(".coderunner-lang-select");d.on("change",function(){var a=d.val(),b=c.data("current-ui-wrapper");if(b&&b.uiInstance&&"function"==typeof b.uiInstance.setLanguage){b.uiInstance.setLanguage(a)}})}return{initLangSelector:function(c){a().ready(function(){b(c)})}}});
define ("qtype_coderunner/resetbutton",["jquery"],function(a){return{initResetButton:function(b,c,d){var e=a("[id=\""+b+"\"]"),f=a("[id=\""+c+"\"]"),g;e.on("click",function(){if(window.behattesting||window.confirm(d)){var a=e.attr("data-reload-text");g=f.data("current-ui-wrapper");if(g&&g.uiInstance){g.stop();f.val(a);g.restart()}else{f.val(a)}}})}}});
define ("qtype_coderunner/ui_graph",["jquery","qtype_coderunner/graphutil","qtype_coderunner/graphelements"],function(a,b,c){function d(b,c,d,e){this.HANDLE_SIZE=10;this.parent=b;this.canvas=a(document.createElement("canvas"));this.canvas.attr({id:c,class:"coderunner_graphcanvas",tabindex:1});this.canvas.css({"background-color":"white"});this.canvas.on("mousedown",function(a){return b.mousedown(a)});this.canvas.on("mouseup",function(a){return b.mouseup(a)});this.canvas.on("dblclick",function(a){return b.dblclick(a)});this.canvas.on("keydown",function(a){return b.keydown(a)});this.canvas.on("mousemove",function(a){return b.mousemove(a)});this.canvas.on("keypress",function(a){return b.keypress(a)});this.resize=function(a,b){this.canvas.attr("width",a);this.canvas.attr("height",b)};this.resize(d,e)}function e(b,e,f,g){var h=this;this.SNAP_TO_PADDING=6;this.DUPLICATE_LINK_OFFSET=16;this.HIT_TARGET_PADDING=6;this.DEFAULT_NODE_RADIUS=26;this.DEFAULT_FONT_SIZE=20;this.DEFAULT_TEXT_OFFSET=5;this.DEFAULT_LINK_LABEL_REL_DIST=.5;this.MAX_VERSIONS=30;this.canvasId="graphcanvas_"+b;this.textArea=a(document.getElementById(b));this.helpText="";this.readOnly=this.textArea.prop("readonly");this.uiParams=g;this.graphCanvas=new d(this,this.canvasId,e,f);this.caretVisible=!0;this.caretTimer=0;this.originalClick=null;this.nodes=[];this.links=[];this.selectedObject=null;this.currentLink=null;this.movingObject=!1;this.fail=!1;this.failString=null;this.versions=[];this.versionIndex=-1;this.helpBox=new c.HelpBox(this,0,0);this.clearButton=new c.Button(this,60,0,"Clear");this.clearButton.onClick=function(){if(confirm("Are you sure you want to clear the diagram?")){this.parent.clear()}};this.buttons=[this.helpBox,this.clearButton];if("locknodes"in g){g.locknodepositions=g.locknodes}if("lockedges"in g){g.lockedgepositions=g.lockedges}if("helpmenutext"in g){this.helpText=g.helpmenutext}else{require(["core/str"],function(b){var c=b.get_string("graphhelp","qtype_coderunner");a.when(c).done(function(a){h.helpText=a})})}this.reload();if(!this.fail){this.draw()}}e.prototype.failed=function(){return this.fail};e.prototype.failMessage=function(){return this.failString};e.prototype.getElement=function(){return this.getCanvas()};e.prototype.hasFocus=function(){return document.activeElement==this.getCanvas()};e.prototype.getCanvas=function(){var a=this.graphCanvas.canvas[0];return a};e.prototype.nodeRadius=function(){return this.uiParams.noderadius?this.uiParams.noderadius:this.DEFAULT_NODE_RADIUS};e.prototype.fontSize=function(){return this.uiParams.fontsize?this.uiParams.fontsize:this.DEFAULT_FONT_SIZE};e.prototype.isFsm=function(){return this.uiParams.isfsm!==void 0?this.uiParams.isfsm:!0};e.prototype.textOffset=function(){return this.uiParams.textoffset?this.uiParams.textoffset:this.DEFAULT_TEXT_OFFSET};e.prototype.arrowIfReqd=function(a,c,d,e){if(this.uiParams.isdirected===void 0||this.uiParams.isdirected){b.drawArrow(a,c,d,e)}};e.prototype.sync=function(){};e.prototype.syncIntervalSecs=function(){return 0};e.prototype.keypress=function(a){var c=b.crossBrowserKey(a);if(this.readOnly){return}if(32<=c&&126>=c&&!a.metaKey&&!a.altKey&&!a.ctrlKey&&37!==c&&39!==c&&null!==this.selectedObject&&this.canEditText()){if(this.selectedObject.justMoved){this.saveVersion()}this.selectedObject.justMoved=!1;this.selectedObject.textBox.insertChar(String.fromCharCode(c));this.resetCaret();this.draw();return!1}else if(8===c||32===c||9===c){return!1}};e.prototype.mousedown=function(a){var d=b.crossBrowserRelativeMousePos(a);if(this.readOnly){return}this.selectedObject=this.selectObject(d.x,d.y);this.movingObject=!1;this.movingGraph=!1;this.movingText=!1;this.originalClick=d;this.saveVersion();if(this.selectedObject!==this.helpBox){this.helpBox.helpOpen=!1}if(null!==this.selectedObject){if(this.selectedObject instanceof c.Button){this.selectedObject.onClick()}else if(a.shiftKey&&this.selectedObject instanceof c.Node){if(!this.uiParams.lockedgeset){this.currentLink=new c.SelfLink(this,this.selectedObject,d)}}else if(a.altKey&&this.selectedObject instanceof c.Node){if(!this.uiParams.locknodepositions){this.movingGraph=!0;this.movingNodes=this.selectedObject.traverseGraph(this.links,[]);for(var e=0;e<this.movingNodes.length;e++){this.movingNodes[e].setMouseStart(d.x,d.y)}}}else if(this.selectedObject instanceof c.TextBox){if(!this.uiParams.lockedgelabels){this.movingText=!0;this.selectedObject.setMouseStart(d.x,d.y);this.selectedObject=this.selectedObject.parent}}else if(!(this.uiParams.locknodepositions&&this.selectedObject instanceof c.Node)&&!(this.uiParams.lockedgepositions&&this.selectedObject instanceof c.Link)){this.movingObject=!0;if(this.selectedObject.setMouseStart){this.selectedObject.setMouseStart(d.x,d.y)}}this.selectedObject.justMoved=!0;this.resetCaret()}else if(a.shiftKey&&this.isFsm()){this.currentLink=new c.TemporaryLink(this,d,d)}this.draw();if(this.hasFocus()){return!1}else{this.resetCaret();return!0}};e.prototype.canEditText=function(){var a=this.selectedObject instanceof c.Node,b=this.selectedObject instanceof c.Link||this.selectedObject instanceof c.SelfLink;return"textBox"in this.selectedObject&&(a&&!this.uiParams.locknodelabels||b&&!this.uiParams.lockedgelabels)};e.prototype.keydown=function(a){var c=b.crossBrowserKey(a),d,e=!1;if(this.readOnly){return}if(8===c){if(null!==this.selectedObject&&this.canEditText()){this.selectedObject.textBox.deleteChar();this.resetCaret();this.draw()}return!1}else if(46===c&&null!==this.selectedObject){this.saveVersion();for(d=0;d<this.nodes.length;d++){if(this.nodes[d]===this.selectedObject&&!this.uiParams.locknodeset){this.nodes.splice(d--,1);e=!0}}for(d=0;d<this.links.length;d++){if(this.links[d]===this.selectedObject&&!this.uiParams.lockedgeset||e&&(this.links[d].node===this.selectedObject||this.links[d].nodeA===this.selectedObject||this.links[d].nodeB===this.selectedObject)){this.links.splice(d--,1)}}this.selectedObject=null;this.draw()}else if(13===c){if(null!==this.selectedObject){this.selectedObject=null;this.draw()}}else if(37===c){if(null!==this.selectedObject&&this.canEditText()){this.selectedObject.textBox.caretLeft();this.resetCaret();this.draw()}}else if(39===c){if(null!==this.selectedObject&&this.canEditText()){this.selectedObject.textBox.caretRight();this.resetCaret();this.draw()}}else if(90==a.keyCode&&a.ctrlKey&&a.shiftKey||89==a.keyCode&&a.ctrlKey){this.redo()}else if(90==a.keyCode&&a.ctrlKey){this.undo()}};e.prototype.dblclick=function(a){var d=b.crossBrowserRelativeMousePos(a);if(this.readOnly||this.uiParams.locknodeset){return}this.selectedObject=this.selectObject(d.x,d.y);this.saveVersion();if(null===this.selectedObject){this.selectedObject=new c.Node(this,d.x,d.y);this.nodes.push(this.selectedObject);this.selectedObject.justMoved=!0;this.resetCaret();this.draw()}else{if(this.selectedObject instanceof c.Node&&this.isFsm()){this.selectedObject.isAcceptState=!this.selectedObject.isAcceptState;this.draw()}}};e.prototype.resize=function(a,b){this.graphCanvas.resize(a,b);this.draw()};e.prototype.mousemove=function(a){var d=b.crossBrowserRelativeMousePos(a),e;if(this.readOnly){return}for(h=0;h<this.buttons.length;h++){if(this.buttons[h].containsPoint(d.x,d.y)){this.buttons[h].highLighted=!0}else{this.buttons[h].highLighted=!1}this.draw()}if(null!==this.currentLink){var f=this.selectObject(d.x,d.y);if(!(f instanceof c.Node)){f=null}if(null===this.selectedObject){if(null!==f){this.currentLink=new c.StartLink(this,f,this.originalClick)}else{this.currentLink=new c.TemporaryLink(this,this.originalClick,d)}}else{if(f===this.selectedObject){this.currentLink=new c.SelfLink(this,this.selectedObject,d)}else if(null!==f){this.currentLink=new c.Link(this,this.selectedObject,f)}else{e=this.selectedObject.closestPointOnCircle(d.x,d.y);this.currentLink=new c.TemporaryLink(this,e,d)}}this.draw()}if(this.movingGraph){for(var g=this.movingNodes,h=0;h<g.length;h++){g[h].trackMouse(d.x,d.y);this.snapNode(g[h])}this.draw()}else if(this.movingText){this.selectedObject.textBox.setAnchorPoint(d.x,d.y);this.draw()}else if(this.movingObject){this.selectedObject.setAnchorPoint(d.x,d.y);if(this.selectedObject instanceof c.Node){this.snapNode(this.selectedObject)}this.draw()}};e.prototype.mouseup=function(){if(this.readOnly){return}this.movingObject=!1;this.movingGraph=!1;this.movingText=!1;if(null!==this.currentLink){if(!(this.currentLink instanceof c.TemporaryLink)){this.selectedObject=this.currentLink;this.addLink(this.currentLink);this.resetCaret()}this.currentLink=null;this.draw()}};e.prototype.selectObject=function(a,b){for(c=0;c<this.buttons.length;c++){if(this.buttons[c].containsPoint(a,b)){return this.buttons[c]}}var c;for(c=0;c<this.nodes.length;c++){if(this.nodes[c].containsPoint(a,b)){return this.nodes[c]}}for(c=0;c<this.links.length;c++){if(this.links[c].containsPoint(a,b)){return this.links[c]}else if("textBox"in this.links[c]&&this.links[c].textBox.containsPoint(a,b)){return this.links[c].textBox}}return null};e.prototype.snapNode=function(a){for(var b=0;b<this.nodes.length;b++){if(this.nodes[b]===a){continue}if(Math.abs(a.x-this.nodes[b].x)<this.SNAP_TO_PADDING){a.x=this.nodes[b].x}if(Math.abs(a.y-this.nodes[b].y)<this.SNAP_TO_PADDING){a.y=this.nodes[b].y}}};e.prototype.addLink=function(a){for(var b=null,c=0,d;c<this.links.length;c++){d=this.links[c];if(d.nodeA===a.nodeA&&d.nodeB===a.nodeB){if(null===b||d.perpendicularPart>b){b=d.perpendicularPart}}if(d.nodeA===a.nodeB&&d.nodeB===a.nodeA){if(null===b||-d.perpendicularPart>b){b=-d.perpendicularPart}}}if(null!==b){a.perpendicularPart=b+this.DUPLICATE_LINK_OFFSET}this.links.push(a)};e.prototype.reload=function(){var b=a(this.textArea).val();if(b){try{var d=JSON.parse(b),e;for(e=0;e<d.nodes.length;e++){var f=d.nodes[e],g=d.nodeGeometry[e],h=new c.Node(this,g[0],g[1]);h.isAcceptState=f[1];h.textBox=new c.TextBox(f[0].toString(),h);this.nodes.push(h)}for(e=0;e<d.edges.length;e++){var j=d.edges[e],k=d.edgeGeometry[e],l=null;if(j[0]===j[1]){l=new c.SelfLink(this,this.nodes[j[0]]);l.anchorAngle=k.anchorAngle;l.textBox=new c.TextBox(j[2].toString(),l);if(3<j.length){l.textBox.setAnchorPoint(j[3].x,j[3].y)}}else if(-1===j[0]){l=new c.StartLink(this,this.nodes[j[1]]);l.deltaX=k.deltaX;l.deltaY=k.deltaY}else{l=new c.Link(this,this.nodes[j[0]],this.nodes[j[1]]);l.parallelPart=k.parallelPart;l.perpendicularPart=k.perpendicularPart;l.lineAngleAdjust=k.lineAngleAdjust;l.textBox=new c.TextBox(j[2].toString(),l);if(3<j.length){l.textBox.setAnchorPoint(j[3].x,j[3].y)}}if(null!==l){this.links.push(l)}}}catch(a){this.fail=!0;this.failString="graph_ui_invalidserialisation"}}};e.prototype.save=function(){var a={edgeGeometry:[],nodeGeometry:[],nodes:[],edges:[]},b;if(!JSON||""===this.textArea.val().trim()&&0===this.nodes.length){return}for(b=0;b<this.nodes.length;b++){var d=this.nodes[b],e=[d.textBox.text,d.isAcceptState],f=[d.x,d.y];a.nodeGeometry.push(f);a.nodes.push(e)}for(b=0;b<this.links.length;b++){var g=this.links[b],h=null,j=null;if(g instanceof c.SelfLink){j={anchorAngle:g.anchorAngle};h=[this.nodes.indexOf(g.node),this.nodes.indexOf(g.node),g.textBox.text];if(g.textBox.dragged){h.push(g.textBox.position)}}else if(g instanceof c.StartLink){j={deltaX:g.deltaX,deltaY:g.deltaY};h=[-1,this.nodes.indexOf(g.node),""]}else if(g instanceof c.Link){j={lineAngleAdjust:g.lineAngleAdjust,parallelPart:g.parallelPart,perpendicularPart:g.perpendicularPart};h=[this.nodes.indexOf(g.nodeA),this.nodes.indexOf(g.nodeB),g.textBox.text];if(g.textBox.dragged){h.push(g.textBox.position)}}if(null!==h&&null!==j){a.edges.push(h);a.edgeGeometry.push(j)}}this.textArea.val(JSON.stringify(a))};e.prototype.saveVersion=function(){var a=this.textArea.val();if(0==this.versions.length||0!=a.localeCompare(this.versions[this.versionIndex])){this.versionIndex++;while(this.versionIndex<this.versions.length){this.versions.pop()}this.versions.push(a);if(this.versions.length>this.MAX_VERSIONS){this.versions.shift();this.versionIndex--}}};e.prototype.undo=function(){this.saveVersion();if(0<this.versionIndex){this.versionIndex--;this.textArea.val(this.versions[this.versionIndex]);this.nodes=[];this.links=[];this.reload();this.draw()}};e.prototype.redo=function(){if(this.versionIndex<this.versions.length-1){this.versionIndex++;this.textArea.val(this.versions[this.versionIndex]);this.nodes=[];this.links=[];this.reload();this.draw()}};e.prototype.clear=function(){this.saveVersion();this.nodes=[];this.links=[];this.save();this.draw()};e.prototype.destroy=function(){clearInterval(this.caretTimer);this.graphCanvas.canvas.off();this.graphCanvas.canvas.remove()};e.prototype.resetCaret=function(){var a=this;clearInterval(this.caretTimer);this.caretTimer=setInterval(function(){a.caretVisible=!a.caretVisible;a.draw()},500);this.caretVisible=!0};e.prototype.draw=function(){var a=this.getCanvas(),b=a.getContext("2d"),c;b.clearRect(0,0,this.getCanvas().width,this.getCanvas().height);b.save();b.translate(.5,.5);for(c=0;c<this.buttons.length;c++){this.buttons[c].draw(b)}if(!this.helpBox.helpOpen){for(c=0;c<this.nodes.length;c++){b.lineWidth=1;b.fillStyle=b.strokeStyle=this.nodes[c]===this.selectedObject?"blue":"black";this.nodes[c].draw(b)}for(c=0;c<this.links.length;c++){b.lineWidth=1;b.fillStyle=b.strokeStyle=this.links[c]===this.selectedObject||this.links[c].textBox===this.selectedObject?"blue":"black";this.links[c].draw(b)}if(null!==this.currentLink){b.lineWidth=1;b.fillStyle=b.strokeStyle="black";this.currentLink.draw(b)}}b.restore();this.save()};return{Constructor:e}});
define ("qtype_coderunner/graphelements",["qtype_coderunner/graphutil"],function(a){function b(a,b,c){this.parent=a;this.x=b;this.y=c;this.mouseOffsetX=0;this.mouseOffsetY=0;this.isAcceptState=!1;this.textBox=new i("",this);this.caretPosition=0}b.prototype.setMouseStart=function(a,b){this.mouseOffsetX=this.x-a;this.mouseOffsetY=this.y-b};b.prototype.setAnchorPoint=function(a,b){this.x=a+this.mouseOffsetX;this.y=b+this.mouseOffsetY};b.prototype.trackMouse=function(a,b){this.x=this.mouseOffsetX+a;this.y=this.mouseOffsetY+b};b.prototype.draw=function(a){a.beginPath();a.arc(this.x,this.y,this.parent.nodeRadius(),0,2*Math.PI,!1);a.stroke();this.textBox.draw(this.x,this.y,null,this);if(this.isAcceptState){a.beginPath();a.arc(this.x,this.y,this.parent.nodeRadius()-6,0,2*Math.PI,!1);a.stroke()}};b.prototype.closestPointOnCircle=function(a,b){var c=a-this.x,d=b-this.y,e=Math.sqrt(c*c+d*d);return{x:this.x+c*this.parent.nodeRadius()/e,y:this.y+d*this.parent.nodeRadius()/e}};b.prototype.containsPoint=function(a,b){return(a-this.x)*(a-this.x)+(b-this.y)*(b-this.y)<this.parent.nodeRadius()*this.parent.nodeRadius()};b.prototype.neighbours=function(a){for(var b=[],d,e=0;e<a.length;e++){d=a[e];if(d instanceof c){if(d.nodeA===this&&!b.includes(d.nodeB)){b.push(d.nodeB)}else if(d.nodeB===this&&!b.includes(d.nodeA)){b.push(d.nodeA)}}}return b};b.prototype.traverseGraph=function(a,b){var c,d;if(!b.includes(this)){b.push(this);c=this.neighbours(a);for(var e=0;e<c.length;e++){d=c[e];if(!b.includes(d)){d.traverseGraph(a,b)}}}return b};function c(c,d,a){this.parent=c;this.nodeA=d;this.nodeB=a;this.textBox=new i("",this);this.lineAngleAdjust=0;this.caretPosition=0;this.parallelPart=.5;this.perpendicularPart=0}c.prototype.getAnchorPoint=function(){var a=this.nodeB.x-this.nodeA.x,b=this.nodeB.y-this.nodeA.y,c=Math.sqrt(a*a+b*b);return{x:this.nodeA.x+a*this.parallelPart-b*this.perpendicularPart/c,y:this.nodeA.y+b*this.parallelPart+a*this.perpendicularPart/c}};c.prototype.setAnchorPoint=function(a,b){var c=this.nodeB.x-this.nodeA.x,d=this.nodeB.y-this.nodeA.y,e=Math.sqrt(c*c+d*d);this.parallelPart=(c*(a-this.nodeA.x)+d*(b-this.nodeA.y))/(e*e);this.perpendicularPart=(c*(b-this.nodeA.y)-d*(a-this.nodeA.x))/e;if(0<this.parallelPart&&1>this.parallelPart&&Math.abs(this.perpendicularPart)<this.parent.SNAP_TO_PADDING){this.lineAngleAdjust=(0>this.perpendicularPart)*Math.PI;this.perpendicularPart=0}};c.prototype.getEndPointsAndCircle=function(){if(0===this.perpendicularPart){var b=(this.nodeA.x+this.nodeB.x)/2,c=(this.nodeA.y+this.nodeB.y)/2,d=this.nodeA.closestPointOnCircle(b,c),e=this.nodeB.closestPointOnCircle(b,c);return{hasCircle:!1,startX:d.x,startY:d.y,endX:e.x,endY:e.y}}var f=this.getAnchorPoint(),g=a.circleFromThreePoints(this.nodeA.x,this.nodeA.y,this.nodeB.x,this.nodeB.y,f.x,f.y),h=0<this.perpendicularPart,i=h?1:-1,j=i*this.parent.nodeRadius()/g.radius,k=Math.atan2(this.nodeA.y-g.y,this.nodeA.x-g.x)-j,l=Math.atan2(this.nodeB.y-g.y,this.nodeB.x-g.x)+j,m=g.x+g.radius*Math.cos(k),n=g.y+g.radius*Math.sin(k),o=g.x+g.radius*Math.cos(l),p=g.y+g.radius*Math.sin(l);return{hasCircle:!0,startX:m,startY:n,endX:o,endY:p,startAngle:k,endAngle:l,circleX:g.x,circleY:g.y,circleRadius:g.radius,reverseScale:i,isReversed:h}};c.prototype.draw=function(a){var b=this.getEndPointsAndCircle(),c,d,e,f;a.beginPath();if(b.hasCircle){a.arc(b.circleX,b.circleY,b.circleRadius,b.startAngle,b.endAngle,b.isReversed)}else{a.moveTo(b.startX,b.startY);a.lineTo(b.endX,b.endY)}a.stroke();if(b.hasCircle){this.parent.arrowIfReqd(a,b.endX,b.endY,b.endAngle-b.reverseScale*(Math.PI/2))}else{this.parent.arrowIfReqd(a,b.endX,b.endY,Math.atan2(b.endY-b.startY,b.endX-b.startX))}f=this.textBox.relDist;if(b.hasCircle){var g=b.startAngle,h=b.endAngle;if(h<g){h+=2*Math.PI}e=(1-f)*g+f*h;if(b.isReversed){e+=(1-f)*(2*Math.PI)}c=b.circleX+b.circleRadius*Math.cos(e);d=b.circleY+b.circleRadius*Math.sin(e);this.textBox.draw(c,d,e,this)}else{c=(1-f)*b.startX+f*b.endX;d=(1-f)*b.startY+f*b.endY;e=Math.atan2(b.endX-b.startX,b.startY-b.endY);this.textBox.draw(c,d,e+this.lineAngleAdjust,this)}};c.prototype.containsPoint=function(a,b){var c=this.getEndPointsAndCircle(),d,e,f;if(c.hasCircle){d=a-c.circleX;e=b-c.circleY;f=Math.sqrt(d*d+e*e)-c.circleRadius;if(Math.abs(f)<this.parent.HIT_TARGET_PADDING){var g=Math.atan2(e,d),h=c.startAngle,i=c.endAngle;if(c.isReversed){var j=h;h=i;i=j}if(i<h){i+=2*Math.PI}if(g<h){g+=2*Math.PI}else if(g>i){g-=2*Math.PI}return g>h&&g<i}}else{d=c.endX-c.startX;e=c.endY-c.startY;var k=Math.sqrt(d*d+e*e),l=(d*(a-c.startX)+e*(b-c.startY))/(k*k);f=(d*(b-c.startY)-e*(a-c.startX))/k;return 0<l&&1>l&&Math.abs(f)<this.parent.HIT_TARGET_PADDING}return!1};function d(a,b,c){this.parent=a;this.node=b;this.anchorAngle=0;this.mouseOffsetAngle=0;this.textBox=new i("",this);if(c){this.setAnchorPoint(c.x,c.y)}}d.prototype.setMouseStart=function(a,b){this.mouseStartX=a;this.mouseStartY=b};d.prototype.setAnchorPoint=function(a,b){this.anchorAngle=Math.atan2(b-this.node.y,a-this.node.x)+this.mouseOffsetAngle;var c=Math.round(this.anchorAngle/(Math.PI/2))*(Math.PI/2);if(.1>Math.abs(this.anchorAngle-c)){this.anchorAngle=c}if(this.anchorAngle<-Math.PI){this.anchorAngle+=2*Math.PI}if(this.anchorAngle>Math.PI){this.anchorAngle-=2*Math.PI}};d.prototype.getEndPointsAndCircle=function(){var a=this.node.x+1.5*this.parent.nodeRadius()*Math.cos(this.anchorAngle),b=this.node.y+1.5*this.parent.nodeRadius()*Math.sin(this.anchorAngle),c=.75*this.parent.nodeRadius(),d=this.anchorAngle-.8*Math.PI,e=this.anchorAngle+.8*Math.PI,f=a+c*Math.cos(d),g=b+c*Math.sin(d),h=a+c*Math.cos(e),i=b+c*Math.sin(e);return{hasCircle:!0,startX:f,startY:g,endX:h,endY:i,startAngle:d,endAngle:e,circleX:a,circleY:b,circleRadius:c}};d.prototype.draw=function(a){var b=this.getEndPointsAndCircle();a.beginPath();a.arc(b.circleX,b.circleY,b.circleRadius,b.startAngle,b.endAngle,!1);a.stroke();var c=this.textBox.relDist,d=b.startAngle*(1-c)+b.endAngle*c,e=b.circleX+b.circleRadius*Math.cos(d),f=b.circleY+b.circleRadius*Math.sin(d);this.textBox.draw(e,f,d,this);this.parent.arrowIfReqd(a,b.endX,b.endY,b.endAngle+.4*Math.PI)};d.prototype.containsPoint=function(a,b){var c=this.getEndPointsAndCircle(),d=a-c.circleX,e=b-c.circleY,f=Math.sqrt(d*d+e*e)-c.circleRadius;return Math.abs(f)<this.parent.HIT_TARGET_PADDING};function e(a,b,c){this.parent=a;this.node=b;this.deltaX=0;this.deltaY=0;if(c){this.setAnchorPoint(c.x,c.y)}}e.prototype.setAnchorPoint=function(a,b){this.deltaX=a-this.node.x;this.deltaY=b-this.node.y;if(Math.abs(this.deltaX)<this.parent.SNAP_TO_PADDING){this.deltaX=0}if(Math.abs(this.deltaY)<this.parent.SNAP_TO_PADDING){this.deltaY=0}};e.prototype.getEndPoints=function(){var a=this.node.x+this.deltaX,b=this.node.y+this.deltaY,c=this.node.closestPointOnCircle(a,b);return{startX:a,startY:b,endX:c.x,endY:c.y}};e.prototype.draw=function(a){var b=this.getEndPoints();a.beginPath();a.moveTo(b.startX,b.startY);a.lineTo(b.endX,b.endY);a.stroke();this.parent.arrowIfReqd(a,b.endX,b.endY,Math.atan2(-this.deltaY,-this.deltaX))};e.prototype.containsPoint=function(a,b){var c=this.getEndPoints(),d=c.endX-c.startX,e=c.endY-c.startY,f=Math.sqrt(d*d+e*e),g=(d*(a-c.startX)+e*(b-c.startY))/(f*f),h=(d*(b-c.startY)-e*(a-c.startX))/f;return 0<g&&1>g&&Math.abs(h)<this.parent.HIT_TARGET_PADDING};function f(a,b,c){this.parent=a;this.from=b;this.to=c}f.prototype.draw=function(a){a.beginPath();a.moveTo(this.to.x,this.to.y);a.lineTo(this.from.x,this.from.y);a.stroke();this.parent.arrowIfReqd(a,this.to.x,this.to.y,Math.atan2(this.to.y-this.from.y,this.to.x-this.from.x))};function g(a,b,c,d){this.BUTTON_WIDTH=60;this.BUTTON_HEIGHT=25;this.TEXT_OFFSET_X=30;this.TEXT_OFFSET_Y=17;this.topX=b;this.topY=c;this.parent=a;this.text=d;this.highLighted=!1}g.prototype.containsPoint=function(b,c){return a.isInside({x:b,y:c},{x:this.topX,y:this.topY,width:this.BUTTON_WIDTH,height:this.BUTTON_HEIGHT})};g.prototype.draw=function(a){if(this.highLighted){a.fillStyle="#FFFFFF"}else{a.fillStyle="#F0F0F0"}a.fillRect(this.topX,this.topY,this.BUTTON_WIDTH,this.BUTTON_HEIGHT);a.lineWidth=.5;a.strokeStyle="#000000";a.strokeRect(this.topX,this.topY,this.BUTTON_WIDTH,this.BUTTON_HEIGHT);a.font="12pt Arial";a.fillStyle="#000000";a.textAlign="center";a.fillText(this.text,this.topX+this.TEXT_OFFSET_X,this.topY+this.TEXT_OFFSET_Y);a.textAlign="left"};g.prototype.onClick=function(){};function h(a,b,c){g.call(this,a,b,c,"Help");this.helpOpen=!1;this.LINE_HEIGHT=18;this.HELP_INDENT=5}h.prototype=new g;h.prototype.draw=function(a){var b,c,d,e;g.prototype.draw.call(this,a);if(this.helpOpen){e=this.parent.helpText;a.font="12pt Arial";b=e.split("\n");d=this.topY+this.BUTTON_HEIGHT;for(c=0;c<b.length;c+=1){d+=this.LINE_HEIGHT;a.fillText(b[c],this.topX+this.HELP_INDENT,d)}}};h.prototype.onClick=function(){this.helpOpen=!this.helpOpen;this.parent.draw()};function i(a,b){this.text=a;this.parent=b;this.caretPosition=a.length;this.relDist=.5;this.offset=b.parent.textOffset();this.dragged=!1;this.boundingBox={}}i.prototype.insertChar=function(a){this.text=this.text.slice(0,this.caretPosition)+a+this.text.slice(this.caretPosition);this.caretRight()};i.prototype.deleteChar=function(){if(0<this.caretPosition){this.text=this.text.slice(0,this.caretPosition-1)+this.text.slice(this.caretPosition);this.caretLeft()}};i.prototype.caretLeft=function(){if(0<this.caretPosition){this.caretPosition--}};i.prototype.caretRight=function(){if(this.caretPosition<this.text.length){this.caretPosition++}};i.prototype.containsPoint=function(b,c){return a.isInside({x:b,y:c},this.boundingBox)};i.prototype.setMouseStart=function(a,b){this.mouseOffsetX=this.position.x-a;this.mouseOffsetY=this.position.y-b};i.prototype.setAnchorPoint=function(b,c){b+=this.mouseOffsetX||0;c+=this.mouseOffsetY||0;var d=this.parent.getEndPointsAndCircle(),e,f;if(d.hasCircle){var g=Math.atan2(c-d.circleY,b-d.circleX);if(g<d.startAngle){g+=2*Math.PI}if(d.endAngle<d.startAngle){d.endAngle+=2*Math.PI}if(d.isReversed){e=(g-d.startAngle-2*Math.PI)/(d.endAngle-d.startAngle-2*Math.PI)}else{e=(g-d.startAngle)/(d.endAngle-d.startAngle)}f=a.vectorMagnitude({x:b-d.circleX,y:c-d.circleY})-d.circleRadius}else{var h={x:b-d.startX,y:c-d.startY},i={x:d.endX-d.startX,y:d.endY-d.startY},j=a.scalarProjection(h,i);e=j/a.vectorMagnitude(i);f=Math.sqrt(Math.pow(a.vectorMagnitude(h),2)-Math.pow(j,2));var k=a.isCCW(h,i),l=0!=this.parent.lineAngleAdjust;if(!k&&l||k&&!l){f*=-1}}if(0<e&&1>e){this.relDist=e;this.offset=Math.round(f);this.dragged=!0}};i.prototype.draw=function(b,d,e,f){var g=f.parent,h=g.getCanvas().getContext("2d");h.font=g.fontSize()+"px Arial";var c=a.convertLatexShortcuts(this.text.slice(0,this.caretPosition)),i=a.convertLatexShortcuts(this.text.slice(this.caretPosition)),j=h.measureText(c+i).width,k=Math.round(g.fontSize()/2);if(null!==e){var l=Math.cos(e),m=Math.sin(e);b+=this.offset*l;d+=this.offset*m;if(!this.dragged){var n=j/2*(0<l?1:-1),o=k/2*(0<m?1:-1),p=m*Math.pow(Math.abs(m),40)*n-l*Math.pow(Math.abs(l),10)*o;b+=n-m*p;d+=o+l*p}this.position={x:Math.round(b),y:Math.round(d)}}b-=j/2;b=Math.round(b);d=Math.round(d);if("advancedFillText"in h){h.advancedFillText(this.text,this.text,b+j/2,d,e)}else{var q=h.fillStyle;h.fillStyle="rgba(255, 255, 255, 0.7)";h.fillRect(b,d-k,j,2*k);h.fillStyle=q;k=Math.round(g.fontSize()/3);h.fillText(c,b,d+k);var r=b+h.measureText(c).width;h.fillText(i,r,d+k);k=Math.round(g.fontSize()/2);if(f==g.selectedObject&&g.caretVisible&&g.hasFocus()&&document.hasFocus()){h.beginPath();h.moveTo(r,d-k);h.lineTo(r,d+k);h.stroke()}}this.boundingBox={x:b,y:d-k,height:2*k,width:j}};return{Node:b,Link:c,SelfLink:d,TemporaryLink:f,StartLink:e,Button:g,HelpBox:h,TextBox:i}});
define ("qtype_coderunner/ui_table",["jquery"],function(a){function b(b,c,d,e){this.textArea=a(document.getElementById(b));this.readOnly=this.textArea.prop("readonly");this.tableDiv=null;this.uiParams=e;if(!e.num_columns||!e.num_rows){this.fail=!0;this.failString="table_ui_missingparams";return}this.fail=!1;this.lockedCells=e.locked_cells||[];this.hasHeader=e.column_headers&&0<e.column_headers.length?!0:!1;this.hasRowLabels=e.row_labels&&0<e.row_labels.length?!0:!1;this.numDataColumns=e.num_columns;this.rowsPerCell=e.lines_per_cell||2;this.totNumColumns=this.numDataColumns+(this.hasRowLabels?1:0);this.columnWidths=this.computeColumnWidths();this.reload()}b.prototype.computeColumnWidths=function(){var a=Math.trunc(100/this.totNumColumns),b=[];if(this.uiParams.column_width_percents&&0<this.uiParams.column_width_percents.length){return this.uiParams.column_width_percents}else if(Array.prototype.fill){return Array(this.totNumColumns).fill(a)}else{for(var c=0;c<this.totNumColumns;c++){b.push(a)}return b}};b.prototype.isLockedCell=function(a,b){for(var c=0;c<this.lockedCells.length;c++){if(this.lockedCells[c][0]==a&&this.lockedCells[c][1]==b){return!0}}return!1};b.prototype.getElement=function(){return this.tableDiv};b.prototype.failed=function(){return this.fail};b.prototype.failMessage=function(){return this.failString};b.prototype.sync=function(){var b=[],c=!0,d=a(this.tableDiv).find("table tbody tr");d.each(function(){var d=[];a(this).find("textarea").each(function(){var b=a(this).val();d.push(b);if(b){c=!1}});b.push(d)});if(c){this.textArea.val("")}else{this.textArea.val(JSON.stringify(b))}};b.prototype.tableRow=function(a,b){var c="<tr>",d=0,e;if(this.hasRowLabels){e=this.columnWidths[0];d=1;c+="<th style='padding-top:8px;text-align:center;width:"+e+"%' scope='row'>";if(a<this.uiParams.row_labels.length){c+=this.uiParams.row_labels[a]}c+="</th>"}for(var f=0;f<this.numDataColumns;f++){e=this.columnWidths[d++];c+="<td style='padding:2px;margin:0,width:"+e+"'%>";c+="<textarea rows=\""+this.rowsPerCell+"\"";c+=" style=\"width:100%;padding:0;resize:vertical;font-family: monospace\"";if(this.isLockedCell(a,f)){c+=" disabled>"}else{c+=">"}if(a<b.length){c+=b[a][f]}c+="</textarea>";c+="</td>"}c+="</tr>";return c};b.prototype.tableHeadSection=function(){var a="<thead>\n",b=0;if(this.hasHeader){a+="<tr>";if(this.hasRowLabels){a+="<th style='width:"+this.columnWidths[0]+"%'></th>";b+=1}for(var c=0;c<this.numDataColumns;c++){a+="<th style='width:"+this.columnWidths[b]+"%'>";if(c<this.uiParams.column_headers.length){a+=this.uiParams.column_headers[c]}b++;a+="</th>"}a+="</tr>\n"}a+="</thead>\n";return a};b.prototype.reload=function(){var b=a(this.textArea).val(),c=[],d="<div style='height:fit-content' class='qtype-coderunner-table-outer-div'>\n<table class='table table-bordered qtype-coderunner_table'>\n";if(b){try{c=JSON.parse(b)}catch(a){this.fail=!0;this.failString="table_ui_invalidjson";return}}try{d+=this.tableHeadSection();d+="<tbody>\n";for(var e=Math.max(this.uiParams.num_rows,c.length),f=0;f<e;f++){d+=this.tableRow(f,c)}d+="</tbody>\n</table>\n</div>";this.tableDiv=a(d);if(this.uiParams.dynamic_rows){this.addButtons()}}catch(a){this.fail=!0;this.failString="table_ui_invalidserialisation"}};b.prototype.addButtons=function(){var b=a("<button type=\"button\"style=\"float:right;margin-right:6px\" disabled>Delete row</button>"),c=this;this.tableDiv.append(b);b.click(function(){var b=c.tableDiv.find("table tbody tr").length,d=c.tableDiv.find("tr:last");if(b>c.uiParams.num_rows){d.remove()}d=c.tableDiv.find("tr:last");if(b==c.uiParams.num_rows+1){a(this).prop("disabled",!0)}});var d=a("<button type=\"button\"style=\"float:right;margin-right:6px\">Add row</button>");c.tableDiv.append(d);d.click(function(){var b,d;b=c.tableDiv.find("table tbody tr:last");d=b.clone();d.find("textarea").each(function(){a(this).val("")});b.after(d);a(this).prev().prop("disabled",!1)})};b.prototype.resize=function(){};b.prototype.hasFocus=function(){var b=!1;a(this.tableDiv).find("textarea").each(function(){if(this===document.activeElement){b=!0}});return b};b.prototype.destroy=function(){this.sync();a(this.tableDiv).remove();this.tableDiv=null};return{Constructor:b}});
define ("qtype_coderunner/textareas",["jquery"],function(a){function b(){a(this).data("clickInProgress",!1);a(this).data("capturingTab",!0);a(this).on("mousedown",function(){a(this).data("clickInProgress",!0)});a(this).on("focusin",function(){a(this).data("capturingTab",a(this).data("clickInProgress"))});a(this).on("click",function(){a(this).data("clickInProgress",!1)});a(this).on("keydown",function(b){if(window.hasOwnProperty("behattesting")&&window.behattesting){return}if(b.which===void 0||0!==b.which){if(b.keyCode==9&&a(this).data("capturingTab")){if(b.shiftKey||c(this,"    ")){b.preventDefault()}}else if(b.keyCode===13&&this.selectionStart!==void 0){for(var d=this.value.substring(0,this.selectionStart),e=d.lastIndexOf("\n"),f=d.substring(e+1),g="",h=0;h<f.length&&" "===f.charAt(h);h++){g=g+" "}if(c(this,"\n"+g)){b.preventDefault()}a(this).data("capturingTab",!0)}else if(b.keyCode===77&&b.ctrlKey&&!b.altKey){a(this).data("capturingTab",!a(this).data("capturingTab"));b.preventDefault()}else if(b.keyCode===27){a(this).data("capturingTab",!1)}else if(!(b.ctrlKey||b.altKey)){a(this).data("capturingTab",!0)}}})}function c(a,b){if(a.selectionStart!==void 0){var c=a.value.substring(0,a.selectionStart),d=a.selectionEnd,e=a.value.substring(a.selectionEnd,a.value.length),f=a.scrollTop;a.value=c+b+e;var g=d+b.length;a.selectionStart=g;a.selectionEnd=g;a.scrollTop=f;return!0}else if(document.selection&&document.selection.createRange){var h=document.selection.createRange(),i=h.duplicate();i.moveToElementText(a);i.setEndPoint("EndToEnd",h);h.text=b;return!0}else{return!1}}return{setupAllTAs:function(){a("textarea.edit_code").each(b)},initQuestionTA:function(c){a(document.getElementById(c)).each(b)}}});
define ("qtype_coderunner/userinterfacewrapper",["jquery"],function(a){function b(b,c){var d,e,f=this;this.GUTTER=14;this.MIN_WRAPPER_HEIGHT=50;this.DEFAULT_SYNC_INTERVAL_SECS=5;this.taId=c;this.loadFailId=c+"_loadfailerr";this.textArea=a(document.getElementById(c));e=this.textArea.attr("data-params");if(e){this.uiParams=JSON.parse(e)}else{this.uiParams={}}this.uiParams.lang=this.textArea.attr("data-lang");this.readOnly=this.textArea.prop("readonly");this.isLoading=!1;this.loadFailed=!1;this.retries=0;d=Math.max(parseInt(this.textArea.css("height")),this.MIN_WRAPPER_HEIGHT);this.wrapperNode=a("<div id='"+this.taId+"_wrapper' class='ui_wrapper'></div>");this.textArea.after(this.wrapperNode);this.wrapperNode.hide();this.wrapperNode.css({resize:"vertical",overflow:"hidden",minHeight:d,width:"100%",border:"1px solid darkgrey"});this.textArea.data("current-ui-wrapper",this);this.uiInstance=null;this.loadUi(b,this.uiParams);a(document).mousemove(function(){f.checkForResize()});a(window).resize(function(){f.checkForResize()});this.textArea.closest("form").submit(function(){if(null!==f.uiInstance){f.uiInstance.sync()}});a(document.body).on("keydown",function(a){if(a.keyCode===77&&a.ctrlKey&&a.altKey){if(null!==f.uiInstance||f.loadFailed){f.stop()}else{f.restart()}}})}b.prototype.loadUi=function(b,c){var f=this;function d(b,c){require(["core/str"],function(d){var e=d.get_string(b,"qtype_coderunner"),f=d.get_string("ui_fallback","qtype_coderunner");a.when(e,f).done(function(a,b){c.html(a+"<br>"+b)})})}function e(){if(c.hasOwnProperty("sync_interval_secs")){return parseInt(c.sync_interval_secs)}else{return f.DEFAULT_SYNC_INTERVAL_SECS}}if(this.isLoading){this.retries+=1;if(20<this.retries){alert("Failed to load "+b+" UI component. If this error persists, please report it to the forum on coderunner.org.nz");this.retries=0;this.loading=0}else{setTimeout(function(){f.loadUi(b,c)},200)}return}this.retries=0;this.params=c;this.stop();this.uiname=b;if(""===this.uiname||"none"===this.uiname||sessionStorage.getItem("disableUis")){this.uiInstance=null}else{this.isLoading=!0;require(["qtype_coderunner/ui_"+this.uiname],function(b){var g,i,j,k,l,m;k=f.wrapperNode.innerHeight()-f.GUTTER;l=f.wrapperNode.innerWidth();g=new b.Constructor(f.taId,l,k,c);if(g.failed()){f.loadFailed=!0;f.wrapperNode.hide();g.destroy();f.uiInstance=null;f.textArea.addClass("uiloadfailed");i="<div id=\""+f.loadFailId+"\"class=\"uiloadfailed\"></div>";j=a(i);j.insertBefore(f.textArea);d(g.failMessage(),j)}else{f.hLast=0;f.wLast=0;f.textArea.hide();f.wrapperNode.show();f.wrapperNode.append(g.getElement());f.uiInstance=g;f.loadFailed=!1;f.checkForResize();m=Object.getPrototypeOf(g);m.syncIntervalSecs=m.syncIntervalSecs||e;f.startSyncTimer(g)}f.isLoading=!1})}};b.prototype.startSyncTimer=function(a){var b=a.syncIntervalSecs();if(b){this.uiInstance.timer=setInterval(function(){a.sync()},1e3*b)}else{this.uiInstance.timer=null}};b.prototype.stopSyncTimer=function(a){if(a.timer){clearTimeout(a.timer)}};b.prototype.stop=function(){if(null!==this.uiInstance){this.stopSyncTimer(this.uiInstance);this.textArea.show();if(this.uiInstance.hasFocus()){this.textArea.focus();this.textArea[0].selectionStart=this.textArea[0].value.length}this.uiInstance.destroy();this.uiInstance=null;this.wrapperNode.hide()}this.loadFailed=!1;this.textArea.removeClass("uiloadfailed");a(document.getElementById(this.loadFailId)).remove()};b.prototype.restart=function(){if(null===this.uiInstance){this.loadUi(this.uiname,this.params)}};b.prototype.checkForResize=function(){var b,c,d,e,f,g;if(this.uiInstance){b=this.wrapperNode.innerHeight();d=this.wrapperNode.innerWidth();if(b!=this.hLast||d!=this.wLast){f=this.wrapperNode.offset().left;g=a(window).innerWidth()-f-25;c=b-this.GUTTER;e=Math.min(g,d);this.uiInstance.resize(e,c);this.hLast=this.wrapperNode.innerHeight();this.wLast=this.wrapperNode.innerWidth()}}};return{newUiWrapper:function(a,c){if(a){return new b(a,c)}else{return null}},InterfaceWrapper:b}});
define ("qtype_coderunner/graphutil",function(){function a(){this.greekLetterNames=["Alpha","Beta","Gamma","Delta","Epsilon","Zeta","Eta","Theta","Iota","Kappa","Lambda","Mu","Nu","Xi","Omicron","Pi","Rho","Sigma","Tau","Upsilon","Phi","Chi","Psi","Omega"]}a.prototype.convertLatexShortcuts=function(a){for(var b=0,c;b<this.greekLetterNames.length;b++){c=this.greekLetterNames[b];a=a.replace(new RegExp("\\\\"+c,"g"),String.fromCharCode(913+b+(16<b)));a=a.replace(new RegExp("\\\\"+c.toLowerCase(),"g"),String.fromCharCode(945+b+(16<b)))}for(var b=0;10>b;b++){a=a.replace(new RegExp("_"+b,"g"),String.fromCharCode(8320+b))}a=a.replace(/_a/g,String.fromCharCode(8336));return a};a.prototype.drawArrow=function(a,b,c,d){var e=Math.cos(d),f=Math.sin(d);a.beginPath();a.moveTo(b,c);a.lineTo(b-8*e+5*f,c-8*f-5*e);a.lineTo(b-8*e-5*f,c-8*f+5*e);a.fill()};a.prototype.det=function(j,a,b,c,d,e,f,g,h){return j*d*h+a*e*f+b*c*g-j*e*g-a*c*h-b*d*f};a.prototype.vectorMagnitude=function(a){return Math.sqrt(a.x*a.x+a.y*a.y)};a.prototype.scalarProjection=function(c,a){return(c.x*a.x+c.y*a.y)/this.vectorMagnitude(a)};a.prototype.isCCW=function(c,a){return 0<c.x*a.y-a.x*c.y};a.prototype.circleFromThreePoints=function(b,d,e,f,g,h){var i=this.det(b,d,1,e,f,1,g,h,1),a=-this.det(b*b+d*d,d,1,e*e+f*f,f,1,g*g+h*h,h,1),j=this.det(b*b+d*d,b,1,e*e+f*f,e,1,g*g+h*h,g,1),k=-this.det(b*b+d*d,b,d,e*e+f*f,e,f,g*g+h*h,g,h);return{x:-a/(2*i),y:-j/(2*i),radius:Math.sqrt(a*a+j*j-4*i*k)/(2*Math.abs(i))}};a.prototype.isInside=function(a,b){return a.x>b.x&&a.x<b.x+b.width&&a.y<b.y+b.height&&a.y>b.y};a.prototype.crossBrowserKey=function(a){a=a||window.event;return a.which||a.keyCode};a.prototype.crossBrowserElementPos=function(a){a=a||window.event;var b=a.target||a.srcElement,c=0,d=0;while(b.offsetParent){c+=b.offsetLeft;d+=b.offsetTop;b=b.offsetParent}return{x:c,y:d}};a.prototype.crossBrowserMousePos=function(a){a=a||window.event;return{x:a.pageX||a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,y:a.pageY||a.clientY+document.body.scrollTop+document.documentElement.scrollTop}};a.prototype.crossBrowserRelativeMousePos=function(a){var b=this.crossBrowserElementPos(a),c=this.crossBrowserMousePos(a);return{x:c.x-b.x,y:c.y-b.y}};return new a});
define ("qtype_coderunner/ui_ace",["jquery"],function(a){function b(b,c,d,e){var f=a(document.getElementById(b)),g=a(document.getElementById(b+"_wrapper")),h=f[0]===document.activeElement,i=e.lang,j,k=this;try{window.ace.require("ace/ext/language_tools");this.modelist=window.ace.require("ace/ext/modelist");this.textarea=f;this.enabled=!1;this.contents_changed=!1;this.capturingTab=!1;this.clickInProgress=!1;this.editNode=a("<div></div>");this.editNode.css({resize:"none",height:d,width:"100%"});this.editor=window.ace.edit(this.editNode.get(0));if(f.prop("readonly")){this.editor.setReadOnly(!0)}this.editor.setOptions({enableBasicAutocompletion:!0,newLineMode:"unix"});this.editor.$blockScrolling=1/0;j=this.editor.getSession();j.setValue(this.textarea.val());if(e.theme){this.editor.setTheme("ace/theme/"+e.theme)}this.setLanguage(i);this.setEventHandlers(f);this.captureTab();this.editor.renderer.on("afterRender",function(){var a=g.find(".ace_gutter");if(a.hasClass("moodle-has-zindex")){return}a.addClass("moodle-has-zindex");if(h){k.editor.focus();k.editor.navigateFileEnd()}k.aceLabel=g.find(".answerprompt");k.aceLabel.attr("for","ace_"+b);k.aceTextarea=g.find(".ace_text-input");k.aceTextarea.attr("id","ace_"+b)});this.fail=!1}catch(a){this.fail=!0}}b.prototype.failed=function(){return this.fail};b.prototype.failMessage=function(){return"ace_ui_notready"};b.prototype.sync=function(){};b.prototype.syncIntervalSecs=function(){return 0};b.prototype.setLanguage=function(a){var b=this.editor.getSession(),c=this.findMode(a);if(c){b.setMode(c.mode)}};b.prototype.getElement=function(){return this.editNode};b.prototype.captureTab=function(){this.capturingTab=!0;this.editor.commands.bindKeys({Tab:"indent","Shift-Tab":"outdent"})};b.prototype.releaseTab=function(){this.capturingTab=!1;this.editor.commands.bindKeys({Tab:null,"Shift-Tab":null})};b.prototype.setEventHandlers=function(){var a=this;this.editor.getSession().on("change",function(){a.textarea.val(a.editor.getSession().getValue());a.contents_changed=!0});this.editor.on("blur",function(){if(a.contents_changed){a.textarea.trigger("change")}});this.editor.on("mousedown",function(){a.clickInProgress=!0});this.editor.on("focus",function(){if(a.clickInProgress){a.captureTab()}else{a.releaseTab()}});this.editor.on("click",function(){a.clickInProgress=!1});this.editor.container.addEventListener("keydown",function(b){if(b.which===void 0||0!==b.which){if(b.keyCode===77&&b.ctrlKey&&!b.altKey){if(a.capturingTab){a.releaseTab()}else{a.captureTab()}b.preventDefault()}else if(b.keyCode===27){a.releaseTab()}else if(!(b.shiftKey||b.ctrlKey||b.altKey||b.keyCode==9)){a.captureTab()}}},!0)};b.prototype.destroy=function(){var b;if(!this.fail){b=this.editor.isFocused();this.textarea.val(this.editor.getSession().getValue());this.editor.destroy();a(this.editNode).remove();if(b){this.textarea.focus();this.textarea[0].selectionStart=this.textarea[0].value.length}}};b.prototype.hasFocus=function(){return this.editor.isFocused()};b.prototype.findMode=function(a){var b,c,d,e=[],f={octave:"matlab",nodejs:"javascript","c#":"cs"};if("string"!=typeof a){return}if(a.toLowerCase()in f){a=f[a.toLowerCase()]}e=[a,a.replace(/\d+$/,"")];for(var g=0;g<e.length;g++){b=e[g];c="input."+b;d=this.modelist.modesByName[b]||this.modelist.modesByName[b.toLowerCase()]||this.modelist.getModeForPath(c)||this.modelist.getModeForPath(c.toLowerCase());if(d&&"text"!==d.name){return d}}};b.prototype.resize=function(a,b){this.editNode.outerHeight(b);this.editNode.outerWidth(a);this.editor.resize()};return{Constructor:b}});
define ("qtype_coderunner/showdiff",["jquery"],function(a){function b(a,b){var c=a.length,d=b.length,e,f,g,h="function"==typeof[1].fill;e=[];for(f=0;f<=c;f+=1){e[f]=Array(d+1);if(h){e[f].fill(0)}else{for(g=0;g<d+1;g++){e[f][g]=0}}}for(f=0;f<c;f+=1){for(g=0;g<d;g+=1){if(a[f]==b[g]){e[f+1][g+1]=1+e[f][g]}else{e[f+1][g+1]=Math.max(e[f][g+1],e[f+1][g])}}}return e}function c(a,c){var d,e,f,g,h,k;d=b(a,c);k=d[a.length][c.length];h=[];e=a.length;f=c.length;g=k-1;while(0<=g){if(a[e-1]==c[f-1]){h[g]=a[e-1];g-=1;e-=1;f-=1}else if(d[e-1][f]==d[e][f]){e-=1}else{f-=1}}return h}function d(a,b,c,d){var e="",f=!1,g,h=0;if(c===void 0){c="<del>"}if(d===void 0){d="</del>"}for(g=0;g<a.length;g+=1){if(h<b.length&&a[g]==b[h]){if(f){e+=d;f=!1}h+=1}else{if(!f){e+=c;f=!0}}e+=a[g]}if(f){e+=d}return e}function e(a){return a.tagName.toLowerCase()}function f(a){var c="pre"===e(a),d=a.innerHTML,f,g=0;function b(){var a,b;if("&"!=d[g]){a=d[g];g=g+1}else{b=d.substring(g,d.length).match(/(^&[a-zA-Z]+;)|(^&#[0-9]+;)|(^&#[xX][0-9a-fA-F]+;)/);if(null===b){a=d[g];g=g+1}else{a=b[0];g=g+a.length}}return a}if(c){d=d.replace(/\n/g,"\u21A9\n")}d=d.replace(/(<br ?.*?>)/g,"\u21A9$1");f=[];g=0;while(g<d.length){f.push(b())}return f}function g(a,b){var e,g,h;e=f(a);g=f(b);h=c(e,g);a.innerHTML=d(e,h,"<del>","</del>");b.innerHTML=d(g,h,"<del>","</del>")}function h(a,b){var c=/(<\/?del[^>]*>)|()/g;a.innerHTML=a.innerHTML.replace(c,"");b.innerHTML=b.innerHTML.replace(c,"")}function i(a,b,c,d){for(var e,f,g,h,j=0;j<a.length;j++){e=a[j];f=e.getElementsByTagName("td");g=f[c].children[0];h=f[b].children[0];d(g,h)}}return{initDiffButton:function(b,c,d,e,f){var j=a("[id=\""+b+"\"]"),k,l,m,n=0,o=-1,p=-1;k=j.closest("div.coderunner-test-results");m=k.find("thead tr").children();l=k.find("tbody tr");m.each(function(){if(a(this).html()===f){o=n}else if(a(this).html()===e){p=n}n+=1});if(-1!==o&&-1!==p){j.on("click",function(){if(j.prop("value")===c){i(l.toArray(),o,p,g);j.prop("value",d)}else{i(l.toArray(),o,p,h);j.prop("value",c)}})}else{j.enabled=!1;j.hide()}}}});
define ("qtype_coderunner/ui_html",["jquery"],function(a){function b(b,c,d,e){this.textArea=a(document.getElementById(b));this.textareaId=b;var f=e.html_src||"globalextra";this.html=this.textArea.attr("data-"+f);this.html=this.html.replace(/___textareaId___/gm,b);this.readOnly=this.textArea.prop("readonly");this.uiParams=e;this.fail=!1;this.htmlDiv=null;this.reload()}b.prototype.failed=function(){return this.fail};b.prototype.failMessage=function(){return"htmluiloadfail"};b.prototype.sync=function(){var b={},c,d=!0;this.getFields().each(function(){var e,f;f=a(this).attr("type");c=a(this).attr("name");if(("checkbox"===f||"radio"===f)&&!a(this).is(":checked")){e=""}else{e=a(this).val()}if(b.hasOwnProperty(c)){b[c].push(e)}else{b[c]=[e]}if(""!==e){d=!1}});if(d){this.textArea.val("")}else{this.textArea.val(JSON.stringify(b))}};b.prototype.getElement=function(){return this.htmlDiv};b.prototype.getFields=function(){return a(this.htmlDiv).find(".coderunner-ui-element")};b.prototype.setField=function(a,b){if("checkbox"===a.attr("type")||"radio"===a.attr("type")){a.prop("checked",a.val()===b)}else{a.val(b)}};b.prototype.reload=function(){var b=a(this.textArea).val(),c,d,e,f,g,h="qtype-coderunner-outer-div-"+this.textareaId.toString();this.htmlDiv=a("<div style='height:fit-content' class='qtype-coderunner-html-outer-div' id='"+h+"'>"+this.html+"</div>");this.htmlDiv.data("uiparams",this.uiParams);this.htmlDiv.data("templateparams",this.uiParams);if(b){try{c=JSON.parse(b);g={};for(var j in c){d=c[j];f=this.getFields().filter("[name='"+j+"']");g[j]=[];for(e=0;e<d.length;e++){if(e<f.length){this.setField(a(f[e]),d[e])}else{g[j].push(d[e])}}if(0===g[j].length){delete g[j]}}if(!a.isEmptyObject(g)){this.htmlDiv.data("leftovers",g)}}catch(a){this.fail=!0}}};b.prototype.resize=function(){};b.prototype.hasFocus=function(){var a=!1;this.getFields().each(function(){if(this===document.activeElement){a=!0}});return a};b.prototype.destroy=function(){this.sync();a(this.htmlDiv).remove();this.htmlDiv=null};return{Constructor:b}});
/*
 * JavaScript to allow dragging options to slots (using mouse down or touch) or tab through slots using keyboard.
 *
 * @module     qtype_ddimageortext/question
 * @package    qtype_ddimageortext
 * @copyright  2018 The Open University
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("qtype_ddimageortext/question",["jquery","core/dragdrop","core/key_codes"],(function($,dragDrop,keys){function DragDropOntoImageQuestion(containerId,readOnly,places){this.containerId=containerId,M.util.js_pending("qtype_ddimageortext-init-"+this.containerId),this.places=places,this.allImagesLoaded=!1,this.imageLoadingTimeoutId=null,this.isPrinting=!1,readOnly&&this.getRoot().addClass("qtype_ddimageortext-readonly");var thisQ=this;this.getNotYetLoadedImages().one("load",(function(){thisQ.waitForAllImagesToBeLoaded()})),this.waitForAllImagesToBeLoaded()}DragDropOntoImageQuestion.prototype.waitForAllImagesToBeLoaded=function(){var thisQ=this;this.allImagesLoaded||(null!==this.imageLoadingTimeoutId&&clearTimeout(this.imageLoadingTimeoutId),this.getNotYetLoadedImages().length>0?this.imageLoadingTimeoutId=setTimeout((function(){thisQ.waitForAllImagesToBeLoaded()}),100):(this.allImagesLoaded=!0,thisQ.setupQuestion()))},DragDropOntoImageQuestion.prototype.getNotYetLoadedImages=function(){var thisQ=this;return this.getRoot().find(".ddarea img").not((function(i,imgNode){return thisQ.imageIsLoaded(imgNode)}))},DragDropOntoImageQuestion.prototype.imageIsLoaded=function(imgElement){return imgElement.complete&&0!==imgElement.naturalHeight},DragDropOntoImageQuestion.prototype.setupQuestion=function(){this.resizeAllDragsAndDrops(),this.cloneDrags(),this.positionDragsAndDrops(),M.util.js_complete("qtype_ddimageortext-init-"+this.containerId)},DragDropOntoImageQuestion.prototype.resizeAllDragsAndDrops=function(){var thisQ=this;this.getRoot().find(".draghomes > div").each((function(i,node){thisQ.resizeAllDragsAndDropsInGroup(thisQ.getClassnameNumericSuffix($(node),"dragitemgroup"))}))},DragDropOntoImageQuestion.prototype.resizeAllDragsAndDropsInGroup=function(group){var root=this.getRoot(),dragHomes=root.find(".dragitemgroup"+group+" .draghome"),maxWidth=0,maxHeight=0;for(var i in dragHomes.each((function(i,drag){maxWidth=Math.max(maxWidth,Math.ceil(drag.offsetWidth)),maxHeight=Math.max(maxHeight,Math.ceil(drag.offsetHeight))})),maxWidth+=10,maxHeight+=10,dragHomes.each((function(i,drag){var left=Math.round((maxWidth-drag.offsetWidth)/2),top=Math.floor((maxHeight-drag.offsetHeight)/2);$(drag).css({"padding-left":left+"px","padding-right":maxWidth-drag.offsetWidth-left+"px","padding-top":top+"px","padding-bottom":maxHeight-drag.offsetHeight-top+"px"})})),this.places)if(this.places.hasOwnProperty(i)){var place=this.places[i],label=place.text;parseInt(place.group)===group&&(""===label&&(label=M.util.get_string("blank","qtype_ddimageortext")),root.find(".dropzones").append('<div class="dropzone active group'+place.group+" place"+i+'" tabindex="0"><span class="accesshide">'+label+"</span>&nbsp;</div>"),root.find(".dropzone.place"+i).width(maxWidth-2).height(maxHeight-2))}},DragDropOntoImageQuestion.prototype.cloneDrags=function(){var thisQ=this;thisQ.getRoot().find(".draghome").each((function(index,dragHome){var drag=$(dragHome),placeHolder=drag.clone();placeHolder.removeClass(),placeHolder.addClass("draghome choice"+thisQ.getChoice(drag)+" group"+thisQ.getGroup(drag)+" dragplaceholder"),drag.before(placeHolder)}))},DragDropOntoImageQuestion.prototype.cloneDragsForOneChoice=function(dragHome){if(dragHome.hasClass("infinite"))for(var noOfDrags=this.noOfDropsInGroup(this.getGroup(dragHome)),i=0;i<noOfDrags;i++)this.cloneDrag(dragHome);else this.cloneDrag(dragHome)},DragDropOntoImageQuestion.prototype.cloneDrag=function(dragHome){var drag=dragHome.clone();drag.removeClass("draghome").addClass("drag unplaced moodle-has-zindex").offset(dragHome.offset()),this.getRoot().find(".dragitems").append(drag)},DragDropOntoImageQuestion.prototype.positionDragsAndDrops=function(){var thisQ=this,root=this.getRoot(),bgRatio=this.bgRatio();root.find(".ddarea .dropzone").each((function(i,dropNode){var drop=$(dropNode),place=thisQ.places[thisQ.getPlace(drop)];drop.css("left",parseInt(place.xy[0])*bgRatio).css("top",parseInt(place.xy[1])*bgRatio),drop.data("originX",parseInt(place.xy[0])).data("originY",parseInt(place.xy[1])),thisQ.handleElementScale(drop,"left top")})),root.find(".draghome").not(".dragplaceholder").each((function(i,dragNode){var drag=$(dragNode),currentPlace=thisQ.getClassnameNumericSuffix(drag,"inplace");drag.addClass("unplaced").removeClass("placed"),drag.removeAttr("tabindex"),null!==currentPlace&&drag.removeClass("inplace"+currentPlace)})),root.find("input.placeinput").each((function(i,inputNode){var input=$(inputNode),choice=input.val();if(!(0===choice.length||choice.length>0&&"0"===choice)){var place=thisQ.getPlace(input),unplacedDrag=thisQ.getUnplacedChoice(thisQ.getGroup(input),choice),hiddenDrag=thisQ.getDragClone(unplacedDrag);if(hiddenDrag.length)if(unplacedDrag.hasClass("infinite")){var noOfDrags=thisQ.noOfDropsInGroup(thisQ.getGroup(unplacedDrag));if(thisQ.getInfiniteDragClones(unplacedDrag,!1).length<noOfDrags){var cloneDrag=unplacedDrag.clone();cloneDrag.removeClass("beingdragged"),cloneDrag.removeAttr("tabindex"),hiddenDrag.after(cloneDrag)}else hiddenDrag.addClass("active")}else hiddenDrag.addClass("active");var drop=root.find(".dropzone.place"+place);thisQ.sendDragToDrop(unplacedDrag,drop)}}))},DragDropOntoImageQuestion.prototype.handleDragStart=function(e){var thisQ=this,drag=$(e.target).closest(".draghome"),newIndex=this.calculateZIndex()+2;if(dragDrop.prepare(e).start){drag.addClass("beingdragged").css("transform","").css("z-index",newIndex);var currentPlace=this.getClassnameNumericSuffix(drag,"inplace");if(null!==currentPlace){this.setInputValue(currentPlace,0),drag.removeClass("inplace"+currentPlace);var hiddenDrop=thisQ.getDrop(drag,currentPlace);hiddenDrop.length&&(hiddenDrop.addClass("active"),drag.offset(hiddenDrop.offset()))}else{var hiddenDrag=thisQ.getDragClone(drag);if(hiddenDrag.length)if(drag.hasClass("infinite")){var noOfDrags=this.noOfDropsInGroup(thisQ.getGroup(drag));if(this.getInfiniteDragClones(drag,!1).length<noOfDrags){var cloneDrag=drag.clone();cloneDrag.removeClass("beingdragged"),cloneDrag.removeAttr("tabindex"),hiddenDrag.after(cloneDrag),questionManager.addEventHandlersToDrag(cloneDrag),drag.offset(cloneDrag.offset())}else hiddenDrag.addClass("active"),drag.offset(hiddenDrag.offset())}else hiddenDrag.addClass("active"),drag.offset(hiddenDrag.offset())}dragDrop.start(e,drag,(function(x,y,drag){thisQ.dragMove(x,y,drag)}),(function(x,y,drag){thisQ.dragEnd(x,y,drag)}))}},DragDropOntoImageQuestion.prototype.dragMove=function(pageX,pageY,drag){var thisQ=this,highlighted=!1;this.getRoot().find(".dropzone.group"+this.getGroup(drag)).each((function(i,dropNode){var drop=$(dropNode);thisQ.isPointInDrop(pageX,pageY,drop)&&!highlighted?(highlighted=!0,drop.addClass("valid-drag-over-drop")):drop.removeClass("valid-drag-over-drop")})),this.getRoot().find(".draghome.placed.group"+this.getGroup(drag)).not(".beingdragged").each((function(i,dropNode){var drop=$(dropNode);!thisQ.isPointInDrop(pageX,pageY,drop)||highlighted||thisQ.isDragSameAsDrop(drag,drop)?drop.removeClass("valid-drag-over-drop"):(highlighted=!0,drop.addClass("valid-drag-over-drop"))}))},DragDropOntoImageQuestion.prototype.dragEnd=function(pageX,pageY,drag){var thisQ=this,root=this.getRoot(),placed=!1;root.find(".dropzone.group"+this.getGroup(drag)).each((function(i,dropNode){var drop=$(dropNode);return!thisQ.isPointInDrop(pageX,pageY,drop)||(drop.removeClass("valid-drag-over-drop"),thisQ.sendDragToDrop(drag,drop),placed=!0,!1)})),placed||root.find(".draghome.placed.group"+this.getGroup(drag)).not(".beingdragged").each((function(i,placedNode){var placedDrag=$(placedNode);if(!thisQ.isPointInDrop(pageX,pageY,placedDrag)||thisQ.isDragSameAsDrop(drag,placedDrag))return!0;placedDrag.removeClass("valid-drag-over-drop");var currentPlace=thisQ.getClassnameNumericSuffix(placedDrag,"inplace"),drop=thisQ.getDrop(drag,currentPlace);return thisQ.sendDragToDrop(drag,drop),placed=!0,!1})),placed||this.sendDragHome(drag)},DragDropOntoImageQuestion.prototype.sendDragToDrop=function(drag,drop){var oldDrag=this.getCurrentDragInPlace(this.getPlace(drop));if(0!==oldDrag.length){oldDrag.addClass("beingdragged"),oldDrag.offset(oldDrag.offset());var currentPlace=this.getClassnameNumericSuffix(oldDrag,"inplace");this.getDrop(oldDrag,currentPlace).addClass("active"),this.sendDragHome(oldDrag)}0===drag.length?(this.setInputValue(this.getPlace(drop),0),drop.data("isfocus")&&drop.focus()):(this.setInputValue(this.getPlace(drop),this.getChoice(drag)),drag.removeClass("unplaced").addClass("placed inplace"+this.getPlace(drop)),drag.attr("tabindex",0),this.animateTo(drag,drop))},DragDropOntoImageQuestion.prototype.sendDragHome=function(drag){var currentPlace=this.getClassnameNumericSuffix(drag,"inplace");null!==currentPlace&&drag.removeClass("inplace"+currentPlace),drag.data("unplaced",!0),this.animateTo(drag,this.getDragHome(this.getGroup(drag),this.getChoice(drag)))},DragDropOntoImageQuestion.prototype.handleKeyPress=function(e){var drop=$(e.target).closest(".dropzone");if(0===drop.length){var placedDrag=$(e.target),currentPlace=this.getClassnameNumericSuffix(placedDrag,"inplace");null!==currentPlace&&(drop=this.getDrop(placedDrag,currentPlace))}var currentDrag=this.getCurrentDragInPlace(this.getPlace(drop)),nextDrag=$();switch(e.keyCode){case keys.space:case keys.arrowRight:case keys.arrowDown:nextDrag=this.getNextDrag(this.getGroup(drop),currentDrag);break;case keys.arrowLeft:case keys.arrowUp:nextDrag=this.getPreviousDrag(this.getGroup(drop),currentDrag);break;case keys.escape:questionManager.isKeyboardNavigation=!1;break;default:return void(questionManager.isKeyboardNavigation=!1)}if(nextDrag.length){nextDrag.data("isfocus",!0),nextDrag.addClass("beingdragged");var hiddenDrag=this.getDragClone(nextDrag);if(hiddenDrag.length)if(nextDrag.hasClass("infinite")){var noOfDrags=this.noOfDropsInGroup(this.getGroup(nextDrag));if(this.getInfiniteDragClones(nextDrag,!1).length<noOfDrags){var cloneDrag=nextDrag.clone();cloneDrag.removeClass("beingdragged"),cloneDrag.removeAttr("tabindex"),hiddenDrag.after(cloneDrag),questionManager.addEventHandlersToDrag(cloneDrag),nextDrag.offset(cloneDrag.offset())}else hiddenDrag.addClass("active"),nextDrag.offset(hiddenDrag.offset())}else hiddenDrag.addClass("active"),nextDrag.offset(hiddenDrag.offset())}else drop.data("isfocus",!0);e.preventDefault(),this.sendDragToDrop(nextDrag,drop)},DragDropOntoImageQuestion.prototype.getNextDrag=function(group,drag){var choice,numChoices=this.noOfChoicesInGroup(group);choice=0===drag.length?1:this.getChoice(drag)+1;for(var next=this.getUnplacedChoice(group,choice);0===next.length&&choice<numChoices;)choice++,next=this.getUnplacedChoice(group,choice);return next},DragDropOntoImageQuestion.prototype.getPreviousDrag=function(group,drag){var choice;choice=0===drag.length?this.noOfChoicesInGroup(group):this.getChoice(drag)-1;for(var previous=this.getUnplacedChoice(group,choice);0===previous.length&&choice>1;)choice--,previous=this.getUnplacedChoice(group,choice);return previous},DragDropOntoImageQuestion.prototype.animateTo=function(drag,target){var currentPos=drag.offset(),targetPos=target.offset(),thisQ=this;M.util.js_pending("qtype_ddimageortext-animate-"+thisQ.containerId),drag.animate({left:parseInt(drag.css("left"))+targetPos.left-currentPos.left,top:parseInt(drag.css("top"))+targetPos.top-currentPos.top},{duration:"fast",done:function(){$("body").trigger("qtype_ddimageortext-dragmoved",[drag,target,thisQ]),M.util.js_complete("qtype_ddimageortext-animate-"+thisQ.containerId)}})},DragDropOntoImageQuestion.prototype.isPointInDrop=function(pageX,pageY,drop){var position=drop.offset();return drop.hasClass("draghome")?pageX>=position.left&&pageX<position.left+drop.outerWidth()&&pageY>=position.top&&pageY<position.top+drop.outerHeight():pageX>=position.left&&pageX<position.left+drop.width()&&pageY>=position.top&&pageY<position.top+drop.height()},DragDropOntoImageQuestion.prototype.setInputValue=function(place,choice){this.getRoot().find("input.placeinput.place"+place).val(choice)},DragDropOntoImageQuestion.prototype.getRoot=function(){return $(document.getElementById(this.containerId))},DragDropOntoImageQuestion.prototype.bgImage=function(){return this.getRoot().find("img.dropbackground")},DragDropOntoImageQuestion.prototype.getDragHome=function(group,choice){return this.getRoot().find(".draghome.dragplaceholder.group"+group+".choice"+choice).is(":visible")?this.getRoot().find(".draghome.dragplaceholder.group"+group+".choice"+choice):this.getRoot().find(".dragitemgroup"+group+" .draghome.infinite.choice"+choice+".group"+group)},DragDropOntoImageQuestion.prototype.getUnplacedChoice=function(group,choice){return this.getRoot().find(".ddarea .draghome.group"+group+".choice"+choice+".unplaced").slice(0,1)},DragDropOntoImageQuestion.prototype.getCurrentDragInPlace=function(place){return this.getRoot().find(".ddarea .draghome.inplace"+place)},DragDropOntoImageQuestion.prototype.noOfDropsInGroup=function(group){return this.getRoot().find(".dropzone.group"+group).length},DragDropOntoImageQuestion.prototype.noOfChoicesInGroup=function(group){return this.getRoot().find(".dragitemgroup"+group+" .draghome").length},DragDropOntoImageQuestion.prototype.getClassnameNumericSuffix=function(node,prefix){var classes=node.attr("class");if(""!==classes)for(var classesArr=classes.split(" "),index=0;index<classesArr.length;index++){if(new RegExp("^"+prefix+"([0-9])+$").test(classesArr[index])){var match=new RegExp("([0-9])+$").exec(classesArr[index]);return Number(match[0])}}return null},DragDropOntoImageQuestion.prototype.getChoice=function(drag){return this.getClassnameNumericSuffix(drag,"choice")},DragDropOntoImageQuestion.prototype.getGroup=function(node){return this.getClassnameNumericSuffix(node,"group")},DragDropOntoImageQuestion.prototype.getPlace=function(node){return this.getClassnameNumericSuffix(node,"place")},DragDropOntoImageQuestion.prototype.getDragClone=function(drag){return this.getRoot().find(".dragitemgroup"+this.getGroup(drag)+" .draghome.choice"+this.getChoice(drag)+".group"+this.getGroup(drag)+".dragplaceholder")},DragDropOntoImageQuestion.prototype.getInfiniteDragClones=function(drag,inHome){return inHome?this.getRoot().find(".dragitemgroup"+this.getGroup(drag)+" .draghome.choice"+this.getChoice(drag)+".group"+this.getGroup(drag)+".infinite").not(".dragplaceholder"):this.getRoot().find(".draghome.choice"+this.getChoice(drag)+".group"+this.getGroup(drag)+".infinite").not(".dragplaceholder")},DragDropOntoImageQuestion.prototype.getDrop=function(drag,currentPlace){return this.getRoot().find(".dropzone.group"+this.getGroup(drag)+".place"+currentPlace)},DragDropOntoImageQuestion.prototype.handleResize=function(){var thisQ=this,bgRatio=this.bgRatio();this.isPrinting&&(bgRatio=1),this.getRoot().find(".ddarea .dropzone").each((function(i,dropNode){$(dropNode).css("left",parseInt($(dropNode).data("originX"))*parseFloat(bgRatio)).css("top",parseInt($(dropNode).data("originY"))*parseFloat(bgRatio)),thisQ.handleElementScale(dropNode,"left top")})),this.getRoot().find("div.droparea .draghome").not(".beingdragged").each((function(key,drag){$(drag).css("left",parseFloat($(drag).data("originX"))*parseFloat(bgRatio)).css("top",parseFloat($(drag).data("originY"))*parseFloat(bgRatio)),thisQ.handleElementScale(drag,"left top")}))},DragDropOntoImageQuestion.prototype.bgRatio=function(){var bgImg=this.bgImage(),bgImgNaturalWidth=bgImg.get(0).naturalWidth;return bgImg.width()/bgImgNaturalWidth},DragDropOntoImageQuestion.prototype.handleElementScale=function(element,type){var bgRatio=parseFloat(this.bgRatio());this.isPrinting&&(bgRatio=1),$(element).css({"-webkit-transform":"scale("+bgRatio+")","-moz-transform":"scale("+bgRatio+")","-ms-transform":"scale("+bgRatio+")","-o-transform":"scale("+bgRatio+")",transform:"scale("+bgRatio+")","transform-origin":type})},DragDropOntoImageQuestion.prototype.calculateZIndex=function(){var zIndex=0;return this.getRoot().find(".ddarea .dropzone, div.droparea .draghome").each((function(i,dropNode){var itemZIndex=(dropNode=$(dropNode)).css("z-index")?parseInt(dropNode.css("z-index")):0;itemZIndex>zIndex&&(zIndex=itemZIndex)})),zIndex},DragDropOntoImageQuestion.prototype.isDragSameAsDrop=function(drag,drop){return this.getChoice(drag)===this.getChoice(drop)&&this.getGroup(drag)===this.getGroup(drop)};var questionManager={eventHandlersInitialised:!1,isPrinting:!1,isKeyboardNavigation:!1,questions:{},init:function(containerId,readOnly,places){questionManager.questions[containerId]=new DragDropOntoImageQuestion(containerId,readOnly,places),questionManager.eventHandlersInitialised||(questionManager.setupEventHandlers(),questionManager.eventHandlersInitialised=!0)},setupEventHandlers:function(){questionManager.addEventHandlersToDrag($(".que.ddimageortext:not(.qtype_ddimageortext-readonly) .draghome")),$("body").on("keydown",".que.ddimageortext:not(.qtype_ddimageortext-readonly) .dropzones .dropzone",questionManager.handleKeyPress).on("keydown",".que.ddimageortext:not(.qtype_ddimageortext-readonly) .draghome.placed:not(.beingdragged)",questionManager.handleKeyPress).on("qtype_ddimageortext-dragmoved",questionManager.handleDragMoved),$(window).on("resize",(function(){questionManager.handleWindowResize(!1)})),window.addEventListener("beforeprint",(function(){questionManager.isPrinting=!0,questionManager.handleWindowResize(questionManager.isPrinting)})),window.addEventListener("afterprint",(function(){questionManager.isPrinting=!1,questionManager.handleWindowResize(questionManager.isPrinting)})),setTimeout((function(){questionManager.fixLayoutIfThingsMoved()}),100)},addEventHandlersToDrag:function(element){element.unbind("mousedown touchstart"),element.on("mousedown touchstart",questionManager.handleDragStart)},handleDragStart:function(e){e.preventDefault();var question=questionManager.getQuestionForEvent(e);question&&question.handleDragStart(e)},handleKeyPress:function(e){if(!questionManager.isKeyboardNavigation){questionManager.isKeyboardNavigation=!0;var question=questionManager.getQuestionForEvent(e);question&&question.handleKeyPress(e)}},handleWindowResize:function(isPrinting){for(var containerId in questionManager.questions)questionManager.questions.hasOwnProperty(containerId)&&(questionManager.questions[containerId].isPrinting=isPrinting,questionManager.questions[containerId].handleResize())},fixLayoutIfThingsMoved:function(){this.handleWindowResize(questionManager.isPrinting),setTimeout((function(){questionManager.fixLayoutIfThingsMoved(questionManager.isPrinting)}),100)},handleDragMoved:function(e,drag,target,thisQ){drag.removeClass("beingdragged").css("z-index",""),drag.css("top",target.position().top).css("left",target.position().left),target.after(drag),target.removeClass("active"),void 0!==drag.data("unplaced")&&!0===drag.data("unplaced")?(drag.removeClass("placed").addClass("unplaced"),drag.removeAttr("tabindex"),drag.removeData("unplaced"),drag.css("top","").css("left","").css("transform",""),drag.hasClass("infinite")&&thisQ.getInfiniteDragClones(drag,!0).length>1&&thisQ.getInfiniteDragClones(drag,!0).first().remove()):(drag.data("originX",target.data("originX")).data("originY",target.data("originY")),thisQ.handleElementScale(drag,"left top")),void 0!==drag.data("isfocus")&&!0===drag.data("isfocus")&&(drag.focus(),drag.removeData("isfocus")),void 0!==target.data("isfocus")&&!0===target.data("isfocus")&&target.removeData("isfocus"),questionManager.isKeyboardNavigation&&(questionManager.isKeyboardNavigation=!1)},getQuestionForEvent:function(e){var containerId=$(e.currentTarget).closest(".que.ddimageortext").attr("id");return questionManager.questions[containerId]}};return{init:questionManager.init}}));
/*
 * JavaScript to allow dragging options to slots (using mouse down or touch) or tab through slots using keyboard.
 *
 * @module     qtype_ddimageortext/form
 * @package    qtype_ddimageortext
 * @copyright  2018 The Open University
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("qtype_ddimageortext/form",["jquery","core/dragdrop"],(function($,dragDrop){var dragDropToImageForm={maxBgImageSize:null,maxDragImageSize:null,fp:null,init:function(){dragDropToImageForm.fp=dragDropToImageForm.filePickers(),$("#id_previewareaheader").append('<div class="ddarea que ddimageortext">  <div class="droparea">    <img class="dropbackground" />    <div class="dropzones"></div>  </div>  <div class="dragitems"></div></div>'),dragDropToImageForm.updateVisibilityOfFilePickers(),dragDropToImageForm.setOptionsForDragItemSelectors(),dragDropToImageForm.setupEventHandlers(),dragDropToImageForm.waitForFilePickerToInitialise()},waitForFilePickerToInitialise:function(){null!==dragDropToImageForm.fp.file("bgimage").href?(M.util.js_pending("dragDropToImageForm"),$("form.mform").on("change",".filepickerhidden",(function(){M.util.js_pending("dragDropToImageForm"),dragDropToImageForm.loadPreviewImage()})),dragDropToImageForm.loadPreviewImage()):setTimeout(dragDropToImageForm.waitForFilePickerToInitialise,1e3)},loadPreviewImage:function(){$("fieldset#id_previewareaheader .dropbackground").one("load",dragDropToImageForm.afterPreviewImageLoaded).attr("src",dragDropToImageForm.fp.file("bgimage").href)},afterPreviewImageLoaded:function(){dragDropToImageForm.createDropZones(),M.util.js_complete("dragDropToImageForm")},createDropZones:function(){var dropZoneHolder=$(".dropzones");if(dropZoneHolder.empty(),null!==dragDropToImageForm.fp.file("bgimage").href){for(var numDrops=dragDropToImageForm.form.getFormValue("nodropzone",[]),dropNo=0;dropNo<numDrops;dropNo++){var dragNo=dragDropToImageForm.form.getFormValue("drops",[dropNo,"choice"]);if("0"!==dragNo){dragNo-=1;var group=dragDropToImageForm.form.getFormValue("drags",[dragNo,"draggroup"]),label=dragDropToImageForm.form.getFormValue("draglabel",[dragNo]);if("image"===dragDropToImageForm.form.getFormValue("drags",[dragNo,"dragitemtype"])){var imgUrl=dragDropToImageForm.fp.file("dragitem["+dragNo+"]").href;if(null===imgUrl)continue;dropZoneHolder.append('<img class="droppreview group'+group+" drop"+dropNo+'" src="'+imgUrl+'" alt="'+label+'" data-drop-no="'+dropNo+'">')}else""!==label&&dropZoneHolder.append('<div class="droppreview group'+group+" drop"+dropNo+'"  data-drop-no="'+dropNo+'">'+label+"</div>")}}dragDropToImageForm.waitForAllDropImagesToBeLoaded()}},waitForAllDropImagesToBeLoaded:function(){$(".dropzones img").not((function(i,imgNode){return dragDropToImageForm.imageIsLoaded(imgNode)})).length>0?setTimeout((function(){dragDropToImageForm.waitForAllDropImagesToBeLoaded()}),100):dragDropToImageForm.updateDropZones()},imageIsLoaded:function(imgElement){return imgElement.complete&&0!==imgElement.naturalHeight},updateDropZones:function(){if(null!==dragDropToImageForm.fp.file("bgimage").href){for(var dropBackgroundPosition=$("fieldset#id_previewareaheader .dropbackground").offset(),numDrops=dragDropToImageForm.form.getFormValue("nodropzone",[]),dropNo=0;dropNo<numDrops;dropNo++){var drop=$(".dropzones .drop"+dropNo);if(0!==drop.length){var dragNo=dragDropToImageForm.form.getFormValue("drops",[dropNo,"choice"])-1;drop.offset({left:dropBackgroundPosition.left+parseInt(dragDropToImageForm.form.getFormValue("drops",[dropNo,"xleft"])),top:dropBackgroundPosition.top+parseInt(dragDropToImageForm.form.getFormValue("drops",[dropNo,"ytop"]))});var label=dragDropToImageForm.form.getFormValue("draglabel",[dragNo]);drop.is("img")?drop.attr("alt",label):drop.html(label)}}$(".dropzones .droppreview").css("padding","0");for(var numGroups=$(".draggroup select").first().find("option").length,group=1;group<=numGroups;group++)dragDropToImageForm.resizeAllDragsAndDropsInGroup(group)}},resizeAllDragsAndDropsInGroup:function(group){var drops=$(".dropzones .droppreview.group"+group),maxWidth=0,maxHeight=0;drops.each((function(i,drop){maxWidth=Math.max(maxWidth,Math.ceil(drop.offsetWidth)),maxHeight=Math.max(maxHeight,Math.ceil(drop.offsetHeight))})),maxWidth+=10,maxHeight+=10,drops.each((function(i,drop){var left=Math.round((maxWidth-drop.offsetWidth)/2),top=Math.floor((maxHeight-drop.offsetHeight)/2);$(drop).css({"padding-left":left+"px","padding-right":maxWidth-drop.offsetWidth-left+"px","padding-top":top+"px","padding-bottom":maxHeight-drop.offsetHeight-top+"px"})}))},setupEventHandlers:function(){$("fieldset#id_draggableitemheader").on("change input","input, select",(function(e){var input=$(e.target).closest("select, input");input.hasClass("dragitemtype")&&dragDropToImageForm.updateVisibilityOfFilePickers(),dragDropToImageForm.setOptionsForDragItemSelectors(),input.is(".dragitemtype, .draggroup")?dragDropToImageForm.createDropZones():input.is(".draglabel")&&dragDropToImageForm.updateDropZones()})),$("fieldset#id_dropzoneheader").on("change input","input, select",(function(e){$(e.target).closest("select, input").is("select")?dragDropToImageForm.createDropZones():dragDropToImageForm.updateDropZones()})),$("fieldset#id_previewareaheader").on("mousedown touchstart",".droppreview",(function(e){dragDropToImageForm.dragStart(e)})),$(window).on("resize",(function(){dragDropToImageForm.updateDropZones()}))},updateVisibilityOfFilePickers:function(){for(var numDrags=dragDropToImageForm.form.getFormValue("noitems",[]),dragNo=0;dragNo<numDrags;dragNo++){var picker=$("input#id_dragitem_"+dragNo).closest(".fitem_ffilepicker");"image"===dragDropToImageForm.form.getFormValue("drags",[dragNo,"dragitemtype"])?picker.show():picker.hide()}},setOptionsForDragItemSelectors:function(){for(var dragItemOptions={0:""},numDrags=dragDropToImageForm.form.getFormValue("noitems",[]),numDrops=dragDropToImageForm.form.getFormValue("nodropzone",[]),dragNo=0;dragNo<numDrags;dragNo++){var label=dragDropToImageForm.form.getFormValue("draglabel",[dragNo]),file=dragDropToImageForm.fp.file(dragDropToImageForm.form.toNameWithIndex("dragitem",[dragNo]));"image"===dragDropToImageForm.form.getFormValue("drags",[dragNo,"dragitemtype"])&&null!==file.name?dragItemOptions[dragNo+1]=dragNo+1+". "+label+" ("+file.name+")":""!==label&&(dragItemOptions[dragNo+1]=dragNo+1+". "+label)}for(var dropNo=0;dropNo<numDrops;dropNo++){var selector=$("#id_drops_"+dropNo+"_choice"),selectedvalue=selector.val();for(var value in selector.find("option").remove(),dragItemOptions)if(dragItemOptions.hasOwnProperty(value)){selector.append('<option value="'+value+'">'+dragItemOptions[value]+"</option>");var optionnode=selector.find('option[value="'+value+'"]');parseInt(value)===parseInt(selectedvalue)?optionnode.attr("selected",!0):dragDropToImageForm.isItemUsed(parseInt(value))&&optionnode.attr("disabled",!0)}}},isItemUsed:function(value){return 0!==value&&(!dragDropToImageForm.form.getFormValue("drags",[value-1,"infinite"])&&0!==$("fieldset#id_dropzoneheader select").filter((function(i,selectNode){return parseInt($(selectNode).val())===value})).length)},dragStart:function(e){var drop=$(e.target).closest(".droppreview");dragDrop.prepare(e).start&&dragDrop.start(e,drop,(function(x,y,drop){dragDropToImageForm.dragMove(drop)}),(function(){dragDropToImageForm.dragEnd()}))},dragMove:function(drop){var backgroundImage=$("fieldset#id_previewareaheader .dropbackground"),backgroundPosition=backgroundImage.offset(),dropNo=drop.data("dropNo"),dropPosition=drop.offset(),left=Math.round(dropPosition.left-backgroundPosition.left),top=Math.round(dropPosition.top-backgroundPosition.top);left=Math.round(Math.max(0,Math.min(left,backgroundImage.outerWidth()-drop.outerWidth()))),top=Math.round(Math.max(0,Math.min(top,backgroundImage.outerHeight()-drop.outerHeight()))),dragDropToImageForm.form.setFormValue("drops",[dropNo,"xleft"],left),dragDropToImageForm.form.setFormValue("drops",[dropNo,"ytop"],top)},dragEnd:function(){dragDropToImageForm.updateDropZones()},form:{toNameWithIndex:function(name,indexes){for(var indexString=name,i=0;i<indexes.length;i++)indexString=indexString+"["+indexes[i]+"]";return indexString},getEl:function(name,indexes){return $("form.mform")[0].elements[this.toNameWithIndex(name,indexes)]},getFormValue:function(name,indexes){var el=this.getEl(name,indexes);return el.type||(el=el[el.length-1]),"checkbox"===el.type?el.checked:el.value},setFormValue:function(name,indexes,value){var el=this.getEl(name,indexes);"checkbox"===el.type?el.checked=value:el.value=value}},filePickers:function(){var draftItemIdsToName,nameToParentNode;void 0===draftItemIdsToName&&(draftItemIdsToName={},nameToParentNode={},$("form.mform input.filepickerhidden").each((function(index,filepicker){draftItemIdsToName[filepicker.value]=filepicker.name,nameToParentNode[filepicker.name]=filepicker.parentNode})));return{file:function(name){var fileAnchor=$(nameToParentNode[name]).find("div.filepicker-filelist a");return fileAnchor.length?{href:fileAnchor.get(0).href,name:fileAnchor.get(0).innerHTML}:{href:null,name:null}},name:function(draftitemid){return draftItemIdsToName[draftitemid]}}}};return{init:dragDropToImageForm.init}}));
/**
 * Library of classes for handling simple shapes.
 *
 * These classes can represent shapes, let you alter them, can go to and from a string
 * representation, and can give you an SVG representation.
 *
 * @package    qtype_ddmarker
 * @subpackage shapes
 * @copyright  2018 The Open University
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("qtype_ddmarker/shapes",(function(){function Point(x,y){this.x=x,this.y=y}function Shape(label,x,y){this.label=label,this.centre=new Point(x||0,y||0)}function Circle(label,x,y,radius){x=x||15,y=y||15,Shape.call(this,label,x,y),this.radius=radius||15}function Rectangle(label,x,y,width,height){Shape.call(this,label,x,y),this.width=width||30,this.height=height||30}function Polygon(label,points){Shape.call(this,label,0,0),this.points=points?points.slice():[new Point(10,10),new Point(40,10),new Point(10,40)],this.normalizeShape(),this.ratio=1}function NullShape(label){Shape.call(this,label)}function createSvgElement(svg,tagName){var svgEl=svg.ownerDocument.createElementNS("http://www.w3.org/2000/svg",tagName);return svg.appendChild(svgEl),svgEl}function createSvgShapeGroup(svg,tagName){var svgEl=createSvgElement(svg,"g");return createSvgElement(svgEl,tagName).setAttribute("class","shape"),createSvgElement(svgEl,"text").setAttribute("class","shapeLabel"),svgEl}return Point.prototype.toString=function(){return this.x+","+this.y},Point.prototype.move=function(dx,dy){this.x+=dx,this.y+=dy},Point.prototype.offset=function(offsetX,offsetY){return offsetX instanceof Point&&(offsetY=offsetX.y,offsetX=offsetX.x),new Point(this.x+offsetX,this.y+offsetY)},Point.parse=function(coordinates){var bits=coordinates.split(",");if(2!==bits.length)throw new Error(coordinates+" is not a valid point");return new Point(Math.round(bits[0]),Math.round(bits[1]))},Shape.prototype.getType=function(){throw new Error("Not implemented.")},Shape.prototype.getCoordinates=function(){throw new Error("Not implemented.")},Shape.prototype.parse=function(coordinates,ratio){throw new Error("Not implemented.")},Shape.prototype.move=function(dx,dy,maxX,maxY){},Shape.prototype.edit=function(handleIndex,dx,dy,maxX,maxY){},Shape.prototype.normalizeShape=function(){},Shape.prototype.makeSvg=function(svg){throw new Error("Not implemented.")},Shape.prototype.updateSvg=function(svgEl){},Shape.prototype.makeSimilarCircle=function(){throw new Error("Not implemented.")},Shape.prototype.makeSimilarRectangle=function(){throw new Error("Not implemented.")},Shape.prototype.makeSimilarPolygon=function(){throw new Error("Not implemented.")},Shape.prototype.getHandlePositions=function(){return null},Circle.prototype=new Shape,Circle.prototype.getType=function(){return"circle"},Circle.prototype.getCoordinates=function(){return this.centre+";"+Math.abs(this.radius)},Circle.prototype.makeSvg=function(svg){var svgEl=createSvgShapeGroup(svg,"circle");return this.updateSvg(svgEl),svgEl},Circle.prototype.updateSvg=function(svgEl){svgEl.childNodes[0].setAttribute("cx",this.centre.x),svgEl.childNodes[0].setAttribute("cy",this.centre.y),svgEl.childNodes[0].setAttribute("r",Math.abs(this.radius)),svgEl.childNodes[1].setAttribute("x",this.centre.x),svgEl.childNodes[1].setAttribute("y",this.centre.y+15),svgEl.childNodes[1].textContent=this.label},Circle.prototype.parse=function(coordinates,ratio){if(!coordinates.match(/^\d+(\.\d+)?,\d+(\.\d+)?;\d+(\.\d+)?$/))return!1;var bits=coordinates.split(";");return this.centre=Point.parse(bits[0]),this.centre.x=this.centre.x*parseFloat(ratio),this.centre.y=this.centre.y*parseFloat(ratio),this.radius=Math.round(bits[1])*parseFloat(ratio),!0},Circle.prototype.move=function(dx,dy,maxX,maxY){this.centre.move(dx,dy),this.centre.x<this.radius&&(this.centre.x=this.radius),this.centre.x>maxX-this.radius&&(this.centre.x=maxX-this.radius),this.centre.y<this.radius&&(this.centre.y=this.radius),this.centre.y>maxY-this.radius&&(this.centre.y=maxY-this.radius)},Circle.prototype.edit=function(handleIndex,dx,dy,maxX,maxY){this.radius+=dx;var limit=Math.min(this.centre.x,this.centre.y,maxX-this.centre.x,maxY-this.centre.y);this.radius>limit&&(this.radius=limit),this.radius<-limit&&(this.radius=-limit)},Circle.prototype.normalizeShape=function(){this.radius=Math.abs(this.radius)},Circle.prototype.makeSimilarRectangle=function(){return new Rectangle(this.label,this.centre.x-this.radius,this.centre.y-this.radius,2*this.radius,2*this.radius)},Circle.prototype.makeSimilarPolygon=function(){return new Polygon(this.label,[this.centre.offset(-this.radius,-this.radius),this.centre.offset(-this.radius,this.radius),this.centre.offset(this.radius,this.radius),this.centre.offset(this.radius,-this.radius)])},Circle.prototype.getHandlePositions=function(){return{moveHandle:this.centre,editHandles:[this.centre.offset(this.radius,0)]}},Rectangle.prototype=new Shape,Rectangle.prototype.getType=function(){return"rectangle"},Rectangle.prototype.getCoordinates=function(){return this.centre+";"+this.width+","+this.height},Rectangle.prototype.makeSvg=function(svg){var svgEl=createSvgShapeGroup(svg,"rect");return this.updateSvg(svgEl),svgEl},Rectangle.prototype.updateSvg=function(svgEl){this.width>=0?(svgEl.childNodes[0].setAttribute("x",this.centre.x),svgEl.childNodes[0].setAttribute("width",this.width)):(svgEl.childNodes[0].setAttribute("x",this.centre.x+this.width),svgEl.childNodes[0].setAttribute("width",-this.width)),this.height>=0?(svgEl.childNodes[0].setAttribute("y",this.centre.y),svgEl.childNodes[0].setAttribute("height",this.height)):(svgEl.childNodes[0].setAttribute("y",this.centre.y+this.height),svgEl.childNodes[0].setAttribute("height",-this.height)),svgEl.childNodes[1].setAttribute("x",this.centre.x+this.width/2),svgEl.childNodes[1].setAttribute("y",this.centre.y+this.height/2+15),svgEl.childNodes[1].textContent=this.label},Rectangle.prototype.parse=function(coordinates,ratio){if(!coordinates.match(/^\d+(\.\d+)?,\d+(\.\d+)?;\d+(\.\d+)?,\d+(\.\d+)?$/))return!1;var bits=coordinates.split(";");this.centre=Point.parse(bits[0]),this.centre.x=this.centre.x*parseFloat(ratio),this.centre.y=this.centre.y*parseFloat(ratio);var size=Point.parse(bits[1]);return this.width=size.x*parseFloat(ratio),this.height=size.y*parseFloat(ratio),!0},Rectangle.prototype.move=function(dx,dy,maxX,maxY){this.centre.move(dx,dy),this.centre.x<0&&(this.centre.x=0),this.centre.x>maxX-this.width&&(this.centre.x=maxX-this.width),this.centre.y<0&&(this.centre.y=0),this.centre.y>maxY-this.height&&(this.centre.y=maxY-this.height)},Rectangle.prototype.edit=function(handleIndex,dx,dy,maxX,maxY){this.width+=dx,this.height+=dy,this.width<-this.centre.x&&(this.width=-this.centre.x),this.width>maxX-this.centre.x&&(this.width=maxX-this.centre.x),this.height<-this.centre.y&&(this.height=-this.centre.y),this.height>maxY-this.centre.y&&(this.height=maxY-this.centre.y)},Rectangle.prototype.normalizeShape=function(){this.width<0&&(this.centre.x+=this.width,this.width=-this.width),this.height<0&&(this.centre.y+=this.height,this.height=-this.height)},Rectangle.prototype.makeSimilarCircle=function(){return new Circle(this.label,Math.round(this.centre.x+this.width/2),Math.round(this.centre.y+this.height/2),Math.round((this.width+this.height)/4))},Rectangle.prototype.makeSimilarPolygon=function(){return new Polygon(this.label,[this.centre,this.centre.offset(0,this.height),this.centre.offset(this.width,this.height),this.centre.offset(this.width,0)])},Rectangle.prototype.getHandlePositions=function(){return{moveHandle:this.centre.offset(this.width/2,this.height/2),editHandles:[this.centre.offset(this.width,this.height)]}},Polygon.prototype=new Shape,Polygon.prototype.getType=function(){return"polygon"},Polygon.prototype.getCoordinates=function(){for(var coordinates="",i=0;i<this.points.length;i++)coordinates+=this.centre.offset(this.points[i])+";";return coordinates.slice(0,coordinates.length-1)},Polygon.prototype.makeSvg=function(svg){var svgEl=createSvgShapeGroup(svg,"polygon");return this.updateSvg(svgEl),svgEl},Polygon.prototype.updateSvg=function(svgEl){svgEl.childNodes[0].setAttribute("points",this.getCoordinates().replace(/[,;]/g," ")),svgEl.childNodes[0].setAttribute("transform","scale("+parseFloat(this.ratio)+")"),svgEl.childNodes[1].setAttribute("x",this.centre.x),svgEl.childNodes[1].setAttribute("y",this.centre.y+15),svgEl.childNodes[1].textContent=this.label},Polygon.prototype.parse=function(coordinates,ratio){if(!coordinates.match(/^\d+(\.\d+)?,\d+(\.\d+)?(?:;\d+(\.\d+)?,\d+(\.\d+)?)*$/))return!1;for(var bits=coordinates.split(";"),points=[],i=0;i<bits.length;i++)points.push(Point.parse(bits[i]));return this.points=points,this.centre.x=0,this.centre.y=0,this.ratio=ratio,this.normalizeShape(),!0},Polygon.prototype.move=function(dx,dy,maxX,maxY){this.centre.move(dx,dy);for(var bbXMin=maxX,bbXMax=0,bbYMin=maxY,bbYMax=0,i=0;i<this.points.length;i++)bbXMin=Math.min(bbXMin,this.points[i].x),bbXMax=Math.max(bbXMax,this.points[i].x),bbYMin=Math.min(bbYMin,this.points[i].y),bbYMax=Math.max(bbYMax,this.points[i].y);this.centre.x<-bbXMin&&(this.centre.x=-bbXMin),this.centre.x>maxX-bbXMax&&(this.centre.x=maxX-bbXMax),this.centre.y<-bbYMin&&(this.centre.y=-bbYMin),this.centre.y>maxY-bbYMax&&(this.centre.y=maxY-bbYMax)},Polygon.prototype.edit=function(handleIndex,dx,dy,maxX,maxY){this.points[handleIndex].move(dx,dy),this.points[handleIndex].x<-this.centre.x&&(this.points[handleIndex].x=-this.centre.x),this.points[handleIndex].x>maxX-this.centre.x&&(this.points[handleIndex].x=maxX-this.centre.x),this.points[handleIndex].y<-this.centre.y&&(this.points[handleIndex].y=-this.centre.y),this.points[handleIndex].y>maxY-this.centre.y&&(this.points[handleIndex].y=maxY-this.centre.y)},Polygon.prototype.addNewPointAfter=function(pointIndex){this.points.splice(pointIndex,0,new Point(this.points[pointIndex].x,this.points[pointIndex].y))},Polygon.prototype.normalizeShape=function(){var i,x=0,y=0;if(0!==this.points.length){for(i=0;i<this.points.length;i++)x+=this.points[i].x,y+=this.points[i].y;if(x=Math.round(x/this.points.length),y=Math.round(y/this.points.length),0!==x||0!==y){for(i=0;i<this.points.length;i++)this.points[i].move(-x,-y);this.centre.move(x,y)}}},Polygon.prototype.makeSimilarCircle=function(){return this.makeSimilarRectangle().makeSimilarCircle()},Polygon.prototype.makeSimilarRectangle=function(){for(var p,minX=0,maxX=0,minY=0,maxY=0,i=0;i<this.points.length;i++)p=this.points[i],minX=Math.min(minX,p.x),maxX=Math.max(maxX,p.x),minY=Math.min(minY,p.y),maxY=Math.max(maxY,p.y);return new Rectangle(this.label,this.centre.x+minX,this.centre.y+minY,Math.max(maxX-minX,10),Math.max(maxY-minY,10))},Polygon.prototype.getHandlePositions=function(){for(var editHandles=[],i=0;i<this.points.length;i++)editHandles.push(this.points[i].offset(this.centre.x,this.centre.y));return this.centre.x=this.centre.x*parseFloat(this.ratio),this.centre.y=this.centre.y*parseFloat(this.ratio),{moveHandle:this.centre,editHandles:editHandles}},NullShape.prototype=new Shape,NullShape.prototype.getType=function(){return"null"},NullShape.prototype.getCoordinates=function(){return""},NullShape.prototype.makeSvg=function(svg){return null},NullShape.prototype.updateSvg=function(svgEl){},NullShape.prototype.parse=function(coordinates){return!1},NullShape.prototype.makeSimilarCircle=function(){return new Circle(this.label)},NullShape.prototype.makeSimilarRectangle=function(){return new Rectangle(this.label)},NullShape.prototype.makeSimilarPolygon=function(){return new Polygon(this.label)},{Point:Point,Shape:Shape,Circle:Circle,Rectangle:Rectangle,Polygon:Polygon,NullShape:NullShape,createSvgElement:createSvgElement,make:function(shapeType,label){switch(shapeType){case"circle":return new Circle(label);case"rectangle":return new Rectangle(label);case"polygon":return new Polygon(label);default:return new NullShape(label)}},getSimilar:function(shapeType,shape){if(shapeType===shape.getType())return shape;switch(shapeType){case"circle":return shape.makeSimilarCircle();case"rectangle":return shape.makeSimilarRectangle();case"polygon":return shape.makeSimilarPolygon();default:return new NullShape(shape.label)}}}}));
/**
 * Question class for drag and drop marker question type, used to support the question and preview pages.
 *
 * @package    qtype_ddmarker
 * @subpackage question
 * @copyright  2018 The Open University
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("qtype_ddmarker/question",["jquery","core/dragdrop","qtype_ddmarker/shapes","core/key_codes"],(function($,dragDrop,Shapes,keys){function DragDropMarkersQuestion(containerId,readOnly,visibleDropZones){this.containerId=containerId,this.visibleDropZones=visibleDropZones,this.shapes=[],this.shapeSVGs=[],this.isPrinting=!1,readOnly&&this.getRoot().addClass("qtype_ddmarker-readonly"),this.cloneDrags(),this.repositionDrags(),this.drawDropzones()}DragDropMarkersQuestion.prototype.drawDropzones=function(){if(this.visibleDropZones.length>0){var bgImage=this.bgImage();this.getRoot().find("div.dropzones").html('<svg xmlns="http://www.w3.org/2000/svg" class="dropzones" width="'+bgImage.outerWidth()+'" height="'+bgImage.outerHeight()+'"></svg>');for(var svg=this.getRoot().find("svg.dropzones"),nextColourIndex=0,dropZoneNo=0;dropZoneNo<this.visibleDropZones.length;dropZoneNo++){var colourClass="color"+nextColourIndex;nextColourIndex=(nextColourIndex+1)%8,this.addDropzone(svg,dropZoneNo,colourClass)}}},DragDropMarkersQuestion.prototype.addDropzone=function(svg,dropZoneNo,colourClass){var existingmarkertext,dropZone=this.visibleDropZones[dropZoneNo],shape=Shapes.make(dropZone.shape,""),bgRatio=this.bgRatio();if(shape.parse(dropZone.coords,bgRatio)){if((existingmarkertext=this.getRoot().find("div.markertexts span.markertext"+dropZoneNo)).length)""!==dropZone.markertext?existingmarkertext.html(dropZone.markertext):existingmarkertext.remove();else if(""!==dropZone.markertext){var classnames="markertext markertext"+dropZoneNo;this.getRoot().find("div.markertexts").append('<span class="'+classnames+'">'+dropZone.markertext+"</span>");var markerspan=this.getRoot().find("div.ddarea div.markertexts span.markertext"+dropZoneNo);if(markerspan.length){var handles=shape.getHandlePositions(),positionLeft=handles.moveHandle.x-markerspan.outerWidth()/2-4,positionTop=handles.moveHandle.y-markerspan.outerHeight()/2;markerspan.css("left",positionLeft).css("top",positionTop),markerspan.data("originX",markerspan.position().left/bgRatio).data("originY",markerspan.position().top/bgRatio),this.handleElementScale(markerspan,"center")}}var shapeSVG=shape.makeSvg(svg[0]);shapeSVG.setAttribute("class","dropzone "+colourClass),this.shapes[this.shapes.length]=shape,this.shapeSVGs[this.shapeSVGs.length]=shapeSVG}},DragDropMarkersQuestion.prototype.repositionDrags=function(){var root=this.getRoot(),thisQ=this;root.find("div.draghomes .marker").not(".dragplaceholder").each((function(key,item){$(item).addClass("unneeded")})),root.find("input.choices").each((function(key,input){var choiceNo=thisQ.getChoiceNoFromElement(input),coords=thisQ.getCoords(input);if(coords.length){var drag=thisQ.getRoot().find(".draghomes span.marker.choice"+choiceNo).not(".dragplaceholder");drag.remove();for(var i=0;i<coords.length;i++){var dragInDrop=drag.clone();dragInDrop.data("pagex",coords[i].x).data("pagey",coords[i].y),thisQ.sendDragToDrop(dragInDrop,!1)}thisQ.getDragClone(drag).addClass("active"),thisQ.cloneDragIfNeeded(drag)}}))},DragDropMarkersQuestion.prototype.getCoords=function(inputNode){var coords=[],val=$(inputNode).val();if(""!==val)for(var coordsStrings=val.split(";"),i=0;i<coordsStrings.length;i++)coords[i]=this.convertToWindowXY(Shapes.Point.parse(coordsStrings[i]));return coords},DragDropMarkersQuestion.prototype.convertToWindowXY=function(point){var bgImage=this.bgImage();return point.offset(bgImage.offset().left+1,bgImage.offset().top+1)},DragDropMarkersQuestion.prototype.convertToBgImgXY=function(point){var bgImage=this.bgImage();return point.offset(-bgImage.offset().left-1,-bgImage.offset().top-1)},DragDropMarkersQuestion.prototype.coordsInBgImg=function(point){var bgImage=this.bgImage(),bgPosition=bgImage.offset();return point.x>=bgPosition.left&&point.x<bgPosition.left+bgImage.width()&&point.y>=bgPosition.top&&point.y<bgPosition.top+bgImage.height()},DragDropMarkersQuestion.prototype.getRoot=function(){return $(document.getElementById(this.containerId))},DragDropMarkersQuestion.prototype.bgImage=function(){return this.getRoot().find("img.dropbackground")},DragDropMarkersQuestion.prototype.handleDragStart=function(e){var thisQ=this,dragged=$(e.target).closest(".marker");if(dragDrop.prepare(e).start){if(dragged.addClass("beingdragged").css("transform",""),!!dragged.hasClass("unneeded")){var hiddenDrag=thisQ.getDragClone(dragged);hiddenDrag.length&&(hiddenDrag.addClass("active"),dragged.offset(hiddenDrag.offset()))}dragDrop.start(e,dragged,(function(){}),(function(x,y,dragged){thisQ.dragEnd(dragged)}))}},DragDropMarkersQuestion.prototype.dragEnd=function(dragged){var dragXY,placed=!1,choiceNo=this.getChoiceNoFromElement(dragged),bgRatio=this.bgRatio();if(dragged.data("pagex",dragged.offset().left).data("pagey",dragged.offset().top),dragXY=new Shapes.Point(dragged.data("pagex"),dragged.data("pagey")),this.coordsInBgImg(dragXY)){this.sendDragToDrop(dragged,!0),placed=!0;var bgImgXY=this.convertToBgImgXY(dragXY);bgImgXY=new Shapes.Point(bgImgXY.x/bgRatio,bgImgXY.y/bgRatio),dragged.data("originX",bgImgXY.x).data("originY",bgImgXY.y)}placed?this.cloneDragIfNeeded(dragged):(this.sendDragHome(dragged),this.removeDragIfNeeded(dragged)),this.saveCoordsForChoice(choiceNo)},DragDropMarkersQuestion.prototype.saveCoordsForChoice=function(choiceNo){var coords=[],items=this.getRoot().find("div.droparea span.marker.choice"+choiceNo),thiQ=this,bgRatio=this.bgRatio();items.length&&items.each((function(){var drag=$(this);if(!drag.hasClass("beingdragged")){var dragXY=new Shapes.Point(drag.data("pagex"),drag.data("pagey"));if(thiQ.coordsInBgImg(dragXY)){var bgImgXY=thiQ.convertToBgImgXY(dragXY);bgImgXY=new Shapes.Point(bgImgXY.x/bgRatio,bgImgXY.y/bgRatio),coords[coords.length]=bgImgXY}}})),this.getRoot().find("input.choice"+choiceNo).val(coords.join(";"))},DragDropMarkersQuestion.prototype.handleKeyPress=function(e){var drag=$(e.target).closest(".marker"),point=new Shapes.Point(drag.offset().left,drag.offset().top),choiceNo=this.getChoiceNoFromElement(drag);switch(e.keyCode){case keys.arrowLeft:case 65:point.x-=1;break;case keys.arrowRight:case 68:point.x+=1;break;case keys.arrowDown:case 83:point.y+=1;break;case keys.arrowUp:case 87:point.y-=1;break;case keys.space:case keys.escape:point=null;break;default:return}if(e.preventDefault(),null!==point){point=this.constrainToBgImg(point),drag.offset({left:point.x,top:point.y}),drag.data("pagex",drag.offset().left).data("pagey",drag.offset().top);var dragXY=this.convertToBgImgXY(new Shapes.Point(drag.data("pagex"),drag.data("pagey")));if(drag.data("originX",dragXY.x/this.bgRatio()).data("originY",dragXY.y/this.bgRatio()),this.coordsInBgImg(new Shapes.Point(drag.offset().left,drag.offset().top))&&drag.hasClass("unneeded")){this.sendDragToDrop(drag,!0);var hiddenDrag=this.getDragClone(drag);hiddenDrag.length&&hiddenDrag.addClass("active"),this.cloneDragIfNeeded(drag)}}else drag.css("left","").css("top",""),drag.data("pagex",drag.offset().left).data("pagey",drag.offset().top),this.sendDragHome(drag),this.removeDragIfNeeded(drag);drag.focus(),this.saveCoordsForChoice(choiceNo)},DragDropMarkersQuestion.prototype.constrainToBgImg=function(windowxy){var bgImg=this.bgImage(),bgImgXY=this.convertToBgImgXY(windowxy);return bgImgXY.x=Math.max(0,bgImgXY.x),bgImgXY.y=Math.max(0,bgImgXY.y),bgImgXY.x=Math.min(bgImg.width(),bgImgXY.x),bgImgXY.y=Math.min(bgImg.height(),bgImgXY.y),this.convertToWindowXY(bgImgXY)},DragDropMarkersQuestion.prototype.getChoiceNoFromElement=function(node){return Number(this.getClassnameNumericSuffix(node,"choice"))},DragDropMarkersQuestion.prototype.getClassnameNumericSuffix=function(node,prefix){var classes=$(node).attr("class");if(void 0!==classes&&""!==classes)for(var classesarr=classes.split(" "),index=0;index<classesarr.length;index++){if(new RegExp("^"+prefix+"([0-9])+$").test(classesarr[index])){var match=new RegExp("([0-9])+$").exec(classesarr[index]);return Number(match[0])}}return null},DragDropMarkersQuestion.prototype.handleResize=function(){var thisQ=this,bgRatio=this.bgRatio();this.isPrinting&&(bgRatio=1),this.getRoot().find("div.droparea .marker").not(".beingdragged").each((function(key,drag){$(drag).css("left",parseFloat($(drag).data("originX"))*parseFloat(bgRatio)).css("top",parseFloat($(drag).data("originY"))*parseFloat(bgRatio)),thisQ.handleElementScale(drag,"left top")})),this.getRoot().find("div.droparea svg.dropzones").width(this.bgImage().width()).height(this.bgImage().height());for(var dropZoneNo=0;dropZoneNo<this.visibleDropZones.length;dropZoneNo++){var originCoords=thisQ.visibleDropZones[dropZoneNo].coords,shape=thisQ.shapes[dropZoneNo],shapeSVG=thisQ.shapeSVGs[dropZoneNo];shape.parse(originCoords,bgRatio),shape.updateSvg(shapeSVG);var handles=shape.getHandlePositions(),markerSpan=this.getRoot().find("div.ddarea div.markertexts span.markertext"+dropZoneNo);markerSpan.css("left",handles.moveHandle.x-markerSpan.outerWidth()/2-4).css("top",handles.moveHandle.y-markerSpan.outerHeight()/2),thisQ.handleElementScale(markerSpan,"center")}},DragDropMarkersQuestion.prototype.cloneDrags=function(){var thisQ=this;this.getRoot().find("div.draghomes span.marker").each((function(index,draghome){var drag=$(draghome),placeHolder=drag.clone();placeHolder.removeClass(),placeHolder.addClass("marker"),placeHolder.addClass("choice"+thisQ.getChoiceNoFromElement(drag)),placeHolder.addClass(thisQ.getDragNoClass(drag,!1)),placeHolder.addClass("dragplaceholder"),drag.before(placeHolder)}))},DragDropMarkersQuestion.prototype.getDragNo=function(drag){return this.getClassnameNumericSuffix(drag,"dragno")},DragDropMarkersQuestion.prototype.getDragNoClass=function(drag,includeSelector){var className="dragno"+this.getDragNo(drag);return this.isInfiniteDrag(drag)&&(className="infinite"),includeSelector?"."+className:className},DragDropMarkersQuestion.prototype.getDragClone=function(drag){return this.getRoot().find(".draghomes span.marker.choice"+this.getChoiceNoFromElement(drag)+this.getDragNoClass(drag,!0)+".dragplaceholder")},DragDropMarkersQuestion.prototype.dropArea=function(){return this.getRoot().find("div.droparea")},DragDropMarkersQuestion.prototype.sendDragHome=function(drag){drag.removeClass("beingdragged").addClass("unneeded").css("top","").css("left","").css("transform","");var placeHolder=this.getDragClone(drag);placeHolder.after(drag),placeHolder.removeClass("active")},DragDropMarkersQuestion.prototype.sendDragToDrop=function(drag,isScaling){var dropArea=this.dropArea(),bgRatio=this.bgRatio();drag.removeClass("beingdragged").removeClass("unneeded");var dragXY=this.convertToBgImgXY(new Shapes.Point(drag.data("pagex"),drag.data("pagey")));isScaling?(drag.data("originX",dragXY.x/bgRatio).data("originY",dragXY.y/bgRatio),drag.css("left",dragXY.x).css("top",dragXY.y)):(drag.data("originX",dragXY.x).data("originY",dragXY.y),drag.css("left",dragXY.x*bgRatio).css("top",dragXY.y*bgRatio)),dropArea.append(drag),this.handleElementScale(drag,"left top")},DragDropMarkersQuestion.prototype.cloneDragIfNeeded=function(drag){var inputNode=this.getInput(drag),noOfDrags=Number(this.getClassnameNumericSuffix(inputNode,"noofdrags")),displayedDragsInDropArea=this.getRoot().find("div.droparea .marker.choice"+this.getChoiceNoFromElement(drag)+this.getDragNoClass(drag,!0)).length,displayedDragsInDragHomes=this.getRoot().find("div.draghomes .marker.choice"+this.getChoiceNoFromElement(drag)+this.getDragNoClass(drag,!0)).not(".dragplaceholder").length;if((this.isInfiniteDrag(drag)||!this.isInfiniteDrag(drag)&&displayedDragsInDropArea<noOfDrags)&&0===displayedDragsInDragHomes){var dragClone=drag.clone();dragClone.addClass("unneeded").css("top","").css("left","").css("transform",""),this.getDragClone(drag).removeClass("active").after(dragClone),questionManager.addEventHandlersToMarker(dragClone)}},DragDropMarkersQuestion.prototype.removeDragIfNeeded=function(drag){for(var dragsInHome=this.getRoot().find("div.draghomes .marker.choice"+this.getChoiceNoFromElement(drag)+this.getDragNoClass(drag,!0)).not(".dragplaceholder"),displayedDrags=dragsInHome.length;displayedDrags>1;)dragsInHome.first().remove(),displayedDrags--},DragDropMarkersQuestion.prototype.getInput=function(drag){var choiceNo=this.getChoiceNoFromElement(drag);return this.getRoot().find("input.choices.choice"+choiceNo)},DragDropMarkersQuestion.prototype.bgRatio=function(){var bgImg=this.bgImage(),bgImgNaturalWidth=bgImg.get(0).naturalWidth;return bgImg.width()/bgImgNaturalWidth},DragDropMarkersQuestion.prototype.handleElementScale=function(element,type){var bgRatio=parseFloat(this.bgRatio());this.isPrinting&&(bgRatio=1),$(element).css({"-webkit-transform":"scale("+bgRatio+")","-moz-transform":"scale("+bgRatio+")","-ms-transform":"scale("+bgRatio+")","-o-transform":"scale("+bgRatio+")",transform:"scale("+bgRatio+")","transform-origin":type})},DragDropMarkersQuestion.prototype.isInfiniteDrag=function(drag){return drag.hasClass("infinite")};var questionManager={eventHandlersInitialised:!1,isPrinting:!1,isKeyboardNavigation:!1,questions:{},init:function(containerId,readOnly,visibleDropZones){questionManager.questions[containerId]=new DragDropMarkersQuestion(containerId,readOnly,visibleDropZones),questionManager.eventHandlersInitialised||(questionManager.setupEventHandlers(),questionManager.eventHandlersInitialised=!0)},setupEventHandlers:function(){questionManager.addEventHandlersToMarker($(".que.ddmarker:not(.qtype_ddmarker-readonly) div.draghomes .marker")),questionManager.addEventHandlersToMarker($(".que.ddmarker:not(.qtype_ddmarker-readonly) div.droparea .marker")),$(window).on("resize",(function(){questionManager.handleWindowResize(!1)})),window.addEventListener("beforeprint",(function(){questionManager.isPrinting=!0,questionManager.handleWindowResize(questionManager.isPrinting)})),window.addEventListener("afterprint",(function(){questionManager.isPrinting=!1,questionManager.handleWindowResize(questionManager.isPrinting)})),setTimeout((function(){questionManager.fixLayoutIfThingsMoved()}),100)},addEventHandlersToMarker:function(element){element.on("mousedown touchstart",questionManager.handleDragStart).on("keydown keypress",questionManager.handleKeyPress).focusin((function(e){questionManager.handleKeyboardFocus(e,!0)})).focusout((function(e){questionManager.handleKeyboardFocus(e,!1)}))},handleDragStart:function(e){e.preventDefault();var question=questionManager.getQuestionForEvent(e);question&&question.handleDragStart(e)},handleKeyPress:function(e){var question=questionManager.getQuestionForEvent(e);question&&question.handleKeyPress(e)},handleWindowResize:function(isPrinting){for(var containerId in questionManager.questions)questionManager.questions.hasOwnProperty(containerId)&&(questionManager.questions[containerId].isPrinting=isPrinting,questionManager.questions[containerId].handleResize())},handleKeyboardFocus:function(e,isNavigating){questionManager.isKeyboardNavigation=isNavigating},fixLayoutIfThingsMoved:function(){questionManager.isKeyboardNavigation||this.handleWindowResize(questionManager.isPrinting),setTimeout((function(){questionManager.fixLayoutIfThingsMoved(questionManager.isPrinting)}),100)},getQuestionForEvent:function(e){var containerId=$(e.currentTarget).closest(".que.ddmarker").attr("id");return questionManager.questions[containerId]}};return{init:questionManager.init}}));
/**
 * This class provides the enhancements to the drag-drop marker editing form.
 *
 * @package    qtype_ddmarker
 * @subpackage form
 * @copyright  2018 The Open University
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("qtype_ddmarker/form",["jquery","core/dragdrop","qtype_ddmarker/shapes"],(function($,dragDrop,Shapes){function DropZoneManager(dropzoneNo){this.dropzoneNo=dropzoneNo,this.svgEl=null,this.shape=Shapes.make(this.getShapeType(),this.getLabel()),this.updateCoordinatesFromForm()}DropZoneManager.prototype.updateCoordinatesFromForm=function(svg){var coordinates=this.getCoordinates(),currentNumPoints="polygon"===this.shape.getType()&&this.shape.points.length;if(this.shape.getCoordinates()!==coordinates&&this.shape.parse(coordinates,1)){if("polygon"===this.shape.getType()&&currentNumPoints!==this.shape.points.length){var currentyActive=this.isActive();this.removeFromSvg(),svg&&(this.addToSvg(svg),currentyActive&&this.setActive())}else this.updateSvgEl();this.setCoordinatesInForm()}},DropZoneManager.prototype.updateLabel=function(){var label=this.getLabel();this.shape.label!==label&&(this.shape.label=label,this.updateSvgEl())},DropZoneManager.prototype.changeShape=function(svg){var newShapeType=this.getShapeType(),currentyActive=this.isActive();newShapeType!==this.shape.getType()&&(this.removeFromSvg(),this.shape=Shapes.getSimilar(newShapeType,this.shape),svg&&(this.addToSvg(svg),currentyActive&&this.setActive()),this.setCoordinatesInForm())},DropZoneManager.prototype.addToSvg=function(svg){if(null!==this.svgEl)throw new Error("this.svgEl already set");if(this.svgEl=this.shape.makeSvg(svg),this.svgEl){this.svgEl.setAttribute("class","dropzone"),this.svgEl.setAttribute("data-dropzone-no",this.dropzoneNo);var handles=this.shape.getHandlePositions();if(null!==handles){var moveHandle=Shapes.createSvgElement(this.svgEl,"circle");moveHandle.setAttribute("cx",handles.moveHandle.x),moveHandle.setAttribute("cy",handles.moveHandle.y),moveHandle.setAttribute("r",7),moveHandle.setAttribute("class","handle move");for(var i=0;i<handles.editHandles.length;++i)this.makeEditHandle(i,handles.editHandles[i])}}},DropZoneManager.prototype.makeEditHandle=function(index,point){var editHandle=Shapes.createSvgElement(this.svgEl,"rect");editHandle.setAttribute("x",point.x-6),editHandle.setAttribute("y",point.y-6),editHandle.setAttribute("width",11),editHandle.setAttribute("height",11),editHandle.setAttribute("class","handle edit"),editHandle.setAttribute("data-edit-handle-no",index)},DropZoneManager.prototype.removeFromSvg=function(){null!==this.svgEl&&(this.svgEl.parentNode.removeChild(this.svgEl),this.svgEl=null)},DropZoneManager.prototype.updateSvgEl=function(){if(null!==this.svgEl){this.shape.updateSvg(this.svgEl);var handles=this.shape.getHandlePositions();if(null!==handles){this.svgEl.childNodes[2].setAttribute("cx",handles.moveHandle.x),this.svgEl.childNodes[2].setAttribute("cy",handles.moveHandle.y);for(var i=0;i<handles.editHandles.length;++i)this.svgEl.childNodes[3+i].setAttribute("x",handles.editHandles[i].x-6),this.svgEl.childNodes[3+i].setAttribute("y",handles.editHandles[i].y-6)}}},DropZoneManager.prototype.isActive=function(){return null!==this.svgEl&&this.svgEl.getAttribute("class").match(/\bactive\b/)},DropZoneManager.prototype.setActive=function(){var parent=this.svgEl.parentNode;parent.removeChild(this.svgEl),parent.appendChild(this.svgEl),this.svgEl.setAttribute("class",this.svgEl.getAttribute("class")+" active")},DropZoneManager.prototype.setCoordinatesInForm=function(){dragDropForm.form.setFormValue("drops",[this.dropzoneNo,"coords"],this.shape.getCoordinates())},DropZoneManager.prototype.getCoordinates=function(){return dragDropForm.form.getFormValue("drops",[this.dropzoneNo,"coords"]).replace(/\s*/g,"")},DropZoneManager.prototype.getChoiceNo=function(){return dragDropForm.form.getFormValue("drops",[this.dropzoneNo,"choice"])},DropZoneManager.prototype.getLabel=function(){return dragDropForm.form.getMarkerText(this.getChoiceNo())},DropZoneManager.prototype.getShapeType=function(){return dragDropForm.form.getFormValue("drops",[this.dropzoneNo,"shape"])},DropZoneManager.prototype.handleMove=function(e){var info=dragDrop.prepare(e);if(info.start){var movingDropZone=this,lastX=info.x,lastY=info.y,dragProxy=this.makeDragProxy(info.x,info.y),bgImg=$("fieldset#id_previewareaheader .dropbackground"),maxX=bgImg.width(),maxY=bgImg.height();dragDrop.start(e,$(dragProxy),(function(pageX,pageY){movingDropZone.shape.move(pageX-lastX,pageY-lastY,maxX,maxY),lastX=pageX,lastY=pageY,movingDropZone.updateSvgEl(),movingDropZone.setCoordinatesInForm()}),(function(){document.body.removeChild(dragProxy)}))}},DropZoneManager.prototype.handleEdit=function(e,handleIndex,svg){var info=dragDrop.prepare(e);if(info.start){"polygon"===this.shape.getType()&&(e.ctrlKey||e.metaKey)&&(this.shape.addNewPointAfter(handleIndex),this.removeFromSvg(),this.addToSvg(svg),this.setActive());var changingDropZone=this,lastX=info.x,lastY=info.y,dragProxy=this.makeDragProxy(info.x,info.y),bgImg=$("fieldset#id_previewareaheader .dropbackground"),maxX=bgImg.width(),maxY=bgImg.height();dragDrop.start(e,$(dragProxy),(function(pageX,pageY){changingDropZone.shape.edit(handleIndex,pageX-lastX,pageY-lastY,maxX,maxY),lastX=pageX,lastY=pageY,changingDropZone.updateSvgEl(),changingDropZone.setCoordinatesInForm()}),(function(){document.body.removeChild(dragProxy),changingDropZone.shape.normalizeShape(),changingDropZone.updateSvgEl(),changingDropZone.setCoordinatesInForm()}))}},DropZoneManager.prototype.makeDragProxy=function(x,y){var dragProxy=document.createElement("div");return dragProxy.style.position="absolute",dragProxy.style.top=y+"px",dragProxy.style.left=x+"px",dragProxy.style.width="1px",dragProxy.style.height="1px",document.body.appendChild(dragProxy),dragProxy};var dragDropForm={fp:null,noDropZones:null,dropZones:[],init:function(){dragDropForm.fp=dragDropForm.filePickers(),dragDropForm.noDropZones=dragDropForm.form.getFormValue("nodropzone",[]),dragDropForm.setupPreviewArea(),dragDropForm.setOptionsForDragItemSelectors(),dragDropForm.createShapes(),dragDropForm.setupEventHandlers(),dragDropForm.waitForFilePickerToInitialise()},setupPreviewArea:function(){$("fieldset#id_previewareaheader div.fcontainer").append('<div class="ddarea que ddmarker">   <div id="ddm-droparea" class="droparea">       <img class="dropbackground" />       <div id="ddm-dropzone" class="dropzones">       </div>   </div></div>')},setOptionsForDragItemSelectors:function(){var selector,i,label,dragItemsOptions={0:""},noItems=dragDropForm.form.getFormValue("noitems",[]),selectedValues=[];for(i=1;i<=noItems;i++)""!==(label=dragDropForm.form.getMarkerText(i))&&(dragItemsOptions[i]=$("<div/>").text(label).html());for(i=0;i<dragDropForm.noDropZones;i++)selector=$("#id_drops_"+i+"_choice"),selectedValues[i]=Number(selector.val());for(i=0;i<dragDropForm.noDropZones;i++){for(var value in(selector=$("#id_drops_"+i+"_choice")).find("option").remove(),dragItemsOptions){var option='<option value="'+(value=Number(value))+'">'+dragItemsOptions[value]+"</option>";selector.append(option);var optionnode=selector.find('option[value="'+value+'"]');if(0!==value)if(value!==selectedValues[i]){var noofdrags=dragDropForm.form.getFormValue("drags",[value-1,"noofdrags"]);if(0!==Number(noofdrags))for(var k in selectedValues)if(Number(selectedValues[k])===value){if(1===Number(noofdrags)){optionnode.attr("disabled",!0);break}noofdrags--}}else optionnode.attr("selected",!0)}dragDropForm.dropZones.length>0&&dragDropForm.dropZones[i].updateLabel()}},createShapes:function(){for(var dropzoneNo=0;dropzoneNo<dragDropForm.noDropZones;dropzoneNo++)dragDropForm.dropZones[dropzoneNo]=new DropZoneManager(dropzoneNo)},setupEventHandlers:function(){$("fieldset#id_draggableitemheader").on("change input","input, select",(function(){dragDropForm.setOptionsForDragItemSelectors()})),$("fieldset#id_dropzoneheader").on("change input","input, select",(function(e){var ids=e.currentTarget.name.match(/^drops\[(\d+)]\[([a-z]*)]$/);if(ids){var dropzoneNo=ids[1],inputType=ids[2],dropZone=dragDropForm.dropZones[dropzoneNo];switch(inputType){case"shape":dropZone.changeShape(dragDropForm.form.getSvg());break;case"coords":dropZone.updateCoordinatesFromForm(dragDropForm.form.getSvg());break;case"choice":dropZone.updateLabel()}}}));var previewArea=$("fieldset#id_previewareaheader");previewArea.on("click","g.dropzone",(function(e){var dropzoneNo=$(e.currentTarget).data("dropzone-no"),currentlyActive=dragDropForm.dropZones[dropzoneNo].isActive();$(dragDropForm.form.getSvg()).find(".dropzone.active").removeClass("active"),currentlyActive||dragDropForm.dropZones[dropzoneNo].setActive()})),previewArea.on("mousedown touchstart",".dropzone .handle.move",(function(e){var dropzoneNo=$(e.currentTarget).closest("g").data("dropzoneNo");dragDropForm.dropZones[dropzoneNo].handleMove(e)})),previewArea.on("mousedown touchstart",".dropzone .handle.edit",(function(e){var dropzoneNo=$(e.currentTarget).closest("g").data("dropzoneNo"),handleIndex=e.currentTarget.getAttribute("data-edit-handle-no");dragDropForm.dropZones[dropzoneNo].handleEdit(e,handleIndex,dragDropForm.form.getSvg())}))},waitForFilePickerToInitialise:function(){null!==dragDropForm.fp.file("bgimage").href?($("form.mform").on("change","#id_bgimage",dragDropForm.loadPreviewImage),dragDropForm.loadPreviewImage()):setTimeout(dragDropForm.waitForFilePickerToInitialise,1e3)},loadPreviewImage:function(){$("fieldset#id_previewareaheader .dropbackground").one("load",dragDropForm.afterPreviewImageLoaded).attr("src",dragDropForm.fp.file("bgimage").href)},afterPreviewImageLoaded:function(){var bgImg=$("fieldset#id_previewareaheader .dropbackground");$("#ddm-dropzone").css("position","relative").css("top",-1*(bgImg.height()+1)),$("#ddm-droparea").css("height",bgImg.height()+20),dragDropForm.updateSvgDisplay()},updateSvgDisplay:function(){var dropzoneNo,bgImg=$("fieldset#id_previewareaheader .dropbackground");if(dragDropForm.form.getSvg())for(dropzoneNo=0;dropzoneNo<dragDropForm.noDropZones;dropzoneNo++)dragDropForm.dropZones[dropzoneNo].updateSvgEl();else for($("#ddm-dropzone").html('<svg xmlns="http://www.w3.org/2000/svg" class="dropzones" width="'+bgImg.outerWidth()+'" height="'+bgImg.outerHeight()+'"></svg>'),dropzoneNo=0;dropzoneNo<dragDropForm.noDropZones;dropzoneNo++)dragDropForm.dropZones[dropzoneNo].addToSvg(dragDropForm.form.getSvg())},form:{getMarkerText:function(markerNo){return 0!==Number(markerNo)?dragDropForm.form.getFormValue("drags",[markerNo-1,"label"]).replace(new RegExp("^\\s*(.*)\\s*$"),"$1"):""},getSvg:function(){var svg=$("fieldset#id_previewareaheader svg");return 0===svg.length?null:svg[0]},toNameWithIndex:function(name,indexes){for(var indexString=name,i=0;i<indexes.length;i++)indexString=indexString+"["+indexes[i]+"]";return indexString},getEl:function(name,indexes){return $("form.mform")[0].elements[this.toNameWithIndex(name,indexes)]},getFormValue:function(name,indexes){var el=this.getEl(name,indexes);return"checkbox"===el.type?el.checked:el.value},setFormValue:function(name,indexes,value){var el=this.getEl(name,indexes);"checkbox"===el.type?el.checked=value:el.value=value}},filePickers:function(){var draftItemIdsToName,nameToParentNode;return void 0===draftItemIdsToName&&(draftItemIdsToName={},nameToParentNode={},$("form.mform input.filepickerhidden").each((function(key,filepicker){draftItemIdsToName[filepicker.value]=filepicker.name,nameToParentNode[filepicker.name]=filepicker.parentNode}))),{file:function(name){var fileAnchor=$(nameToParentNode[name]).find("div.filepicker-filelist a");return fileAnchor.length?{href:fileAnchor.get(0).href,name:fileAnchor.get(0).innerHTML}:{href:null,name:null}},name:function(draftitemid){return draftItemIdsToName[draftitemid]}}}};return{init:dragDropForm.init}}));
/**
 * JavaScript to make drag-drop into text questions work.
 *
 * Some vocabulary to help understand this code:
 *
 * The question text contains 'drops' - blanks into which the 'drags', the missing
 * words, can be put.
 *
 * The thing that can be moved into the drops are called 'drags'. There may be
 * multiple copies of the 'same' drag which does not really cause problems.
 * Each drag has a 'choice' number which is the value set on the drop's hidden
 * input when this drag is placed in a drop.
 *
 * These may be in separate 'groups', distinguished by colour.
 * Things can only interact with other things in the same group.
 * The groups are numbered from 1.
 *
 * The place where a given drag started from is called its 'home'.
 *
 * @module     qtype_ddwtos/ddwtos
 * @package    qtype_ddwtos
 * @copyright  2018 The Open University
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.6
 */
define("qtype_ddwtos/ddwtos",["jquery","core/dragdrop","core/key_codes"],(function($,dragDrop,keys){function DragDropToTextQuestion(containerId,readOnly){this.containerId=containerId,readOnly&&this.getRoot().addClass("qtype_ddwtos-readonly"),this.resizeAllDragsAndDrops(),this.cloneDrags(),this.positionDrags()}DragDropToTextQuestion.prototype.resizeAllDragsAndDrops=function(){var thisQ=this;this.getRoot().find(".answercontainer > div").each((function(i,node){thisQ.resizeAllDragsAndDropsInGroup(thisQ.getClassnameNumericSuffix($(node),"draggrouphomes"))}))},DragDropToTextQuestion.prototype.resizeAllDragsAndDropsInGroup=function(group){var thisQ=this,dragHomes=this.getRoot().find(".draggrouphomes"+group+" span.draghome"),maxWidth=0,maxHeight=0;dragHomes.each((function(i,drag){maxWidth=Math.max(maxWidth,Math.ceil(drag.offsetWidth)),maxHeight=Math.max(maxHeight,Math.ceil(0+drag.offsetHeight))})),maxWidth+=8,maxHeight+=2,dragHomes.each((function(i,drag){thisQ.setElementSize(drag,maxWidth,maxHeight)})),this.getRoot().find("span.drop.group"+group).each((function(i,drop){thisQ.setElementSize(drop,maxWidth,maxHeight)}))},DragDropToTextQuestion.prototype.setElementSize=function(element,width,height){$(element).width(width).height(height).css("lineHeight",height+"px")},DragDropToTextQuestion.prototype.cloneDrags=function(){var thisQ=this;thisQ.getRoot().find("span.draghome").each((function(index,draghome){var drag=$(draghome),placeHolder=drag.clone();placeHolder.removeClass(),placeHolder.addClass("draghome choice"+thisQ.getChoice(drag)+" group"+thisQ.getGroup(drag)+" dragplaceholder"),drag.before(placeHolder)}))},DragDropToTextQuestion.prototype.positionDrags=function(){var thisQ=this,root=this.getRoot();root.find("span.draghome").not(".dragplaceholder").each((function(i,dragNode){var drag=$(dragNode),currentPlace=thisQ.getClassnameNumericSuffix(drag,"inplace");drag.addClass("unplaced").removeClass("placed"),drag.removeAttr("tabindex"),null!==currentPlace&&drag.removeClass("inplace"+currentPlace)})),root.find("input.placeinput").each((function(i,inputNode){var input=$(inputNode),choice=input.val(),place=thisQ.getPlace(input),drop=root.find(".drop.place"+place),dropPosition=drop.offset();if(drop.data("prev-top",dropPosition.top).data("prev-left",dropPosition.left),"0"!==choice){var unplacedDrag=thisQ.getUnplacedChoice(thisQ.getGroup(input),choice),hiddenDrag=thisQ.getDragClone(unplacedDrag);if(hiddenDrag.length)if(unplacedDrag.hasClass("infinite")){var noOfDrags=thisQ.noOfDropsInGroup(thisQ.getGroup(unplacedDrag));if(thisQ.getInfiniteDragClones(unplacedDrag,!1).length<noOfDrags){var cloneDrag=unplacedDrag.clone();hiddenDrag.after(cloneDrag),questionManager.addEventHandlersToDrag(cloneDrag)}else hiddenDrag.addClass("active")}else hiddenDrag.addClass("active");thisQ.sendDragToDrop(thisQ.getUnplacedChoice(thisQ.getGroup(input),choice),drop)}}))},DragDropToTextQuestion.prototype.handleDragStart=function(e){var thisQ=this,drag=$(e.target).closest(".draghome");if(dragDrop.prepare(e).start){drag.addClass("beingdragged");var currentPlace=this.getClassnameNumericSuffix(drag,"inplace");if(null!==currentPlace){this.setInputValue(currentPlace,0),drag.removeClass("inplace"+currentPlace);var hiddenDrop=thisQ.getDrop(drag,currentPlace);hiddenDrop.length&&(hiddenDrop.addClass("active"),drag.offset(hiddenDrop.offset()))}else{var hiddenDrag=thisQ.getDragClone(drag);if(hiddenDrag.length)if(drag.hasClass("infinite")){var noOfDrags=this.noOfDropsInGroup(this.getGroup(drag));if(this.getInfiniteDragClones(drag,!1).length<noOfDrags){var cloneDrag=drag.clone();cloneDrag.removeClass("beingdragged"),hiddenDrag.after(cloneDrag),questionManager.addEventHandlersToDrag(cloneDrag),drag.offset(cloneDrag.offset())}else hiddenDrag.addClass("active"),drag.offset(hiddenDrag.offset())}else hiddenDrag.addClass("active"),drag.offset(hiddenDrag.offset())}dragDrop.start(e,drag,(function(x,y,drag){thisQ.dragMove(x,y,drag)}),(function(x,y,drag){thisQ.dragEnd(x,y,drag)}))}},DragDropToTextQuestion.prototype.dragMove=function(pageX,pageY,drag){var thisQ=this;this.getRoot().find("span.drop.group"+this.getGroup(drag)).each((function(i,dropNode){var drop=$(dropNode);thisQ.isPointInDrop(pageX,pageY,drop)?drop.addClass("valid-drag-over-drop"):drop.removeClass("valid-drag-over-drop")})),this.getRoot().find("span.draghome.placed.group"+this.getGroup(drag)).not(".beingdragged").each((function(i,dropNode){var drop=$(dropNode);thisQ.isPointInDrop(pageX,pageY,drop)&&!thisQ.isDragSameAsDrop(drag,drop)?drop.addClass("valid-drag-over-drop"):drop.removeClass("valid-drag-over-drop")}))},DragDropToTextQuestion.prototype.dragEnd=function(pageX,pageY,drag){var thisQ=this,root=this.getRoot(),placed=!1;root.find("span.drop.group"+this.getGroup(drag)).each((function(i,dropNode){var drop=$(dropNode);return!thisQ.isPointInDrop(pageX,pageY,drop)||(drop.removeClass("valid-drag-over-drop"),thisQ.sendDragToDrop(drag,drop),placed=!0,!1)})),root.find("span.draghome.placed.group"+this.getGroup(drag)).not(".beingdragged").each((function(i,placedNode){var placedDrag=$(placedNode);if(!thisQ.isPointInDrop(pageX,pageY,placedDrag)||thisQ.isDragSameAsDrop(drag,placedDrag))return!0;placedDrag.removeClass("valid-drag-over-drop");var currentPlace=thisQ.getClassnameNumericSuffix(placedDrag,"inplace"),drop=thisQ.getDrop(drag,currentPlace);return thisQ.sendDragToDrop(drag,drop),placed=!0,!1})),placed||this.sendDragHome(drag)},DragDropToTextQuestion.prototype.sendDragToDrop=function(drag,drop){var oldDrag=this.getCurrentDragInPlace(this.getPlace(drop));if(0!==oldDrag.length){var currentPlace=this.getClassnameNumericSuffix(oldDrag,"inplace"),hiddenDrop=this.getDrop(oldDrag,currentPlace);hiddenDrop.addClass("active"),oldDrag.addClass("beingdragged"),oldDrag.offset(hiddenDrop.offset()),this.sendDragHome(oldDrag)}0===drag.length?(this.setInputValue(this.getPlace(drop),0),drop.data("isfocus")&&drop.focus()):(this.setInputValue(this.getPlace(drop),this.getChoice(drag)),drag.removeClass("unplaced").addClass("placed inplace"+this.getPlace(drop)),drag.attr("tabindex",0),this.animateTo(drag,drop))},DragDropToTextQuestion.prototype.sendDragHome=function(drag){var currentPlace=this.getClassnameNumericSuffix(drag,"inplace");null!==currentPlace&&drag.removeClass("inplace"+currentPlace),drag.data("unplaced",!0),this.animateTo(drag,this.getDragHome(this.getGroup(drag),this.getChoice(drag)))},DragDropToTextQuestion.prototype.handleKeyPress=function(e){var drop=$(e.target).closest(".drop");if(0===drop.length){var placedDrag=$(e.target),currentPlace=this.getClassnameNumericSuffix(placedDrag,"inplace");null!==currentPlace&&(drop=this.getDrop(placedDrag,currentPlace))}var currentDrag=this.getCurrentDragInPlace(this.getPlace(drop)),nextDrag=$();switch(e.keyCode){case keys.space:case keys.arrowRight:case keys.arrowDown:nextDrag=this.getNextDrag(this.getGroup(drop),currentDrag);break;case keys.arrowLeft:case keys.arrowUp:nextDrag=this.getPreviousDrag(this.getGroup(drop),currentDrag);break;case keys.escape:break;default:return void(questionManager.isKeyboardNavigation=!1)}if(nextDrag.length){nextDrag.data("isfocus",!0),nextDrag.addClass("beingdragged");var hiddenDrag=this.getDragClone(nextDrag);if(hiddenDrag.length)if(nextDrag.hasClass("infinite")){var noOfDrags=this.noOfDropsInGroup(this.getGroup(nextDrag));if(this.getInfiniteDragClones(nextDrag,!1).length<noOfDrags){var cloneDrag=nextDrag.clone();cloneDrag.removeClass("beingdragged"),cloneDrag.removeAttr("tabindex"),hiddenDrag.after(cloneDrag),questionManager.addEventHandlersToDrag(cloneDrag),nextDrag.offset(cloneDrag.offset())}else hiddenDrag.addClass("active"),nextDrag.offset(hiddenDrag.offset())}else hiddenDrag.addClass("active"),nextDrag.offset(hiddenDrag.offset())}else drop.data("isfocus",!0);e.preventDefault(),this.sendDragToDrop(nextDrag,drop)},DragDropToTextQuestion.prototype.getNextDrag=function(group,drag){var choice,numChoices=this.noOfChoicesInGroup(group);choice=0===drag.length?1:this.getChoice(drag)+1;for(var next=this.getUnplacedChoice(group,choice);0===next.length&&choice<numChoices;)choice++,next=this.getUnplacedChoice(group,choice);return next},DragDropToTextQuestion.prototype.getPreviousDrag=function(group,drag){var choice;choice=0===drag.length?this.noOfChoicesInGroup(group):this.getChoice(drag)-1;for(var previous=this.getUnplacedChoice(group,choice);0===previous.length&&choice>1;)choice--,previous=this.getUnplacedChoice(group,choice);return previous},DragDropToTextQuestion.prototype.animateTo=function(drag,target){var currentPos=drag.offset(),targetPos=target.offset(),thisQ=this;M.util.js_pending("qtype_ddwtos-animate-"+thisQ.containerId),drag.animate({left:parseInt(drag.css("left"))+targetPos.left-currentPos.left,top:parseInt(drag.css("top"))+targetPos.top-currentPos.top},{duration:"fast",done:function(){$("body").trigger("qtype_ddwtos-dragmoved",[drag,target,thisQ]),M.util.js_complete("qtype_ddwtos-animate-"+thisQ.containerId)}})},DragDropToTextQuestion.prototype.isPointInDrop=function(pageX,pageY,drop){var position=drop.offset();return pageX>=position.left&&pageX<position.left+drop.width()&&pageY>=position.top&&pageY<position.top+drop.height()},DragDropToTextQuestion.prototype.setInputValue=function(place,choice){this.getRoot().find("input.placeinput.place"+place).val(choice)},DragDropToTextQuestion.prototype.getRoot=function(){return $(document.getElementById(this.containerId))},DragDropToTextQuestion.prototype.getDragHome=function(group,choice){return this.getRoot().find(".draghome.dragplaceholder.group"+group+".choice"+choice).is(":visible")?this.getRoot().find(".draghome.dragplaceholder.group"+group+".choice"+choice):this.getRoot().find(".draggrouphomes"+group+" span.draghome.infinite.choice"+choice+".group"+group)},DragDropToTextQuestion.prototype.getUnplacedChoice=function(group,choice){return this.getRoot().find(".draghome.group"+group+".choice"+choice+".unplaced").slice(0,1)},DragDropToTextQuestion.prototype.getCurrentDragInPlace=function(place){return this.getRoot().find("span.draghome.inplace"+place)},DragDropToTextQuestion.prototype.noOfDropsInGroup=function(group){return this.getRoot().find(".drop.group"+group).length},DragDropToTextQuestion.prototype.noOfChoicesInGroup=function(group){return this.getRoot().find(".draghome.group"+group).length},DragDropToTextQuestion.prototype.getClassnameNumericSuffix=function(node,prefix){var classes=node.attr("class");if(""!==classes)for(var classesArr=classes.split(" "),index=0;index<classesArr.length;index++){if(new RegExp("^"+prefix+"([0-9])+$").test(classesArr[index])){var match=new RegExp("([0-9])+$").exec(classesArr[index]);return Number(match[0])}}return null},DragDropToTextQuestion.prototype.getChoice=function(drag){return this.getClassnameNumericSuffix(drag,"choice")},DragDropToTextQuestion.prototype.getGroup=function(node){return this.getClassnameNumericSuffix(node,"group")},DragDropToTextQuestion.prototype.getPlace=function(node){return this.getClassnameNumericSuffix(node,"place")},DragDropToTextQuestion.prototype.getDragClone=function(drag){return this.getRoot().find(".draggrouphomes"+this.getGroup(drag)+" span.draghome.choice"+this.getChoice(drag)+".group"+this.getGroup(drag)+".dragplaceholder")},DragDropToTextQuestion.prototype.getInfiniteDragClones=function(drag,inHome){return inHome?this.getRoot().find(".draggrouphomes"+this.getGroup(drag)+" span.draghome.choice"+this.getChoice(drag)+".group"+this.getGroup(drag)+".infinite").not(".dragplaceholder"):this.getRoot().find("span.draghome.choice"+this.getChoice(drag)+".group"+this.getGroup(drag)+".infinite").not(".dragplaceholder")},DragDropToTextQuestion.prototype.getDrop=function(drag,currentPlace){return this.getRoot().find(".drop.group"+this.getGroup(drag)+".place"+currentPlace)},DragDropToTextQuestion.prototype.isDragSameAsDrop=function(drag,drop){return this.getChoice(drag)===this.getChoice(drop)&&this.getGroup(drag)===this.getGroup(drop)};var questionManager={eventHandlersInitialised:!1,isKeyboardNavigation:!1,questions:{},init:function(containerId,readOnly){questionManager.questions[containerId]=new DragDropToTextQuestion(containerId,readOnly),questionManager.eventHandlersInitialised||(questionManager.setupEventHandlers(),questionManager.eventHandlersInitialised=!0)},setupEventHandlers:function(){questionManager.addEventHandlersToDrag($(".que.ddwtos:not(.qtype_ddwtos-readonly) span.draghome")),$("body").on("keydown",".que.ddwtos:not(.qtype_ddwtos-readonly) span.drop",questionManager.handleKeyPress).on("keydown",".que.ddwtos:not(.qtype_ddwtos-readonly) span.draghome.placed:not(.beingdragged)",questionManager.handleKeyPress).on("qtype_ddwtos-dragmoved",questionManager.handleDragMoved)},addEventHandlersToDrag:function(element){element.unbind("mousedown touchstart"),element.on("mousedown touchstart",questionManager.handleDragStart)},handleDragStart:function(e){e.preventDefault();var question=questionManager.getQuestionForEvent(e);question&&question.handleDragStart(e)},handleKeyPress:function(e){if(!questionManager.isKeyboardNavigation){questionManager.isKeyboardNavigation=!0;var question=questionManager.getQuestionForEvent(e);question&&question.handleKeyPress(e)}},getQuestionForEvent:function(e){var containerId=$(e.currentTarget).closest(".que.ddwtos").attr("id");return questionManager.questions[containerId]},handleDragMoved:function(e,drag,target,thisQ){drag.removeClass("beingdragged"),drag.css("top","").css("left",""),target.after(drag),target.removeClass("active"),void 0!==drag.data("unplaced")&&!0===drag.data("unplaced")&&(drag.removeClass("placed").addClass("unplaced"),drag.removeAttr("tabindex"),drag.removeData("unplaced"),drag.hasClass("infinite")&&thisQ.getInfiniteDragClones(drag,!0).length>1&&thisQ.getInfiniteDragClones(drag,!0).first().remove()),void 0!==drag.data("isfocus")&&!0===drag.data("isfocus")&&(drag.focus(),drag.removeData("isfocus")),void 0!==target.data("isfocus")&&!0===target.data("isfocus")&&target.removeData("isfocus"),questionManager.isKeyboardNavigation&&(questionManager.isKeyboardNavigation=!1)}};return{init:questionManager.init}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("qtype_formulas/instantiation",["exports","core/notification","core/str","core/pending","core/ajax","qtype_formulas/tabulator"],(function(_exports,Notification,String,_pending,_ajax,_tabulator){var obj;function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||_unsupportedIterableToArray(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(_e2){didErr=!0,err=_e2},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,Notification=_interopRequireWildcard(Notification),String=_interopRequireWildcard(String),_pending=(obj=_pending)&&obj.__esModule?obj:{default:obj};var _ref,_ref2,_ref3,numberOfParts=0,extendTabulator=function(){_tabulator.TabulatorFull.extendModule("columnCalcs","calculations",{stats:function(values){var _step,count=0,min=1/0,max=-1/0,sum=0,_iterator=_createForOfIteratorHelper(values);try{for(_iterator.s();!(_step=_iterator.n()).done;){var value=_step.value;sum+=parseFloat(value),min=Math.min(min,value),max=Math.max(max,value),count++}}catch(err){_iterator.e(err)}finally{_iterator.f()}return min===max?["","",""]:count>0&&!isNaN(sum)?[(sum/count).toFixed(1),min,max]:["","",""]}})},initTable=function(){new _tabulator.TabulatorFull("#varsdata_display",{selectable:1,movableColumns:!0,pagination:"local",paginationSize:10,paginationButtonCount:0,columns:[{title:"#",field:"id"}],langs:{default:{pagination:{first:"",last:"",prev:"",next:""}}}}).on("rowSelected",previewQuestionWithDataset)},quoteNonNumericValue=function quoteNonNumericValue(value){if(!isNaN(value))return value;if(value.startsWith("[")){var _step2,quotedElements=[],_iterator2=_createForOfIteratorHelper((value=value.substring(1,value.length-1)).split(/\s*,\s*/));try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var element=_step2.value;quotedElements.push(quoteNonNumericValue(element))}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}return"["+quotedElements.join(", ")+"]"}return'"'.concat(value,'"')},fetchTextFromEditor=function(id){return void 0!==window.tinyMCE&&null!==window.tinyMCE.get(id)?window.tinyMCE.get(id).getContent():document.getElementById(id).value},previewQuestionWithDataset=(_ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(row){var data,questionvars,partvars,varname,index,parttexts,i,pendingPromise,renderedTexts;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!row.getElement().classList.contains("tabulator-calcs")){_context.next=2;break}return _context.abrupt("return");case 2:data=row.getData(),questionvars="",partvars=Array(numberOfParts).fill(""),_context.t0=regeneratorRuntime.keys(data);case 6:if((_context.t1=_context.t0()).done){_context.next=17;break}if((varname=_context.t1.value).match(/^(random|global)_/)&&(questionvars+=varname.replace(/^(random|global)_([^*]+)\*?$/,"$2")+"=",questionvars+=quoteNonNumericValue(data[varname])+";"),!varname.match(/^part_(\d+)_/)){_context.next=15;break}if(!varname.match(/^part_(\d+)__/)){_context.next=12;break}return _context.abrupt("continue",6);case 12:index=parseInt(varname.replace(/^part_(\d+)_.*$/,"$1")),partvars[index]+=varname.replace(/^part_(\d+)_([^*]+)\*?$/,"$2")+"=",partvars[index]+=quoteNonNumericValue(data[varname])+";";case 15:_context.next=6;break;case 17:for(window.console.log(questionvars,partvars),parttexts=[],i=0;i<numberOfParts;i++)parttexts[i]=fetchTextFromEditor("id_subqtext_".concat(i));return pendingPromise=new _pending.default("qtype_formulas/questionpreview"),_context.prev=21,_context.next=24,(0,_ajax.call)([{methodname:"qtype_formulas_render_question_text",args:{questiontext:fetchTextFromEditor("id_questiontext"),parttexts:parttexts,globalvars:questionvars,partvars:partvars}}])[0];case 24:renderedTexts=_context.sent,showRenderedQuestionAndParts(renderedTexts),_context.next=31;break;case 28:_context.prev=28,_context.t2=_context.catch(21),Notification.exception(_context.t2);case 31:pendingPromise.resolve();case 32:case"end":return _context.stop()}}),_callee,null,[[21,28]])}))),function(_x){return _ref.apply(this,arguments)}),showRenderedQuestionAndParts=function(data){var div=document.getElementById("qtextpreview_display");div.innerHTML=data.question;var _step3,_iterator3=_createForOfIteratorHelper(data.parts);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var text=_step3.value;div.innerHTML+=text}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}!function(element){if(void 0!==window.MathJax){var version=window.MathJax.version;"2"!=version[0]?"3"==version[0]&&window.MathJax.typesetPromise([element]):window.MathJax.Hub.Queue(["Typeset",window.MathJax.Hub,element])}}(div)},prepareTableColumns=function(data){var _step4,firstRow=data[0],calcOptions={bottomCalc:"stats",bottomCalcFormatter:function(cell){return cell.getValue().join("<br>")}},columnDescription=[{title:"#",field:"id",bottomCalcFormatter:function(){return"<br>min</br>max"}}],randomColumns=[],_iterator4=_createForOfIteratorHelper(firstRow.randomvars);try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var column=_step4.value;randomColumns.push(_objectSpread({title:column.name,field:"random_".concat(column.name)},calcOptions))}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}randomColumns.length>0&&columnDescription.push({title:"Random variables",columns:randomColumns});var _step5,globalColumns=[],_iterator5=_createForOfIteratorHelper(firstRow.globalvars);try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var _column=_step5.value;globalColumns.push(_objectSpread({title:_column.name,field:"global_".concat(_column.name)},calcOptions))}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}globalColumns.length>0&&columnDescription.push({title:"Global variables",columns:globalColumns});var _step6,partColumns=[],partIndex=0,_iterator6=_createForOfIteratorHelper(firstRow.parts);try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var _step8,part=_step6.value,thisPartsColumns=[],_iterator8=_createForOfIteratorHelper(part);try{for(_iterator8.s();!(_step8=_iterator8.n()).done;){var vars=_step8.value;thisPartsColumns.push(_objectSpread({title:vars.name,field:"part_".concat(partIndex,"_").concat(vars.name)},calcOptions))}}catch(err){_iterator8.e(err)}finally{_iterator8.f()}partColumns.push({title:"Part ".concat(partIndex+1),columns:thisPartsColumns}),partIndex++}}catch(err){_iterator6.e(err)}finally{_iterator6.f()}columnDescription=[].concat(_toConsumableArray(columnDescription),partColumns),_tabulator.TabulatorFull.findTable("#varsdata_display")[0].setColumns(columnDescription),fillTable(data),localizeColumnGroupNames();var _step7,_iterator7=_createForOfIteratorHelper(document.querySelectorAll("div.tabulator-calcs-holder"));try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){_step7.value.style.display=data.length>1?"block":"none"}}catch(err){_iterator7.e(err)}finally{_iterator7.f()}},localizeColumnGroupNames=(_ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(){var partStringRequests,_i,strings,pendingPromise,columnGroups,i,_iterator9,_step9,group;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:for(partStringRequests=[],_i=0;_i<numberOfParts;_i++)partStringRequests.push({key:"answerno",component:"qtype_formulas",param:_i+1});return strings=null,pendingPromise=new _pending.default("qtype_formulas/localization"),_context2.prev=4,_context2.next=7,String.get_strings([{key:"varsrandom",component:"qtype_formulas"},{key:"varsglobal",component:"qtype_formulas"}].concat(partStringRequests));case 7:strings=_context2.sent,_context2.next=13;break;case 10:_context2.prev=10,_context2.t0=_context2.catch(4),Notification.exception(_context2.t0);case 13:if(pendingPromise.resolve(),null!==strings){_context2.next=16;break}return _context2.abrupt("return");case 16:columnGroups=document.querySelectorAll("div.tabulator-col-group"),i=1,_iterator9=_createForOfIteratorHelper(columnGroups),_context2.prev=19,_iterator9.s();case 21:if((_step9=_iterator9.n()).done){_context2.next=33;break}if("Random variables"!=(group=_step9.value).getAttribute("aria-title")){_context2.next=26;break}return setTitleForColumnGroup(group,strings[0]),_context2.abrupt("continue",31);case 26:if("Global variables"!=group.getAttribute("aria-title")){_context2.next=29;break}return setTitleForColumnGroup(group,strings[1]),_context2.abrupt("continue",31);case 29:setTitleForColumnGroup(group,strings[1+i]),i++;case 31:_context2.next=21;break;case 33:_context2.next=38;break;case 35:_context2.prev=35,_context2.t1=_context2.catch(19),_iterator9.e(_context2.t1);case 38:return _context2.prev=38,_iterator9.f(),_context2.finish(38);case 41:case"end":return _context2.stop()}}),_callee2,null,[[4,10],[19,35,38,41]])}))),function(){return _ref2.apply(this,arguments)}),setTitleForColumnGroup=function(element,title){element.setAttribute("aria-title",title),element.querySelector("div.tabulator-col-title").innerText=title},fillTable=function(data){var _step10,allRows=[],rowCounter=0,_iterator10=_createForOfIteratorHelper(data);try{for(_iterator10.s();!(_step10=_iterator10.n()).done;){var _step11,row=_step10.value,thisRow={id:++rowCounter},_iterator11=_createForOfIteratorHelper(row.randomvars);try{for(_iterator11.s();!(_step11=_iterator11.n()).done;){var thisVar=_step11.value;thisRow["random_".concat(thisVar.name)]=thisVar.value}}catch(err){_iterator11.e(err)}finally{_iterator11.f()}var _step12,_iterator12=_createForOfIteratorHelper(row.globalvars);try{for(_iterator12.s();!(_step12=_iterator12.n()).done;){var _thisVar=_step12.value;thisRow["global_".concat(_thisVar.name)]=_thisVar.value}}catch(err){_iterator12.e(err)}finally{_iterator12.f()}var _step13,partCounter=0,_iterator13=_createForOfIteratorHelper(row.parts);try{for(_iterator13.s();!(_step13=_iterator13.n()).done;){var _step14,_iterator14=_createForOfIteratorHelper(_step13.value);try{for(_iterator14.s();!(_step14=_iterator14.n()).done;){var _thisVar2=_step14.value;thisRow["part_".concat(partCounter,"_").concat(_thisVar2.name)]=_thisVar2.value}}catch(err){_iterator14.e(err)}finally{_iterator14.f()}partCounter++}}catch(err){_iterator13.e(err)}finally{_iterator13.f()}allRows.push(thisRow)}}catch(err){_iterator10.e(err)}finally{_iterator10.f()}_tabulator.TabulatorFull.findTable("#varsdata_display")[0].setData(allRows)},instantiate=(_ref3=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(){var howMany,localvars,answers,i,pendingPromise,response,str;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:for(howMany=document.getElementById("id_numdataset").value,localvars=[],answers=[],i=0;i<numberOfParts;i++)localvars[i]=document.getElementById("id_vars1_".concat(i)).value,answers[i]=document.getElementById("id_answer_".concat(i)).value;return pendingPromise=new _pending.default("qtype_formulas/instantiate"),_context3.prev=5,_context3.next=8,(0,_ajax.call)([{methodname:"qtype_formulas_instantiate",args:{n:howMany,randomvars:document.getElementById("id_varsrandom").value,globalvars:document.getElementById("id_varsglobal").value,localvars:localvars,answers:answers}}])[0];case 8:if("error"!=(response=_context3.sent).status){_context3.next=16;break}return _context3.next=12,String.get_string("previewerror","qtype_formulas");case 12:str=_context3.sent,document.getElementById("qtextpreview_display").innerHTML="".concat(str,"<br>").concat(response.message),_context3.next=18;break;case 16:document.getElementById("qtextpreview_display").innerHTML="",prepareTableColumns(response.data);case 18:_context3.next=23;break;case 20:_context3.prev=20,_context3.t0=_context3.catch(5),Notification.exception(_context3.t0);case 23:pendingPromise.resolve();case 24:case"end":return _context3.stop()}}),_callee3,null,[[5,20]])}))),function(){return _ref3.apply(this,arguments)}),_default={init:function(noParts){numberOfParts=noParts,extendTabulator(),initTable()},instantiate:instantiate};return _exports.default=_default,_exports.default}));
define("qtype_formulas/tabulator",["exports"],(function(_exports){function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||_unsupportedIterableToArray(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e2){throw _e2},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(_e3){didErr=!0,err=_e3},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||_unsupportedIterableToArray(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&("object"===_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(self)}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.ValidateModule=_exports.TooltipModule=_exports.TabulatorFull=_exports.Tabulator=_exports.SortModule=_exports.SelectRowModule=_exports.RowComponent=_exports.ResponsiveLayoutModule=_exports.ResizeTableModule=_exports.ResizeRowsModule=_exports.ResizeColumnsModule=_exports.Renderer=_exports.ReactiveDataModule=_exports.PseudoRow=_exports.PrintModule=_exports.PopupModule=_exports.PersistenceModule=_exports.PageModule=_exports.MutatorModule=_exports.MoveRowsModule=_exports.MoveColumnsModule=_exports.Module=_exports.MenuModule=_exports.KeybindingsModule=_exports.InteractionModule=_exports.ImportModule=_exports.HtmlTableImportModule=_exports.HistoryModule=_exports.GroupRowsModule=_exports.GroupComponent=_exports.FrozenRowsModule=_exports.FrozenColumnsModule=_exports.FormatModule=_exports.FilterModule=_exports.ExportModule=_exports.EditModule=_exports.DownloadModule=_exports.DataTreeModule=_exports.ColumnComponent=_exports.ColumnCalcsModule=_exports.ClipboardModule=_exports.CellComponent=_exports.CalcComponent=_exports.AjaxModule=_exports.AccessorModule=void 0;var CoreFeature=function(){function CoreFeature(table){_classCallCheck(this,CoreFeature),this.table=table}return _createClass(CoreFeature,[{key:"reloadData",value:function(data,silent,columnsChanged){return this.table.dataLoader.load(data,void 0,void 0,void 0,silent,columnsChanged)}},{key:"langText",value:function(){var _this$table$modules$l;return(_this$table$modules$l=this.table.modules.localize).getText.apply(_this$table$modules$l,arguments)}},{key:"langBind",value:function(){var _this$table$modules$l2;return(_this$table$modules$l2=this.table.modules.localize).bind.apply(_this$table$modules$l2,arguments)}},{key:"langLocale",value:function(){var _this$table$modules$l3;return(_this$table$modules$l3=this.table.modules.localize).getLocale.apply(_this$table$modules$l3,arguments)}},{key:"commsConnections",value:function(){var _this$table$modules$c;return(_this$table$modules$c=this.table.modules.comms).getConnections.apply(_this$table$modules$c,arguments)}},{key:"commsSend",value:function(){var _this$table$modules$c2;return(_this$table$modules$c2=this.table.modules.comms).send.apply(_this$table$modules$c2,arguments)}},{key:"layoutMode",value:function(){return this.table.modules.layout.getMode()}},{key:"layoutRefresh",value:function(force){return this.table.modules.layout.layout(force)}},{key:"subscribe",value:function(){var _this$table$eventBus;return(_this$table$eventBus=this.table.eventBus).subscribe.apply(_this$table$eventBus,arguments)}},{key:"unsubscribe",value:function(){var _this$table$eventBus2;return(_this$table$eventBus2=this.table.eventBus).unsubscribe.apply(_this$table$eventBus2,arguments)}},{key:"subscribed",value:function(key){return this.table.eventBus.subscribed(key)}},{key:"subscriptionChange",value:function(){var _this$table$eventBus3;return(_this$table$eventBus3=this.table.eventBus).subscriptionChange.apply(_this$table$eventBus3,arguments)}},{key:"dispatch",value:function(){var _this$table$eventBus4;return(_this$table$eventBus4=this.table.eventBus).dispatch.apply(_this$table$eventBus4,arguments)}},{key:"chain",value:function(){var _this$table$eventBus5;return(_this$table$eventBus5=this.table.eventBus).chain.apply(_this$table$eventBus5,arguments)}},{key:"confirm",value:function(){var _this$table$eventBus6;return(_this$table$eventBus6=this.table.eventBus).confirm.apply(_this$table$eventBus6,arguments)}},{key:"dispatchExternal",value:function(){var _this$table$externalE;return(_this$table$externalE=this.table.externalEvents).dispatch.apply(_this$table$externalE,arguments)}},{key:"subscribedExternal",value:function(key){return this.table.externalEvents.subscribed(key)}},{key:"subscriptionChangeExternal",value:function(){var _this$table$externalE2;return(_this$table$externalE2=this.table.externalEvents).subscriptionChange.apply(_this$table$externalE2,arguments)}},{key:"options",value:function(key){return this.table.options[key]}},{key:"setOption",value:function(key,value){return void 0!==value&&(this.table.options[key]=value),this.table.options[key]}},{key:"deprecationCheck",value:function(oldOption,newOption){return this.table.deprecationAdvisor.check(oldOption,newOption)}},{key:"deprecationCheckMsg",value:function(oldOption,msg){return this.table.deprecationAdvisor.checkMsg(oldOption,msg)}},{key:"deprecationMsg",value:function(msg){return this.table.deprecationAdvisor.msg(msg)}},{key:"module",value:function(key){return this.table.module(key)}}]),CoreFeature}(),Helpers=function(){function Helpers(){_classCallCheck(this,Helpers)}return _createClass(Helpers,null,[{key:"elVisible",value:function(el){return!(el.offsetWidth<=0&&el.offsetHeight<=0)}},{key:"elOffset",value:function(el){var box=el.getBoundingClientRect();return{top:box.top+window.pageYOffset-document.documentElement.clientTop,left:box.left+window.pageXOffset-document.documentElement.clientLeft}}},{key:"deepClone",value:function(obj,clone){var _this=this,list=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],objectProto={}.__proto__,arrayProto=[].__proto__;clone||(clone=Object.assign(Array.isArray(obj)?[]:{},obj));var _loop=function(){var subject=obj[i],match=void 0,copy=void 0;null==subject||"object"!==_typeof(subject)||subject.__proto__!==objectProto&&subject.__proto__!==arrayProto||((match=list.findIndex((function(item){return item.subject===subject})))>-1?clone[i]=list[match].copy:(copy=Object.assign(Array.isArray(subject)?[]:{},subject),list.unshift({subject:subject,copy:copy}),clone[i]=_this.deepClone(subject,copy,list)))};for(var i in obj)_loop();return clone}}]),Helpers}(),Popup=function(_CoreFeature){_inherits(Popup,_CoreFeature);var _super=_createSuper(Popup);function Popup(table,element,parent){var _this2;return _classCallCheck(this,Popup),(_this2=_super.call(this,table)).element=element,_this2.container=_this2._lookupContainer(),_this2.parent=parent,_this2.reversedX=!1,_this2.childPopup=null,_this2.blurable=!1,_this2.blurCallback=null,_this2.blurEventsBound=!1,_this2.renderedCallback=null,_this2.visible=!1,_this2.hideable=!0,_this2.element.classList.add("tabulator-popup-container"),_this2.blurEvent=_this2.hide.bind(_assertThisInitialized(_this2),!1),_this2.escEvent=_this2._escapeCheck.bind(_assertThisInitialized(_this2)),_this2.destroyBinding=_this2.tableDestroyed,_this2.destroyed=!1,_this2}return _createClass(Popup,[{key:"tableDestroyed",value:function(){this.destroyed=!0,this.hide(!0)}},{key:"_lookupContainer",value:function(){var container=this.table.options.popupContainer;return"string"==typeof container?(container=document.querySelector(container))||console.warn("Menu Error - no container element found matching selector:",this.table.options.popupContainer,"(defaulting to document body)"):!0===container&&(container=this.table.element),container&&!this._checkContainerIsParent(container)&&(container=!1,console.warn("Menu Error - container element does not contain this table:",this.table.options.popupContainer,"(defaulting to document body)")),container||(container=document.body),container}},{key:"_checkContainerIsParent",value:function(container){var element=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.table.element;return container===element||!!element.parentNode&&this._checkContainerIsParent(container,element.parentNode)}},{key:"renderCallback",value:function(callback){this.renderedCallback=callback}},{key:"containerEventCoords",value:function(e){var touch=!(e instanceof MouseEvent),x=touch?e.touches[0].pageX:e.pageX,y=touch?e.touches[0].pageY:e.pageY;if(this.container!==document.body){var parentOffset=Helpers.elOffset(this.container);x-=parentOffset.left,y-=parentOffset.top}return{x:x,y:y}}},{key:"elementPositionCoords",value:function(element){var containerOffset,x,y,position=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"right",offset=Helpers.elOffset(element);switch(this.container!==document.body&&(containerOffset=Helpers.elOffset(this.container),offset.left-=containerOffset.left,offset.top-=containerOffset.top),position){case"right":x=offset.left+element.offsetWidth,y=offset.top-1;break;case"bottom":x=offset.left,y=offset.top+element.offsetHeight;break;case"left":x=offset.left,y=offset.top-1;break;case"top":x=offset.left,y=offset.top;break;case"center":x=offset.left+element.offsetWidth/2,y=offset.top+element.offsetHeight/2}return{x:x,y:y,offset:offset}}},{key:"show",value:function(origin,position){var x,y,parentEl,parentOffset,coords;return this.destroyed||this.table.destroyed||(origin instanceof HTMLElement?(parentEl=origin,parentOffset=(coords=this.elementPositionCoords(origin,position)).offset,x=coords.x,y=coords.y):"number"==typeof origin?(parentOffset={top:0,left:0},x=origin,y=position):(x=(coords=this.containerEventCoords(origin)).x,y=coords.y,this.reversedX=!1),this.element.style.top=y+"px",this.element.style.left=x+"px",this.container.appendChild(this.element),"function"==typeof this.renderedCallback&&this.renderedCallback(),this._fitToScreen(x,y,parentEl,parentOffset,position),this.visible=!0,this.subscribe("table-destroy",this.destroyBinding),this.element.addEventListener("mousedown",(function(e){e.stopPropagation()}))),this}},{key:"_fitToScreen",value:function(x,y,parentEl,parentOffset,position){var scrollTop=this.container===document.body?document.documentElement.scrollTop:this.container.scrollTop;if((x+this.element.offsetWidth>=this.container.offsetWidth||this.reversedX)&&(this.element.style.left="",this.element.style.right=parentEl?this.container.offsetWidth-parentOffset.left+"px":this.container.offsetWidth-x+"px",this.reversedX=!0),y+this.element.offsetHeight>Math.max(this.container.offsetHeight,scrollTop?this.container.scrollHeight:0))if(parentEl)if("bottom"===position)this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight-parentEl.offsetHeight-1+"px";else this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight+parentEl.offsetHeight+1+"px";else this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight+"px"}},{key:"isVisible",value:function(){return this.visible}},{key:"hideOnBlur",value:function(callback){var _this3=this;return this.blurable=!0,this.visible&&(setTimeout((function(){_this3.visible&&(_this3.table.rowManager.element.addEventListener("scroll",_this3.blurEvent),_this3.subscribe("cell-editing",_this3.blurEvent),document.body.addEventListener("click",_this3.blurEvent),document.body.addEventListener("contextmenu",_this3.blurEvent),document.body.addEventListener("mousedown",_this3.blurEvent),window.addEventListener("resize",_this3.blurEvent),document.body.addEventListener("keydown",_this3.escEvent),_this3.blurEventsBound=!0)}),100),this.blurCallback=callback),this}},{key:"_escapeCheck",value:function(e){27==e.keyCode&&this.hide()}},{key:"blockHide",value:function(){this.hideable=!1}},{key:"restoreHide",value:function(){this.hideable=!0}},{key:"hide",value:function(){var silent=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.visible&&this.hideable&&(this.blurable&&this.blurEventsBound&&(document.body.removeEventListener("keydown",this.escEvent),document.body.removeEventListener("click",this.blurEvent),document.body.removeEventListener("contextmenu",this.blurEvent),document.body.removeEventListener("mousedown",this.blurEvent),window.removeEventListener("resize",this.blurEvent),this.table.rowManager.element.removeEventListener("scroll",this.blurEvent),this.unsubscribe("cell-editing",this.blurEvent),this.blurEventsBound=!1),this.childPopup&&this.childPopup.hide(),this.parent&&(this.parent.childPopup=null),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.visible=!1,this.blurCallback&&!silent&&this.blurCallback(),this.unsubscribe("table-destroy",this.destroyBinding)),this}},{key:"child",value:function(element){return this.childPopup&&this.childPopup.hide(),this.childPopup=new Popup(this.table,element,this),this.childPopup}}]),Popup}(CoreFeature),Module=function(_CoreFeature2){_inherits(Module,_CoreFeature2);var _super2=_createSuper(Module);function Module(table,name){var _this4;return _classCallCheck(this,Module),(_this4=_super2.call(this,table))._handler=null,_this4}return _createClass(Module,[{key:"initialize",value:function(){}},{key:"registerTableOption",value:function(key,value){this.table.optionsList.register(key,value)}},{key:"registerColumnOption",value:function(key,value){this.table.columnManager.optionsList.register(key,value)}},{key:"registerTableFunction",value:function(name,func){var _this5=this;void 0===this.table[name]?this.table[name]=function(){return _this5.table.initGuard(name),func.apply(void 0,arguments)}:console.warn("Unable to bind table function, name already in use",name)}},{key:"registerComponentFunction",value:function(component,func,handler){return this.table.componentFunctionBinder.bind(component,func,handler)}},{key:"registerDataHandler",value:function(handler,priority){this.table.rowManager.registerDataPipelineHandler(handler,priority),this._handler=handler}},{key:"registerDisplayHandler",value:function(handler,priority){this.table.rowManager.registerDisplayPipelineHandler(handler,priority),this._handler=handler}},{key:"displayRows",value:function(adjust){var lookupIndex,_this6=this,index=this.table.rowManager.displayRows.length-1;if(this._handler&&(lookupIndex=this.table.rowManager.displayPipeline.findIndex((function(item){return item.handler===_this6._handler})))>-1&&(index=lookupIndex),adjust&&(index+=adjust),this._handler)return index>-1?this.table.rowManager.getDisplayRows(index):this.activeRows()}},{key:"activeRows",value:function(){return this.table.rowManager.activeRows}},{key:"refreshData",value:function(renderInPosition,handler){handler||(handler=this._handler),handler&&this.table.rowManager.refreshActiveData(handler,!1,renderInPosition)}},{key:"footerAppend",value:function(element){return this.table.footerManager.append(element)}},{key:"footerPrepend",value:function(element){return this.table.footerManager.prepend(element)}},{key:"footerRemove",value:function(element){return this.table.footerManager.remove(element)}},{key:"popup",value:function(menuEl,menuContainer){return new Popup(this.table,menuEl,menuContainer)}},{key:"alert",value:function(content,type){return this.table.alertManager.alert(content,type)}},{key:"clearAlert",value:function(){return this.table.alertManager.clear()}}]),Module}(CoreFeature);_exports.Module=Module;var Accessor=function(_Module){_inherits(Accessor,_Module);var _super3=_createSuper(Accessor);function Accessor(table){var _this7;return _classCallCheck(this,Accessor),(_this7=_super3.call(this,table)).allowedTypes=["","data","download","clipboard","print","htmlOutput"],_this7.registerColumnOption("accessor"),_this7.registerColumnOption("accessorParams"),_this7.registerColumnOption("accessorData"),_this7.registerColumnOption("accessorDataParams"),_this7.registerColumnOption("accessorDownload"),_this7.registerColumnOption("accessorDownloadParams"),_this7.registerColumnOption("accessorClipboard"),_this7.registerColumnOption("accessorClipboardParams"),_this7.registerColumnOption("accessorPrint"),_this7.registerColumnOption("accessorPrintParams"),_this7.registerColumnOption("accessorHtmlOutput"),_this7.registerColumnOption("accessorHtmlOutputParams"),_this7}return _createClass(Accessor,[{key:"initialize",value:function(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-retrieve",this.transformRow.bind(this))}},{key:"initializeColumn",value:function(column){var _this8=this,match=!1,config={};this.allowedTypes.forEach((function(type){var accessor,key="accessor"+(type.charAt(0).toUpperCase()+type.slice(1));column.definition[key]&&(accessor=_this8.lookupAccessor(column.definition[key]))&&(match=!0,config[key]={accessor:accessor,params:column.definition[key+"Params"]||{}})})),match&&(column.modules.accessor=config)}},{key:"lookupAccessor",value:function(value){var accessor=!1;switch(_typeof(value)){case"string":Accessor.accessors[value]?accessor=Accessor.accessors[value]:console.warn("Accessor Error - No such accessor found, ignoring: ",value);break;case"function":accessor=value}return accessor}},{key:"transformRow",value:function(row,type){var key="accessor"+(type.charAt(0).toUpperCase()+type.slice(1)),rowComponent=row.getComponent(),data=Helpers.deepClone(row.data||{});return this.table.columnManager.traverse((function(column){var value,accessor,params,colComponent;column.modules.accessor&&(accessor=column.modules.accessor[key]||column.modules.accessor.accessor||!1)&&"undefined"!=(value=column.getFieldValue(data))&&(colComponent=column.getComponent(),params="function"==typeof accessor.params?accessor.params(value,data,type,colComponent,rowComponent):accessor.params,column.setFieldValue(data,accessor.accessor(value,data,type,params,colComponent,rowComponent)))})),data}}]),Accessor}(Module);_exports.AccessorModule=Accessor,Accessor.moduleName="accessor",Accessor.accessors={};function generateParamsList(data,prefix){var output=[];if(prefix=prefix||"",Array.isArray(data))data.forEach((function(item,i){output=output.concat(generateParamsList(item,prefix?prefix+"["+i+"]":i))}));else if("object"===_typeof(data))for(var key in data)output=output.concat(generateParamsList(data[key],prefix?prefix+"["+key+"]":key));else output.push({key:prefix,value:data});return output}function serializeParams(params){var output=generateParamsList(params),encoded=[];return output.forEach((function(item){encoded.push(encodeURIComponent(item.key)+"="+encodeURIComponent(item.value))})),encoded.join("&")}function urlBuilder(url,config,params){return url&&params&&Object.keys(params).length&&(config.method&&"get"!=config.method.toLowerCase()||(config.method="get",url+=(url.includes("?")?"&":"?")+serializeParams(params))),url}function generateParamsList$1(data,prefix){var output=[];if(prefix=prefix||"",Array.isArray(data))data.forEach((function(item,i){output=output.concat(generateParamsList$1(item,prefix?prefix+"["+i+"]":i))}));else if("object"===_typeof(data))for(var key in data)output=output.concat(generateParamsList$1(data[key],prefix?prefix+"["+key+"]":key));else output.push({key:prefix,value:data});return output}var defaultContentTypeFormatters={json:{headers:{"Content-Type":"application/json"},body:function(url,config,params){return JSON.stringify(params)}},form:{headers:{},body:function(url,config,params){var output=generateParamsList$1(params),form=new FormData;return output.forEach((function(item){form.append(item.key,item.value)})),form}}},Ajax=function(_Module2){_inherits(Ajax,_Module2);var _super4=_createSuper(Ajax);function Ajax(table){var _this10;return _classCallCheck(this,Ajax),(_this10=_super4.call(this,table)).config={},_this10.url="",_this10.urlGenerator=!1,_this10.params=!1,_this10.loaderPromise=!1,_this10.registerTableOption("ajaxURL",!1),_this10.registerTableOption("ajaxURLGenerator",!1),_this10.registerTableOption("ajaxParams",{}),_this10.registerTableOption("ajaxConfig","get"),_this10.registerTableOption("ajaxContentType","form"),_this10.registerTableOption("ajaxRequestFunc",!1),_this10.registerTableOption("ajaxRequesting",(function(){})),_this10.registerTableOption("ajaxResponse",!1),_this10.contentTypeFormatters=Ajax.contentTypeFormatters,_this10}return _createClass(Ajax,[{key:"initialize",value:function(){this.loaderPromise=this.table.options.ajaxRequestFunc||Ajax.defaultLoaderPromise,this.urlGenerator=this.table.options.ajaxURLGenerator||Ajax.defaultURLGenerator,this.table.options.ajaxURL&&this.setUrl(this.table.options.ajaxURL),this.setDefaultConfig(this.table.options.ajaxConfig),this.registerTableFunction("getAjaxUrl",this.getUrl.bind(this)),this.subscribe("data-loading",this.requestDataCheck.bind(this)),this.subscribe("data-params",this.requestParams.bind(this)),this.subscribe("data-load",this.requestData.bind(this))}},{key:"requestParams",value:function(data,config,silent,params){var ajaxParams=this.table.options.ajaxParams;return ajaxParams&&("function"==typeof ajaxParams&&(ajaxParams=ajaxParams.call(this.table)),params=Object.assign(params,ajaxParams)),params}},{key:"requestDataCheck",value:function(data,params,config,silent){return!((data||!this.url)&&"string"!=typeof data)}},{key:"requestData",value:function(url,params,config,silent,previousData){var ajaxConfig;return!previousData&&this.requestDataCheck(url)?(url&&this.setUrl(url),ajaxConfig=this.generateConfig(config),this.sendRequest(this.url,params,ajaxConfig)):previousData}},{key:"setDefaultConfig",value:function(){var config=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.config=Object.assign({},Ajax.defaultConfig),"string"==typeof config?this.config.method=config:Object.assign(this.config,config)}},{key:"generateConfig",value:function(){var config=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},ajaxConfig=Object.assign({},this.config);return"string"==typeof config?ajaxConfig.method=config:Object.assign(ajaxConfig,config),ajaxConfig}},{key:"setUrl",value:function(url){this.url=url}},{key:"getUrl",value:function(){return this.url}},{key:"sendRequest",value:function(url,params,config){var _this11=this;return!1!==this.table.options.ajaxRequesting.call(this.table,url,params)?this.loaderPromise(url,config,params).then((function(data){return _this11.table.options.ajaxResponse&&(data=_this11.table.options.ajaxResponse.call(_this11.table,url,params,data)),data})):Promise.reject()}}]),Ajax}(Module);_exports.AjaxModule=Ajax,Ajax.moduleName="ajax",Ajax.defaultConfig={method:"GET"},Ajax.defaultURLGenerator=urlBuilder,Ajax.defaultLoaderPromise=function(url,config,params){var contentType,_this9=this;return new Promise((function(resolve,reject){if(url=_this9.urlGenerator.call(_this9.table,url,config,params),"GET"!=config.method.toUpperCase())if(contentType="object"===_typeof(_this9.table.options.ajaxContentType)?_this9.table.options.ajaxContentType:_this9.contentTypeFormatters[_this9.table.options.ajaxContentType]){for(var key in contentType.headers)config.headers||(config.headers={}),void 0===config.headers[key]&&(config.headers[key]=contentType.headers[key]);config.body=contentType.body.call(_this9,url,config,params)}else console.warn("Ajax Error - Invalid ajaxContentType value:",_this9.table.options.ajaxContentType);url?(void 0===config.headers&&(config.headers={}),void 0===config.headers.Accept&&(config.headers.Accept="application/json"),void 0===config.headers["X-Requested-With"]&&(config.headers["X-Requested-With"]="XMLHttpRequest"),void 0===config.mode&&(config.mode="cors"),"cors"==config.mode?(void 0===config.headers.Origin&&(config.headers.Origin=window.location.origin),void 0===config.credentials&&(config.credentials="same-origin")):void 0===config.credentials&&(config.credentials="include"),fetch(url,config).then((function(response){response.ok?response.json().then((function(data){resolve(data)})).catch((function(error){reject(error),console.warn("Ajax Load Error - Invalid JSON returned",error)})):(console.error("Ajax Load Error - Connection Error: "+response.status,response.statusText),reject(response))})).catch((function(error){console.error("Ajax Load Error - Connection Error: ",error),reject(error)}))):(console.warn("Ajax Load Error - No URL Set"),resolve([]))}))},Ajax.contentTypeFormatters=defaultContentTypeFormatters;var Clipboard=function(_Module3){_inherits(Clipboard,_Module3);var _super5=_createSuper(Clipboard);function Clipboard(table){var _this12;return _classCallCheck(this,Clipboard),(_this12=_super5.call(this,table)).mode=!0,_this12.pasteParser=function(){},_this12.pasteAction=function(){},_this12.customSelection=!1,_this12.rowRange=!1,_this12.blocked=!0,_this12.registerTableOption("clipboard",!1),_this12.registerTableOption("clipboardCopyStyled",!0),_this12.registerTableOption("clipboardCopyConfig",!1),_this12.registerTableOption("clipboardCopyFormatter",!1),_this12.registerTableOption("clipboardCopyRowRange","active"),_this12.registerTableOption("clipboardPasteParser","table"),_this12.registerTableOption("clipboardPasteAction","insert"),_this12.registerColumnOption("clipboard"),_this12.registerColumnOption("titleClipboard"),_this12}return _createClass(Clipboard,[{key:"initialize",value:function(){var _this13=this;this.mode=this.table.options.clipboard,this.rowRange=this.table.options.clipboardCopyRowRange,!0!==this.mode&&"copy"!==this.mode||this.table.element.addEventListener("copy",(function(e){var plain,html,list;_this13.blocked||(e.preventDefault(),_this13.customSelection?(plain=_this13.customSelection,_this13.table.options.clipboardCopyFormatter&&(plain=_this13.table.options.clipboardCopyFormatter("plain",plain))):(list=_this13.table.modules.export.generateExportList(_this13.table.options.clipboardCopyConfig,_this13.table.options.clipboardCopyStyled,_this13.rowRange,"clipboard"),plain=(html=_this13.table.modules.export.generateHTMLTable(list))?_this13.generatePlainContent(list):"",_this13.table.options.clipboardCopyFormatter&&(plain=_this13.table.options.clipboardCopyFormatter("plain",plain),html=_this13.table.options.clipboardCopyFormatter("html",html))),window.clipboardData&&window.clipboardData.setData?window.clipboardData.setData("Text",plain):e.clipboardData&&e.clipboardData.setData?(e.clipboardData.setData("text/plain",plain),html&&e.clipboardData.setData("text/html",html)):e.originalEvent&&e.originalEvent.clipboardData.setData&&(e.originalEvent.clipboardData.setData("text/plain",plain),html&&e.originalEvent.clipboardData.setData("text/html",html)),_this13.dispatchExternal("clipboardCopied",plain,html),_this13.reset())})),!0!==this.mode&&"paste"!==this.mode||this.table.element.addEventListener("paste",(function(e){_this13.paste(e)})),this.setPasteParser(this.table.options.clipboardPasteParser),this.setPasteAction(this.table.options.clipboardPasteAction),this.registerTableFunction("copyToClipboard",this.copy.bind(this))}},{key:"reset",value:function(){this.blocked=!0,this.customSelection=!1}},{key:"generatePlainContent",value:function(list){var output=[];return list.forEach((function(row){var rowData=[];row.columns.forEach((function(col){var value="";if(col)if("group"===row.type&&(col.value=col.component.getKey()),null===col.value)value="";else switch(_typeof(col.value)){case"object":value=JSON.stringify(col.value);break;case"undefined":value="";break;default:value=col.value}rowData.push(value)})),output.push(rowData.join("\t"))})),output.join("\n")}},{key:"copy",value:function(range,internal){var sel,textRange;this.blocked=!1,this.customSelection=!1,!0!==this.mode&&"copy"!==this.mode||(this.rowRange=range||this.table.options.clipboardCopyRowRange,void 0!==window.getSelection&&void 0!==document.createRange?((range=document.createRange()).selectNodeContents(this.table.element),(sel=window.getSelection()).toString()&&internal&&(this.customSelection=sel.toString()),sel.removeAllRanges(),sel.addRange(range)):void 0!==document.selection&&void 0!==document.body.createTextRange&&((textRange=document.body.createTextRange()).moveToElementText(this.table.element),textRange.select()),document.execCommand("copy"),sel&&sel.removeAllRanges())}},{key:"setPasteAction",value:function(action){switch(_typeof(action)){case"string":this.pasteAction=Clipboard.pasteActions[action],this.pasteAction||console.warn("Clipboard Error - No such paste action found:",action);break;case"function":this.pasteAction=action}}},{key:"setPasteParser",value:function(parser){switch(_typeof(parser)){case"string":this.pasteParser=Clipboard.pasteParsers[parser],this.pasteParser||console.warn("Clipboard Error - No such paste parser found:",parser);break;case"function":this.pasteParser=parser}}},{key:"paste",value:function(e){var data,rowData,rows;this.checkPaseOrigin(e)&&(data=this.getPasteData(e),(rowData=this.pasteParser.call(this,data))?(e.preventDefault(),this.table.modExists("mutator")&&(rowData=this.mutateData(rowData)),rows=this.pasteAction.call(this,rowData),this.dispatchExternal("clipboardPasted",data,rowData,rows)):this.dispatchExternal("clipboardPasteError",data))}},{key:"mutateData",value:function(data){var _this14=this,output=[];return Array.isArray(data)?data.forEach((function(row){output.push(_this14.table.modules.mutator.transformRow(row,"clipboard"))})):output=data,output}},{key:"checkPaseOrigin",value:function(e){var valid=!0;return("DIV"!=e.target.tagName||this.table.modules.edit.currentCell)&&(valid=!1),valid}},{key:"getPasteData",value:function(e){var data;return window.clipboardData&&window.clipboardData.getData?data=window.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData?data=e.clipboardData.getData("text/plain"):e.originalEvent&&e.originalEvent.clipboardData.getData&&(data=e.originalEvent.clipboardData.getData("text/plain")),data}}]),Clipboard}(Module);_exports.ClipboardModule=Clipboard,Clipboard.moduleName="clipboard",Clipboard.pasteActions={replace:function(rows){return this.table.setData(rows)},update:function(rows){return this.table.updateOrAddData(rows)},insert:function(rows){return this.table.addData(rows)}},Clipboard.pasteParsers={table:function(clipboard){var data=[],headerFindSuccess=!0,columns=this.table.columnManager.columns,columnMap=[],rows=[];return(clipboard=clipboard.split("\n")).forEach((function(row){data.push(row.split("\t"))})),!(!data.length||1===data.length&&data[0].length<2)&&(data[0].forEach((function(value){var column=columns.find((function(column){return value&&column.definition.title&&value.trim()&&column.definition.title.trim()===value.trim()}));column?columnMap.push(column):headerFindSuccess=!1})),headerFindSuccess||(headerFindSuccess=!0,columnMap=[],data[0].forEach((function(value){var column=columns.find((function(column){return value&&column.field&&value.trim()&&column.field.trim()===value.trim()}));column?columnMap.push(column):headerFindSuccess=!1})),headerFindSuccess||(columnMap=this.table.columnManager.columnsByIndex)),headerFindSuccess&&data.shift(),data.forEach((function(item){var row={};item.forEach((function(value,i){columnMap[i]&&(row[columnMap[i].field]=value)})),rows.push(row)})),rows)}};var CalcComponent=function(){function CalcComponent(row){return _classCallCheck(this,CalcComponent),this._row=row,new Proxy(this,{get:function(target,name,receiver){return void 0!==target[name]?target[name]:target._row.table.componentFunctionBinder.handle("row",target._row,name)}})}return _createClass(CalcComponent,[{key:"getData",value:function(transform){return this._row.getData(transform)}},{key:"getElement",value:function(){return this._row.getElement()}},{key:"getTable",value:function(){return this._row.table}},{key:"getCells",value:function(){var cells=[];return this._row.getCells().forEach((function(cell){cells.push(cell.getComponent())})),cells}},{key:"getCell",value:function(column){var cell=this._row.getCell(column);return!!cell&&cell.getComponent()}},{key:"_getSelf",value:function(){return this._row}}]),CalcComponent}();_exports.CalcComponent=CalcComponent;var CellComponent=function(){function CellComponent(cell){return _classCallCheck(this,CellComponent),this._cell=cell,new Proxy(this,{get:function(target,name,receiver){return void 0!==target[name]?target[name]:target._cell.table.componentFunctionBinder.handle("cell",target._cell,name)}})}return _createClass(CellComponent,[{key:"getValue",value:function(){return this._cell.getValue()}},{key:"getOldValue",value:function(){return this._cell.getOldValue()}},{key:"getInitialValue",value:function(){return this._cell.initialValue}},{key:"getElement",value:function(){return this._cell.getElement()}},{key:"getRow",value:function(){return this._cell.row.getComponent()}},{key:"getData",value:function(){return this._cell.row.getData()}},{key:"getField",value:function(){return this._cell.column.getField()}},{key:"getColumn",value:function(){return this._cell.column.getComponent()}},{key:"setValue",value:function(value,mutate){void 0===mutate&&(mutate=!0),this._cell.setValue(value,mutate)}},{key:"restoreOldValue",value:function(){this._cell.setValueActual(this._cell.getOldValue())}},{key:"restoreInitialValue",value:function(){this._cell.setValueActual(this._cell.initialValue)}},{key:"checkHeight",value:function(){this._cell.checkHeight()}},{key:"getTable",value:function(){return this._cell.table}},{key:"_getSelf",value:function(){return this._cell}}]),CellComponent}();_exports.CellComponent=CellComponent;var Cell=function(_CoreFeature3){_inherits(Cell,_CoreFeature3);var _super6=_createSuper(Cell);function Cell(column,row){var _this15;return _classCallCheck(this,Cell),(_this15=_super6.call(this,column.table)).table=column.table,_this15.column=column,_this15.row=row,_this15.element=null,_this15.value=null,_this15.initialValue,_this15.oldValue=null,_this15.modules={},_this15.height=null,_this15.width=null,_this15.minWidth=null,_this15.component=null,_this15.loaded=!1,_this15.build(),_this15}return _createClass(Cell,[{key:"build",value:function(){this.generateElement(),this.setWidth(),this._configureCell(),this.setValueActual(this.column.getFieldValue(this.row.data)),this.initialValue=this.value}},{key:"generateElement",value:function(){this.element=document.createElement("div"),this.element.className="tabulator-cell",this.element.setAttribute("role","gridcell")}},{key:"_configureCell",value:function(){var element=this.element,field=this.column.getField();(element.style.textAlign=this.column.hozAlign,this.column.vertAlign&&(element.style.display="inline-flex",element.style.alignItems={top:"flex-start",bottom:"flex-end",middle:"center"}[this.column.vertAlign]||"",this.column.hozAlign&&(element.style.justifyContent={left:"flex-start",right:"flex-end",center:"center"}[this.column.hozAlign]||"")),field&&element.setAttribute("tabulator-field",field),this.column.definition.cssClass)&&this.column.definition.cssClass.split(" ").forEach((function(className){element.classList.add(className)}));this.dispatch("cell-init",this),this.column.visible||this.hide()}},{key:"_generateContents",value:function(){var val,_this16=this;switch(_typeof(val=this.chain("cell-format",this,null,(function(){return _this16.element.innerHTML=_this16.value})))){case"object":if(val instanceof Node){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.appendChild(val)}else this.element.innerHTML="",null!=val&&console.warn("Format Error - Formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",val);break;case"undefined":this.element.innerHTML="";break;default:this.element.innerHTML=val}}},{key:"cellRendered",value:function(){this.dispatch("cell-rendered",this)}},{key:"getElement",value:function(containerOnly){return this.loaded||(this.loaded=!0,containerOnly||this.layoutElement()),this.element}},{key:"getValue",value:function(){return this.value}},{key:"getOldValue",value:function(){return this.oldValue}},{key:"setValue",value:function(value,mutate,force){this.setValueProcessData(value,mutate,force)&&(this.dispatch("cell-value-updated",this),this.cellRendered(),this.column.definition.cellEdited&&this.column.definition.cellEdited.call(this.table,this.getComponent()),this.dispatchExternal("cellEdited",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()))}},{key:"setValueProcessData",value:function(value,mutate,force){var changed=!1;return(this.value!==value||force)&&(changed=!0,mutate&&(value=this.chain("cell-value-changing",[this,value],null,value))),this.setValueActual(value),changed&&this.dispatch("cell-value-changed",this),changed}},{key:"setValueActual",value:function(value){this.oldValue=this.value,this.value=value,this.dispatch("cell-value-save-before",this),this.column.setFieldValue(this.row.data,value),this.dispatch("cell-value-save-after",this),this.loaded&&this.layoutElement()}},{key:"layoutElement",value:function(){this._generateContents(),this.dispatch("cell-layout",this)}},{key:"setWidth",value:function(){this.width=this.column.width,this.element.style.width=this.column.widthStyled}},{key:"clearWidth",value:function(){this.width="",this.element.style.width=""}},{key:"getWidth",value:function(){return this.width||this.element.offsetWidth}},{key:"setMinWidth",value:function(){this.minWidth=this.column.minWidth,this.element.style.minWidth=this.column.minWidthStyled}},{key:"setMaxWidth",value:function(){this.maxWidth=this.column.maxWidth,this.element.style.maxWidth=this.column.maxWidthStyled}},{key:"checkHeight",value:function(){this.row.reinitializeHeight()}},{key:"clearHeight",value:function(){this.element.style.height="",this.height=null,this.dispatch("cell-height",this,"")}},{key:"setHeight",value:function(){this.height=this.row.height,this.element.style.height=this.row.heightStyled,this.dispatch("cell-height",this,this.row.heightStyled)}},{key:"getHeight",value:function(){return this.height||this.element.offsetHeight}},{key:"show",value:function(){this.element.style.display=this.column.vertAlign?"inline-flex":""}},{key:"hide",value:function(){this.element.style.display="none"}},{key:"delete",value:function(){this.dispatch("cell-delete",this),!this.table.rowManager.redrawBlock&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.column.deleteCell(this),this.row.deleteCell(this),this.calcs={}}},{key:"getIndex",value:function(){return this.row.getCellIndex(this)}},{key:"getComponent",value:function(){return this.component||(this.component=new CellComponent(this)),this.component}}]),Cell}(CoreFeature),ColumnComponent=function(){function ColumnComponent(column){return _classCallCheck(this,ColumnComponent),this._column=column,this.type="ColumnComponent",new Proxy(this,{get:function(target,name,receiver){return void 0!==target[name]?target[name]:target._column.table.componentFunctionBinder.handle("column",target._column,name)}})}return _createClass(ColumnComponent,[{key:"getElement",value:function(){return this._column.getElement()}},{key:"getDefinition",value:function(){return this._column.getDefinition()}},{key:"getField",value:function(){return this._column.getField()}},{key:"getTitleDownload",value:function(){return this._column.getTitleDownload()}},{key:"getCells",value:function(){var cells=[];return this._column.cells.forEach((function(cell){cells.push(cell.getComponent())})),cells}},{key:"isVisible",value:function(){return this._column.visible}},{key:"show",value:function(){this._column.isGroup?this._column.columns.forEach((function(column){column.show()})):this._column.show()}},{key:"hide",value:function(){this._column.isGroup?this._column.columns.forEach((function(column){column.hide()})):this._column.hide()}},{key:"toggle",value:function(){this._column.visible?this.hide():this.show()}},{key:"delete",value:function(){return this._column.delete()}},{key:"getSubColumns",value:function(){var output=[];return this._column.columns.length&&this._column.columns.forEach((function(column){output.push(column.getComponent())})),output}},{key:"getParentColumn",value:function(){return this._column.parent instanceof Column&&this._column.parent.getComponent()}},{key:"_getSelf",value:function(){return this._column}},{key:"scrollTo",value:function(){return this._column.table.columnManager.scrollToColumn(this._column)}},{key:"getTable",value:function(){return this._column.table}},{key:"move",value:function(to,after){var toColumn=this._column.table.columnManager.findColumn(to);toColumn?this._column.table.columnManager.moveColumn(this._column,toColumn,after):console.warn("Move Error - No matching column found:",toColumn)}},{key:"getNextColumn",value:function(){var nextCol=this._column.nextColumn();return!!nextCol&&nextCol.getComponent()}},{key:"getPrevColumn",value:function(){var prevCol=this._column.prevColumn();return!!prevCol&&prevCol.getComponent()}},{key:"updateDefinition",value:function(updates){return this._column.updateDefinition(updates)}},{key:"getWidth",value:function(){return this._column.getWidth()}},{key:"setWidth",value:function(width){var result;return result=!0===width?this._column.reinitializeWidth(!0):this._column.setWidth(width),this._column.table.columnManager.rerenderColumns(!0),result}}]),ColumnComponent}();_exports.ColumnComponent=ColumnComponent;var defaultColumnOptions={title:void 0,field:void 0,columns:void 0,visible:void 0,hozAlign:void 0,vertAlign:void 0,width:void 0,minWidth:40,maxWidth:void 0,maxInitialWidth:void 0,cssClass:void 0,variableHeight:void 0,headerVertical:void 0,headerHozAlign:void 0,headerWordWrap:!1,editableTitle:void 0},Column=function(_CoreFeature4){_inherits(Column,_CoreFeature4);var _super7=_createSuper(Column);function Column(def,parent){var _this17;return _classCallCheck(this,Column),(_this17=_super7.call(this,parent.table)).definition=def,_this17.parent=parent,_this17.type="column",_this17.columns=[],_this17.cells=[],_this17.element=_this17.createElement(),_this17.contentElement=!1,_this17.titleHolderElement=!1,_this17.titleElement=!1,_this17.groupElement=_this17.createGroupElement(),_this17.isGroup=!1,_this17.hozAlign="",_this17.vertAlign="",_this17.field="",_this17.fieldStructure="",_this17.getFieldValue="",_this17.setFieldValue="",_this17.titleDownload=null,_this17.titleFormatterRendered=!1,_this17.mapDefinitions(),_this17.setField(_this17.definition.field),_this17.modules={},_this17.width=null,_this17.widthStyled="",_this17.maxWidth=null,_this17.maxWidthStyled="",_this17.maxInitialWidth=null,_this17.minWidth=null,_this17.minWidthStyled="",_this17.widthFixed=!1,_this17.visible=!0,_this17.component=null,_this17.definition.columns?(_this17.isGroup=!0,_this17.definition.columns.forEach((function(def,i){var newCol=new Column(def,_assertThisInitialized(_this17));_this17.attachColumn(newCol)})),_this17.checkColumnVisibility()):parent.registerColumnField(_assertThisInitialized(_this17)),_this17._initialize(),_this17}return _createClass(Column,[{key:"createElement",value:function(){var el=document.createElement("div");switch(el.classList.add("tabulator-col"),el.setAttribute("role","columnheader"),el.setAttribute("aria-sort","none"),this.table.options.columnHeaderVertAlign){case"middle":el.style.justifyContent="center";break;case"bottom":el.style.justifyContent="flex-end"}return el}},{key:"createGroupElement",value:function(){var el=document.createElement("div");return el.classList.add("tabulator-col-group-cols"),el}},{key:"mapDefinitions",value:function(){var defaults=this.table.options.columnDefaults;if(defaults)for(var key in defaults)void 0===this.definition[key]&&(this.definition[key]=defaults[key]);this.definition=this.table.columnManager.optionsList.generate(Column.defaultOptionList,this.definition)}},{key:"checkDefinition",value:function(){var _this18=this;Object.keys(this.definition).forEach((function(key){-1===Column.defaultOptionList.indexOf(key)&&console.warn("Invalid column definition option in '"+(_this18.field||_this18.definition.title)+"' column:",key)}))}},{key:"setField",value:function(field){this.field=field,this.fieldStructure=field?this.table.options.nestedFieldSeparator?field.split(this.table.options.nestedFieldSeparator):[field]:[],this.getFieldValue=this.fieldStructure.length>1?this._getNestedData:this._getFlatData,this.setFieldValue=this.fieldStructure.length>1?this._setNestedData:this._setFlatData}},{key:"registerColumnPosition",value:function(column){this.parent.registerColumnPosition(column)}},{key:"registerColumnField",value:function(column){this.parent.registerColumnField(column)}},{key:"reRegisterPosition",value:function(){this.isGroup?this.columns.forEach((function(column){column.reRegisterPosition()})):this.registerColumnPosition(this)}},{key:"_initialize",value:function(){for(var def=this.definition;this.element.firstChild;)this.element.removeChild(this.element.firstChild);def.headerVertical&&(this.element.classList.add("tabulator-col-vertical"),"flip"===def.headerVertical&&this.element.classList.add("tabulator-col-vertical-flip")),this.contentElement=this._buildColumnHeaderContent(),this.element.appendChild(this.contentElement),this.isGroup?this._buildGroupHeader():this._buildColumnHeader(),this.dispatch("column-init",this)}},{key:"_buildColumnHeader",value:function(){var _this19=this,def=this.definition;(this.dispatch("column-layout",this),void 0!==def.visible&&(def.visible?this.show(!0):this.hide(!0)),def.cssClass)&&def.cssClass.split(" ").forEach((function(className){_this19.element.classList.add(className)}));def.field&&this.element.setAttribute("tabulator-field",def.field),this.setMinWidth(parseInt(def.minWidth)),def.maxInitialWidth&&(this.maxInitialWidth=parseInt(def.maxInitialWidth)),def.maxWidth&&this.setMaxWidth(parseInt(def.maxWidth)),this.reinitializeWidth(),this.hozAlign=this.definition.hozAlign,this.vertAlign=this.definition.vertAlign,this.titleElement.style.textAlign=this.definition.headerHozAlign}},{key:"_buildColumnHeaderContent",value:function(){var contentElement=document.createElement("div");return contentElement.classList.add("tabulator-col-content"),this.titleHolderElement=document.createElement("div"),this.titleHolderElement.classList.add("tabulator-col-title-holder"),contentElement.appendChild(this.titleHolderElement),this.titleElement=this._buildColumnHeaderTitle(),this.titleHolderElement.appendChild(this.titleElement),contentElement}},{key:"_buildColumnHeaderTitle",value:function(){var _this20=this,def=this.definition,titleHolderElement=document.createElement("div");if(titleHolderElement.classList.add("tabulator-col-title"),def.headerWordWrap&&titleHolderElement.classList.add("tabulator-col-title-wrap"),def.editableTitle){var titleElement=document.createElement("input");titleElement.classList.add("tabulator-title-editor"),titleElement.addEventListener("click",(function(e){e.stopPropagation(),titleElement.focus()})),titleElement.addEventListener("change",(function(){def.title=titleElement.value,_this20.dispatchExternal("columnTitleChanged",_this20.getComponent())})),titleHolderElement.appendChild(titleElement),def.field?this.langBind("columns|"+def.field,(function(text){titleElement.value=text||def.title||"&nbsp;"})):titleElement.value=def.title||"&nbsp;"}else def.field?this.langBind("columns|"+def.field,(function(text){_this20._formatColumnHeaderTitle(titleHolderElement,text||def.title||"&nbsp;")})):this._formatColumnHeaderTitle(titleHolderElement,def.title||"&nbsp;");return titleHolderElement}},{key:"_formatColumnHeaderTitle",value:function(el,title){var contents=this.chain("column-format",[this,title,el],null,(function(){return title}));switch(_typeof(contents)){case"object":contents instanceof Node?el.appendChild(contents):(el.innerHTML="",console.warn("Format Error - Title formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",contents));break;case"undefined":el.innerHTML="";break;default:el.innerHTML=contents}}},{key:"_buildGroupHeader",value:function(){var _this21=this;(this.element.classList.add("tabulator-col-group"),this.element.setAttribute("role","columngroup"),this.element.setAttribute("aria-title",this.definition.title),this.definition.cssClass)&&this.definition.cssClass.split(" ").forEach((function(className){_this21.element.classList.add(className)}));this.titleElement.style.textAlign=this.definition.headerHozAlign,this.element.appendChild(this.groupElement)}},{key:"_getFlatData",value:function(data){return data[this.field]}},{key:"_getNestedData",value:function(data){for(var output,dataObj=data,structure=this.fieldStructure,length=structure.length,i=0;i<length&&(output=dataObj=dataObj[structure[i]],dataObj);i++);return output}},{key:"_setFlatData",value:function(data,value){this.field&&(data[this.field]=value)}},{key:"_setNestedData",value:function(data,value){for(var dataObj=data,structure=this.fieldStructure,length=structure.length,i=0;i<length;i++)if(i==length-1)dataObj[structure[i]]=value;else{if(!dataObj[structure[i]]){if(void 0===value)break;dataObj[structure[i]]={}}dataObj=dataObj[structure[i]]}}},{key:"attachColumn",value:function(column){this.groupElement?(this.columns.push(column),this.groupElement.appendChild(column.getElement()),column.columnRendered()):console.warn("Column Warning - Column being attached to another column instead of column group")}},{key:"verticalAlign",value:function(alignment,height){var parentHeight=this.parent.isGroup?this.parent.getGroupElement().clientHeight:height||this.parent.getHeadersElement().clientHeight;this.element.style.height=parentHeight+"px",this.dispatch("column-height",this,this.element.style.height),this.isGroup&&(this.groupElement.style.minHeight=parentHeight-this.contentElement.offsetHeight+"px"),this.columns.forEach((function(column){column.verticalAlign(alignment)}))}},{key:"clearVerticalAlign",value:function(){this.element.style.paddingTop="",this.element.style.height="",this.element.style.minHeight="",this.groupElement.style.minHeight="",this.columns.forEach((function(column){column.clearVerticalAlign()})),this.dispatch("column-height",this,"")}},{key:"getElement",value:function(){return this.element}},{key:"getGroupElement",value:function(){return this.groupElement}},{key:"getField",value:function(){return this.field}},{key:"getTitleDownload",value:function(){return this.titleDownload}},{key:"getFirstColumn",value:function(){return this.isGroup?!!this.columns.length&&this.columns[0].getFirstColumn():this}},{key:"getLastColumn",value:function(){return this.isGroup?!!this.columns.length&&this.columns[this.columns.length-1].getLastColumn():this}},{key:"getColumns",value:function(traverse){var columns=[];return traverse?this.columns.forEach((function(column){columns.push(column),columns=columns.concat(column.getColumns(!0))})):columns=this.columns,columns}},{key:"getCells",value:function(){return this.cells}},{key:"getTopColumn",value:function(){return this.parent.isGroup?this.parent.getTopColumn():this}},{key:"getDefinition",value:function(updateBranches){var colDefs=[];return this.isGroup&&updateBranches&&(this.columns.forEach((function(column){colDefs.push(column.getDefinition(!0))})),this.definition.columns=colDefs),this.definition}},{key:"checkColumnVisibility",value:function(){var visible=!1;this.columns.forEach((function(column){column.visible&&(visible=!0)})),visible?(this.show(),this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1)):this.hide()}},{key:"show",value:function(silent,responsiveToggle){this.visible||(this.visible=!0,this.element.style.display="",this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach((function(cell){cell.show()})),this.isGroup||null!==this.width||this.reinitializeWidth(),this.table.columnManager.verticalAlignHeaders(),this.dispatch("column-show",this,responsiveToggle),silent||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!0),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}},{key:"hide",value:function(silent,responsiveToggle){this.visible&&(this.visible=!1,this.element.style.display="none",this.table.columnManager.verticalAlignHeaders(),this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach((function(cell){cell.hide()})),this.dispatch("column-hide",this,responsiveToggle),silent||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}},{key:"matchChildWidths",value:function(){var childWidth=0;this.contentElement&&this.columns.length&&(this.columns.forEach((function(column){column.visible&&(childWidth+=column.getWidth())})),this.contentElement.style.maxWidth=childWidth-1+"px",this.parent.isGroup&&this.parent.matchChildWidths())}},{key:"removeChild",value:function(child){var index=this.columns.indexOf(child);index>-1&&this.columns.splice(index,1),this.columns.length||this.delete()}},{key:"setWidth",value:function(width){this.widthFixed=!0,this.setWidthActual(width)}},{key:"setWidthActual",value:function(width){isNaN(width)&&(width=Math.floor(this.table.element.clientWidth/100*parseInt(width))),width=Math.max(this.minWidth,width),this.maxWidth&&(width=Math.min(this.maxWidth,width)),this.width=width,this.widthStyled=width?width+"px":"",this.element.style.width=this.widthStyled,this.isGroup||this.cells.forEach((function(cell){cell.setWidth()})),this.parent.isGroup&&this.parent.matchChildWidths(),this.dispatch("column-width",this)}},{key:"checkCellHeights",value:function(){var rows=[];this.cells.forEach((function(cell){cell.row.heightInitialized&&(null!==cell.row.getElement().offsetParent?(rows.push(cell.row),cell.row.clearCellHeight()):cell.row.heightInitialized=!1)})),rows.forEach((function(row){row.calcHeight()})),rows.forEach((function(row){row.setCellHeight()}))}},{key:"getWidth",value:function(){var width=0;return this.isGroup?this.columns.forEach((function(column){column.visible&&(width+=column.getWidth())})):width=this.width,width}},{key:"getLeftOffset",value:function(){var offset=this.element.offsetLeft;return this.parent.isGroup&&(offset+=this.parent.getLeftOffset()),offset}},{key:"getHeight",value:function(){return Math.ceil(this.element.getBoundingClientRect().height)}},{key:"setMinWidth",value:function(minWidth){this.maxWidth&&minWidth>this.maxWidth&&(minWidth=this.maxWidth,console.warn("the minWidth ("+minWidth+"px) for column '"+this.field+"' cannot be bigger that its maxWidth ("+this.maxWidthStyled+")")),this.minWidth=minWidth,this.minWidthStyled=minWidth?minWidth+"px":"",this.element.style.minWidth=this.minWidthStyled,this.cells.forEach((function(cell){cell.setMinWidth()}))}},{key:"setMaxWidth",value:function(maxWidth){this.minWidth&&maxWidth<this.minWidth&&(maxWidth=this.minWidth,console.warn("the maxWidth ("+maxWidth+"px) for column '"+this.field+"' cannot be smaller that its minWidth ("+this.minWidthStyled+")")),this.maxWidth=maxWidth,this.maxWidthStyled=maxWidth?maxWidth+"px":"",this.element.style.maxWidth=this.maxWidthStyled,this.cells.forEach((function(cell){cell.setMaxWidth()}))}},{key:"delete",value:function(){var _this22=this;return new Promise((function(resolve,reject){_this22.isGroup&&_this22.columns.forEach((function(column){column.delete()})),_this22.dispatch("column-delete",_this22);for(var cellCount=_this22.cells.length,i=0;i<cellCount;i++)_this22.cells[0].delete();_this22.element.parentNode&&_this22.element.parentNode.removeChild(_this22.element),_this22.element=!1,_this22.contentElement=!1,_this22.titleElement=!1,_this22.groupElement=!1,_this22.parent.isGroup&&_this22.parent.removeChild(_this22),_this22.table.columnManager.deregisterColumn(_this22),_this22.table.columnManager.rerenderColumns(!0),resolve()}))}},{key:"columnRendered",value:function(){this.titleFormatterRendered&&this.titleFormatterRendered(),this.dispatch("column-rendered",this)}},{key:"generateCell",value:function(row){var cell=new Cell(this,row);return this.cells.push(cell),cell}},{key:"nextColumn",value:function(){var index=this.table.columnManager.findColumnIndex(this);return index>-1&&this._nextVisibleColumn(index+1)}},{key:"_nextVisibleColumn",value:function(index){var column=this.table.columnManager.getColumnByIndex(index);return!column||column.visible?column:this._nextVisibleColumn(index+1)}},{key:"prevColumn",value:function(){var index=this.table.columnManager.findColumnIndex(this);return index>-1&&this._prevVisibleColumn(index-1)}},{key:"_prevVisibleColumn",value:function(index){var column=this.table.columnManager.getColumnByIndex(index);return!column||column.visible?column:this._prevVisibleColumn(index-1)}},{key:"reinitializeWidth",value:function(force){this.widthFixed=!1,void 0===this.definition.width||force||this.setWidth(this.definition.width),this.dispatch("column-width-fit-before",this),this.fitToData(force),this.dispatch("column-width-fit-after",this)}},{key:"fitToData",value:function(force){if(!this.isGroup){this.widthFixed||(this.element.style.width="",this.cells.forEach((function(cell){cell.clearWidth()})));var maxWidth=this.element.offsetWidth;if((!this.width||!this.widthFixed)&&(this.cells.forEach((function(cell){var width=cell.getWidth();width>maxWidth&&(maxWidth=width)})),maxWidth)){var setTo=maxWidth+1;this.maxInitialWidth&&!force&&(setTo=Math.min(setTo,this.maxInitialWidth)),this.setWidthActual(setTo)}}}},{key:"updateDefinition",value:function(updates){var definition,_this23=this;return this.isGroup||this.parent.isGroup?(console.error("Column Update Error - The updateDefinition function is only available on ungrouped columns"),Promise.reject("Column Update Error - The updateDefinition function is only available on columns, not column groups")):(definition=Object.assign({},this.getDefinition()),definition=Object.assign(definition,updates),this.table.columnManager.addColumn(definition,!1,this).then((function(column){return definition.field==_this23.field&&(_this23.field=!1),_this23.delete().then((function(){return column.getComponent()}))})))}},{key:"deleteCell",value:function(cell){var index=this.cells.indexOf(cell);index>-1&&this.cells.splice(index,1)}},{key:"getComponent",value:function(){return this.component||(this.component=new ColumnComponent(this)),this.component}}]),Column}(CoreFeature);Column.defaultOptionList=defaultColumnOptions;var RowComponent=function(){function RowComponent(row){return _classCallCheck(this,RowComponent),this._row=row,new Proxy(this,{get:function(target,name,receiver){return void 0!==target[name]?target[name]:target._row.table.componentFunctionBinder.handle("row",target._row,name)}})}return _createClass(RowComponent,[{key:"getData",value:function(transform){return this._row.getData(transform)}},{key:"getElement",value:function(){return this._row.getElement()}},{key:"getCells",value:function(){var cells=[];return this._row.getCells().forEach((function(cell){cells.push(cell.getComponent())})),cells}},{key:"getCell",value:function(column){var cell=this._row.getCell(column);return!!cell&&cell.getComponent()}},{key:"getIndex",value:function(){return this._row.getData("data")[this._row.table.options.index]}},{key:"getPosition",value:function(){return this._row.getPosition()}},{key:"watchPosition",value:function(callback){return this._row.watchPosition(callback)}},{key:"delete",value:function(){return this._row.delete()}},{key:"scrollTo",value:function(){return this._row.table.rowManager.scrollToRow(this._row)}},{key:"move",value:function(to,after){this._row.moveToRow(to,after)}},{key:"update",value:function(data){return this._row.updateData(data)}},{key:"normalizeHeight",value:function(){this._row.normalizeHeight(!0)}},{key:"_getSelf",value:function(){return this._row}},{key:"reformat",value:function(){return this._row.reinitialize()}},{key:"getTable",value:function(){return this._row.table}},{key:"getNextRow",value:function(){var row=this._row.nextRow();return row?row.getComponent():row}},{key:"getPrevRow",value:function(){var row=this._row.prevRow();return row?row.getComponent():row}}]),RowComponent}();_exports.RowComponent=RowComponent;var Row=function(_CoreFeature5){_inherits(Row,_CoreFeature5);var _super8=_createSuper(Row);function Row(data,parent){var _this24,type=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"row";return _classCallCheck(this,Row),(_this24=_super8.call(this,parent.table)).parent=parent,_this24.data={},_this24.type=type,_this24.element=!1,_this24.modules={},_this24.cells=[],_this24.height=0,_this24.heightStyled="",_this24.manualHeight=!1,_this24.outerHeight=0,_this24.initialized=!1,_this24.heightInitialized=!1,_this24.position=0,_this24.positionWatchers=[],_this24.component=null,_this24.created=!1,_this24.setData(data),_this24}return _createClass(Row,[{key:"create",value:function(){this.created||(this.created=!0,this.generateElement())}},{key:"createElement",value:function(){var el=document.createElement("div");el.classList.add("tabulator-row"),el.setAttribute("role","row"),this.element=el}},{key:"getElement",value:function(){return this.create(),this.element}},{key:"detachElement",value:function(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}},{key:"generateElement",value:function(){this.createElement(),this.dispatch("row-init",this)}},{key:"generateCells",value:function(){this.cells=this.table.columnManager.generateCells(this)}},{key:"initialize",value:function(force){if(this.create(),!this.initialized||force){for(this.deleteCells();this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.dispatch("row-layout-before",this),this.generateCells(),this.initialized=!0,this.table.columnManager.renderer.renderRowCells(this),force&&this.normalizeHeight(),this.dispatch("row-layout",this),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent()),this.dispatch("row-layout-after",this)}else this.table.columnManager.renderer.rerenderRowCells(this)}},{key:"reinitializeHeight",value:function(){this.heightInitialized=!1,this.element&&null!==this.element.offsetParent&&this.normalizeHeight(!0)}},{key:"deinitialize",value:function(){this.initialized=!1}},{key:"deinitializeHeight",value:function(){this.heightInitialized=!1}},{key:"reinitialize",value:function(children){this.initialized=!1,this.heightInitialized=!1,this.manualHeight||(this.height=0,this.heightStyled=""),this.element&&null!==this.element.offsetParent&&this.initialize(!0),this.dispatch("row-relayout",this)}},{key:"calcHeight",value:function(force){var minHeight,maxHeight=0;this.table.options.rowHeight?this.height=this.table.options.rowHeight:(minHeight=this.table.options.resizableRows?this.element.clientHeight:0,this.cells.forEach((function(cell){var height=cell.getHeight();height>maxHeight&&(maxHeight=height)})),this.height=force?Math.max(maxHeight,minHeight):this.manualHeight?this.height:Math.max(maxHeight,minHeight)),this.heightStyled=this.height?this.height+"px":"",this.outerHeight=this.element.offsetHeight}},{key:"setCellHeight",value:function(){this.cells.forEach((function(cell){cell.setHeight()})),this.heightInitialized=!0}},{key:"clearCellHeight",value:function(){this.cells.forEach((function(cell){cell.clearHeight()}))}},{key:"normalizeHeight",value:function(force){force&&!this.table.options.rowHeight&&this.clearCellHeight(),this.calcHeight(force),this.setCellHeight()}},{key:"setHeight",value:function(height,force){(this.height!=height||force)&&(this.manualHeight=!0,this.height=height,this.heightStyled=height?height+"px":"",this.setCellHeight(),this.outerHeight=this.element.offsetHeight)}},{key:"getHeight",value:function(){return this.outerHeight}},{key:"getWidth",value:function(){return this.element.offsetWidth}},{key:"deleteCell",value:function(cell){var index=this.cells.indexOf(cell);index>-1&&this.cells.splice(index,1)}},{key:"setData",value:function(data){this.data=this.chain("row-data-init-before",[this,data],void 0,data),this.dispatch("row-data-init-after",this)}},{key:"updateData",value:function(updatedData){var newRowData,_this25=this,visible=this.element&&Helpers.elVisible(this.element),tempData={};return new Promise((function(resolve,reject){for(var attrname in"string"==typeof updatedData&&(updatedData=JSON.parse(updatedData)),_this25.dispatch("row-data-save-before",_this25),_this25.subscribed("row-data-changing")&&(tempData=Object.assign(tempData,_this25.data),tempData=Object.assign(tempData,updatedData)),newRowData=_this25.chain("row-data-changing",[_this25,tempData,updatedData],null,updatedData))_this25.data[attrname]=newRowData[attrname];for(var _attrname in _this25.dispatch("row-data-save-after",_this25),updatedData){_this25.table.columnManager.getColumnsByFieldRoot(_attrname).forEach((function(column){var cell=_this25.getCell(column.getField());if(cell){var value=column.getFieldValue(newRowData);cell.getValue()!==value&&(cell.setValueProcessData(value),visible&&cell.cellRendered())}}))}visible?(_this25.normalizeHeight(!0),_this25.table.options.rowFormatter&&_this25.table.options.rowFormatter(_this25.getComponent())):(_this25.initialized=!1,_this25.height=0,_this25.heightStyled=""),_this25.dispatch("row-data-changed",_this25,visible,updatedData),_this25.dispatchExternal("rowUpdated",_this25.getComponent()),_this25.subscribedExternal("dataChanged")&&_this25.dispatchExternal("dataChanged",_this25.table.rowManager.getData()),resolve()}))}},{key:"getData",value:function(transform){return transform?this.chain("row-data-retrieve",[this,transform],null,this.data):this.data}},{key:"getCell",value:function(column){return column=this.table.columnManager.findColumn(column),this.initialized||this.generateCells(),this.cells.find((function(cell){return cell.column===column}))}},{key:"getCellIndex",value:function(findCell){return this.cells.findIndex((function(cell){return cell===findCell}))}},{key:"findCell",value:function(subject){return this.cells.find((function(cell){return cell.element===subject}))}},{key:"getCells",value:function(){return this.initialized||this.generateCells(),this.cells}},{key:"nextRow",value:function(){return this.table.rowManager.nextDisplayRow(this,!0)||!1}},{key:"prevRow",value:function(){return this.table.rowManager.prevDisplayRow(this,!0)||!1}},{key:"moveToRow",value:function(to,before){var toRow=this.table.rowManager.findRow(to);toRow?(this.table.rowManager.moveRowActual(this,toRow,!before),this.table.rowManager.refreshActiveData("display",!1,!0)):console.warn("Move Error - No matching row found:",to)}},{key:"delete",value:function(){return this.dispatch("row-delete",this),this.deleteActual(),Promise.resolve()}},{key:"deleteActual",value:function(blockRedraw){this.detachModules(),this.table.rowManager.deleteRow(this,blockRedraw),this.deleteCells(),this.initialized=!1,this.heightInitialized=!1,this.element=!1,this.dispatch("row-deleted",this)}},{key:"detachModules",value:function(){this.dispatch("row-deleting",this)}},{key:"deleteCells",value:function(){for(var cellCount=this.cells.length,i=0;i<cellCount;i++)this.cells[0].delete()}},{key:"wipe",value:function(){if(this.detachModules(),this.deleteCells(),this.element){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.parentNode&&this.element.parentNode.removeChild(this.element)}this.element=!1,this.modules={}}},{key:"isDisplayed",value:function(){return this.table.rowManager.getDisplayRows().includes(this)}},{key:"getPosition",value:function(){return!!this.isDisplayed()&&this.position}},{key:"setPosition",value:function(position){var _this26=this;position!=this.position&&(this.position=position,this.positionWatchers.forEach((function(callback){callback(_this26.position)})))}},{key:"watchPosition",value:function(callback){this.positionWatchers.push(callback),callback(this.position)}},{key:"getGroup",value:function(){return this.modules.group||!1}},{key:"getComponent",value:function(){return this.component||(this.component=new RowComponent(this)),this.component}}]),Row}(CoreFeature),defaultCalculations={avg:function(values,data,calcParams){var output=0,precision=void 0!==calcParams.precision?calcParams.precision:2;return values.length&&(output=values.reduce((function(sum,value){return Number(sum)+Number(value)})),output/=values.length,output=!1!==precision?output.toFixed(precision):output),parseFloat(output).toString()},max:function(values,data,calcParams){var output=null,precision=void 0!==calcParams.precision&&calcParams.precision;return values.forEach((function(value){((value=Number(value))>output||null===output)&&(output=value)})),null!==output?!1!==precision?output.toFixed(precision):output:""},min:function(values,data,calcParams){var output=null,precision=void 0!==calcParams.precision&&calcParams.precision;return values.forEach((function(value){((value=Number(value))<output||null===output)&&(output=value)})),null!==output?!1!==precision?output.toFixed(precision):output:""},sum:function(values,data,calcParams){var output=0,precision=void 0!==calcParams.precision&&calcParams.precision;return values.length&&values.forEach((function(value){value=Number(value),output+=isNaN(value)?0:Number(value)})),!1!==precision?output.toFixed(precision):output},concat:function(values,data,calcParams){var output=0;return values.length&&(output=values.reduce((function(sum,value){return String(sum)+String(value)}))),output},count:function(values,data,calcParams){var output=0;return values.length&&values.forEach((function(value){value&&output++})),output}},ColumnCalcs=function(_Module4){_inherits(ColumnCalcs,_Module4);var _super9=_createSuper(ColumnCalcs);function ColumnCalcs(table){var _this27;return _classCallCheck(this,ColumnCalcs),(_this27=_super9.call(this,table)).topCalcs=[],_this27.botCalcs=[],_this27.genColumn=!1,_this27.topElement=_this27.createElement(),_this27.botElement=_this27.createElement(),_this27.topRow=!1,_this27.botRow=!1,_this27.topInitialized=!1,_this27.botInitialized=!1,_this27.blocked=!1,_this27.recalcAfterBlock=!1,_this27.registerTableOption("columnCalcs",!0),_this27.registerColumnOption("topCalc"),_this27.registerColumnOption("topCalcParams"),_this27.registerColumnOption("topCalcFormatter"),_this27.registerColumnOption("topCalcFormatterParams"),_this27.registerColumnOption("bottomCalc"),_this27.registerColumnOption("bottomCalcParams"),_this27.registerColumnOption("bottomCalcFormatter"),_this27.registerColumnOption("bottomCalcFormatterParams"),_this27}return _createClass(ColumnCalcs,[{key:"createElement",value:function(){var el=document.createElement("div");return el.classList.add("tabulator-calcs-holder"),el}},{key:"initialize",value:function(){this.genColumn=new Column({field:"value"},this),this.subscribe("cell-value-changed",this.cellValueChanged.bind(this)),this.subscribe("column-init",this.initializeColumnCheck.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("column-moved",this.recalcActiveRows.bind(this)),this.subscribe("column-add",this.recalcActiveRows.bind(this)),this.subscribe("data-refreshed",this.recalcActiveRowsRefresh.bind(this)),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this)),this.subscribe("redraw-blocked",this.blockRedraw.bind(this)),this.subscribe("redraw-restored",this.restoreRedraw.bind(this)),this.registerTableFunction("getCalcResults",this.getResults.bind(this)),this.registerTableFunction("recalc",this.userRecalc.bind(this))}},{key:"tableRedraw",value:function(force){this.recalc(this.table.rowManager.activeRows),force&&this.redraw()}},{key:"blockRedraw",value:function(){this.blocked=!0,this.recalcAfterBlock=!1}},{key:"restoreRedraw",value:function(){this.blocked=!1,this.recalcAfterBlock&&(this.recalcAfterBlock=!1,this.recalcActiveRowsRefresh())}},{key:"userRecalc",value:function(){this.recalc(this.table.rowManager.activeRows)}},{key:"blockCheck",value:function(){return this.blocked&&(this.recalcAfterBlock=!0),this.blocked}},{key:"visibleRows",value:function(viewable,rows){return this.topRow&&rows.unshift(this.topRow),this.botRow&&rows.push(this.botRow),rows}},{key:"rowsUpdated",value:function(row){this.table.options.groupBy?this.recalcRowGroup(row):this.recalcActiveRows()}},{key:"recalcActiveRowsRefresh",value:function(){this.table.options.groupBy&&this.table.options.dataTreeStartExpanded&&this.table.options.dataTree?this.recalcAll():this.recalcActiveRows()}},{key:"recalcActiveRows",value:function(){this.recalc(this.table.rowManager.activeRows)}},{key:"cellValueChanged",value:function(cell){(cell.column.definition.topCalc||cell.column.definition.bottomCalc)&&(this.table.options.groupBy?("table"!=this.table.options.columnCalcs&&"both"!=this.table.options.columnCalcs||this.recalcActiveRows(),"table"!=this.table.options.columnCalcs&&this.recalcRowGroup(cell.row)):this.recalcActiveRows())}},{key:"initializeColumnCheck",value:function(column){(column.definition.topCalc||column.definition.bottomCalc)&&this.initializeColumn(column)}},{key:"initializeColumn",value:function(column){var def=column.definition,config={topCalcParams:def.topCalcParams||{},botCalcParams:def.bottomCalcParams||{}};if(def.topCalc){switch(_typeof(def.topCalc)){case"string":ColumnCalcs.calculations[def.topCalc]?config.topCalc=ColumnCalcs.calculations[def.topCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",def.topCalc);break;case"function":config.topCalc=def.topCalc}config.topCalc&&(column.modules.columnCalcs=config,this.topCalcs.push(column),"group"!=this.table.options.columnCalcs&&this.initializeTopRow())}if(def.bottomCalc){switch(_typeof(def.bottomCalc)){case"string":ColumnCalcs.calculations[def.bottomCalc]?config.botCalc=ColumnCalcs.calculations[def.bottomCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",def.bottomCalc);break;case"function":config.botCalc=def.bottomCalc}config.botCalc&&(column.modules.columnCalcs=config,this.botCalcs.push(column),"group"!=this.table.options.columnCalcs&&this.initializeBottomRow())}}},{key:"registerColumnField",value:function(){}},{key:"removeCalcs",value:function(){var changed=!1;this.topInitialized&&(this.topInitialized=!1,this.topElement.parentNode.removeChild(this.topElement),changed=!0),this.botInitialized&&(this.botInitialized=!1,this.footerRemove(this.botElement),changed=!0),changed&&this.table.rowManager.adjustTableSize()}},{key:"reinitializeCalcs",value:function(){this.topCalcs.length&&this.initializeTopRow(),this.botCalcs.length&&this.initializeBottomRow()}},{key:"initializeTopRow",value:function(){this.topInitialized||(this.table.columnManager.getContentsElement().insertBefore(this.topElement,this.table.columnManager.headersElement.nextSibling),this.topInitialized=!0)}},{key:"initializeBottomRow",value:function(){this.botInitialized||(this.footerPrepend(this.botElement),this.botInitialized=!0)}},{key:"scrollHorizontal",value:function(left){this.botInitialized&&this.botRow&&(this.botElement.scrollLeft=left)}},{key:"recalc",value:function(rows){var data,row;if(!this.blockCheck()&&(this.topInitialized||this.botInitialized)){if(data=this.rowsToData(rows),this.topInitialized){for(this.topRow&&this.topRow.deleteCells(),row=this.generateRow("top",data),this.topRow=row;this.topElement.firstChild;)this.topElement.removeChild(this.topElement.firstChild);this.topElement.appendChild(row.getElement()),row.initialize(!0)}if(this.botInitialized){for(this.botRow&&this.botRow.deleteCells(),row=this.generateRow("bottom",data),this.botRow=row;this.botElement.firstChild;)this.botElement.removeChild(this.botElement.firstChild);this.botElement.appendChild(row.getElement()),row.initialize(!0)}this.table.rowManager.adjustTableSize(),this.table.modExists("frozenColumns")&&this.table.modules.frozenColumns.layout()}}},{key:"recalcRowGroup",value:function(row){this.recalcGroup(this.table.modules.groupRows.getRowGroup(row))}},{key:"recalcAll",value:function(){var _this28=this;(this.topCalcs.length||this.botCalcs.length)&&("group"!==this.table.options.columnCalcs&&this.recalcActiveRows(),this.table.options.groupBy&&"table"!==this.table.options.columnCalcs&&this.table.modules.groupRows.getChildGroups().forEach((function(group){_this28.recalcGroup(group)})))}},{key:"recalcGroup",value:function(group){var data,rowData;this.blockCheck()||group&&group.calcs&&(group.calcs.bottom&&(data=this.rowsToData(group.rows),rowData=this.generateRowData("bottom",data),group.calcs.bottom.updateData(rowData),group.calcs.bottom.reinitialize()),group.calcs.top&&(data=this.rowsToData(group.rows),rowData=this.generateRowData("top",data),group.calcs.top.updateData(rowData),group.calcs.top.reinitialize()))}},{key:"generateTopRow",value:function(rows){return this.generateRow("top",this.rowsToData(rows))}},{key:"generateBottomRow",value:function(rows){return this.generateRow("bottom",this.rowsToData(rows))}},{key:"rowsToData",value:function(rows){var _this29=this,data=[];return rows.forEach((function(row){if(data.push(row.getData()),_this29.table.options.dataTree&&_this29.table.options.dataTreeChildColumnCalcs&&row.modules.dataTree&&row.modules.dataTree.open){var children=_this29.rowsToData(_this29.table.modules.dataTree.getFilteredTreeChildren(row));data=data.concat(children)}})),data}},{key:"generateRow",value:function(pos,data){var row,_this30=this,rowData=this.generateRowData(pos,data);return this.table.modExists("mutator")&&this.table.modules.mutator.disable(),row=new Row(rowData,this,"calc"),this.table.modExists("mutator")&&this.table.modules.mutator.enable(),row.getElement().classList.add("tabulator-calcs","tabulator-calcs-"+pos),row.component=!1,row.getComponent=function(){return row.component||(row.component=new CalcComponent(row)),row.component},row.generateCells=function(){var cells=[];_this30.table.columnManager.columnsByIndex.forEach((function(column){_this30.genColumn.setField(column.getField()),_this30.genColumn.hozAlign=column.hozAlign,column.definition[pos+"CalcFormatter"]&&_this30.table.modExists("format")?_this30.genColumn.modules.format={formatter:_this30.table.modules.format.getFormatter(column.definition[pos+"CalcFormatter"]),params:column.definition[pos+"CalcFormatterParams"]||{}}:_this30.genColumn.modules.format={formatter:_this30.table.modules.format.getFormatter("plaintext"),params:{}},_this30.genColumn.definition.cssClass=column.definition.cssClass;var cell=new Cell(_this30.genColumn,row);cell.getElement(),cell.column=column,cell.setWidth(),column.cells.push(cell),cells.push(cell),column.visible||cell.hide()})),row.cells=cells},row}},{key:"generateRowData",value:function(pos,data){var params,paramKey,rowData={},calcs="top"==pos?this.topCalcs:this.botCalcs,type="top"==pos?"topCalc":"botCalc";return calcs.forEach((function(column){var values=[];column.modules.columnCalcs&&column.modules.columnCalcs[type]&&(data.forEach((function(item){values.push(column.getFieldValue(item))})),paramKey=type+"Params",params="function"==typeof column.modules.columnCalcs[paramKey]?column.modules.columnCalcs[paramKey](values,data):column.modules.columnCalcs[paramKey],column.setFieldValue(rowData,column.modules.columnCalcs[type](values,data,params)))})),rowData}},{key:"hasTopCalcs",value:function(){return!!this.topCalcs.length}},{key:"hasBottomCalcs",value:function(){return!!this.botCalcs.length}},{key:"redraw",value:function(){this.topRow&&this.topRow.normalizeHeight(!0),this.botRow&&this.botRow.normalizeHeight(!0)}},{key:"getResults",value:function(){var _this31=this,results={};return this.table.options.groupBy&&this.table.modExists("groupRows")?this.table.modules.groupRows.getGroups(!0).forEach((function(group){results[group.getKey()]=_this31.getGroupResults(group)})):results={top:this.topRow?this.topRow.getData():{},bottom:this.botRow?this.botRow.getData():{}},results}},{key:"getGroupResults",value:function(group){var _this32=this,groupObj=group._getSelf(),subGroups=group.getSubGroups(),subGroupResults={};return subGroups.forEach((function(subgroup){subGroupResults[subgroup.getKey()]=_this32.getGroupResults(subgroup)})),{top:groupObj.calcs.top?groupObj.calcs.top.getData():{},bottom:groupObj.calcs.bottom?groupObj.calcs.bottom.getData():{},groups:subGroupResults}}},{key:"adjustForScrollbar",value:function(width){this.botRow&&(this.table.rtl?this.botElement.style.paddingLeft=width+"px":this.botElement.style.paddingRight=width+"px")}}]),ColumnCalcs}(Module);_exports.ColumnCalcsModule=ColumnCalcs,ColumnCalcs.moduleName="columnCalcs",ColumnCalcs.calculations=defaultCalculations;var DataTree=function(_Module5){_inherits(DataTree,_Module5);var _super10=_createSuper(DataTree);function DataTree(table){var _this33;return _classCallCheck(this,DataTree),(_this33=_super10.call(this,table)).indent=10,_this33.field="",_this33.collapseEl=null,_this33.expandEl=null,_this33.branchEl=null,_this33.elementField=!1,_this33.startOpen=function(){},_this33.registerTableOption("dataTree",!1),_this33.registerTableOption("dataTreeFilter",!0),_this33.registerTableOption("dataTreeSort",!0),_this33.registerTableOption("dataTreeElementColumn",!1),_this33.registerTableOption("dataTreeBranchElement",!0),_this33.registerTableOption("dataTreeChildIndent",9),_this33.registerTableOption("dataTreeChildField","_children"),_this33.registerTableOption("dataTreeCollapseElement",!1),_this33.registerTableOption("dataTreeExpandElement",!1),_this33.registerTableOption("dataTreeStartExpanded",!1),_this33.registerTableOption("dataTreeChildColumnCalcs",!1),_this33.registerTableOption("dataTreeSelectPropagate",!1),_this33.registerComponentFunction("row","treeCollapse",_this33.collapseRow.bind(_assertThisInitialized(_this33))),_this33.registerComponentFunction("row","treeExpand",_this33.expandRow.bind(_assertThisInitialized(_this33))),_this33.registerComponentFunction("row","treeToggle",_this33.toggleRow.bind(_assertThisInitialized(_this33))),_this33.registerComponentFunction("row","getTreeParent",_this33.getTreeParent.bind(_assertThisInitialized(_this33))),_this33.registerComponentFunction("row","getTreeChildren",_this33.getRowChildren.bind(_assertThisInitialized(_this33))),_this33.registerComponentFunction("row","addTreeChild",_this33.addTreeChildRow.bind(_assertThisInitialized(_this33))),_this33.registerComponentFunction("row","isTreeExpanded",_this33.isRowExpanded.bind(_assertThisInitialized(_this33))),_this33}return _createClass(DataTree,[{key:"initialize",value:function(){if(this.table.options.dataTree){var dummyEl=null,options=this.table.options;switch(this.field=options.dataTreeChildField,this.indent=options.dataTreeChildIndent,this.options("movableRows")&&console.warn("The movableRows option is not available with dataTree enabled, moving of child rows could result in unpredictable behavior"),options.dataTreeBranchElement&&(!0===options.dataTreeBranchElement?(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch")):"string"==typeof options.dataTreeBranchElement?((dummyEl=document.createElement("div")).innerHTML=options.dataTreeBranchElement,this.branchEl=dummyEl.firstChild):this.branchEl=options.dataTreeBranchElement),options.dataTreeCollapseElement?"string"==typeof options.dataTreeCollapseElement?((dummyEl=document.createElement("div")).innerHTML=options.dataTreeCollapseElement,this.collapseEl=dummyEl.firstChild):this.collapseEl=options.dataTreeCollapseElement:(this.collapseEl=document.createElement("div"),this.collapseEl.classList.add("tabulator-data-tree-control"),this.collapseEl.tabIndex=0,this.collapseEl.innerHTML="<div class='tabulator-data-tree-control-collapse'></div>"),options.dataTreeExpandElement?"string"==typeof options.dataTreeExpandElement?((dummyEl=document.createElement("div")).innerHTML=options.dataTreeExpandElement,this.expandEl=dummyEl.firstChild):this.expandEl=options.dataTreeExpandElement:(this.expandEl=document.createElement("div"),this.expandEl.classList.add("tabulator-data-tree-control"),this.expandEl.tabIndex=0,this.expandEl.innerHTML="<div class='tabulator-data-tree-control-expand'></div>"),_typeof(options.dataTreeStartExpanded)){case"boolean":this.startOpen=function(row,index){return options.dataTreeStartExpanded};break;case"function":this.startOpen=options.dataTreeStartExpanded;break;default:this.startOpen=function(row,index){return options.dataTreeStartExpanded[index]}}this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("row-deleted",this.rowDelete.bind(this),0),this.subscribe("row-data-changed",this.rowDataChanged.bind(this),10),this.subscribe("cell-value-updated",this.cellValueChanged.bind(this)),this.subscribe("edit-cancelled",this.cellValueChanged.bind(this)),this.subscribe("column-moving-rows",this.columnMoving.bind(this)),this.subscribe("table-built",this.initializeElementField.bind(this)),this.subscribe("table-redrawing",this.tableRedrawing.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),30)}}},{key:"tableRedrawing",value:function(force){var _this34=this;force&&this.table.rowManager.getRows().forEach((function(row){_this34.reinitializeRowChildren(row)}))}},{key:"initializeElementField",value:function(){var firstCol=this.table.columnManager.getFirstVisibleColumn();this.elementField=this.table.options.dataTreeElementColumn||!!firstCol&&firstCol.field}},{key:"getRowChildren",value:function(row){return this.getTreeChildren(row,!0)}},{key:"columnMoving",value:function(){var _this35=this,rows=[];return this.table.rowManager.rows.forEach((function(row){rows=rows.concat(_this35.getTreeChildren(row,!1,!0))})),rows}},{key:"rowDataChanged",value:function(row,visible,updatedData){this.redrawNeeded(updatedData)&&(this.initializeRow(row),visible&&(this.layoutRow(row),this.refreshData(!0)))}},{key:"cellValueChanged",value:function(cell){cell.column.getField()===this.elementField&&this.layoutRow(cell.row)}},{key:"initializeRow",value:function(row){var childArray=row.getData()[this.field],isArray=Array.isArray(childArray),children=isArray||!isArray&&"object"===_typeof(childArray)&&null!==childArray;!children&&row.modules.dataTree&&row.modules.dataTree.branchEl&&row.modules.dataTree.branchEl.parentNode.removeChild(row.modules.dataTree.branchEl),!children&&row.modules.dataTree&&row.modules.dataTree.controlEl&&row.modules.dataTree.controlEl.parentNode.removeChild(row.modules.dataTree.controlEl),row.modules.dataTree={index:row.modules.dataTree?row.modules.dataTree.index:0,open:!!children&&(row.modules.dataTree?row.modules.dataTree.open:this.startOpen(row.getComponent(),0)),controlEl:!(!row.modules.dataTree||!children)&&row.modules.dataTree.controlEl,branchEl:!(!row.modules.dataTree||!children)&&row.modules.dataTree.branchEl,parent:!!row.modules.dataTree&&row.modules.dataTree.parent,children:children}}},{key:"reinitializeRowChildren",value:function(row){this.getTreeChildren(row,!1,!0).forEach((function(child){child.reinitialize(!0)}))}},{key:"layoutRow",value:function(row){var el=(this.elementField?row.getCell(this.elementField):row.getCells()[0]).getElement(),config=row.modules.dataTree;config.branchEl&&(config.branchEl.parentNode&&config.branchEl.parentNode.removeChild(config.branchEl),config.branchEl=!1),config.controlEl&&(config.controlEl.parentNode&&config.controlEl.parentNode.removeChild(config.controlEl),config.controlEl=!1),this.generateControlElement(row,el),row.getElement().classList.add("tabulator-tree-level-"+config.index),config.index&&(this.branchEl?(config.branchEl=this.branchEl.cloneNode(!0),el.insertBefore(config.branchEl,el.firstChild),this.table.rtl?config.branchEl.style.marginRight=(config.branchEl.offsetWidth+config.branchEl.style.marginLeft)*(config.index-1)+config.index*this.indent+"px":config.branchEl.style.marginLeft=(config.branchEl.offsetWidth+config.branchEl.style.marginRight)*(config.index-1)+config.index*this.indent+"px"):this.table.rtl?el.style.paddingRight=parseInt(window.getComputedStyle(el,null).getPropertyValue("padding-right"))+config.index*this.indent+"px":el.style.paddingLeft=parseInt(window.getComputedStyle(el,null).getPropertyValue("padding-left"))+config.index*this.indent+"px")}},{key:"generateControlElement",value:function(row,el){var _this36=this,config=row.modules.dataTree,oldControl=config.controlEl;el=el||row.getCells()[0].getElement(),!1!==config.children&&(config.open?(config.controlEl=this.collapseEl.cloneNode(!0),config.controlEl.addEventListener("click",(function(e){e.stopPropagation(),_this36.collapseRow(row)}))):(config.controlEl=this.expandEl.cloneNode(!0),config.controlEl.addEventListener("click",(function(e){e.stopPropagation(),_this36.expandRow(row)}))),config.controlEl.addEventListener("mousedown",(function(e){e.stopPropagation()})),oldControl&&oldControl.parentNode===el?oldControl.parentNode.replaceChild(config.controlEl,oldControl):el.insertBefore(config.controlEl,el.firstChild))}},{key:"getRows",value:function(rows){var _this37=this,output=[];return rows.forEach((function(row,i){var config;output.push(row),row instanceof Row&&(row.create(),(config=row.modules.dataTree.children).index||!1===config.children||_this37.getChildren(row).forEach((function(child){child.create(),output.push(child)})))})),output}},{key:"getChildren",value:function(row,allChildren){var _this38=this,config=row.modules.dataTree,children=[],output=[];return!1!==config.children&&(config.open||allChildren)&&(Array.isArray(config.children)||(config.children=this.generateChildren(row)),children=this.table.modExists("filter")&&this.table.options.dataTreeFilter?this.table.modules.filter.filter(config.children):config.children,this.table.modExists("sort")&&this.table.options.dataTreeSort&&this.table.modules.sort.sort(children),children.forEach((function(child){output.push(child),_this38.getChildren(child).forEach((function(sub){output.push(sub)}))}))),output}},{key:"generateChildren",value:function(row){var _this39=this,children=[],childArray=row.getData()[this.field];return Array.isArray(childArray)||(childArray=[childArray]),childArray.forEach((function(childData){var childRow=new Row(childData||{},_this39.table.rowManager);childRow.create(),childRow.modules.dataTree.index=row.modules.dataTree.index+1,childRow.modules.dataTree.parent=row,childRow.modules.dataTree.children&&(childRow.modules.dataTree.open=_this39.startOpen(childRow.getComponent(),childRow.modules.dataTree.index)),children.push(childRow)})),children}},{key:"expandRow",value:function(row,silent){var config=row.modules.dataTree;!1!==config.children&&(config.open=!0,row.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowExpanded",row.getComponent(),row.modules.dataTree.index))}},{key:"collapseRow",value:function(row){var config=row.modules.dataTree;!1!==config.children&&(config.open=!1,row.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowCollapsed",row.getComponent(),row.modules.dataTree.index))}},{key:"toggleRow",value:function(row){var config=row.modules.dataTree;!1!==config.children&&(config.open?this.collapseRow(row):this.expandRow(row))}},{key:"isRowExpanded",value:function(row){return row.modules.dataTree.open}},{key:"getTreeParent",value:function(row){return!!row.modules.dataTree.parent&&row.modules.dataTree.parent.getComponent()}},{key:"getTreeParentRoot",value:function(row){return row.modules.dataTree&&row.modules.dataTree.parent?this.getTreeParentRoot(row.modules.dataTree.parent):row}},{key:"getFilteredTreeChildren",value:function(row){var config=row.modules.dataTree,output=[];return config.children&&(Array.isArray(config.children)||(config.children=this.generateChildren(row)),(this.table.modExists("filter")&&this.table.options.dataTreeFilter?this.table.modules.filter.filter(config.children):config.children).forEach((function(childRow){childRow instanceof Row&&output.push(childRow)}))),output}},{key:"rowDelete",value:function(row){var childIndex,parent=row.modules.dataTree.parent;parent&&(!1!==(childIndex=this.findChildIndex(row,parent))&&parent.data[this.field].splice(childIndex,1),parent.data[this.field].length||delete parent.data[this.field],this.initializeRow(parent),this.layoutRow(parent)),this.refreshData(!0)}},{key:"addTreeChildRow",value:function(row,data,top,index){var childIndex=!1;"string"==typeof data&&(data=JSON.parse(data)),Array.isArray(row.data[this.field])||(row.data[this.field]=[],row.modules.dataTree.open=this.startOpen(row.getComponent(),row.modules.dataTree.index)),void 0!==index&&!1!==(childIndex=this.findChildIndex(index,row))&&row.data[this.field].splice(top?childIndex:childIndex+1,0,data),!1===childIndex&&(top?row.data[this.field].unshift(data):row.data[this.field].push(data)),this.initializeRow(row),this.layoutRow(row),this.refreshData(!0)}},{key:"findChildIndex",value:function(subject,parent){var _this40=this,match=!1;return"object"==_typeof(subject)?subject instanceof Row?match=subject.data:subject instanceof RowComponent?match=subject._getSelf().data:"undefined"!=typeof HTMLElement&&subject instanceof HTMLElement?parent.modules.dataTree&&(match=parent.modules.dataTree.children.find((function(childRow){return childRow instanceof Row&&childRow.element===subject})))&&(match=match.data):null===subject&&(match=!1):match=void 0!==subject&&parent.data[this.field].find((function(row){return row.data[_this40.table.options.index]==subject})),match&&(Array.isArray(parent.data[this.field])&&(match=parent.data[this.field].indexOf(match)),-1==match&&(match=!1)),match}},{key:"getTreeChildren",value:function(row,component,recurse){var _this41=this,config=row.modules.dataTree,output=[];return config.children&&(Array.isArray(config.children)||(config.children=this.generateChildren(row)),config.children.forEach((function(childRow){childRow instanceof Row&&(output.push(component?childRow.getComponent():childRow),recurse&&(output=output.concat(_this41.getTreeChildren(childRow,component,recurse))))}))),output}},{key:"getChildField",value:function(){return this.field}},{key:"redrawNeeded",value:function(data){return!!this.field&&void 0!==data[this.field]||!!this.elementField&&void 0!==data[this.elementField]}}]),DataTree}(Module);_exports.DataTreeModule=DataTree,DataTree.moduleName="dataTree";var defaultDownloaders={csv:function(list){var options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},setFileContents=arguments.length>2?arguments[2]:void 0,delimiter=options.delimiter?options.delimiter:",",fileContents=[],headers=[];list.forEach((function(row){var item=[];switch(row.type){case"group":console.warn("Download Warning - CSV downloader cannot process row groups");break;case"calc":console.warn("Download Warning - CSV downloader cannot process column calculations");break;case"header":row.columns.forEach((function(col,i){col&&1===col.depth&&(headers[i]=void 0===col.value||null===col.value?"":'"'+String(col.value).split('"').join('""')+'"')}));break;case"row":row.columns.forEach((function(col){if(col){switch(_typeof(col.value)){case"object":col.value=null!==col.value?JSON.stringify(col.value):"";break;case"undefined":col.value=""}item.push('"'+String(col.value).split('"').join('""')+'"')}})),fileContents.push(item.join(delimiter))}})),headers.length&&fileContents.unshift(headers.join(delimiter)),fileContents=fileContents.join("\n"),options.bom&&(fileContents="\ufeff"+fileContents),setFileContents(fileContents,"text/csv")},json:function(list,options,setFileContents){var fileContents=[];list.forEach((function(row){var item={};switch(row.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":row.columns.forEach((function(col){col&&(item[col.component.getTitleDownload()||col.component.getField()]=col.value)})),fileContents.push(item)}})),setFileContents(fileContents=JSON.stringify(fileContents,null,"\t"),"application/json")},jsonLines:function(list,options,setFileContents){var fileContents=[];list.forEach((function(row){var item={};switch(row.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":row.columns.forEach((function(col){col&&(item[col.component.getTitleDownload()||col.component.getField()]=col.value)})),fileContents.push(JSON.stringify(item))}})),setFileContents(fileContents.join("\n"),"application/x-ndjson")},pdf:function(list){var options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},setFileContents=arguments.length>2?arguments[2]:void 0,header=[],body=[],autoTableParams={},rowGroupStyles=options.rowGroupStyles||{fontStyle:"bold",fontSize:12,cellPadding:6,fillColor:220},rowCalcStyles=options.rowCalcStyles||{fontStyle:"bold",fontSize:10,cellPadding:4,fillColor:232},jsPDFParams=options.jsPDF||{},title=options.title?options.title:"";function parseRow(row,styles){var rowData=[];return row.columns.forEach((function(col){var cell;if(col){switch(_typeof(col.value)){case"object":col.value=null!==col.value?JSON.stringify(col.value):"";break;case"undefined":col.value=""}cell={content:col.value,colSpan:col.width,rowSpan:col.height},styles&&(cell.styles=styles),rowData.push(cell)}})),rowData}jsPDFParams.orientation||(jsPDFParams.orientation=options.orientation||"landscape"),jsPDFParams.unit||(jsPDFParams.unit="pt"),list.forEach((function(row){switch(row.type){case"header":header.push(parseRow(row));break;case"group":body.push(parseRow(row,rowGroupStyles));break;case"calc":body.push(parseRow(row,rowCalcStyles));break;case"row":body.push(parseRow(row))}}));var doc=new jspdf.jsPDF(jsPDFParams);options.autoTable&&(autoTableParams="function"==typeof options.autoTable?options.autoTable(doc)||{}:options.autoTable),title&&(autoTableParams.didDrawPage=function(data){doc.text(title,40,30)}),autoTableParams.head=header,autoTableParams.body=body,doc.autoTable(autoTableParams),options.documentProcessing&&options.documentProcessing(doc),setFileContents(doc.output("arraybuffer"),"application/pdf")},xlsx:function(list,options,setFileContents){var sheetName=options.sheetName||"Sheet1",workbook=XLSX.utils.book_new(),tableFeatures=new CoreFeature(this),compression=!("compress"in options)||options.compress;function generateSheet(){var rows=[],merges=[],worksheet={},range={s:{c:0,r:0},e:{c:list[0]?list[0].columns.reduce((function(a,b){return a+(b&&b.width?b.width:1)}),0):0,r:list.length}};return list.forEach((function(row,i){var rowData=[];row.columns.forEach((function(col,j){col?(rowData.push(col.value instanceof Date||"object"!==_typeof(col.value)?col.value:JSON.stringify(col.value)),(col.width>1||col.height>-1)&&(col.height>1||col.width>1)&&merges.push({s:{r:i,c:j},e:{r:i+col.height-1,c:j+col.width-1}})):rowData.push("")})),rows.push(rowData)})),XLSX.utils.sheet_add_aoa(worksheet,rows),worksheet["!ref"]=XLSX.utils.encode_range(range),merges.length&&(worksheet["!merges"]=merges),worksheet}if(workbook.SheetNames=[],workbook.Sheets={},options.sheetOnly)setFileContents(generateSheet());else{if(options.sheets)for(var sheet in options.sheets)!0===options.sheets[sheet]?(workbook.SheetNames.push(sheet),workbook.Sheets[sheet]=generateSheet()):(workbook.SheetNames.push(sheet),tableFeatures.commsSend(options.sheets[sheet],"download","intercept",{type:"xlsx",options:{sheetOnly:!0},active:this.active,intercept:function(data){workbook.Sheets[sheet]=data}}));else workbook.SheetNames.push(sheetName),workbook.Sheets[sheetName]=generateSheet();options.documentProcessing&&(workbook=options.documentProcessing(workbook)),setFileContents(function(s){for(var buf=new ArrayBuffer(s.length),view=new Uint8Array(buf),i=0;i!=s.length;++i)view[i]=255&s.charCodeAt(i);return buf}(XLSX.write(workbook,{bookType:"xlsx",bookSST:!0,type:"binary",compression:compression})),"application/octet-stream")}},html:function(list,options,setFileContents){this.modExists("export",!0)&&setFileContents(this.modules.export.generateHTMLTable(list),"text/html")}},Download=function(_Module6){_inherits(Download,_Module6);var _super11=_createSuper(Download);function Download(table){var _this42;return _classCallCheck(this,Download),(_this42=_super11.call(this,table)).registerTableOption("downloadEncoder",(function(data,mimeType){return new Blob([data],{type:mimeType})})),_this42.registerTableOption("downloadReady",void 0),_this42.registerTableOption("downloadConfig",{}),_this42.registerTableOption("downloadRowRange","active"),_this42.registerColumnOption("download"),_this42.registerColumnOption("titleDownload"),_this42}return _createClass(Download,[{key:"initialize",value:function(){this.deprecatedOptionsCheck(),this.registerTableFunction("download",this.download.bind(this)),this.registerTableFunction("downloadToTab",this.downloadToTab.bind(this))}},{key:"deprecatedOptionsCheck",value:function(){this.deprecationCheck("downloadReady","downloadEncoder")}},{key:"downloadToTab",value:function(type,filename,options,active){this.download(type,filename,options,active,!0)}},{key:"download",value:function(type,filename,options,range,interceptCallback){var downloadFunc=!1;if("function"==typeof type?downloadFunc=type:Download.downloaders[type]?downloadFunc=Download.downloaders[type]:console.warn("Download Error - No such download type found: ",type),downloadFunc){var list=this.generateExportList(range);downloadFunc.call(this.table,list,options||{},function(data,mime){interceptCallback?!0===interceptCallback?this.triggerDownload(data,mime,type,filename,!0):interceptCallback(data):this.triggerDownload(data,mime,type,filename)}.bind(this))}}},{key:"generateExportList",value:function(range){var list=this.table.modules.export.generateExportList(this.table.options.downloadConfig,!1,range||this.table.options.downloadRowRange,"download"),groupHeader=this.table.options.groupHeaderDownload;return groupHeader&&!Array.isArray(groupHeader)&&(groupHeader=[groupHeader]),list.forEach((function(row){var group;"group"===row.type&&(group=row.columns[0],groupHeader&&groupHeader[row.indent]&&(group.value=groupHeader[row.indent](group.value,row.component._group.getRowCount(),row.component._group.getData(),row.component)))})),list}},{key:"triggerDownload",value:function(data,mime,type,filename,newTab){var element=document.createElement("a"),blob=this.table.options.downloadEncoder(data,mime);blob&&(newTab?window.open(window.URL.createObjectURL(blob)):(filename=filename||"Tabulator."+("function"==typeof type?"txt":type),navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(blob,filename):(element.setAttribute("href",window.URL.createObjectURL(blob)),element.setAttribute("download",filename),element.style.display="none",document.body.appendChild(element),element.click(),document.body.removeChild(element))),this.dispatchExternal("downloadComplete"))}},{key:"commsReceived",value:function(table,action,data){if("intercept"===action)this.download(data.type,"",data.options,data.active,data.intercept)}}]),Download}(Module);function maskInput(el,options){var mask=options.mask,maskLetter=void 0!==options.maskLetterChar?options.maskLetterChar:"A",maskNumber=void 0!==options.maskNumberChar?options.maskNumberChar:"9",maskWildcard=void 0!==options.maskWildcardChar?options.maskWildcardChar:"*";function fillSymbols(index){var symbol=mask[index];void 0!==symbol&&symbol!==maskWildcard&&symbol!==maskLetter&&symbol!==maskNumber&&(el.value=el.value+""+symbol,fillSymbols(index+1))}el.addEventListener("keydown",(function(e){var index=el.value.length,char=e.key;if(e.keyCode>46){if(index>=mask.length)return e.preventDefault(),e.stopPropagation(),!1;switch(mask[index]){case maskLetter:if(char.toUpperCase()==char.toLowerCase())return e.preventDefault(),e.stopPropagation(),!1;break;case maskNumber:if(isNaN(char))return e.preventDefault(),e.stopPropagation(),!1;break;case maskWildcard:break;default:if(char!==mask[index])return e.preventDefault(),e.stopPropagation(),!1}}})),el.addEventListener("keyup",(function(e){e.keyCode>46&&options.maskAutoFill&&fillSymbols(el.value.length)})),el.placeholder||(el.placeholder=mask),options.maskAutoFill&&fillSymbols(el.value.length)}_exports.DownloadModule=Download,Download.moduleName="download",Download.downloaders=defaultDownloaders;var Edit=function(){function Edit(editor,cell,onRendered,success,cancel,editorParams){_classCallCheck(this,Edit),this.edit=editor,this.table=editor.table,this.cell=cell,this.params=this._initializeParams(editorParams),this.data=[],this.displayItems=[],this.currentItems=[],this.focusedItem=null,this.input=this._createInputElement(),this.listEl=this._createListElement(),this.initialValues=null,this.isFilter=!cell._getSelf,this.filterTimeout=null,this.filtered=!1,this.typing=!1,this.values=[],this.popup=null,this.listIteration=0,this.lastAction="",this.filterTerm="",this.blurable=!0,this.actions={success:success,cancel:cancel},this._deprecatedOptionsCheck(),this._initializeValue(),onRendered(this._onRendered.bind(this))}return _createClass(Edit,[{key:"_deprecatedOptionsCheck",value:function(){this.params.listItemFormatter&&this.cell.getTable().deprecationAdvisor.msg("The listItemFormatter editor param has been deprecated, please see the latest editor documentation for updated options"),this.params.sortValuesList&&this.cell.getTable().deprecationAdvisor.msg("The sortValuesList editor param has been deprecated, please see the latest editor documentation for updated options"),this.params.searchFunc&&this.cell.getTable().deprecationAdvisor.msg("The searchFunc editor param has been deprecated, please see the latest editor documentation for updated options"),this.params.searchingPlaceholder&&this.cell.getTable().deprecationAdvisor.msg("The searchingPlaceholder editor param has been deprecated, please see the latest editor documentation for updated options")}},{key:"_initializeValue",value:function(){var initialValue=this.cell.getValue();void 0===initialValue&&void 0!==this.params.defaultValue&&(initialValue=this.params.defaultValue),this.initialValues=this.params.multiselect?initialValue:[initialValue],this.isFilter&&(this.input.value=this.initialValues?this.initialValues.join(","):"",this.headerFilterInitialListGen())}},{key:"_onRendered",value:function(){var cellEl=this.cell.getElement();function clickStop(e){e.stopPropagation()}this.input.style.height="100%",this.input.focus({preventScroll:!0}),cellEl.addEventListener("click",clickStop),setTimeout((function(){cellEl.removeEventListener("click",clickStop)}),1e3),this.input.addEventListener("mousedown",this._preventPopupBlur.bind(this))}},{key:"_createListElement",value:function(){var listEl=document.createElement("div");return listEl.classList.add("tabulator-edit-list"),listEl.addEventListener("mousedown",this._preventBlur.bind(this)),listEl.addEventListener("keydown",this._inputKeyDown.bind(this)),listEl}},{key:"_setListWidth",value:function(){var element=this.isFilter?this.input:this.cell.getElement();this.listEl.style.minWidth=element.offsetWidth+"px",this.params.maxWidth&&(!0===this.params.maxWidth?this.listEl.style.maxWidth=element.offsetWidth+"px":"number"==typeof this.params.maxWidth?this.listEl.style.maxWidth=this.params.maxWidth+"px":this.listEl.style.maxWidth=this.params.maxWidth)}},{key:"_createInputElement",value:function(){var attribs=this.params.elementAttributes,input=document.createElement("input");if(input.setAttribute("type",this.params.clearable?"search":"text"),input.style.padding="4px",input.style.width="100%",input.style.boxSizing="border-box",this.params.autocomplete||(input.style.cursor="default",input.style.caretColor="transparent"),attribs&&"object"==_typeof(attribs))for(var key in attribs)"+"==key.charAt(0)?(key=key.slice(1),input.setAttribute(key,input.getAttribute(key)+attribs["+"+key])):input.setAttribute(key,attribs[key]);return this.params.mask&&maskInput(input,this.params),this._bindInputEvents(input),input}},{key:"_initializeParams",value:function(params){var valueCheck,valueKeys=["values","valuesURL","valuesLookup"];return(params=Object.assign({},params)).verticalNavigation=params.verticalNavigation||"editor",params.placeholderLoading=void 0===params.placeholderLoading?"Searching ...":params.placeholderLoading,params.placeholderEmpty=void 0===params.placeholderEmpty?"No Results Found":params.placeholderEmpty,params.filterDelay=void 0===params.filterDelay?300:params.filterDelay,params.emptyValue=Object.keys(params).includes("emptyValue")?params.emptyValue:"",(valueCheck=Object.keys(params).filter((function(key){return valueKeys.includes(key)})).length)?valueCheck>1&&console.warn("list editor config error - only one of the values, valuesURL, or valuesLookup options can be set on the same editor"):console.warn("list editor config error - either the values, valuesURL, or valuesLookup option must be set"),params.autocomplete?params.multiselect&&(params.multiselect=!1,console.warn("list editor config error - multiselect option is not available when autocomplete is enabled")):(params.freetext&&(params.freetext=!1,console.warn("list editor config error - freetext option is only available when autocomplete is enabled")),params.filterFunc&&(params.filterFunc=!1,console.warn("list editor config error - filterFunc option is only available when autocomplete is enabled")),params.filterRemote&&(params.filterRemote=!1,console.warn("list editor config error - filterRemote option is only available when autocomplete is enabled")),params.mask&&(params.mask=!1,console.warn("list editor config error - mask option is only available when autocomplete is enabled")),params.allowEmpty&&(params.allowEmpty=!1,console.warn("list editor config error - allowEmpty option is only available when autocomplete is enabled")),params.listOnEmpty&&(params.listOnEmpty=!1,console.warn("list editor config error - listOnEmpty option is only available when autocomplete is enabled"))),params.filterRemote&&"function"!=typeof params.valuesLookup&&!params.valuesURL&&(params.filterRemote=!1,console.warn("list editor config error - filterRemote option should only be used when values list is populated from a remote source")),params}},{key:"_bindInputEvents",value:function(input){input.addEventListener("focus",this._inputFocus.bind(this)),input.addEventListener("click",this._inputClick.bind(this)),input.addEventListener("blur",this._inputBlur.bind(this)),input.addEventListener("keydown",this._inputKeyDown.bind(this)),input.addEventListener("search",this._inputSearch.bind(this)),this.params.autocomplete&&input.addEventListener("keyup",this._inputKeyUp.bind(this))}},{key:"_inputFocus",value:function(e){this.rebuildOptionsList()}},{key:"_filter",value:function(){var _this43=this;this.params.filterRemote?(clearTimeout(this.filterTimeout),this.filterTimeout=setTimeout((function(){_this43.rebuildOptionsList()}),this.params.filterDelay)):this._filterList()}},{key:"_inputClick",value:function(e){e.stopPropagation()}},{key:"_inputBlur",value:function(e){this.blurable&&(this.popup?this.popup.hide():this._resolveValue(!0))}},{key:"_inputSearch",value:function(){this._clearChoices()}},{key:"_inputKeyDown",value:function(e){switch(e.keyCode){case 38:this._keyUp(e);break;case 40:this._keyDown(e);break;case 37:case 39:this._keySide(e);break;case 13:this._keyEnter();break;case 27:this._keyEsc();break;case 36:case 35:this._keyHomeEnd(e);break;case 9:break;default:this._keySelectLetter(e)}}},{key:"_inputKeyUp",value:function(e){switch(e.keyCode){case 38:case 37:case 39:case 40:case 13:case 27:break;default:this._keyAutoCompLetter(e)}}},{key:"_preventPopupBlur",value:function(){var _this44=this;this.popup&&this.popup.blockHide(),setTimeout((function(){_this44.popup&&_this44.popup.restoreHide()}),10)}},{key:"_preventBlur",value:function(){var _this45=this;this.blurable=!1,setTimeout((function(){_this45.blurable=!0}),10)}},{key:"_keyUp",value:function(e){var index=this.displayItems.indexOf(this.focusedItem);("editor"==this.params.verticalNavigation||"hybrid"==this.params.verticalNavigation&&index)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),index>0&&this._focusItem(this.displayItems[index-1]))}},{key:"_keyDown",value:function(e){var index=this.displayItems.indexOf(this.focusedItem);("editor"==this.params.verticalNavigation||"hybrid"==this.params.verticalNavigation&&index<this.displayItems.length-1)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),index<this.displayItems.length-1&&(-1==index?this._focusItem(this.displayItems[0]):this._focusItem(this.displayItems[index+1])))}},{key:"_keySide",value:function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()}},{key:"_keyEnter",value:function(e){this.params.autocomplete&&"typing"===this.lastAction?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem)}},{key:"_keyEsc",value:function(e){this._cancel()}},{key:"_keyHomeEnd",value:function(e){this.params.autocomplete&&e.stopImmediatePropagation()}},{key:"_keySelectLetter",value:function(e){this.params.autocomplete||(e.preventDefault(),e.keyCode>=38&&e.keyCode<=90&&this._scrollToValue(e.keyCode))}},{key:"_keyAutoCompLetter",value:function(e){this._filter(),this.lastAction="typing",this.typing=!0}},{key:"_scrollToValue",value:function(char){var _this46=this;clearTimeout(this.filterTimeout);var character=String.fromCharCode(char).toLowerCase();this.filterTerm+=character.toLowerCase();var match=this.displayItems.find((function(item){return void 0!==item.label&&item.label.toLowerCase().startsWith(_this46.filterTerm)}));match&&this._focusItem(match),this.filterTimeout=setTimeout((function(){_this46.filterTerm=""}),800)}},{key:"_focusItem",value:function(item){this.lastAction="focus",this.focusedItem&&this.focusedItem.element&&this.focusedItem.element.classList.remove("focused"),this.focusedItem=item,item&&item.element&&(item.element.classList.add("focused"),item.element.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}))}},{key:"headerFilterInitialListGen",value:function(){this._generateOptions(!0)}},{key:"rebuildOptionsList",value:function(){this._generateOptions().then(this._sortOptions.bind(this)).then(this._buildList.bind(this)).then(this._showList.bind(this)).catch((function(e){Number.isInteger(e)||console.error("List generation error",e)}))}},{key:"_filterList",value:function(){this._buildList(this._filterOptions()),this._showList()}},{key:"_generateOptions",value:function(silent){var _this47=this,values=[],iteration=++this.listIteration;return this.filtered=!1,this.params.values?values=this.params.values:this.params.valuesURL?values=this._ajaxRequest(this.params.valuesURL,this.input.value):"function"==typeof this.params.valuesLookup?values=this.params.valuesLookup(this.cell,this.input.value):this.params.valuesLookup&&(values=this._uniqueColumnValues(this.params.valuesLookupField)),values instanceof Promise?(silent||this._addPlaceholder(this.params.placeholderLoading),values.then().then((function(responseValues){return _this47.listIteration===iteration?_this47._parseList(responseValues):Promise.reject(iteration)}))):Promise.resolve(this._parseList(values))}},{key:"_addPlaceholder",value:function(contents){var placeholder=document.createElement("div");"function"==typeof contents&&(contents=contents(this.cell.getComponent(),this.listEl)),contents&&(this._clearList(),contents instanceof HTMLElement?placeholder=contents:(placeholder.classList.add("tabulator-edit-list-placeholder"),placeholder.innerHTML=contents),this.listEl.appendChild(placeholder),this._showList())}},{key:"_ajaxRequest",value:function(url,term){return url=urlBuilder(url,{},this.params.filterRemote?{term:term}:{}),fetch(url).then((function(response){return response.ok?response.json().catch((function(error){return console.warn("List Ajax Load Error - Invalid JSON returned",error),Promise.reject(error)})):(console.error("List Ajax Load Error - Connection Error: "+response.status,response.statusText),Promise.reject(response))})).catch((function(error){return console.error("List Ajax Load Error - Connection Error: ",error),Promise.reject(error)}))}},{key:"_uniqueColumnValues",value:function(field){var column,output={},data=this.table.getData(this.params.valuesLookup);return(column=field?this.table.columnManager.getColumnByField(field):this.cell.getColumn()._getSelf())?data.forEach((function(row){var val=column.getFieldValue(row);null!=val&&""!==val&&(output[val]=!0)})):(console.warn("unable to find matching column to create select lookup list:",field),output=[]),Object.keys(output)}},{key:"_parseList",value:function(inputValues){var _this48=this,data=[];return Array.isArray(inputValues)||(inputValues=Object.entries(inputValues).map((function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0];return{label:_ref2[1],value:key}}))),inputValues.forEach((function(value){"object"!==_typeof(value)&&(value={label:value,value:value}),_this48._parseListItem(value,data,0)})),!this.currentItems.length&&this.params.freetext&&(this.input.value=this.initialValues,this.typing=!0,this.lastAction="typing"),this.data=data,data}},{key:"_parseListItem",value:function(option,data,level){var item={};option.options?item=this._parseListGroup(option,level+1):(item={label:option.label,value:option.value,itemParams:option.itemParams,elementAttributes:option.elementAttributes,element:!1,selected:!1,visible:!0,level:level,original:option},this.initialValues&&this.initialValues.indexOf(option.value)>-1&&this._chooseItem(item,!0)),data.push(item)}},{key:"_parseListGroup",value:function(option,level){var _this49=this,item={label:option.label,group:!0,itemParams:option.itemParams,elementAttributes:option.elementAttributes,element:!1,visible:!0,level:level,options:[],original:option};return option.options.forEach((function(child){_this49._parseListItem(child,item.options,level)})),item}},{key:"_sortOptions",value:function(options){var sorter;return this.params.sort&&(sorter="function"==typeof this.params.sort?this.params.sort:this._defaultSortFunction.bind(this),this._sortGroup(sorter,options)),options}},{key:"_sortGroup",value:function(sorter,options){var _this50=this;options.sort((function(a,b){return sorter(a.label,b.label,a.value,b.value,a.original,b.original)})),options.forEach((function(option){option.group&&_this50._sortGroup(sorter,option.options)}))}},{key:"_defaultSortFunction",value:function(as,bs){var a,b,a1,b1,L,i=0,rx=/(\d+)|(\D+)/g,rd=/\d/,emptyAlign=0;if("desc"===this.params.sort){var _ref3=[bs,as];as=_ref3[0],bs=_ref3[1]}if(as||0===as){if(bs||0===bs){if(isFinite(as)&&isFinite(bs))return as-bs;if((a=String(as).toLowerCase())===(b=String(bs).toLowerCase()))return 0;if(!rd.test(a)||!rd.test(b))return a>b?1:-1;for(a=a.match(rx),b=b.match(rx),L=a.length>b.length?b.length:a.length;i<L;)if((a1=a[i])!==(b1=b[i++]))return isFinite(a1)&&isFinite(b1)?("0"===a1.charAt(0)&&(a1="."+a1),"0"===b1.charAt(0)&&(b1="."+b1),a1-b1):a1>b1?1:-1;return a.length>b.length}emptyAlign=1}else emptyAlign=bs||0===bs?-1:0;return emptyAlign}},{key:"_filterOptions",value:function(){var _this51=this,filterFunc=this.params.filterFunc||this._defaultFilterFunc,term=this.input.value;return term?(this.filtered=!0,this.data.forEach((function(item){_this51._filterItem(filterFunc,term,item)}))):this.filtered=!1,this.data}},{key:"_filterItem",value:function(func,term,item){var _this52=this,matches=!1;return item.group?(item.options.forEach((function(option){_this52._filterItem(func,term,option)&&(matches=!0)})),item.visible=matches):item.visible=func(term,item.label,item.value,item.original),item.visible}},{key:"_defaultFilterFunc",value:function(term,label,value,item){return term=String(term).toLowerCase(),null!=label&&(String(label).toLowerCase().indexOf(term)>-1||String(value).toLowerCase().indexOf(term)>-1)}},{key:"_clearList",value:function(){for(;this.listEl.firstChild;)this.listEl.removeChild(this.listEl.firstChild);this.displayItems=[]}},{key:"_buildList",value:function(data){var _this53=this;this._clearList(),data.forEach((function(option){_this53._buildItem(option)})),this.displayItems.length||this._addPlaceholder(this.params.placeholderEmpty)}},{key:"_buildItem",value:function(item){var contents,_this54=this,el=item.element;if(!this.filtered||item.visible){if(!el){if((el=document.createElement("div")).tabIndex=0,(contents=this.params.itemFormatter?this.params.itemFormatter(item.label,item.value,item.original,el):item.label)instanceof HTMLElement?el.appendChild(contents):el.innerHTML=contents,item.group?el.classList.add("tabulator-edit-list-group"):el.classList.add("tabulator-edit-list-item"),el.classList.add("tabulator-edit-list-group-level-"+item.level),item.elementAttributes&&"object"==_typeof(item.elementAttributes))for(var key in item.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),el.setAttribute(key,this.input.getAttribute(key)+item.elementAttributes["+"+key])):el.setAttribute(key,item.elementAttributes[key]);item.group?el.addEventListener("click",this._groupClick.bind(this,item)):el.addEventListener("click",this._itemClick.bind(this,item)),el.addEventListener("mousedown",this._preventBlur.bind(this)),item.element=el}this._styleItem(item),this.listEl.appendChild(el),item.group?item.options.forEach((function(option){_this54._buildItem(option)})):this.displayItems.push(item)}}},{key:"_showList",value:function(){var _this55=this,startVis=this.popup&&this.popup.isVisible();if(this.input.parentNode){if(this.params.autocomplete&&""===this.input.value&&!this.params.listOnEmpty)return void(this.popup&&this.popup.hide(!0));this._setListWidth(),this.popup||(this.popup=this.edit.popup(this.listEl)),this.popup.show(this.cell.getElement(),"bottom"),startVis||setTimeout((function(){_this55.popup.hideOnBlur(_this55._resolveValue.bind(_this55,!0))}),10)}}},{key:"_styleItem",value:function(item){item&&item.element&&(item.selected?item.element.classList.add("active"):item.element.classList.remove("active"))}},{key:"_itemClick",value:function(item,e){e.stopPropagation(),this._chooseItem(item)}},{key:"_groupClick",value:function(item,e){e.stopPropagation()}},{key:"_cancel",value:function(){this.popup.hide(!0),this.actions.cancel()}},{key:"_clearChoices",value:function(){var _this56=this;this.typing=!0,this.currentItems.forEach((function(item){item.selected=!1,_this56._styleItem(item)})),this.currentItems=[],this.focusedItem=null}},{key:"_chooseItem",value:function(item,silent){var index;this.typing=!1,this.params.multiselect?((index=this.currentItems.indexOf(item))>-1?(this.currentItems.splice(index,1),item.selected=!1):(this.currentItems.push(item),item.selected=!0),this.input.value=this.currentItems.map((function(item){return item.label})).join(","),this._styleItem(item)):(this.currentItems=[item],item.selected=!0,this.input.value=item.label,this._styleItem(item),silent||this._resolveValue()),this._focusItem(item)}},{key:"_resolveValue",value:function(blur){var output,initialValue;if(this.popup&&this.popup.hide(!0),this.params.multiselect)output=this.currentItems.map((function(item){return item.value}));else if(blur&&this.params.autocomplete&&this.typing){if(!(this.params.freetext||this.params.allowEmpty&&""===this.input.value))return void this.actions.cancel();output=this.input.value}else output=this.currentItems[0]?this.currentItems[0].value:null==(initialValue=this.initialValues[0])||""===initialValue?initialValue:this.params.emptyValue;""===output&&(output=this.params.emptyValue),this.actions.success(output),this.isFilter&&(this.initialValues=output&&!Array.isArray(output)?[output]:output,this.currentItems=[])}}]),Edit}();var defaultEditors={input:function(cell,onRendered,success,cancel,editorParams){var cellValue=cell.getValue(),input=document.createElement("input");if(input.setAttribute("type",editorParams.search?"search":"text"),input.style.padding="4px",input.style.width="100%",input.style.boxSizing="border-box",editorParams.elementAttributes&&"object"==_typeof(editorParams.elementAttributes))for(var key in editorParams.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),input.setAttribute(key,input.getAttribute(key)+editorParams.elementAttributes["+"+key])):input.setAttribute(key,editorParams.elementAttributes[key]);function onChange(e){null==cellValue&&""!==input.value||input.value!==cellValue?success(input.value)&&(cellValue=input.value):cancel()}return input.value=void 0!==cellValue?cellValue:"",onRendered((function(){input.focus({preventScroll:!0}),input.style.height="100%",editorParams.selectContents&&input.select()})),input.addEventListener("change",onChange),input.addEventListener("blur",onChange),input.addEventListener("keydown",(function(e){switch(e.keyCode){case 13:onChange();break;case 27:cancel();break;case 35:case 36:e.stopPropagation()}})),editorParams.mask&&maskInput(input,editorParams),input},textarea:function(cell,onRendered,success,cancel,editorParams){var cellValue=cell.getValue(),vertNav=editorParams.verticalNavigation||"hybrid",value=String(null!=cellValue?cellValue:""),input=document.createElement("textarea"),scrollHeight=0;if(input.style.display="block",input.style.padding="2px",input.style.height="100%",input.style.width="100%",input.style.boxSizing="border-box",input.style.whiteSpace="pre-wrap",input.style.resize="none",editorParams.elementAttributes&&"object"==_typeof(editorParams.elementAttributes))for(var key in editorParams.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),input.setAttribute(key,input.getAttribute(key)+editorParams.elementAttributes["+"+key])):input.setAttribute(key,editorParams.elementAttributes[key]);function onChange(e){null==cellValue&&""!==input.value||input.value!==cellValue?(success(input.value)&&(cellValue=input.value),setTimeout((function(){cell.getRow().normalizeHeight()}),300)):cancel()}return input.value=value,onRendered((function(){input.focus({preventScroll:!0}),input.style.height="100%",input.scrollHeight,input.style.height=input.scrollHeight+"px",cell.getRow().normalizeHeight(),editorParams.selectContents&&input.select()})),input.addEventListener("change",onChange),input.addEventListener("blur",onChange),input.addEventListener("keyup",(function(){input.style.height="";var heightNow=input.scrollHeight;input.style.height=heightNow+"px",heightNow!=scrollHeight&&(scrollHeight=heightNow,cell.getRow().normalizeHeight())})),input.addEventListener("keydown",(function(e){switch(e.keyCode){case 13:e.shiftKey&&editorParams.shiftEnterSubmit&&onChange();break;case 27:cancel();break;case 38:("editor"==vertNav||"hybrid"==vertNav&&input.selectionStart)&&(e.stopImmediatePropagation(),e.stopPropagation());break;case 40:("editor"==vertNav||"hybrid"==vertNav&&input.selectionStart!==input.value.length)&&(e.stopImmediatePropagation(),e.stopPropagation());break;case 35:case 36:e.stopPropagation()}})),editorParams.mask&&maskInput(input,editorParams),input},number:function(cell,onRendered,success,cancel,editorParams){var cellValue=cell.getValue(),vertNav=editorParams.verticalNavigation||"editor",input=document.createElement("input");if(input.setAttribute("type","number"),void 0!==editorParams.max&&input.setAttribute("max",editorParams.max),void 0!==editorParams.min&&input.setAttribute("min",editorParams.min),void 0!==editorParams.step&&input.setAttribute("step",editorParams.step),input.style.padding="4px",input.style.width="100%",input.style.boxSizing="border-box",editorParams.elementAttributes&&"object"==_typeof(editorParams.elementAttributes))for(var key in editorParams.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),input.setAttribute(key,input.getAttribute(key)+editorParams.elementAttributes["+"+key])):input.setAttribute(key,editorParams.elementAttributes[key]);input.value=cellValue;var blurFunc=function(e){onChange()};function onChange(){var value=input.value;isNaN(value)||""===value||(value=Number(value)),value!==cellValue?success(value)&&(cellValue=value):cancel()}return onRendered((function(){input.removeEventListener("blur",blurFunc),input.focus({preventScroll:!0}),input.style.height="100%",input.addEventListener("blur",blurFunc),editorParams.selectContents&&input.select()})),input.addEventListener("keydown",(function(e){switch(e.keyCode){case 13:onChange();break;case 27:cancel();break;case 38:case 40:"editor"==vertNav&&(e.stopImmediatePropagation(),e.stopPropagation());break;case 35:case 36:e.stopPropagation()}})),editorParams.mask&&maskInput(input,editorParams),input},range:function(cell,onRendered,success,cancel,editorParams){var cellValue=cell.getValue(),input=document.createElement("input");if(input.setAttribute("type","range"),void 0!==editorParams.max&&input.setAttribute("max",editorParams.max),void 0!==editorParams.min&&input.setAttribute("min",editorParams.min),void 0!==editorParams.step&&input.setAttribute("step",editorParams.step),input.style.padding="4px",input.style.width="100%",input.style.boxSizing="border-box",editorParams.elementAttributes&&"object"==_typeof(editorParams.elementAttributes))for(var key in editorParams.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),input.setAttribute(key,input.getAttribute(key)+editorParams.elementAttributes["+"+key])):input.setAttribute(key,editorParams.elementAttributes[key]);function onChange(){var value=input.value;isNaN(value)||""===value||(value=Number(value)),value!=cellValue?success(value)&&(cellValue=value):cancel()}return input.value=cellValue,onRendered((function(){input.focus({preventScroll:!0}),input.style.height="100%"})),input.addEventListener("blur",(function(e){onChange()})),input.addEventListener("keydown",(function(e){switch(e.keyCode){case 13:onChange();break;case 27:cancel()}})),input},date:function(cell,onRendered,success,cancel,editorParams){var inputFormat=editorParams.format,DT=inputFormat?window.DateTime||luxon.DateTime:null,cellValue=cell.getValue(),input=document.createElement("input");function convertDate(value){return(DT.isDateTime(value)?value:"iso"===inputFormat?DT.fromISO(String(value)):DT.fromFormat(String(value),inputFormat)).toFormat("yyyy-MM-dd")}if(input.type="date",input.style.padding="4px",input.style.width="100%",input.style.boxSizing="border-box",editorParams.max&&input.setAttribute("max",inputFormat?convertDate(editorParams.max):editorParams.max),editorParams.min&&input.setAttribute("min",inputFormat?convertDate(editorParams.min):editorParams.min),editorParams.elementAttributes&&"object"==_typeof(editorParams.elementAttributes))for(var key in editorParams.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),input.setAttribute(key,input.getAttribute(key)+editorParams.elementAttributes["+"+key])):input.setAttribute(key,editorParams.elementAttributes[key]);function onChange(e){var value=input.value;null==cellValue&&""!==value||value!==cellValue?(value&&inputFormat&&(value=DT.fromFormat(String(value),"yyyy-MM-dd").toFormat(inputFormat)),success(value)&&(cellValue=input.value)):cancel()}return cellValue=void 0!==cellValue?cellValue:"",inputFormat&&(DT?cellValue=convertDate(cellValue):console.error("Editor Error - 'date' editor 'inputFormat' param is dependant on luxon.js")),input.value=cellValue,onRendered((function(){input.focus({preventScroll:!0}),input.style.height="100%",editorParams.selectContents&&input.select()})),input.addEventListener("change",onChange),input.addEventListener("blur",onChange),input.addEventListener("keydown",(function(e){switch(e.keyCode){case 13:onChange();break;case 27:cancel();break;case 35:case 36:e.stopPropagation()}})),input},time:function(cell,onRendered,success,cancel,editorParams){var newDatetime,inputFormat=editorParams.format,DT=inputFormat?window.DateTime||luxon.DateTime:null,cellValue=cell.getValue(),input=document.createElement("input");if(input.type="time",input.style.padding="4px",input.style.width="100%",input.style.boxSizing="border-box",editorParams.elementAttributes&&"object"==_typeof(editorParams.elementAttributes))for(var key in editorParams.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),input.setAttribute(key,input.getAttribute(key)+editorParams.elementAttributes["+"+key])):input.setAttribute(key,editorParams.elementAttributes[key]);function onChange(e){var value=input.value;null==cellValue&&""!==value||value!==cellValue?(value&&inputFormat&&(value=DT.fromFormat(String(value),"hh:mm").toFormat(inputFormat)),success(value)&&(cellValue=input.value)):cancel()}return cellValue=void 0!==cellValue?cellValue:"",inputFormat&&(DT?(newDatetime=DT.isDateTime(cellValue)?cellValue:"iso"===inputFormat?DT.fromISO(String(cellValue)):DT.fromFormat(String(cellValue),inputFormat),cellValue=newDatetime.toFormat("hh:mm")):console.error("Editor Error - 'date' editor 'inputFormat' param is dependant on luxon.js")),input.value=cellValue,onRendered((function(){input.focus({preventScroll:!0}),input.style.height="100%",editorParams.selectContents&&input.select()})),input.addEventListener("change",onChange),input.addEventListener("blur",onChange),input.addEventListener("keydown",(function(e){switch(e.keyCode){case 13:onChange();break;case 27:cancel();break;case 35:case 36:e.stopPropagation()}})),input},datetime:function(cell,onRendered,success,cancel,editorParams){var newDatetime,inputFormat=editorParams.format,DT=inputFormat?window.DateTime||luxon.DateTime:null,cellValue=cell.getValue(),input=document.createElement("input");if(input.type="datetime-local",input.style.padding="4px",input.style.width="100%",input.style.boxSizing="border-box",editorParams.elementAttributes&&"object"==_typeof(editorParams.elementAttributes))for(var key in editorParams.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),input.setAttribute(key,input.getAttribute(key)+editorParams.elementAttributes["+"+key])):input.setAttribute(key,editorParams.elementAttributes[key]);function onChange(e){var value=input.value;null==cellValue&&""!==value||value!==cellValue?(value&&inputFormat&&(value=DT.fromISO(String(value)).toFormat(inputFormat)),success(value)&&(cellValue=input.value)):cancel()}return cellValue=void 0!==cellValue?cellValue:"",inputFormat&&(DT?(newDatetime=DT.isDateTime(cellValue)?cellValue:"iso"===inputFormat?DT.fromISO(String(cellValue)):DT.fromFormat(String(cellValue),inputFormat),cellValue=newDatetime.toFormat("yyyy-MM-dd")+"T"+newDatetime.toFormat("hh:mm")):console.error("Editor Error - 'date' editor 'inputFormat' param is dependant on luxon.js")),input.value=cellValue,onRendered((function(){input.focus({preventScroll:!0}),input.style.height="100%",editorParams.selectContents&&input.select()})),input.addEventListener("change",onChange),input.addEventListener("blur",onChange),input.addEventListener("keydown",(function(e){switch(e.keyCode){case 13:onChange();break;case 27:cancel();break;case 35:case 36:e.stopPropagation()}})),input},select:function(cell,onRendered,success,cancel,editorParams){return this.deprecationMsg("The select editor has been deprecated, please use the new list editor"),new Edit(this,cell,onRendered,success,cancel,editorParams).input},list:function(cell,onRendered,success,cancel,editorParams){return new Edit(this,cell,onRendered,success,cancel,editorParams).input},autocomplete:function(cell,onRendered,success,cancel,editorParams){return this.deprecationMsg("The autocomplete editor has been deprecated, please use the new list editor with the 'autocomplete' editorParam"),editorParams.autocomplete=!0,new Edit(this,cell,onRendered,success,cancel,editorParams).input},star:function(cell,onRendered,success,cancel,editorParams){var self=this,element=cell.getElement(),value=cell.getValue(),maxStars=element.getElementsByTagName("svg").length||5,size=element.getElementsByTagName("svg")[0]?element.getElementsByTagName("svg")[0].getAttribute("width"):14,stars=[],starsHolder=document.createElement("div"),star=document.createElementNS("http://www.w3.org/2000/svg","svg");function starChange(val){stars.forEach((function(star,i){i<val?("ie"==self.table.browser?star.setAttribute("class","tabulator-star-active"):star.classList.replace("tabulator-star-inactive","tabulator-star-active"),star.innerHTML='<polygon fill="#488CE9" stroke="#014AAE" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>'):("ie"==self.table.browser?star.setAttribute("class","tabulator-star-inactive"):star.classList.replace("tabulator-star-active","tabulator-star-inactive"),star.innerHTML='<polygon fill="#010155" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>')}))}function buildStar(i){var starHolder=document.createElement("span"),nextStar=star.cloneNode(!0);stars.push(nextStar),starHolder.addEventListener("mouseenter",(function(e){e.stopPropagation(),e.stopImmediatePropagation(),starChange(i)})),starHolder.addEventListener("mousemove",(function(e){e.stopPropagation(),e.stopImmediatePropagation()})),starHolder.addEventListener("click",(function(e){e.stopPropagation(),e.stopImmediatePropagation(),success(i),element.blur()})),starHolder.appendChild(nextStar),starsHolder.appendChild(starHolder)}function changeValue(val){value=val,starChange(val)}if(element.style.whiteSpace="nowrap",element.style.overflow="hidden",element.style.textOverflow="ellipsis",starsHolder.style.verticalAlign="middle",starsHolder.style.display="inline-block",starsHolder.style.padding="4px",star.setAttribute("width",size),star.setAttribute("height",size),star.setAttribute("viewBox","0 0 512 512"),star.setAttribute("xml:space","preserve"),star.style.padding="0 1px",editorParams.elementAttributes&&"object"==_typeof(editorParams.elementAttributes))for(var key in editorParams.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),starsHolder.setAttribute(key,starsHolder.getAttribute(key)+editorParams.elementAttributes["+"+key])):starsHolder.setAttribute(key,editorParams.elementAttributes[key]);for(var i=1;i<=maxStars;i++)buildStar(i);return starChange(value=Math.min(parseInt(value),maxStars)),starsHolder.addEventListener("mousemove",(function(e){starChange(0)})),starsHolder.addEventListener("click",(function(e){success(0)})),element.addEventListener("blur",(function(e){cancel()})),element.addEventListener("keydown",(function(e){switch(e.keyCode){case 39:changeValue(value+1);break;case 37:changeValue(value-1);break;case 13:success(value);break;case 27:cancel()}})),starsHolder},progress:function(cell,onRendered,success,cancel,editorParams){var mouseDrag,mouseDragWidth,element=cell.getElement(),max=void 0===editorParams.max?element.getElementsByTagName("div")[0]&&element.getElementsByTagName("div")[0].getAttribute("max")||100:editorParams.max,min=void 0===editorParams.min?element.getElementsByTagName("div")[0]&&element.getElementsByTagName("div")[0].getAttribute("min")||0:editorParams.min,percent=(max-min)/100,value=cell.getValue()||0,handle=document.createElement("div"),bar=document.createElement("div");function updateValue(){var style=window.getComputedStyle(element,null),calcVal=percent*Math.round(bar.offsetWidth/((element.clientWidth-parseInt(style.getPropertyValue("padding-left"))-parseInt(style.getPropertyValue("padding-right")))/100))+min;success(calcVal),element.setAttribute("aria-valuenow",calcVal),element.setAttribute("aria-label",value)}if(handle.style.position="absolute",handle.style.right="0",handle.style.top="0",handle.style.bottom="0",handle.style.width="5px",handle.classList.add("tabulator-progress-handle"),bar.style.display="inline-block",bar.style.position="relative",bar.style.height="100%",bar.style.backgroundColor="#488CE9",bar.style.maxWidth="100%",bar.style.minWidth="0%",editorParams.elementAttributes&&"object"==_typeof(editorParams.elementAttributes))for(var key in editorParams.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),bar.setAttribute(key,bar.getAttribute(key)+editorParams.elementAttributes["+"+key])):bar.setAttribute(key,editorParams.elementAttributes[key]);return element.style.padding="4px 4px",value=Math.min(parseFloat(value),max),value=Math.max(parseFloat(value),min),value=Math.round((value-min)/percent),bar.style.width=value+"%",element.setAttribute("aria-valuemin",min),element.setAttribute("aria-valuemax",max),bar.appendChild(handle),handle.addEventListener("mousedown",(function(e){mouseDrag=e.screenX,mouseDragWidth=bar.offsetWidth})),handle.addEventListener("mouseover",(function(){handle.style.cursor="ew-resize"})),element.addEventListener("mousemove",(function(e){mouseDrag&&(bar.style.width=mouseDragWidth+e.screenX-mouseDrag+"px")})),element.addEventListener("mouseup",(function(e){mouseDrag&&(e.stopPropagation(),e.stopImmediatePropagation(),mouseDrag=!1,mouseDragWidth=!1,updateValue())})),element.addEventListener("keydown",(function(e){switch(e.keyCode){case 39:e.preventDefault(),bar.style.width=bar.clientWidth+element.clientWidth/100+"px";break;case 37:e.preventDefault(),bar.style.width=bar.clientWidth-element.clientWidth/100+"px";break;case 9:case 13:updateValue();break;case 27:cancel()}})),element.addEventListener("blur",(function(){cancel()})),bar},tickCross:function(cell,onRendered,success,cancel,editorParams){var value=cell.getValue(),input=document.createElement("input"),tristate=editorParams.tristate,indetermValue=void 0===editorParams.indeterminateValue?null:editorParams.indeterminateValue,indetermState=!1,trueValueSet=Object.keys(editorParams).includes("trueValue"),falseValueSet=Object.keys(editorParams).includes("falseValue");if(input.setAttribute("type","checkbox"),input.style.marginTop="5px",input.style.boxSizing="border-box",editorParams.elementAttributes&&"object"==_typeof(editorParams.elementAttributes))for(var key in editorParams.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),input.setAttribute(key,input.getAttribute(key)+editorParams.elementAttributes["+"+key])):input.setAttribute(key,editorParams.elementAttributes[key]);function setValue(blur){var checkedValue=input.checked;return trueValueSet&&checkedValue?checkedValue=editorParams.trueValue:falseValueSet&&!checkedValue&&(checkedValue=editorParams.falseValue),tristate?blur?indetermState?indetermValue:checkedValue:input.checked&&!indetermState?(input.checked=!1,input.indeterminate=!0,indetermState=!0,indetermValue):(indetermState=!1,checkedValue):checkedValue}return input.value=value,!tristate||void 0!==value&&value!==indetermValue&&""!==value||(indetermState=!0,input.indeterminate=!0),"firefox"!=this.table.browser&&onRendered((function(){input.focus({preventScroll:!0})})),input.checked=trueValueSet?value===editorParams.trueValue:!0===value||"true"===value||"True"===value||1===value,onRendered((function(){input.focus()})),input.addEventListener("change",(function(e){success(setValue())})),input.addEventListener("blur",(function(e){success(setValue(!0))})),input.addEventListener("keydown",(function(e){13==e.keyCode&&success(setValue()),27==e.keyCode&&cancel()})),input}},Edit$1=function(_Module7){_inherits(Edit$1,_Module7);var _super12=_createSuper(Edit$1);function Edit$1(table){var _this57;return _classCallCheck(this,Edit$1),(_this57=_super12.call(this,table)).currentCell=!1,_this57.mouseClick=!1,_this57.recursionBlock=!1,_this57.invalidEdit=!1,_this57.editedCells=[],_this57.editors=Edit$1.editors,_this57.registerColumnOption("editable"),_this57.registerColumnOption("editor"),_this57.registerColumnOption("editorParams"),_this57.registerColumnOption("cellEditing"),_this57.registerColumnOption("cellEdited"),_this57.registerColumnOption("cellEditCancelled"),_this57.registerTableFunction("getEditedCells",_this57.getEditedCells.bind(_assertThisInitialized(_this57))),_this57.registerTableFunction("clearCellEdited",_this57.clearCellEdited.bind(_assertThisInitialized(_this57))),_this57.registerTableFunction("navigatePrev",_this57.navigatePrev.bind(_assertThisInitialized(_this57))),_this57.registerTableFunction("navigateNext",_this57.navigateNext.bind(_assertThisInitialized(_this57))),_this57.registerTableFunction("navigateLeft",_this57.navigateLeft.bind(_assertThisInitialized(_this57))),_this57.registerTableFunction("navigateRight",_this57.navigateRight.bind(_assertThisInitialized(_this57))),_this57.registerTableFunction("navigateUp",_this57.navigateUp.bind(_assertThisInitialized(_this57))),_this57.registerTableFunction("navigateDown",_this57.navigateDown.bind(_assertThisInitialized(_this57))),_this57.registerComponentFunction("cell","isEdited",_this57.cellIsEdited.bind(_assertThisInitialized(_this57))),_this57.registerComponentFunction("cell","clearEdited",_this57.clearEdited.bind(_assertThisInitialized(_this57))),_this57.registerComponentFunction("cell","edit",_this57.editCell.bind(_assertThisInitialized(_this57))),_this57.registerComponentFunction("cell","cancelEdit",_this57.cellCancelEdit.bind(_assertThisInitialized(_this57))),_this57.registerComponentFunction("cell","navigatePrev",_this57.navigatePrev.bind(_assertThisInitialized(_this57))),_this57.registerComponentFunction("cell","navigateNext",_this57.navigateNext.bind(_assertThisInitialized(_this57))),_this57.registerComponentFunction("cell","navigateLeft",_this57.navigateLeft.bind(_assertThisInitialized(_this57))),_this57.registerComponentFunction("cell","navigateRight",_this57.navigateRight.bind(_assertThisInitialized(_this57))),_this57.registerComponentFunction("cell","navigateUp",_this57.navigateUp.bind(_assertThisInitialized(_this57))),_this57.registerComponentFunction("cell","navigateDown",_this57.navigateDown.bind(_assertThisInitialized(_this57))),_this57}return _createClass(Edit$1,[{key:"initialize",value:function(){this.subscribe("cell-init",this.bindEditor.bind(this)),this.subscribe("cell-delete",this.clearEdited.bind(this)),this.subscribe("cell-value-changed",this.updateCellClass.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("column-delete",this.columnDeleteCheck.bind(this)),this.subscribe("row-deleting",this.rowDeleteCheck.bind(this)),this.subscribe("row-layout",this.rowEditableCheck.bind(this)),this.subscribe("data-refreshing",this.cancelEdit.bind(this)),this.subscribe("keybinding-nav-prev",this.navigatePrev.bind(this,void 0)),this.subscribe("keybinding-nav-next",this.keybindingNavigateNext.bind(this)),this.subscribe("keybinding-nav-left",this.navigateLeft.bind(this,void 0)),this.subscribe("keybinding-nav-right",this.navigateRight.bind(this,void 0)),this.subscribe("keybinding-nav-up",this.navigateUp.bind(this,void 0)),this.subscribe("keybinding-nav-down",this.navigateDown.bind(this,void 0))}},{key:"keybindingNavigateNext",value:function(e){var cell=this.currentCell,newRow=this.options("tabEndNewRow");cell&&(this.navigateNext(cell,e)||newRow&&(cell.getElement().firstChild.blur(),(newRow=!0===newRow?this.table.addRow({}):"function"==typeof newRow?this.table.addRow(newRow(cell.row.getComponent())):this.table.addRow(Object.assign({},newRow))).then((function(){setTimeout((function(){cell.getComponent().navigateNext()}))}))))}},{key:"cellIsEdited",value:function(cell){return!!cell.modules.edit&&cell.modules.edit.edited}},{key:"cellCancelEdit",value:function(cell){cell===this.currentCell?this.table.modules.edit.cancelEdit():console.warn("Cancel Editor Error - This cell is not currently being edited ")}},{key:"updateCellClass",value:function(cell){this.allowEdit(cell)?cell.getElement().classList.add("tabulator-editable"):cell.getElement().classList.remove("tabulator-editable")}},{key:"clearCellEdited",value:function(cells){var _this58=this;cells||(cells=this.table.modules.edit.getEditedCells()),Array.isArray(cells)||(cells=[cells]),cells.forEach((function(cell){_this58.table.modules.edit.clearEdited(cell._getSelf())}))}},{key:"navigatePrev",value:function(){var nextCell,prevRow,cell=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentCell,e=arguments.length>1?arguments[1]:void 0;if(cell){if(e&&e.preventDefault(),nextCell=this.navigateLeft())return!0;if((prevRow=this.table.rowManager.prevDisplayRow(cell.row,!0))&&(nextCell=this.findPrevEditableCell(prevRow,prevRow.cells.length)))return nextCell.getComponent().edit(),!0}return!1}},{key:"navigateNext",value:function(){var nextCell,nextRow,cell=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentCell,e=arguments.length>1?arguments[1]:void 0;if(cell){if(e&&e.preventDefault(),nextCell=this.navigateRight())return!0;if((nextRow=this.table.rowManager.nextDisplayRow(cell.row,!0))&&(nextCell=this.findNextEditableCell(nextRow,-1)))return nextCell.getComponent().edit(),!0}return!1}},{key:"navigateLeft",value:function(){var index,nextCell,cell=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentCell,e=arguments.length>1?arguments[1]:void 0;return!!(cell&&(e&&e.preventDefault(),index=cell.getIndex(),nextCell=this.findPrevEditableCell(cell.row,index)))&&(nextCell.getComponent().edit(),!0)}},{key:"navigateRight",value:function(){var index,nextCell,cell=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentCell,e=arguments.length>1?arguments[1]:void 0;return!!(cell&&(e&&e.preventDefault(),index=cell.getIndex(),nextCell=this.findNextEditableCell(cell.row,index)))&&(nextCell.getComponent().edit(),!0)}},{key:"navigateUp",value:function(){var index,nextRow,cell=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentCell,e=arguments.length>1?arguments[1]:void 0;return!!(cell&&(e&&e.preventDefault(),index=cell.getIndex(),nextRow=this.table.rowManager.prevDisplayRow(cell.row,!0)))&&(nextRow.cells[index].getComponent().edit(),!0)}},{key:"navigateDown",value:function(){var index,nextRow,cell=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentCell,e=arguments.length>1?arguments[1]:void 0;return!!(cell&&(e&&e.preventDefault(),index=cell.getIndex(),nextRow=this.table.rowManager.nextDisplayRow(cell.row,!0)))&&(nextRow.cells[index].getComponent().edit(),!0)}},{key:"findNextEditableCell",value:function(row,index){var nextCell=!1;if(index<row.cells.length-1)for(var i=index+1;i<row.cells.length;i++){var cell=row.cells[i];if(cell.column.modules.edit&&Helpers.elVisible(cell.getElement()))if(this.allowEdit(cell)){nextCell=cell;break}}return nextCell}},{key:"findPrevEditableCell",value:function(row,index){var prevCell=!1;if(index>0)for(var i=index-1;i>=0;i--){var cell=row.cells[i];if(cell.column.modules.edit&&Helpers.elVisible(cell.getElement()))if(this.allowEdit(cell)){prevCell=cell;break}}return prevCell}},{key:"initializeColumnCheck",value:function(column){void 0!==column.definition.editor&&this.initializeColumn(column)}},{key:"columnDeleteCheck",value:function(column){this.currentCell&&this.currentCell.column===column&&this.cancelEdit()}},{key:"rowDeleteCheck",value:function(row){this.currentCell&&this.currentCell.row===row&&this.cancelEdit()}},{key:"rowEditableCheck",value:function(row){var _this59=this;row.getCells().forEach((function(cell){cell.column.modules.edit&&"function"==typeof cell.column.modules.edit.check&&_this59.updateCellClass(cell)}))}},{key:"initializeColumn",value:function(column){var config={editor:!1,blocked:!1,check:column.definition.editable,params:column.definition.editorParams||{}};switch(_typeof(column.definition.editor)){case"string":this.editors[column.definition.editor]?config.editor=this.editors[column.definition.editor]:console.warn("Editor Error - No such editor found: ",column.definition.editor);break;case"function":config.editor=column.definition.editor;break;case"boolean":!0===column.definition.editor&&("function"!=typeof column.definition.formatter?this.editors[column.definition.formatter]?config.editor=this.editors[column.definition.formatter]:config.editor=this.editors.input:console.warn("Editor Error - Cannot auto lookup editor for a custom formatter: ",column.definition.formatter))}config.editor&&(column.modules.edit=config)}},{key:"getCurrentCell",value:function(){return!!this.currentCell&&this.currentCell.getComponent()}},{key:"clearEditor",value:function(cancel){var cellEl,cell=this.currentCell;if(this.invalidEdit=!1,cell){for(this.currentCell=!1,cellEl=cell.getElement(),this.dispatch("edit-editor-clear",cell,cancel),cellEl.classList.remove("tabulator-editing");cellEl.firstChild;)cellEl.removeChild(cellEl.firstChild);cell.row.getElement().classList.remove("tabulator-editing"),cell.table.element.classList.remove("tabulator-editing")}}},{key:"cancelEdit",value:function(){if(this.currentCell){var cell=this.currentCell,component=this.currentCell.getComponent();this.clearEditor(!0),cell.setValueActual(cell.getValue()),cell.cellRendered(),("textarea"==cell.column.definition.editor||cell.column.definition.variableHeight)&&cell.row.normalizeHeight(!0),cell.column.definition.cellEditCancelled&&cell.column.definition.cellEditCancelled.call(this.table,component),this.dispatch("edit-cancelled",cell),this.dispatchExternal("cellEditCancelled",component)}}},{key:"bindEditor",value:function(cell){if(cell.column.modules.edit){var self=this,element=cell.getElement(!0);this.updateCellClass(cell),element.setAttribute("tabindex",0),element.addEventListener("click",(function(e){element.classList.contains("tabulator-editing")||element.focus({preventScroll:!0})})),element.addEventListener("mousedown",(function(e){2===e.button?e.preventDefault():self.mouseClick=!0})),element.addEventListener("focus",(function(e){self.recursionBlock||self.edit(cell,e,!1)}))}}},{key:"focusCellNoEvent",value:function(cell,block){this.recursionBlock=!0,block&&"ie"===this.table.browser||cell.getElement().focus({preventScroll:!0}),this.recursionBlock=!1}},{key:"editCell",value:function(cell,forceEdit){this.focusCellNoEvent(cell),this.edit(cell,!1,forceEdit)}},{key:"focusScrollAdjust",value:function(cell){if("virtual"==this.table.rowManager.getRenderMode()){var topEdge=this.table.rowManager.element.scrollTop,bottomEdge=this.table.rowManager.element.clientHeight+this.table.rowManager.element.scrollTop,rowEl=cell.row.getElement();rowEl.offsetTop<topEdge?this.table.rowManager.element.scrollTop-=topEdge-rowEl.offsetTop:rowEl.offsetTop+rowEl.offsetHeight>bottomEdge&&(this.table.rowManager.element.scrollTop+=rowEl.offsetTop+rowEl.offsetHeight-bottomEdge);var leftEdge=this.table.rowManager.element.scrollLeft,rightEdge=this.table.rowManager.element.clientWidth+this.table.rowManager.element.scrollLeft,cellEl=cell.getElement();this.table.modExists("frozenColumns")&&(leftEdge+=parseInt(this.table.modules.frozenColumns.leftMargin),rightEdge-=parseInt(this.table.modules.frozenColumns.rightMargin)),"virtual"===this.table.options.renderHorizontal&&(leftEdge-=parseInt(this.table.columnManager.renderer.vDomPadLeft),rightEdge-=parseInt(this.table.columnManager.renderer.vDomPadLeft)),cellEl.offsetLeft<leftEdge?this.table.rowManager.element.scrollLeft-=leftEdge-cellEl.offsetLeft:cellEl.offsetLeft+cellEl.offsetWidth>rightEdge&&(this.table.rowManager.element.scrollLeft+=cellEl.offsetLeft+cellEl.offsetWidth-rightEdge)}}},{key:"allowEdit",value:function(cell){var check=!!cell.column.modules.edit;if(cell.column.modules.edit)switch(_typeof(cell.column.modules.edit.check)){case"function":cell.row.initialized&&(check=cell.column.modules.edit.check(cell.getComponent()));break;case"string":check=!!cell.row.data[cell.column.modules.edit.check];break;case"boolean":check=cell.column.modules.edit.check}return check}},{key:"edit",value:function(cell,e,forceEdit){var cellEditor,component,params,self=this,rendered=function(){},element=cell.getElement();if(!this.currentCell){if(cell.column.modules.edit.blocked)return this.mouseClick=!1,element.blur(),!1;if(e&&e.stopPropagation(),this.allowEdit(cell)||forceEdit){if(self.cancelEdit(),self.currentCell=cell,this.focusScrollAdjust(cell),component=cell.getComponent(),this.mouseClick&&(this.mouseClick=!1,cell.column.definition.cellClick&&cell.column.definition.cellClick.call(this.table,e,component)),cell.column.definition.cellEditing&&cell.column.definition.cellEditing.call(this.table,component),this.dispatch("cell-editing",cell),this.dispatchExternal("cellEditing",component),params="function"==typeof cell.column.modules.edit.params?cell.column.modules.edit.params(component):cell.column.modules.edit.params,!1===(cellEditor=cell.column.modules.edit.editor.call(self,component,(function(callback){rendered=callback}),(function(value){if(self.currentCell===cell){var valid=self.chain("edit-success",[cell,value],!0,!0);return!0===valid||"highlight"===self.table.options.validationMode?(self.clearEditor(),cell.modules.edit||(cell.modules.edit={}),cell.modules.edit.edited=!0,-1==self.editedCells.indexOf(cell)&&self.editedCells.push(cell),cell.setValue(value,!0),!0===valid):(self.invalidEdit=!0,self.focusCellNoEvent(cell,!0),rendered(),!1)}}),(function(){self.currentCell===cell&&self.cancelEdit()}),params)))return element.blur(),!1;if(!(cellEditor instanceof Node))return console.warn("Edit Error - Editor should return an instance of Node, the editor returned:",cellEditor),element.blur(),!1;for(element.classList.add("tabulator-editing"),cell.row.getElement().classList.add("tabulator-editing"),cell.table.element.classList.add("tabulator-editing");element.firstChild;)element.removeChild(element.firstChild);element.appendChild(cellEditor),rendered();for(var children=element.children,i=0;i<children.length;i++)children[i].addEventListener("click",(function(e){e.stopPropagation()}));return!0}return this.mouseClick=!1,element.blur(),!1}this.invalidEdit||this.cancelEdit()}},{key:"getEditedCells",value:function(){var output=[];return this.editedCells.forEach((function(cell){output.push(cell.getComponent())})),output}},{key:"clearEdited",value:function(cell){var editIndex;cell.modules.edit&&cell.modules.edit.edited&&(cell.modules.edit.edited=!1,this.dispatch("edit-edited-clear",cell)),(editIndex=this.editedCells.indexOf(cell))>-1&&this.editedCells.splice(editIndex,1)}}]),Edit$1}(Module);_exports.EditModule=Edit$1,Edit$1.moduleName="edit",Edit$1.editors=defaultEditors;var ExportRow=_createClass((function ExportRow(type,columns,component,indent){_classCallCheck(this,ExportRow),this.type=type,this.columns=columns,this.component=component||!1,this.indent=indent||0})),ExportColumn=_createClass((function ExportColumn(value,component,width,height,depth){_classCallCheck(this,ExportColumn),this.value=value,this.component=component||!1,this.width=width,this.height=height,this.depth=depth})),Export=function(_Module8){_inherits(Export,_Module8);var _super13=_createSuper(Export);function Export(table){var _this60;return _classCallCheck(this,Export),(_this60=_super13.call(this,table)).config={},_this60.cloneTableStyle=!0,_this60.colVisProp="",_this60.registerTableOption("htmlOutputConfig",!1),_this60.registerColumnOption("htmlOutput"),_this60.registerColumnOption("titleHtmlOutput"),_this60}return _createClass(Export,[{key:"initialize",value:function(){this.registerTableFunction("getHtml",this.getHtml.bind(this))}},{key:"generateExportList",value:function(config,style,range,colVisProp){this.cloneTableStyle=style,this.config=config||{},this.colVisProp=colVisProp;var headers=!1!==this.config.columnHeaders?this.headersToExportRows(this.generateColumnGroupHeaders()):[],body=this.bodyToExportRows(this.rowLookup(range));return headers.concat(body)}},{key:"generateTable",value:function(config,style,range,colVisProp){var list=this.generateExportList(config,style,range,colVisProp);return this.generateTableElement(list)}},{key:"rowLookup",value:function(range){var _this61=this,rows=[];if("function"==typeof range)range.call(this.table).forEach((function(row){(row=_this61.table.rowManager.findRow(row))&&rows.push(row)}));else switch(range){case!0:case"visible":rows=this.table.rowManager.getVisibleRows(!1,!0);break;case"all":rows=this.table.rowManager.rows;break;case"selected":rows=this.table.modules.selectRow.selectedRows;break;default:rows=this.table.options.pagination?this.table.rowManager.getDisplayRows(this.table.rowManager.displayRows.length-2):this.table.rowManager.getDisplayRows()}return Object.assign([],rows)}},{key:"generateColumnGroupHeaders",value:function(){var _this62=this,output=[];return(!1!==this.config.columnGroups?this.table.columnManager.columns:this.table.columnManager.columnsByIndex).forEach((function(column){var colData=_this62.processColumnGroup(column);colData&&output.push(colData)})),output}},{key:"processColumnGroup",value:function(column){var _this63=this,subGroups=column.columns,maxDepth=0,groupData={title:column.definition["title"+(this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1))]||column.definition.title,column:column,depth:1};if(subGroups.length){if(groupData.subGroups=[],groupData.width=0,subGroups.forEach((function(subGroup){var subGroupData=_this63.processColumnGroup(subGroup);subGroupData&&(groupData.width+=subGroupData.width,groupData.subGroups.push(subGroupData),subGroupData.depth>maxDepth&&(maxDepth=subGroupData.depth))})),groupData.depth+=maxDepth,!groupData.width)return!1}else{if(!this.columnVisCheck(column))return!1;groupData.width=1}return groupData}},{key:"columnVisCheck",value:function(column){var visProp=column.definition[this.colVisProp];return"function"==typeof visProp&&(visProp=visProp.call(this.table,column.getComponent())),!1!==visProp&&(column.visible||!column.visible&&visProp)}},{key:"headersToExportRows",value:function(columns){var headers=[],headerDepth=0,exportRows=[];function parseColumnGroup(column,level){var depth=headerDepth-level;if(void 0===headers[level]&&(headers[level]=[]),column.height=column.subGroups?1:depth-column.depth+1,headers[level].push(column),column.height>1)for(var i=1;i<column.height;i++)void 0===headers[level+i]&&(headers[level+i]=[]),headers[level+i].push(!1);if(column.width>1)for(var _i2=1;_i2<column.width;_i2++)headers[level].push(!1);column.subGroups&&column.subGroups.forEach((function(subGroup){parseColumnGroup(subGroup,level+1)}))}return columns.forEach((function(column){column.depth>headerDepth&&(headerDepth=column.depth)})),columns.forEach((function(column){parseColumnGroup(column,0)})),headers.forEach((function(header){var columns=[];header.forEach((function(col){if(col){var title=void 0===col.title?"":col.title;columns.push(new ExportColumn(title,col.column.getComponent(),col.width,col.height,col.depth))}else columns.push(null)})),exportRows.push(new ExportRow("header",columns))})),exportRows}},{key:"bodyToExportRows",value:function(rows){var _this64=this,columns=[],exportRows=[];return this.table.columnManager.columnsByIndex.forEach((function(column){_this64.columnVisCheck(column)&&columns.push(column.getComponent())})),!1!==this.config.columnCalcs&&this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&rows.unshift(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&rows.push(this.table.modules.columnCalcs.botRow)),(rows=rows.filter((function(row){switch(row.type){case"group":return!1!==_this64.config.rowGroups;case"calc":return!1!==_this64.config.columnCalcs;case"row":return!(_this64.table.options.dataTree&&!1===_this64.config.dataTree&&row.modules.dataTree.parent)}return!0}))).forEach((function(row,i){var rowData=row.getData(_this64.colVisProp),exportCols=[],indent=0;switch(row.type){case"group":indent=row.level,exportCols.push(new ExportColumn(row.key,row.getComponent(),columns.length,1));break;case"calc":case"row":columns.forEach((function(col){exportCols.push(new ExportColumn(col._column.getFieldValue(rowData),col,1,1))})),_this64.table.options.dataTree&&!1!==_this64.config.dataTree&&(indent=row.modules.dataTree.index)}exportRows.push(new ExportRow(row.type,exportCols,row.getComponent(),indent))})),exportRows}},{key:"generateTableElement",value:function(list){var _this65=this,table=document.createElement("table"),headerEl=document.createElement("thead"),bodyEl=document.createElement("tbody"),styles=this.lookupTableStyles(),rowFormatter=this.table.options["rowFormatter"+(this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1))],setup={};return setup.rowFormatter=null!==rowFormatter?rowFormatter:this.table.options.rowFormatter,this.table.options.dataTree&&!1!==this.config.dataTree&&this.table.modExists("columnCalcs")&&(setup.treeElementField=this.table.modules.dataTree.elementField),setup.groupHeader=this.table.options["groupHeader"+(this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1))],setup.groupHeader&&!Array.isArray(setup.groupHeader)&&(setup.groupHeader=[setup.groupHeader]),table.classList.add("tabulator-print-table"),this.mapElementStyles(this.table.columnManager.getHeadersElement(),headerEl,["border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),list.length>1e3&&console.warn("It may take a long time to render an HTML table with more than 1000 rows"),list.forEach((function(row,i){var rowEl;switch(row.type){case"header":headerEl.appendChild(_this65.generateHeaderElement(row,setup,styles));break;case"group":bodyEl.appendChild(_this65.generateGroupElement(row,setup,styles));break;case"calc":bodyEl.appendChild(_this65.generateCalcElement(row,setup,styles));break;case"row":rowEl=_this65.generateRowElement(row,setup,styles),_this65.mapElementStyles(i%2&&styles.evenRow?styles.evenRow:styles.oddRow,rowEl,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),bodyEl.appendChild(rowEl)}})),headerEl.innerHTML&&table.appendChild(headerEl),table.appendChild(bodyEl),this.mapElementStyles(this.table.element,table,["border-top","border-left","border-right","border-bottom"]),table}},{key:"lookupTableStyles",value:function(){var styles={};return this.cloneTableStyle&&window.getComputedStyle&&(styles.oddRow=this.table.element.querySelector(".tabulator-row-odd:not(.tabulator-group):not(.tabulator-calcs)"),styles.evenRow=this.table.element.querySelector(".tabulator-row-even:not(.tabulator-group):not(.tabulator-calcs)"),styles.calcRow=this.table.element.querySelector(".tabulator-row.tabulator-calcs"),styles.firstRow=this.table.element.querySelector(".tabulator-row:not(.tabulator-group):not(.tabulator-calcs)"),styles.firstGroup=this.table.element.getElementsByClassName("tabulator-group")[0],styles.firstRow&&(styles.styleCells=styles.firstRow.getElementsByClassName("tabulator-cell"),styles.firstCell=styles.styleCells[0],styles.lastCell=styles.styleCells[styles.styleCells.length-1])),styles}},{key:"generateHeaderElement",value:function(row,setup,styles){var _this66=this,rowEl=document.createElement("tr");return row.columns.forEach((function(column){if(column){var cellEl=document.createElement("th"),classNames=column.component._column.definition.cssClass?column.component._column.definition.cssClass.split(" "):[];cellEl.colSpan=column.width,cellEl.rowSpan=column.height,cellEl.innerHTML=column.value,_this66.cloneTableStyle&&(cellEl.style.boxSizing="border-box"),classNames.forEach((function(className){cellEl.classList.add(className)})),_this66.mapElementStyles(column.component.getElement(),cellEl,["text-align","border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),_this66.mapElementStyles(column.component._column.contentElement,cellEl,["padding-top","padding-left","padding-right","padding-bottom"]),column.component._column.visible?_this66.mapElementStyles(column.component.getElement(),cellEl,["width"]):column.component._column.definition.width&&(cellEl.style.width=column.component._column.definition.width+"px"),column.component._column.parent&&_this66.mapElementStyles(column.component._column.parent.groupElement,cellEl,["border-top"]),rowEl.appendChild(cellEl)}})),rowEl}},{key:"generateGroupElement",value:function(row,setup,styles){var rowEl=document.createElement("tr"),cellEl=document.createElement("td"),group=row.columns[0];return rowEl.classList.add("tabulator-print-table-row"),setup.groupHeader&&setup.groupHeader[row.indent]?group.value=setup.groupHeader[row.indent](group.value,row.component._group.getRowCount(),row.component._group.getData(),row.component):!1!==setup.groupHeader&&(group.value=row.component._group.generator(group.value,row.component._group.getRowCount(),row.component._group.getData(),row.component)),cellEl.colSpan=group.width,cellEl.innerHTML=group.value,rowEl.classList.add("tabulator-print-table-group"),rowEl.classList.add("tabulator-group-level-"+row.indent),group.component.isVisible()&&rowEl.classList.add("tabulator-group-visible"),this.mapElementStyles(styles.firstGroup,rowEl,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),this.mapElementStyles(styles.firstGroup,cellEl,["padding-top","padding-left","padding-right","padding-bottom"]),rowEl.appendChild(cellEl),rowEl}},{key:"generateCalcElement",value:function(row,setup,styles){var rowEl=this.generateRowElement(row,setup,styles);return rowEl.classList.add("tabulator-print-table-calcs"),this.mapElementStyles(styles.calcRow,rowEl,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),rowEl}},{key:"generateRowElement",value:function(row,setup,styles){var _this67=this,rowEl=document.createElement("tr");return rowEl.classList.add("tabulator-print-table-row"),row.columns.forEach((function(col,i){if(col){var cellStyle,cellEl=document.createElement("td"),column=col.component._column,index=_this67.table.columnManager.findColumnIndex(column),value=col.value,cellWrapper={modules:{},getValue:function(){return value},getField:function(){return column.definition.field},getElement:function(){return cellEl},getColumn:function(){return column.getComponent()},getData:function(){return row.component.getData()},getRow:function(){return row.component},getComponent:function(){return cellWrapper},column:column};if((column.definition.cssClass?column.definition.cssClass.split(" "):[]).forEach((function(className){cellEl.classList.add(className)})),_this67.table.modExists("format")&&!1!==_this67.config.formatCells)value=_this67.table.modules.format.formatExportValue(cellWrapper,_this67.colVisProp);else switch(_typeof(value)){case"object":value=null!==value?JSON.stringify(value):"";break;case"undefined":value=""}value instanceof Node?cellEl.appendChild(value):cellEl.innerHTML=value,(cellStyle=styles.styleCells&&styles.styleCells[index]?styles.styleCells[index]:styles.firstCell)&&(_this67.mapElementStyles(cellStyle,cellEl,["padding-top","padding-left","padding-right","padding-bottom","border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","text-align"]),column.definition.align&&(cellEl.style.textAlign=column.definition.align)),_this67.table.options.dataTree&&!1!==_this67.config.dataTree&&(setup.treeElementField&&setup.treeElementField==column.field||!setup.treeElementField&&0==i)&&(row.component._row.modules.dataTree.controlEl&&cellEl.insertBefore(row.component._row.modules.dataTree.controlEl.cloneNode(!0),cellEl.firstChild),row.component._row.modules.dataTree.branchEl&&cellEl.insertBefore(row.component._row.modules.dataTree.branchEl.cloneNode(!0),cellEl.firstChild)),rowEl.appendChild(cellEl),cellWrapper.modules.format&&cellWrapper.modules.format.renderedCallback&&cellWrapper.modules.format.renderedCallback(),setup.rowFormatter&&!1!==_this67.config.formatCells&&setup.rowFormatter(row.component)}})),rowEl}},{key:"generateHTMLTable",value:function(list){var holder=document.createElement("div");return holder.appendChild(this.generateTableElement(list)),holder.innerHTML}},{key:"getHtml",value:function(visible,style,config,colVisProp){var list=this.generateExportList(config||this.table.options.htmlOutputConfig,style,visible,colVisProp||"htmlOutput");return this.generateHTMLTable(list)}},{key:"mapElementStyles",value:function(from,to,props){if(this.cloneTableStyle&&from&&to){var lookup={"background-color":"backgroundColor",color:"fontColor",width:"width","font-weight":"fontWeight","font-family":"fontFamily","font-size":"fontSize","text-align":"textAlign","border-top":"borderTop","border-left":"borderLeft","border-right":"borderRight","border-bottom":"borderBottom","padding-top":"paddingTop","padding-left":"paddingLeft","padding-right":"paddingRight","padding-bottom":"paddingBottom"};if(window.getComputedStyle){var fromStyle=window.getComputedStyle(from);props.forEach((function(prop){to.style[lookup[prop]]=fromStyle.getPropertyValue(prop)}))}}}}]),Export}(Module);_exports.ExportModule=Export,Export.moduleName="export";var defaultFilters={"=":function(filterVal,rowVal,rowData,filterParams){return rowVal==filterVal},"<":function(filterVal,rowVal,rowData,filterParams){return rowVal<filterVal},"<=":function(filterVal,rowVal,rowData,filterParams){return rowVal<=filterVal},">":function(filterVal,rowVal,rowData,filterParams){return rowVal>filterVal},">=":function(filterVal,rowVal,rowData,filterParams){return rowVal>=filterVal},"!=":function(filterVal,rowVal,rowData,filterParams){return rowVal!=filterVal},regex:function(filterVal,rowVal,rowData,filterParams){return"string"==typeof filterVal&&(filterVal=new RegExp(filterVal)),filterVal.test(rowVal)},like:function(filterVal,rowVal,rowData,filterParams){return null==filterVal?rowVal===filterVal:null!=rowVal&&String(rowVal).toLowerCase().indexOf(filterVal.toLowerCase())>-1},keywords:function(filterVal,rowVal,rowData,filterParams){var keywords=filterVal.toLowerCase().split(void 0===filterParams.separator?" ":filterParams.separator),value=String(null==rowVal?"":rowVal).toLowerCase(),matches=[];return keywords.forEach((function(keyword){value.includes(keyword)&&matches.push(!0)})),filterParams.matchAll?matches.length===keywords.length:!!matches.length},starts:function(filterVal,rowVal,rowData,filterParams){return null==filterVal?rowVal===filterVal:null!=rowVal&&String(rowVal).toLowerCase().startsWith(filterVal.toLowerCase())},ends:function(filterVal,rowVal,rowData,filterParams){return null==filterVal?rowVal===filterVal:null!=rowVal&&String(rowVal).toLowerCase().endsWith(filterVal.toLowerCase())},in:function(filterVal,rowVal,rowData,filterParams){return Array.isArray(filterVal)?!filterVal.length||filterVal.indexOf(rowVal)>-1:(console.warn("Filter Error - filter value is not an array:",filterVal),!1)}},Filter=function(_Module9){_inherits(Filter,_Module9);var _super14=_createSuper(Filter);function Filter(table){var _this68;return _classCallCheck(this,Filter),(_this68=_super14.call(this,table)).filterList=[],_this68.headerFilters={},_this68.headerFilterColumns=[],_this68.prevHeaderFilterChangeCheck="",_this68.prevHeaderFilterChangeCheck="{}",_this68.changed=!1,_this68.tableInitialized=!1,_this68.registerTableOption("filterMode","local"),_this68.registerTableOption("initialFilter",!1),_this68.registerTableOption("initialHeaderFilter",!1),_this68.registerTableOption("headerFilterLiveFilterDelay",300),_this68.registerColumnOption("headerFilter"),_this68.registerColumnOption("headerFilterPlaceholder"),_this68.registerColumnOption("headerFilterParams"),_this68.registerColumnOption("headerFilterEmptyCheck"),_this68.registerColumnOption("headerFilterFunc"),_this68.registerColumnOption("headerFilterFuncParams"),_this68.registerColumnOption("headerFilterLiveFilter"),_this68.registerTableFunction("searchRows",_this68.searchRows.bind(_assertThisInitialized(_this68))),_this68.registerTableFunction("searchData",_this68.searchData.bind(_assertThisInitialized(_this68))),_this68.registerTableFunction("setFilter",_this68.userSetFilter.bind(_assertThisInitialized(_this68))),_this68.registerTableFunction("refreshFilter",_this68.userRefreshFilter.bind(_assertThisInitialized(_this68))),_this68.registerTableFunction("addFilter",_this68.userAddFilter.bind(_assertThisInitialized(_this68))),_this68.registerTableFunction("getFilters",_this68.getFilters.bind(_assertThisInitialized(_this68))),_this68.registerTableFunction("setHeaderFilterFocus",_this68.userSetHeaderFilterFocus.bind(_assertThisInitialized(_this68))),_this68.registerTableFunction("getHeaderFilterValue",_this68.userGetHeaderFilterValue.bind(_assertThisInitialized(_this68))),_this68.registerTableFunction("setHeaderFilterValue",_this68.userSetHeaderFilterValue.bind(_assertThisInitialized(_this68))),_this68.registerTableFunction("getHeaderFilters",_this68.getHeaderFilters.bind(_assertThisInitialized(_this68))),_this68.registerTableFunction("removeFilter",_this68.userRemoveFilter.bind(_assertThisInitialized(_this68))),_this68.registerTableFunction("clearFilter",_this68.userClearFilter.bind(_assertThisInitialized(_this68))),_this68.registerTableFunction("clearHeaderFilter",_this68.userClearHeaderFilter.bind(_assertThisInitialized(_this68))),_this68.registerComponentFunction("column","headerFilterFocus",_this68.setHeaderFilterFocus.bind(_assertThisInitialized(_this68))),_this68.registerComponentFunction("column","reloadHeaderFilter",_this68.reloadHeaderFilter.bind(_assertThisInitialized(_this68))),_this68.registerComponentFunction("column","getHeaderFilterValue",_this68.getHeaderFilterValue.bind(_assertThisInitialized(_this68))),_this68.registerComponentFunction("column","setHeaderFilterValue",_this68.setHeaderFilterValue.bind(_assertThisInitialized(_this68))),_this68}return _createClass(Filter,[{key:"initialize",value:function(){this.subscribe("column-init",this.initializeColumnHeaderFilter.bind(this)),this.subscribe("column-width-fit-before",this.hideHeaderFilterElements.bind(this)),this.subscribe("column-width-fit-after",this.showHeaderFilterElements.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),"remote"===this.table.options.filterMode&&this.subscribe("data-params",this.remoteFilterParams.bind(this)),this.registerDataHandler(this.filter.bind(this),10)}},{key:"tableBuilt",value:function(){var _this69=this;this.table.options.initialFilter&&this.setFilter(this.table.options.initialFilter),this.table.options.initialHeaderFilter&&this.table.options.initialHeaderFilter.forEach((function(item){var column=_this69.table.columnManager.findColumn(item.field);if(!column)return console.warn("Column Filter Error - No matching column found:",item.field),!1;_this69.setHeaderFilterValue(column,item.value)})),this.tableInitialized=!0}},{key:"remoteFilterParams",value:function(data,config,silent,params){return params.filter=this.getFilters(!0,!0),params}},{key:"userSetFilter",value:function(field,type,value,params){this.setFilter(field,type,value,params),this.refreshFilter()}},{key:"userRefreshFilter",value:function(){this.refreshFilter()}},{key:"userAddFilter",value:function(field,type,value,params){this.addFilter(field,type,value,params),this.refreshFilter()}},{key:"userSetHeaderFilterFocus",value:function(field){var column=this.table.columnManager.findColumn(field);if(!column)return console.warn("Column Filter Focus Error - No matching column found:",field),!1;this.setHeaderFilterFocus(column)}},{key:"userGetHeaderFilterValue",value:function(field){var column=this.table.columnManager.findColumn(field);if(column)return this.getHeaderFilterValue(column);console.warn("Column Filter Error - No matching column found:",field)}},{key:"userSetHeaderFilterValue",value:function(field,value){var column=this.table.columnManager.findColumn(field);if(!column)return console.warn("Column Filter Error - No matching column found:",field),!1;this.setHeaderFilterValue(column,value)}},{key:"userRemoveFilter",value:function(field,type,value){this.removeFilter(field,type,value),this.refreshFilter()}},{key:"userClearFilter",value:function(all){this.clearFilter(all),this.refreshFilter()}},{key:"userClearHeaderFilter",value:function(){this.clearHeaderFilter(),this.refreshFilter()}},{key:"searchRows",value:function(field,type,value){return this.search("rows",field,type,value)}},{key:"searchData",value:function(field,type,value){return this.search("data",field,type,value)}},{key:"initializeColumnHeaderFilter",value:function(column){var def=column.definition;def.headerFilter&&(void 0!==def.headerFilterPlaceholder&&def.field&&this.module("localize").setHeaderFilterColumnPlaceholder(def.field,def.headerFilterPlaceholder),this.initializeColumn(column))}},{key:"initializeColumn",value:function(column,value){var self=this,field=column.getField();column.modules.filter={success:function(value){var filterFunc,filterType="input"==column.modules.filter.tagType&&"text"==column.modules.filter.attrType||"textarea"==column.modules.filter.tagType?"partial":"match",type="",filterChangeCheck="";if(void 0===column.modules.filter.prevSuccess||column.modules.filter.prevSuccess!==value){if(column.modules.filter.prevSuccess=value,column.modules.filter.emptyFunc(value))delete self.headerFilters[field];else{switch(column.modules.filter.value=value,_typeof(column.definition.headerFilterFunc)){case"string":Filter.filters[column.definition.headerFilterFunc]?(type=column.definition.headerFilterFunc,filterFunc=function(data){var params=column.definition.headerFilterFuncParams||{},fieldVal=column.getFieldValue(data);return params="function"==typeof params?params(value,fieldVal,data):params,Filter.filters[column.definition.headerFilterFunc](value,fieldVal,data,params)}):console.warn("Header Filter Error - Matching filter function not found: ",column.definition.headerFilterFunc);break;case"function":type=filterFunc=function(data){var params=column.definition.headerFilterFuncParams||{},fieldVal=column.getFieldValue(data);return params="function"==typeof params?params(value,fieldVal,data):params,column.definition.headerFilterFunc(value,fieldVal,data,params)}}if(!filterFunc)if("partial"===filterType)filterFunc=function(data){var colVal=column.getFieldValue(data);return null!=colVal&&String(colVal).toLowerCase().indexOf(String(value).toLowerCase())>-1},type="like";else filterFunc=function(data){return column.getFieldValue(data)==value},type="=";self.headerFilters[field]={value:value,func:filterFunc,type:type}}column.modules.filter.value=value,filterChangeCheck=JSON.stringify(self.headerFilters),self.prevHeaderFilterChangeCheck!==filterChangeCheck&&(self.prevHeaderFilterChangeCheck=filterChangeCheck,self.trackChanges(),self.refreshFilter())}return!0},attrType:!1,tagType:!1,emptyFunc:!1},this.generateHeaderFilterElement(column)}},{key:"generateHeaderFilterElement",value:function(column,initialValue,reinitialize){var filterElement,editor,editorElement,cellWrapper,typingTimer,searchTrigger,params,_this70=this,self=this,success=column.modules.filter.success,field=column.getField();if(column.modules.filter.value=initialValue,column.modules.filter.headerElement&&column.modules.filter.headerElement.parentNode&&column.contentElement.removeChild(column.modules.filter.headerElement.parentNode),field){switch(column.modules.filter.emptyFunc=column.definition.headerFilterEmptyCheck||function(value){return!value&&0!==value},(filterElement=document.createElement("div")).classList.add("tabulator-header-filter"),_typeof(column.definition.headerFilter)){case"string":self.table.modules.edit.editors[column.definition.headerFilter]?(editor=self.table.modules.edit.editors[column.definition.headerFilter],"tick"!==column.definition.headerFilter&&"tickCross"!==column.definition.headerFilter||column.definition.headerFilterEmptyCheck||(column.modules.filter.emptyFunc=function(value){return!0!==value&&!1!==value})):console.warn("Filter Error - Cannot build header filter, No such editor found: ",column.definition.editor);break;case"function":editor=column.definition.headerFilter;break;case"boolean":column.modules.edit&&column.modules.edit.editor?editor=column.modules.edit.editor:column.definition.formatter&&self.table.modules.edit.editors[column.definition.formatter]?(editor=self.table.modules.edit.editors[column.definition.formatter],"tick"!==column.definition.formatter&&"tickCross"!==column.definition.formatter||column.definition.headerFilterEmptyCheck||(column.modules.filter.emptyFunc=function(value){return!0!==value&&!1!==value})):editor=self.table.modules.edit.editors.input}if(editor){if(cellWrapper={getValue:function(){return void 0!==initialValue?initialValue:""},getField:function(){return column.definition.field},getElement:function(){return filterElement},getColumn:function(){return column.getComponent()},getTable:function(){return _this70.table},getRow:function(){return{normalizeHeight:function(){}}}},params="function"==typeof(params=column.definition.headerFilterParams||{})?params.call(self.table,cellWrapper):params,!(editorElement=editor.call(this.table.modules.edit,cellWrapper,(function(){}),success,(function(){}),params)))return void console.warn("Filter Error - Cannot add filter to "+field+" column, editor returned a value of false");if(!(editorElement instanceof Node))return void console.warn("Filter Error - Cannot add filter to "+field+" column, editor should return an instance of Node, the editor returned:",editorElement);self.langBind("headerFilters|columns|"+column.definition.field,(function(value){editorElement.setAttribute("placeholder",void 0!==value&&value?value:self.langText("headerFilters|default"))})),editorElement.addEventListener("click",(function(e){e.stopPropagation(),editorElement.focus()})),editorElement.addEventListener("focus",(function(e){var left=_this70.table.columnManager.contentsElement.scrollLeft;left!==_this70.table.rowManager.element.scrollLeft&&(_this70.table.rowManager.scrollHorizontal(left),_this70.table.columnManager.scrollHorizontal(left))})),typingTimer=!1,searchTrigger=function(e){typingTimer&&clearTimeout(typingTimer),typingTimer=setTimeout((function(){success(editorElement.value)}),self.table.options.headerFilterLiveFilterDelay)},column.modules.filter.headerElement=editorElement,column.modules.filter.attrType=editorElement.hasAttribute("type")?editorElement.getAttribute("type").toLowerCase():"",column.modules.filter.tagType=editorElement.tagName.toLowerCase(),!1!==column.definition.headerFilterLiveFilter&&("autocomplete"!==column.definition.headerFilter&&"tickCross"!==column.definition.headerFilter&&("autocomplete"!==column.definition.editor&&"tickCross"!==column.definition.editor||!0!==column.definition.headerFilter)&&(editorElement.addEventListener("keyup",searchTrigger),editorElement.addEventListener("search",searchTrigger),"number"==column.modules.filter.attrType&&editorElement.addEventListener("change",(function(e){success(editorElement.value)})),"text"==column.modules.filter.attrType&&"ie"!==this.table.browser&&editorElement.setAttribute("type","search")),"input"!=column.modules.filter.tagType&&"select"!=column.modules.filter.tagType&&"textarea"!=column.modules.filter.tagType||editorElement.addEventListener("mousedown",(function(e){e.stopPropagation()}))),filterElement.appendChild(editorElement),column.contentElement.appendChild(filterElement),reinitialize||self.headerFilterColumns.push(column)}}else console.warn("Filter Error - Cannot add header filter, column has no field set:",column.definition.title)}},{key:"hideHeaderFilterElements",value:function(){this.headerFilterColumns.forEach((function(column){column.modules.filter&&column.modules.filter.headerElement&&(column.modules.filter.headerElement.style.display="none")}))}},{key:"showHeaderFilterElements",value:function(){this.headerFilterColumns.forEach((function(column){column.modules.filter&&column.modules.filter.headerElement&&(column.modules.filter.headerElement.style.display="")}))}},{key:"setHeaderFilterFocus",value:function(column){column.modules.filter&&column.modules.filter.headerElement?column.modules.filter.headerElement.focus():console.warn("Column Filter Focus Error - No header filter set on column:",column.getField())}},{key:"getHeaderFilterValue",value:function(column){if(column.modules.filter&&column.modules.filter.headerElement)return column.modules.filter.value;console.warn("Column Filter Error - No header filter set on column:",column.getField())}},{key:"setHeaderFilterValue",value:function(column,value){column&&(column.modules.filter&&column.modules.filter.headerElement?(this.generateHeaderFilterElement(column,value,!0),column.modules.filter.success(value)):console.warn("Column Filter Error - No header filter set on column:",column.getField()))}},{key:"reloadHeaderFilter",value:function(column){column&&(column.modules.filter&&column.modules.filter.headerElement?this.generateHeaderFilterElement(column,column.modules.filter.value,!0):console.warn("Column Filter Error - No header filter set on column:",column.getField()))}},{key:"refreshFilter",value:function(){this.tableInitialized&&("remote"===this.table.options.filterMode?this.reloadData(null,!1,!1):this.refreshData(!0))}},{key:"trackChanges",value:function(){this.changed=!0,this.dispatch("filter-changed")}},{key:"hasChanged",value:function(){var changed=this.changed;return this.changed=!1,changed}},{key:"setFilter",value:function(field,type,value,params){this.filterList=[],Array.isArray(field)||(field=[{field:field,type:type,value:value,params:params}]),this.addFilter(field)}},{key:"addFilter",value:function(field,type,value,params){var _this71=this,changed=!1;Array.isArray(field)||(field=[{field:field,type:type,value:value,params:params}]),field.forEach((function(filter){(filter=_this71.findFilter(filter))&&(_this71.filterList.push(filter),changed=!0)})),changed&&this.trackChanges()}},{key:"findFilter",value:function(filter){var column;if(Array.isArray(filter))return this.findSubFilters(filter);var filterFunc=!1;return"function"==typeof filter.field?filterFunc=function(data){return filter.field(data,filter.type||{})}:Filter.filters[filter.type]?filterFunc=(column=this.table.columnManager.getColumnByField(filter.field))?function(data){return Filter.filters[filter.type](filter.value,column.getFieldValue(data),data,filter.params||{})}:function(data){return Filter.filters[filter.type](filter.value,data[filter.field],data,filter.params||{})}:console.warn("Filter Error - No such filter type found, ignoring: ",filter.type),filter.func=filterFunc,!!filter.func&&filter}},{key:"findSubFilters",value:function(filters){var _this72=this,output=[];return filters.forEach((function(filter){(filter=_this72.findFilter(filter))&&output.push(filter)})),!!output.length&&output}},{key:"getFilters",value:function(all,ajax){var output=[];return all&&(output=this.getHeaderFilters()),ajax&&output.forEach((function(item){"function"==typeof item.type&&(item.type="function")})),output=output.concat(this.filtersToArray(this.filterList,ajax))}},{key:"filtersToArray",value:function(filterList,ajax){var _this73=this,output=[];return filterList.forEach((function(filter){var item;Array.isArray(filter)?output.push(_this73.filtersToArray(filter,ajax)):(item={field:filter.field,type:filter.type,value:filter.value},ajax&&"function"==typeof item.type&&(item.type="function"),output.push(item))})),output}},{key:"getHeaderFilters",value:function(){var output=[];for(var key in this.headerFilters)output.push({field:key,type:this.headerFilters[key].type,value:this.headerFilters[key].value});return output}},{key:"removeFilter",value:function(field,type,value){var _this74=this;Array.isArray(field)||(field=[{field:field,type:type,value:value}]),field.forEach((function(filter){var index=-1;(index="object"==_typeof(filter.field)?_this74.filterList.findIndex((function(element){return filter===element})):_this74.filterList.findIndex((function(element){return filter.field===element.field&&filter.type===element.type&&filter.value===element.value})))>-1?_this74.filterList.splice(index,1):console.warn("Filter Error - No matching filter type found, ignoring: ",filter.type)})),this.trackChanges()}},{key:"clearFilter",value:function(all){this.filterList=[],all&&this.clearHeaderFilter(),this.trackChanges()}},{key:"clearHeaderFilter",value:function(){var _this75=this;this.headerFilters={},this.prevHeaderFilterChangeCheck="{}",this.headerFilterColumns.forEach((function(column){void 0!==column.modules.filter.value&&delete column.modules.filter.value,column.modules.filter.prevSuccess=void 0,_this75.reloadHeaderFilter(column)})),this.trackChanges()}},{key:"search",value:function(searchType,field,type,value){var _this76=this,activeRows=[],filterList=[];return Array.isArray(field)||(field=[{field:field,type:type,value:value}]),field.forEach((function(filter){(filter=_this76.findFilter(filter))&&filterList.push(filter)})),this.table.rowManager.rows.forEach((function(row){var match=!0;filterList.forEach((function(filter){_this76.filterRecurse(filter,row.getData())||(match=!1)})),match&&activeRows.push("data"===searchType?row.getData("data"):row.getComponent())})),activeRows}},{key:"filter",value:function(rowList,filters){var _this77=this,activeRows=[],activeRowComponents=[];return this.subscribedExternal("dataFiltering")&&this.dispatchExternal("dataFiltering",this.getFilters(!0)),"remote"!==this.table.options.filterMode&&(this.filterList.length||Object.keys(this.headerFilters).length)?rowList.forEach((function(row){_this77.filterRow(row)&&activeRows.push(row)})):activeRows=rowList.slice(0),this.subscribedExternal("dataFiltered")&&(activeRows.forEach((function(row){activeRowComponents.push(row.getComponent())})),this.dispatchExternal("dataFiltered",this.getFilters(!0),activeRowComponents)),activeRows}},{key:"filterRow",value:function(row,filters){var _this78=this,match=!0,data=row.getData();for(var field in this.filterList.forEach((function(filter){_this78.filterRecurse(filter,data)||(match=!1)})),this.headerFilters)this.headerFilters[field].func(data)||(match=!1);return match}},{key:"filterRecurse",value:function(filter,data){var _this79=this,match=!1;return Array.isArray(filter)?filter.forEach((function(subFilter){_this79.filterRecurse(subFilter,data)&&(match=!0)})):match=filter.func(data),match}}]),Filter}(Module);_exports.FilterModule=Filter,Filter.moduleName="filter",Filter.filters=defaultFilters;var defaultFormatters={plaintext:function(cell,formatterParams,onRendered){return this.emptyToSpace(this.sanitizeHTML(cell.getValue()))},html:function(cell,formatterParams,onRendered){return cell.getValue()},textarea:function(cell,formatterParams,onRendered){return cell.getElement().style.whiteSpace="pre-wrap",this.emptyToSpace(this.sanitizeHTML(cell.getValue()))},money:function(cell,formatterParams,onRendered){var number,integer,decimal,rgx,floatVal=parseFloat(cell.getValue()),sign="",decimalSym=formatterParams.decimal||".",thousandSym=formatterParams.thousand||",",negativeSign=formatterParams.negativeSign||"-",symbol=formatterParams.symbol||"",after=!!formatterParams.symbolAfter,precision=void 0!==formatterParams.precision?formatterParams.precision:2;if(isNaN(floatVal))return this.emptyToSpace(this.sanitizeHTML(cell.getValue()));if(floatVal<0&&(floatVal=Math.abs(floatVal),sign=negativeSign),number=!1!==precision?floatVal.toFixed(precision):floatVal,integer=(number=String(number).split("."))[0],decimal=number.length>1?decimalSym+number[1]:"",!1!==formatterParams.thousand)for(rgx=/(\d+)(\d{3})/;rgx.test(integer);)integer=integer.replace(rgx,"$1"+thousandSym+"$2");return after?sign+integer+decimal+symbol:sign+symbol+integer+decimal},link:function(cell,formatterParams,onRendered){var data,value=cell.getValue(),urlPrefix=formatterParams.urlPrefix||"",download=formatterParams.download,label=value,el=document.createElement("a");if(formatterParams.labelField&&(data=cell.getData(),label=function labelTraverse(path,data){var value=data[path.shift()];return path.length&&"object"===_typeof(value)?labelTraverse(path,value):value}(formatterParams.labelField.split(this.table.options.nestedFieldSeparator),data)),formatterParams.label)switch(_typeof(formatterParams.label)){case"string":label=formatterParams.label;break;case"function":label=formatterParams.label(cell)}if(label){if(formatterParams.urlField&&(value=(data=cell.getData())[formatterParams.urlField]),formatterParams.url)switch(_typeof(formatterParams.url)){case"string":value=formatterParams.url;break;case"function":value=formatterParams.url(cell)}return el.setAttribute("href",urlPrefix+value),formatterParams.target&&el.setAttribute("target",formatterParams.target),formatterParams.download&&(download="function"==typeof download?download(cell):!0===download?"":download,el.setAttribute("download",download)),el.innerHTML=this.emptyToSpace(this.sanitizeHTML(label)),el}return"&nbsp;"},image:function(cell,formatterParams,onRendered){var el=document.createElement("img"),src=cell.getValue();switch(formatterParams.urlPrefix&&(src=formatterParams.urlPrefix+cell.getValue()),formatterParams.urlSuffix&&(src+=formatterParams.urlSuffix),el.setAttribute("src",src),_typeof(formatterParams.height)){case"number":el.style.height=formatterParams.height+"px";break;case"string":el.style.height=formatterParams.height}switch(_typeof(formatterParams.width)){case"number":el.style.width=formatterParams.width+"px";break;case"string":el.style.width=formatterParams.width}return el.addEventListener("load",(function(){cell.getRow().normalizeHeight()})),el},tickCross:function(cell,formatterParams,onRendered){var value=cell.getValue(),element=cell.getElement(),empty=formatterParams.allowEmpty,truthy=formatterParams.allowTruthy,trueValueSet=Object.keys(formatterParams).includes("trueValue"),tick=void 0!==formatterParams.tickElement?formatterParams.tickElement:'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>',cross=void 0!==formatterParams.crossElement?formatterParams.crossElement:'<svg enable-background="new 0 0 24 24" height="14" width="14"  viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>';return trueValueSet&&value===formatterParams.trueValue||!trueValueSet&&(truthy&&value||!0===value||"true"===value||"True"===value||1===value||"1"===value)?(element.setAttribute("aria-checked",!0),tick||""):!empty||"null"!==value&&""!==value&&null!=value?(element.setAttribute("aria-checked",!1),cross||""):(element.setAttribute("aria-checked","mixed"),"")},datetime:function(cell,formatterParams,onRendered){var newDatetime,DT=window.DateTime||luxon.DateTime,inputFormat=formatterParams.inputFormat||"yyyy-MM-dd HH:mm:ss",outputFormat=formatterParams.outputFormat||"dd/MM/yyyy HH:mm:ss",invalid=void 0!==formatterParams.invalidPlaceholder?formatterParams.invalidPlaceholder:"",value=cell.getValue();if(void 0!==DT)return(newDatetime=DT.isDateTime(value)?value:"iso"===inputFormat?DT.fromISO(String(value)):DT.fromFormat(String(value),inputFormat)).isValid?(formatterParams.timezone&&(newDatetime=newDatetime.setZone(formatterParams.timezone)),newDatetime.toFormat(outputFormat)):!0!==invalid&&value?"function"==typeof invalid?invalid(value):invalid:value;console.error("Format Error - 'datetime' formatter is dependant on luxon.js")},datetimediff:function(cell,formatterParams,onRendered){var newDatetime,DT=window.DateTime||luxon.DateTime,inputFormat=formatterParams.inputFormat||"yyyy-MM-dd HH:mm:ss",invalid=void 0!==formatterParams.invalidPlaceholder?formatterParams.invalidPlaceholder:"",suffix=void 0!==formatterParams.suffix&&formatterParams.suffix,unit=void 0!==formatterParams.unit?formatterParams.unit:"days",humanize=void 0!==formatterParams.humanize&&formatterParams.humanize,date=void 0!==formatterParams.date?formatterParams.date:DT.now(),value=cell.getValue();if(void 0!==DT)return(newDatetime=DT.isDateTime(value)?value:"iso"===inputFormat?DT.fromISO(String(value)):DT.fromFormat(String(value),inputFormat)).isValid?humanize?newDatetime.diff(date,unit).toHuman()+(suffix?" "+suffix:""):parseInt(newDatetime.diff(date,unit)[unit])+(suffix?" "+suffix:""):!0===invalid?value:"function"==typeof invalid?invalid(value):invalid;console.error("Format Error - 'datetimediff' formatter is dependant on luxon.js")},lookup:function(cell,formatterParams,onRendered){var value=cell.getValue();return void 0===formatterParams[value]?(console.warn("Missing display value for "+value),value):formatterParams[value]},star:function(cell,formatterParams,onRendered){var value=cell.getValue(),element=cell.getElement(),maxStars=formatterParams&&formatterParams.stars?formatterParams.stars:5,stars=document.createElement("span"),star=document.createElementNS("http://www.w3.org/2000/svg","svg");stars.style.verticalAlign="middle",star.setAttribute("width","14"),star.setAttribute("height","14"),star.setAttribute("viewBox","0 0 512 512"),star.setAttribute("xml:space","preserve"),star.style.padding="0 1px",value=value&&!isNaN(value)?parseInt(value):0,value=Math.max(0,Math.min(value,maxStars));for(var i=1;i<=maxStars;i++){var nextStar=star.cloneNode(!0);nextStar.innerHTML=i<=value?'<polygon fill="#FFEA00" stroke="#C1AB60" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>':'<polygon fill="#D2D2D2" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>',stars.appendChild(nextStar)}return element.style.whiteSpace="nowrap",element.style.overflow="hidden",element.style.textOverflow="ellipsis",element.setAttribute("aria-label",value),stars},traffic:function(cell,formatterParams,onRendered){var percent,percentValue,value=this.sanitizeHTML(cell.getValue())||0,el=document.createElement("span"),max=formatterParams&&formatterParams.max?formatterParams.max:100,min=formatterParams&&formatterParams.min?formatterParams.min:0,colors=formatterParams&&void 0!==formatterParams.color?formatterParams.color:["red","orange","green"],color="#666666";if(!isNaN(value)&&void 0!==cell.getValue()){switch(el.classList.add("tabulator-traffic-light"),percentValue=parseFloat(value)<=max?parseFloat(value):max,percentValue=parseFloat(percentValue)>=min?parseFloat(percentValue):min,percent=(max-min)/100,percentValue=Math.round((percentValue-min)/percent),_typeof(colors)){case"string":color=colors;break;case"function":color=colors(value);break;case"object":if(Array.isArray(colors)){var unit=100/colors.length,index=Math.floor(percentValue/unit);index=Math.min(index,colors.length-1),color=colors[index=Math.max(index,0)];break}}return el.style.backgroundColor=color,el}},progress:function(cell){var percent,percentValue,color,legend,legendColor,formatterParams=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},onRendered=arguments.length>2?arguments[2]:void 0,value=this.sanitizeHTML(cell.getValue())||0,element=cell.getElement(),max=formatterParams.max?formatterParams.max:100,min=formatterParams.min?formatterParams.min:0,legendAlign=formatterParams.legendAlign?formatterParams.legendAlign:"center";switch(percentValue=parseFloat(value)<=max?parseFloat(value):max,percentValue=parseFloat(percentValue)>=min?parseFloat(percentValue):min,percent=(max-min)/100,percentValue=Math.round((percentValue-min)/percent),_typeof(formatterParams.color)){case"string":color=formatterParams.color;break;case"function":color=formatterParams.color(value);break;case"object":if(Array.isArray(formatterParams.color)){var unit=100/formatterParams.color.length,index=Math.floor(percentValue/unit);index=Math.min(index,formatterParams.color.length-1),index=Math.max(index,0),color=formatterParams.color[index];break}default:color="#2DC214"}switch(_typeof(formatterParams.legend)){case"string":legend=formatterParams.legend;break;case"function":legend=formatterParams.legend(value);break;case"boolean":legend=value;break;default:legend=!1}switch(_typeof(formatterParams.legendColor)){case"string":legendColor=formatterParams.legendColor;break;case"function":legendColor=formatterParams.legendColor(value);break;case"object":if(Array.isArray(formatterParams.legendColor)){var _unit=100/formatterParams.legendColor.length,_index=Math.floor(percentValue/_unit);_index=Math.min(_index,formatterParams.legendColor.length-1),_index=Math.max(_index,0),legendColor=formatterParams.legendColor[_index]}break;default:legendColor="#000"}element.style.minWidth="30px",element.style.position="relative",element.setAttribute("aria-label",percentValue);var barEl=document.createElement("div");barEl.style.display="inline-block",barEl.style.width=percentValue+"%",barEl.style.backgroundColor=color,barEl.style.height="100%",barEl.setAttribute("data-max",max),barEl.setAttribute("data-min",min);var barContainer=document.createElement("div");if(barContainer.style.position="relative",barContainer.style.width="100%",barContainer.style.height="100%",legend){var legendEl=document.createElement("div");legendEl.style.position="absolute",legendEl.style.top=0,legendEl.style.left=0,legendEl.style.textAlign=legendAlign,legendEl.style.width="100%",legendEl.style.color=legendColor,legendEl.innerHTML=legend}return onRendered((function(){if(!(cell instanceof CellComponent)){var holderEl=document.createElement("div");holderEl.style.position="absolute",holderEl.style.top="4px",holderEl.style.bottom="4px",holderEl.style.left="4px",holderEl.style.right="4px",element.appendChild(holderEl),element=holderEl}element.appendChild(barContainer),barContainer.appendChild(barEl),legend&&barContainer.appendChild(legendEl)})),""},color:function(cell,formatterParams,onRendered){return cell.getElement().style.backgroundColor=this.sanitizeHTML(cell.getValue()),""},buttonTick:function(cell,formatterParams,onRendered){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>'},buttonCross:function(cell,formatterParams,onRendered){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>'},rownum:function(cell,formatterParams,onRendered){var content=document.createElement("span");return cell.getRow().watchPosition((function(position){content.innerText=position})),content},handle:function(cell,formatterParams,onRendered){return cell.getElement().classList.add("tabulator-row-handle"),"<div class='tabulator-row-handle-box'><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div></div>"},responsiveCollapse:function(cell,formatterParams,onRendered){var el=document.createElement("div"),config=cell.getRow()._row.modules.responsiveLayout;function toggleList(isOpen){var collapseEl=config.element;config.open=isOpen,collapseEl&&(config.open?(el.classList.add("open"),collapseEl.style.display=""):(el.classList.remove("open"),collapseEl.style.display="none"))}return el.classList.add("tabulator-responsive-collapse-toggle"),el.innerHTML='<svg class=\'tabulator-responsive-collapse-toggle-open\' viewbox="0 0 24 24">\n  <line x1="7" y1="12" x2="17" y2="12" fill="none" stroke-width="3" stroke-linecap="round" />\n  <line y1="7" x1="12" y2="17" x2="12" fill="none" stroke-width="3" stroke-linecap="round" />\n</svg>\n\n<svg class=\'tabulator-responsive-collapse-toggle-close\' viewbox="0 0 24 24">\n  <line x1="7" y1="12" x2="17" y2="12"  fill="none" stroke-width="3" stroke-linecap="round" />\n</svg>',cell.getElement().classList.add("tabulator-row-handle"),el.addEventListener("click",(function(e){e.stopImmediatePropagation(),toggleList(!config.open),cell.getTable().rowManager.adjustTableSize()})),toggleList(config.open),el},rowSelection:function(cell,formatterParams,onRendered){var _this80=this,checkbox=document.createElement("input"),blocked=!1;if(checkbox.type="checkbox",checkbox.setAttribute("aria-label","Select Row"),this.table.modExists("selectRow",!0))if(checkbox.addEventListener("click",(function(e){e.stopPropagation()})),"function"==typeof cell.getRow){var row=cell.getRow();row instanceof RowComponent?(checkbox.addEventListener("change",(function(e){"click"===_this80.table.options.selectableRangeMode&&blocked?blocked=!1:row.toggleSelect()})),"click"===this.table.options.selectableRangeMode&&checkbox.addEventListener("click",(function(e){blocked=!0,_this80.table.modules.selectRow.handleComplexRowClick(row._row,e)})),checkbox.checked=row.isSelected&&row.isSelected(),this.table.modules.selectRow.registerRowSelectCheckbox(row,checkbox)):checkbox=""}else checkbox.addEventListener("change",(function(e){_this80.table.modules.selectRow.selectedRows.length?_this80.table.deselectRow():_this80.table.selectRow(formatterParams.rowRange)})),this.table.modules.selectRow.registerHeaderSelectCheckbox(checkbox);return checkbox}},Format=function(_Module10){_inherits(Format,_Module10);var _super15=_createSuper(Format);function Format(table){var _this81;return _classCallCheck(this,Format),(_this81=_super15.call(this,table)).registerColumnOption("formatter"),_this81.registerColumnOption("formatterParams"),_this81.registerColumnOption("formatterPrint"),_this81.registerColumnOption("formatterPrintParams"),_this81.registerColumnOption("formatterClipboard"),_this81.registerColumnOption("formatterClipboardParams"),_this81.registerColumnOption("formatterHtmlOutput"),_this81.registerColumnOption("formatterHtmlOutputParams"),_this81.registerColumnOption("titleFormatter"),_this81.registerColumnOption("titleFormatterParams"),_this81}return _createClass(Format,[{key:"initialize",value:function(){this.subscribe("cell-format",this.formatValue.bind(this)),this.subscribe("cell-rendered",this.cellRendered.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-format",this.formatHeader.bind(this))}},{key:"initializeColumn",value:function(column){column.modules.format=this.lookupFormatter(column,""),void 0!==column.definition.formatterPrint&&(column.modules.format.print=this.lookupFormatter(column,"Print")),void 0!==column.definition.formatterClipboard&&(column.modules.format.clipboard=this.lookupFormatter(column,"Clipboard")),void 0!==column.definition.formatterHtmlOutput&&(column.modules.format.htmlOutput=this.lookupFormatter(column,"HtmlOutput"))}},{key:"lookupFormatter",value:function(column,type){var config={params:column.definition["formatter"+type+"Params"]||{}},formatter=column.definition["formatter"+type];switch(_typeof(formatter)){case"string":Format.formatters[formatter]?config.formatter=Format.formatters[formatter]:(console.warn("Formatter Error - No such formatter found: ",formatter),config.formatter=Format.formatters.plaintext);break;case"function":config.formatter=formatter;break;default:config.formatter=Format.formatters.plaintext}return config}},{key:"cellRendered",value:function(cell){cell.modules.format&&cell.modules.format.renderedCallback&&!cell.modules.format.rendered&&(cell.modules.format.renderedCallback(),cell.modules.format.rendered=!0)}},{key:"formatHeader",value:function(column,title,el){var formatter,params,onRendered,mockCell,_this82=this;return column.definition.titleFormatter?(formatter=this.getFormatter(column.definition.titleFormatter),onRendered=function(callback){column.titleFormatterRendered=callback},mockCell={getValue:function(){return title},getElement:function(){return el},getColumn:function(){return column.getComponent()},getTable:function(){return _this82.table}},params="function"==typeof(params=column.definition.titleFormatterParams||{})?params():params,formatter.call(this,mockCell,params,onRendered)):title}},{key:"formatValue",value:function(cell){var component=cell.getComponent(),params="function"==typeof cell.column.modules.format.params?cell.column.modules.format.params(component):cell.column.modules.format.params;return cell.column.modules.format.formatter.call(this,component,params,(function(callback){cell.modules.format||(cell.modules.format={}),cell.modules.format.renderedCallback=callback,cell.modules.format.rendered=!1}))}},{key:"formatExportValue",value:function(cell,type){var params,formatter=cell.column.modules.format[type];if(formatter){return params="function"==typeof formatter.params?formatter.params(cell.getComponent()):formatter.params,formatter.formatter.call(this,cell.getComponent(),params,(function(callback){cell.modules.format||(cell.modules.format={}),cell.modules.format.renderedCallback=callback,cell.modules.format.rendered=!1}))}return this.formatValue(cell)}},{key:"sanitizeHTML",value:function(value){if(value){var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(value).replace(/[&<>"'`=/]/g,(function(s){return entityMap[s]}))}return value}},{key:"emptyToSpace",value:function(value){return null==value||""===value?"&nbsp;":value}},{key:"getFormatter",value:function(formatter){switch(_typeof(formatter)){case"string":Format.formatters[formatter]?formatter=Format.formatters[formatter]:(console.warn("Formatter Error - No such formatter found: ",formatter),formatter=Format.formatters.plaintext);break;case"function":break;default:formatter=Format.formatters.plaintext}return formatter}}]),Format}(Module);_exports.FormatModule=Format,Format.moduleName="format",Format.formatters=defaultFormatters;var FrozenColumns=function(_Module11){_inherits(FrozenColumns,_Module11);var _super16=_createSuper(FrozenColumns);function FrozenColumns(table){var _this83;return _classCallCheck(this,FrozenColumns),(_this83=_super16.call(this,table)).leftColumns=[],_this83.rightColumns=[],_this83.initializationMode="left",_this83.active=!1,_this83.blocked=!0,_this83.registerColumnOption("frozen"),_this83}return _createClass(FrozenColumns,[{key:"reset",value:function(){this.initializationMode="left",this.leftColumns=[],this.rightColumns=[],this.active=!1}},{key:"initialize",value:function(){this.subscribe("cell-layout",this.layoutCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-width",this.layout.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("table-layout",this.layout.bind(this)),this.subscribe("columns-loading",this.reset.bind(this)),this.subscribe("column-add",this.reinitializeColumns.bind(this)),this.subscribe("column-delete",this.reinitializeColumns.bind(this)),this.subscribe("table-redraw",this.layout.bind(this)),this.subscribe("layout-refreshing",this.blockLayout.bind(this)),this.subscribe("layout-refreshed",this.unblockLayout.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this))}},{key:"blockLayout",value:function(){this.blocked=!0}},{key:"unblockLayout",value:function(){this.blocked=!1}},{key:"layoutCell",value:function(cell){this.layoutElement(cell.element,cell.column)}},{key:"reinitializeColumns",value:function(){var _this84=this;this.reset(),this.table.columnManager.columnsByIndex.forEach((function(column){_this84.initializeColumn(column)}))}},{key:"initializeColumn",value:function(column){var config={margin:0,edge:!1};column.isGroup||(this.frozenCheck(column)?(config.position=this.initializationMode,"left"==this.initializationMode?this.leftColumns.push(column):this.rightColumns.unshift(column),this.active=!0,column.modules.frozen=config):this.initializationMode="right")}},{key:"frozenCheck",value:function(column){return column.parent.isGroup&&column.definition.frozen&&console.warn("Frozen Column Error - Parent column group must be frozen, not individual columns or sub column groups"),column.parent.isGroup?this.frozenCheck(column.parent):column.definition.frozen}},{key:"layoutCalcRows",value:function(){this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&this.table.modules.columnCalcs.topRow&&this.layoutRow(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&this.table.modules.columnCalcs.botRow&&this.layoutRow(this.table.modules.columnCalcs.botRow),this.table.modExists("groupRows")&&this.layoutGroupCalcs(this.table.modules.groupRows.getGroups()))}},{key:"layoutGroupCalcs",value:function(groups){var _this85=this;groups.forEach((function(group){group.calcs.top&&_this85.layoutRow(group.calcs.top),group.calcs.bottom&&_this85.layoutRow(group.calcs.bottom),group.groupList&&group.groupList.length&&_this85.layoutGroupCalcs(group.groupList)}))}},{key:"layoutColumnPosition",value:function(allCells){var _this86=this,leftParents=[],leftMargin=0,rightMargin=0;this.leftColumns.forEach((function(column,i){if(column.modules.frozen.marginValue=leftMargin,column.modules.frozen.margin=column.modules.frozen.marginValue+"px",column.visible&&(leftMargin+=column.getWidth()),i==_this86.leftColumns.length-1?column.modules.frozen.edge=!0:column.modules.frozen.edge=!1,column.parent.isGroup){var parentEl=_this86.getColGroupParentElement(column);leftParents.includes(parentEl)||(_this86.layoutElement(parentEl,column),leftParents.push(parentEl)),column.modules.frozen.edge&&parentEl.classList.add("tabulator-frozen-"+column.modules.frozen.position)}else _this86.layoutElement(column.getElement(),column);allCells&&column.cells.forEach((function(cell){_this86.layoutElement(cell.getElement(!0),column)}))})),this.rightColumns.forEach((function(column,i){column.modules.frozen.marginValue=rightMargin,column.modules.frozen.margin=column.modules.frozen.marginValue+"px",column.visible&&(rightMargin+=column.getWidth()),i==_this86.rightColumns.length-1?column.modules.frozen.edge=!0:column.modules.frozen.edge=!1,column.parent.isGroup?_this86.layoutElement(_this86.getColGroupParentElement(column),column):_this86.layoutElement(column.getElement(),column),allCells&&column.cells.forEach((function(cell){_this86.layoutElement(cell.getElement(!0),column)}))}))}},{key:"getColGroupParentElement",value:function(column){return column.parent.isGroup?this.getColGroupParentElement(column.parent):column.getElement()}},{key:"layout",value:function(){this.active&&!this.blocked&&(this.layoutColumnPosition(),this.reinitializeRows(),this.layoutCalcRows())}},{key:"reinitializeRows",value:function(){var _this87=this,visibleRows=this.table.rowManager.getVisibleRows(!0);this.table.rowManager.getRows().filter((function(row){return!visibleRows.includes(row)})).forEach((function(row){row.deinitialize()})),visibleRows.forEach((function(row){"row"===row.type&&_this87.layoutRow(row)}))}},{key:"layoutRow",value:function(row){var _this88=this;"fitDataFill"===this.table.options.layout&&this.rightColumns.length&&(this.table.rowManager.getTableElement().style.minWidth="calc(100% - "+this.rightMargin+")"),this.leftColumns.forEach((function(column){var cell=row.getCell(column);cell&&_this88.layoutElement(cell.getElement(!0),column)})),this.rightColumns.forEach((function(column){var cell=row.getCell(column);cell&&_this88.layoutElement(cell.getElement(!0),column)}))}},{key:"layoutElement",value:function(element,column){var position;column.modules.frozen&&(element.style.position="sticky",position=this.table.rtl?"left"===column.modules.frozen.position?"right":"left":column.modules.frozen.position,element.style[position]=column.modules.frozen.margin,element.classList.add("tabulator-frozen"),column.modules.frozen.edge&&element.classList.add("tabulator-frozen-"+column.modules.frozen.position))}},{key:"adjustForScrollbar",value:function(width){this.rightColumns.length&&(this.table.columnManager.getContentsElement().style.width="calc(100% - "+width+"px)")}},{key:"_calcSpace",value:function(columns,index){for(var width=0,i=0;i<index;i++)columns[i].visible&&(width+=columns[i].getWidth());return width}}]),FrozenColumns}(Module);_exports.FrozenColumnsModule=FrozenColumns,FrozenColumns.moduleName="frozenColumns";var FrozenRows=function(_Module12){_inherits(FrozenRows,_Module12);var _super17=_createSuper(FrozenRows);function FrozenRows(table){var _this89;return _classCallCheck(this,FrozenRows),(_this89=_super17.call(this,table)).topElement=document.createElement("div"),_this89.rows=[],_this89.registerComponentFunction("row","freeze",_this89.freezeRow.bind(_assertThisInitialized(_this89))),_this89.registerComponentFunction("row","unfreeze",_this89.unfreezeRow.bind(_assertThisInitialized(_this89))),_this89.registerComponentFunction("row","isFrozen",_this89.isRowFrozen.bind(_assertThisInitialized(_this89))),_this89.registerTableOption("frozenRowsField","id"),_this89.registerTableOption("frozenRows",!1),_this89}return _createClass(FrozenRows,[{key:"initialize",value:function(){this.rows=[],this.topElement.classList.add("tabulator-frozen-rows-holder"),this.table.columnManager.getContentsElement().insertBefore(this.topElement,this.table.columnManager.headersElement.nextSibling),this.subscribe("row-deleting",this.detachRow.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),10),this.table.options.frozenRows&&(this.subscribe("data-processed",this.initializeRows.bind(this)),this.subscribe("row-added",this.initializeRow.bind(this)))}},{key:"initializeRows",value:function(){var _this90=this;this.table.rowManager.getRows().forEach((function(row){_this90.initializeRow(row)}))}},{key:"initializeRow",value:function(row){var frozenRows=this.table.options.frozenRows,rowType=_typeof(frozenRows);"number"===rowType?row.getPosition()&&row.getPosition()+this.rows.length<=frozenRows&&this.freezeRow(row):"function"===rowType?frozenRows.call(this.table,row.getComponent())&&this.freezeRow(row):Array.isArray(frozenRows)&&frozenRows.includes(row.data[this.options("frozenRowsField")])&&this.freezeRow(row)}},{key:"isRowFrozen",value:function(row){return this.rows.indexOf(row)>-1}},{key:"isFrozen",value:function(){return!!this.rows.length}},{key:"visibleRows",value:function(viewable,rows){return this.rows.forEach((function(row){rows.push(row)})),rows}},{key:"getRows",value:function(rows){var output=rows.slice(0);return this.rows.forEach((function(row){var index=output.indexOf(row);index>-1&&output.splice(index,1)})),output}},{key:"freezeRow",value:function(row){row.modules.frozen?console.warn("Freeze Error - Row is already frozen"):(row.modules.frozen=!0,this.topElement.appendChild(row.getElement()),row.initialize(),row.normalizeHeight(),this.rows.push(row),this.refreshData(!1,"display"),this.table.rowManager.adjustTableSize(),this.styleRows())}},{key:"unfreezeRow",value:function(row){row.modules.frozen?(row.modules.frozen=!1,this.detachRow(row),this.table.rowManager.adjustTableSize(),this.refreshData(!1,"display"),this.rows.length&&this.styleRows()):console.warn("Freeze Error - Row is already unfrozen")}},{key:"detachRow",value:function(row){var index=this.rows.indexOf(row);if(index>-1){var rowEl=row.getElement();rowEl.parentNode&&rowEl.parentNode.removeChild(rowEl),this.rows.splice(index,1)}}},{key:"styleRows",value:function(row){var _this91=this;this.rows.forEach((function(row,i){_this91.table.rowManager.styleRow(row,i)}))}}]),FrozenRows}(Module);_exports.FrozenRowsModule=FrozenRows,FrozenRows.moduleName="frozenRows";var GroupComponent=function(){function GroupComponent(group){return _classCallCheck(this,GroupComponent),this._group=group,this.type="GroupComponent",new Proxy(this,{get:function(target,name,receiver){return void 0!==target[name]?target[name]:target._group.groupManager.table.componentFunctionBinder.handle("row",target._group,name)}})}return _createClass(GroupComponent,[{key:"getKey",value:function(){return this._group.key}},{key:"getField",value:function(){return this._group.field}},{key:"getElement",value:function(){return this._group.element}},{key:"getRows",value:function(){return this._group.getRows(!0)}},{key:"getSubGroups",value:function(){return this._group.getSubGroups(!0)}},{key:"getParentGroup",value:function(){return!!this._group.parent&&this._group.parent.getComponent()}},{key:"isVisible",value:function(){return this._group.visible}},{key:"show",value:function(){this._group.show()}},{key:"hide",value:function(){this._group.hide()}},{key:"toggle",value:function(){this._group.toggleVisibility()}},{key:"_getSelf",value:function(){return this._group}},{key:"getTable",value:function(){return this._group.groupManager.table}}]),GroupComponent}();_exports.GroupComponent=GroupComponent;var Group=function(){function Group(groupManager,parent,level,key,field,generator,oldGroup){_classCallCheck(this,Group),this.groupManager=groupManager,this.parent=parent,this.key=key,this.level=level,this.field=field,this.hasSubGroups=level<groupManager.groupIDLookups.length-1,this.addRow=this.hasSubGroups?this._addRowToGroup:this._addRow,this.type="group",this.old=oldGroup,this.rows=[],this.groups=[],this.groupList=[],this.generator=generator,this.element=!1,this.elementContents=!1,this.height=0,this.outerHeight=0,this.initialized=!1,this.calcs={},this.initialized=!1,this.modules={},this.arrowElement=!1,this.visible=oldGroup?oldGroup.visible:void 0!==groupManager.startOpen[level]?groupManager.startOpen[level]:groupManager.startOpen[0],this.component=null,this.createElements(),this.addBindings(),this.createValueGroups()}return _createClass(Group,[{key:"wipe",value:function(elementsOnly){elementsOnly||(this.groupList.length?this.groupList.forEach((function(group){group.wipe()})):this.rows.forEach((function(row){row.modules&&delete row.modules.group}))),this.element=!1,this.arrowElement=!1,this.elementContents=!1}},{key:"createElements",value:function(){var arrow=document.createElement("div");arrow.classList.add("tabulator-arrow"),this.element=document.createElement("div"),this.element.classList.add("tabulator-row"),this.element.classList.add("tabulator-group"),this.element.classList.add("tabulator-group-level-"+this.level),this.element.setAttribute("role","rowgroup"),this.arrowElement=document.createElement("div"),this.arrowElement.classList.add("tabulator-group-toggle"),this.arrowElement.appendChild(arrow),!1!==this.groupManager.table.options.movableRows&&this.groupManager.table.modExists("moveRow")&&this.groupManager.table.modules.moveRow.initializeGroupHeader(this)}},{key:"createValueGroups",value:function(){var _this92=this,level=this.level+1;this.groupManager.allowedValues&&this.groupManager.allowedValues[level]&&this.groupManager.allowedValues[level].forEach((function(value){_this92._createGroup(value,level)}))}},{key:"addBindings",value:function(){var _this93=this;this.groupManager.table.options.groupToggleElement&&("arrow"==this.groupManager.table.options.groupToggleElement?this.arrowElement:this.element).addEventListener("click",(function(e){e.stopPropagation(),e.stopImmediatePropagation(),_this93.toggleVisibility()}))}},{key:"_createGroup",value:function(groupID,level){var groupKey=level+"_"+groupID,group=new Group(this.groupManager,this,level,groupID,this.groupManager.groupIDLookups[level].field,this.groupManager.headerGenerator[level]||this.groupManager.headerGenerator[0],!!this.old&&this.old.groups[groupKey]);this.groups[groupKey]=group,this.groupList.push(group)}},{key:"_addRowToGroup",value:function(row){var level=this.level+1;if(this.hasSubGroups){var groupID=this.groupManager.groupIDLookups[level].func(row.getData()),groupKey=level+"_"+groupID;this.groupManager.allowedValues&&this.groupManager.allowedValues[level]?this.groups[groupKey]&&this.groups[groupKey].addRow(row):(this.groups[groupKey]||this._createGroup(groupID,level),this.groups[groupKey].addRow(row))}}},{key:"_addRow",value:function(row){this.rows.push(row),row.modules.group=this}},{key:"insertRow",value:function(row,to,after){var data=this.conformRowData({});row.updateData(data);var toIndex=this.rows.indexOf(to);toIndex>-1?after?this.rows.splice(toIndex+1,0,row):this.rows.splice(toIndex,0,row):after?this.rows.push(row):this.rows.unshift(row),row.modules.group=this,this.generateGroupHeaderContents(),this.groupManager.table.modExists("columnCalcs")&&"table"!=this.groupManager.table.options.columnCalcs&&this.groupManager.table.modules.columnCalcs.recalcGroup(this),this.groupManager.updateGroupRows(!0)}},{key:"scrollHeader",value:function(left){this.arrowElement&&(this.arrowElement.style.marginLeft=left,this.groupList.forEach((function(child){child.scrollHeader(left)})))}},{key:"getRowIndex",value:function(row){}},{key:"conformRowData",value:function(data){return this.field?data[this.field]=this.key:console.warn("Data Conforming Error - Cannot conform row data to match new group as groupBy is a function"),this.parent&&(data=this.parent.conformRowData(data)),data}},{key:"removeRow",value:function(row){var index=this.rows.indexOf(row),el=row.getElement();index>-1&&this.rows.splice(index,1),this.groupManager.table.options.groupValues||this.rows.length?(el.parentNode&&el.parentNode.removeChild(el),this.generateGroupHeaderContents(),this.groupManager.table.modExists("columnCalcs")&&"table"!=this.groupManager.table.options.columnCalcs&&this.groupManager.table.modules.columnCalcs.recalcGroup(this)):(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this),this.groupManager.updateGroupRows(!0))}},{key:"removeGroup",value:function(group){var index,groupKey=group.level+"_"+group.key;this.groups[groupKey]&&(delete this.groups[groupKey],(index=this.groupList.indexOf(group))>-1&&this.groupList.splice(index,1),this.groupList.length||(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this)))}},{key:"getHeadersAndRows",value:function(){var output=[];return output.push(this),this._visSet(),this.calcs.top&&(this.calcs.top.detachElement(),this.calcs.top.deleteCells()),this.calcs.bottom&&(this.calcs.bottom.detachElement(),this.calcs.bottom.deleteCells()),this.visible?this.groupList.length?this.groupList.forEach((function(group){output=output.concat(group.getHeadersAndRows())})):("table"!=this.groupManager.table.options.columnCalcs&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),output.push(this.calcs.top)),output=output.concat(this.rows),"table"!=this.groupManager.table.options.columnCalcs&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),output.push(this.calcs.bottom))):this.groupList.length||"table"==this.groupManager.table.options.columnCalcs||this.groupManager.table.modExists("columnCalcs")&&(this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),output.push(this.calcs.top)),this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),output.push(this.calcs.bottom))),output}},{key:"getData",value:function(visible,transform){var output=[];return this._visSet(),(!visible||visible&&this.visible)&&this.rows.forEach((function(row){output.push(row.getData(transform||"data"))})),output}},{key:"getRowCount",value:function(){var count=0;return this.groupList.length?this.groupList.forEach((function(group){count+=group.getRowCount()})):count=this.rows.length,count}},{key:"toggleVisibility",value:function(){this.visible?this.hide():this.show()}},{key:"hide",value:function(){this.visible=!1,"basic"!=this.groupManager.table.rowManager.getRenderMode()||this.groupManager.table.options.pagination||(this.element.classList.remove("tabulator-group-visible"),this.groupList.length?this.groupList.forEach((function(group){group.getHeadersAndRows().forEach((function(row){row.detachElement()}))})):this.rows.forEach((function(row){var rowEl=row.getElement();rowEl.parentNode.removeChild(rowEl)}))),this.groupManager.updateGroupRows(!0),this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!1)}},{key:"show",value:function(){if(this.visible=!0,"basic"!=this.groupManager.table.rowManager.getRenderMode()||this.groupManager.table.options.pagination)this.groupManager.updateGroupRows(!0);else{this.element.classList.add("tabulator-group-visible");var prev=this.generateElement();this.groupList.length?this.groupList.forEach((function(group){group.getHeadersAndRows().forEach((function(row){var rowEl=row.getElement();prev.parentNode.insertBefore(rowEl,prev.nextSibling),row.initialize(),prev=rowEl}))})):this.rows.forEach((function(row){var rowEl=row.getElement();prev.parentNode.insertBefore(rowEl,prev.nextSibling),row.initialize(),prev=rowEl})),this.groupManager.updateGroupRows(!0)}this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!0)}},{key:"_visSet",value:function(){var data=[];"function"==typeof this.visible&&(this.rows.forEach((function(row){data.push(row.getData())})),this.visible=this.visible(this.key,this.getRowCount(),data,this.getComponent()))}},{key:"getRowGroup",value:function(row){var match=!1;return this.groupList.length?this.groupList.forEach((function(group){var result=group.getRowGroup(row);result&&(match=result)})):this.rows.find((function(item){return item===row}))&&(match=this),match}},{key:"getSubGroups",value:function(component){var output=[];return this.groupList.forEach((function(child){output.push(component?child.getComponent():child)})),output}},{key:"getRows",value:function(component){var output=[];return this.rows.forEach((function(row){output.push(component?row.getComponent():row)})),output}},{key:"generateGroupHeaderContents",value:function(){var data=[];for(this.rows.forEach((function(row){data.push(row.getData())})),this.elementContents=this.generator(this.key,this.getRowCount(),data,this.getComponent());this.element.firstChild;)this.element.removeChild(this.element.firstChild);"string"==typeof this.elementContents?this.element.innerHTML=this.elementContents:this.element.appendChild(this.elementContents),this.element.insertBefore(this.arrowElement,this.element.firstChild)}},{key:"getPath",value:function(){var path=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return path.unshift(this.key),this.parent&&this.parent.getPath(path),path}},{key:"getElement",value:function(){return this.elementContents?this.element:this.generateElement()}},{key:"generateElement",value:function(){this.addBindings=!1,this._visSet(),this.visible?this.element.classList.add("tabulator-group-visible"):this.element.classList.remove("tabulator-group-visible");for(var i=0;i<this.element.childNodes.length;++i)this.element.childNodes[i].parentNode.removeChild(this.element.childNodes[i]);return this.generateGroupHeaderContents(),this.element}},{key:"detachElement",value:function(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}},{key:"normalizeHeight",value:function(){this.setHeight(this.element.clientHeight)}},{key:"initialize",value:function(force){this.initialized&&!force||(this.normalizeHeight(),this.initialized=!0)}},{key:"reinitialize",value:function(){this.initialized=!1,this.height=0,Helpers.elVisible(this.element)&&this.initialize(!0)}},{key:"setHeight",value:function(height){this.height!=height&&(this.height=height,this.outerHeight=this.element.offsetHeight)}},{key:"getHeight",value:function(){return this.outerHeight}},{key:"getGroup",value:function(){return this}},{key:"reinitializeHeight",value:function(){}},{key:"calcHeight",value:function(){}},{key:"setCellHeight",value:function(){}},{key:"clearCellHeight",value:function(){}},{key:"deinitializeHeight",value:function(){}},{key:"getComponent",value:function(){return this.component||(this.component=new GroupComponent(this)),this.component}}]),Group}(),GroupRows=function(_Module13){_inherits(GroupRows,_Module13);var _super18=_createSuper(GroupRows);function GroupRows(table){var _this94;return _classCallCheck(this,GroupRows),(_this94=_super18.call(this,table)).groupIDLookups=!1,_this94.startOpen=[function(){return!1}],_this94.headerGenerator=[function(){return""}],_this94.groupList=[],_this94.allowedValues=!1,_this94.groups={},_this94.displayHandler=_this94.getRows.bind(_assertThisInitialized(_this94)),_this94.registerTableOption("groupBy",!1),_this94.registerTableOption("groupStartOpen",!0),_this94.registerTableOption("groupValues",!1),_this94.registerTableOption("groupUpdateOnCellEdit",!1),_this94.registerTableOption("groupHeader",!1),_this94.registerTableOption("groupHeaderPrint",null),_this94.registerTableOption("groupHeaderClipboard",null),_this94.registerTableOption("groupHeaderHtmlOutput",null),_this94.registerTableOption("groupHeaderDownload",null),_this94.registerTableOption("groupToggleElement","arrow"),_this94.registerTableOption("groupClosedShowCalcs",!1),_this94.registerTableFunction("setGroupBy",_this94.setGroupBy.bind(_assertThisInitialized(_this94))),_this94.registerTableFunction("setGroupValues",_this94.setGroupValues.bind(_assertThisInitialized(_this94))),_this94.registerTableFunction("setGroupStartOpen",_this94.setGroupStartOpen.bind(_assertThisInitialized(_this94))),_this94.registerTableFunction("setGroupHeader",_this94.setGroupHeader.bind(_assertThisInitialized(_this94))),_this94.registerTableFunction("getGroups",_this94.userGetGroups.bind(_assertThisInitialized(_this94))),_this94.registerTableFunction("getGroupedData",_this94.userGetGroupedData.bind(_assertThisInitialized(_this94))),_this94.registerComponentFunction("row","getGroup",_this94.rowGetGroup.bind(_assertThisInitialized(_this94))),_this94}return _createClass(GroupRows,[{key:"initialize",value:function(){this.table.options.groupBy&&(this.table.options.groupUpdateOnCellEdit&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("row-data-changed",this.reassignRowToGroup.bind(this),0)),this.subscribe("table-built",this.configureGroupSetup.bind(this)),this.subscribe("row-deleting",this.rowDeleting.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHeaders.bind(this)),this.subscribe("rows-wipe",this.wipe.bind(this)),this.subscribe("rows-added",this.rowsUpdated.bind(this)),this.subscribe("row-moving",this.rowMoving.bind(this)),this.subscribe("row-adding-index",this.rowAddingIndex.bind(this)),this.subscribe("rows-sample",this.rowSample.bind(this)),this.subscribe("render-virtual-fill",this.virtualRenderFill.bind(this)),this.registerDisplayHandler(this.displayHandler,20),this.initialized=!0)}},{key:"configureGroupSetup",value:function(){var _this95=this;if(this.table.options.groupBy){var groupBy=this.table.options.groupBy,startOpen=this.table.options.groupStartOpen,groupHeader=this.table.options.groupHeader;if(this.allowedValues=this.table.options.groupValues,Array.isArray(groupBy)&&Array.isArray(groupHeader)&&groupBy.length>groupHeader.length&&console.warn("Error creating group headers, groupHeader array is shorter than groupBy array"),this.headerGenerator=[function(){return""}],this.startOpen=[function(){return!1}],this.langBind("groups|item",(function(langValue,lang){_this95.headerGenerator[0]=function(value,count,data){return(void 0===value?"":value)+"<span>("+count+" "+(1===count?langValue:lang.groups.items)+")</span>"}})),this.groupIDLookups=[],groupBy)this.table.modExists("columnCalcs")&&"table"!=this.table.options.columnCalcs&&"both"!=this.table.options.columnCalcs&&this.table.modules.columnCalcs.removeCalcs();else if(this.table.modExists("columnCalcs")&&"group"!=this.table.options.columnCalcs)this.table.columnManager.getRealColumns().forEach((function(col){col.definition.topCalc&&_this95.table.modules.columnCalcs.initializeTopRow(),col.definition.bottomCalc&&_this95.table.modules.columnCalcs.initializeBottomRow()}));Array.isArray(groupBy)||(groupBy=[groupBy]),groupBy.forEach((function(group,i){var lookupFunc,column;lookupFunc="function"==typeof group?group:(column=_this95.table.columnManager.getColumnByField(group))?function(data){return column.getFieldValue(data)}:function(data){return data[group]},_this95.groupIDLookups.push({field:"function"!=typeof group&&group,func:lookupFunc,values:!!_this95.allowedValues&&_this95.allowedValues[i]})})),startOpen&&(Array.isArray(startOpen)||(startOpen=[startOpen]),startOpen.forEach((function(level){})),this.startOpen=startOpen),groupHeader&&(this.headerGenerator=Array.isArray(groupHeader)?groupHeader:[groupHeader])}else this.groupList=[],this.groups={}}},{key:"rowSample",value:function(rows,prevValue){if(this.table.options.groupBy){var group=this.getGroups(!1)[0];prevValue.push(group.getRows(!1)[0])}return prevValue}},{key:"virtualRenderFill",value:function(){var el=this.table.rowManager.tableElement,rows=this.table.rowManager.getVisibleRows();if(!this.table.options.groupBy)return rows;rows=rows.filter((function(row){return"group"!==row.type})),el.style.minWidth=rows.length?"":this.table.columnManager.getWidth()+"px"}},{key:"rowAddingIndex",value:function(row,index,top){if(this.table.options.groupBy){this.assignRowToGroup(row);var groupRows=row.modules.group.rows;return groupRows.length>1&&(!index||index&&-1==groupRows.indexOf(index)?top?groupRows[0]!==row&&(index=groupRows[0],this.table.rowManager.moveRowInArray(row.modules.group.rows,row,index,!top)):groupRows[groupRows.length-1]!==row&&(index=groupRows[groupRows.length-1],this.table.rowManager.moveRowInArray(row.modules.group.rows,row,index,!top)):this.table.rowManager.moveRowInArray(row.modules.group.rows,row,index,!top)),index}}},{key:"trackChanges",value:function(){this.dispatch("group-changed")}},{key:"setGroupBy",value:function(groups){this.table.options.groupBy=groups,this.initialized||this.initialize(),this.configureGroupSetup(),!groups&&this.table.modExists("columnCalcs")&&!0===this.table.options.columnCalcs&&this.table.modules.columnCalcs.reinitializeCalcs(),this.refreshData(),this.trackChanges()}},{key:"setGroupValues",value:function(groupValues){this.table.options.groupValues=groupValues,this.configureGroupSetup(),this.refreshData(),this.trackChanges()}},{key:"setGroupStartOpen",value:function(values){this.table.options.groupStartOpen=values,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}},{key:"setGroupHeader",value:function(values){this.table.options.groupHeader=values,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}},{key:"userGetGroups",value:function(values){return this.getGroups(!0)}},{key:"userGetGroupedData",value:function(){return this.table.options.groupBy?this.getGroupedData():this.getData()}},{key:"rowGetGroup",value:function(row){return!!row.modules.group&&row.modules.group.getComponent()}},{key:"rowMoving",value:function(from,to,after){if(this.table.options.groupBy){!after&&to instanceof Group&&(to=this.table.rowManager.prevDisplayRow(from)||to);var toGroup=to instanceof Group?to:to.modules.group,fromGroup=from instanceof Group?from:from.modules.group;toGroup===fromGroup?this.table.rowManager.moveRowInArray(toGroup.rows,from,to,after):(fromGroup&&fromGroup.removeRow(from),toGroup.insertRow(from,to,after))}}},{key:"rowDeleting",value:function(row){this.table.options.groupBy&&row.modules.group&&row.modules.group.removeRow(row)}},{key:"rowsUpdated",value:function(row){this.table.options.groupBy&&this.updateGroupRows(!0)}},{key:"cellUpdated",value:function(cell){this.table.options.groupBy&&this.reassignRowToGroup(cell.row)}},{key:"getRows",value:function(rows){return this.table.options.groupBy&&this.groupIDLookups.length?(this.dispatchExternal("dataGrouping"),this.generateGroups(rows),this.subscribedExternal("dataGrouped")&&this.dispatchExternal("dataGrouped",this.getGroups(!0)),this.updateGroupRows()):rows.slice(0)}},{key:"getGroups",value:function(component){var groupComponents=[];return this.groupList.forEach((function(group){groupComponents.push(component?group.getComponent():group)})),groupComponents}},{key:"getChildGroups",value:function(group){var _this96=this,groupComponents=[];return group||(group=this),group.groupList.forEach((function(child){child.groupList.length?groupComponents=groupComponents.concat(_this96.getChildGroups(child)):groupComponents.push(child)})),groupComponents}},{key:"wipe",value:function(){this.table.options.groupBy&&(this.groupList.forEach((function(group){group.wipe()})),this.groupList=[],this.groups={})}},{key:"pullGroupListData",value:function(groupList){var _this97=this,groupListData=[];return groupList.forEach((function(group){var groupHeader={level:0,rowCount:0,headerContent:""},childData=[];group.hasSubGroups?(childData=_this97.pullGroupListData(group.groupList),groupHeader.level=group.level,groupHeader.rowCount=childData.length-group.groupList.length,groupHeader.headerContent=group.generator(group.key,groupHeader.rowCount,group.rows,group),groupListData.push(groupHeader),groupListData=groupListData.concat(childData)):(groupHeader.level=group.level,groupHeader.headerContent=group.generator(group.key,group.rows.length,group.rows,group),groupHeader.rowCount=group.getRows().length,groupListData.push(groupHeader),group.getRows().forEach((function(row){groupListData.push(row.getData("data"))})))})),groupListData}},{key:"getGroupedData",value:function(){return this.pullGroupListData(this.groupList)}},{key:"getRowGroup",value:function(row){var match=!1;return this.options("dataTree")&&(row=this.table.modules.dataTree.getTreeParentRoot(row)),this.groupList.forEach((function(group){var result=group.getRowGroup(row);result&&(match=result)})),match}},{key:"countGroups",value:function(){return this.groupList.length}},{key:"generateGroups",value:function(rows){var _this98=this,oldGroups=this.groups;this.groups={},this.groupList=[],this.allowedValues&&this.allowedValues[0]?(this.allowedValues[0].forEach((function(value){_this98.createGroup(value,0,oldGroups)})),rows.forEach((function(row){_this98.assignRowToExistingGroup(row,oldGroups)}))):rows.forEach((function(row){_this98.assignRowToGroup(row,oldGroups)})),Object.values(oldGroups).forEach((function(group){group.wipe(!0)}))}},{key:"createGroup",value:function(groupID,level,oldGroups){var group,groupKey=level+"_"+groupID;oldGroups=oldGroups||[],group=new Group(this,!1,level,groupID,this.groupIDLookups[0].field,this.headerGenerator[0],oldGroups[groupKey]),this.groups[groupKey]=group,this.groupList.push(group)}},{key:"assignRowToExistingGroup",value:function(row,oldGroups){var groupKey="0_"+this.groupIDLookups[0].func(row.getData());this.groups[groupKey]&&this.groups[groupKey].addRow(row)}},{key:"assignRowToGroup",value:function(row,oldGroups){var groupID=this.groupIDLookups[0].func(row.getData()),newGroupNeeded=!this.groups["0_"+groupID];return newGroupNeeded&&this.createGroup(groupID,0,oldGroups),this.groups["0_"+groupID].addRow(row),!newGroupNeeded}},{key:"reassignRowToGroup",value:function(row){if("row"===row.type){var oldRowGroup=row.modules.group,oldGroupPath=oldRowGroup.getPath(),newGroupPath=this.getExpectedPath(row);oldGroupPath.length==newGroupPath.length&&oldGroupPath.every((function(element,index){return element===newGroupPath[index]}))||(oldRowGroup.removeRow(row),this.assignRowToGroup(row,this.groups),this.refreshData(!0))}}},{key:"getExpectedPath",value:function(row){var groupPath=[],rowData=row.getData();return this.groupIDLookups.forEach((function(groupId){groupPath.push(groupId.func(rowData))})),groupPath}},{key:"updateGroupRows",value:function(force){var output=[];return this.groupList.forEach((function(group){output=output.concat(group.getHeadersAndRows())})),force&&this.refreshData(!0,this.displayHandler),output}},{key:"scrollHeaders",value:function(left){this.table.options.groupBy&&("virtual"===this.table.options.renderHorizontal&&(left-=this.table.columnManager.renderer.vDomPadLeft),left+="px",this.groupList.forEach((function(group){group.scrollHeader(left)})))}},{key:"removeGroup",value:function(group){var index,groupKey=group.level+"_"+group.key;this.groups[groupKey]&&(delete this.groups[groupKey],(index=this.groupList.indexOf(group))>-1&&this.groupList.splice(index,1))}},{key:"checkBasicModeGroupHeaderWidth",value:function(){var _this99=this,element=this.table.rowManager.tableElement,onlyGroupHeaders=!0;this.table.rowManager.getDisplayRows().forEach((function(row,index){_this99.table.rowManager.styleRow(row,index),element.appendChild(row.getElement()),row.initialize(!0),"group"!==row.type&&(onlyGroupHeaders=!1)})),element.style.minWidth=onlyGroupHeaders?this.table.columnManager.getWidth()+"px":""}}]),GroupRows}(Module);_exports.GroupRowsModule=GroupRows,GroupRows.moduleName="groupRows";var History=function(_Module14){_inherits(History,_Module14);var _super19=_createSuper(History);function History(table){var _this100;return _classCallCheck(this,History),(_this100=_super19.call(this,table)).history=[],_this100.index=-1,_this100.registerTableOption("history",!1),_this100}return _createClass(History,[{key:"initialize",value:function(){this.table.options.history&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("cell-delete",this.clearComponentHistory.bind(this)),this.subscribe("row-delete",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clear.bind(this)),this.subscribe("row-added",this.rowAdded.bind(this)),this.subscribe("row-move",this.rowMoved.bind(this))),this.registerTableFunction("undo",this.undo.bind(this)),this.registerTableFunction("redo",this.redo.bind(this)),this.registerTableFunction("getHistoryUndoSize",this.getHistoryUndoSize.bind(this)),this.registerTableFunction("getHistoryRedoSize",this.getHistoryRedoSize.bind(this)),this.registerTableFunction("clearHistory",this.clear.bind(this))}},{key:"rowMoved",value:function(from,to,after){this.action("rowMove",from,{posFrom:from.getPosition(),posTo:to.getPosition(),to:to,after:after})}},{key:"rowAdded",value:function(row,data,pos,index){this.action("rowAdd",row,{data:data,pos:pos,index:index})}},{key:"rowDeleted",value:function(row){var index,rows;this.table.options.groupBy?(index=(rows=row.getComponent().getGroup()._getSelf().rows).indexOf(row))&&(index=rows[index-1]):(index=row.table.rowManager.getRowIndex(row))&&(index=row.table.rowManager.rows[index-1]),this.action("rowDelete",row,{data:row.getData(),pos:!index,index:index})}},{key:"cellUpdated",value:function(cell){this.action("cellEdit",cell,{oldValue:cell.oldValue,newValue:cell.value})}},{key:"clear",value:function(){this.history=[],this.index=-1}},{key:"action",value:function(type,component,data){this.history=this.history.slice(0,this.index+1),this.history.push({type:type,component:component,data:data}),this.index++}},{key:"getHistoryUndoSize",value:function(){return this.index+1}},{key:"getHistoryRedoSize",value:function(){return this.history.length-(this.index+1)}},{key:"clearComponentHistory",value:function(component){var index=this.history.findIndex((function(item){return item.component===component}));index>-1&&(this.history.splice(index,1),index<=this.index&&this.index--,this.clearComponentHistory(component))}},{key:"undo",value:function(){if(this.index>-1){var action=this.history[this.index];return History.undoers[action.type].call(this,action),this.index--,this.dispatchExternal("historyUndo",action.type,action.component.getComponent(),action.data),!0}return console.warn("History Undo Error - No more history to undo"),!1}},{key:"redo",value:function(){if(this.history.length-1>this.index){this.index++;var action=this.history[this.index];return History.redoers[action.type].call(this,action),this.dispatchExternal("historyRedo",action.type,action.component.getComponent(),action.data),!0}return console.warn("History Redo Error - No more history to redo"),!1}},{key:"_rebindRow",value:function(oldRow,newRow){this.history.forEach((function(action){if(action.component instanceof Row)action.component===oldRow&&(action.component=newRow);else if(action.component instanceof Cell&&action.component.row===oldRow){var field=action.component.column.getField();field&&(action.component=newRow.getCell(field))}}))}}]),History}(Module);_exports.HistoryModule=History,History.moduleName="history",History.undoers={cellEdit:function(action){action.component.setValueProcessData(action.data.oldValue),action.component.cellRendered()},rowAdd:function(action){action.component.deleteActual()},rowDelete:function(action){var newRow=this.table.rowManager.addRowActual(action.data.data,action.data.pos,action.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(action.component,newRow)},rowMove:function(action){this.table.rowManager.moveRowActual(action.component,this.table.rowManager.rows[action.data.posFrom],!action.data.after),this.table.rowManager.redraw()}},History.redoers={cellEdit:function(action){action.component.setValueProcessData(action.data.newValue),action.component.cellRendered()},rowAdd:function(action){var newRow=this.table.rowManager.addRowActual(action.data.data,action.data.pos,action.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(action.component,newRow)},rowDelete:function(action){action.component.deleteActual()},rowMove:function(action){this.table.rowManager.moveRowActual(action.component,this.table.rowManager.rows[action.data.posTo],action.data.after),this.table.rowManager.redraw()}};var HtmlTableImport=function(_Module15){_inherits(HtmlTableImport,_Module15);var _super20=_createSuper(HtmlTableImport);function HtmlTableImport(table){var _this101;return _classCallCheck(this,HtmlTableImport),(_this101=_super20.call(this,table)).fieldIndex=[],_this101.hasIndex=!1,_this101}return _createClass(HtmlTableImport,[{key:"initialize",value:function(){this.tableElementCheck()}},{key:"tableElementCheck",value:function(){this.table.originalElement&&"TABLE"===this.table.originalElement.tagName&&(this.table.originalElement.childNodes.length?this.parseTable():console.warn("Unable to parse data from empty table tag, Tabulator should be initialized on a div tag unless importing data from a table element."))}},{key:"parseTable",value:function(){var element=this.table.originalElement,options=this.table.options,headers=element.getElementsByTagName("th"),rows=element.getElementsByTagName("tbody")[0],data=[];this.hasIndex=!1,this.dispatchExternal("htmlImporting"),rows=rows?rows.getElementsByTagName("tr"):[],this._extractOptions(element,options),headers.length?this._extractHeaders(headers,rows):this._generateBlankHeaders(headers,rows);for(var index=0;index<rows.length;index++){var cells=rows[index].getElementsByTagName("td"),item={};this.hasIndex||(item[options.index]=index);for(var i=0;i<cells.length;i++){var cell=cells[i];void 0!==this.fieldIndex[i]&&(item[this.fieldIndex[i]]=cell.innerHTML)}data.push(item)}options.data=data,this.dispatchExternal("htmlImported")}},{key:"_extractOptions",value:function(element,options,defaultOptions){var attributes=element.attributes,optionsArr=defaultOptions?Object.keys(defaultOptions):Object.keys(options),optionsList={};for(var index in optionsArr.forEach((function(item){optionsList[item.toLowerCase()]=item})),attributes){var name,attrib=attributes[index];attrib&&"object"==_typeof(attrib)&&attrib.name&&0===attrib.name.indexOf("tabulator-")&&(name=attrib.name.replace("tabulator-",""),void 0!==optionsList[name]&&(options[optionsList[name]]=this._attribValue(attrib.value)))}}},{key:"_attribValue",value:function(value){return"true"===value||"false"!==value&&value}},{key:"_findCol",value:function(title){return this.table.options.columns.find((function(column){return column.title===title}))||!1}},{key:"_extractHeaders",value:function(headers,rows){for(var index=0;index<headers.length;index++){var width,header=headers[index],exists=!1,col=this._findCol(header.textContent);col?exists=!0:col={title:header.textContent.trim()},col.field||(col.field=header.textContent.trim().toLowerCase().replace(" ","_")),(width=header.getAttribute("width"))&&!col.width&&(col.width=width),this._extractOptions(header,col,this.table.columnManager.optionsList.registeredDefaults),this.fieldIndex[index]=col.field,col.field==this.table.options.index&&(this.hasIndex=!0),exists||this.table.options.columns.push(col)}}},{key:"_generateBlankHeaders",value:function(headers,rows){for(var index=0;index<headers.length;index++){var header=headers[index],col={title:"",field:"col"+index};this.fieldIndex[index]=col.field;var width=header.getAttribute("width");width&&(col.width=width),this.table.options.columns.push(col)}}}]),HtmlTableImport}(Module);_exports.HtmlTableImportModule=HtmlTableImport,HtmlTableImport.moduleName="htmlTableImport";var defaultImporters={csv:function(input){for(var data=[],row=0,col=0,inQuote=!1,index=0;index<input.length;index++){var char=input[index],nextChar=input[index+1];data[row]||(data[row]=[]),data[row][col]||(data[row][col]=""),'"'==char&&inQuote&&'"'==nextChar?(data[row][col]+=char,index++):'"'!=char?","!=char||inQuote?"\r"!=char||"\n"!=nextChar||inQuote?"\r"!=char&&"\n"!=char||inQuote?data[row][col]+=char:(col=0,row++):(col=0,row++,index++):col++:inQuote=!inQuote}return data},json:function(input){try{return JSON.parse(input)}catch(e){return console.warn("JSON Import Error - File contents is invalid JSON",e),Promise.reject()}},array:function(input){return input}},Import=function(_Module16){_inherits(Import,_Module16);var _super21=_createSuper(Import);function Import(table){var _this102;return _classCallCheck(this,Import),(_this102=_super21.call(this,table)).registerTableOption("importFormat"),_this102.registerTableOption("importReader","text"),_this102}return _createClass(Import,[{key:"initialize",value:function(){this.registerTableFunction("import",this.importFromFile.bind(this)),this.table.options.importFormat&&(this.subscribe("data-loading",this.loadDataCheck.bind(this),10),this.subscribe("data-load",this.loadData.bind(this),10))}},{key:"loadDataCheck",value:function(data){return this.table.options.importFormat&&("string"==typeof data||Array.isArray(data)&&data.length&&Array.isArray(data))}},{key:"loadData",value:function(data,params,config,silent,previousData){return this.importData(this.lookupImporter(),data).then(this.structureData.bind(this)).catch((function(err){return console.error("Import Error:",err||"Unable to import data"),Promise.reject(err)}))}},{key:"lookupImporter",value:function(importFormat){var importer;return importFormat||(importFormat=this.table.options.importFormat),(importer="string"==typeof importFormat?Import.importers[importFormat]:importFormat)||console.error("Import Error - Importer not found:",importFormat),importer}},{key:"importFromFile",value:function(importFormat,extension){var importer=this.lookupImporter(importFormat);if(importer)return this.pickFile(extension).then(this.importData.bind(this,importer)).then(this.structureData.bind(this)).then(this.setData.bind(this)).catch((function(err){return console.error("Import Error:",err||"Unable to import file"),Promise.reject(err)}))}},{key:"pickFile",value:function(extensions){var _this103=this;return new Promise((function(resolve,reject){var input=document.createElement("input");input.type="file",input.accept=extensions,input.addEventListener("change",(function(e){var file=input.files[0],reader=new FileReader;switch(_this103.table.options.importReader){case"buffer":reader.readAsArrayBuffer(file);break;case"binary":reader.readAsBinaryString(file);break;case"url":reader.readAsDataURL(file);break;default:reader.readAsText(file)}reader.onload=function(e){resolve(reader.result)},reader.onerror=function(e){console.warn("File Load Error - Unable to read file"),reject()}})),input.click()}))}},{key:"importData",value:function(importer,fileContents){var data=importer.call(this.table,fileContents);return data instanceof Promise?data:data?Promise.resolve(data):Promise.reject()}},{key:"structureData",value:function(parsedData){return Array.isArray(parsedData)&&parsedData.length&&Array.isArray(parsedData[0])?this.table.options.autoColumns?this.structureArrayToObject(parsedData):this.structureArrayToColumns(parsedData):parsedData}},{key:"structureArrayToObject",value:function(parsedData){var columns=parsedData.shift();return parsedData.map((function(values){var row={};return columns.forEach((function(key,i){row[key]=values[i]})),row}))}},{key:"structureArrayToColumns",value:function(parsedData){var data=[],columns=this.table.getColumns();return columns[0]&&parsedData[0][0]&&columns[0].getDefinition().title===parsedData[0][0]&&parsedData.shift(),parsedData.forEach((function(rowData){var row={};rowData.forEach((function(value,index){var column=columns[index];column&&(row[column.getField()]=value)})),data.push(row)})),data}},{key:"setData",value:function(data){return this.table.setData(data)}}]),Import}(Module);_exports.ImportModule=Import,Import.moduleName="import",Import.importers=defaultImporters;var Interaction=function(_Module17){_inherits(Interaction,_Module17);var _super22=_createSuper(Interaction);function Interaction(table){var _this104;return _classCallCheck(this,Interaction),(_this104=_super22.call(this,table)).eventMap={rowClick:"row-click",rowDblClick:"row-dblclick",rowContext:"row-contextmenu",rowMouseEnter:"row-mouseenter",rowMouseLeave:"row-mouseleave",rowMouseOver:"row-mouseover",rowMouseOut:"row-mouseout",rowMouseMove:"row-mousemove",rowMouseDown:"row-mousedown",rowMouseUp:"row-mouseup",rowTap:"row",rowDblTap:"row",rowTapHold:"row",cellClick:"cell-click",cellDblClick:"cell-dblclick",cellContext:"cell-contextmenu",cellMouseEnter:"cell-mouseenter",cellMouseLeave:"cell-mouseleave",cellMouseOver:"cell-mouseover",cellMouseOut:"cell-mouseout",cellMouseMove:"cell-mousemove",cellMouseDown:"cell-mousedown",cellMouseUp:"cell-mouseup",cellTap:"cell",cellDblTap:"cell",cellTapHold:"cell",headerClick:"column-click",headerDblClick:"column-dblclick",headerContext:"column-contextmenu",headerMouseEnter:"column-mouseenter",headerMouseLeave:"column-mouseleave",headerMouseOver:"column-mouseover",headerMouseOut:"column-mouseout",headerMouseMove:"column-mousemove",headerMouseDown:"column-mousedown",headerMouseUp:"column-mouseup",headerTap:"column",headerDblTap:"column",headerTapHold:"column",groupClick:"group-click",groupDblClick:"group-dblclick",groupContext:"group-contextmenu",groupMouseEnter:"group-mouseenter",groupMouseLeave:"group-mouseleave",groupMouseOver:"group-mouseover",groupMouseOut:"group-mouseout",groupMouseMove:"group-mousemove",groupMouseDown:"group-mousedown",groupMouseUp:"group-mouseup",groupTap:"group",groupDblTap:"group",groupTapHold:"group"},_this104.subscribers={},_this104.touchSubscribers={},_this104.columnSubscribers={},_this104.touchWatchers={row:{tap:null,tapDbl:null,tapHold:null},cell:{tap:null,tapDbl:null,tapHold:null},column:{tap:null,tapDbl:null,tapHold:null},group:{tap:null,tapDbl:null,tapHold:null}},_this104.registerColumnOption("headerClick"),_this104.registerColumnOption("headerDblClick"),_this104.registerColumnOption("headerContext"),_this104.registerColumnOption("headerMouseEnter"),_this104.registerColumnOption("headerMouseLeave"),_this104.registerColumnOption("headerMouseOver"),_this104.registerColumnOption("headerMouseOut"),_this104.registerColumnOption("headerMouseMove"),_this104.registerColumnOption("headerMouseDown"),_this104.registerColumnOption("headerMouseUp"),_this104.registerColumnOption("headerTap"),_this104.registerColumnOption("headerDblTap"),_this104.registerColumnOption("headerTapHold"),_this104.registerColumnOption("cellClick"),_this104.registerColumnOption("cellDblClick"),_this104.registerColumnOption("cellContext"),_this104.registerColumnOption("cellMouseEnter"),_this104.registerColumnOption("cellMouseLeave"),_this104.registerColumnOption("cellMouseOver"),_this104.registerColumnOption("cellMouseOut"),_this104.registerColumnOption("cellMouseMove"),_this104.registerColumnOption("cellMouseDown"),_this104.registerColumnOption("cellMouseUp"),_this104.registerColumnOption("cellTap"),_this104.registerColumnOption("cellDblTap"),_this104.registerColumnOption("cellTapHold"),_this104}return _createClass(Interaction,[{key:"initialize",value:function(){this.initializeExternalEvents(),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("cell-dblclick",this.cellContentsSelectionFixer.bind(this))}},{key:"cellContentsSelectionFixer",value:function(e,cell){var range;if(!this.table.modExists("edit")||this.table.modules.edit.currentCell!==cell){e.preventDefault();try{document.selection?((range=document.body.createTextRange()).moveToElementText(cell.getElement()),range.select()):window.getSelection&&((range=document.createRange()).selectNode(cell.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(range))}catch(e){}}}},{key:"initializeExternalEvents",value:function(){for(var key in this.eventMap)this.subscriptionChangeExternal(key,this.subscriptionChanged.bind(this,key))}},{key:"subscriptionChanged",value:function(key,added){added?this.subscribers[key]||(this.eventMap[key].includes("-")?(this.subscribers[key]=this.handle.bind(this,key),this.subscribe(this.eventMap[key],this.subscribers[key])):this.subscribeTouchEvents(key)):this.eventMap[key].includes("-")?!this.subscribers[key]||this.columnSubscribers[key]||this.subscribedExternal(key)||(this.unsubscribe(this.eventMap[key],this.subscribers[key]),delete this.subscribers[key]):this.unsubscribeTouchEvents(key)}},{key:"subscribeTouchEvents",value:function(key){var type=this.eventMap[key];this.touchSubscribers[type+"-touchstart"]||(this.touchSubscribers[type+"-touchstart"]=this.handleTouch.bind(this,type,"start"),this.touchSubscribers[type+"-touchend"]=this.handleTouch.bind(this,type,"end"),this.subscribe(type+"-touchstart",this.touchSubscribers[type+"-touchstart"]),this.subscribe(type+"-touchend",this.touchSubscribers[type+"-touchend"])),this.subscribers[key]=!0}},{key:"unsubscribeTouchEvents",value:function(key){var noTouch=!0,type=this.eventMap[key];if(this.subscribers[key]&&!this.subscribedExternal(key)){for(var i in delete this.subscribers[key],this.eventMap)this.eventMap[i]===type&&this.subscribers[i]&&(noTouch=!1);noTouch&&(this.unsubscribe(type+"-touchstart",this.touchSubscribers[type+"-touchstart"]),this.unsubscribe(type+"-touchend",this.touchSubscribers[type+"-touchend"]),delete this.touchSubscribers[type+"-touchstart"],delete this.touchSubscribers[type+"-touchend"])}}},{key:"initializeColumn",value:function(column){var def=column.definition;for(var key in this.eventMap)def[key]&&(this.subscriptionChanged(key,!0),this.columnSubscribers[key]||(this.columnSubscribers[key]=[]),this.columnSubscribers[key].push(column))}},{key:"handle",value:function(action,e,component){this.dispatchEvent(action,e,component)}},{key:"handleTouch",value:function(type,action,e,component){var _this105=this,watchers=this.touchWatchers[type];switch("column"===type&&(type="header"),action){case"start":watchers.tap=!0,clearTimeout(watchers.tapHold),watchers.tapHold=setTimeout((function(){clearTimeout(watchers.tapHold),watchers.tapHold=null,watchers.tap=null,clearTimeout(watchers.tapDbl),watchers.tapDbl=null,_this105.dispatchEvent(type+"TapHold",e,component)}),1e3);break;case"end":watchers.tap&&(watchers.tap=null,this.dispatchEvent(type+"Tap",e,component)),watchers.tapDbl?(clearTimeout(watchers.tapDbl),watchers.tapDbl=null,this.dispatchEvent(type+"DblTap",e,component)):watchers.tapDbl=setTimeout((function(){clearTimeout(watchers.tapDbl),watchers.tapDbl=null}),300),clearTimeout(watchers.tapHold),watchers.tapHold=null}}},{key:"dispatchEvent",value:function(action,e,component){var callback,componentObj=component.getComponent();this.columnSubscribers[action]&&(component instanceof Cell?callback=component.column.definition[action]:component instanceof Column&&(callback=component.definition[action]),callback&&callback(e,componentObj)),this.dispatchExternal(action,e,componentObj)}}]),Interaction}(Module);_exports.InteractionModule=Interaction,Interaction.moduleName="interaction";var Keybindings=function(_Module18){_inherits(Keybindings,_Module18);var _super23=_createSuper(Keybindings);function Keybindings(table){var _this106;return _classCallCheck(this,Keybindings),(_this106=_super23.call(this,table)).watchKeys=null,_this106.pressedKeys=null,_this106.keyupBinding=!1,_this106.keydownBinding=!1,_this106.registerTableOption("keybindings",{}),_this106.registerTableOption("tabEndNewRow",!1),_this106}return _createClass(Keybindings,[{key:"initialize",value:function(){var bindings=this.table.options.keybindings,mergedBindings={};this.watchKeys={},this.pressedKeys=[],!1!==bindings&&(Object.assign(mergedBindings,Keybindings.bindings),Object.assign(mergedBindings,bindings),this.mapBindings(mergedBindings),this.bindEvents()),this.subscribe("table-destroy",this.clearBindings.bind(this))}},{key:"mapBindings",value:function(bindings){var _this107=this,_loop2=function(key){Keybindings.actions[key]?bindings[key]&&("object"!==_typeof(bindings[key])&&(bindings[key]=[bindings[key]]),bindings[key].forEach((function(binding){(Array.isArray(binding)?binding:[binding]).forEach((function(item){_this107.mapBinding(key,item)}))}))):console.warn("Key Binding Error - no such action:",key)};for(var key in bindings)_loop2(key)}},{key:"mapBinding",value:function(action,symbolsList){var _this108=this,binding={action:Keybindings.actions[action],keys:[],ctrl:!1,shift:!1,meta:!1};symbolsList.toString().toLowerCase().split(" ").join("").split("+").forEach((function(symbol){switch(symbol){case"ctrl":binding.ctrl=!0;break;case"shift":binding.shift=!0;break;case"meta":binding.meta=!0;break;default:symbol=isNaN(symbol)?symbol.toUpperCase().charCodeAt(0):parseInt(symbol),binding.keys.push(symbol),_this108.watchKeys[symbol]||(_this108.watchKeys[symbol]=[]),_this108.watchKeys[symbol].push(binding)}}))}},{key:"bindEvents",value:function(){var self=this;this.keyupBinding=function(e){var code=e.keyCode,bindings=self.watchKeys[code];bindings&&(self.pressedKeys.push(code),bindings.forEach((function(binding){self.checkBinding(e,binding)})))},this.keydownBinding=function(e){var code=e.keyCode;if(self.watchKeys[code]){var index=self.pressedKeys.indexOf(code);index>-1&&self.pressedKeys.splice(index,1)}},this.table.element.addEventListener("keydown",this.keyupBinding),this.table.element.addEventListener("keyup",this.keydownBinding)}},{key:"clearBindings",value:function(){this.keyupBinding&&this.table.element.removeEventListener("keydown",this.keyupBinding),this.keydownBinding&&this.table.element.removeEventListener("keyup",this.keydownBinding)}},{key:"checkBinding",value:function(e,binding){var _this109=this,match=!0;return e.ctrlKey==binding.ctrl&&e.shiftKey==binding.shift&&e.metaKey==binding.meta&&(binding.keys.forEach((function(key){-1==_this109.pressedKeys.indexOf(key)&&(match=!1)})),match&&binding.action.call(this,e),!0)}}]),Keybindings}(Module);_exports.KeybindingsModule=Keybindings,Keybindings.moduleName="keybindings",Keybindings.bindings={navPrev:"shift + 9",navNext:9,navUp:38,navDown:40,scrollPageUp:33,scrollPageDown:34,scrollToStart:36,scrollToEnd:35,undo:["ctrl + 90","meta + 90"],redo:["ctrl + 89","meta + 89"],copyToClipboard:["ctrl + 67","meta + 89"]},Keybindings.actions={keyBlock:function(e){e.stopPropagation(),e.preventDefault()},scrollPageUp:function(e){var rowManager=this.table.rowManager,newPos=rowManager.scrollTop-rowManager.element.clientHeight;e.preventDefault(),rowManager.displayRowsCount&&(newPos>=0?rowManager.element.scrollTop=newPos:rowManager.scrollToRow(rowManager.getDisplayRows()[0])),this.table.element.focus()},scrollPageDown:function(e){var rowManager=this.table.rowManager,newPos=rowManager.scrollTop+rowManager.element.clientHeight,scrollMax=rowManager.element.scrollHeight;e.preventDefault(),rowManager.displayRowsCount&&(newPos<=scrollMax?rowManager.element.scrollTop=newPos:rowManager.scrollToRow(rowManager.getDisplayRows()[rowManager.displayRowsCount-1])),this.table.element.focus()},scrollToStart:function(e){var rowManager=this.table.rowManager;e.preventDefault(),rowManager.displayRowsCount&&rowManager.scrollToRow(rowManager.getDisplayRows()[0]),this.table.element.focus()},scrollToEnd:function(e){var rowManager=this.table.rowManager;e.preventDefault(),rowManager.displayRowsCount&&rowManager.scrollToRow(rowManager.getDisplayRows()[rowManager.displayRowsCount-1]),this.table.element.focus()},navPrev:function(e){this.dispatch("keybinding-nav-prev",e)},navNext:function(e){this.dispatch("keybinding-nav-next",e)},navLeft:function(e){this.dispatch("keybinding-nav-left",e)},navRight:function(e){this.dispatch("keybinding-nav-right",e)},navUp:function(e){this.dispatch("keybinding-nav-up",e)},navDown:function(e){this.dispatch("keybinding-nav-down",e)},undo:function(e){this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(this.table.modules.edit.currentCell||(e.preventDefault(),this.table.modules.history.undo()))},redo:function(e){this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(this.table.modules.edit.currentCell||(e.preventDefault(),this.table.modules.history.redo()))},copyToClipboard:function(e){this.table.modules.edit.currentCell||this.table.modExists("clipboard",!0)&&this.table.modules.clipboard.copy(!1,!0)}};var Menu=function(_Module19){_inherits(Menu,_Module19);var _super24=_createSuper(Menu);function Menu(table){var _this110;return _classCallCheck(this,Menu),(_this110=_super24.call(this,table)).menuContainer=null,_this110.nestedMenuBlock=!1,_this110.currentComponent=null,_this110.rootPopup=null,_this110.columnSubscribers={},_this110.registerTableOption("menuContainer",void 0),_this110.registerTableOption("rowContextMenu",!1),_this110.registerTableOption("rowClickMenu",!1),_this110.registerTableOption("rowDblClickMenu",!1),_this110.registerTableOption("groupContextMenu",!1),_this110.registerTableOption("groupClickMenu",!1),_this110.registerTableOption("groupDblClickMenu",!1),_this110.registerColumnOption("headerContextMenu"),_this110.registerColumnOption("headerClickMenu"),_this110.registerColumnOption("headerDblClickMenu"),_this110.registerColumnOption("headerMenu"),_this110.registerColumnOption("headerMenuIcon"),_this110.registerColumnOption("contextMenu"),_this110.registerColumnOption("clickMenu"),_this110.registerColumnOption("dblClickMenu"),_this110}return _createClass(Menu,[{key:"initialize",value:function(){this.deprecatedOptionsCheck(),this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}},{key:"deprecatedOptionsCheck",value:function(){this.deprecationCheck("menuContainer","popupContainer")||(this.table.options.popupContainer=this.table.options.menuContainer)}},{key:"initializeRowWatchers",value:function(){this.table.options.rowContextMenu&&(this.subscribe("row-contextmenu",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu)),this.table.on("rowTapHold",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu))),this.table.options.rowClickMenu&&this.subscribe("row-click",this.loadMenuEvent.bind(this,this.table.options.rowClickMenu)),this.table.options.rowDblClickMenu&&this.subscribe("row-dblclick",this.loadMenuEvent.bind(this,this.table.options.rowDblClickMenu))}},{key:"initializeGroupWatchers",value:function(){this.table.options.groupContextMenu&&(this.subscribe("group-contextmenu",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu)),this.table.on("groupTapHold",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu))),this.table.options.groupClickMenu&&this.subscribe("group-click",this.loadMenuEvent.bind(this,this.table.options.groupClickMenu)),this.table.options.groupDblClickMenu&&this.subscribe("group-dblclick",this.loadMenuEvent.bind(this,this.table.options.groupDblClickMenu))}},{key:"initializeColumn",value:function(column){var def=column.definition;def.headerContextMenu&&!this.columnSubscribers.headerContextMenu&&(this.columnSubscribers.headerContextMenu=this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextMenu),this.table.on("headerTapHold",this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"))),def.headerClickMenu&&!this.columnSubscribers.headerClickMenu&&(this.columnSubscribers.headerClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerClickMenu"),this.subscribe("column-click",this.columnSubscribers.headerClickMenu)),def.headerDblClickMenu&&!this.columnSubscribers.headerDblClickMenu&&(this.columnSubscribers.headerDblClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerDblClickMenu"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickMenu)),def.headerMenu&&this.initializeColumnHeaderMenu(column),def.contextMenu&&!this.columnSubscribers.contextMenu&&(this.columnSubscribers.contextMenu=this.loadMenuTableCellEvent.bind(this,"contextMenu"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextMenu),this.table.on("cellTapHold",this.loadMenuTableCellEvent.bind(this,"contextMenu"))),def.clickMenu&&!this.columnSubscribers.clickMenu&&(this.columnSubscribers.clickMenu=this.loadMenuTableCellEvent.bind(this,"clickMenu"),this.subscribe("cell-click",this.columnSubscribers.clickMenu)),def.dblClickMenu&&!this.columnSubscribers.dblClickMenu&&(this.columnSubscribers.dblClickMenu=this.loadMenuTableCellEvent.bind(this,"dblClickMenu"),this.subscribe("cell-dblclick",this.columnSubscribers.dblClickMenu))}},{key:"initializeColumnHeaderMenu",value:function(column){var headerMenuEl,_this111=this,icon=column.definition.headerMenuIcon;(headerMenuEl=document.createElement("span")).classList.add("tabulator-header-popup-button"),icon?("function"==typeof icon&&(icon=icon(column.getComponent())),icon instanceof HTMLElement?headerMenuEl.appendChild(icon):headerMenuEl.innerHTML=icon):headerMenuEl.innerHTML="&vellip;",headerMenuEl.addEventListener("click",(function(e){e.stopPropagation(),e.preventDefault(),_this111.loadMenuEvent(column.definition.headerMenu,e,column)})),column.titleElement.insertBefore(headerMenuEl,column.titleElement.firstChild)}},{key:"loadMenuTableCellEvent",value:function(option,e,cell){cell._cell&&(cell=cell._cell),cell.column.definition[option]&&this.loadMenuEvent(cell.column.definition[option],e,cell)}},{key:"loadMenuTableColumnEvent",value:function(option,e,column){column._column&&(column=column._column),column.definition[option]&&this.loadMenuEvent(column.definition[option],e,column)}},{key:"loadMenuEvent",value:function(menu,e,component){component._group?component=component._group:component._row&&(component=component._row),menu="function"==typeof menu?menu.call(this.table,e,component.getComponent()):menu,this.loadMenu(e,component,menu)}},{key:"loadMenu",value:function(e,component,menu,parentEl,parentPopup){var popup,_this112=this,touch=!(e instanceof MouseEvent),menuEl=document.createElement("div");if(menuEl.classList.add("tabulator-menu"),touch||e.preventDefault(),menu&&menu.length){if(parentEl)popup=parentPopup.child(menuEl);else{if(this.nestedMenuBlock){if(this.rootPopup)return}else this.nestedMenuBlock=setTimeout((function(){_this112.nestedMenuBlock=!1}),100);this.rootPopup&&this.rootPopup.hide(),this.rootPopup=popup=this.popup(menuEl)}menu.forEach((function(item){var itemEl=document.createElement("div"),label=item.label,disabled=item.disabled;item.separator?itemEl.classList.add("tabulator-menu-separator"):(itemEl.classList.add("tabulator-menu-item"),"function"==typeof label&&(label=label.call(_this112.table,component.getComponent())),label instanceof Node?itemEl.appendChild(label):itemEl.innerHTML=label,"function"==typeof disabled&&(disabled=disabled.call(_this112.table,component.getComponent())),disabled?(itemEl.classList.add("tabulator-menu-item-disabled"),itemEl.addEventListener("click",(function(e){e.stopPropagation()}))):item.menu&&item.menu.length?itemEl.addEventListener("click",(function(e){e.stopPropagation(),_this112.loadMenu(e,component,item.menu,itemEl,popup)})):item.action&&itemEl.addEventListener("click",(function(e){item.action(e,component.getComponent())})),item.menu&&item.menu.length&&itemEl.classList.add("tabulator-menu-item-submenu")),menuEl.appendChild(itemEl)})),menuEl.addEventListener("click",(function(e){_this112.rootPopup&&_this112.rootPopup.hide()})),popup.show(parentEl||e),popup===this.rootPopup&&(this.rootPopup.hideOnBlur((function(){_this112.rootPopup=null,_this112.currentComponent&&(_this112.dispatchExternal("menuClosed",_this112.currentComponent.getComponent()),_this112.currentComponent=null)})),this.currentComponent=component,this.dispatchExternal("menuOpened",component.getComponent()))}}}]),Menu}(Module);_exports.MenuModule=Menu,Menu.moduleName="menu";var MoveColumns=function(_Module20){_inherits(MoveColumns,_Module20);var _super25=_createSuper(MoveColumns);function MoveColumns(table){var _this113;return _classCallCheck(this,MoveColumns),(_this113=_super25.call(this,table)).placeholderElement=_this113.createPlaceholderElement(),_this113.hoverElement=!1,_this113.checkTimeout=!1,_this113.checkPeriod=250,_this113.moving=!1,_this113.toCol=!1,_this113.toColAfter=!1,_this113.startX=0,_this113.autoScrollMargin=40,_this113.autoScrollStep=5,_this113.autoScrollTimeout=!1,_this113.touchMove=!1,_this113.moveHover=_this113.moveHover.bind(_assertThisInitialized(_this113)),_this113.endMove=_this113.endMove.bind(_assertThisInitialized(_this113)),_this113.registerTableOption("movableColumns",!1),_this113}return _createClass(MoveColumns,[{key:"createPlaceholderElement",value:function(){var el=document.createElement("div");return el.classList.add("tabulator-col"),el.classList.add("tabulator-col-placeholder"),el}},{key:"initialize",value:function(){this.table.options.movableColumns&&this.subscribe("column-init",this.initializeColumn.bind(this))}},{key:"initializeColumn",value:function(column){var colEl,self=this,config={};column.modules.frozen||column.isGroup||(colEl=column.getElement(),config.mousemove=function(e){column.parent===self.moving.parent&&((self.touchMove?e.touches[0].pageX:e.pageX)-Helpers.elOffset(colEl).left+self.table.columnManager.contentsElement.scrollLeft>column.getWidth()/2?self.toCol===column&&self.toColAfter||(colEl.parentNode.insertBefore(self.placeholderElement,colEl.nextSibling),self.moveColumn(column,!0)):(self.toCol!==column||self.toColAfter)&&(colEl.parentNode.insertBefore(self.placeholderElement,colEl),self.moveColumn(column,!1)))}.bind(self),colEl.addEventListener("mousedown",(function(e){self.touchMove=!1,1===e.which&&(self.checkTimeout=setTimeout((function(){self.startMove(e,column)}),self.checkPeriod))})),colEl.addEventListener("mouseup",(function(e){1===e.which&&self.checkTimeout&&clearTimeout(self.checkTimeout)})),self.bindTouchEvents(column)),column.modules.moveColumn=config}},{key:"bindTouchEvents",value:function(column){var nextCol,prevCol,nextColWidth,prevColWidth,nextColWidthLast,prevColWidthLast,_this114=this,colEl=column.getElement(),startXMove=!1;colEl.addEventListener("touchstart",(function(e){_this114.checkTimeout=setTimeout((function(){_this114.touchMove=!0,nextCol=column.nextColumn(),nextColWidth=nextCol?nextCol.getWidth()/2:0,prevCol=column.prevColumn(),prevColWidth=prevCol?prevCol.getWidth()/2:0,nextColWidthLast=0,prevColWidthLast=0,startXMove=!1,_this114.startMove(e,column)}),_this114.checkPeriod)}),{passive:!0}),colEl.addEventListener("touchmove",(function(e){var diff,moveToCol;_this114.moving&&(_this114.moveHover(e),startXMove||(startXMove=e.touches[0].pageX),(diff=e.touches[0].pageX-startXMove)>0?nextCol&&diff-nextColWidthLast>nextColWidth&&(moveToCol=nextCol)!==column&&(startXMove=e.touches[0].pageX,moveToCol.getElement().parentNode.insertBefore(_this114.placeholderElement,moveToCol.getElement().nextSibling),_this114.moveColumn(moveToCol,!0)):prevCol&&-diff-prevColWidthLast>prevColWidth&&(moveToCol=prevCol)!==column&&(startXMove=e.touches[0].pageX,moveToCol.getElement().parentNode.insertBefore(_this114.placeholderElement,moveToCol.getElement()),_this114.moveColumn(moveToCol,!1)),moveToCol&&(nextCol=moveToCol.nextColumn(),nextColWidthLast=nextColWidth,nextColWidth=nextCol?nextCol.getWidth()/2:0,prevCol=moveToCol.prevColumn(),prevColWidthLast=prevColWidth,prevColWidth=prevCol?prevCol.getWidth()/2:0))}),{passive:!0}),colEl.addEventListener("touchend",(function(e){_this114.checkTimeout&&clearTimeout(_this114.checkTimeout),_this114.moving&&_this114.endMove(e)}))}},{key:"startMove",value:function(e,column){var element=column.getElement(),headerElement=this.table.columnManager.getContentsElement(),headersElement=this.table.columnManager.getHeadersElement();this.moving=column,this.startX=(this.touchMove?e.touches[0].pageX:e.pageX)-Helpers.elOffset(element).left,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=column.getWidth()+"px",this.placeholderElement.style.height=column.getHeight()+"px",element.parentNode.insertBefore(this.placeholderElement,element),element.parentNode.removeChild(element),this.hoverElement=element.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),headerElement.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.bottom=headerElement.clientHeight-headersElement.offsetHeight+"px",this.touchMove||(this._bindMouseMove(),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove)),this.moveHover(e)}},{key:"_bindMouseMove",value:function(){this.table.columnManager.columnsByIndex.forEach((function(column){column.modules.moveColumn.mousemove&&column.getElement().addEventListener("mousemove",column.modules.moveColumn.mousemove)}))}},{key:"_unbindMouseMove",value:function(){this.table.columnManager.columnsByIndex.forEach((function(column){column.modules.moveColumn.mousemove&&column.getElement().removeEventListener("mousemove",column.modules.moveColumn.mousemove)}))}},{key:"moveColumn",value:function(column,after){var movingCells=this.moving.getCells();this.toCol=column,this.toColAfter=after,after?column.getCells().forEach((function(cell,i){var cellEl=cell.getElement(!0);cellEl.parentNode&&movingCells[i]&&cellEl.parentNode.insertBefore(movingCells[i].getElement(),cellEl.nextSibling)})):column.getCells().forEach((function(cell,i){var cellEl=cell.getElement(!0);cellEl.parentNode&&movingCells[i]&&cellEl.parentNode.insertBefore(movingCells[i].getElement(),cellEl)}))}},{key:"endMove",value:function(e){(1===e.which||this.touchMove)&&(this._unbindMouseMove(),this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toCol&&this.table.columnManager.moveColumnActual(this.moving,this.toCol,this.toColAfter),this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.touchMove||(document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove)))}},{key:"moveHover",value:function(e){var scrollPos,_this115=this,columnHolder=this.table.columnManager.getContentsElement(),scrollLeft=columnHolder.scrollLeft,xPos=(this.touchMove?e.touches[0].pageX:e.pageX)-Helpers.elOffset(columnHolder).left+scrollLeft;this.hoverElement.style.left=xPos-this.startX+"px",xPos-scrollLeft<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout((function(){scrollPos=Math.max(0,scrollLeft-5),_this115.table.rowManager.getElement().scrollLeft=scrollPos,_this115.autoScrollTimeout=!1}),1))),scrollLeft+columnHolder.clientWidth-xPos<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout((function(){scrollPos=Math.min(columnHolder.clientWidth,scrollLeft+5),_this115.table.rowManager.getElement().scrollLeft=scrollPos,_this115.autoScrollTimeout=!1}),1)))}}]),MoveColumns}(Module);_exports.MoveColumnsModule=MoveColumns,MoveColumns.moduleName="moveColumn";var MoveRows=function(_Module21){_inherits(MoveRows,_Module21);var _super26=_createSuper(MoveRows);function MoveRows(table){var _this116;return _classCallCheck(this,MoveRows),(_this116=_super26.call(this,table)).placeholderElement=_this116.createPlaceholderElement(),_this116.hoverElement=!1,_this116.checkTimeout=!1,_this116.checkPeriod=150,_this116.moving=!1,_this116.toRow=!1,_this116.toRowAfter=!1,_this116.hasHandle=!1,_this116.startY=0,_this116.startX=0,_this116.moveHover=_this116.moveHover.bind(_assertThisInitialized(_this116)),_this116.endMove=_this116.endMove.bind(_assertThisInitialized(_this116)),_this116.tableRowDropEvent=!1,_this116.touchMove=!1,_this116.connection=!1,_this116.connectionSelectorsTables=!1,_this116.connectionSelectorsElements=!1,_this116.connectionElements=[],_this116.connections=[],_this116.connectedTable=!1,_this116.connectedRow=!1,_this116.registerTableOption("movableRows",!1),_this116.registerTableOption("movableRowsConnectedTables",!1),_this116.registerTableOption("movableRowsConnectedElements",!1),_this116.registerTableOption("movableRowsSender",!1),_this116.registerTableOption("movableRowsReceiver","insert"),_this116.registerColumnOption("rowHandle"),_this116}return _createClass(MoveRows,[{key:"createPlaceholderElement",value:function(){var el=document.createElement("div");return el.classList.add("tabulator-row"),el.classList.add("tabulator-row-placeholder"),el}},{key:"initialize",value:function(){this.table.options.movableRows&&(this.connectionSelectorsTables=this.table.options.movableRowsConnectedTables,this.connectionSelectorsElements=this.table.options.movableRowsConnectedElements,this.connection=this.connectionSelectorsTables||this.connectionSelectorsElements,this.subscribe("cell-init",this.initializeCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)))}},{key:"initializeGroupHeader",value:function(group){var self=this,config={};config.mouseup=function(e){self.tableRowDrop(e,group)}.bind(self),config.mousemove=function(e){var rowEl;e.pageY-Helpers.elOffset(group.element).top+self.table.rowManager.element.scrollTop>group.getHeight()/2?self.toRow===group&&self.toRowAfter||((rowEl=group.getElement()).parentNode.insertBefore(self.placeholderElement,rowEl.nextSibling),self.moveRow(group,!0)):(self.toRow!==group||self.toRowAfter)&&(rowEl=group.getElement()).previousSibling&&(rowEl.parentNode.insertBefore(self.placeholderElement,rowEl),self.moveRow(group,!1))}.bind(self),group.modules.moveRow=config}},{key:"initializeRow",value:function(row){var rowEl,self=this,config={};config.mouseup=function(e){self.tableRowDrop(e,row)}.bind(self),config.mousemove=function(e){var rowEl=row.getElement();e.pageY-Helpers.elOffset(rowEl).top+self.table.rowManager.element.scrollTop>row.getHeight()/2?self.toRow===row&&self.toRowAfter||(rowEl.parentNode.insertBefore(self.placeholderElement,rowEl.nextSibling),self.moveRow(row,!0)):(self.toRow!==row||self.toRowAfter)&&(rowEl.parentNode.insertBefore(self.placeholderElement,rowEl),self.moveRow(row,!1))}.bind(self),this.hasHandle||((rowEl=row.getElement()).addEventListener("mousedown",(function(e){1===e.which&&(self.checkTimeout=setTimeout((function(){self.startMove(e,row)}),self.checkPeriod))})),rowEl.addEventListener("mouseup",(function(e){1===e.which&&self.checkTimeout&&clearTimeout(self.checkTimeout)})),this.bindTouchEvents(row,row.getElement())),row.modules.moveRow=config}},{key:"initializeColumn",value:function(column){column.definition.rowHandle&&!1!==this.table.options.movableRows&&(this.hasHandle=!0)}},{key:"initializeCell",value:function(cell){if(cell.column.definition.rowHandle&&!1!==this.table.options.movableRows){var self=this,cellEl=cell.getElement(!0);cellEl.addEventListener("mousedown",(function(e){1===e.which&&(self.checkTimeout=setTimeout((function(){self.startMove(e,cell.row)}),self.checkPeriod))})),cellEl.addEventListener("mouseup",(function(e){1===e.which&&self.checkTimeout&&clearTimeout(self.checkTimeout)})),this.bindTouchEvents(cell.row,cellEl)}}},{key:"bindTouchEvents",value:function(row,element){var nextRow,prevRow,nextRowHeight,prevRowHeight,nextRowHeightLast,prevRowHeightLast,_this117=this,startYMove=!1;element.addEventListener("touchstart",(function(e){_this117.checkTimeout=setTimeout((function(){_this117.touchMove=!0,nextRow=row.nextRow(),nextRowHeight=nextRow?nextRow.getHeight()/2:0,prevRow=row.prevRow(),prevRowHeight=prevRow?prevRow.getHeight()/2:0,nextRowHeightLast=0,prevRowHeightLast=0,startYMove=!1,_this117.startMove(e,row)}),_this117.checkPeriod)}),{passive:!0}),this.moving,this.toRow,this.toRowAfter,element.addEventListener("touchmove",(function(e){var diff,moveToRow;_this117.moving&&(e.preventDefault(),_this117.moveHover(e),startYMove||(startYMove=e.touches[0].pageY),(diff=e.touches[0].pageY-startYMove)>0?nextRow&&diff-nextRowHeightLast>nextRowHeight&&(moveToRow=nextRow)!==row&&(startYMove=e.touches[0].pageY,moveToRow.getElement().parentNode.insertBefore(_this117.placeholderElement,moveToRow.getElement().nextSibling),_this117.moveRow(moveToRow,!0)):prevRow&&-diff-prevRowHeightLast>prevRowHeight&&(moveToRow=prevRow)!==row&&(startYMove=e.touches[0].pageY,moveToRow.getElement().parentNode.insertBefore(_this117.placeholderElement,moveToRow.getElement()),_this117.moveRow(moveToRow,!1)),moveToRow&&(nextRow=moveToRow.nextRow(),nextRowHeightLast=nextRowHeight,nextRowHeight=nextRow?nextRow.getHeight()/2:0,prevRow=moveToRow.prevRow(),prevRowHeightLast=prevRowHeight,prevRowHeight=prevRow?prevRow.getHeight()/2:0))})),element.addEventListener("touchend",(function(e){_this117.checkTimeout&&clearTimeout(_this117.checkTimeout),_this117.moving&&(_this117.endMove(e),_this117.touchMove=!1)}))}},{key:"_bindMouseMove",value:function(){this.table.rowManager.getDisplayRows().forEach((function(row){("row"===row.type||"group"===row.type)&&row.modules.moveRow&&row.modules.moveRow.mousemove&&row.getElement().addEventListener("mousemove",row.modules.moveRow.mousemove)}))}},{key:"_unbindMouseMove",value:function(){this.table.rowManager.getDisplayRows().forEach((function(row){("row"===row.type||"group"===row.type)&&row.modules.moveRow&&row.modules.moveRow.mousemove&&row.getElement().removeEventListener("mousemove",row.modules.moveRow.mousemove)}))}},{key:"startMove",value:function(e,row){var element=row.getElement();this.setStartPosition(e,row),this.moving=row,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=row.getWidth()+"px",this.placeholderElement.style.height=row.getHeight()+"px",this.connection?(this.table.element.classList.add("tabulator-movingrow-sending"),this.connectToTables(row)):(element.parentNode.insertBefore(this.placeholderElement,element),element.parentNode.removeChild(element)),this.hoverElement=element.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),this.connection?(document.body.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this.hoverElement.style.width=this.table.element.clientWidth+"px",this.hoverElement.style.whiteSpace="nowrap",this.hoverElement.style.overflow="hidden",this.hoverElement.style.pointerEvents="none"):(this.table.rowManager.getTableElement().appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this._bindMouseMove()),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove),this.dispatchExternal("rowMoving",row.getComponent()),this.moveHover(e)}},{key:"setStartPosition",value:function(e,row){var element,position,pageX=this.touchMove?e.touches[0].pageX:e.pageX,pageY=this.touchMove?e.touches[0].pageY:e.pageY;element=row.getElement(),this.connection?(position=element.getBoundingClientRect(),this.startX=position.left-pageX+window.pageXOffset,this.startY=position.top-pageY+window.pageYOffset):this.startY=pageY-element.getBoundingClientRect().top}},{key:"endMove",value:function(e){e&&1!==e.which&&!this.touchMove||(this._unbindMouseMove(),this.connection||(this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement)),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toRow?this.table.rowManager.moveRow(this.moving,this.toRow,this.toRowAfter):this.dispatchExternal("rowMoveCancelled",this.moving.getComponent()),this.moving=!1,this.toRow=!1,this.toRowAfter=!1,document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove),this.connection&&(this.table.element.classList.remove("tabulator-movingrow-sending"),this.disconnectFromTables()))}},{key:"moveRow",value:function(row,after){this.toRow=row,this.toRowAfter=after}},{key:"moveHover",value:function(e){this.connection?this.moveHoverConnections.call(this,e):this.moveHoverTable.call(this,e)}},{key:"moveHoverTable",value:function(e){var rowHolder=this.table.rowManager.getElement(),scrollTop=rowHolder.scrollTop,yPos=(this.touchMove?e.touches[0].pageY:e.pageY)-rowHolder.getBoundingClientRect().top+scrollTop;this.hoverElement.style.top=Math.min(yPos-this.startY,this.table.rowManager.element.scrollHeight-this.hoverElement.offsetHeight)+"px"}},{key:"moveHoverConnections",value:function(e){this.hoverElement.style.left=this.startX+(this.touchMove?e.touches[0].pageX:e.pageX)+"px",this.hoverElement.style.top=this.startY+(this.touchMove?e.touches[0].pageY:e.pageY)+"px"}},{key:"elementRowDrop",value:function(e,element,row){this.dispatchExternal("movableRowsElementDrop",e,element,!!row&&row.getComponent())}},{key:"connectToTables",value:function(row){var connectionTables,_this118=this;this.connectionSelectorsTables&&(connectionTables=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStart",connectionTables),this.commsSend(this.connectionSelectorsTables,"moveRow","connect",{row:row})),this.connectionSelectorsElements&&(this.connectionElements=[],Array.isArray(this.connectionSelectorsElements)||(this.connectionSelectorsElements=[this.connectionSelectorsElements]),this.connectionSelectorsElements.forEach((function(query){"string"==typeof query?_this118.connectionElements=_this118.connectionElements.concat(Array.prototype.slice.call(document.querySelectorAll(query))):_this118.connectionElements.push(query)})),this.connectionElements.forEach((function(element){var dropEvent=function(e){_this118.elementRowDrop(e,element,_this118.moving)};element.addEventListener("mouseup",dropEvent),element.tabulatorElementDropEvent=dropEvent,element.classList.add("tabulator-movingrow-receiving")})))}},{key:"disconnectFromTables",value:function(){var connectionTables;this.connectionSelectorsTables&&(connectionTables=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStop",connectionTables),this.commsSend(this.connectionSelectorsTables,"moveRow","disconnect")),this.connectionElements.forEach((function(element){element.classList.remove("tabulator-movingrow-receiving"),element.removeEventListener("mouseup",element.tabulatorElementDropEvent),delete element.tabulatorElementDropEvent}))}},{key:"connect",value:function(table,row){return this.connectedTable?(console.warn("Move Row Error - Table cannot accept connection, already connected to table:",this.connectedTable),!1):(this.connectedTable=table,this.connectedRow=row,this.table.element.classList.add("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach((function(row){"row"===row.type&&row.modules.moveRow&&row.modules.moveRow.mouseup&&row.getElement().addEventListener("mouseup",row.modules.moveRow.mouseup)})),this.tableRowDropEvent=this.tableRowDrop.bind(this),this.table.element.addEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStart",row,table),!0)}},{key:"disconnect",value:function(table){table===this.connectedTable?(this.connectedTable=!1,this.connectedRow=!1,this.table.element.classList.remove("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach((function(row){"row"===row.type&&row.modules.moveRow&&row.modules.moveRow.mouseup&&row.getElement().removeEventListener("mouseup",row.modules.moveRow.mouseup)})),this.table.element.removeEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStop",table)):console.warn("Move Row Error - trying to disconnect from non connected table")}},{key:"dropComplete",value:function(table,row,success){var sender=!1;if(success){switch(_typeof(this.table.options.movableRowsSender)){case"string":sender=this.senders[this.table.options.movableRowsSender];break;case"function":sender=this.table.options.movableRowsSender}sender?sender.call(this,this.moving?this.moving.getComponent():void 0,row?row.getComponent():void 0,table):this.table.options.movableRowsSender&&console.warn("Mover Row Error - no matching sender found:",this.table.options.movableRowsSender),this.dispatchExternal("movableRowsSent",this.moving.getComponent(),row?row.getComponent():void 0,table)}else this.dispatchExternal("movableRowsSentFailed",this.moving.getComponent(),row?row.getComponent():void 0,table);this.endMove()}},{key:"tableRowDrop",value:function(e,row){var receiver=!1,success=!1;switch(e.stopImmediatePropagation(),_typeof(this.table.options.movableRowsReceiver)){case"string":receiver=this.receivers[this.table.options.movableRowsReceiver];break;case"function":receiver=this.table.options.movableRowsReceiver}receiver?success=receiver.call(this,this.connectedRow.getComponent(),row?row.getComponent():void 0,this.connectedTable):console.warn("Mover Row Error - no matching receiver found:",this.table.options.movableRowsReceiver),success?this.dispatchExternal("movableRowsReceived",this.connectedRow.getComponent(),row?row.getComponent():void 0,this.connectedTable):this.dispatchExternal("movableRowsReceivedFailed",this.connectedRow.getComponent(),row?row.getComponent():void 0,this.connectedTable),this.commsSend(this.connectedTable,"moveRow","dropcomplete",{row:row,success:success})}},{key:"commsReceived",value:function(table,action,data){switch(action){case"connect":return this.connect(table,data.row);case"disconnect":return this.disconnect(table);case"dropcomplete":return this.dropComplete(table,data.row,data.success)}}}]),MoveRows}(Module);_exports.MoveRowsModule=MoveRows,MoveRows.prototype.receivers={insert:function(fromRow,toRow,fromTable){return this.table.addRow(fromRow.getData(),void 0,toRow),!0},add:function(fromRow,toRow,fromTable){return this.table.addRow(fromRow.getData()),!0},update:function(fromRow,toRow,fromTable){return!!toRow&&(toRow.update(fromRow.getData()),!0)},replace:function(fromRow,toRow,fromTable){return!!toRow&&(this.table.addRow(fromRow.getData(),void 0,toRow),toRow.delete(),!0)}},MoveRows.prototype.senders={delete:function(fromRow,toRow,toTable){fromRow.delete()}},MoveRows.moduleName="moveRow";var Mutator=function(_Module22){_inherits(Mutator,_Module22);var _super27=_createSuper(Mutator);function Mutator(table){var _this119;return _classCallCheck(this,Mutator),(_this119=_super27.call(this,table)).allowedTypes=["","data","edit","clipboard"],_this119.enabled=!0,_this119.registerColumnOption("mutator"),_this119.registerColumnOption("mutatorParams"),_this119.registerColumnOption("mutatorData"),_this119.registerColumnOption("mutatorDataParams"),_this119.registerColumnOption("mutatorEdit"),_this119.registerColumnOption("mutatorEditParams"),_this119.registerColumnOption("mutatorClipboard"),_this119.registerColumnOption("mutatorClipboardParams"),_this119.registerColumnOption("mutateLink"),_this119}return _createClass(Mutator,[{key:"initialize",value:function(){this.subscribe("cell-value-changing",this.transformCell.bind(this)),this.subscribe("cell-value-changed",this.mutateLink.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-init-before",this.rowDataChanged.bind(this)),this.subscribe("row-data-changing",this.rowDataChanged.bind(this))}},{key:"rowDataChanged",value:function(row,tempData,updatedData){return this.transformRow(tempData,"data",updatedData)}},{key:"initializeColumn",value:function(column){var _this120=this,match=!1,config={};this.allowedTypes.forEach((function(type){var mutator,key="mutator"+(type.charAt(0).toUpperCase()+type.slice(1));column.definition[key]&&(mutator=_this120.lookupMutator(column.definition[key]))&&(match=!0,config[key]={mutator:mutator,params:column.definition[key+"Params"]||{}})})),match&&(column.modules.mutate=config)}},{key:"lookupMutator",value:function(value){var mutator=!1;switch(_typeof(value)){case"string":Mutator.mutators[value]?mutator=Mutator.mutators[value]:console.warn("Mutator Error - No such mutator found, ignoring: ",value);break;case"function":mutator=value}return mutator}},{key:"transformRow",value:function(data,type,updatedData){var value,key="mutator"+(type.charAt(0).toUpperCase()+type.slice(1));return this.enabled&&this.table.columnManager.traverse((function(column){var mutator,params,component;column.modules.mutate&&(mutator=column.modules.mutate[key]||column.modules.mutate.mutator||!1)&&(value=column.getFieldValue(void 0!==updatedData?updatedData:data),"data"!=type&&void 0===value||(component=column.getComponent(),params="function"==typeof mutator.params?mutator.params(value,data,type,component):mutator.params,column.setFieldValue(data,mutator.mutator(value,data,type,params,component))))})),data}},{key:"transformCell",value:function(cell,value){if(cell.column.modules.mutate){var mutator=cell.column.modules.mutate.mutatorEdit||cell.column.modules.mutate.mutator||!1,tempData={};if(mutator)return tempData=Object.assign(tempData,cell.row.getData()),cell.column.setFieldValue(tempData,value),mutator.mutator(value,tempData,"edit",mutator.params,cell.getComponent())}return value}},{key:"mutateLink",value:function(cell){var links=cell.column.definition.mutateLink;links&&(Array.isArray(links)||(links=[links]),links.forEach((function(link){var linkCell=cell.row.getCell(link);linkCell&&linkCell.setValue(linkCell.getValue(),!0,!0)})))}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1}}]),Mutator}(Module);_exports.MutatorModule=Mutator,Mutator.moduleName="mutator",Mutator.mutators={};var defaultPageCounters={rows:function(pageSize,currentRow,currentPage,totalRows,totalPages){var el=document.createElement("span"),showingEl=document.createElement("span"),valueEl=document.createElement("span"),ofEl=document.createElement("span"),totalEl=document.createElement("span"),rowsEl=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",(function(value){showingEl.innerHTML=value})),this.table.modules.localize.langBind("pagination|counter|of",(function(value){ofEl.innerHTML=value})),this.table.modules.localize.langBind("pagination|counter|rows",(function(value){rowsEl.innerHTML=value})),totalRows?(valueEl.innerHTML=" "+currentRow+"-"+Math.min(currentRow+pageSize-1,totalRows)+" ",totalEl.innerHTML=" "+totalRows+" ",el.appendChild(showingEl),el.appendChild(valueEl),el.appendChild(ofEl),el.appendChild(totalEl),el.appendChild(rowsEl)):(valueEl.innerHTML=" 0 ",el.appendChild(showingEl),el.appendChild(valueEl),el.appendChild(rowsEl)),el},pages:function(pageSize,currentRow,currentPage,totalRows,totalPages){var el=document.createElement("span"),showingEl=document.createElement("span"),valueEl=document.createElement("span"),ofEl=document.createElement("span"),totalEl=document.createElement("span"),rowsEl=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",(function(value){showingEl.innerHTML=value})),valueEl.innerHTML=" "+currentPage+" ",this.table.modules.localize.langBind("pagination|counter|of",(function(value){ofEl.innerHTML=value})),totalEl.innerHTML=" "+totalPages+" ",this.table.modules.localize.langBind("pagination|counter|pages",(function(value){rowsEl.innerHTML=value})),el.appendChild(showingEl),el.appendChild(valueEl),el.appendChild(ofEl),el.appendChild(totalEl),el.appendChild(rowsEl),el}},Page=function(_Module23){_inherits(Page,_Module23);var _super28=_createSuper(Page);function Page(table){var _this121;return _classCallCheck(this,Page),(_this121=_super28.call(this,table)).mode="local",_this121.progressiveLoad=!1,_this121.element=null,_this121.pageCounterElement=null,_this121.pageCounter=null,_this121.size=0,_this121.page=1,_this121.count=5,_this121.max=1,_this121.remoteRowCountEstimate=null,_this121.initialLoad=!0,_this121.dataChanging=!1,_this121.pageSizes=[],_this121.registerTableOption("pagination",!1),_this121.registerTableOption("paginationMode","local"),_this121.registerTableOption("paginationSize",!1),_this121.registerTableOption("paginationInitialPage",1),_this121.registerTableOption("paginationCounter",!1),_this121.registerTableOption("paginationCounterElement",!1),_this121.registerTableOption("paginationButtonCount",5),_this121.registerTableOption("paginationSizeSelector",!1),_this121.registerTableOption("paginationElement",!1),_this121.registerTableOption("paginationAddRow","page"),_this121.registerTableOption("progressiveLoad",!1),_this121.registerTableOption("progressiveLoadDelay",0),_this121.registerTableOption("progressiveLoadScrollMargin",0),_this121.registerTableFunction("setMaxPage",_this121.setMaxPage.bind(_assertThisInitialized(_this121))),_this121.registerTableFunction("setPage",_this121.setPage.bind(_assertThisInitialized(_this121))),_this121.registerTableFunction("setPageToRow",_this121.userSetPageToRow.bind(_assertThisInitialized(_this121))),_this121.registerTableFunction("setPageSize",_this121.userSetPageSize.bind(_assertThisInitialized(_this121))),_this121.registerTableFunction("getPageSize",_this121.getPageSize.bind(_assertThisInitialized(_this121))),_this121.registerTableFunction("previousPage",_this121.previousPage.bind(_assertThisInitialized(_this121))),_this121.registerTableFunction("nextPage",_this121.nextPage.bind(_assertThisInitialized(_this121))),_this121.registerTableFunction("getPage",_this121.getPage.bind(_assertThisInitialized(_this121))),_this121.registerTableFunction("getPageMax",_this121.getPageMax.bind(_assertThisInitialized(_this121))),_this121.registerComponentFunction("row","pageTo",_this121.setPageToRow.bind(_assertThisInitialized(_this121))),_this121}return _createClass(Page,[{key:"initialize",value:function(){this.table.options.pagination?(this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("footer-redraw",this.footerRedraw.bind(this)),"page"==this.table.options.paginationAddRow&&this.subscribe("row-adding-position",this.rowAddingPosition.bind(this)),"remote"===this.table.options.paginationMode&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this))),this.table.options.progressiveLoad&&console.error("Progressive Load Error - Pagination and progressive load cannot be used at the same time"),this.registerDisplayHandler(this.restOnRenderBefore.bind(this),40),this.registerDisplayHandler(this.getRows.bind(this),50),this.createElements(),this.initializePageCounter(),this.initializePaginator()):this.table.options.progressiveLoad&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.initializeProgressive(this.table.options.progressiveLoad),"scroll"===this.table.options.progressiveLoad&&this.subscribe("scroll-vertical",this.scrollVertical.bind(this)))}},{key:"rowAddingPosition",value:function(row,top){var index,rowManager=this.table.rowManager,displayRows=rowManager.getDisplayRows();return top?displayRows.length?index=displayRows[0]:rowManager.activeRows.length&&(index=rowManager.activeRows[rowManager.activeRows.length-1],top=!1):displayRows.length&&(index=displayRows[displayRows.length-1],top=!(displayRows.length<this.size)),{index:index,top:top}}},{key:"calculatePageSizes",value:function(){var testElRow,testElCell;this.table.options.paginationSize?this.size=this.table.options.paginationSize:((testElRow=document.createElement("div")).classList.add("tabulator-row"),testElRow.style.visibility="hidden",(testElCell=document.createElement("div")).classList.add("tabulator-cell"),testElCell.innerHTML="Page Row Test",testElRow.appendChild(testElCell),this.table.rowManager.getTableElement().appendChild(testElRow),this.size=Math.floor(this.table.rowManager.getElement().clientHeight/testElRow.offsetHeight),this.table.rowManager.getTableElement().removeChild(testElRow)),this.dispatchExternal("pageSizeChanged",this.size),this.generatePageSizeSelectList()}},{key:"initialLoadComplete",value:function(){this.initialLoad=!1}},{key:"remotePageParams",value:function(data,config,silent,params){return this.initialLoad||(this.progressiveLoad&&!silent||!this.progressiveLoad&&!this.dataChanging)&&this.reset(!0),params.page=this.page,this.size&&(params.size=this.size),params}},{key:"userSetPageToRow",value:function(row){return this.table.options.pagination&&(row=this.rowManager.findRow(row))?this.setPageToRow(row):Promise.reject()}},{key:"userSetPageSize",value:function(size){return!!this.table.options.pagination&&(this.setPageSize(size),this.setPage(1))}},{key:"scrollVertical",value:function(top,dir){var element;dir||this.table.dataLoader.loading||(element=this.table.rowManager.getElement()).scrollHeight-element.clientHeight-top<(this.table.options.progressiveLoadScrollMargin||2*element.clientHeight)&&this.nextPage().catch((function(){}))}},{key:"restOnRenderBefore",value:function(rows,renderInPosition){return renderInPosition||"local"===this.mode&&this.reset(),rows}},{key:"rowsUpdated",value:function(){this.refreshData(!0,"all")}},{key:"createElements",value:function(){var button;this.element=document.createElement("span"),this.element.classList.add("tabulator-paginator"),this.pagesElement=document.createElement("span"),this.pagesElement.classList.add("tabulator-pages"),(button=document.createElement("button")).classList.add("tabulator-page"),button.setAttribute("type","button"),button.setAttribute("role","button"),button.setAttribute("aria-label",""),button.setAttribute("title",""),this.firstBut=button.cloneNode(!0),this.firstBut.setAttribute("data-page","first"),this.prevBut=button.cloneNode(!0),this.prevBut.setAttribute("data-page","prev"),this.nextBut=button.cloneNode(!0),this.nextBut.setAttribute("data-page","next"),this.lastBut=button.cloneNode(!0),this.lastBut.setAttribute("data-page","last"),this.table.options.paginationSizeSelector&&(this.pageSizeSelect=document.createElement("select"),this.pageSizeSelect.classList.add("tabulator-page-size"))}},{key:"generatePageSizeSelectList",value:function(){var _this122=this,pageSizes=[];if(this.pageSizeSelect){if(Array.isArray(this.table.options.paginationSizeSelector))pageSizes=this.table.options.paginationSizeSelector,this.pageSizes=pageSizes,-1==this.pageSizes.indexOf(this.size)&&pageSizes.unshift(this.size);else if(-1==this.pageSizes.indexOf(this.size)){pageSizes=[];for(var i=1;i<5;i++)pageSizes.push(this.size*i);this.pageSizes=pageSizes}else pageSizes=this.pageSizes;for(;this.pageSizeSelect.firstChild;)this.pageSizeSelect.removeChild(this.pageSizeSelect.firstChild);pageSizes.forEach((function(item){var itemEl=document.createElement("option");itemEl.value=item,!0===item?_this122.langBind("pagination|all",(function(value){itemEl.innerHTML=value})):itemEl.innerHTML=item,_this122.pageSizeSelect.appendChild(itemEl)})),this.pageSizeSelect.value=this.size}}},{key:"initializePageCounter",value:function(){var counter=this.table.options.paginationCounter,pageCounter=null;counter&&((pageCounter="function"==typeof counter?counter:Page.pageCounters[counter])?(this.pageCounter=pageCounter,this.pageCounterElement=document.createElement("span"),this.pageCounterElement.classList.add("tabulator-page-counter")):console.warn("Pagination Error - No such page counter found: ",counter))}},{key:"initializePaginator",value:function(hidden){var pageSelectLabel,paginationCounterHolder,_this123=this;hidden||(this.langBind("pagination|first",(function(value){_this123.firstBut.innerHTML=value})),this.langBind("pagination|first_title",(function(value){_this123.firstBut.setAttribute("aria-label",value),_this123.firstBut.setAttribute("title",value)})),this.langBind("pagination|prev",(function(value){_this123.prevBut.innerHTML=value})),this.langBind("pagination|prev_title",(function(value){_this123.prevBut.setAttribute("aria-label",value),_this123.prevBut.setAttribute("title",value)})),this.langBind("pagination|next",(function(value){_this123.nextBut.innerHTML=value})),this.langBind("pagination|next_title",(function(value){_this123.nextBut.setAttribute("aria-label",value),_this123.nextBut.setAttribute("title",value)})),this.langBind("pagination|last",(function(value){_this123.lastBut.innerHTML=value})),this.langBind("pagination|last_title",(function(value){_this123.lastBut.setAttribute("aria-label",value),_this123.lastBut.setAttribute("title",value)})),this.firstBut.addEventListener("click",(function(){_this123.setPage(1)})),this.prevBut.addEventListener("click",(function(){_this123.previousPage()})),this.nextBut.addEventListener("click",(function(){_this123.nextPage()})),this.lastBut.addEventListener("click",(function(){_this123.setPage(_this123.max)})),this.table.options.paginationElement&&(this.element=this.table.options.paginationElement),this.pageSizeSelect&&(pageSelectLabel=document.createElement("label"),this.langBind("pagination|page_size",(function(value){_this123.pageSizeSelect.setAttribute("aria-label",value),_this123.pageSizeSelect.setAttribute("title",value),pageSelectLabel.innerHTML=value})),this.element.appendChild(pageSelectLabel),this.element.appendChild(this.pageSizeSelect),this.pageSizeSelect.addEventListener("change",(function(e){_this123.setPageSize("true"==_this123.pageSizeSelect.value||_this123.pageSizeSelect.value),_this123.setPage(1)}))),this.element.appendChild(this.firstBut),this.element.appendChild(this.prevBut),this.element.appendChild(this.pagesElement),this.element.appendChild(this.nextBut),this.element.appendChild(this.lastBut),this.table.options.paginationElement||(this.table.options.paginationCounter&&(this.table.options.paginationCounterElement?this.table.options.paginationCounterElement instanceof HTMLElement?this.table.options.paginationCounterElement.appendChild(this.pageCounterElement):"string"==typeof this.table.options.paginationCounterElement&&((paginationCounterHolder=document.querySelector(this.table.options.paginationCounterElement))?paginationCounterHolder.appendChild(this.pageCounterElement):console.warn("Pagination Error - Unable to find element matching paginationCounterElement selector:",this.table.options.paginationCounterElement)):this.footerAppend(this.pageCounterElement)),this.footerAppend(this.element)),this.page=this.table.options.paginationInitialPage,this.count=this.table.options.paginationButtonCount),this.mode=this.table.options.paginationMode}},{key:"initializeProgressive",value:function(mode){this.initializePaginator(!0),this.mode="progressive_"+mode,this.progressiveLoad=!0}},{key:"trackChanges",value:function(){this.dispatch("page-changed")}},{key:"setMaxRows",value:function(rowCount){this.max=rowCount?!0===this.size?1:Math.ceil(rowCount/this.size):1,this.page>this.max&&(this.page=this.max)}},{key:"reset",value:function(force){this.initialLoad||("local"==this.mode||force)&&(this.page=1,this.trackChanges())}},{key:"setMaxPage",value:function(max){max=parseInt(max),this.max=max||1,this.page>this.max&&(this.page=this.max,this.trigger())}},{key:"setPage",value:function(page){switch(page){case"first":return this.setPage(1);case"prev":return this.previousPage();case"next":return this.nextPage();case"last":return this.setPage(this.max)}return(page=parseInt(page))>0&&page<=this.max||"local"!==this.mode?(this.page=page,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Requested page is out of range of 1 - "+this.max+":",page),Promise.reject())}},{key:"setPageToRow",value:function(row){var index=this.displayRows(-1).indexOf(row);if(index>-1){var page=!0===this.size?1:Math.ceil((index+1)/this.size);return this.setPage(page)}return console.warn("Pagination Error - Requested row is not visible"),Promise.reject()}},{key:"setPageSize",value:function(size){!0!==size&&(size=parseInt(size)),size>0&&(this.size=size,this.dispatchExternal("pageSizeChanged",size)),this.pageSizeSelect&&this.generatePageSizeSelectList(),this.trackChanges()}},{key:"_setPageCounter",value:function(totalRows,size,currentRow){var content;if(this.pageCounter)switch("remote"===this.mode&&(size=this.size,currentRow=(this.page-1)*this.size+1,totalRows=this.remoteRowCountEstimate),_typeof(content=this.pageCounter.call(this,size,currentRow,this.page,totalRows,this.max))){case"object":if(content instanceof Node){for(;this.pageCounterElement.firstChild;)this.pageCounterElement.removeChild(this.pageCounterElement.firstChild);this.pageCounterElement.appendChild(content)}else this.pageCounterElement.innerHTML="",null!=content&&console.warn("Page Counter Error - Page Counter has returned a type of object, the only valid page counter object return is an instance of Node, the page counter returned:",content);break;case"undefined":this.pageCounterElement.innerHTML="";break;default:this.pageCounterElement.innerHTML=content}}},{key:"_setPageButtons",value:function(){for(var leftSize=Math.floor((this.count-1)/2),rightSize=Math.ceil((this.count-1)/2),min=this.max-this.page+leftSize+1<this.count?this.max-this.count+1:Math.max(this.page-leftSize,1),max=this.page<=rightSize?Math.min(this.count,this.max):Math.min(this.page+rightSize,this.max);this.pagesElement.firstChild;)this.pagesElement.removeChild(this.pagesElement.firstChild);1==this.page?(this.firstBut.disabled=!0,this.prevBut.disabled=!0):(this.firstBut.disabled=!1,this.prevBut.disabled=!1),this.page==this.max?(this.lastBut.disabled=!0,this.nextBut.disabled=!0):(this.lastBut.disabled=!1,this.nextBut.disabled=!1);for(var i=min;i<=max;i++)i>0&&i<=this.max&&this.pagesElement.appendChild(this._generatePageButton(i));this.footerRedraw()}},{key:"_generatePageButton",value:function(page){var _this124=this,button=document.createElement("button");return button.classList.add("tabulator-page"),page==this.page&&button.classList.add("active"),button.setAttribute("type","button"),button.setAttribute("role","button"),this.langBind("pagination|page_title",(function(value){button.setAttribute("aria-label",value+" "+page),button.setAttribute("title",value+" "+page)})),button.setAttribute("data-page",page),button.textContent=page,button.addEventListener("click",(function(e){_this124.setPage(page)})),button}},{key:"previousPage",value:function(){return this.page>1?(this.page--,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Previous page would be less than page 1:",0),Promise.reject())}},{key:"nextPage",value:function(){return this.page<this.max?(this.page++,this.trackChanges(),this.trigger()):(this.progressiveLoad||console.warn("Pagination Error - Next page would be greater than maximum page of "+this.max+":",this.max+1),Promise.reject())}},{key:"getPage",value:function(){return this.page}},{key:"getPageMax",value:function(){return this.max}},{key:"getPageSize",value:function(size){return this.size}},{key:"getMode",value:function(){return this.mode}},{key:"getRows",value:function(data){var output,start,end,actualStartRow,actualRowPageSize=0,actualRows=data.filter((function(row){return"row"===row.type}));if("local"==this.mode){output=[],this.setMaxRows(data.length),!0===this.size?(start=0,end=data.length):end=(start=this.size*(this.page-1))+parseInt(this.size),this._setPageButtons();for(var i=start;i<end;i++){var row=data[i];row&&(output.push(row),"row"===row.type&&(actualStartRow||(actualStartRow=row),actualRowPageSize++))}return this._setPageCounter(actualRows.length,actualRowPageSize,actualStartRow?actualRows.indexOf(actualStartRow)+1:0),output}return this._setPageButtons(),this._setPageCounter(actualRows.length),data.slice(0)}},{key:"trigger",value:function(){var left,_this125=this;switch(this.mode){case"local":return left=this.table.rowManager.scrollLeft,this.refreshData(),this.table.rowManager.scrollHorizontal(left),this.dispatchExternal("pageLoaded",this.getPage()),Promise.resolve();case"remote":return this.dataChanging=!0,this.reloadData(null).finally((function(){_this125.dataChanging=!1}));case"progressive_load":case"progressive_scroll":return this.reloadData(null,!0);default:return console.warn("Pagination Error - no such pagination mode:",this.mode),Promise.reject()}}},{key:"_parseRemoteData",value:function(data){var margin,_this126=this;if(void 0===data.last_page&&console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").last_page||"last_page")+"' property"),data.data){if(this.max=parseInt(data.last_page)||1,this.remoteRowCountEstimate=void 0!==data.last_row?data.last_row:data.last_page*this.size-(this.page==data.last_page?this.size-data.data.length:0),this.progressiveLoad){switch(this.mode){case"progressive_load":1==this.page?this.table.rowManager.setData(data.data,!1,1==this.page):this.table.rowManager.addRows(data.data),this.page<this.max&&setTimeout((function(){_this126.nextPage()}),this.table.options.progressiveLoadDelay);break;case"progressive_scroll":data=1===this.page?data.data:this.table.rowManager.getData().concat(data.data),this.table.rowManager.setData(data,1!==this.page,1==this.page),margin=this.table.options.progressiveLoadScrollMargin||2*this.table.rowManager.element.clientHeight,this.table.rowManager.element.scrollHeight<=this.table.rowManager.element.clientHeight+margin&&this.page<this.max&&setTimeout((function(){_this126.nextPage()}))}return!1}this.dispatchExternal("pageLoaded",this.getPage())}else console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").data||"data")+"' property");return data.data}},{key:"footerRedraw",value:function(){var footer=this.table.footerManager.containerElement;Math.ceil(footer.clientWidth)-footer.scrollWidth<0?this.pagesElement.style.display="none":(this.pagesElement.style.display="",Math.ceil(footer.clientWidth)-footer.scrollWidth<0&&(this.pagesElement.style.display="none"))}}]),Page}(Module);_exports.PageModule=Page,Page.moduleName="page",Page.pageCounters=defaultPageCounters;var defaultReaders={local:function(id,type){var data=localStorage.getItem(id+"-"+type);return!!data&&JSON.parse(data)},cookie:function(id,type){var end,data,cookie=document.cookie,key=id+"-"+type,cookiePos=cookie.indexOf(key+"=");return cookiePos>-1&&(cookie=cookie.slice(cookiePos),(end=cookie.indexOf(";"))>-1&&(cookie=cookie.slice(0,end)),data=cookie.replace(key+"=","")),!!data&&JSON.parse(data)}},defaultWriters={local:function(id,type,data){localStorage.setItem(id+"-"+type,JSON.stringify(data))},cookie:function(id,type,data){var expireDate=new Date;expireDate.setDate(expireDate.getDate()+1e4),document.cookie=id+"-"+type+"="+JSON.stringify(data)+"; expires="+expireDate.toUTCString()}},Persistence=function(_Module24){_inherits(Persistence,_Module24);var _super29=_createSuper(Persistence);function Persistence(table){var _this127;return _classCallCheck(this,Persistence),(_this127=_super29.call(this,table)).mode="",_this127.id="",_this127.defWatcherBlock=!1,_this127.config={},_this127.readFunc=!1,_this127.writeFunc=!1,_this127.registerTableOption("persistence",!1),_this127.registerTableOption("persistenceID",""),_this127.registerTableOption("persistenceMode",!0),_this127.registerTableOption("persistenceReaderFunc",!1),_this127.registerTableOption("persistenceWriterFunc",!1),_this127}return _createClass(Persistence,[{key:"localStorageTest",value:function(){var testKey="_tabulator_test";try{return window.localStorage.setItem(testKey,testKey),window.localStorage.removeItem(testKey),!0}catch(e){return!1}}},{key:"initialize",value:function(){if(this.table.options.persistence){var retrievedData,mode=this.table.options.persistenceMode,id=this.table.options.persistenceID;this.mode=!0!==mode?mode:this.localStorageTest()?"local":"cookie",this.table.options.persistenceReaderFunc?"function"==typeof this.table.options.persistenceReaderFunc?this.readFunc=this.table.options.persistenceReaderFunc:Persistence.readers[this.table.options.persistenceReaderFunc]?this.readFunc=Persistence.readers[this.table.options.persistenceReaderFunc]:console.warn("Persistence Read Error - invalid reader set",this.table.options.persistenceReaderFunc):Persistence.readers[this.mode]?this.readFunc=Persistence.readers[this.mode]:console.warn("Persistence Read Error - invalid reader set",this.mode),this.table.options.persistenceWriterFunc?"function"==typeof this.table.options.persistenceWriterFunc?this.writeFunc=this.table.options.persistenceWriterFunc:Persistence.writers[this.table.options.persistenceWriterFunc]?this.writeFunc=Persistence.writers[this.table.options.persistenceWriterFunc]:console.warn("Persistence Write Error - invalid reader set",this.table.options.persistenceWriterFunc):Persistence.writers[this.mode]?this.writeFunc=Persistence.writers[this.mode]:console.warn("Persistence Write Error - invalid writer set",this.mode),this.id="tabulator-"+(id||this.table.element.getAttribute("id")||""),this.config={sort:!0===this.table.options.persistence||this.table.options.persistence.sort,filter:!0===this.table.options.persistence||this.table.options.persistence.filter,group:!0===this.table.options.persistence||this.table.options.persistence.group,page:!0===this.table.options.persistence||this.table.options.persistence.page,columns:!0===this.table.options.persistence?["title","width","visible"]:this.table.options.persistence.columns},this.config.page&&(retrievedData=this.retrieveData("page"))&&(void 0===retrievedData.paginationSize||!0!==this.config.page&&!this.config.page.size||(this.table.options.paginationSize=retrievedData.paginationSize),void 0===retrievedData.paginationInitialPage||!0!==this.config.page&&!this.config.page.page||(this.table.options.paginationInitialPage=retrievedData.paginationInitialPage)),this.config.group&&(retrievedData=this.retrieveData("group"))&&(void 0===retrievedData.groupBy||!0!==this.config.group&&!this.config.group.groupBy||(this.table.options.groupBy=retrievedData.groupBy),void 0===retrievedData.groupStartOpen||!0!==this.config.group&&!this.config.group.groupStartOpen||(this.table.options.groupStartOpen=retrievedData.groupStartOpen),void 0===retrievedData.groupHeader||!0!==this.config.group&&!this.config.group.groupHeader||(this.table.options.groupHeader=retrievedData.groupHeader)),this.config.columns&&(this.table.options.columns=this.load("columns",this.table.options.columns),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-show",this.save.bind(this,"columns")),this.subscribe("column-hide",this.save.bind(this,"columns")),this.subscribe("column-moved",this.save.bind(this,"columns"))),this.subscribe("table-built",this.tableBuilt.bind(this),0),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("filter-changed",this.eventSave.bind(this,"filter")),this.subscribe("sort-changed",this.eventSave.bind(this,"sort")),this.subscribe("group-changed",this.eventSave.bind(this,"group")),this.subscribe("page-changed",this.eventSave.bind(this,"page")),this.subscribe("column-resized",this.eventSave.bind(this,"columns")),this.subscribe("column-width",this.eventSave.bind(this,"columns")),this.subscribe("layout-refreshed",this.eventSave.bind(this,"columns"))}this.registerTableFunction("getColumnLayout",this.getColumnLayout.bind(this)),this.registerTableFunction("setColumnLayout",this.setColumnLayout.bind(this))}},{key:"eventSave",value:function(type){this.config[type]&&this.save(type)}},{key:"tableBuilt",value:function(){var sorters,filters;this.config.sort&&!1==!(sorters=this.load("sort"))&&(this.table.options.initialSort=sorters),this.config.filter&&!1==!(filters=this.load("filter"))&&(this.table.options.initialFilter=filters)}},{key:"tableRedraw",value:function(force){force&&this.config.columns&&this.save("columns")}},{key:"getColumnLayout",value:function(){return this.parseColumns(this.table.columnManager.getColumns())}},{key:"setColumnLayout",value:function(layout){return this.table.columnManager.setColumns(this.mergeDefinition(this.table.options.columns,layout)),!0}},{key:"initializeColumn",value:function(column){var def,_this128=this;this.config.columns&&(this.defWatcherBlock=!0,def=column.getDefinition(),(!0===this.config.columns?Object.keys(def):this.config.columns).forEach((function(key){var props=Object.getOwnPropertyDescriptor(def,key),value=def[key];props&&Object.defineProperty(def,key,{set:function(newValue){value=newValue,_this128.defWatcherBlock||_this128.save("columns"),props.set&&props.set(newValue)},get:function(){return props.get&&props.get(),value}})})),this.defWatcherBlock=!1)}},{key:"load",value:function(type,current){var data=this.retrieveData(type);return current&&(data=data?this.mergeDefinition(current,data):current),data}},{key:"retrieveData",value:function(type){return!!this.readFunc&&this.readFunc(this.id,type)}},{key:"mergeDefinition",value:function(oldCols,newCols){var _this129=this,output=[];return(newCols=newCols||[]).forEach((function(column,to){var keys,from=_this129._findColumn(oldCols,column);from&&(!0===_this129.config.columns||null==_this129.config.columns?(keys=Object.keys(from)).push("width"):keys=_this129.config.columns,keys.forEach((function(key){"columns"!==key&&void 0!==column[key]&&(from[key]=column[key])})),from.columns&&(from.columns=_this129.mergeDefinition(from.columns,column.columns)),output.push(from))})),oldCols.forEach((function(column,i){_this129._findColumn(newCols,column)||(output.length>i?output.splice(i,0,column):output.push(column))})),output}},{key:"_findColumn",value:function(columns,subject){var type=subject.columns?"group":subject.field?"field":"object";return columns.find((function(col){switch(type){case"group":return col.title===subject.title&&col.columns.length===subject.columns.length;case"field":return col.field===subject.field;case"object":return col===subject}}))}},{key:"save",value:function(type){var data={};switch(type){case"columns":data=this.parseColumns(this.table.columnManager.getColumns());break;case"filter":data=this.table.modules.filter.getFilters();break;case"sort":data=this.validateSorters(this.table.modules.sort.getSort());break;case"group":data=this.getGroupConfig();break;case"page":data=this.getPageConfig()}this.writeFunc&&this.writeFunc(this.id,type,data)}},{key:"validateSorters",value:function(data){return data.forEach((function(item){item.column=item.field,delete item.field})),data}},{key:"getGroupConfig",value:function(){var data={};return this.config.group&&((!0===this.config.group||this.config.group.groupBy)&&(data.groupBy=this.table.options.groupBy),(!0===this.config.group||this.config.group.groupStartOpen)&&(data.groupStartOpen=this.table.options.groupStartOpen),(!0===this.config.group||this.config.group.groupHeader)&&(data.groupHeader=this.table.options.groupHeader)),data}},{key:"getPageConfig",value:function(){var data={};return this.config.page&&((!0===this.config.page||this.config.page.size)&&(data.paginationSize=this.table.modules.page.getPageSize()),(!0===this.config.page||this.config.page.page)&&(data.paginationInitialPage=this.table.modules.page.getPage())),data}},{key:"parseColumns",value:function(columns){var _this130=this,definitions=[],excludedKeys=["headerContextMenu","headerMenu","contextMenu","clickMenu"];return columns.forEach((function(column){var keys,defStore={},colDef=column.getDefinition();column.isGroup?(defStore.title=colDef.title,defStore.columns=_this130.parseColumns(column.getColumns())):(defStore.field=column.getField(),!0===_this130.config.columns||null==_this130.config.columns?((keys=Object.keys(colDef)).push("width"),keys.push("visible")):keys=_this130.config.columns,keys.forEach((function(key){switch(key){case"width":defStore.width=column.getWidth();break;case"visible":defStore.visible=column.visible;break;default:"function"!=typeof colDef[key]&&-1===excludedKeys.indexOf(key)&&(defStore[key]=colDef[key])}}))),definitions.push(defStore)})),definitions}}]),Persistence}(Module);_exports.PersistenceModule=Persistence,Persistence.moduleName="persistence",Persistence.moduleInitOrder=-10,Persistence.readers=defaultReaders,Persistence.writers=defaultWriters;var Popup$1=function(_Module25){_inherits(Popup$1,_Module25);var _super30=_createSuper(Popup$1);function Popup$1(table){var _this131;return _classCallCheck(this,Popup$1),(_this131=_super30.call(this,table)).columnSubscribers={},_this131.registerTableOption("rowContextPopup",!1),_this131.registerTableOption("rowClickPopup",!1),_this131.registerTableOption("rowDblClickPopup",!1),_this131.registerTableOption("groupContextPopup",!1),_this131.registerTableOption("groupClickPopup",!1),_this131.registerTableOption("groupDblClickPopup",!1),_this131.registerColumnOption("headerContextPopup"),_this131.registerColumnOption("headerClickPopup"),_this131.registerColumnOption("headerDblClickPopup"),_this131.registerColumnOption("headerPopup"),_this131.registerColumnOption("headerPopupIcon"),_this131.registerColumnOption("contextPopup"),_this131.registerColumnOption("clickPopup"),_this131.registerColumnOption("dblClickPopup"),_this131.registerComponentFunction("cell","popup",_this131._componentPopupCall.bind(_assertThisInitialized(_this131))),_this131.registerComponentFunction("column","popup",_this131._componentPopupCall.bind(_assertThisInitialized(_this131))),_this131.registerComponentFunction("row","popup",_this131._componentPopupCall.bind(_assertThisInitialized(_this131))),_this131.registerComponentFunction("group","popup",_this131._componentPopupCall.bind(_assertThisInitialized(_this131))),_this131}return _createClass(Popup$1,[{key:"initialize",value:function(){this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}},{key:"_componentPopupCall",value:function(component,contents,position){this.loadPopupEvent(contents,null,component,position)}},{key:"initializeRowWatchers",value:function(){this.table.options.rowContextPopup&&(this.subscribe("row-contextmenu",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup)),this.table.on("rowTapHold",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup))),this.table.options.rowClickPopup&&this.subscribe("row-click",this.loadPopupEvent.bind(this,this.table.options.rowClickPopup)),this.table.options.rowDblClickPopup&&this.subscribe("row-dblclick",this.loadPopupEvent.bind(this,this.table.options.rowDblClickPopup))}},{key:"initializeGroupWatchers",value:function(){this.table.options.groupContextPopup&&(this.subscribe("group-contextmenu",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup)),this.table.on("groupTapHold",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup))),this.table.options.groupClickPopup&&this.subscribe("group-click",this.loadPopupEvent.bind(this,this.table.options.groupClickPopup)),this.table.options.groupDblClickPopup&&this.subscribe("group-dblclick",this.loadPopupEvent.bind(this,this.table.options.groupDblClickPopup))}},{key:"initializeColumn",value:function(column){var def=column.definition;def.headerContextPopup&&!this.columnSubscribers.headerContextPopup&&(this.columnSubscribers.headerContextPopup=this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextPopup),this.table.on("headerTapHold",this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"))),def.headerClickPopup&&!this.columnSubscribers.headerClickPopup&&(this.columnSubscribers.headerClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerClickPopup"),this.subscribe("column-click",this.columnSubscribers.headerClickPopup)),def.headerDblClickPopup&&!this.columnSubscribers.headerDblClickPopup&&(this.columnSubscribers.headerDblClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerDblClickPopup"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickPopup)),def.headerPopup&&this.initializeColumnHeaderPopup(column),def.contextPopup&&!this.columnSubscribers.contextPopup&&(this.columnSubscribers.contextPopup=this.loadPopupTableCellEvent.bind(this,"contextPopup"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextPopup),this.table.on("cellTapHold",this.loadPopupTableCellEvent.bind(this,"contextPopup"))),def.clickPopup&&!this.columnSubscribers.clickPopup&&(this.columnSubscribers.clickPopup=this.loadPopupTableCellEvent.bind(this,"clickPopup"),this.subscribe("cell-click",this.columnSubscribers.clickPopup)),def.dblClickPopup&&!this.columnSubscribers.dblClickPopup&&(this.columnSubscribers.dblClickPopup=this.loadPopupTableCellEvent.bind(this,"dblClickPopup"),this.subscribe("cell-click",this.columnSubscribers.dblClickPopup))}},{key:"initializeColumnHeaderPopup",value:function(column){var headerPopupEl,_this132=this,icon=column.definition.headerPopupIcon;(headerPopupEl=document.createElement("span")).classList.add("tabulator-header-popup-button"),icon?("function"==typeof icon&&(icon=icon(column.getComponent())),icon instanceof HTMLElement?headerPopupEl.appendChild(icon):headerPopupEl.innerHTML=icon):headerPopupEl.innerHTML="&vellip;",headerPopupEl.addEventListener("click",(function(e){e.stopPropagation(),e.preventDefault(),_this132.loadPopupEvent(column.definition.headerPopup,e,column)})),column.titleElement.insertBefore(headerPopupEl,column.titleElement.firstChild)}},{key:"loadPopupTableCellEvent",value:function(option,e,cell){cell._cell&&(cell=cell._cell),cell.column.definition[option]&&this.loadPopupEvent(cell.column.definition[option],e,cell)}},{key:"loadPopupTableColumnEvent",value:function(option,e,column){column._column&&(column=column._column),column.definition[option]&&this.loadPopupEvent(column.definition[option],e,column)}},{key:"loadPopupEvent",value:function(contents,e,component,position){var renderedCallback;component._group?component=component._group:component._row&&(component=component._row),contents="function"==typeof contents?contents.call(this.table,e,component.getComponent(),(function(callback){renderedCallback=callback})):contents,this.loadPopup(e,component,contents,renderedCallback,position)}},{key:"loadPopup",value:function(e,component,contents,renderedCallback,position){var contentsEl,popup,_this133=this,touch=!(e instanceof MouseEvent);contents instanceof HTMLElement?contentsEl=contents:(contentsEl=document.createElement("div")).innerHTML=contents,contentsEl.classList.add("tabulator-popup"),contentsEl.addEventListener("click",(function(e){e.stopPropagation()})),touch||e.preventDefault(),popup=this.popup(contentsEl),"function"==typeof renderedCallback&&popup.renderCallback(renderedCallback),e?popup.show(e):popup.show(component.getElement(),position||"center"),popup.hideOnBlur((function(){_this133.dispatchExternal("popupClosed",component.getComponent())})),this.dispatchExternal("popupOpened",component.getComponent())}}]),Popup$1}(Module);_exports.PopupModule=Popup$1,Popup$1.moduleName="popup";var Print=function(_Module26){_inherits(Print,_Module26);var _super31=_createSuper(Print);function Print(table){var _this134;return _classCallCheck(this,Print),(_this134=_super31.call(this,table)).element=!1,_this134.manualBlock=!1,_this134.registerTableOption("printAsHtml",!1),_this134.registerTableOption("printFormatter",!1),_this134.registerTableOption("printHeader",!1),_this134.registerTableOption("printFooter",!1),_this134.registerTableOption("printStyled",!0),_this134.registerTableOption("printRowRange","visible"),_this134.registerTableOption("printConfig",{}),_this134.registerColumnOption("print"),_this134.registerColumnOption("titlePrint"),_this134}return _createClass(Print,[{key:"initialize",value:function(){this.table.options.printAsHtml&&(window.addEventListener("beforeprint",this.replaceTable.bind(this)),window.addEventListener("afterprint",this.cleanup.bind(this))),this.registerTableFunction("print",this.printFullscreen.bind(this))}},{key:"replaceTable",value:function(){this.manualBlock||(this.element=document.createElement("div"),this.element.classList.add("tabulator-print-table"),this.element.appendChild(this.table.modules.export.generateTable(this.table.options.printConfig,this.table.options.printStyled,this.table.options.printRowRange,"print")),this.table.element.style.display="none",this.table.element.parentNode.insertBefore(this.element,this.table.element))}},{key:"cleanup",value:function(){document.body.classList.remove("tabulator-print-fullscreen-hide"),this.element&&this.element.parentNode&&(this.element.parentNode.removeChild(this.element),this.table.element.style.display="")}},{key:"printFullscreen",value:function(visible,style,config){var headerContent,footerContent,scrollX=window.scrollX,scrollY=window.scrollY,headerEl=document.createElement("div"),footerEl=document.createElement("div"),tableEl=this.table.modules.export.generateTable(void 0!==config?config:this.table.options.printConfig,void 0!==style?style:this.table.options.printStyled,visible||this.table.options.printRowRange,"print");this.manualBlock=!0,this.element=document.createElement("div"),this.element.classList.add("tabulator-print-fullscreen"),this.table.options.printHeader&&(headerEl.classList.add("tabulator-print-header"),"string"==typeof(headerContent="function"==typeof this.table.options.printHeader?this.table.options.printHeader.call(this.table):this.table.options.printHeader)?headerEl.innerHTML=headerContent:headerEl.appendChild(headerContent),this.element.appendChild(headerEl)),this.element.appendChild(tableEl),this.table.options.printFooter&&(footerEl.classList.add("tabulator-print-footer"),"string"==typeof(footerContent="function"==typeof this.table.options.printFooter?this.table.options.printFooter.call(this.table):this.table.options.printFooter)?footerEl.innerHTML=footerContent:footerEl.appendChild(footerContent),this.element.appendChild(footerEl)),document.body.classList.add("tabulator-print-fullscreen-hide"),document.body.appendChild(this.element),this.table.options.printFormatter&&this.table.options.printFormatter(this.element,tableEl),window.print(),this.cleanup(),window.scrollTo(scrollX,scrollY),this.manualBlock=!1}}]),Print}(Module);_exports.PrintModule=Print,Print.moduleName="print";var ReactiveData=function(_Module27){_inherits(ReactiveData,_Module27);var _super32=_createSuper(ReactiveData);function ReactiveData(table){var _this135;return _classCallCheck(this,ReactiveData),(_this135=_super32.call(this,table)).data=!1,_this135.blocked=!1,_this135.origFuncs={},_this135.currentVersion=0,_this135.registerTableOption("reactiveData",!1),_this135}return _createClass(ReactiveData,[{key:"initialize",value:function(){this.table.options.reactiveData&&(this.subscribe("cell-value-save-before",this.block.bind(this,"cellsave")),this.subscribe("cell-value-save-after",this.unblock.bind(this,"cellsave")),this.subscribe("row-data-save-before",this.block.bind(this,"rowsave")),this.subscribe("row-data-save-after",this.unblock.bind(this,"rowsave")),this.subscribe("row-data-init-after",this.watchRow.bind(this)),this.subscribe("data-processing",this.watchData.bind(this)),this.subscribe("table-destroy",this.unwatchData.bind(this)))}},{key:"watchData",value:function(data){var version,self=this;this.currentVersion++,version=this.currentVersion,this.unwatchData(),this.data=data,this.origFuncs.push=data.push,Object.defineProperty(this.data,"push",{enumerable:!1,configurable:!0,value:function(){var result,args=Array.from(arguments);return self.blocked||version!==self.currentVersion||(self.block("data-push"),args.forEach((function(arg){self.table.rowManager.addRowActual(arg,!1)})),result=self.origFuncs.push.apply(data,arguments),self.unblock("data-push")),result}}),this.origFuncs.unshift=data.unshift,Object.defineProperty(this.data,"unshift",{enumerable:!1,configurable:!0,value:function(){var result,args=Array.from(arguments);return self.blocked||version!==self.currentVersion||(self.block("data-unshift"),args.forEach((function(arg){self.table.rowManager.addRowActual(arg,!0)})),result=self.origFuncs.unshift.apply(data,arguments),self.unblock("data-unshift")),result}}),this.origFuncs.shift=data.shift,Object.defineProperty(this.data,"shift",{enumerable:!1,configurable:!0,value:function(){var row,result;return self.blocked||version!==self.currentVersion||(self.block("data-shift"),self.data.length&&(row=self.table.rowManager.getRowFromDataObject(self.data[0]))&&row.deleteActual(),result=self.origFuncs.shift.call(data),self.unblock("data-shift")),result}}),this.origFuncs.pop=data.pop,Object.defineProperty(this.data,"pop",{enumerable:!1,configurable:!0,value:function(){var row,result;return self.blocked||version!==self.currentVersion||(self.block("data-pop"),self.data.length&&(row=self.table.rowManager.getRowFromDataObject(self.data[self.data.length-1]))&&row.deleteActual(),result=self.origFuncs.pop.call(data),self.unblock("data-pop")),result}}),this.origFuncs.splice=data.splice,Object.defineProperty(this.data,"splice",{enumerable:!1,configurable:!0,value:function(){var startRow,result,args=Array.from(arguments),start=args[0]<0?data.length+args[0]:args[0],end=args[1],newRows=!!args[2]&&args.slice(2);if(!self.blocked&&version===self.currentVersion){if(self.block("data-splice"),newRows&&((startRow=!!data[start]&&self.table.rowManager.getRowFromDataObject(data[start]))?newRows.forEach((function(rowData){self.table.rowManager.addRowActual(rowData,!0,startRow,!0)})):(newRows=newRows.slice().reverse()).forEach((function(rowData){self.table.rowManager.addRowActual(rowData,!0,!1,!0)}))),0!==end){var oldRows=data.slice(start,void 0===args[1]?args[1]:start+end);oldRows.forEach((function(rowData,i){var row=self.table.rowManager.getRowFromDataObject(rowData);row&&row.deleteActual(i!==oldRows.length-1)}))}(newRows||0!==end)&&self.table.rowManager.reRenderInPosition(),result=self.origFuncs.splice.apply(data,arguments),self.unblock("data-splice")}return result}})}},{key:"unwatchData",value:function(){if(!1!==this.data)for(var key in this.origFuncs)Object.defineProperty(this.data,key,{enumerable:!0,configurable:!0,writable:!0,value:this.origFuncs.key})}},{key:"watchRow",value:function(row){var data=row.getData();for(var key in data)this.watchKey(row,data,key);this.table.options.dataTree&&this.watchTreeChildren(row)}},{key:"watchTreeChildren",value:function(row){var _arguments=arguments,_this136=this,self=this,childField=row.getData()[this.table.options.dataTreeChildField],origFuncs={};childField&&(origFuncs.push=childField.push,Object.defineProperty(childField,"push",{enumerable:!1,configurable:!0,value:function(){if(!self.blocked){self.block("tree-push");var result=origFuncs.push.apply(childField,_arguments);_this136.rebuildTree(row),self.unblock("tree-push")}return result}}),origFuncs.unshift=childField.unshift,Object.defineProperty(childField,"unshift",{enumerable:!1,configurable:!0,value:function(){if(!self.blocked){self.block("tree-unshift");var result=origFuncs.unshift.apply(childField,_arguments);_this136.rebuildTree(row),self.unblock("tree-unshift")}return result}}),origFuncs.shift=childField.shift,Object.defineProperty(childField,"shift",{enumerable:!1,configurable:!0,value:function(){if(!self.blocked){self.block("tree-shift");var result=origFuncs.shift.call(childField);_this136.rebuildTree(row),self.unblock("tree-shift")}return result}}),origFuncs.pop=childField.pop,Object.defineProperty(childField,"pop",{enumerable:!1,configurable:!0,value:function(){if(!self.blocked){self.block("tree-pop");var result=origFuncs.pop.call(childField);_this136.rebuildTree(row),self.unblock("tree-pop")}return result}}),origFuncs.splice=childField.splice,Object.defineProperty(childField,"splice",{enumerable:!1,configurable:!0,value:function(){if(!self.blocked){self.block("tree-splice");var result=origFuncs.splice.apply(childField,_arguments);_this136.rebuildTree(row),self.unblock("tree-splice")}return result}}))}},{key:"rebuildTree",value:function(row){this.table.modules.dataTree.initializeRow(row),this.table.modules.dataTree.layoutRow(row),this.table.rowManager.refreshActiveData("tree",!1,!0)}},{key:"watchKey",value:function(row,data,key){var self=this,props=Object.getOwnPropertyDescriptor(data,key),value=data[key],version=this.currentVersion;Object.defineProperty(data,key,{set:function(newValue){if(value=newValue,!self.blocked&&version===self.currentVersion){self.block("key");var update={};update[key]=newValue,row.updateData(update),self.unblock("key")}props.set&&props.set(newValue)},get:function(){return props.get&&props.get(),value}})}},{key:"unwatchRow",value:function(row){var data=row.getData();for(var key in data)Object.defineProperty(data,key,{value:data[key]})}},{key:"block",value:function(key){this.blocked||(this.blocked=key)}},{key:"unblock",value:function(key){this.blocked===key&&(this.blocked=!1)}}]),ReactiveData}(Module);_exports.ReactiveDataModule=ReactiveData,ReactiveData.moduleName="reactiveData";var ResizeColumns=function(_Module28){_inherits(ResizeColumns,_Module28);var _super33=_createSuper(ResizeColumns);function ResizeColumns(table){var _this137;return _classCallCheck(this,ResizeColumns),(_this137=_super33.call(this,table)).startColumn=!1,_this137.startX=!1,_this137.startWidth=!1,_this137.latestX=!1,_this137.handle=null,_this137.initialNextColumn=null,_this137.nextColumn=null,_this137.initialized=!1,_this137.registerColumnOption("resizable",!0),_this137.registerTableOption("resizableColumnFit",!1),_this137}return _createClass(ResizeColumns,[{key:"initialize",value:function(){this.subscribe("column-rendered",this.layoutColumnHeader.bind(this))}},{key:"initializeEventWatchers",value:function(){this.initialized||(this.subscribe("cell-rendered",this.layoutCellHandles.bind(this)),this.subscribe("cell-delete",this.deInitializeComponent.bind(this)),this.subscribe("cell-height",this.resizeHandle.bind(this)),this.subscribe("column-moved",this.columnLayoutUpdated.bind(this)),this.subscribe("column-hide",this.deInitializeColumn.bind(this)),this.subscribe("column-show",this.columnLayoutUpdated.bind(this)),this.subscribe("column-width",this.columnWidthUpdated.bind(this)),this.subscribe("column-delete",this.deInitializeComponent.bind(this)),this.subscribe("column-height",this.resizeHandle.bind(this)),this.initialized=!0)}},{key:"layoutCellHandles",value:function(cell){"row"===cell.row.type&&(this.deInitializeComponent(cell),this.initializeColumn("cell",cell,cell.column,cell.element))}},{key:"layoutColumnHeader",value:function(column){column.definition.resizable&&(this.initializeEventWatchers(),this.deInitializeComponent(column),this.initializeColumn("header",column,column,column.element))}},{key:"columnLayoutUpdated",value:function(column){var prev=column.prevColumn();this.reinitializeColumn(column),prev&&this.reinitializeColumn(prev)}},{key:"columnWidthUpdated",value:function(column){var _this138=this;column.modules.frozen&&(this.table.modules.frozenColumns.leftColumns.includes(column)?this.table.modules.frozenColumns.leftColumns.forEach((function(col){_this138.reinitializeColumn(col)})):this.table.modules.frozenColumns.rightColumns.includes(column)&&this.table.modules.frozenColumns.rightColumns.forEach((function(col){_this138.reinitializeColumn(col)})))}},{key:"frozenColumnOffset",value:function(column){var offset=!1;return column.modules.frozen&&(offset=column.modules.frozen.marginValue,"left"===column.modules.frozen.position?offset+=column.getWidth()-3:offset&&(offset-=3)),!1!==offset&&offset+"px"}},{key:"reinitializeColumn",value:function(column){var frozenOffset=this.frozenColumnOffset(column);column.cells.forEach((function(cell){cell.modules.resize&&cell.modules.resize.handleEl&&(frozenOffset&&(cell.modules.resize.handleEl.style[column.modules.frozen.position]=frozenOffset),cell.element.after(cell.modules.resize.handleEl))})),column.modules.resize&&column.modules.resize.handleEl&&(frozenOffset&&(column.modules.resize.handleEl.style[column.modules.frozen.position]=frozenOffset),column.element.after(column.modules.resize.handleEl))}},{key:"initializeColumn",value:function(type,component,column,element){var self=this,mode=column.definition.resizable,config={},nearestColumn=column.getLastColumn();if("header"===type&&(config={variableHeight:"textarea"==column.definition.formatter||column.definition.variableHeight}),(!0===mode||mode==type)&&this._checkResizability(nearestColumn)){var handle=document.createElement("span");handle.className="tabulator-col-resize-handle",handle.addEventListener("click",(function(e){e.stopPropagation()}));var handleDown=function(e){self.startColumn=column,self.initialNextColumn=self.nextColumn=nearestColumn.nextColumn(),self._mouseDown(e,nearestColumn,handle)};handle.addEventListener("mousedown",handleDown),handle.addEventListener("touchstart",handleDown,{passive:!0}),handle.addEventListener("dblclick",(function(e){var oldWidth=nearestColumn.getWidth();e.stopPropagation(),nearestColumn.reinitializeWidth(!0),oldWidth!==nearestColumn.getWidth()&&(self.dispatch("column-resized",nearestColumn),self.table.externalEvents.dispatch("columnResized",nearestColumn.getComponent()))})),column.modules.frozen&&(handle.style.position="sticky",handle.style[column.modules.frozen.position]=this.frozenColumnOffset(column)),config.handleEl=handle,element.parentNode&&column.visible&&element.after(handle)}component.modules.resize=config}},{key:"deInitializeColumn",value:function(column){var _this139=this;this.deInitializeComponent(column),column.cells.forEach((function(cell){_this139.deInitializeComponent(cell)}))}},{key:"deInitializeComponent",value:function(component){var handleEl;component.modules.resize&&(handleEl=component.modules.resize.handleEl)&&handleEl.parentElement&&handleEl.parentElement.removeChild(handleEl)}},{key:"resizeHandle",value:function(component,height){component.modules.resize&&component.modules.resize.handleEl&&(component.modules.resize.handleEl.style.height=height)}},{key:"_checkResizability",value:function(column){return column.definition.resizable}},{key:"_mouseDown",value:function(e,column,handle){var self=this;function mouseMove(e){var blockedBefore,blockedAfter,x=void 0===e.screenX?e.touches[0].screenX:e.screenX,startDiff=x-self.startX,moveDiff=x-self.latestX;if(self.latestX=x,self.table.rtl&&(startDiff=-startDiff,moveDiff=-moveDiff),blockedBefore=column.width==column.minWidth||column.width==column.maxWidth,column.setWidth(self.startWidth+startDiff),blockedAfter=column.width==column.minWidth||column.width==column.maxWidth,moveDiff<0&&(self.nextColumn=self.initialNextColumn),self.table.options.resizableColumnFit&&self.nextColumn&&(!blockedBefore||!blockedAfter)){var colWidth=self.nextColumn.getWidth();moveDiff>0&&colWidth<=self.nextColumn.minWidth&&(self.nextColumn=self.nextColumn.nextColumn()),self.nextColumn&&self.nextColumn.setWidth(self.nextColumn.getWidth()-moveDiff)}self.table.columnManager.rerenderColumns(!0),!self.table.browserSlow&&column.modules.resize&&column.modules.resize.variableHeight&&column.checkCellHeights()}function mouseUp(e){self.startColumn.modules.edit&&(self.startColumn.modules.edit.blocked=!1),self.table.browserSlow&&column.modules.resize&&column.modules.resize.variableHeight&&column.checkCellHeights(),document.body.removeEventListener("mouseup",mouseUp),document.body.removeEventListener("mousemove",mouseMove),handle.removeEventListener("touchmove",mouseMove),handle.removeEventListener("touchend",mouseUp),self.table.element.classList.remove("tabulator-block-select"),self.startWidth!==column.getWidth()&&(self.table.columnManager.verticalAlignHeaders(),self.dispatch("column-resized",column),self.table.externalEvents.dispatch("columnResized",column.getComponent()))}self.table.element.classList.add("tabulator-block-select"),e.stopPropagation(),self.startColumn.modules.edit&&(self.startColumn.modules.edit.blocked=!0),self.startX=void 0===e.screenX?e.touches[0].screenX:e.screenX,self.latestX=self.startX,self.startWidth=column.getWidth(),document.body.addEventListener("mousemove",mouseMove),document.body.addEventListener("mouseup",mouseUp),handle.addEventListener("touchmove",mouseMove,{passive:!0}),handle.addEventListener("touchend",mouseUp)}}]),ResizeColumns}(Module);_exports.ResizeColumnsModule=ResizeColumns,ResizeColumns.moduleName="resizeColumns";var ResizeRows=function(_Module29){_inherits(ResizeRows,_Module29);var _super34=_createSuper(ResizeRows);function ResizeRows(table){var _this140;return _classCallCheck(this,ResizeRows),(_this140=_super34.call(this,table)).startColumn=!1,_this140.startY=!1,_this140.startHeight=!1,_this140.handle=null,_this140.prevHandle=null,_this140.registerTableOption("resizableRows",!1),_this140}return _createClass(ResizeRows,[{key:"initialize",value:function(){this.table.options.resizableRows&&this.subscribe("row-layout-after",this.initializeRow.bind(this))}},{key:"initializeRow",value:function(row){var self=this,rowEl=row.getElement(),handle=document.createElement("div");handle.className="tabulator-row-resize-handle";var prevHandle=document.createElement("div");prevHandle.className="tabulator-row-resize-handle prev",handle.addEventListener("click",(function(e){e.stopPropagation()}));var handleDown=function(e){self.startRow=row,self._mouseDown(e,row,handle)};handle.addEventListener("mousedown",handleDown),handle.addEventListener("touchstart",handleDown,{passive:!0}),prevHandle.addEventListener("click",(function(e){e.stopPropagation()}));var prevHandleDown=function(e){var prevRow=self.table.rowManager.prevDisplayRow(row);prevRow&&(self.startRow=prevRow,self._mouseDown(e,prevRow,prevHandle))};prevHandle.addEventListener("mousedown",prevHandleDown),prevHandle.addEventListener("touchstart",prevHandleDown,{passive:!0}),rowEl.appendChild(handle),rowEl.appendChild(prevHandle)}},{key:"_mouseDown",value:function(e,row,handle){var self=this;function mouseMove(e){row.setHeight(self.startHeight+((void 0===e.screenY?e.touches[0].screenY:e.screenY)-self.startY))}function mouseUp(e){document.body.removeEventListener("mouseup",mouseMove),document.body.removeEventListener("mousemove",mouseMove),handle.removeEventListener("touchmove",mouseMove),handle.removeEventListener("touchend",mouseUp),self.table.element.classList.remove("tabulator-block-select"),self.dispatchExternal("rowResized",row.getComponent())}self.table.element.classList.add("tabulator-block-select"),e.stopPropagation(),self.startY=void 0===e.screenY?e.touches[0].screenY:e.screenY,self.startHeight=row.getHeight(),document.body.addEventListener("mousemove",mouseMove),document.body.addEventListener("mouseup",mouseUp),handle.addEventListener("touchmove",mouseMove,{passive:!0}),handle.addEventListener("touchend",mouseUp)}}]),ResizeRows}(Module);_exports.ResizeRowsModule=ResizeRows,ResizeRows.moduleName="resizeRows";var ResizeTable=function(_Module30){_inherits(ResizeTable,_Module30);var _super35=_createSuper(ResizeTable);function ResizeTable(table){var _this141;return _classCallCheck(this,ResizeTable),(_this141=_super35.call(this,table)).binding=!1,_this141.visibilityObserver=!1,_this141.resizeObserver=!1,_this141.containerObserver=!1,_this141.tableHeight=0,_this141.tableWidth=0,_this141.containerHeight=0,_this141.containerWidth=0,_this141.autoResize=!1,_this141.visible=!1,_this141.initialized=!1,_this141.initialRedraw=!1,_this141.registerTableOption("autoResize",!0),_this141}return _createClass(ResizeTable,[{key:"initialize",value:function(){var _this142=this;if(this.table.options.autoResize){var tableStyle,table=this.table;this.tableHeight=table.element.clientHeight,this.tableWidth=table.element.clientWidth,table.element.parentNode&&(this.containerHeight=table.element.parentNode.clientHeight,this.containerWidth=table.element.parentNode.clientWidth),"undefined"!=typeof IntersectionObserver&&"undefined"!=typeof ResizeObserver&&"virtual"===table.rowManager.getRenderMode()?(this.initializeVisibilityObserver(),this.autoResize=!0,this.resizeObserver=new ResizeObserver((function(entry){if(!table.browserMobile||table.browserMobile&&!table.modules.edit.currentCell){var nodeHeight=Math.floor(entry[0].contentRect.height),nodeWidth=Math.floor(entry[0].contentRect.width);_this142.tableHeight==nodeHeight&&_this142.tableWidth==nodeWidth||(_this142.tableHeight=nodeHeight,_this142.tableWidth=nodeWidth,table.element.parentNode&&(_this142.containerHeight=table.element.parentNode.clientHeight,_this142.containerWidth=table.element.parentNode.clientWidth),_this142.redrawTable())}})),this.resizeObserver.observe(table.element),tableStyle=window.getComputedStyle(table.element),this.table.element.parentNode&&!this.table.rowManager.fixedHeight&&(tableStyle.getPropertyValue("max-height")||tableStyle.getPropertyValue("min-height"))&&(this.containerObserver=new ResizeObserver((function(entry){if(!table.browserMobile||table.browserMobile&&!table.modules.edit.currentCell){var nodeHeight=Math.floor(entry[0].contentRect.height),nodeWidth=Math.floor(entry[0].contentRect.width);_this142.containerHeight==nodeHeight&&_this142.containerWidth==nodeWidth||(_this142.containerHeight=nodeHeight,_this142.containerWidth=nodeWidth,_this142.tableHeight=table.element.clientHeight,_this142.tableWidth=table.element.clientWidth),_this142.redrawTable()}})),this.containerObserver.observe(this.table.element.parentNode)),this.subscribe("table-resize",this.tableResized.bind(this))):(this.binding=function(){(!table.browserMobile||table.browserMobile&&!table.modules.edit.currentCell)&&(table.columnManager.rerenderColumns(!0),table.redraw())},window.addEventListener("resize",this.binding)),this.subscribe("table-destroy",this.clearBindings.bind(this))}}},{key:"initializeVisibilityObserver",value:function(){var _this143=this;this.visibilityObserver=new IntersectionObserver((function(entries){_this143.visible=entries[0].isIntersecting,_this143.initialized?_this143.visible&&(_this143.redrawTable(_this143.initialRedraw),_this143.initialRedraw=!1):(_this143.initialized=!0,_this143.initialRedraw=!_this143.visible)})),this.visibilityObserver.observe(this.table.element)}},{key:"redrawTable",value:function(force){this.initialized&&this.visible&&(this.table.columnManager.rerenderColumns(!0),this.table.redraw(force))}},{key:"tableResized",value:function(){this.table.rowManager.redraw()}},{key:"clearBindings",value:function(){this.binding&&window.removeEventListener("resize",this.binding),this.resizeObserver&&this.resizeObserver.unobserve(this.table.element),this.visibilityObserver&&this.visibilityObserver.unobserve(this.table.element),this.containerObserver&&this.containerObserver.unobserve(this.table.element.parentNode)}}]),ResizeTable}(Module);_exports.ResizeTableModule=ResizeTable,ResizeTable.moduleName="resizeTable";var ResponsiveLayout=function(_Module31){_inherits(ResponsiveLayout,_Module31);var _super36=_createSuper(ResponsiveLayout);function ResponsiveLayout(table){var _this144;return _classCallCheck(this,ResponsiveLayout),(_this144=_super36.call(this,table)).columns=[],_this144.hiddenColumns=[],_this144.mode="",_this144.index=0,_this144.collapseFormatter=[],_this144.collapseStartOpen=!0,_this144.collapseHandleColumn=!1,_this144.registerTableOption("responsiveLayout",!1),_this144.registerTableOption("responsiveLayoutCollapseStartOpen",!0),_this144.registerTableOption("responsiveLayoutCollapseUseFormatters",!0),_this144.registerTableOption("responsiveLayoutCollapseFormatter",!1),_this144.registerColumnOption("responsive"),_this144}return _createClass(ResponsiveLayout,[{key:"initialize",value:function(){this.table.options.responsiveLayout&&(this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-show",this.updateColumnVisibility.bind(this)),this.subscribe("column-hide",this.updateColumnVisibility.bind(this)),this.subscribe("columns-loaded",this.initializeResponsivity.bind(this)),this.subscribe("column-moved",this.initializeResponsivity.bind(this)),this.subscribe("column-add",this.initializeResponsivity.bind(this)),this.subscribe("column-delete",this.initializeResponsivity.bind(this)),this.subscribe("table-redrawing",this.tableRedraw.bind(this)),"collapse"===this.table.options.responsiveLayout&&(this.subscribe("row-data-changed",this.generateCollapsedRowContent.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout",this.layoutRow.bind(this))))}},{key:"tableRedraw",value:function(force){-1===["fitColumns","fitDataStretch"].indexOf(this.layoutMode())&&(force||this.update())}},{key:"initializeResponsivity",value:function(){var _this145=this,columns=[];this.mode=this.table.options.responsiveLayout,this.collapseFormatter=this.table.options.responsiveLayoutCollapseFormatter||this.formatCollapsedData,this.collapseStartOpen=this.table.options.responsiveLayoutCollapseStartOpen,this.hiddenColumns=[],this.table.columnManager.columnsByIndex.forEach((function(column,i){column.modules.responsive&&column.modules.responsive.order&&column.modules.responsive.visible&&(column.modules.responsive.index=i,columns.push(column),column.visible||"collapse"!==_this145.mode||_this145.hiddenColumns.push(column))})),columns=(columns=columns.reverse()).sort((function(a,b){return b.modules.responsive.order-a.modules.responsive.order||b.modules.responsive.index-a.modules.responsive.index})),this.columns=columns,"collapse"===this.mode&&this.generateCollapsedContent();var _step,_iterator=_createForOfIteratorHelper(this.table.columnManager.columnsByIndex);try{for(_iterator.s();!(_step=_iterator.n()).done;){var col=_step.value;if("responsiveCollapse"==col.definition.formatter){this.collapseHandleColumn=col;break}}}catch(err){_iterator.e(err)}finally{_iterator.f()}this.collapseHandleColumn&&(this.hiddenColumns.length?this.collapseHandleColumn.show():this.collapseHandleColumn.hide())}},{key:"initializeColumn",value:function(column){var def=column.getDefinition();column.modules.responsive={order:void 0===def.responsive?1:def.responsive,visible:!1!==def.visible}}},{key:"initializeRow",value:function(row){var el;"calc"!==row.type&&((el=document.createElement("div")).classList.add("tabulator-responsive-collapse"),row.modules.responsiveLayout={element:el,open:this.collapseStartOpen},this.collapseStartOpen||(el.style.display="none"))}},{key:"layoutRow",value:function(row){var rowEl=row.getElement();row.modules.responsiveLayout&&(rowEl.appendChild(row.modules.responsiveLayout.element),this.generateCollapsedRowContent(row))}},{key:"updateColumnVisibility",value:function(column,responsiveToggle){!responsiveToggle&&column.modules.responsive&&(column.modules.responsive.visible=column.visible,this.initializeResponsivity())}},{key:"hideColumn",value:function(column){var colCount=this.hiddenColumns.length;column.hide(!1,!0),"collapse"===this.mode&&(this.hiddenColumns.unshift(column),this.generateCollapsedContent(),this.collapseHandleColumn&&!colCount&&this.collapseHandleColumn.show())}},{key:"showColumn",value:function(column){var index;column.show(!1,!0),column.setWidth(column.getWidth()),"collapse"===this.mode&&((index=this.hiddenColumns.indexOf(column))>-1&&this.hiddenColumns.splice(index,1),this.generateCollapsedContent(),this.collapseHandleColumn&&!this.hiddenColumns.length&&this.collapseHandleColumn.hide())}},{key:"update",value:function(){for(var working=!0;working;){var width="fitColumns"==this.table.modules.layout.getMode()?this.table.columnManager.getFlexBaseWidth():this.table.columnManager.getWidth(),diff=(this.table.options.headerVisible?this.table.columnManager.element.clientWidth:this.table.element.clientWidth)-width;if(diff<0){var column=this.columns[this.index];column?(this.hideColumn(column),this.index++):working=!1}else{var _column=this.columns[this.index-1];_column&&diff>0&&diff>=_column.getWidth()?(this.showColumn(_column),this.index--):working=!1}this.table.rowManager.activeRowsCount||this.table.rowManager.renderEmptyScroll()}}},{key:"generateCollapsedContent",value:function(){var _this146=this;this.table.rowManager.getDisplayRows().forEach((function(row){_this146.generateCollapsedRowContent(row)}))}},{key:"generateCollapsedRowContent",value:function(row){var el,contents;if(row.modules.responsiveLayout){for(el=row.modules.responsiveLayout.element;el.firstChild;)el.removeChild(el.firstChild);(contents=this.collapseFormatter(this.generateCollapsedRowData(row)))&&el.appendChild(contents)}}},{key:"generateCollapsedRowData",value:function(row){var mockCellComponent,_this147=this,data=row.getData(),output=[];return this.hiddenColumns.forEach((function(column){var value=column.getFieldValue(data);if(column.definition.title&&column.field)if(column.modules.format&&_this147.table.options.responsiveLayoutCollapseUseFormatters){mockCellComponent={value:!1,data:{},getValue:function(){return value},getData:function(){return data},getElement:function(){return document.createElement("div")},getRow:function(){return row.getComponent()},getColumn:function(){return column.getComponent()},getTable:function(){return _this147.table}},output.push({field:column.field,title:column.definition.title,value:column.modules.format.formatter.call(_this147.table.modules.format,mockCellComponent,column.modules.format.params,(function(callback){callback()}))})}else output.push({field:column.field,title:column.definition.title,value:value})})),output}},{key:"formatCollapsedData",value:function(data){var list=document.createElement("table");return data.forEach((function(item){var node_content,row=document.createElement("tr"),titleData=document.createElement("td"),valueData=document.createElement("td"),titleHighlight=document.createElement("strong");titleData.appendChild(titleHighlight),this.langBind("columns|"+item.field,(function(text){titleHighlight.innerHTML=text||item.title})),item.value instanceof Node?((node_content=document.createElement("div")).appendChild(item.value),valueData.appendChild(node_content)):valueData.innerHTML=item.value,row.appendChild(titleData),row.appendChild(valueData),list.appendChild(row)}),this),Object.keys(data).length?list:""}}]),ResponsiveLayout}(Module);_exports.ResponsiveLayoutModule=ResponsiveLayout,ResponsiveLayout.moduleName="responsiveLayout";var SelectRow=function(_Module32){_inherits(SelectRow,_Module32);var _super37=_createSuper(SelectRow);function SelectRow(table){var _this148;return _classCallCheck(this,SelectRow),(_this148=_super37.call(this,table)).selecting=!1,_this148.lastClickedRow=!1,_this148.selectPrev=[],_this148.selectedRows=[],_this148.headerCheckboxElement=null,_this148.registerTableOption("selectable","highlight"),_this148.registerTableOption("selectableRangeMode","drag"),_this148.registerTableOption("selectableRollingSelection",!0),_this148.registerTableOption("selectablePersistence",!0),_this148.registerTableOption("selectableCheck",(function(data,row){return!0})),_this148.registerTableFunction("selectRow",_this148.selectRows.bind(_assertThisInitialized(_this148))),_this148.registerTableFunction("deselectRow",_this148.deselectRows.bind(_assertThisInitialized(_this148))),_this148.registerTableFunction("toggleSelectRow",_this148.toggleRow.bind(_assertThisInitialized(_this148))),_this148.registerTableFunction("getSelectedRows",_this148.getSelectedRows.bind(_assertThisInitialized(_this148))),_this148.registerTableFunction("getSelectedData",_this148.getSelectedData.bind(_assertThisInitialized(_this148))),_this148.registerComponentFunction("row","select",_this148.selectRows.bind(_assertThisInitialized(_this148))),_this148.registerComponentFunction("row","deselect",_this148.deselectRows.bind(_assertThisInitialized(_this148))),_this148.registerComponentFunction("row","toggleSelect",_this148.toggleRow.bind(_assertThisInitialized(_this148))),_this148.registerComponentFunction("row","isSelected",_this148.isRowSelected.bind(_assertThisInitialized(_this148))),_this148}return _createClass(SelectRow,[{key:"initialize",value:function(){!1!==this.table.options.selectable&&(this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-deleting",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clearSelectionData.bind(this)),this.subscribe("rows-retrieve",this.rowRetrieve.bind(this)),this.table.options.selectable&&!this.table.options.selectablePersistence&&this.subscribe("data-refreshing",this.deselectRows.bind(this)))}},{key:"rowRetrieve",value:function(type,prevValue){return"selected"===type?this.selectedRows:prevValue}},{key:"rowDeleted",value:function(row){this._deselectRow(row,!0)}},{key:"clearSelectionData",value:function(silent){this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],!0!==silent&&this._rowSelectionChanged()}},{key:"initializeRow",value:function(row){var self=this,element=row.getElement(),endSelect=function endSelect(){setTimeout((function(){self.selecting=!1}),50),document.body.removeEventListener("mouseup",endSelect)};row.modules.select={selected:!1},self.table.options.selectableCheck.call(this.table,row.getComponent())?(element.classList.add("tabulator-selectable"),element.classList.remove("tabulator-unselectable"),self.table.options.selectable&&"highlight"!=self.table.options.selectable&&("click"===self.table.options.selectableRangeMode?element.addEventListener("click",this.handleComplexRowClick.bind(this,row)):(element.addEventListener("click",(function(e){self.table.modExists("edit")&&self.table.modules.edit.getCurrentCell()||self.table._clearSelection(),self.selecting||self.toggleRow(row)})),element.addEventListener("mousedown",(function(e){if(e.shiftKey)return self.table._clearSelection(),self.selecting=!0,self.selectPrev=[],document.body.addEventListener("mouseup",endSelect),document.body.addEventListener("keyup",endSelect),self.toggleRow(row),!1})),element.addEventListener("mouseenter",(function(e){self.selecting&&(self.table._clearSelection(),self.toggleRow(row),self.selectPrev[1]==row&&self.toggleRow(self.selectPrev[0]))})),element.addEventListener("mouseout",(function(e){self.selecting&&(self.table._clearSelection(),self.selectPrev.unshift(row))}))))):(element.classList.add("tabulator-unselectable"),element.classList.remove("tabulator-selectable"))}},{key:"handleComplexRowClick",value:function(row,e){var _this149=this;if(e.shiftKey){this.table._clearSelection(),this.lastClickedRow=this.lastClickedRow||row;var lastClickedRowIdx=this.table.rowManager.getDisplayRowIndex(this.lastClickedRow),rowIdx=this.table.rowManager.getDisplayRowIndex(row),fromRowIdx=lastClickedRowIdx<=rowIdx?lastClickedRowIdx:rowIdx,toRowIdx=lastClickedRowIdx>=rowIdx?lastClickedRowIdx:rowIdx,toggledRows=this.table.rowManager.getDisplayRows().slice(0).splice(fromRowIdx,toRowIdx-fromRowIdx+1);e.ctrlKey||e.metaKey?(toggledRows.forEach((function(toggledRow){toggledRow!==_this149.lastClickedRow&&(!0===_this149.table.options.selectable||_this149.isRowSelected(row)||_this149.selectedRows.length<_this149.table.options.selectable)&&_this149.toggleRow(toggledRow)})),this.lastClickedRow=row):(this.deselectRows(void 0,!0),!0!==this.table.options.selectable&&toggledRows.length>this.table.options.selectable&&(toggledRows=toggledRows.slice(0,this.table.options.selectable)),this.selectRows(toggledRows)),this.table._clearSelection()}else e.ctrlKey||e.metaKey?(this.toggleRow(row),this.lastClickedRow=row):(this.deselectRows(void 0,!0),this.selectRows(row),this.lastClickedRow=row)}},{key:"toggleRow",value:function(row){this.table.options.selectableCheck.call(this.table,row.getComponent())&&(row.modules.select&&row.modules.select.selected?this._deselectRow(row):this._selectRow(row))}},{key:"selectRows",value:function(rows){var rowMatch,_this150=this;switch(_typeof(rows)){case"undefined":this.table.rowManager.rows.forEach((function(row){_this150._selectRow(row,!0,!0)})),this._rowSelectionChanged();break;case"string":(rowMatch=this.table.rowManager.findRow(rows))?(this._selectRow(rowMatch,!0,!0),this._rowSelectionChanged()):((rowMatch=this.table.rowManager.getRows(rows)).forEach((function(row){_this150._selectRow(row,!0,!0)})),rowMatch.length&&this._rowSelectionChanged());break;default:Array.isArray(rows)?(rows.forEach((function(row){_this150._selectRow(row,!0,!0)})),this._rowSelectionChanged()):this._selectRow(rows,!1,!0)}}},{key:"_selectRow",value:function(rowInfo,silent,force){if(!isNaN(this.table.options.selectable)&&!0!==this.table.options.selectable&&!force&&this.selectedRows.length>=this.table.options.selectable){if(!this.table.options.selectableRollingSelection)return!1;this._deselectRow(this.selectedRows[0])}var row=this.table.rowManager.findRow(rowInfo);row?-1==this.selectedRows.indexOf(row)&&(row.getElement().classList.add("tabulator-selected"),row.modules.select||(row.modules.select={}),row.modules.select.selected=!0,row.modules.select.checkboxEl&&(row.modules.select.checkboxEl.checked=!0),this.selectedRows.push(row),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(row,!0),this.dispatchExternal("rowSelected",row.getComponent()),this._rowSelectionChanged(silent)):silent||console.warn("Selection Error - No such row found, ignoring selection:"+rowInfo)}},{key:"isRowSelected",value:function(row){return-1!==this.selectedRows.indexOf(row)}},{key:"deselectRows",value:function(rows,silent){var rowCount,self=this;if(void 0===rows){rowCount=self.selectedRows.length;for(var i=0;i<rowCount;i++)self._deselectRow(self.selectedRows[0],!0);rowCount&&self._rowSelectionChanged(silent)}else Array.isArray(rows)?(rows.forEach((function(row){self._deselectRow(row,!0)})),self._rowSelectionChanged(silent)):self._deselectRow(rows,silent)}},{key:"_deselectRow",value:function(rowInfo,silent){var index,row=this.table.rowManager.findRow(rowInfo);row?(index=this.selectedRows.findIndex((function(selectedRow){return selectedRow==row})))>-1&&(row.getElement().classList.remove("tabulator-selected"),row.modules.select||(row.modules.select={}),row.modules.select.selected=!1,row.modules.select.checkboxEl&&(row.modules.select.checkboxEl.checked=!1),this.selectedRows.splice(index,1),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(row,!1),this.dispatchExternal("rowDeselected",row.getComponent()),this._rowSelectionChanged(silent)):silent||console.warn("Deselection Error - No such row found, ignoring selection:"+rowInfo)}},{key:"getSelectedData",value:function(){var data=[];return this.selectedRows.forEach((function(row){data.push(row.getData())})),data}},{key:"getSelectedRows",value:function(){var rows=[];return this.selectedRows.forEach((function(row){rows.push(row.getComponent())})),rows}},{key:"_rowSelectionChanged",value:function(silent){this.headerCheckboxElement&&(0===this.selectedRows.length?(this.headerCheckboxElement.checked=!1,this.headerCheckboxElement.indeterminate=!1):this.table.rowManager.rows.length===this.selectedRows.length?(this.headerCheckboxElement.checked=!0,this.headerCheckboxElement.indeterminate=!1):(this.headerCheckboxElement.indeterminate=!0,this.headerCheckboxElement.checked=!1)),silent||this.dispatchExternal("rowSelectionChanged",this.getSelectedData(),this.getSelectedRows())}},{key:"registerRowSelectCheckbox",value:function(row,element){row._row.modules.select||(row._row.modules.select={}),row._row.modules.select.checkboxEl=element}},{key:"registerHeaderSelectCheckbox",value:function(element){this.headerCheckboxElement=element}},{key:"childRowSelection",value:function(row,select){var children=this.table.modules.dataTree.getChildren(row,!0);if(select){var _step2,_iterator2=_createForOfIteratorHelper(children);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var child=_step2.value;this._selectRow(child,!0)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}else{var _step3,_iterator3=_createForOfIteratorHelper(children);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var _child=_step3.value;this._deselectRow(_child,!0)}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}}}}]),SelectRow}(Module);function datetime$2(a,b,aRow,bRow,column,dir,params){var DT=window.DateTime||luxon.DateTime,format=params.format||"dd/MM/yyyy HH:mm:ss",alignEmptyValues=params.alignEmptyValues,emptyAlign=0;if(void 0!==DT){if(DT.isDateTime(a)||(a="iso"===format?DT.fromISO(String(a)):DT.fromFormat(String(a),format)),DT.isDateTime(b)||(b="iso"===format?DT.fromISO(String(b)):DT.fromFormat(String(b),format)),a.isValid){if(b.isValid)return a-b;emptyAlign=1}else emptyAlign=b.isValid?-1:0;return("top"===alignEmptyValues&&"desc"===dir||"bottom"===alignEmptyValues&&"asc"===dir)&&(emptyAlign*=-1),emptyAlign}console.error("Sort Error - 'datetime' sorter is dependant on luxon.js")}_exports.SelectRowModule=SelectRow,SelectRow.moduleName="selectRow";var defaultSorters={number:function(a,b,aRow,bRow,column,dir,params){var alignEmptyValues=params.alignEmptyValues,decimal=params.decimalSeparator,thousand=params.thousandSeparator,emptyAlign=0;if(a=String(a),b=String(b),thousand&&(a=a.split(thousand).join(""),b=b.split(thousand).join("")),decimal&&(a=a.split(decimal).join("."),b=b.split(decimal).join(".")),a=parseFloat(a),b=parseFloat(b),isNaN(a))emptyAlign=isNaN(b)?0:-1;else{if(!isNaN(b))return a-b;emptyAlign=1}return("top"===alignEmptyValues&&"desc"===dir||"bottom"===alignEmptyValues&&"asc"===dir)&&(emptyAlign*=-1),emptyAlign},string:function(a,b,aRow,bRow,column,dir,params){var locale,alignEmptyValues=params.alignEmptyValues,emptyAlign=0;if(a){if(b){switch(_typeof(params.locale)){case"boolean":params.locale&&(locale=this.langLocale());break;case"string":locale=params.locale}return String(a).toLowerCase().localeCompare(String(b).toLowerCase(),locale)}emptyAlign=1}else emptyAlign=b?-1:0;return("top"===alignEmptyValues&&"desc"===dir||"bottom"===alignEmptyValues&&"asc"===dir)&&(emptyAlign*=-1),emptyAlign},date:function(a,b,aRow,bRow,column,dir,params){return params.format||(params.format="dd/MM/yyyy"),datetime$2.call(this,a,b,aRow,bRow,column,dir,params)},time:function(a,b,aRow,bRow,column,dir,params){return params.format||(params.format="HH:mm"),datetime$2.call(this,a,b,aRow,bRow,column,dir,params)},datetime:datetime$2,boolean:function(a,b,aRow,bRow,column,dir,params){return(!0===a||"true"===a||"True"===a||1===a?1:0)-(!0===b||"true"===b||"True"===b||1===b?1:0)},array:function(a,b,aRow,bRow,column,dir,params){var type=params.type||"length",alignEmptyValues=params.alignEmptyValues,emptyAlign=0;function calc(value){var result;switch(type){case"length":result=value.length;break;case"sum":result=value.reduce((function(c,d){return c+d}));break;case"max":result=Math.max.apply(null,value);break;case"min":result=Math.min.apply(null,value);break;case"avg":result=value.reduce((function(c,d){return c+d}))/value.length}return result}if(Array.isArray(a)){if(Array.isArray(b))return calc(b)-calc(a);emptyAlign=1}else emptyAlign=Array.isArray(b)?-1:0;return("top"===alignEmptyValues&&"desc"===dir||"bottom"===alignEmptyValues&&"asc"===dir)&&(emptyAlign*=-1),emptyAlign},exists:function(a,b,aRow,bRow,column,dir,params){return(void 0===a?0:1)-(void 0===b?0:1)},alphanum:function(as,bs,aRow,bRow,column,dir,params){var a,b,a1,b1,L,i=0,rx=/(\d+)|(\D+)/g,rd=/\d/,alignEmptyValues=params.alignEmptyValues,emptyAlign=0;if(as||0===as){if(bs||0===bs){if(isFinite(as)&&isFinite(bs))return as-bs;if((a=String(as).toLowerCase())===(b=String(bs).toLowerCase()))return 0;if(!rd.test(a)||!rd.test(b))return a>b?1:-1;for(a=a.match(rx),b=b.match(rx),L=a.length>b.length?b.length:a.length;i<L;)if((a1=a[i])!==(b1=b[i++]))return isFinite(a1)&&isFinite(b1)?("0"===a1.charAt(0)&&(a1="."+a1),"0"===b1.charAt(0)&&(b1="."+b1),a1-b1):a1>b1?1:-1;return a.length>b.length}emptyAlign=1}else emptyAlign=bs||0===bs?-1:0;return("top"===alignEmptyValues&&"desc"===dir||"bottom"===alignEmptyValues&&"asc"===dir)&&(emptyAlign*=-1),emptyAlign}},Sort=function(_Module33){_inherits(Sort,_Module33);var _super38=_createSuper(Sort);function Sort(table){var _this151;return _classCallCheck(this,Sort),(_this151=_super38.call(this,table)).sortList=[],_this151.changed=!1,_this151.registerTableOption("sortMode","local"),_this151.registerTableOption("initialSort",!1),_this151.registerTableOption("columnHeaderSortMulti",!0),_this151.registerTableOption("sortOrderReverse",!1),_this151.registerTableOption("headerSortElement","<div class='tabulator-arrow'></div>"),_this151.registerTableOption("headerSortClickElement","header"),_this151.registerColumnOption("sorter"),_this151.registerColumnOption("sorterParams"),_this151.registerColumnOption("headerSort",!0),_this151.registerColumnOption("headerSortStartingDir"),_this151.registerColumnOption("headerSortTristate"),_this151}return _createClass(Sort,[{key:"initialize",value:function(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.registerDataHandler(this.sort.bind(this),20),this.registerTableFunction("setSort",this.userSetSort.bind(this)),this.registerTableFunction("getSorters",this.getSort.bind(this)),this.registerTableFunction("clearSort",this.clearSort.bind(this)),"remote"===this.table.options.sortMode&&this.subscribe("data-params",this.remoteSortParams.bind(this))}},{key:"tableBuilt",value:function(){this.table.options.initialSort&&this.setSort(this.table.options.initialSort)}},{key:"remoteSortParams",value:function(data,config,silent,params){var sorters=this.getSort();return sorters.forEach((function(item){delete item.column})),params.sort=sorters,params}},{key:"userSetSort",value:function(sortList,dir){this.setSort(sortList,dir),this.refreshSort()}},{key:"clearSort",value:function(){this.clear(),this.refreshSort()}},{key:"initializeColumn",value:function(column){var colEl,arrowEl,_this152=this,sorter=!1;switch(_typeof(column.definition.sorter)){case"string":Sort.sorters[column.definition.sorter]?sorter=Sort.sorters[column.definition.sorter]:console.warn("Sort Error - No such sorter found: ",column.definition.sorter);break;case"function":sorter=column.definition.sorter}if(column.modules.sort={sorter:sorter,dir:"none",params:column.definition.sorterParams||{},startingDir:column.definition.headerSortStartingDir||"asc",tristate:column.definition.headerSortTristate},!1!==column.definition.headerSort){if((colEl=column.getElement()).classList.add("tabulator-sortable"),(arrowEl=document.createElement("div")).classList.add("tabulator-col-sorter"),"icon"===this.table.options.headerSortClickElement)arrowEl.classList.add("tabulator-col-sorter-element");else colEl.classList.add("tabulator-col-sorter-element");switch(this.table.options.headerSortElement){case"function":break;case"object":arrowEl.appendChild(this.table.options.headerSortElement);break;default:arrowEl.innerHTML=this.table.options.headerSortElement}column.titleHolderElement.appendChild(arrowEl),column.modules.sort.element=arrowEl,this.setColumnHeaderSortIcon(column,"none"),("icon"===this.table.options.headerSortClickElement?arrowEl:colEl).addEventListener("click",(function(e){var dir="",sorters=[],match=!1;if(column.modules.sort){if(column.modules.sort.tristate)dir="none"==column.modules.sort.dir?column.modules.sort.startingDir:column.modules.sort.dir==column.modules.sort.startingDir?"asc"==column.modules.sort.dir?"desc":"asc":"none";else switch(column.modules.sort.dir){case"asc":dir="desc";break;case"desc":dir="asc";break;default:dir=column.modules.sort.startingDir}_this152.table.options.columnHeaderSortMulti&&(e.shiftKey||e.ctrlKey)?(match=(sorters=_this152.getSort()).findIndex((function(sorter){return sorter.field===column.getField()})),match>-1?(sorters[match].dir=dir,match=sorters.splice(match,1)[0],"none"!=dir&&sorters.push(match)):"none"!=dir&&sorters.push({column:column,dir:dir}),_this152.setSort(sorters)):"none"==dir?_this152.clear():_this152.setSort(column,dir),_this152.refreshSort()}}))}}},{key:"refreshSort",value:function(){"remote"===this.table.options.sortMode?this.reloadData(null,!1,!1):this.refreshData(!0)}},{key:"hasChanged",value:function(){var changed=this.changed;return this.changed=!1,changed}},{key:"getSort",value:function(){var sorters=[];return this.sortList.forEach((function(item){item.column&&sorters.push({column:item.column.getComponent(),field:item.column.getField(),dir:item.dir})})),sorters}},{key:"setSort",value:function(sortList,dir){var self=this,newSortList=[];Array.isArray(sortList)||(sortList=[{column:sortList,dir:dir}]),sortList.forEach((function(item){var column;(column=self.table.columnManager.findColumn(item.column))?(item.column=column,newSortList.push(item),self.changed=!0):console.warn("Sort Warning - Sort field does not exist and is being ignored: ",item.column)})),self.sortList=newSortList,this.dispatch("sort-changed")}},{key:"clear",value:function(){this.setSort([])}},{key:"findSorter",value:function(column){var value,row=this.table.rowManager.activeRows[0],sorter="string";if(row&&(row=row.getData(),column.getField()))switch(_typeof(value=column.getFieldValue(row))){case"undefined":sorter="string";break;case"boolean":sorter="boolean";break;default:isNaN(value)||""===value?value.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)&&(sorter="alphanum"):sorter="number"}return Sort.sorters[sorter]}},{key:"sort",value:function(data){var self=this,sortList=this.table.options.sortOrderReverse?self.sortList.slice().reverse():self.sortList,sortListActual=[],rowComponents=[];return this.subscribedExternal("dataSorting")&&this.dispatchExternal("dataSorting",self.getSort()),self.clearColumnHeaders(),"remote"!==this.table.options.sortMode?(sortList.forEach((function(item,i){var sortObj;item.column&&((sortObj=item.column.modules.sort)&&(sortObj.sorter||(sortObj.sorter=self.findSorter(item.column)),item.params="function"==typeof sortObj.params?sortObj.params(item.column.getComponent(),item.dir):sortObj.params,sortListActual.push(item)),self.setColumnHeader(item.column,item.dir))})),sortListActual.length&&self._sortItems(data,sortListActual)):sortList.forEach((function(item,i){self.setColumnHeader(item.column,item.dir)})),this.subscribedExternal("dataSorted")&&(data.forEach((function(row){rowComponents.push(row.getComponent())})),this.dispatchExternal("dataSorted",self.getSort(),rowComponents)),data}},{key:"clearColumnHeaders",value:function(){var _this153=this;this.table.columnManager.getRealColumns().forEach((function(column){column.modules.sort&&(column.modules.sort.dir="none",column.getElement().setAttribute("aria-sort","none"),_this153.setColumnHeaderSortIcon(column,"none"))}))}},{key:"setColumnHeader",value:function(column,dir){column.modules.sort.dir=dir,column.getElement().setAttribute("aria-sort","asc"===dir?"ascending":"descending"),this.setColumnHeaderSortIcon(column,dir)}},{key:"setColumnHeaderSortIcon",value:function(column,dir){var arrowEl,sortEl=column.modules.sort.element;if(column.definition.headerSort&&"function"==typeof this.table.options.headerSortElement){for(;sortEl.firstChild;)sortEl.removeChild(sortEl.firstChild);"object"===_typeof(arrowEl=this.table.options.headerSortElement.call(this.table,column.getComponent(),dir))?sortEl.appendChild(arrowEl):sortEl.innerHTML=arrowEl}}},{key:"_sortItems",value:function(data,sortList){var _this154=this,sorterCount=sortList.length-1;data.sort((function(a,b){for(var result,i=sorterCount;i>=0;i--){var sortItem=sortList[i];if(0!==(result=_this154._sortRow(a,b,sortItem.column,sortItem.dir,sortItem.params)))break}return result}))}},{key:"_sortRow",value:function(a,b,column,dir,params){var el1Comp,el2Comp,el1="asc"==dir?a:b,el2="asc"==dir?b:a;return a=void 0!==(a=column.getFieldValue(el1.getData()))?a:"",b=void 0!==(b=column.getFieldValue(el2.getData()))?b:"",el1Comp=el1.getComponent(),el2Comp=el2.getComponent(),column.modules.sort.sorter.call(this,a,b,el1Comp,el2Comp,column.getComponent(),dir,params)}}]),Sort}(Module);_exports.SortModule=Sort,Sort.moduleName="sort",Sort.sorters=defaultSorters;var Tooltip=function(_Module34){_inherits(Tooltip,_Module34);var _super39=_createSuper(Tooltip);function Tooltip(table){var _this155;return _classCallCheck(this,Tooltip),(_this155=_super39.call(this,table)).tooltipSubscriber=null,_this155.headerSubscriber=null,_this155.timeout=null,_this155.popupInstance=null,_this155.registerTableOption("tooltipGenerationMode",void 0),_this155.registerTableOption("tooltipDelay",300),_this155.registerColumnOption("tooltip"),_this155.registerColumnOption("headerTooltip"),_this155}return _createClass(Tooltip,[{key:"initialize",value:function(){this.deprecatedOptionsCheck(),this.subscribe("column-init",this.initializeColumn.bind(this))}},{key:"deprecatedOptionsCheck",value:function(){this.deprecationCheckMsg("tooltipGenerationMode","This option is no longer needed as tooltips are always generated on hover now")}},{key:"initializeColumn",value:function(column){column.definition.headerTooltip&&!this.headerSubscriber&&(this.headerSubscriber=!0,this.subscribe("column-mousemove",this.mousemoveCheck.bind(this,"headerTooltip")),this.subscribe("column-mouseout",this.mouseoutCheck.bind(this,"headerTooltip"))),column.definition.tooltip&&!this.tooltipSubscriber&&(this.tooltipSubscriber=!0,this.subscribe("cell-mousemove",this.mousemoveCheck.bind(this,"tooltip")),this.subscribe("cell-mouseout",this.mouseoutCheck.bind(this,"tooltip")))}},{key:"mousemoveCheck",value:function(action,e,component){var tooltip="tooltip"===action?component.column.definition.tooltip:component.definition.headerTooltip;tooltip&&(this.clearPopup(),this.timeout=setTimeout(this.loadTooltip.bind(this,e,component,tooltip),this.table.options.tooltipDelay))}},{key:"mouseoutCheck",value:function(action,e,component){this.popupInstance||this.clearPopup()}},{key:"clearPopup",value:function(action,e,component){clearTimeout(this.timeout),this.timeout=null,this.popupInstance&&this.popupInstance.hide()}},{key:"loadTooltip",value:function(e,component,tooltip){var contentsEl,renderedCallback,coords,_this156=this;"function"==typeof tooltip&&(tooltip=tooltip(e,component.getComponent(),(function(callback){renderedCallback=callback}))),tooltip instanceof HTMLElement?contentsEl=tooltip:(contentsEl=document.createElement("div"),!0===tooltip&&(component instanceof Cell?tooltip=component.value:component.definition.field?this.langBind("columns|"+component.definition.field,(function(value){contentsEl.innerHTML=tooltip=value||component.definition.title})):tooltip=component.definition.title),contentsEl.innerHTML=tooltip),(tooltip||0===tooltip||!1===tooltip)&&(contentsEl.classList.add("tabulator-tooltip"),contentsEl.addEventListener("mousemove",(function(e){return e.preventDefault()})),this.popupInstance=this.popup(contentsEl),"function"==typeof renderedCallback&&this.popupInstance.renderCallback(renderedCallback),coords=this.popupInstance.containerEventCoords(e),this.popupInstance.show(coords.x+15,coords.y+15).hideOnBlur((function(){_this156.dispatchExternal("TooltipClosed",component.getComponent()),_this156.popupInstance=null})),this.dispatchExternal("TooltipOpened",component.getComponent()))}}]),Tooltip}(Module);_exports.TooltipModule=Tooltip,Tooltip.moduleName="tooltip";var defaultValidators={integer:function(cell,value,parameters){return""===value||null==value||(value=Number(value),!isNaN(value)&&isFinite(value)&&Math.floor(value)===value)},float:function(cell,value,parameters){return""===value||null==value||(value=Number(value),!isNaN(value)&&isFinite(value)&&value%1!=0)},numeric:function(cell,value,parameters){return""===value||null==value||!isNaN(value)},string:function(cell,value,parameters){return""===value||null==value||isNaN(value)},max:function(cell,value,parameters){return""===value||null==value||parseFloat(value)<=parameters},min:function(cell,value,parameters){return""===value||null==value||parseFloat(value)>=parameters},starts:function(cell,value,parameters){return""===value||null==value||String(value).toLowerCase().startsWith(String(parameters).toLowerCase())},ends:function(cell,value,parameters){return""===value||null==value||String(value).toLowerCase().endsWith(String(parameters).toLowerCase())},minLength:function(cell,value,parameters){return""===value||null==value||String(value).length>=parameters},maxLength:function(cell,value,parameters){return""===value||null==value||String(value).length<=parameters},in:function(cell,value,parameters){return""===value||null==value||("string"==typeof parameters&&(parameters=parameters.split("|")),parameters.indexOf(value)>-1)},regex:function(cell,value,parameters){return""===value||null==value||new RegExp(parameters).test(value)},unique:function(cell,value,parameters){if(""===value||null==value)return!0;var unique=!0,cellData=cell.getData(),column=cell.getColumn()._getSelf();return this.table.rowManager.rows.forEach((function(row){var data=row.getData();data!==cellData&&value==column.getFieldValue(data)&&(unique=!1)})),unique},required:function(cell,value,parameters){return""!==value&&null!=value}},Validate=function(_Module35){_inherits(Validate,_Module35);var _super40=_createSuper(Validate);function Validate(table){var _this157;return _classCallCheck(this,Validate),(_this157=_super40.call(this,table)).invalidCells=[],_this157.registerTableOption("validationMode","blocking"),_this157.registerColumnOption("validator"),_this157.registerTableFunction("getInvalidCells",_this157.getInvalidCells.bind(_assertThisInitialized(_this157))),_this157.registerTableFunction("clearCellValidation",_this157.userClearCellValidation.bind(_assertThisInitialized(_this157))),_this157.registerTableFunction("validate",_this157.userValidate.bind(_assertThisInitialized(_this157))),_this157.registerComponentFunction("cell","isValid",_this157.cellIsValid.bind(_assertThisInitialized(_this157))),_this157.registerComponentFunction("cell","clearValidation",_this157.clearValidation.bind(_assertThisInitialized(_this157))),_this157.registerComponentFunction("cell","validate",_this157.cellValidate.bind(_assertThisInitialized(_this157))),_this157.registerComponentFunction("column","validate",_this157.columnValidate.bind(_assertThisInitialized(_this157))),_this157.registerComponentFunction("row","validate",_this157.rowValidate.bind(_assertThisInitialized(_this157))),_this157}return _createClass(Validate,[{key:"initialize",value:function(){this.subscribe("cell-delete",this.clearValidation.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("edit-success",this.editValidate.bind(this)),this.subscribe("edit-editor-clear",this.editorClear.bind(this)),this.subscribe("edit-edited-clear",this.editedClear.bind(this))}},{key:"editValidate",value:function(cell,value,previousValue){var _this158=this,valid="manual"===this.table.options.validationMode||this.validate(cell.column.modules.validate,cell,value);return!0!==valid&&setTimeout((function(){cell.getElement().classList.add("tabulator-validation-fail"),_this158.dispatchExternal("validationFailed",cell.getComponent(),value,valid)})),valid}},{key:"editorClear",value:function(cell,cancelled){cancelled&&cell.column.modules.validate&&this.cellValidate(cell),cell.getElement().classList.remove("tabulator-validation-fail")}},{key:"editedClear",value:function(cell){cell.modules.validate&&(cell.modules.validate.invalid=!1)}},{key:"cellIsValid",value:function(cell){return cell.modules.validate&&cell.modules.validate.invalid||!0}},{key:"cellValidate",value:function(cell){return this.validate(cell.column.modules.validate,cell,cell.getValue())}},{key:"columnValidate",value:function(column){var _this159=this,invalid=[];return column.cells.forEach((function(cell){!0!==_this159.cellValidate(cell)&&invalid.push(cell.getComponent())})),!invalid.length||invalid}},{key:"rowValidate",value:function(row){var _this160=this,invalid=[];return row.cells.forEach((function(cell){!0!==_this160.cellValidate(cell)&&invalid.push(cell.getComponent())})),!invalid.length||invalid}},{key:"userClearCellValidation",value:function(cells){var _this161=this;cells||(cells=this.getInvalidCells()),Array.isArray(cells)||(cells=[cells]),cells.forEach((function(cell){_this161.clearValidation(cell._getSelf())}))}},{key:"userValidate",value:function(cells){var output=[];return this.table.rowManager.rows.forEach((function(row){var valid=(row=row.getComponent()).validate();!0!==valid&&(output=output.concat(valid))})),!output.length||output}},{key:"initializeColumnCheck",value:function(column){void 0!==column.definition.validator&&this.initializeColumn(column)}},{key:"initializeColumn",value:function(column){var validator,self=this,config=[];column.definition.validator&&(Array.isArray(column.definition.validator)?column.definition.validator.forEach((function(item){(validator=self._extractValidator(item))&&config.push(validator)})):(validator=this._extractValidator(column.definition.validator))&&config.push(validator),column.modules.validate=!!config.length&&config)}},{key:"_extractValidator",value:function(value){var type,params,pos;switch(_typeof(value)){case"string":return(pos=value.indexOf(":"))>-1?(type=value.substring(0,pos),params=value.substring(pos+1)):type=value,this._buildValidator(type,params);case"function":return this._buildValidator(value);case"object":return this._buildValidator(value.type,value.parameters)}}},{key:"_buildValidator",value:function(type,params){var func="function"==typeof type?type:Validate.validators[type];return func?{type:"function"==typeof type?"function":type,func:func,params:params}:(console.warn("Validator Setup Error - No matching validator found:",type),!1)}},{key:"validate",value:function(validators,cell,value){var self=this,failedValidators=[],invalidIndex=this.invalidCells.indexOf(cell);return validators&&validators.forEach((function(item){item.func.call(self,cell.getComponent(),value,item.params)||failedValidators.push({type:item.type,parameters:item.params})})),cell.modules.validate||(cell.modules.validate={}),failedValidators.length?(cell.modules.validate.invalid=failedValidators,"manual"!==this.table.options.validationMode&&cell.getElement().classList.add("tabulator-validation-fail"),-1==invalidIndex&&this.invalidCells.push(cell)):(cell.modules.validate.invalid=!1,cell.getElement().classList.remove("tabulator-validation-fail"),invalidIndex>-1&&this.invalidCells.splice(invalidIndex,1)),!failedValidators.length||failedValidators}},{key:"getInvalidCells",value:function(){var output=[];return this.invalidCells.forEach((function(cell){output.push(cell.getComponent())})),output}},{key:"clearValidation",value:function(cell){var invalidIndex;cell.modules.validate&&cell.modules.validate.invalid&&(cell.getElement().classList.remove("tabulator-validation-fail"),cell.modules.validate.invalid=!1,(invalidIndex=this.invalidCells.indexOf(cell))>-1&&this.invalidCells.splice(invalidIndex,1))}}]),Validate}(Module);_exports.ValidateModule=Validate,Validate.moduleName="validate",Validate.validators=defaultValidators;var modules=Object.freeze({__proto__:null,AccessorModule:Accessor,AjaxModule:Ajax,ClipboardModule:Clipboard,ColumnCalcsModule:ColumnCalcs,DataTreeModule:DataTree,DownloadModule:Download,EditModule:Edit$1,ExportModule:Export,FilterModule:Filter,FormatModule:Format,FrozenColumnsModule:FrozenColumns,FrozenRowsModule:FrozenRows,GroupRowsModule:GroupRows,HistoryModule:History,HtmlTableImportModule:HtmlTableImport,ImportModule:Import,InteractionModule:Interaction,KeybindingsModule:Keybindings,MenuModule:Menu,MoveColumnsModule:MoveColumns,MoveRowsModule:MoveRows,MutatorModule:Mutator,PageModule:Page,PersistenceModule:Persistence,PopupModule:Popup$1,PrintModule:Print,ReactiveDataModule:ReactiveData,ResizeColumnsModule:ResizeColumns,ResizeRowsModule:ResizeRows,ResizeTableModule:ResizeTable,ResponsiveLayoutModule:ResponsiveLayout,SelectRowModule:SelectRow,SortModule:Sort,TooltipModule:Tooltip,ValidateModule:Validate}),OptionsList=function(){function OptionsList(table,msgType){var defaults=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck(this,OptionsList),this.table=table,this.msgType=msgType,this.registeredDefaults=Object.assign({},defaults)}return _createClass(OptionsList,[{key:"register",value:function(option,value){this.registeredDefaults[option]=value}},{key:"generate",value:function(defaultOptions){var userOptions=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},output=Object.assign({},this.registeredDefaults);if(Object.assign(output,defaultOptions),!1!==userOptions.debugInvalidOptions||this.table.options.debugInvalidOptions)for(var key in userOptions)output.hasOwnProperty(key)||console.warn("Invalid "+this.msgType+" option:",key);for(var _key in output)_key in userOptions?output[_key]=userOptions[_key]:Array.isArray(output[_key])?output[_key]=Object.assign([],output[_key]):"object"===_typeof(output[_key])&&null!==output[_key]?output[_key]=Object.assign({},output[_key]):void 0===output[_key]&&delete output[_key];return output}}]),OptionsList}(),Renderer=function(_CoreFeature6){_inherits(Renderer,_CoreFeature6);var _super41=_createSuper(Renderer);function Renderer(table){var _this162;return _classCallCheck(this,Renderer),(_this162=_super41.call(this,table)).elementVertical=table.rowManager.element,_this162.elementHorizontal=table.columnManager.element,_this162.tableElement=table.rowManager.tableElement,_this162.verticalFillMode="fit",_this162}return _createClass(Renderer,[{key:"initialize",value:function(){}},{key:"clearRows",value:function(){}},{key:"clearColumns",value:function(){}},{key:"reinitializeColumnWidths",value:function(columns){}},{key:"renderRows",value:function(){}},{key:"renderColumns",value:function(){}},{key:"rerenderRows",value:function(callback){callback&&callback()}},{key:"rerenderColumns",value:function(update,blockRedraw){}},{key:"renderRowCells",value:function(row){}},{key:"rerenderRowCells",value:function(row,force){}},{key:"scrollColumns",value:function(left,dir){}},{key:"scrollRows",value:function(top,dir){}},{key:"resize",value:function(){}},{key:"scrollToRow",value:function(row){}},{key:"scrollToRowNearestTop",value:function(row){}},{key:"visibleRows",value:function(includingBuffer){return[]}},{key:"rows",value:function(){return this.table.rowManager.getDisplayRows()}},{key:"styleRow",value:function(row,index){var rowEl=row.getElement();index%2?(rowEl.classList.add("tabulator-row-even"),rowEl.classList.remove("tabulator-row-odd")):(rowEl.classList.add("tabulator-row-odd"),rowEl.classList.remove("tabulator-row-even"))}},{key:"clear",value:function(){this.clearRows(),this.clearColumns()}},{key:"render",value:function(){this.renderRows(),this.renderColumns()}},{key:"rerender",value:function(callback){this.rerenderRows(),this.rerenderColumns()}},{key:"scrollToRowPosition",value:function(row,position,ifVisible){var _this163=this,rowIndex=this.rows().indexOf(row),rowEl=row.getElement(),offset=0;return new Promise((function(resolve,reject){if(rowIndex>-1){if(void 0===ifVisible&&(ifVisible=_this163.table.options.scrollToRowIfVisible),!ifVisible&&Helpers.elVisible(rowEl)&&(offset=Helpers.elOffset(rowEl).top-Helpers.elOffset(_this163.elementVertical).top)>0&&offset<_this163.elementVertical.clientHeight-rowEl.offsetHeight)return resolve(),!1;switch(void 0===position&&(position=_this163.table.options.scrollToRowPosition),"nearest"===position&&(position=_this163.scrollToRowNearestTop(row)?"top":"bottom"),_this163.scrollToRow(row),position){case"middle":case"center":_this163.elementVertical.scrollHeight-_this163.elementVertical.scrollTop==_this163.elementVertical.clientHeight?_this163.elementVertical.scrollTop=_this163.elementVertical.scrollTop+(rowEl.offsetTop-_this163.elementVertical.scrollTop)-(_this163.elementVertical.scrollHeight-rowEl.offsetTop)/2:_this163.elementVertical.scrollTop=_this163.elementVertical.scrollTop-_this163.elementVertical.clientHeight/2;break;case"bottom":_this163.elementVertical.scrollHeight-_this163.elementVertical.scrollTop==_this163.elementVertical.clientHeight?_this163.elementVertical.scrollTop=_this163.elementVertical.scrollTop-(_this163.elementVertical.scrollHeight-rowEl.offsetTop)+rowEl.offsetHeight:_this163.elementVertical.scrollTop=_this163.elementVertical.scrollTop-_this163.elementVertical.clientHeight+rowEl.offsetHeight;break;case"top":_this163.elementVertical.scrollTop=rowEl.offsetTop}resolve()}else console.warn("Scroll Error - Row not visible"),reject("Scroll Error - Row not visible")}))}}]),Renderer}(CoreFeature);_exports.Renderer=Renderer;var BasicHorizontal=function(_Renderer){_inherits(BasicHorizontal,_Renderer);var _super42=_createSuper(BasicHorizontal);function BasicHorizontal(table){return _classCallCheck(this,BasicHorizontal),_super42.call(this,table)}return _createClass(BasicHorizontal,[{key:"renderRowCells",value:function(row){row.cells.forEach((function(cell){row.element.appendChild(cell.getElement()),cell.cellRendered()}))}},{key:"reinitializeColumnWidths",value:function(columns){columns.forEach((function(column){column.reinitializeWidth()}))}}]),BasicHorizontal}(Renderer),VirtualDomHorizontal=function(_Renderer2){_inherits(VirtualDomHorizontal,_Renderer2);var _super43=_createSuper(VirtualDomHorizontal);function VirtualDomHorizontal(table){var _this164;return _classCallCheck(this,VirtualDomHorizontal),(_this164=_super43.call(this,table)).leftCol=0,_this164.rightCol=0,_this164.scrollLeft=0,_this164.vDomScrollPosLeft=0,_this164.vDomScrollPosRight=0,_this164.vDomPadLeft=0,_this164.vDomPadRight=0,_this164.fitDataColAvg=0,_this164.windowBuffer=200,_this164.visibleRows=null,_this164.initialized=!1,_this164.isFitData=!1,_this164.columns=[],_this164}return _createClass(VirtualDomHorizontal,[{key:"initialize",value:function(){this.compatibilityCheck(),this.layoutCheck(),this.vertScrollListen()}},{key:"compatibilityCheck",value:function(){"fitDataTable"==this.options("layout")&&console.warn("Horizontal Virtual DOM is not compatible with fitDataTable layout mode"),this.options("responsiveLayout")&&console.warn("Horizontal Virtual DOM is not compatible with responsive columns"),this.options("rtl")&&console.warn("Horizontal Virtual DOM is not currently compatible with RTL text direction")}},{key:"layoutCheck",value:function(){this.isFitData=this.options("layout").startsWith("fitData")}},{key:"vertScrollListen",value:function(){this.subscribe("scroll-vertical",this.clearVisRowCache.bind(this)),this.subscribe("data-refreshed",this.clearVisRowCache.bind(this))}},{key:"clearVisRowCache",value:function(){this.visibleRows=null}},{key:"renderColumns",value:function(row,force){this.dataChange()}},{key:"scrollColumns",value:function(left,dir){this.scrollLeft!=left&&(this.scrollLeft=left,this.scroll(left-(this.vDomScrollPosLeft+this.windowBuffer)))}},{key:"calcWindowBuffer",value:function(){var buffer=this.elementVertical.clientWidth;this.table.columnManager.columnsByIndex.forEach((function(column){if(column.visible){var width=column.getWidth();width>buffer&&(buffer=width)}})),this.windowBuffer=2*buffer}},{key:"rerenderColumns",value:function(update,blockRedraw){var _this165=this,old={cols:this.columns,leftCol:this.leftCol,rightCol:this.rightCol},colPos=0;update&&!this.initialized||(this.clear(),this.calcWindowBuffer(),this.scrollLeft=this.elementVertical.scrollLeft,this.vDomScrollPosLeft=this.scrollLeft-this.windowBuffer,this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,this.table.columnManager.columnsByIndex.forEach((function(column){var width,config={};column.visible&&(column.modules.frozen||(width=column.getWidth(),config.leftPos=colPos,config.rightPos=colPos+width,config.width=width,_this165.isFitData&&(config.fitDataCheck=!column.modules.vdomHoz||column.modules.vdomHoz.fitDataCheck),colPos+width>_this165.vDomScrollPosLeft&&colPos<_this165.vDomScrollPosRight?(-1==_this165.leftCol&&(_this165.leftCol=_this165.columns.length,_this165.vDomPadLeft=colPos),_this165.rightCol=_this165.columns.length):-1!==_this165.leftCol&&(_this165.vDomPadRight+=width),_this165.columns.push(column),column.modules.vdomHoz=config,colPos+=width))})),this.tableElement.style.paddingLeft=this.vDomPadLeft+"px",this.tableElement.style.paddingRight=this.vDomPadRight+"px",this.initialized=!0,blockRedraw||update&&!this.reinitChanged(old)||this.reinitializeRows(),this.elementVertical.scrollLeft=this.scrollLeft)}},{key:"renderRowCells",value:function(row){this.initialized?this.initializeRow(row):row.cells.forEach((function(cell){row.element.appendChild(cell.getElement()),cell.cellRendered()}))}},{key:"rerenderRowCells",value:function(row,force){this.reinitializeRow(row,force)}},{key:"reinitializeColumnWidths",value:function(columns){for(var i=this.leftCol;i<=this.rightCol;i++)this.columns[i].reinitializeWidth()}},{key:"deinitialize",value:function(){this.initialized=!1}},{key:"clear",value:function(){this.columns=[],this.leftCol=-1,this.rightCol=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0}},{key:"dataChange",value:function(){var row,rowEl,_this166=this,change=!1;if(this.isFitData){if(this.table.columnManager.columnsByIndex.forEach((function(column){!column.definition.width&&column.visible&&(change=!0)})),change&&this.table.rowManager.getDisplayRows().length&&(this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,row=this.chain("rows-sample",[1],[],(function(){return _this166.table.rowManager.getDisplayRows()}))[0])){rowEl=row.getElement(),row.generateCells(),this.tableElement.appendChild(rowEl);for(var colEnd=0;colEnd<row.cells.length;colEnd++){var cell=row.cells[colEnd];rowEl.appendChild(cell.getElement()),cell.column.reinitializeWidth()}rowEl.parentNode.removeChild(rowEl),this.rerenderColumns(!1,!0)}}else"fitColumns"===this.options("layout")&&(this.layoutRefresh(),this.rerenderColumns(!1,!0))}},{key:"reinitChanged",value:function(old){var _this167=this,match=!0;return old.cols.length!==this.columns.length||old.leftCol!==this.leftCol||old.rightCol!==this.rightCol||(old.cols.forEach((function(col,i){col!==_this167.columns[i]&&(match=!1)})),!match)}},{key:"reinitializeRows",value:function(){var _this168=this,visibleRows=this.getVisibleRows(),otherRows=this.table.rowManager.getRows().filter((function(row){return!visibleRows.includes(row)}));visibleRows.forEach((function(row){_this168.reinitializeRow(row,!0)})),otherRows.forEach((function(row){row.deinitialize()}))}},{key:"getVisibleRows",value:function(){return this.visibleRows||(this.visibleRows=this.table.rowManager.getVisibleRows()),this.visibleRows}},{key:"scroll",value:function(diff){this.vDomScrollPosLeft+=diff,this.vDomScrollPosRight+=diff,Math.abs(diff)>this.windowBuffer/2?this.rerenderColumns():diff>0?(this.addColRight(),this.removeColLeft()):(this.addColLeft(),this.removeColRight())}},{key:"colPositionAdjust",value:function(start,end,diff){for(var i=start;i<end;i++){var column=this.columns[i];column.modules.vdomHoz.leftPos+=diff,column.modules.vdomHoz.rightPos+=diff}}},{key:"addColRight",value:function(){for(var _this169=this,changes=!1,working=!0,_loop3=function(){var column=_this169.columns[_this169.rightCol+1];column&&column.modules.vdomHoz.leftPos<=_this169.vDomScrollPosRight?(changes=!0,_this169.getVisibleRows().forEach((function(row){if("group"!==row.type){var cell=row.getCell(column);row.getElement().insertBefore(cell.getElement(),row.getCell(_this169.columns[_this169.rightCol]).getElement().nextSibling),cell.cellRendered()}})),_this169.fitDataColActualWidthCheck(column),_this169.rightCol++,_this169.getVisibleRows().forEach((function(row){"group"!==row.type&&(row.modules.vdomHoz.rightCol=_this169.rightCol)})),_this169.rightCol>=_this169.columns.length-1?_this169.vDomPadRight=0:_this169.vDomPadRight-=column.getWidth()):working=!1};working;)_loop3();changes&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}},{key:"addColLeft",value:function(){for(var _this170=this,changes=!1,working=!0,_loop4=function(){var column=_this170.columns[_this170.leftCol-1];if(column)if(column.modules.vdomHoz.rightPos>=_this170.vDomScrollPosLeft){changes=!0,_this170.getVisibleRows().forEach((function(row){if("group"!==row.type){var cell=row.getCell(column);row.getElement().insertBefore(cell.getElement(),row.getCell(_this170.columns[_this170.leftCol]).getElement()),cell.cellRendered()}})),_this170.leftCol--,_this170.getVisibleRows().forEach((function(row){"group"!==row.type&&(row.modules.vdomHoz.leftCol=_this170.leftCol)})),_this170.leftCol<=0?_this170.vDomPadLeft=0:_this170.vDomPadLeft-=column.getWidth();var diff=_this170.fitDataColActualWidthCheck(column);diff&&(_this170.scrollLeft=_this170.elementVertical.scrollLeft=_this170.elementVertical.scrollLeft+diff,_this170.vDomPadRight-=diff)}else working=!1;else working=!1};working;)_loop4();changes&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}},{key:"removeColRight",value:function(){for(var _this171=this,changes=!1,working=!0,_loop5=function(){var column=_this171.columns[_this171.rightCol];column&&column.modules.vdomHoz.leftPos>_this171.vDomScrollPosRight?(changes=!0,_this171.getVisibleRows().forEach((function(row){if("group"!==row.type){var cell=row.getCell(column);try{row.getElement().removeChild(cell.getElement())}catch(ex){console.warn("Could not removeColRight",ex.message)}}})),_this171.vDomPadRight+=column.getWidth(),_this171.rightCol--,_this171.getVisibleRows().forEach((function(row){"group"!==row.type&&(row.modules.vdomHoz.rightCol=_this171.rightCol)}))):working=!1};working;)_loop5();changes&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}},{key:"removeColLeft",value:function(){for(var _this172=this,changes=!1,working=!0,_loop6=function(){var column=_this172.columns[_this172.leftCol];column&&column.modules.vdomHoz.rightPos<_this172.vDomScrollPosLeft?(changes=!0,_this172.getVisibleRows().forEach((function(row){if("group"!==row.type){var cell=row.getCell(column);try{row.getElement().removeChild(cell.getElement())}catch(ex){console.warn("Could not removeColLeft",ex.message)}}})),_this172.vDomPadLeft+=column.getWidth(),_this172.leftCol++,_this172.getVisibleRows().forEach((function(row){"group"!==row.type&&(row.modules.vdomHoz.leftCol=_this172.leftCol)}))):working=!1};working;)_loop6();changes&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}},{key:"fitDataColActualWidthCheck",value:function(column){var newWidth,widthDiff;return column.modules.vdomHoz.fitDataCheck&&(column.reinitializeWidth(),(widthDiff=(newWidth=column.getWidth())-column.modules.vdomHoz.width)&&(column.modules.vdomHoz.rightPos+=widthDiff,column.modules.vdomHoz.width=newWidth,this.colPositionAdjust(this.columns.indexOf(column)+1,this.columns.length,widthDiff)),column.modules.vdomHoz.fitDataCheck=!1),widthDiff}},{key:"initializeRow",value:function(row){var _this173=this;if("group"!==row.type){row.modules.vdomHoz={leftCol:this.leftCol,rightCol:this.rightCol},this.table.modules.frozenColumns&&this.table.modules.frozenColumns.leftColumns.forEach((function(column){_this173.appendCell(row,column)}));for(var i=this.leftCol;i<=this.rightCol;i++)this.appendCell(row,this.columns[i]);this.table.modules.frozenColumns&&this.table.modules.frozenColumns.rightColumns.forEach((function(column){_this173.appendCell(row,column)}))}}},{key:"appendCell",value:function(row,column){if(column&&column.visible){var cell=row.getCell(column);row.getElement().appendChild(cell.getElement()),cell.cellRendered()}}},{key:"reinitializeRow",value:function(row,force){if("group"!==row.type&&(force||!row.modules.vdomHoz||row.modules.vdomHoz.leftCol!==this.leftCol||row.modules.vdomHoz.rightCol!==this.rightCol)){for(var rowEl=row.getElement();rowEl.firstChild;)rowEl.removeChild(rowEl.firstChild);this.initializeRow(row)}}}]),VirtualDomHorizontal}(Renderer),ColumnManager=function(_CoreFeature7){_inherits(ColumnManager,_CoreFeature7);var _super44=_createSuper(ColumnManager);function ColumnManager(table){var _this174;return _classCallCheck(this,ColumnManager),(_this174=_super44.call(this,table)).blockHozScrollEvent=!1,_this174.headersElement=null,_this174.contentsElement=null,_this174.element=null,_this174.columns=[],_this174.columnsByIndex=[],_this174.columnsByField={},_this174.scrollLeft=0,_this174.optionsList=new OptionsList(_this174.table,"column definition",defaultColumnOptions),_this174.redrawBlock=!1,_this174.redrawBlockUpdate=null,_this174.renderer=null,_this174}return _createClass(ColumnManager,[{key:"initialize",value:function(){this.initializeRenderer(),this.headersElement=this.createHeadersElement(),this.contentsElement=this.createHeaderContentsElement(),this.element=this.createHeaderElement(),this.contentsElement.insertBefore(this.headersElement,this.contentsElement.firstChild),this.element.insertBefore(this.contentsElement,this.element.firstChild),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("scrollbar-vertical",this.padVerticalScrollbar.bind(this))}},{key:"padVerticalScrollbar",value:function(width){this.table.rtl?this.headersElement.style.marginLeft=width+"px":this.headersElement.style.marginRight=width+"px"}},{key:"initializeRenderer",value:function(){var renderClass,renderers={virtual:VirtualDomHorizontal,basic:BasicHorizontal};(renderClass="string"==typeof this.table.options.renderHorizontal?renderers[this.table.options.renderHorizontal]:this.table.options.renderHorizontal)?(this.renderer=new renderClass(this.table,this.element,this.tableElement),this.renderer.initialize()):console.error("Unable to find matching renderer:",this.table.options.renderHorizontal)}},{key:"createHeadersElement",value:function(){var el=document.createElement("div");return el.classList.add("tabulator-headers"),el.setAttribute("role","row"),el}},{key:"createHeaderContentsElement",value:function(){var el=document.createElement("div");return el.classList.add("tabulator-header-contents"),el.setAttribute("role","rowgroup"),el}},{key:"createHeaderElement",value:function(){var el=document.createElement("div");return el.classList.add("tabulator-header"),el.setAttribute("role","rowgroup"),this.table.options.headerVisible||el.classList.add("tabulator-header-hidden"),el}},{key:"getElement",value:function(){return this.element}},{key:"getContentsElement",value:function(){return this.contentsElement}},{key:"getHeadersElement",value:function(){return this.headersElement}},{key:"scrollHorizontal",value:function(left){this.contentsElement.scrollLeft=left,this.scrollLeft=left,this.renderer.scrollColumns(left)}},{key:"generateColumnsFromRowData",value:function(data){var row,sorter,cols=[],definitions=this.table.options.autoColumnsDefinitions;if(data&&data.length){for(var key in row=data[0]){var col={field:key,title:key},value=row[key];switch(_typeof(value)){case"undefined":sorter="string";break;case"boolean":sorter="boolean";break;case"object":sorter=Array.isArray(value)?"array":"string";break;default:sorter=isNaN(value)||""===value?value.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)?"alphanum":"string":"number"}col.sorter=sorter,cols.push(col)}if(definitions)switch(_typeof(definitions)){case"function":this.table.options.columns=definitions.call(this.table,cols);break;case"object":Array.isArray(definitions)?cols.forEach((function(col){var match=definitions.find((function(def){return def.field===col.field}));match&&Object.assign(col,match)})):cols.forEach((function(col){definitions[col.field]&&Object.assign(col,definitions[col.field])})),this.table.options.columns=cols}else this.table.options.columns=cols;this.setColumns(this.table.options.columns)}}},{key:"setColumns",value:function(cols,row){for(var _this175=this;this.headersElement.firstChild;)this.headersElement.removeChild(this.headersElement.firstChild);this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.dispatch("columns-loading"),cols.forEach((function(def,i){_this175._addColumn(def)})),this._reIndexColumns(),this.dispatch("columns-loaded"),this.rerenderColumns(!1,!0),this.redraw(!0)}},{key:"_addColumn",value:function(definition,before,nextToColumn){var column=new Column(definition,this),colEl=column.getElement(),index=nextToColumn?this.findColumnIndex(nextToColumn):nextToColumn;if(nextToColumn&&index>-1){var topColumn=nextToColumn.getTopColumn(),parentIndex=this.columns.indexOf(topColumn),nextEl=topColumn.getElement();before?(this.columns.splice(parentIndex,0,column),nextEl.parentNode.insertBefore(colEl,nextEl)):(this.columns.splice(parentIndex+1,0,column),nextEl.parentNode.insertBefore(colEl,nextEl.nextSibling))}else before?(this.columns.unshift(column),this.headersElement.insertBefore(column.getElement(),this.headersElement.firstChild)):(this.columns.push(column),this.headersElement.appendChild(column.getElement()));return column.columnRendered(),column}},{key:"registerColumnField",value:function(col){col.definition.field&&(this.columnsByField[col.definition.field]=col)}},{key:"registerColumnPosition",value:function(col){this.columnsByIndex.push(col)}},{key:"_reIndexColumns",value:function(){this.columnsByIndex=[],this.columns.forEach((function(column){column.reRegisterPosition()}))}},{key:"verticalAlignHeaders",value:function(){var _this176=this,minHeight=0;this.redrawBlock||(this.headersElement.style.height="",this.columns.forEach((function(column){column.clearVerticalAlign()})),this.columns.forEach((function(column){var height=column.getHeight();height>minHeight&&(minHeight=height)})),this.headersElement.style.height=minHeight+"px",this.columns.forEach((function(column){column.verticalAlign(_this176.table.options.columnHeaderVertAlign,minHeight)})),this.table.rowManager.adjustTableSize())}},{key:"findColumn",value:function(subject){var columns;return"object"!=_typeof(subject)?this.columnsByField[subject]||!1:subject instanceof Column?subject:subject instanceof ColumnComponent?subject._getSelf()||!1:"undefined"!=typeof HTMLElement&&subject instanceof HTMLElement&&(columns=[],this.columns.forEach((function(column){columns.push(column),columns=columns.concat(column.getColumns(!0))})),columns.find((function(column){return column.element===subject}))||!1)}},{key:"getColumnByField",value:function(field){return this.columnsByField[field]}},{key:"getColumnsByFieldRoot",value:function(root){var _this177=this,matches=[];return Object.keys(this.columnsByField).forEach((function(field){field.split(".")[0]===root&&matches.push(_this177.columnsByField[field])})),matches}},{key:"getColumnByIndex",value:function(index){return this.columnsByIndex[index]}},{key:"getFirstVisibleColumn",value:function(){var index=this.columnsByIndex.findIndex((function(col){return col.visible}));return index>-1&&this.columnsByIndex[index]}},{key:"getColumns",value:function(){return this.columns}},{key:"findColumnIndex",value:function(column){return this.columnsByIndex.findIndex((function(col){return column===col}))}},{key:"getRealColumns",value:function(){return this.columnsByIndex}},{key:"traverse",value:function(callback){this.columnsByIndex.forEach((function(column,i){callback(column,i)}))}},{key:"getDefinitions",value:function(active){var output=[];return this.columnsByIndex.forEach((function(column){(!active||active&&column.visible)&&output.push(column.getDefinition())})),output}},{key:"getDefinitionTree",value:function(){var output=[];return this.columns.forEach((function(column){output.push(column.getDefinition(!0))})),output}},{key:"getComponents",value:function(structured){var output=[];return(structured?this.columns:this.columnsByIndex).forEach((function(column){output.push(column.getComponent())})),output}},{key:"getWidth",value:function(){var width=0;return this.columnsByIndex.forEach((function(column){column.visible&&(width+=column.getWidth())})),width}},{key:"moveColumn",value:function(from,to,after){to.element.parentNode.insertBefore(from.element,to.element),after&&to.element.parentNode.insertBefore(to.element,from.element),this.moveColumnActual(from,to,after),this.verticalAlignHeaders(),this.table.rowManager.reinitialize()}},{key:"moveColumnActual",value:function(from,to,after){from.parent.isGroup?this._moveColumnInArray(from.parent.columns,from,to,after):this._moveColumnInArray(this.columns,from,to,after),this._moveColumnInArray(this.columnsByIndex,from,to,after,!0),this.rerenderColumns(!0),this.dispatch("column-moved",from,to,after),this.subscribedExternal("columnMoved")&&this.dispatchExternal("columnMoved",from.getComponent(),this.table.columnManager.getComponents())}},{key:"_moveColumnInArray",value:function(columns,from,to,after,updateRows){var toIndex,fromIndex=columns.indexOf(from);fromIndex>-1&&(columns.splice(fromIndex,1),(toIndex=columns.indexOf(to))>-1?after&&(toIndex+=1):toIndex=fromIndex,columns.splice(toIndex,0,from),updateRows&&(this.chain("column-moving-rows",[from,to,after],null,[])||[]).concat(this.table.rowManager.rows).forEach((function(row){if(row.cells.length){var cell=row.cells.splice(fromIndex,1)[0];row.cells.splice(toIndex,0,cell)}})))}},{key:"scrollToColumn",value:function(column,position,ifVisible){var _this178=this,left=0,offset=column.getLeftOffset(),adjust=0,colEl=column.getElement();return new Promise((function(resolve,reject){if(void 0===position&&(position=_this178.table.options.scrollToColumnPosition),void 0===ifVisible&&(ifVisible=_this178.table.options.scrollToColumnIfVisible),column.visible){switch(position){case"middle":case"center":adjust=-_this178.element.clientWidth/2;break;case"right":adjust=colEl.clientWidth-_this178.headersElement.clientWidth}if(!ifVisible&&offset>0&&offset+colEl.offsetWidth<_this178.element.clientWidth)return!1;left=offset+adjust,left=Math.max(Math.min(left,_this178.table.rowManager.element.scrollWidth-_this178.table.rowManager.element.clientWidth),0),_this178.table.rowManager.scrollHorizontal(left),_this178.scrollHorizontal(left),resolve()}else console.warn("Scroll Error - Column not visible"),reject("Scroll Error - Column not visible")}))}},{key:"generateCells",value:function(row){var cells=[];return this.columnsByIndex.forEach((function(column){cells.push(column.generateCell(row))})),cells}},{key:"getFlexBaseWidth",value:function(){var totalWidth=this.table.element.clientWidth,fixedWidth=0;return this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(totalWidth-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),this.columnsByIndex.forEach((function(column){var width,minWidth,colWidth;column.visible&&(width=column.definition.width||0,minWidth=parseInt(column.minWidth),colWidth="string"==typeof width?width.indexOf("%")>-1?totalWidth/100*parseInt(width):parseInt(width):width,fixedWidth+=colWidth>minWidth?colWidth:minWidth)})),fixedWidth}},{key:"addColumn",value:function(definition,before,nextToColumn){var _this179=this;return new Promise((function(resolve,reject){var column=_this179._addColumn(definition,before,nextToColumn);_this179._reIndexColumns(),_this179.dispatch("column-add",definition,before,nextToColumn),"fitColumns"!=_this179.layoutMode()&&column.reinitializeWidth(),_this179.redraw(!0),_this179.table.rowManager.reinitialize(),_this179.rerenderColumns(),resolve(column)}))}},{key:"deregisterColumn",value:function(column){var index,field=column.getField();field&&delete this.columnsByField[field],(index=this.columnsByIndex.indexOf(column))>-1&&this.columnsByIndex.splice(index,1),(index=this.columns.indexOf(column))>-1&&this.columns.splice(index,1),this.verticalAlignHeaders(),this.redraw()}},{key:"rerenderColumns",value:function(update,silent){this.redrawBlock?(!1===update||!0===update&&null===this.redrawBlockUpdate)&&(this.redrawBlockUpdate=update):this.renderer.rerenderColumns(update,silent)}},{key:"blockRedraw",value:function(){this.redrawBlock=!0,this.redrawBlockUpdate=null}},{key:"restoreRedraw",value:function(){this.redrawBlock=!1,this.verticalAlignHeaders(),this.renderer.rerenderColumns(this.redrawBlockUpdate)}},{key:"redraw",value:function(force){Helpers.elVisible(this.element)&&this.verticalAlignHeaders(),force&&(this.table.rowManager.resetScroll(),this.table.rowManager.reinitialize()),this.confirm("table-redrawing",force)||this.layoutRefresh(force),this.dispatch("table-redraw",force),this.table.footerManager.redraw()}}]),ColumnManager}(CoreFeature),BasicVertical=function(_Renderer3){_inherits(BasicVertical,_Renderer3);var _super45=_createSuper(BasicVertical);function BasicVertical(table){var _this180;return _classCallCheck(this,BasicVertical),(_this180=_super45.call(this,table)).verticalFillMode="fill",_this180.scrollTop=0,_this180.scrollLeft=0,_this180.scrollTop=0,_this180.scrollLeft=0,_this180}return _createClass(BasicVertical,[{key:"clearRows",value:function(){for(var element=this.tableElement;element.firstChild;)element.removeChild(element.firstChild);element.scrollTop=0,element.scrollLeft=0,element.style.minWidth="",element.style.minHeight="",element.style.display="",element.style.visibility=""}},{key:"renderRows",value:function(){var _this181=this,element=this.tableElement,onlyGroupHeaders=!0;this.rows().forEach((function(row,index){_this181.styleRow(row,index),element.appendChild(row.getElement()),row.initialize(!0),"group"!==row.type&&(onlyGroupHeaders=!1)})),element.style.minWidth=onlyGroupHeaders?this.table.columnManager.getWidth()+"px":""}},{key:"rerenderRows",value:function(callback){this.clearRows(),this.renderRows(),callback&&callback()}},{key:"scrollToRowNearestTop",value:function(row){var rowTop=Helpers.elOffset(row.getElement()).top;return!(Math.abs(this.elementVertical.scrollTop-rowTop)>Math.abs(this.elementVertical.scrollTop+this.elementVertical.clientHeight-rowTop))}},{key:"scrollToRow",value:function(row){var rowEl=row.getElement();this.elementVertical.scrollTop=Helpers.elOffset(rowEl).top-Helpers.elOffset(this.elementVertical).top+this.elementVertical.scrollTop}},{key:"visibleRows",value:function(includingBuffer){return this.rows()}}]),BasicVertical}(Renderer),VirtualDomVertical=function(_Renderer4){_inherits(VirtualDomVertical,_Renderer4);var _super46=_createSuper(VirtualDomVertical);function VirtualDomVertical(table){var _this182;return _classCallCheck(this,VirtualDomVertical),(_this182=_super46.call(this,table)).verticalFillMode="fill",_this182.scrollTop=0,_this182.scrollLeft=0,_this182.vDomRowHeight=20,_this182.vDomTop=0,_this182.vDomBottom=0,_this182.vDomScrollPosTop=0,_this182.vDomScrollPosBottom=0,_this182.vDomTopPad=0,_this182.vDomBottomPad=0,_this182.vDomMaxRenderChain=90,_this182.vDomWindowBuffer=0,_this182.vDomWindowMinTotalRows=20,_this182.vDomWindowMinMarginRows=5,_this182.vDomTopNewRows=[],_this182.vDomBottomNewRows=[],_this182}return _createClass(VirtualDomVertical,[{key:"clearRows",value:function(){for(var element=this.tableElement;element.firstChild;)element.removeChild(element.firstChild);element.style.paddingTop="",element.style.paddingBottom="",element.style.minHeight="",element.style.display="",element.style.visibility="",this.elementVertical.scrollTop=0,this.elementVertical.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0,this.vDomTop=0,this.vDomBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0}},{key:"renderRows",value:function(){this._virtualRenderFill()}},{key:"rerenderRows",value:function(callback){for(var scrollTop=this.elementVertical.scrollTop,topRow=!1,topOffset=!1,left=this.table.rowManager.scrollLeft,rows=this.rows(),i=this.vDomTop;i<=this.vDomBottom;i++)if(rows[i]){var diff=scrollTop-rows[i].getElement().offsetTop;if(!(!1===topOffset||Math.abs(diff)<topOffset))break;topOffset=diff,topRow=i}rows.forEach((function(row){row.deinitializeHeight()})),callback&&callback(),this.rows().length?this._virtualRenderFill(!1===topRow?this.rows.length-1:topRow,!0,topOffset||0):(this.clear(),this.table.rowManager._showPlaceholder()),this.scrollColumns(left)}},{key:"scrollColumns",value:function(left){this.table.rowManager.scrollHorizontal(left)}},{key:"scrollRows",value:function(top,dir){var topDiff=top-this.vDomScrollPosTop,bottomDiff=top-this.vDomScrollPosBottom,margin=2*this.vDomWindowBuffer,rows=this.rows();if(this.scrollTop=top,-topDiff>margin||bottomDiff>margin){var left=this.table.rowManager.scrollLeft;this._virtualRenderFill(Math.floor(this.elementVertical.scrollTop/this.elementVertical.scrollHeight*rows.length)),this.scrollColumns(left)}else dir?(topDiff<0&&this._addTopRow(rows,-topDiff),bottomDiff<0&&(this.vDomScrollHeight-this.scrollTop>this.vDomWindowBuffer?this._removeBottomRow(rows,-bottomDiff):this.vDomScrollPosBottom=this.scrollTop)):(bottomDiff>=0&&this._addBottomRow(rows,bottomDiff),topDiff>=0&&(this.scrollTop>this.vDomWindowBuffer?this._removeTopRow(rows,topDiff):this.vDomScrollPosTop=this.scrollTop))}},{key:"resize",value:function(){this.vDomWindowBuffer=this.table.options.renderVerticalBuffer||this.elementVertical.clientHeight}},{key:"scrollToRowNearestTop",value:function(row){var rowIndex=this.rows().indexOf(row);return!(Math.abs(this.vDomTop-rowIndex)>Math.abs(this.vDomBottom-rowIndex))}},{key:"scrollToRow",value:function(row){var index=this.rows().indexOf(row);index>-1&&this._virtualRenderFill(index,!0)}},{key:"visibleRows",value:function(includingBuffer){var topEdge=this.elementVertical.scrollTop,bottomEdge=this.elementVertical.clientHeight+topEdge,topFound=!1,topRow=0,bottomRow=0,rows=this.rows();if(includingBuffer)topRow=this.vDomTop,bottomRow=this.vDomBottom;else for(var i=this.vDomTop;i<=this.vDomBottom;i++)if(rows[i])if(topFound){if(!(bottomEdge-rows[i].getElement().offsetTop>=0))break;bottomRow=i}else if(topEdge-rows[i].getElement().offsetTop>=0)topRow=i;else{if(topFound=!0,!(bottomEdge-rows[i].getElement().offsetTop>=0))break;bottomRow=i}return rows.slice(topRow,bottomRow+1)}},{key:"_virtualRenderFill",value:function(position,forceMove,offset){var element=this.tableElement,holder=this.elementVertical,topPad=0,rowsHeight=0,heightOccupied=0,topPadHeight=0,i=0,rows=this.rows(),rowsCount=rows.length,containerHeight=this.elementVertical.clientHeight;if(offset=offset||0,position=position||0){for(;element.firstChild;)element.removeChild(element.firstChild);(heightOccupied=(rowsCount-position+1)*this.vDomRowHeight)<containerHeight&&(position-=Math.ceil((containerHeight-heightOccupied)/this.vDomRowHeight))<0&&(position=0),position-=topPad=Math.min(Math.max(Math.floor(this.vDomWindowBuffer/this.vDomRowHeight),this.vDomWindowMinMarginRows),position)}else this.clear();if(rowsCount&&Helpers.elVisible(this.elementVertical)){for(this.vDomTop=position,this.vDomBottom=position-1;(rowsHeight<=containerHeight+this.vDomWindowBuffer||i<this.vDomWindowMinTotalRows)&&this.vDomBottom<rowsCount-1;){var rowHeight,index=this.vDomBottom+1,row=rows[index];this.styleRow(row,index),element.appendChild(row.getElement()),row.initialize(),row.heightInitialized||row.normalizeHeight(!0),rowHeight=row.getHeight(),i<topPad?topPadHeight+=rowHeight:rowsHeight+=rowHeight,rowHeight>this.vDomWindowBuffer&&(this.vDomWindowBuffer=2*rowHeight),this.vDomBottom++,i++}position?(this.vDomTopPad=forceMove?this.vDomRowHeight*this.vDomTop+offset:this.scrollTop-topPadHeight,this.vDomBottomPad=this.vDomBottom==rowsCount-1?0:Math.max(this.vDomScrollHeight-this.vDomTopPad-rowsHeight-topPadHeight,0)):(this.vDomTopPad=0,this.vDomRowHeight=Math.floor((rowsHeight+topPadHeight)/i),this.vDomBottomPad=this.vDomRowHeight*(rowsCount-this.vDomBottom-1),this.vDomScrollHeight=topPadHeight+rowsHeight+this.vDomBottomPad-containerHeight),element.style.paddingTop=this.vDomTopPad+"px",element.style.paddingBottom=this.vDomBottomPad+"px",forceMove&&(this.scrollTop=this.vDomTopPad+topPadHeight+offset-(this.elementVertical.scrollWidth>this.elementVertical.clientWidth?this.elementVertical.offsetHeight-containerHeight:0)),this.scrollTop=Math.min(this.scrollTop,this.elementVertical.scrollHeight-containerHeight),this.elementVertical.scrollWidth>this.elementVertical.offsetWidth&&forceMove&&(this.scrollTop+=this.elementVertical.offsetHeight-containerHeight),this.vDomScrollPosTop=this.scrollTop,this.vDomScrollPosBottom=this.scrollTop,holder.scrollTop=this.scrollTop,this.dispatch("render-virtual-fill")}}},{key:"_addTopRow",value:function(rows,fillableSpace){for(var table=this.tableElement,addedRows=[],paddingAdjust=0,index=this.vDomTop-1,i=0,working=!0;working;)if(this.vDomTop){var row=rows[index],rowHeight=void 0,initialized=void 0;row&&i<this.vDomMaxRenderChain?(rowHeight=row.getHeight()||this.vDomRowHeight,initialized=row.initialized,fillableSpace>=rowHeight?(this.styleRow(row,index),table.insertBefore(row.getElement(),table.firstChild),row.initialized&&row.heightInitialized||addedRows.push(row),row.initialize(),initialized||(rowHeight=row.getElement().offsetHeight)>this.vDomWindowBuffer&&(this.vDomWindowBuffer=2*rowHeight),fillableSpace-=rowHeight,paddingAdjust+=rowHeight,this.vDomTop--,index--,i++):working=!1):working=!1}else working=!1;for(var _i3=0,_addedRows=addedRows;_i3<_addedRows.length;_i3++){_addedRows[_i3].clearCellHeight()}this._quickNormalizeRowHeight(addedRows),paddingAdjust&&(this.vDomTopPad-=paddingAdjust,this.vDomTopPad<0&&(this.vDomTopPad=index*this.vDomRowHeight),index<1&&(this.vDomTopPad=0),table.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop-=paddingAdjust)}},{key:"_removeTopRow",value:function(rows,fillableSpace){for(var removableRows=[],paddingAdjust=0,i=0,working=!0;working;){var row=rows[this.vDomTop],rowHeight=void 0;row&&i<this.vDomMaxRenderChain&&fillableSpace>=(rowHeight=row.getHeight()||this.vDomRowHeight)?(this.vDomTop++,fillableSpace-=rowHeight,paddingAdjust+=rowHeight,removableRows.push(row),i++):working=!1}for(var _i4=0,_removableRows=removableRows;_i4<_removableRows.length;_i4++){var rowEl=_removableRows[_i4].getElement();rowEl.parentNode&&rowEl.parentNode.removeChild(rowEl)}paddingAdjust&&(this.vDomTopPad+=paddingAdjust,this.tableElement.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop+=this.vDomTop?paddingAdjust:paddingAdjust+this.vDomWindowBuffer)}},{key:"_addBottomRow",value:function(rows,fillableSpace){for(var table=this.tableElement,addedRows=[],paddingAdjust=0,index=this.vDomBottom+1,i=0,working=!0;working;){var row=rows[index],rowHeight=void 0,initialized=void 0;row&&i<this.vDomMaxRenderChain?(rowHeight=row.getHeight()||this.vDomRowHeight,initialized=row.initialized,fillableSpace>=rowHeight?(this.styleRow(row,index),table.appendChild(row.getElement()),row.initialized&&row.heightInitialized||addedRows.push(row),row.initialize(),initialized||(rowHeight=row.getElement().offsetHeight)>this.vDomWindowBuffer&&(this.vDomWindowBuffer=2*rowHeight),fillableSpace-=rowHeight,paddingAdjust+=rowHeight,this.vDomBottom++,index++,i++):working=!1):working=!1}for(var _i5=0,_addedRows2=addedRows;_i5<_addedRows2.length;_i5++){_addedRows2[_i5].clearCellHeight()}this._quickNormalizeRowHeight(addedRows),paddingAdjust&&(this.vDomBottomPad-=paddingAdjust,(this.vDomBottomPad<0||index==rows.length-1)&&(this.vDomBottomPad=0),table.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom+=paddingAdjust)}},{key:"_removeBottomRow",value:function(rows,fillableSpace){for(var removableRows=[],paddingAdjust=0,i=0,working=!0;working;){var row=rows[this.vDomBottom],rowHeight=void 0;row&&i<this.vDomMaxRenderChain&&fillableSpace>=(rowHeight=row.getHeight()||this.vDomRowHeight)?(this.vDomBottom--,fillableSpace-=rowHeight,paddingAdjust+=rowHeight,removableRows.push(row),i++):working=!1}for(var _i6=0,_removableRows2=removableRows;_i6<_removableRows2.length;_i6++){var rowEl=_removableRows2[_i6].getElement();rowEl.parentNode&&rowEl.parentNode.removeChild(rowEl)}paddingAdjust&&(this.vDomBottomPad+=paddingAdjust,this.vDomBottomPad<0&&(this.vDomBottomPad=0),this.tableElement.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom-=paddingAdjust)}},{key:"_quickNormalizeRowHeight",value:function(rows){var _step4,_iterator4=_createForOfIteratorHelper(rows);try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){_step4.value.calcHeight()}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}var _step5,_iterator5=_createForOfIteratorHelper(rows);try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){_step5.value.setCellHeight()}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}}}]),VirtualDomVertical}(Renderer),RowManager=function(_CoreFeature8){_inherits(RowManager,_CoreFeature8);var _super47=_createSuper(RowManager);function RowManager(table){var _this183;return _classCallCheck(this,RowManager),(_this183=_super47.call(this,table)).element=_this183.createHolderElement(),_this183.tableElement=_this183.createTableElement(),_this183.heightFixer=_this183.createTableElement(),_this183.placeholder=null,_this183.placeholderContents=null,_this183.firstRender=!1,_this183.renderMode="virtual",_this183.fixedHeight=!1,_this183.rows=[],_this183.activeRowsPipeline=[],_this183.activeRows=[],_this183.activeRowsCount=0,_this183.displayRows=[],_this183.displayRowsCount=0,_this183.scrollTop=0,_this183.scrollLeft=0,_this183.redrawBlock=!1,_this183.redrawBlockRestoreConfig=!1,_this183.redrawBlockRenderInPosition=!1,_this183.dataPipeline=[],_this183.displayPipeline=[],_this183.scrollbarWidth=0,_this183.renderer=null,_this183}return _createClass(RowManager,[{key:"createHolderElement",value:function(){var el=document.createElement("div");return el.classList.add("tabulator-tableholder"),el.setAttribute("tabindex",0),el}},{key:"createTableElement",value:function(){var el=document.createElement("div");return el.classList.add("tabulator-table"),el.setAttribute("role","rowgroup"),el}},{key:"initializePlaceholder",value:function(){if("string"==typeof this.table.options.placeholder){var el=document.createElement("div");el.classList.add("tabulator-placeholder");var contents=document.createElement("div");contents.classList.add("tabulator-placeholder-contents"),contents.innerHTML=this.table.options.placeholder,el.appendChild(contents),this.placeholderContents=contents,this.placeholder=el}}},{key:"getElement",value:function(){return this.element}},{key:"getTableElement",value:function(){return this.tableElement}},{key:"initialize",value:function(){var _this184=this;this.initializePlaceholder(),this.initializeRenderer(),this.element.appendChild(this.tableElement),this.firstRender=!0,this.element.addEventListener("scroll",(function(){var left=_this184.element.scrollLeft,leftDir=_this184.scrollLeft>left,top=_this184.element.scrollTop,topDir=_this184.scrollTop>top;_this184.scrollLeft!=left&&(_this184.scrollLeft=left,_this184.dispatch("scroll-horizontal",left,leftDir),_this184.dispatchExternal("scrollHorizontal",left,leftDir),_this184._positionPlaceholder()),_this184.scrollTop!=top&&(_this184.scrollTop=top,_this184.renderer.scrollRows(top,topDir),_this184.dispatch("scroll-vertical",top,topDir),_this184.dispatchExternal("scrollVertical",top,topDir))}))}},{key:"findRow",value:function(subject){var _this185=this;return"object"!=_typeof(subject)?void 0!==subject&&(this.rows.find((function(row){return row.data[_this185.table.options.index]==subject}))||!1):subject instanceof Row?subject:subject instanceof RowComponent?subject._getSelf()||!1:"undefined"!=typeof HTMLElement&&subject instanceof HTMLElement&&this.rows.find((function(row){return row.getElement()===subject}))||!1}},{key:"getRowFromDataObject",value:function(data){return this.rows.find((function(row){return row.data===data}))||!1}},{key:"getRowFromPosition",value:function(position){return this.getDisplayRows().find((function(row){return row.getPosition()===position&&row.isDisplayed()}))}},{key:"scrollToRow",value:function(row,position,ifVisible){return this.renderer.scrollToRowPosition(row,position,ifVisible)}},{key:"setData",value:function(data,renderInPosition,columnsChanged){var _this186=this;return new Promise((function(resolve,reject){renderInPosition&&_this186.getDisplayRows().length?_this186.table.options.pagination?_this186._setDataActual(data,!0):_this186.reRenderInPosition((function(){_this186._setDataActual(data)})):(_this186.table.options.autoColumns&&columnsChanged&&_this186.table.initialized&&_this186.table.columnManager.generateColumnsFromRowData(data),_this186.resetScroll(),_this186._setDataActual(data)),resolve()}))}},{key:"_setDataActual",value:function(data,renderInPosition){var _this187=this;this.dispatchExternal("dataProcessing",data),this._wipeElements(),Array.isArray(data)?(this.dispatch("data-processing",data),data.forEach((function(def,i){if(def&&"object"===_typeof(def)){var row=new Row(def,_this187);_this187.rows.push(row)}else console.warn("Data Loading Warning - Invalid row data detected and ignored, expecting object but received:",def)})),this.refreshActiveData(!1,!1,renderInPosition),this.dispatch("data-processed",data),this.dispatchExternal("dataProcessed",data)):console.error("Data Loading Error - Unable to process data due to invalid data type \nExpecting: array \nReceived: ",_typeof(data),"\nData:     ",data)}},{key:"_wipeElements",value:function(){this.dispatch("rows-wipe"),this.rows.forEach((function(row){row.wipe()})),this.rows=[],this.activeRows=[],this.activeRowsPipeline=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0,this.adjustTableSize()}},{key:"deleteRow",value:function(row,blockRedraw){var allIndex=this.rows.indexOf(row),activeIndex=this.activeRows.indexOf(row);activeIndex>-1&&this.activeRows.splice(activeIndex,1),allIndex>-1&&this.rows.splice(allIndex,1),this.setActiveRows(this.activeRows),this.displayRowIterator((function(rows){var displayIndex=rows.indexOf(row);displayIndex>-1&&rows.splice(displayIndex,1)})),blockRedraw||this.reRenderInPosition(),this.regenerateRowPositions(),this.dispatchExternal("rowDeleted",row.getComponent()),this.displayRowsCount||this._showPlaceholder(),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.getData())}},{key:"addRow",value:function(data,pos,index,blockRedraw){return this.addRowActual(data,pos,index,blockRedraw)}},{key:"addRows",value:function(data,pos,index){var _this188=this,rows=[];return new Promise((function(resolve,reject){pos=_this188.findAddRowPos(pos),Array.isArray(data)||(data=[data]),(void 0===index&&pos||void 0!==index&&!pos)&&data.reverse(),data.forEach((function(item,i){var row=_this188.addRow(item,pos,index,!0);rows.push(row),_this188.dispatch("row-added",row,data,pos,index)})),_this188.refreshActiveData(!1,!1,!0),_this188.regenerateRowPositions(),rows.length&&_this188._clearPlaceholder(),resolve(rows)}))}},{key:"findAddRowPos",value:function(pos){return void 0===pos&&(pos=this.table.options.addRowPos),"pos"===pos&&(pos=!0),"bottom"===pos&&(pos=!1),pos}},{key:"addRowActual",value:function(data,pos,index,blockRedraw){var activeIndex,chainResult,row=data instanceof Row?data:new Row(data||{},this),top=this.findAddRowPos(pos),allIndex=-1;return index||(chainResult=this.chain("row-adding-position",[row,top],null,{index:index,top:top}),index=chainResult.index,top=chainResult.top),void 0!==index&&(index=this.findRow(index)),(index=this.chain("row-adding-index",[row,index,top],null,index))&&(allIndex=this.rows.indexOf(index)),index&&allIndex>-1?(activeIndex=this.activeRows.indexOf(index),this.displayRowIterator((function(rows){var displayIndex=rows.indexOf(index);displayIndex>-1&&rows.splice(top?displayIndex:displayIndex+1,0,row)})),activeIndex>-1&&this.activeRows.splice(top?activeIndex:activeIndex+1,0,row),this.rows.splice(top?allIndex:allIndex+1,0,row)):top?(this.displayRowIterator((function(rows){rows.unshift(row)})),this.activeRows.unshift(row),this.rows.unshift(row)):(this.displayRowIterator((function(rows){rows.push(row)})),this.activeRows.push(row),this.rows.push(row)),this.setActiveRows(this.activeRows),this.dispatchExternal("rowAdded",row.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),blockRedraw||this.reRenderInPosition(),row}},{key:"moveRow",value:function(from,to,after){this.dispatch("row-move",from,to,after),this.moveRowActual(from,to,after),this.regenerateRowPositions(),this.dispatch("row-moved",from,to,after),this.dispatchExternal("rowMoved",from.getComponent())}},{key:"moveRowActual",value:function(from,to,after){var _this189=this;this.moveRowInArray(this.rows,from,to,after),this.moveRowInArray(this.activeRows,from,to,after),this.displayRowIterator((function(rows){_this189.moveRowInArray(rows,from,to,after)})),this.dispatch("row-moving",from,to,after)}},{key:"moveRowInArray",value:function(rows,from,to,after){var fromIndex,toIndex,end;if(from!==to&&((fromIndex=rows.indexOf(from))>-1&&(rows.splice(fromIndex,1),(toIndex=rows.indexOf(to))>-1?after?rows.splice(toIndex+1,0,from):rows.splice(toIndex,0,from):rows.splice(fromIndex,0,from)),rows===this.getDisplayRows())){end=toIndex>fromIndex?toIndex:fromIndex+1;for(var i=fromIndex<toIndex?fromIndex:toIndex;i<=end;i++)rows[i]&&this.styleRow(rows[i],i)}}},{key:"clearData",value:function(){this.setData([])}},{key:"getRowIndex",value:function(row){return this.findRowIndex(row,this.rows)}},{key:"getDisplayRowIndex",value:function(row){var index=this.getDisplayRows().indexOf(row);return index>-1&&index}},{key:"nextDisplayRow",value:function(row,rowOnly){var index=this.getDisplayRowIndex(row),nextRow=!1;return!1!==index&&index<this.displayRowsCount-1&&(nextRow=this.getDisplayRows()[index+1]),!nextRow||nextRow instanceof Row&&"row"==nextRow.type?nextRow:this.nextDisplayRow(nextRow,rowOnly)}},{key:"prevDisplayRow",value:function(row,rowOnly){var index=this.getDisplayRowIndex(row),prevRow=!1;return index&&(prevRow=this.getDisplayRows()[index-1]),!rowOnly||!prevRow||prevRow instanceof Row&&"row"==prevRow.type?prevRow:this.prevDisplayRow(prevRow,rowOnly)}},{key:"findRowIndex",value:function(row,list){var rowIndex;return!!((row=this.findRow(row))&&(rowIndex=list.indexOf(row))>-1)&&rowIndex}},{key:"getData",value:function(active,transform){var output=[];return this.getRows(active).forEach((function(row){"row"==row.type&&output.push(row.getData(transform||"data"))})),output}},{key:"getComponents",value:function(active){var output=[];return this.getRows(active).forEach((function(row){output.push(row.getComponent())})),output}},{key:"getDataCount",value:function(active){return this.getRows(active).length}},{key:"scrollHorizontal",value:function(left){this.scrollLeft=left,this.element.scrollLeft=left,this.dispatch("scroll-horizontal",left)}},{key:"registerDataPipelineHandler",value:function(handler,priority){void 0!==priority?(this.dataPipeline.push({handler:handler,priority:priority}),this.dataPipeline.sort((function(a,b){return a.priority-b.priority}))):console.error("Data pipeline handlers must have a priority in order to be registered")}},{key:"registerDisplayPipelineHandler",value:function(handler,priority){void 0!==priority?(this.displayPipeline.push({handler:handler,priority:priority}),this.displayPipeline.sort((function(a,b){return a.priority-b.priority}))):console.error("Display pipeline handlers must have a priority in order to be registered")}},{key:"refreshActiveData",value:function(handler,skipStage,renderInPosition){var table=this.table,stage="",index=0,cascadeOrder=["all","dataPipeline","display","displayPipeline","end"];if(!this.table.destroyed){if("function"==typeof handler)if((index=this.dataPipeline.findIndex((function(item){return item.handler===handler})))>-1)stage="dataPipeline",skipStage&&(index==this.dataPipeline.length-1?stage="display":index++);else{if(!((index=this.displayPipeline.findIndex((function(item){return item.handler===handler})))>-1))return void console.error("Unable to refresh data, invalid handler provided",handler);stage="displayPipeline",skipStage&&(index==this.displayPipeline.length-1?stage="end":index++)}else stage=handler||"all",index=0;if(this.redrawBlock)return void((!this.redrawBlockRestoreConfig||this.redrawBlockRestoreConfig&&(this.redrawBlockRestoreConfig.stage===stage&&index<this.redrawBlockRestoreConfig.index||cascadeOrder.indexOf(stage)<cascadeOrder.indexOf(this.redrawBlockRestoreConfig.stage)))&&(this.redrawBlockRestoreConfig={handler:handler,skipStage:skipStage,renderInPosition:renderInPosition,stage:stage,index:index}));Helpers.elVisible(this.element)?renderInPosition?this.reRenderInPosition(this.refreshPipelines.bind(this,handler,stage,index,renderInPosition)):(this.refreshPipelines(handler,stage,index,renderInPosition),handler||this.table.columnManager.renderer.renderColumns(),this.renderTable(),table.options.layoutColumnsOnNewData&&this.table.columnManager.redraw(!0)):this.refreshPipelines(handler,stage,index,renderInPosition),this.dispatch("data-refreshed")}}},{key:"refreshPipelines",value:function(handler,stage,index,renderInPosition){switch(this.dispatch("data-refreshing"),handler||(this.activeRowsPipeline[0]=this.rows.slice(0)),stage){case"all":case"dataPipeline":for(var i=index;i<this.dataPipeline.length;i++){var result=this.dataPipeline[i].handler(this.activeRowsPipeline[i].slice(0));this.activeRowsPipeline[i+1]=result||this.activeRowsPipeline[i].slice(0)}this.setActiveRows(this.activeRowsPipeline[this.dataPipeline.length]);case"display":index=0,this.resetDisplayRows();case"displayPipeline":for(var _i7=index;_i7<this.displayPipeline.length;_i7++){var _result=this.displayPipeline[_i7].handler((_i7?this.getDisplayRows(_i7-1):this.activeRows).slice(0),renderInPosition);this.setDisplayRows(_result||this.getDisplayRows(_i7-1).slice(0),_i7)}case"end":this.regenerateRowPositions()}this.getDisplayRows().length&&this._clearPlaceholder()}},{key:"regenerateRowPositions",value:function(){var rows=this.getDisplayRows(),index=1;rows.forEach((function(row){"row"===row.type&&(row.setPosition(index),index++)}))}},{key:"setActiveRows",value:function(activeRows){this.activeRows=activeRows,this.activeRowsCount=this.activeRows.length}},{key:"resetDisplayRows",value:function(){this.displayRows=[],this.displayRows.push(this.activeRows.slice(0)),this.displayRowsCount=this.displayRows[0].length}},{key:"setDisplayRows",value:function(displayRows,index){this.displayRows[index]=displayRows,index==this.displayRows.length-1&&(this.displayRowsCount=this.displayRows[this.displayRows.length-1].length)}},{key:"getDisplayRows",value:function(index){return void 0===index?this.displayRows.length?this.displayRows[this.displayRows.length-1]:[]:this.displayRows[index]||[]}},{key:"getVisibleRows",value:function(chain,viewable){var rows=Object.assign([],this.renderer.visibleRows(!viewable));return chain&&(rows=this.chain("rows-visible",[viewable],rows,rows)),rows}},{key:"displayRowIterator",value:function(callback){this.activeRowsPipeline.forEach(callback),this.displayRows.forEach(callback),this.displayRowsCount=this.displayRows[this.displayRows.length-1].length}},{key:"getRows",value:function(type){var rows=[];if(type&&!0!==type)switch(type){case"active":rows=this.activeRows;break;case"display":rows=this.table.rowManager.getDisplayRows();break;case"visible":rows=this.getVisibleRows(!1,!0)}else rows=this.chain("rows-retrieve",type,null,this.rows)||this.rows;return rows}},{key:"reRenderInPosition",value:function(callback){this.redrawBlock?callback?callback():this.redrawBlockRenderInPosition=!0:(this.dispatchExternal("renderStarted"),this.renderer.rerenderRows(callback),this.fixedHeight||this.adjustTableSize(),this.scrollBarCheck(),this.dispatchExternal("renderComplete"))}},{key:"scrollBarCheck",value:function(){var scrollbarWidth=0;this.element.scrollHeight>this.element.clientHeight&&(scrollbarWidth=this.element.offsetWidth-this.element.clientWidth),scrollbarWidth!==this.scrollbarWidth&&(this.scrollbarWidth=scrollbarWidth,this.dispatch("scrollbar-vertical",scrollbarWidth))}},{key:"initializeRenderer",value:function(){var renderClass,renderers={virtual:VirtualDomVertical,basic:BasicVertical};(renderClass="string"==typeof this.table.options.renderVertical?renderers[this.table.options.renderVertical]:this.table.options.renderVertical)?(this.renderMode=this.table.options.renderVertical,this.renderer=new renderClass(this.table,this.element,this.tableElement),this.renderer.initialize(),this.table.element.clientHeight||this.table.options.height?this.fixedHeight=!0:this.fixedHeight=!1):console.error("Unable to find matching renderer:",this.table.options.renderVertical)}},{key:"getRenderMode",value:function(){return this.renderMode}},{key:"renderTable",value:function(){this.dispatchExternal("renderStarted"),this.element.scrollTop=0,this._clearTable(),this.displayRowsCount?(this.renderer.renderRows(),this.firstRender&&(this.firstRender=!1,this.layoutRefresh(!0))):this.renderEmptyScroll(),this.fixedHeight||this.adjustTableSize(),this.dispatch("table-layout"),this.displayRowsCount||this._showPlaceholder(),this.scrollBarCheck(),this.dispatchExternal("renderComplete")}},{key:"renderEmptyScroll",value:function(){this.placeholder?this.tableElement.style.display="none":this.tableElement.style.minWidth=this.table.columnManager.getWidth()+"px"}},{key:"_clearTable",value:function(){this._clearPlaceholder(),this.scrollTop=0,this.scrollLeft=0,this.renderer.clearRows()}},{key:"_showPlaceholder",value:function(){this.placeholder&&(this.placeholder.setAttribute("tabulator-render-mode",this.renderMode),this.getElement().appendChild(this.placeholder),this._positionPlaceholder())}},{key:"_clearPlaceholder",value:function(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.tableElement.style.minWidth=""}},{key:"_positionPlaceholder",value:function(){this.placeholder&&this.placeholder.parentNode&&(this.placeholder.style.width=this.table.columnManager.getWidth()+"px",this.placeholderContents.style.width=this.table.rowManager.element.clientWidth+"px",this.placeholderContents.style.marginLeft=this.scrollLeft+"px")}},{key:"styleRow",value:function(row,index){var rowEl=row.getElement();index%2?(rowEl.classList.add("tabulator-row-even"),rowEl.classList.remove("tabulator-row-odd")):(rowEl.classList.add("tabulator-row-odd"),rowEl.classList.remove("tabulator-row-even"))}},{key:"normalizeHeight",value:function(){this.activeRows.forEach((function(row){row.normalizeHeight()}))}},{key:"adjustTableSize",value:function(){var minHeight,initialHeight=this.element.clientHeight;if("fill"===this.renderer.verticalFillMode){var otherHeight=Math.floor(this.table.columnManager.getElement().getBoundingClientRect().height+(this.table.footerManager&&this.table.footerManager.active&&!this.table.footerManager.external?this.table.footerManager.getElement().getBoundingClientRect().height:0));this.fixedHeight?(minHeight=isNaN(this.table.options.minHeight)?this.table.options.minHeight:this.table.options.minHeight+"px",this.element.style.minHeight=minHeight||"calc(100% - "+otherHeight+"px)",this.element.style.height="calc(100% - "+otherHeight+"px)",this.element.style.maxHeight="calc(100% - "+otherHeight+"px)"):(this.element.style.height="",this.element.style.height=this.table.element.clientHeight-otherHeight+"px",this.element.scrollTop=this.scrollTop),this.renderer.resize(),this.fixedHeight||initialHeight==this.element.clientHeight||(this.subscribed("table-resize")?this.dispatch("table-resize"):this.redraw()),this.scrollBarCheck()}this._positionPlaceholder()}},{key:"reinitialize",value:function(){this.rows.forEach((function(row){row.reinitialize(!0)}))}},{key:"blockRedraw",value:function(){this.redrawBlock=!0,this.redrawBlockRestoreConfig=!1}},{key:"restoreRedraw",value:function(){this.redrawBlock=!1,this.redrawBlockRestoreConfig?(this.refreshActiveData(this.redrawBlockRestoreConfig.handler,this.redrawBlockRestoreConfig.skipStage,this.redrawBlockRestoreConfig.renderInPosition),this.redrawBlockRestoreConfig=!1):this.redrawBlockRenderInPosition&&this.reRenderInPosition(),this.redrawBlockRenderInPosition=!1}},{key:"redraw",value:function(force){var left=this.scrollLeft;this.adjustTableSize(),this.table.tableWidth=this.table.element.clientWidth,force?this.renderTable():(this.reRenderInPosition(),this.scrollHorizontal(left))}},{key:"resetScroll",value:function(){if(this.element.scrollLeft=0,this.element.scrollTop=0,"ie"===this.table.browser){var event=document.createEvent("Event");event.initEvent("scroll",!1,!0),this.element.dispatchEvent(event)}else this.element.dispatchEvent(new Event("scroll"))}}]),RowManager}(CoreFeature),FooterManager=function(_CoreFeature9){_inherits(FooterManager,_CoreFeature9);var _super48=_createSuper(FooterManager);function FooterManager(table){var _this190;return _classCallCheck(this,FooterManager),(_this190=_super48.call(this,table)).active=!1,_this190.element=_this190.createElement(),_this190.containerElement=_this190.createContainerElement(),_this190.external=!1,_this190}return _createClass(FooterManager,[{key:"initialize",value:function(){this.initializeElement()}},{key:"createElement",value:function(){var el=document.createElement("div");return el.classList.add("tabulator-footer"),el}},{key:"createContainerElement",value:function(){var el=document.createElement("div");return el.classList.add("tabulator-footer-contents"),this.element.appendChild(el),el}},{key:"initializeElement",value:function(){if(this.table.options.footerElement)if("string"===_typeof(this.table.options.footerElement))"<"===this.table.options.footerElement[0]?this.containerElement.innerHTML=this.table.options.footerElement:(this.external=!0,this.containerElement=document.querySelector(this.table.options.footerElement));else this.element=this.table.options.footerElement}},{key:"getElement",value:function(){return this.element}},{key:"append",value:function(element){this.activate(),this.containerElement.appendChild(element),this.table.rowManager.adjustTableSize()}},{key:"prepend",value:function(element){this.activate(),this.element.insertBefore(element,this.element.firstChild),this.table.rowManager.adjustTableSize()}},{key:"remove",value:function(element){element.parentNode.removeChild(element),this.deactivate()}},{key:"deactivate",value:function(force){this.element.firstChild&&!force||(this.external||this.element.parentNode.removeChild(this.element),this.active=!1)}},{key:"activate",value:function(){this.active||(this.active=!0,this.external||(this.table.element.appendChild(this.getElement()),this.table.element.style.display=""))}},{key:"redraw",value:function(){this.dispatch("footer-redraw")}}]),FooterManager}(CoreFeature),InteractionManager=function(_CoreFeature10){_inherits(InteractionManager,_CoreFeature10);var _super49=_createSuper(InteractionManager);function InteractionManager(table){var _this191;return _classCallCheck(this,InteractionManager),(_this191=_super49.call(this,table)).el=null,_this191.abortClasses=["tabulator-headers","tabulator-table"],_this191.previousTargets={},_this191.listeners=["click","dblclick","contextmenu","mouseenter","mouseleave","mouseover","mouseout","mousemove","mouseup","mousedown","touchstart","touchend"],_this191.componentMap={"tabulator-cell":"cell","tabulator-row":"row","tabulator-group":"group","tabulator-col":"column"},_this191.pseudoTrackers={row:{subscriber:null,target:null},cell:{subscriber:null,target:null},group:{subscriber:null,target:null},column:{subscriber:null,target:null}},_this191.pseudoTracking=!1,_this191}return _createClass(InteractionManager,[{key:"initialize",value:function(){this.el=this.table.element,this.buildListenerMap(),this.bindSubscriptionWatchers()}},{key:"buildListenerMap",value:function(){var listenerMap={};this.listeners.forEach((function(listener){listenerMap[listener]={handler:null,components:[]}})),this.listeners=listenerMap}},{key:"bindPseudoEvents",value:function(){var _this192=this;Object.keys(this.pseudoTrackers).forEach((function(key){_this192.pseudoTrackers[key].subscriber=_this192.pseudoMouseEnter.bind(_this192,key),_this192.subscribe(key+"-mouseover",_this192.pseudoTrackers[key].subscriber)})),this.pseudoTracking=!0}},{key:"pseudoMouseEnter",value:function(key,e,target){this.pseudoTrackers[key].target!==target&&(this.pseudoTrackers[key].target&&this.dispatch(key+"-mouseleave",e,this.pseudoTrackers[key].target),this.pseudoMouseLeave(key,e),this.pseudoTrackers[key].target=target,this.dispatch(key+"-mouseenter",e,target))}},{key:"pseudoMouseLeave",value:function(key,e){var _this193=this,leaveList=Object.keys(this.pseudoTrackers),linkedKeys={row:["cell"],cell:["row"]};(leaveList=leaveList.filter((function(item){var links=linkedKeys[key];return item!==key&&(!links||links&&!links.includes(item))}))).forEach((function(key){var target=_this193.pseudoTrackers[key].target;_this193.pseudoTrackers[key].target&&(_this193.dispatch(key+"-mouseleave",e,target),_this193.pseudoTrackers[key].target=null)}))}},{key:"bindSubscriptionWatchers",value:function(){for(var listeners=Object.keys(this.listeners),_i8=0,_components=Object.values(this.componentMap);_i8<_components.length;_i8++){var _step6,comp=_components[_i8],_iterator6=_createForOfIteratorHelper(listeners);try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var listener=_step6.value,key=comp+"-"+listener;this.subscriptionChange(key,this.subscriptionChanged.bind(this,comp,listener))}}catch(err){_iterator6.e(err)}finally{_iterator6.f()}}this.subscribe("table-destroy",this.clearWatchers.bind(this))}},{key:"subscriptionChanged",value:function(component,key,added){var listener=this.listeners[key].components,index=listener.indexOf(component),changed=!1;added?-1===index&&(listener.push(component),changed=!0):this.subscribed(component+"-"+key)||index>-1&&(listener.splice(index,1),changed=!0),"mouseenter"!==key&&"mouseleave"!==key||this.pseudoTracking||this.bindPseudoEvents(),changed&&this.updateEventListeners()}},{key:"updateEventListeners",value:function(){for(var key in this.listeners){var listener=this.listeners[key];listener.components.length?listener.handler||(listener.handler=this.track.bind(this,key),this.el.addEventListener(key,listener.handler)):listener.handler&&(this.el.removeEventListener(key,listener.handler),listener.handler=null)}}},{key:"track",value:function(type,e){var path=e.composedPath&&e.composedPath()||e.path,targets=this.findTargets(path);targets=this.bindComponents(type,targets),this.triggerEvents(type,e,targets),!this.pseudoTracking||"mouseover"!=type&&"mouseleave"!=type||Object.keys(targets).length||this.pseudoMouseLeave("none",e)}},{key:"findTargets",value:function(path){var _step7,_this194=this,targets={},componentMap=Object.keys(this.componentMap),_iterator7=_createForOfIteratorHelper(path);try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var el=_step7.value,classList=el.classList?_toConsumableArray(el.classList):[];if(classList.filter((function(item){return _this194.abortClasses.includes(item)})).length)break;var _step8,_iterator8=_createForOfIteratorHelper(classList.filter((function(item){return componentMap.includes(item)})));try{for(_iterator8.s();!(_step8=_iterator8.n()).done;){var target=_step8.value;targets[this.componentMap[target]]||(targets[this.componentMap[target]]=el)}}catch(err){_iterator8.e(err)}finally{_iterator8.f()}}}catch(err){_iterator7.e(err)}finally{_iterator7.f()}return targets.group&&targets.group===targets.row&&delete targets.row,targets}},{key:"bindComponents",value:function(type,targets){var _step9,_this195=this,keys=Object.keys(targets).reverse(),listener=this.listeners[type],matches={},targetMatches={},_iterator9=_createForOfIteratorHelper(keys);try{var _loop7=function(){var key=_step9.value,component=void 0,target=targets[key],previousTarget=_this195.previousTargets[key];if(previousTarget&&previousTarget.target===target)component=previousTarget.component;else switch(key){case"row":case"group":if(listener.components.includes("row")||listener.components.includes("cell")||listener.components.includes("group"))component=_this195.table.rowManager.getVisibleRows(!0).find((function(row){return row.getElement()===target})),targets.row&&targets.row.parentNode&&targets.row.parentNode.closest(".tabulator-row")&&(targets[key]=!1);break;case"column":listener.components.includes("column")&&(component=_this195.table.columnManager.findColumn(target));break;case"cell":listener.components.includes("cell")&&(matches.row instanceof Row?component=matches.row.findCell(target):targets.row&&console.warn("Event Target Lookup Error - The row this cell is attached to cannot be found, has the table been reinitialized without being destroyed first?"))}component&&(matches[key]=component,targetMatches[key]={target:target,component:component})};for(_iterator9.s();!(_step9=_iterator9.n()).done;)_loop7()}catch(err){_iterator9.e(err)}finally{_iterator9.f()}return this.previousTargets=targetMatches,matches}},{key:"triggerEvents",value:function(type,e,targets){var listener=this.listeners[type];for(var key in targets)targets[key]&&listener.components.includes(key)&&this.dispatch(key+"-"+type,e,targets[key])}},{key:"clearWatchers",value:function(){for(var key in this.listeners){var listener=this.listeners[key];listener.handler&&(this.el.removeEventListener(key,listener.handler),listener.handler=null)}}}]),InteractionManager}(CoreFeature),ComponentFunctionBinder=function(){function ComponentFunctionBinder(table){_classCallCheck(this,ComponentFunctionBinder),this.table=table,this.bindings={}}return _createClass(ComponentFunctionBinder,[{key:"bind",value:function(type,funcName,handler){this.bindings[type]||(this.bindings[type]={}),this.bindings[type][funcName]?console.warn("Unable to bind component handler, a matching function name is already bound",type,funcName,handler):this.bindings[type][funcName]=handler}},{key:"handle",value:function(type,component,name){if(this.bindings[type]&&this.bindings[type][name]&&"function"==typeof this.bindings[type][name].bind)return this.bindings[type][name].bind(null,component);"then"===name||"string"!=typeof name||name.startsWith("_")||this.table.options.debugInvalidComponentFuncs&&console.error("The "+type+" component does not have a "+name+" function, have you checked that you have the correct Tabulator module installed?")}}]),ComponentFunctionBinder}(),DataLoader=function(_CoreFeature11){_inherits(DataLoader,_CoreFeature11);var _super50=_createSuper(DataLoader);function DataLoader(table){var _this196;return _classCallCheck(this,DataLoader),(_this196=_super50.call(this,table)).requestOrder=0,_this196.loading=!1,_this196}return _createClass(DataLoader,[{key:"initialize",value:function(){}},{key:"load",value:function(data,params,config,replace,silent,columnsChanged){var _this197=this,requestNo=++this.requestOrder;return this.dispatchExternal("dataLoading",data),!data||0!=data.indexOf("{")&&0!=data.indexOf("[")||(data=JSON.parse(data)),this.confirm("data-loading",[data,params,config,silent])?(this.loading=!0,silent||this.alertLoader(),params=this.chain("data-params",[data,config,silent],params||{},params||{}),params=this.mapParams(params,this.table.options.dataSendParams),this.chain("data-load",[data,params,config,silent],!1,Promise.resolve([])).then((function(response){Array.isArray(response)||"object"!=_typeof(response)||(response=_this197.mapParams(response,_this197.objectInvert(_this197.table.options.dataReceiveParams)));var rowData=_this197.chain("data-loaded",response,null,response);requestNo==_this197.requestOrder?(_this197.clearAlert(),!1!==rowData&&(_this197.dispatchExternal("dataLoaded",rowData),_this197.table.rowManager.setData(rowData,replace,void 0===columnsChanged?!replace:columnsChanged))):console.warn("Data Load Response Blocked - An active data load request was blocked by an attempt to change table data while the request was being made")})).catch((function(error){console.error("Data Load Error: ",error),_this197.dispatchExternal("dataLoadError",error),silent||_this197.alertError(),setTimeout((function(){_this197.clearAlert()}),_this197.table.options.dataLoaderErrorTimeout)})).finally((function(){_this197.loading=!1}))):(this.dispatchExternal("dataLoaded",data),data||(data=[]),this.table.rowManager.setData(data,replace,void 0===columnsChanged?!replace:columnsChanged),Promise.resolve())}},{key:"mapParams",value:function(params,map){var output={};for(var key in params)output[map.hasOwnProperty(key)?map[key]:key]=params[key];return output}},{key:"objectInvert",value:function(obj){var output={};for(var key in obj)output[obj[key]]=key;return output}},{key:"blockActiveLoad",value:function(){this.requestOrder++}},{key:"alertLoader",value:function(){("function"==typeof this.table.options.dataLoader?this.table.options.dataLoader():this.table.options.dataLoader)&&this.table.alertManager.alert(this.table.options.dataLoaderLoading||this.langText("data|loading"))}},{key:"alertError",value:function(){this.table.alertManager.alert(this.table.options.dataLoaderError||this.langText("data|error"),"error")}},{key:"clearAlert",value:function(){this.table.alertManager.clear()}}]),DataLoader}(CoreFeature),ExternalEventBus=function(){function ExternalEventBus(table,optionsList,debug){_classCallCheck(this,ExternalEventBus),this.table=table,this.events={},this.optionsList=optionsList||{},this.subscriptionNotifiers={},this.dispatch=debug?this._debugDispatch.bind(this):this._dispatch.bind(this),this.debug=debug}return _createClass(ExternalEventBus,[{key:"subscriptionChange",value:function(key,callback){this.subscriptionNotifiers[key]||(this.subscriptionNotifiers[key]=[]),this.subscriptionNotifiers[key].push(callback),this.subscribed(key)&&this._notifySubscriptionChange(key,!0)}},{key:"subscribe",value:function(key,callback){this.events[key]||(this.events[key]=[]),this.events[key].push(callback),this._notifySubscriptionChange(key,!0)}},{key:"unsubscribe",value:function(key,callback){var index;if(this.events[key]){if(callback){if(!((index=this.events[key].findIndex((function(item){return item===callback})))>-1))return void console.warn("Cannot remove event, no matching event found:",key,callback);this.events[key].splice(index,1)}else delete this.events[key];this._notifySubscriptionChange(key,!1)}else console.warn("Cannot remove event, no events set on:",key)}},{key:"subscribed",value:function(key){return this.events[key]&&this.events[key].length}},{key:"_notifySubscriptionChange",value:function(key,subscribed){var notifiers=this.subscriptionNotifiers[key];notifiers&&notifiers.forEach((function(callback){callback(subscribed)}))}},{key:"_dispatch",value:function(){var result,_this198=this,args=Array.from(arguments),key=args.shift();return this.events[key]&&this.events[key].forEach((function(callback,i){var callResult=callback.apply(_this198.table,args);i||(result=callResult)})),result}},{key:"_debugDispatch",value:function(){var _console,args=Array.from(arguments),key=args[0];(args[0]="ExternalEvent:"+args[0],!0===this.debug||this.debug.includes(key))&&(_console=console).log.apply(_console,_toConsumableArray(args));return this._dispatch.apply(this,arguments)}}]),ExternalEventBus}(),InternalEventBus=function(){function InternalEventBus(debug){_classCallCheck(this,InternalEventBus),this.events={},this.subscriptionNotifiers={},this.dispatch=debug?this._debugDispatch.bind(this):this._dispatch.bind(this),this.chain=debug?this._debugChain.bind(this):this._chain.bind(this),this.confirm=debug?this._debugConfirm.bind(this):this._confirm.bind(this),this.debug=debug}return _createClass(InternalEventBus,[{key:"subscriptionChange",value:function(key,callback){this.subscriptionNotifiers[key]||(this.subscriptionNotifiers[key]=[]),this.subscriptionNotifiers[key].push(callback),this.subscribed(key)&&this._notifySubscriptionChange(key,!0)}},{key:"subscribe",value:function(key,callback){var priority=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e4;this.events[key]||(this.events[key]=[]),this.events[key].push({callback:callback,priority:priority}),this.events[key].sort((function(a,b){return a.priority-b.priority})),this._notifySubscriptionChange(key,!0)}},{key:"unsubscribe",value:function(key,callback){var index;if(this.events[key]){if(callback){if(!((index=this.events[key].findIndex((function(item){return item.callback===callback})))>-1))return void console.warn("Cannot remove event, no matching event found:",key,callback);this.events[key].splice(index,1)}this._notifySubscriptionChange(key,!1)}else console.warn("Cannot remove event, no events set on:",key)}},{key:"subscribed",value:function(key){return this.events[key]&&this.events[key].length}},{key:"_chain",value:function(key,args,initialValue,fallback){var _this199=this,value=initialValue;return Array.isArray(args)||(args=[args]),this.subscribed(key)?(this.events[key].forEach((function(subscriber,i){value=subscriber.callback.apply(_this199,args.concat([value]))})),value):"function"==typeof fallback?fallback():fallback}},{key:"_confirm",value:function(key,args){var _this200=this,confirmed=!1;return Array.isArray(args)||(args=[args]),this.subscribed(key)&&this.events[key].forEach((function(subscriber,i){subscriber.callback.apply(_this200,args)&&(confirmed=!0)})),confirmed}},{key:"_notifySubscriptionChange",value:function(key,subscribed){var notifiers=this.subscriptionNotifiers[key];notifiers&&notifiers.forEach((function(callback){callback(subscribed)}))}},{key:"_dispatch",value:function(){var _this201=this,args=Array.from(arguments),key=args.shift();this.events[key]&&this.events[key].forEach((function(subscriber){subscriber.callback.apply(_this201,args)}))}},{key:"_debugDispatch",value:function(){var _console2,args=Array.from(arguments),key=args[0];(args[0]="InternalEvent:"+key,!0===this.debug||this.debug.includes(key))&&(_console2=console).log.apply(_console2,_toConsumableArray(args));return this._dispatch.apply(this,arguments)}},{key:"_debugChain",value:function(){var _console3,args=Array.from(arguments),key=args[0];(args[0]="InternalEvent:"+key,!0===this.debug||this.debug.includes(key))&&(_console3=console).log.apply(_console3,_toConsumableArray(args));return this._chain.apply(this,arguments)}},{key:"_debugConfirm",value:function(){var _console4,args=Array.from(arguments),key=args[0];(args[0]="InternalEvent:"+key,!0===this.debug||this.debug.includes(key))&&(_console4=console).log.apply(_console4,_toConsumableArray(args));return this._confirm.apply(this,arguments)}}]),InternalEventBus}(),DeprecationAdvisor=function(_CoreFeature12){_inherits(DeprecationAdvisor,_CoreFeature12);var _super51=_createSuper(DeprecationAdvisor);function DeprecationAdvisor(table){return _classCallCheck(this,DeprecationAdvisor),_super51.call(this,table)}return _createClass(DeprecationAdvisor,[{key:"_warnUser",value:function(){var _console5;this.options("debugDeprecation")&&(_console5=console).warn.apply(_console5,arguments)}},{key:"check",value:function(oldOption,newOption){var msg="";return void 0===this.options(oldOption)||(msg="Deprecated Setup Option - Use of the %c"+oldOption+"%c option is now deprecated",newOption?(msg=msg+", Please use the %c"+newOption+"%c option instead",this._warnUser(msg,"font-weight: bold;","font-weight: normal;","font-weight: bold;","font-weight: normal;")):this._warnUser(msg,"font-weight: bold;","font-weight: normal;"),!1)}},{key:"checkMsg",value:function(oldOption,msg){return void 0===this.options(oldOption)||(this._warnUser("%cDeprecated Setup Option - Use of the %c"+oldOption+" %c option is now deprecated, "+msg,"font-weight: normal;","font-weight: bold;","font-weight: normal;"),!1)}},{key:"msg",value:function(_msg){this._warnUser(_msg)}}]),DeprecationAdvisor}(CoreFeature),TableRegistry=function(){function TableRegistry(){_classCallCheck(this,TableRegistry)}return _createClass(TableRegistry,null,[{key:"register",value:function(table){TableRegistry.tables.push(table)}},{key:"deregister",value:function(table){var index=TableRegistry.tables.indexOf(table);index>-1&&TableRegistry.tables.splice(index,1)}},{key:"lookupTable",value:function(query,silent){var matches,match,results=[];if("string"==typeof query){if((matches=document.querySelectorAll(query)).length)for(var i=0;i<matches.length;i++)(match=TableRegistry.matchElement(matches[i]))&&results.push(match)}else"undefined"!=typeof HTMLElement&&query instanceof HTMLElement||query instanceof Tabulator?(match=TableRegistry.matchElement(query))&&results.push(match):Array.isArray(query)?query.forEach((function(item){results=results.concat(TableRegistry.lookupTable(item))})):silent||console.warn("Table Connection Error - Invalid Selector",query);return results}},{key:"matchElement",value:function(element){return TableRegistry.tables.find((function(table){return element instanceof Tabulator?table===element:table.element===element}))}}]),TableRegistry}();function fitDataGeneral(columns,forced){columns.forEach((function(column){column.reinitializeWidth()})),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}TableRegistry.tables=[];var defaultModes={fitData:function(columns,forced){forced&&this.table.columnManager.renderer.reinitializeColumnWidths(columns),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()},fitDataFill:fitDataGeneral,fitDataTable:fitDataGeneral,fitDataStretch:function(columns,forced){var _this202=this,colsWidth=0,tableWidth=this.table.rowManager.element.clientWidth,gap=0,lastCol=!1;columns.forEach((function(column,i){column.widthFixed||column.reinitializeWidth(),(_this202.table.options.responsiveLayout?column.modules.responsive.visible:column.visible)&&(lastCol=column),column.visible&&(colsWidth+=column.getWidth())})),lastCol?(gap=tableWidth-colsWidth+lastCol.getWidth(),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&(lastCol.setWidth(0),this.table.modules.responsiveLayout.update()),gap>0?lastCol.setWidth(gap):lastCol.reinitializeWidth()):this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()},fitColumns:function(columns,forced){var flexColWidth,overflowWidth,totalWidth=this.table.rowManager.element.getBoundingClientRect().width,fixedWidth=0,flexWidth=0,flexGrowUnits=0,flexColumns=[],fixedShrinkColumns=[],flexShrinkUnits=0,gapFill=0;function calcWidth(width){return"string"==typeof width?width.indexOf("%")>-1?totalWidth/100*parseInt(width):parseInt(width):width}function scaleColumns(columns,freeSpace,colWidth,shrinkCols){var oversizeCols=[],oversizeSpace=0,remainingSpace=0,nextColWidth=0,remainingFlexGrowUnits=flexGrowUnits,gap=0,changeUnits=0,undersizeCols=[];function calcGrow(col){return colWidth*(col.column.definition.widthGrow||1)}function calcShrink(col){return calcWidth(col.width)-colWidth*(col.column.definition.widthShrink||0)}return columns.forEach((function(col,i){var width=shrinkCols?calcShrink(col):calcGrow(col);col.column.minWidth>=width?oversizeCols.push(col):col.column.maxWidth&&col.column.maxWidth<width?(col.width=col.column.maxWidth,freeSpace-=col.column.maxWidth,(remainingFlexGrowUnits-=shrinkCols?col.column.definition.widthShrink||1:col.column.definition.widthGrow||1)&&(colWidth=Math.floor(freeSpace/remainingFlexGrowUnits))):(undersizeCols.push(col),changeUnits+=shrinkCols?col.column.definition.widthShrink||1:col.column.definition.widthGrow||1)})),oversizeCols.length?(oversizeCols.forEach((function(col){oversizeSpace+=shrinkCols?col.width-col.column.minWidth:col.column.minWidth,col.width=col.column.minWidth})),remainingSpace=freeSpace-oversizeSpace,nextColWidth=changeUnits?Math.floor(remainingSpace/changeUnits):remainingSpace,gap=scaleColumns(undersizeCols,remainingSpace,nextColWidth,shrinkCols)):(gap=changeUnits?freeSpace-Math.floor(freeSpace/changeUnits)*changeUnits:freeSpace,undersizeCols.forEach((function(column){column.width=shrinkCols?calcShrink(column):calcGrow(column)}))),gap}this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update(),this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(totalWidth-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),columns.forEach((function(column){var width,minWidth,colWidth;column.visible&&(width=column.definition.width,minWidth=parseInt(column.minWidth),width?(colWidth=calcWidth(width),fixedWidth+=colWidth>minWidth?colWidth:minWidth,column.definition.widthShrink&&(fixedShrinkColumns.push({column:column,width:colWidth>minWidth?colWidth:minWidth}),flexShrinkUnits+=column.definition.widthShrink)):(flexColumns.push({column:column,width:0}),flexGrowUnits+=column.definition.widthGrow||1))})),flexWidth=totalWidth-fixedWidth,flexColWidth=Math.floor(flexWidth/flexGrowUnits),gapFill=scaleColumns(flexColumns,flexWidth,flexColWidth,!1),flexColumns.length&&gapFill>0&&(flexColumns[flexColumns.length-1].width+=gapFill),flexColumns.forEach((function(col){flexWidth-=col.width})),(overflowWidth=Math.abs(gapFill)+flexWidth)>0&&flexShrinkUnits&&(gapFill=scaleColumns(fixedShrinkColumns,overflowWidth,Math.floor(overflowWidth/flexShrinkUnits),!0)),gapFill&&fixedShrinkColumns.length&&(fixedShrinkColumns[fixedShrinkColumns.length-1].width-=gapFill),flexColumns.forEach((function(col){col.column.setWidth(col.width)})),fixedShrinkColumns.forEach((function(col){col.column.setWidth(col.width)}))}},Layout=function(_Module36){_inherits(Layout,_Module36);var _super52=_createSuper(Layout);function Layout(table){var _this203;return _classCallCheck(this,Layout),(_this203=_super52.call(this,table,"layout")).mode=null,_this203.registerTableOption("layout","fitData"),_this203.registerTableOption("layoutColumnsOnNewData",!1),_this203.registerColumnOption("widthGrow"),_this203.registerColumnOption("widthShrink"),_this203}return _createClass(Layout,[{key:"initialize",value:function(){var layout=this.table.options.layout;Layout.modes[layout]?this.mode=layout:(console.warn("Layout Error - invalid mode set, defaulting to 'fitData' : "+layout),this.mode="fitData"),this.table.element.setAttribute("tabulator-layout",this.mode)}},{key:"getMode",value:function(){return this.mode}},{key:"layout",value:function(dataChanged){this.dispatch("layout-refreshing"),Layout.modes[this.mode].call(this,this.table.columnManager.columnsByIndex,dataChanged),this.dispatch("layout-refreshed")}}]),Layout}(Module);Layout.moduleName="layout",Layout.modes=defaultModes;var Localize=function(_Module37){_inherits(Localize,_Module37);var _super53=_createSuper(Localize);function Localize(table){var _this204;return _classCallCheck(this,Localize),(_this204=_super53.call(this,table)).locale="default",_this204.lang=!1,_this204.bindings={},_this204.langList={},_this204.registerTableOption("locale",!1),_this204.registerTableOption("langs",{}),_this204}return _createClass(Localize,[{key:"initialize",value:function(){for(var locale in this.langList=Helpers.deepClone(Localize.langs),!1!==this.table.options.columnDefaults.headerFilterPlaceholder&&this.setHeaderFilterPlaceholder(this.table.options.columnDefaults.headerFilterPlaceholder),this.table.options.langs)this.installLang(locale,this.table.options.langs[locale]);this.setLocale(this.table.options.locale),this.registerTableFunction("setLocale",this.setLocale.bind(this)),this.registerTableFunction("getLocale",this.getLocale.bind(this)),this.registerTableFunction("getLang",this.getLang.bind(this))}},{key:"setHeaderFilterPlaceholder",value:function(placeholder){this.langList.default.headerFilters.default=placeholder}},{key:"setHeaderFilterColumnPlaceholder",value:function(column,placeholder){this.langList.default.headerFilters.columns[column]=placeholder,this.lang&&!this.lang.headerFilters.columns[column]&&(this.lang.headerFilters.columns[column]=placeholder)}},{key:"installLang",value:function(locale,lang){this.langList[locale]?this._setLangProp(this.langList[locale],lang):this.langList[locale]=lang}},{key:"_setLangProp",value:function(lang,values){for(var key in values)lang[key]&&"object"==_typeof(lang[key])?this._setLangProp(lang[key],values[key]):lang[key]=values[key]}},{key:"setLocale",value:function(desiredLocale){if(!0===(desiredLocale=desiredLocale||"default")&&navigator.language&&(desiredLocale=navigator.language.toLowerCase()),desiredLocale&&!this.langList[desiredLocale]){var prefix=desiredLocale.split("-")[0];this.langList[prefix]?(console.warn("Localization Error - Exact matching locale not found, using closest match: ",desiredLocale,prefix),desiredLocale=prefix):(console.warn("Localization Error - Matching locale not found, using default: ",desiredLocale),desiredLocale="default")}this.locale=desiredLocale,this.lang=Helpers.deepClone(this.langList.default||{}),"default"!=desiredLocale&&function traverseLang(trans,path){for(var prop in trans)"object"==_typeof(trans[prop])?(path[prop]||(path[prop]={}),traverseLang(trans[prop],path[prop])):path[prop]=trans[prop]}(this.langList[desiredLocale],this.lang),this.dispatchExternal("localized",this.locale,this.lang),this._executeBindings()}},{key:"getLocale",value:function(locale){return this.locale}},{key:"getLang",value:function(locale){return locale?this.langList[locale]:this.lang}},{key:"getText",value:function(path,value){var pathArray=(value?path+"|"+value:path).split("|");return this._getLangElement(pathArray,this.locale)||""}},{key:"_getLangElement",value:function(path,locale){var root=this.lang;return path.forEach((function(level){var rootPath;root&&(rootPath=root[level],root=void 0!==rootPath&&rootPath)})),root}},{key:"bind",value:function(path,callback){this.bindings[path]||(this.bindings[path]=[]),this.bindings[path].push(callback),callback(this.getText(path),this.lang)}},{key:"_executeBindings",value:function(){var _this205=this,_loop8=function(path){_this205.bindings[path].forEach((function(binding){binding(_this205.getText(path),_this205.lang)}))};for(var path in this.bindings)_loop8(path)}}]),Localize}(Module);Localize.moduleName="localize",Localize.langs={default:{groups:{item:"item",items:"items"},columns:{},data:{loading:"Loading",error:"Error"},pagination:{page_size:"Page Size",page_title:"Show Page",first:"First",first_title:"First Page",last:"Last",last_title:"Last Page",prev:"Prev",prev_title:"Prev Page",next:"Next",next_title:"Next Page",all:"All",counter:{showing:"Showing",of:"of",rows:"rows",pages:"pages"}},headerFilters:{default:"filter column...",columns:{}}}};var Comms=function(_Module38){_inherits(Comms,_Module38);var _super54=_createSuper(Comms);function Comms(table){return _classCallCheck(this,Comms),_super54.call(this,table)}return _createClass(Comms,[{key:"initialize",value:function(){this.registerTableFunction("tableComms",this.receive.bind(this))}},{key:"getConnections",value:function(selectors){var _this206=this,connections=[];return TableRegistry.lookupTable(selectors).forEach((function(con){_this206.table!==con&&connections.push(con)})),connections}},{key:"send",value:function(selectors,module,action,data){var _this207=this,connections=this.getConnections(selectors);connections.forEach((function(connection){connection.tableComms(_this207.table.element,module,action,data)})),!connections.length&&selectors&&console.warn("Table Connection Error - No tables matching selector found",selectors)}},{key:"receive",value:function(table,module,action,data){if(this.table.modExists(module))return this.table.modules[module].commsReceived(table,action,data);console.warn("Inter-table Comms Error - no such module:",module)}}]),Comms}(Module);Comms.moduleName="comms";var coreModules=Object.freeze({__proto__:null,LayoutModule:Layout,LocalizeModule:Localize,CommsModule:Comms}),ModuleBinder=function(){function ModuleBinder(tabulator,modules){_classCallCheck(this,ModuleBinder),this.bindStaticFunctionality(tabulator),this.bindModules(tabulator,coreModules,!0),modules&&this.bindModules(tabulator,modules)}return _createClass(ModuleBinder,[{key:"bindStaticFunctionality",value:function(tabulator){tabulator.moduleBindings={},tabulator.extendModule=function(name,property,values){if(tabulator.moduleBindings[name]){var source=tabulator.moduleBindings[name][property];if(source)if("object"==_typeof(values))for(var key in values)source[key]=values[key];else console.warn("Module Error - Invalid value type, it must be an object");else console.warn("Module Error - property does not exist:",property)}else console.warn("Module Error - module does not exist:",name)},tabulator.registerModule=function(modules){Array.isArray(modules)||(modules=[modules]),modules.forEach((function(mod){tabulator.registerModuleBinding(mod)}))},tabulator.registerModuleBinding=function(mod){tabulator.moduleBindings[mod.moduleName]=mod},tabulator.findTable=function(query){var results=TableRegistry.lookupTable(query,!0);return!(Array.isArray(results)&&!results.length)&&results},tabulator.prototype.bindModules=function(){var orderedStartMods=[],orderedEndMods=[],unOrderedMods=[];for(var name in this.modules={},tabulator.moduleBindings){var mod=tabulator.moduleBindings[name],module=new mod(this);this.modules[name]=module,mod.prototype.moduleCore?this.modulesCore.push(module):mod.moduleInitOrder?mod.moduleInitOrder<0?orderedStartMods.push(module):orderedEndMods.push(module):unOrderedMods.push(module)}orderedStartMods.sort((function(a,b){return a.moduleInitOrder>b.moduleInitOrder?1:-1})),orderedEndMods.sort((function(a,b){return a.moduleInitOrder>b.moduleInitOrder?1:-1})),this.modulesRegular=orderedStartMods.concat(unOrderedMods.concat(orderedEndMods))}}},{key:"bindModules",value:function(tabulator,modules,core){var mods=Object.values(modules);core&&mods.forEach((function(mod){mod.prototype.moduleCore=!0})),tabulator.registerModule(mods)}}]),ModuleBinder}(),Alert=function(_CoreFeature13){_inherits(Alert,_CoreFeature13);var _super55=_createSuper(Alert);function Alert(table){var _this208;return _classCallCheck(this,Alert),(_this208=_super55.call(this,table)).element=_this208._createAlertElement(),_this208.msgElement=_this208._createMsgElement(),_this208.type=null,_this208.element.appendChild(_this208.msgElement),_this208}return _createClass(Alert,[{key:"_createAlertElement",value:function(){var el=document.createElement("div");return el.classList.add("tabulator-alert"),el}},{key:"_createMsgElement",value:function(){var el=document.createElement("div");return el.classList.add("tabulator-alert-msg"),el.setAttribute("role","alert"),el}},{key:"_typeClass",value:function(){return"tabulator-alert-state-"+this.type}},{key:"alert",value:function(content){var type=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"msg";if(content){for(this.clear(),this.type=type;this.msgElement.firstChild;)this.msgElement.removeChild(this.msgElement.firstChild);this.msgElement.classList.add(this._typeClass()),"function"==typeof content&&(content=content()),content instanceof HTMLElement?this.msgElement.appendChild(content):this.msgElement.innerHTML=content,this.table.element.appendChild(this.element)}}},{key:"clear",value:function(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.msgElement.classList.remove(this._typeClass())}}]),Alert}(CoreFeature),Tabulator=function(){function Tabulator(element,options){var _this209=this;_classCallCheck(this,Tabulator),this.options={},this.columnManager=null,this.rowManager=null,this.footerManager=null,this.alertManager=null,this.vdomHoz=null,this.externalEvents=null,this.eventBus=null,this.interactionMonitor=!1,this.browser="",this.browserSlow=!1,this.browserMobile=!1,this.rtl=!1,this.originalElement=null,this.componentFunctionBinder=new ComponentFunctionBinder(this),this.dataLoader=!1,this.modules={},this.modulesCore=[],this.modulesRegular=[],this.deprecationAdvisor=new DeprecationAdvisor(this),this.optionsList=new OptionsList(this,"table constructor"),this.initialized=!1,this.destroyed=!1,this.initializeElement(element)&&(this.initializeCoreSystems(options),setTimeout((function(){_this209._create()}))),TableRegistry.register(this)}return _createClass(Tabulator,[{key:"initializeElement",value:function(element){return"undefined"!=typeof HTMLElement&&element instanceof HTMLElement?(this.element=element,!0):"string"==typeof element?(this.element=document.querySelector(element),!!this.element||(console.error("Tabulator Creation Error - no element found matching selector: ",element),!1)):(console.error("Tabulator Creation Error - Invalid element provided:",element),!1)}},{key:"initializeCoreSystems",value:function(options){this.columnManager=new ColumnManager(this),this.rowManager=new RowManager(this),this.footerManager=new FooterManager(this),this.dataLoader=new DataLoader(this),this.alertManager=new Alert(this),this.bindModules(),this.options=this.optionsList.generate(Tabulator.defaultOptions,options),this._clearObjectPointers(),this._mapDeprecatedFunctionality(),this.externalEvents=new ExternalEventBus(this,this.options,this.options.debugEventsExternal),this.eventBus=new InternalEventBus(this.options.debugEventsInternal),this.interactionMonitor=new InteractionManager(this),this.dataLoader.initialize(),this.footerManager.initialize()}},{key:"_mapDeprecatedFunctionality",value:function(){}},{key:"_clearSelection",value:function(){this.element.classList.add("tabulator-block-select"),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),this.element.classList.remove("tabulator-block-select")}},{key:"_create",value:function(){this.externalEvents.dispatch("tableBuilding"),this.eventBus.dispatch("table-building"),this._rtlCheck(),this._buildElement(),this._initializeTable(),this._loadInitialData(),this.initialized=!0,this.externalEvents.dispatch("tableBuilt")}},{key:"_rtlCheck",value:function(){var style=window.getComputedStyle(this.element);switch(this.options.textDirection){case"auto":if("rtl"!==style.direction)break;case"rtl":this.element.classList.add("tabulator-rtl"),this.rtl=!0;break;case"ltr":this.element.classList.add("tabulator-ltr");default:this.rtl=!1}}},{key:"_clearObjectPointers",value:function(){this.options.columns=this.options.columns.slice(0),Array.isArray(this.options.data)&&!this.options.reactiveData&&(this.options.data=this.options.data.slice(0))}},{key:"_buildElement",value:function(){var newElement,element=this.element,options=this.options;if("TABLE"===element.tagName){this.originalElement=this.element,newElement=document.createElement("div");var attributes=element.attributes;for(var i in attributes)"object"==_typeof(attributes[i])&&newElement.setAttribute(attributes[i].name,attributes[i].value);element.parentNode.replaceChild(newElement,element),this.element=element=newElement}for(element.classList.add("tabulator"),element.setAttribute("role","grid");element.firstChild;)element.removeChild(element.firstChild);options.height&&(options.height=isNaN(options.height)?options.height:options.height+"px",element.style.height=options.height),!1!==options.minHeight&&(options.minHeight=isNaN(options.minHeight)?options.minHeight:options.minHeight+"px",element.style.minHeight=options.minHeight),!1!==options.maxHeight&&(options.maxHeight=isNaN(options.maxHeight)?options.maxHeight:options.maxHeight+"px",element.style.maxHeight=options.maxHeight)}},{key:"_initializeTable",value:function(){var element=this.element,options=this.options;this.interactionMonitor.initialize(),this.columnManager.initialize(),this.rowManager.initialize(),this._detectBrowser(),this.modulesCore.forEach((function(mod){mod.initialize()})),element.appendChild(this.columnManager.getElement()),element.appendChild(this.rowManager.getElement()),options.footerElement&&this.footerManager.activate(),options.autoColumns&&options.data&&this.columnManager.generateColumnsFromRowData(this.options.data),this.modulesRegular.forEach((function(mod){mod.initialize()})),this.columnManager.setColumns(options.columns),this.eventBus.dispatch("table-built")}},{key:"_loadInitialData",value:function(){this.dataLoader.load(this.options.data)}},{key:"destroy",value:function(){var element=this.element;for(this.destroyed=!0,TableRegistry.deregister(this),this.eventBus.dispatch("table-destroy"),this.rowManager.rows.forEach((function(row){row.wipe()})),this.rowManager.rows=[],this.rowManager.activeRows=[],this.rowManager.displayRows=[];element.firstChild;)element.removeChild(element.firstChild);element.classList.remove("tabulator"),this.externalEvents.dispatch("tableDestroyed")}},{key:"_detectBrowser",value:function(){var ua=navigator.userAgent||navigator.vendor||window.opera;ua.indexOf("Trident")>-1?(this.browser="ie",this.browserSlow=!0):ua.indexOf("Edge")>-1?(this.browser="edge",this.browserSlow=!0):ua.indexOf("Firefox")>-1?(this.browser="firefox",this.browserSlow=!1):(this.browser="other",this.browserSlow=!1),this.browserMobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(ua)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(ua.slice(0,4))}},{key:"initGuard",value:function(func,msg){var stack,line;return this.options.debugInitialization&&!this.initialized&&(func||(func=" "==(line="Error"==(stack=(new Error).stack.split("\n"))[0]?stack[2]:stack[1])[0]?line.trim().split(" ")[1].split(".")[1]:line.trim().split("@")[0]),console.warn("Table Not Initialized - Calling the "+func+" function before the table is initialized may result in inconsistent behavior, Please wait for the `tableBuilt` event before calling this function."+(msg?" "+msg:""))),this.initialized}},{key:"blockRedraw",value:function(){this.initGuard(),this.eventBus.dispatch("redraw-blocking"),this.rowManager.blockRedraw(),this.columnManager.blockRedraw(),this.eventBus.dispatch("redraw-blocked")}},{key:"restoreRedraw",value:function(){this.initGuard(),this.eventBus.dispatch("redraw-restoring"),this.rowManager.restoreRedraw(),this.columnManager.restoreRedraw(),this.eventBus.dispatch("redraw-restored")}},{key:"setData",value:function(data,params,config){return this.initGuard(!1,"To set initial data please use the 'data' property in the table constructor."),this.dataLoader.load(data,params,config,!1)}},{key:"clearData",value:function(){this.initGuard(),this.dataLoader.blockActiveLoad(),this.rowManager.clearData()}},{key:"getData",value:function(active){return this.rowManager.getData(active)}},{key:"getDataCount",value:function(active){return this.rowManager.getDataCount(active)}},{key:"replaceData",value:function(data,params,config){return this.initGuard(),this.dataLoader.load(data,params,config,!0,!0)}},{key:"updateData",value:function(data){var _this210=this,responses=0;return this.initGuard(),new Promise((function(resolve,reject){_this210.dataLoader.blockActiveLoad(),"string"==typeof data&&(data=JSON.parse(data)),data&&data.length>0?data.forEach((function(item){var row=_this210.rowManager.findRow(item[_this210.options.index]);row&&(responses++,row.updateData(item).then((function(){--responses||resolve()})))})):(console.warn("Update Error - No data provided"),reject("Update Error - No data provided"))}))}},{key:"addData",value:function(data,pos,index){var _this211=this;return this.initGuard(),new Promise((function(resolve,reject){_this211.dataLoader.blockActiveLoad(),"string"==typeof data&&(data=JSON.parse(data)),data?_this211.rowManager.addRows(data,pos,index).then((function(rows){var output=[];rows.forEach((function(row){output.push(row.getComponent())})),resolve(output)})):(console.warn("Update Error - No data provided"),reject("Update Error - No data provided"))}))}},{key:"updateOrAddData",value:function(data){var _this212=this,rows=[],responses=0;return this.initGuard(),new Promise((function(resolve,reject){_this212.dataLoader.blockActiveLoad(),"string"==typeof data&&(data=JSON.parse(data)),data&&data.length>0?data.forEach((function(item){var row=_this212.rowManager.findRow(item[_this212.options.index]);responses++,row?row.updateData(item).then((function(){responses--,rows.push(row.getComponent()),responses||resolve(rows)})):_this212.rowManager.addRows(item).then((function(newRows){responses--,rows.push(newRows[0].getComponent()),responses||resolve(rows)}))})):(console.warn("Update Error - No data provided"),reject("Update Error - No data provided"))}))}},{key:"getRow",value:function(index){var row=this.rowManager.findRow(index);return row?row.getComponent():(console.warn("Find Error - No matching row found:",index),!1)}},{key:"getRowFromPosition",value:function(position){var row=this.rowManager.getRowFromPosition(position);return row?row.getComponent():(console.warn("Find Error - No matching row found:",position),!1)}},{key:"deleteRow",value:function(index){var _this213=this,foundRows=[];this.initGuard(),Array.isArray(index)||(index=[index]);var _step10,_iterator10=_createForOfIteratorHelper(index);try{for(_iterator10.s();!(_step10=_iterator10.n()).done;){var item=_step10.value,row=this.rowManager.findRow(item,!0);if(!row)return console.error("Delete Error - No matching row found:",item),Promise.reject("Delete Error - No matching row found");foundRows.push(row)}}catch(err){_iterator10.e(err)}finally{_iterator10.f()}return foundRows.sort((function(a,b){return _this213.rowManager.rows.indexOf(a)>_this213.rowManager.rows.indexOf(b)?1:-1})),foundRows.forEach((function(row){row.delete()})),this.rowManager.reRenderInPosition(),Promise.resolve()}},{key:"addRow",value:function(data,pos,index){return this.initGuard(),"string"==typeof data&&(data=JSON.parse(data)),this.rowManager.addRows(data,pos,index).then((function(rows){return rows[0].getComponent()}))}},{key:"updateOrAddRow",value:function(index,data){var row=this.rowManager.findRow(index);return this.initGuard(),"string"==typeof data&&(data=JSON.parse(data)),row?row.updateData(data).then((function(){return row.getComponent()})):this.rowManager.addRows(data).then((function(rows){return rows[0].getComponent()}))}},{key:"updateRow",value:function(index,data){var row=this.rowManager.findRow(index);return this.initGuard(),"string"==typeof data&&(data=JSON.parse(data)),row?row.updateData(data).then((function(){return Promise.resolve(row.getComponent())})):(console.warn("Update Error - No matching row found:",index),Promise.reject("Update Error - No matching row found"))}},{key:"scrollToRow",value:function(index,position,ifVisible){var row=this.rowManager.findRow(index);return row?this.rowManager.scrollToRow(row,position,ifVisible):(console.warn("Scroll Error - No matching row found:",index),Promise.reject("Scroll Error - No matching row found"))}},{key:"moveRow",value:function(from,to,after){var fromRow=this.rowManager.findRow(from);this.initGuard(),fromRow?fromRow.moveToRow(to,after):console.warn("Move Error - No matching row found:",from)}},{key:"getRows",value:function(active){return this.rowManager.getComponents(active)}},{key:"getRowPosition",value:function(index){var row=this.rowManager.findRow(index);return row?row.getPosition():(console.warn("Position Error - No matching row found:",index),!1)}},{key:"setColumns",value:function(definition){this.initGuard(!1,"To set initial columns please use the 'columns' property in the table constructor"),this.columnManager.setColumns(definition)}},{key:"getColumns",value:function(structured){return this.columnManager.getComponents(structured)}},{key:"getColumn",value:function(field){var column=this.columnManager.findColumn(field);return column?column.getComponent():(console.warn("Find Error - No matching column found:",field),!1)}},{key:"getColumnDefinitions",value:function(){return this.columnManager.getDefinitionTree()}},{key:"showColumn",value:function(field){var column=this.columnManager.findColumn(field);if(this.initGuard(),!column)return console.warn("Column Show Error - No matching column found:",field),!1;column.show()}},{key:"hideColumn",value:function(field){var column=this.columnManager.findColumn(field);if(this.initGuard(),!column)return console.warn("Column Hide Error - No matching column found:",field),!1;column.hide()}},{key:"toggleColumn",value:function(field){var column=this.columnManager.findColumn(field);if(this.initGuard(),!column)return console.warn("Column Visibility Toggle Error - No matching column found:",field),!1;column.visible?column.hide():column.show()}},{key:"addColumn",value:function(definition,before,field){var column=this.columnManager.findColumn(field);return this.initGuard(),this.columnManager.addColumn(definition,before,column).then((function(column){return column.getComponent()}))}},{key:"deleteColumn",value:function(field){var column=this.columnManager.findColumn(field);return this.initGuard(),column?column.delete():(console.warn("Column Delete Error - No matching column found:",field),Promise.reject())}},{key:"updateColumnDefinition",value:function(field,definition){var column=this.columnManager.findColumn(field);return this.initGuard(),column?column.updateDefinition(definition):(console.warn("Column Update Error - No matching column found:",field),Promise.reject())}},{key:"moveColumn",value:function(from,to,after){var fromColumn=this.columnManager.findColumn(from),toColumn=this.columnManager.findColumn(to);this.initGuard(),fromColumn?toColumn?this.columnManager.moveColumn(fromColumn,toColumn,after):console.warn("Move Error - No matching column found:",toColumn):console.warn("Move Error - No matching column found:",from)}},{key:"scrollToColumn",value:function(field,position,ifVisible){var _this214=this;return new Promise((function(resolve,reject){var column=_this214.columnManager.findColumn(field);return column?_this214.columnManager.scrollToColumn(column,position,ifVisible):(console.warn("Scroll Error - No matching column found:",field),Promise.reject("Scroll Error - No matching column found"))}))}},{key:"redraw",value:function(force){this.initGuard(),this.columnManager.redraw(force),this.rowManager.redraw(force)}},{key:"setHeight",value:function(height){this.options.height=isNaN(height)?height:height+"px",this.element.style.height=this.options.height,this.rowManager.initializeRenderer(),this.rowManager.redraw()}},{key:"on",value:function(key,callback){this.externalEvents.subscribe(key,callback)}},{key:"off",value:function(key,callback){this.externalEvents.unsubscribe(key,callback)}},{key:"dispatchEvent",value:function(){var _this$externalEvents,args=Array.from(arguments);args.shift(),(_this$externalEvents=this.externalEvents).dispatch.apply(_this$externalEvents,arguments)}},{key:"alert",value:function(contents,type){this.initGuard(),this.alertManager.alert(contents,type)}},{key:"clearAlert",value:function(){this.initGuard(),this.alertManager.clear()}},{key:"modExists",value:function(plugin,required){return!!this.modules[plugin]||(required&&console.error("Tabulator Module Not Installed: "+plugin),!1)}},{key:"module",value:function(key){var mod=this.modules[key];return mod||console.error("Tabulator module not installed: "+key),mod}}]),Tabulator}();_exports.Tabulator=Tabulator,Tabulator.defaultOptions={debugEventsExternal:!1,debugEventsInternal:!1,debugInvalidOptions:!0,debugInvalidComponentFuncs:!0,debugInitialization:!0,debugDeprecation:!0,height:!1,minHeight:!1,maxHeight:!1,columnHeaderVertAlign:"top",popupContainer:!1,columns:[],columnDefaults:{},data:!1,autoColumns:!1,autoColumnsDefinitions:!1,nestedFieldSeparator:".",footerElement:!1,index:"id",textDirection:"auto",addRowPos:"bottom",headerVisible:!0,renderVertical:"virtual",renderHorizontal:"basic",renderVerticalBuffer:0,scrollToRowPosition:"top",scrollToRowIfVisible:!0,scrollToColumnPosition:"left",scrollToColumnIfVisible:!0,rowFormatter:!1,rowFormatterPrint:null,rowFormatterClipboard:null,rowFormatterHtmlOutput:null,rowHeight:null,placeholder:!1,dataLoader:!0,dataLoaderLoading:!1,dataLoaderError:!1,dataLoaderErrorTimeout:3e3,dataSendParams:{},dataReceiveParams:{}},new ModuleBinder(Tabulator);var TabulatorFull=function(_Tabulator){_inherits(TabulatorFull,_Tabulator);var _super56=_createSuper(TabulatorFull);function TabulatorFull(){return _classCallCheck(this,TabulatorFull),_super56.apply(this,arguments)}return _createClass(TabulatorFull)}(Tabulator);_exports.TabulatorFull=TabulatorFull,new ModuleBinder(TabulatorFull,modules);var PseudoRow=function(){function PseudoRow(type){_classCallCheck(this,PseudoRow),this.type=type,this.element=this._createElement()}return _createClass(PseudoRow,[{key:"_createElement",value:function(){var el=document.createElement("div");return el.classList.add("tabulator-row"),el}},{key:"getElement",value:function(){return this.element}},{key:"getComponent",value:function(){return!1}},{key:"getData",value:function(){return{}}},{key:"getHeight",value:function(){return this.element.outerHeight}},{key:"initialize",value:function(){}},{key:"reinitialize",value:function(){}},{key:"normalizeHeight",value:function(){}},{key:"generateCells",value:function(){}},{key:"reinitializeHeight",value:function(){}},{key:"calcHeight",value:function(){}},{key:"setCellHeight",value:function(){}},{key:"clearCellHeight",value:function(){}}]),PseudoRow}();_exports.PseudoRow=PseudoRow}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("qtype_formulas/editform",["exports","core/notification","core/pending","core/ajax","qtype_formulas/instantiation"],(function(_exports,Notification,_pending,_ajax,Instantiation){var obj;function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=_exports.default=void 0,Notification=_interopRequireWildcard(Notification),_pending=(obj=_pending)&&obj.__esModule?obj:{default:obj},Instantiation=_interopRequireWildcard(Instantiation);var defaultCorrectness="",numberOfParts=0,init=function(defCorrectness){defaultCorrectness=defCorrectness,numberOfParts=document.querySelectorAll("fieldset[id^=id_answerhdr_]").length,Instantiation.init(numberOfParts);for(var i=0;i<numberOfParts;i++){var textfield=document.getElementById("id_correctness_".concat(i));0===i&&textfield.form.addEventListener("submit",reenableCriterionTextfields),textfield.addEventListener("input",blockModeSwitcherIfNeeded.bind(null,i));var checkbox=document.getElementById("id_correctness_simple_mode_".concat(i));checkbox.addEventListener("click",handleGradingCriterionModeSwitcher.bind(null,i)),textfield.dispatchEvent(new Event("input")),checkbox.disabled||textfield.classList.contains("is-invalid")||(checkbox.checked=!0,checkbox.dispatchEvent(new Event("click")));for(var _i=0,_elements=["type","comp","tol"];_i<_elements.length;_i++){var element=_elements[_i];document.getElementById("id_correctness_simple_".concat(element,"_").concat(i)).addEventListener("change",handleSimpleCriterionChanges.bind(null,i))}document.getElementById("id_correctness_simple_tol_".concat(i)).addEventListener("change",normalizeTolerance)}for(var variableFields=[{field:"random",handler:validateRandomvars},{field:"global",handler:validateGlobalvars}],_i2=0;_i2<numberOfParts;_i2++)variableFields.push({field:"1_".concat(_i2),handler:validateLocalvars.bind(null,_i2)});for(var _i3=0,_variableFields=variableFields;_i3<_variableFields.length;_i3++){var field=_variableFields[_i3];document.getElementById("id_vars".concat(field.field)).addEventListener("blur",field.handler)}document.getElementById("id_instantiatebtn").addEventListener("click",Instantiation.instantiate)};_exports.init=init;var _ref,_ref2,_ref3,validateGlobalvars=(_ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(evt){var pendingPromise,validationResult;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(""!==evt.target.value){_context.next=3;break}return showOrClearValidationError(evt.target.id,""),_context.abrupt("return");case 3:return pendingPromise=new _pending.default("qtype_formulas/validateglobal"),_context.prev=4,_context.next=7,(0,_ajax.call)([{methodname:"qtype_formulas_check_random_global_vars",args:{randomvars:document.getElementById("id_varsrandom").value,globalvars:evt.target.value}}])[0];case 7:""===(validationResult=_context.sent).source||"global"===validationResult.source?showOrClearValidationError(evt.target.id,validationResult.message):showOrClearValidationError("id_varsrandom",validationResult.message,!1),_context.next=14;break;case 11:_context.prev=11,_context.t0=_context.catch(4),Notification.exception(_context.t0);case 14:pendingPromise.resolve();case 15:case"end":return _context.stop()}}),_callee,null,[[4,11]])}))),function(_x){return _ref.apply(this,arguments)}),validateRandomvars=(_ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(evt){var pendingPromise,validationResult;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(""!==evt.target.value){_context2.next=3;break}return showOrClearValidationError(evt.target.id,""),_context2.abrupt("return");case 3:return pendingPromise=new _pending.default("qtype_formulas/validaterandom"),_context2.prev=4,_context2.next=7,(0,_ajax.call)([{methodname:"qtype_formulas_check_random_global_vars",args:{randomvars:evt.target.value}}])[0];case 7:validationResult=_context2.sent,showOrClearValidationError(evt.target.id,validationResult.message),_context2.next=14;break;case 11:_context2.prev=11,_context2.t0=_context2.catch(4),Notification.exception(_context2.t0);case 14:pendingPromise.resolve();case 15:case"end":return _context2.stop()}}),_callee2,null,[[4,11]])}))),function(_x2){return _ref2.apply(this,arguments)}),validateLocalvars=(_ref3=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(part){var fieldList,target,pendingPromise,validationResult;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(fieldList={random:"id_varsrandom",global:"id_varsglobal",local:"id_vars1_".concat(part)},""!==(target=document.getElementById(fieldList.local)).value){_context3.next=5;break}return showOrClearValidationError(target.id,""),_context3.abrupt("return");case 5:return pendingPromise=new _pending.default("qtype_formulas/validatelocal"),_context3.prev=6,_context3.next=9,(0,_ajax.call)([{methodname:"qtype_formulas_check_local_vars",args:{randomvars:document.getElementById(fieldList.random).value,globalvars:document.getElementById(fieldList.global).value,localvars:target.value}}])[0];case 9:""===(validationResult=_context3.sent).source&&(validationResult.source="local"),showOrClearValidationError(fieldList[validationResult.source],validationResult.message,"local"===validationResult.source),_context3.next=17;break;case 14:_context3.prev=14,_context3.t0=_context3.catch(6),Notification.exception(_context3.t0);case 17:pendingPromise.resolve();case 18:case"end":return _context3.stop()}}),_callee3,null,[[6,14]])}))),function(_x3){return _ref3.apply(this,arguments)}),showOrClearValidationError=function(fieldID,message){var sameField=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],field=document.getElementById(fieldID),annotation=document.getElementById(fieldID.replace(/^id_(.*)$/,"id_error_$1")),alreadyWithError=""!==annotation.innerText.trim();if(""===message)return annotation.innerText="",void field.classList.remove("is-invalid");annotation.innerText=message,field.classList.add("is-invalid"),alreadyWithError&&sameField||field.focus()},reenableCriterionTextfields=function(){for(var i=0;i<numberOfParts;i++)document.getElementById("id_correctness_".concat(i)).disabled=!1},handleSimpleCriterionChanges=function(partNumber){document.getElementById("id_correctness_".concat(partNumber)).value=convertSimpleCriterionToText(partNumber)},normalizeTolerance=function(event){var field=event.target,tolerance=parseFloat(field.value);!isNaN(tolerance)&&isFinite(tolerance)||(tolerance=0),field.value=tolerance},handleGradingCriterionModeSwitcher=function(partNumber){var checkbox=document.getElementById("id_correctness_simple_mode_".concat(partNumber)),criterionTextfield=document.getElementById("id_correctness_".concat(partNumber));if(checkbox.checked){""==criterionTextfield.value.trim()&&(criterionTextfield.value=defaultCorrectness);var simpleCriterion=convertTextCriterionToSimple(partNumber);document.getElementById("id_correctness_simple_type_".concat(partNumber)).value=simpleCriterion.type,document.getElementById("id_correctness_simple_comp_".concat(partNumber)).value=simpleCriterion.comparison,document.getElementById("id_correctness_simple_tol_".concat(partNumber)).value=simpleCriterion.tolerance}else criterionTextfield.value=convertSimpleCriterionToText(partNumber)},convertSimpleCriterionToText=function(partNumber){var typeElement=document.getElementById("id_correctness_simple_type_".concat(partNumber)),comparisonElement=document.getElementById("id_correctness_simple_comp_".concat(partNumber)),toleranceElement=document.getElementById("id_correctness_simple_tol_".concat(partNumber));return["_relerr","_err"][typeElement.value]+" "+comparisonElement.options[comparisonElement.value].innerText+" "+parseFloat(toleranceElement.value)},convertTextCriterionToSimple=function(partNumber){var criterionParts=document.getElementById("id_correctness_".concat(partNumber)).value.split(/\s*(==|<)\s*/);if(3!=criterionParts.length||!criterionParts[0].match(/^\s*_(rel)?err\s*$/))throw new TypeError("The given grading criterion cannot be shown in simple mode.");return{type:["_relerr","_err"].indexOf(criterionParts[0]),comparison:["==","<"].indexOf(criterionParts[1]),tolerance:parseFloat(criterionParts[2])}},blockModeSwitcherIfNeeded=function(partNumber){var criterion=document.getElementById("id_correctness_".concat(partNumber)).value.trim(),modeCheckbox=document.getElementById("id_correctness_simple_mode_".concat(partNumber));if(""!=criterion){var criterionParts=criterion.split(/\s*(==|<)\s*/);if(3==criterionParts.length)if(criterionParts[0].match(/^\s*_(rel)?err\s*$/))if(criterionParts[1].match(/\s*(==|<)\s*$/)){var tolerance=parseFloat(criterionParts[2]);isNaN(tolerance)||!isFinite(tolerance)||criterionParts[2].match(/[^-+0-9.e]/)?modeCheckbox.disabled=!0:modeCheckbox.disabled=!1}else modeCheckbox.disabled=!0;else modeCheckbox.disabled=!0;else modeCheckbox.disabled=!0}else modeCheckbox.disabled=!1},_default={init:init};return _exports.default=_default,_exports.default}));
/**
 * JavaScript code for the gapfill question type.
 *
 * @copyright  2020 Marcus Green
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("qtype_gapfill/dragdrop",["jquery","jqueryui","qtype_gapfill/jquery.ui.touch-punch-improved"],(function($){return{init:function(singleuse){function dragShow(that){var i,draggables=$(".draggable"),targetVal=$(that).val();for(i=0;i<draggables.length;i++){draggables[i].textContent==targetVal&&$(draggables[i]).removeClass("hide")}}$(".droptarget").on("dblclick",(function(){singleuse&&(dragShow(this),$(this).val(""))})),$(".droptarget").on("keydown drop",(function(){dragShow(this)})),$(".draggable").draggable({revert:!1,helper:"clone",cursor:"pointer",scroll:"false"}),$(".droptarget").droppable({hoverClass:"active",drop:function(event,ui){$(ui.draggable).hasClass("readonly")||(this.value=$(ui.draggable).text(),$(this).css("background-color","white"),$(this).addClass("dropped"),singleuse&&$(ui.draggable).addClass("hide"))}}),$(".droptarget").dblclick((function(){$(this).val(""),$(this).removeClass("dropped"),$(this).css("background-color","white")}))}}}));
var factory;factory=function($){var pointerEnabled=window.navigator.pointerEnabled||window.navigator.msPointerEnabled;if($.support.touch="ontouchend"in document||pointerEnabled,$.support.touch&&$.ui.mouse){var touchHandled,mouseProto=$.ui.mouse.prototype,_mouseInit=mouseProto._mouseInit;mouseProto._touchStart=function(event){touchHandled||!pointerEnabled&&!this._mouseCapture(event.originalEvent.changedTouches[0])||(touchHandled=!0,this._touchMoved=!1,simulateMouseEvent(event,"mouseover"),simulateMouseEvent(event,"mousemove"),simulateMouseEvent(event,"mousedown"))},mouseProto._touchMove=function(event){touchHandled&&(this._touchMoved=!0,simulateMouseEvent(event,"mousemove"))},mouseProto._touchEnd=function(event){touchHandled&&(simulateMouseEvent(event,"mouseup"),simulateMouseEvent(event,"mouseout"),this._touchMoved||simulateMouseEvent(event,"click"),touchHandled=!1)},mouseProto._mouseInit=function(){this.element.on({touchstart:$.proxy(this,"_touchStart"),touchmove:$.proxy(this,"_touchMove"),touchend:$.proxy(this,"_touchEnd"),pointerDown:$.proxy(this,"_touchStart"),pointerMove:$.proxy(this,"_touchMove"),pointerUp:$.proxy(this,"_touchEnd"),MSPointerDown:$.proxy(this,"_touchStart"),MSPointerMove:$.proxy(this,"_touchMove"),MSPointerUp:$.proxy(this,"_touchEnd")}),_mouseInit.call(this)}}function simulateMouseEvent(event,simulatedType){if(!(!pointerEnabled&&event.originalEvent.touches.length>1||pointerEnabled&&!event.isPrimary)){var touch=pointerEnabled?event.originalEvent:event.originalEvent.changedTouches[0],simulatedEvent=document.createEvent("MouseEvents"),coord=function(touch){var winPageX=window.pageXOffset,winPageY=window.pageYOffset,x=touch.clientX,y=touch.clientY;return 0===touch.pageY&&Math.floor(y)>Math.floor(touch.pageY)||0===touch.pageX&&Math.floor(x)>Math.floor(touch.pageX)?(x-=winPageX,y-=winPageY):(y<touch.pageY-winPageY||x<touch.pageX-winPageX)&&(x=touch.pageX-winPageX,y=touch.pageY-winPageY),{clientX:x,clientY:y}}(touch);$(touch.target).is("input")||$(touch.target).is("textarea")?event.stopPropagation():event.preventDefault(),simulatedEvent.initMouseEvent(simulatedType,!0,!0,window,1,event.screenX||touch.screenX,event.screenY||touch.screenY,event.clientX||coord.clientX,event.clientY||coord.clientY,!1,!1,!1,!1,0,null),event.target.dispatchEvent(simulatedEvent)}}},"function"==typeof define&&define.amd?define("qtype_gapfill/jquery.ui.touch-punch-improved",["jquery","jqueryui"],factory):factory(window.jQuery);
/**
 * JavaScript code for the gapfill question type.
 *
 * @copyright  2017 Marcus Green
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("qtype_gapfill/Item",["jquery"],(function($){return function Item(text,delimitchars){this.questionid=$("input[name=id]").val(),this.settings=function(){var settings=[],settingsdata=$("[name='itemsettings']").val();if(settingsdata>""){var obj=JSON.parse(settingsdata);for(var o in obj)settings.push(obj[o])}return settings}(),this.gaptext=text,this.delimitchars=delimitchars,this.l=delimitchars.substr(0,1),this.r=delimitchars.substr(1,1),this.len=this.gaptext.length,this.startchar=this.gaptext.substring(0,1),this.endchar=this.gaptext.substring(this.len-1,this.len),this.gaptextNodelim="",this.feedback={},this.instance=0,this.feedback.correct=$("#id_corecteditable").html(),this.feedback.incorrect=$("#id_incorrecteditable").html(),Item.prototype.striptags=function(gaptext){if(void 0===gaptext)return"";return gaptext.replace(/(<([^>]+)>)/gi,"")},this.stripdelim=function(){if(this.startchar===this.l&&(this.gaptextNodelim=this.gaptext.substring(1,this.len)),this.endchar===this.r){var len=this.gaptextNodelim.length;this.gaptextNodelim=this.gaptextNodelim.substring(0,len-1)}return this.gaptextNodelim};var itemsettings=[];Item.prototype.getItemSettings=function(target){var itemid=target.id,underscore=itemid.indexOf("_");for(var set in this.instance=itemid.substr(underscore+1),this.settings)text=this.stripdelim(),this.settings[set].gaptext===text&&(itemsettings=this.settings[set]);return itemsettings},this.updateJson=function(e){var found=!1,id=e.target.id;for(var set in this.settings)this.settings[set].gaptext===this.stripdelim()&&(this.settings[set].correctfeedback=$("#id_correcteditable")[0].innerHTML,this.settings[set].incorrectfeedback=$("#id_incorrecteditable")[0].innerHTML,found=!0);if(!1===found){var itemsettings={itemid:id,questionid:$("input[name=id]").val(),correctfeedback:$("#id_correcteditable").html(),incorrectfeedback:$("#id_incorrecteditable").html(),gaptext:this.stripdelim()};this.settings.push(itemsettings)}return JSON.stringify(this.settings)}}}));
/**
 * JavaScript code for the gapfill question type.
 *
 * @copyright  2017 Marcus Green
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("qtype_gapfill/questionedit",["jquery","qtype_gapfill/Item"],(function($,Item){return{init:function(){$("#id_answerdisplay").change((function(){var selected=$(this).val();"gapfill"==selected&&($("#id_fixedgapsize").prop("disabled",!1),$("#id_optionsaftertext").prop("disabled",!0).prop("checked",!1),$("#id_singleuse").prop("disabled",!0).prop("checked",!1),$("#id_disableregex").prop("disabled",!1)),"dragdrop"==selected&&($("#id_optionsaftertext").prop("disabled",!1),$("#id_singleuse").prop("disabled",!1),$("#id_fixedgapsize").prop("disabled",!1),$("#id_disableregex").prop("disabled",!1)),"dropdown"==selected&&($("#id_fixedgapsize").prop("disabled",!0).prop("checked",!1),$("#id_optionsaftertext").prop("disabled",!0).prop("checked",!1),$("#id_singleuse").prop("disabled",!0).prop("checked",!1),$("#id_disableregex").prop("disabled",!0).prop("checked",!1))})),$("#id_itemsettings_button").on("click",(function(){if($(".editor_atto").length<1)return $("#id_error_itemsettings_button").css({display:"inline",color:"red"}),void($("#id_error_itemsettings_button")[0].innerHTML=M.util.get_string("itemsettingserror","qtype_gapfill"));if($("#questiontext .atto_html_button").attr("disabled","true"),$("#id_questiontexteditable").get(0).isContentEditable){$("#id_questiontexteditable").attr("contenteditable","false"),$("#fitem_id_questiontext").find("button").attr("disabled","true");var settingformheight=$("#id_questiontexteditable").css("height"),settingformwidth=$("#id_questiontexteditable").css("width");$("#id_questiontexteditable").css("display","none"),$("#id_itemsettings_canvas").css(function(source){var style,name,product={};if(source.length){var dom=source.get(0);if(window.getComputedStyle){var pattern=/-([a-z])/g,uc=function(a,b){return b.toUpperCase()},camelize=function(string){return string.replace(pattern,uc)};if(style=window.getComputedStyle(dom,null))for(var camel,value,i=0,l=style.length;i<l;i++)camel=camelize(name=style[i]),value=style.getPropertyValue(name),product[camel]=value;else if(style=dom.currentStyle)for(name in style)product[name]=style[name];else(style=dom.style)&&(product=function(style,product,name){for(name in style)"function"!=typeof style[name]&&(product[name]=style[name]);return product}(style,product,name));return product}}return!1}($("#id_questiontexteditable")));var ed=$("#id_questiontexteditable").closest(".editor_atto_content_wrap");$("#id_itemsettings_canvas").appendTo(ed).css("position","relative"),$("#id_itemsettings_canvas").css({display:"block",background:"lightgrey"}),$("#id_itemsettings_canvas").html($("#id_questiontexteditable").prop("innerHTML")),$("#id_itemsettings_canvas").css({height:settingformheight,width:settingformwidth}),$("#id_itemsettings_canvas").css({height:"100%",width:"100%"}),$("#id_itemsettings_button").html(M.util.get_string("editquestiontext","qtype_gapfill")),$("#id_itemsettings_canvas").height($("#id_questiontexteditable").height()),wrapContent($("#id_itemsettings_canvas")[0])}else $("#id_questiontexteditable").css({display:"block",backgroundColor:"white"}),$("#id_questiontexteditable").attr("contenteditable","true"),$("#id_itemsettings_canvas").css("display","none"),$("#fitem_id_questiontext").find("button").removeAttr("disabled"),$("#id_settings_popup").css("display","none"),$("#id_itemsettings_button").html(M.util.get_string("additemsettings","qtype_gapfill")),$("[class^=atto_]").removeAttr("disabled")})),$("#id_itemsettings_canvas").on("click",(function(e){if(!$("#id_questiontexteditable").get(0).isContentEditable&&e.target.id.match(/^id[0-9]+_/)){var delimitchars=$("#id_delimitchars").val(),item=new Item(e.target.innerHTML,delimitchars),itemsettings=item.getItemSettings(e.target);null===itemsettings||0===itemsettings.length?($("#id_correcteditable").html(""),$("#id_incorrecteditable").html("")):($("#id_correcteditable").html(itemsettings.correctfeedback),$("#id_incorrecteditable").html(itemsettings.incorrectfeedback)),$("label[for*='id_correct']").text(M.util.get_string("correct","qtype_gapfill")),$("label[for*='id_incorrect']").text(M.util.get_string("incorrect","qtype_gapfill")),$("#id_itemsettings_popup .atto_image_button").attr("disabled","true"),$("#id_itemsettings_popup .atto_media_button").attr("disabled","true"),$("#id_itemsettings_popup .atto_managefiles_button").attr("disabled","true");var title=M.util.get_string("additemsettings","qtype_gapfill");title+=": "+$("<div/>").html(item.stripdelim()).text(),require(["jquery","jqueryui"],(function($){$("#id_itemsettings_popup").dialog({position:{my:"right",at:"right",of:"#id_itemsettings_canvas"},height:500,width:"70%",modal:!1,title:title,buttons:[{text:"OK",id:"SaveItemFeedback",click:function(){var JSONstr=item.updateJson(e);$("[class^=atto_]").removeAttr("disabled"),$("[name='itemsettings']").val(JSONstr),$(".ui-dialog-content").dialog("close"),$("#id_questiontexteditable").attr("contenteditable","true"),$("#id_itemsettings_button").click()}}]})}))}}));var wrapContent=function(el){var node,frag,text,count=0,gaps=[],nodes=function(obj){for(var arr=[],i=0,iLen=obj.length;i<iLen;i++)arr.push(obj[i]);return arr}((el=el&&el.parentNode?el:document.body).childNodes);"id_questiontextfeedback"===el.id&&count>0&&(count=0);for(var sp,delimitchars=$("#id_delimitchars").val(),l=delimitchars.substring(0,1),r=delimitchars.substring(1,2),regex=new RegExp("(\\"+l+".*?\\"+r+")","g"),span=document.createElement("span"),skip={script:"",button:"",input:"",select:"",textarea:"",option:""},i=0,iLen=nodes.length;i<iLen;i++)if(1!==(node=nodes[i]).nodeType||node.tagName.toLowerCase()in skip){if(3===node.nodeType){var textsplit=new RegExp("(\\"+l+".*?\\"+r+")","g");if(text=node.data.split(textsplit)){frag=document.createDocumentFragment();for(var j=0,jLen=text.length;j<jLen;j++)doGap(text,span,j)}node.parentNode.replaceChild(frag,node)}}else wrapContent(node);function doGap(text,span,j){if(gaps=[],regex.test(text[j])){sp=span.cloneNode(!1),count++,sp.className="item";var item=new Item(text[j],$("#id_delimitchars").val());if(item.gaptext>""){for(var instance=0,k=0;k<gaps.length;++k)gaps[k]===item.text&&instance++;item.id="id"+count+"_"+instance,sp.id=item.id;var is=item.getItemSettings(item);item.striptags(is.correctfeedback)>""&&(sp.className="hascorrect"),item.striptags(is.incorrectfeedback)>""&&(sp.className=sp.className+" hasnocorrect"),gaps.push(item.gaptext)}sp.appendChild(document.createTextNode(text[j])),frag.appendChild(sp)}else frag.appendChild(document.createTextNode(text[j]))}}}}}));
define("qtype_multichoice/answers",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;
/**
   * Handles events related to the multiple-choice question type answers.
   *
   * @module     qtype_multichoice/answers
   * @package    qtype_multichoice
   * @copyright  2020 Jun Pataleta <jun@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
var SELECTORS_ANSWER_LABEL="[data-region=answer-label]",_default={init:function(rootId){var root=document.getElementById(rootId);root.querySelectorAll(SELECTORS_ANSWER_LABEL).forEach((function(answerLabel){answerLabel.addEventListener("click",(function(e){var labelId=e.currentTarget.id;root.querySelector('[aria-labelledby="'.concat(labelId,'"]')).click()}))}))}};return _exports.default=_default,_exports.default}));
/**
 * Manages 'Clear my choice' functionality actions.
 *
 * @module     qtype_multichoice/clearchoice
 * @copyright  2019 Simey Lameze <simey@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.7
 */
define("qtype_multichoice/clearchoice",["jquery","core/custom_interaction_events"],(function($,CustomEvents){var SELECTORS_CHOICE_ELEMENT=".answer input",SELECTORS_LINK="a",SELECTORS_RADIO='input[type="radio"]',registerEventListeners=function(root,fieldPrefix){var clearChoiceContainer=function(root,fieldPrefix){return root.find('div[id="'+fieldPrefix+'"]')}(root,fieldPrefix);clearChoiceContainer.on(CustomEvents.events.activate,SELECTORS_LINK,(function(e,data){!function(clearChoiceContainer){clearChoiceContainer.find(SELECTORS_RADIO).prop("disabled",!1).prop("checked",!0)}(clearChoiceContainer),function(clearChoiceContainer){clearChoiceContainer.addClass("sr-only"),clearChoiceContainer.attr("aria-hidden",!0),clearChoiceContainer.find(SELECTORS_LINK).attr("tabindex",-1)}(clearChoiceContainer),data.originalEvent.preventDefault()})),root.on("change",SELECTORS_CHOICE_ELEMENT,(function(){!function(clearChoiceContainer){clearChoiceContainer.removeClass("sr-only"),clearChoiceContainer.removeAttr("aria-hidden"),clearChoiceContainer.find(SELECTORS_LINK).attr("tabindex",0),clearChoiceContainer.find(SELECTORS_RADIO).prop("disabled",!0)}(clearChoiceContainer)})),clearChoiceContainer.find(SELECTORS_RADIO).focus((function(){root.find(SELECTORS_CHOICE_ELEMENT).first().focus()}))};return{init:function(root,fieldPrefix){root=$("#"+root),registerEventListeners(root,fieldPrefix)}}}));
define('qtype_ordering/autoscroll', ["jquery"],function(a){var b={SCROLL_THRESHOLD:30,SCROLL_FREQUENCY:1e3/60,SCROLL_SPEED:.5,scrollingId:null,scrollAmount:0,callback:null,start:function(c){a(window).on("mousemove",b.mouseMove),a(window).on("touchmove",b.touchMove),b.callback=c},stop:function(){a(window).off("mousemove",b.mouseMove),a(window).off("touchmove",b.touchMove),null!==b.scrollingId&&b.stopScrolling()},touchMove:function(a){for(var c=0;c<a.changedTouches.length;c++)b.handleMove(a.changedTouches[c].clientX,a.changedTouches[c].clientY)},mouseMove:function(a){b.handleMove(a.clientX,a.clientY)},handleMove:function(c,d){d<b.SCROLL_THRESHOLD?b.scrollAmount=-Math.min(b.SCROLL_THRESHOLD-d,b.SCROLL_THRESHOLD):d>a(window).height()-b.SCROLL_THRESHOLD?b.scrollAmount=Math.min(d-(a(window).height()-b.SCROLL_THRESHOLD),b.SCROLL_THRESHOLD):b.scrollAmount=0,b.scrollAmount&&null===b.scrollingId?b.startScrolling():b.scrollAmount||null===b.scrollingId||b.stopScrolling()},startScrolling:function(){var c=a(document).height()-a(window).height();b.scrollingId=window.setInterval(function(){var d=a(window).scrollTop(),e=Math.round(b.scrollAmount*b.SCROLL_SPEED);if(d+e<0&&(e=-d),d+e>c&&(e=c-d),0!==e){a(window).scrollTop(d+e);var f=a(window).scrollTop()-d;0!==f&&b.callback&&b.callback(f)}},b.SCROLL_FREQUENCY)},stopScrolling:function(){window.clearInterval(b.scrollingId),b.scrollingId=null}};return{start:b.start,stop:b.stop}});
define ("qtype_ordering/drag_reorder",["jquery",require.specified("core/dragdrop")?"core/dragdrop":"qtype_ordering/dragdrop",require.specified("core/key_codes")?"core/key_codes":"qtype_ordering/key_codes"],function(a,b,c){return function(d){var e=null,f=null,g=null,h=null,j=null,k=null,l=function(c,h){k=a(d.list);e={time:new Date().getTime(),x:h.x,y:h.y};g=a(c.currentTarget).closest(d.itemInPage);if("undefined"!=typeof d.reorderStart){d.reorderStart(g.closest(d.list),g)}f=t();j=a(d.proxyHtml.replace("%%ITEM_HTML%%",g.html()).replace("%%ITEM_CLASS_NAME%%",g.attr("class")).replace("%%LIST_CLASS_NAME%%",k.attr("class")));a(document.body).append(j);j.css("position","absolute");j.css(g.offset());j.width(g.outerWidth());j.height(g.outerHeight());g.addClass(d.itemMovingClass);n(g);b.start(c,j,m,o)},m=function(){var b=g.closest(d.list),c=null,e=null;b.find(d.item).each(function(b,d){var f=s(d,j);if(null===c||f<e){c=a(d);e=f}});if(c[0]===g[0]){return}if(r(j)<r(c)){g.insertBefore(c)}else{g.insertAfter(c)}n(g)},n=function(a){for(var b=a.closest("ol, ul"),c=b.find("li"),d=c.length,e=0;e<d;++e){if(a[0]===c[e]){j.find("li").attr("value",e+1);break}}},o=function(a,b){if("undefined"!=typeof d.reorderEnd){d.reorderEnd(g.closest(d.list),g)}var c=t();if(!u(f,c)){d.reorderDone(g.closest(d.list),g,c)}else if(500>new Date().getTime()-e.time&&10>Math.abs(e.x-a)&&10>Math.abs(e.y-b)){g[0].focus()}j.remove();j=null;g.removeClass(d.itemMovingClass);g=null;e=null},p=function(a,b){switch(a.keyCode){case c.space:case c.arrowRight:case c.arrowDown:a.preventDefault();a.stopPropagation();var d=b.next();if(d.length){d.insertBefore(b)}break;case c.arrowLeft:case c.arrowUp:a.preventDefault();a.stopPropagation();var e=b.prev();if(e.length){e.insertAfter(b)}break;}},q=function(a){return a.offset().left+a.outerWidth()/2},r=function(a){return a.offset().top+a.outerHeight()/2},s=function(b,c){var d=a(b),e=a(c),f=q(d)-q(e),g=r(d)-r(e);return Math.sqrt(f*f+g*g)},t=function(){return(g||h).closest(d.list).find(d.item).map(function(a,b){return d.idGetter(b)}).get()},u=function(a,b){return a.length===b.length&&a.every(function(a,c){return a===b[c]})};d.itemInPage=function combineSelectors(a,b){var c=[];a.split(",").forEach(function(a){b.split(",").forEach(function(b){c.push(a.trim()+" "+b.trim())})});return c.join(", ")}(d.list,d.item);a(d.list).on("mousedown touchstart",d.item,function(a){var c=b.prepare(a);if(c.start){l(a,c)}});a(d.list).on("keydown",d.item,function(b){h=a(b.currentTarget).closest(d.itemInPage);f=t();p(b,h);var c=t();if(!u(f,c)){d.reorderDone(h.closest(d.list),h,c)}});a(d.itemInPage).attr("tabindex","0")}});
define('qtype_ordering/dragdrop', ["jquery","qtype_ordering/autoscroll"],function(a,b){var c={eventCaptureOptions:{passive:!1,capture:!0},dragProxy:null,onMove:null,onDrop:null,initialPosition:null,initialX:null,initialY:null,touching:null,prepare:function(a){a.preventDefault();var b;if(b="touchstart"===a.type?null===c.touching&&a.changedTouches.length>0:1===a.which){var d=c.getEventXY(a);return d.start=!0,d}return{start:!1}},start:function(a,d,e,f){var g=c.getEventXY(a);switch(c.initialX=g.x,c.initialY=g.y,c.initialPosition=d.offset(),c.dragProxy=d,c.onMove=e,c.onDrop=f,a.type){case"mousedown":c.addEventSpecial("mousemove",c.mouseMove),c.addEventSpecial("mouseup",c.mouseUp);break;case"touchstart":c.addEventSpecial("touchend",c.touchEnd),c.addEventSpecial("touchcancel",c.touchEnd),c.addEventSpecial("touchmove",c.touchMove),c.touching=a.changedTouches[0].identifier;break;default:throw new Error("Unexpected event type: "+a.type)}b.start(c.scroll)},addEventSpecial:function(a,b){try{window.addEventListener(a,b,c.eventCaptureOptions)}catch(d){c.eventCaptureOptions=!0,window.addEventListener(a,b,c.eventCaptureOptions)}},getEventXY:function(a){switch(a.type){case"touchstart":return{x:a.changedTouches[0].pageX,y:a.changedTouches[0].pageY};case"mousedown":return{x:a.pageX,y:a.pageY};default:throw new Error("Unexpected event type: "+a.type)}},touchMove:function(a){a.preventDefault();for(var b=0;b<a.changedTouches.length;b++)a.changedTouches[b].identifier===c.touching&&c.handleMove(a.changedTouches[b].pageX,a.changedTouches[b].pageY)},mouseMove:function(a){c.handleMove(a.pageX,a.pageY)},handleMove:function(b,d){var e=c.dragProxy.offset(),f=e.top-parseInt(c.dragProxy.css("top")),g=e.left-parseInt(c.dragProxy.css("left")),h=a(document).height()-c.dragProxy.outerHeight()-f,i=a(document).width()-c.dragProxy.outerWidth()-g,j=-f,k=-g,l=c.initialPosition,m={top:Math.max(j,Math.min(h,l.top+(d-c.initialY)-f)),left:Math.max(k,Math.min(i,l.left+(b-c.initialX)-g))};c.dragProxy.css(m),c.onMove(b,d,c.dragProxy)},touchEnd:function(a){a.preventDefault();for(var b=0;b<a.changedTouches.length;b++)a.changedTouches[b].identifier===c.touching&&c.handleEnd(a.changedTouches[b].pageX,a.changedTouches[b].pageY)},mouseUp:function(a){c.handleEnd(a.pageX,a.pageY)},handleEnd:function(a,d){null!==c.touching?(window.removeEventListener("touchend",c.touchEnd,c.eventCaptureOptions),window.removeEventListener("touchcancel",c.touchEnd,c.eventCaptureOptions),window.removeEventListener("touchmove",c.touchMove,c.eventCaptureOptions),c.touching=null):(window.removeEventListener("mousemove",c.mouseMove,c.eventCaptureOptions),window.removeEventListener("mouseup",c.mouseUp,c.eventCaptureOptions)),b.stop(),c.onDrop(a,d,c.dragProxy)},scroll:function(b){var d=a(document).height()-c.dragProxy.outerHeight(),e=c.dragProxy.offset();e.top=Math.min(d,e.top+b),c.dragProxy.css(e)}};return{prepare:c.prepare,start:c.start}});
define('qtype_ordering/key_codes', [],function(){return{tab:9,enter:13,escape:27,space:32,end:35,home:36,arrowLeft:37,arrowUp:38,arrowRight:39,arrowDown:40,8:56,asterix:106,pageUp:33,pageDown:34}});
define ("qtype_ordering/reorder",["jquery","qtype_ordering/drag_reorder"],function(a,b){return{init:function init(c,d){new b({list:"ul#"+c,item:"li.sortableitem",proxyHtml:"<div class=\"que ordering dragproxy\"><ul class=\"%%LIST_CLASS_NAME%%\"><li class=\"%%ITEM_CLASS_NAME%% item-moving\">%%ITEM_HTML%%</li></ul></div>",itemMovingClass:"current-drop",idGetter:function idGetter(b){return a(b).attr("id")},nameGetter:function nameGetter(b){return a(b).text},reorderStart:function reorderStart(){},reorderEnd:function reorderEnd(){},reorderDone:function reorderDone(b,c,e){a("input#"+d)[0].value=e.join(",")}})}}});
define ("qtype_pmatch/creator",["jquery","core/str","core/ajax","core/templates","core/key_codes"],function(a,b,c,d,f){var g={newRowId:"",idxLastRow:0,questionId:"",init:function init(){g.questionId=a("#attemptsform input[name=\"id\"]").val();g.table=a("#responses");g.idxLastRow=g.table.find("tbody tr").length-1;g.disableControlButtonAndSelectionBox();a("#newresponsebutton").click(function(b){b.preventDefault();g.idxLastRow++;g.newRowId="qtype-pmatch-new-response_"+g.idxLastRow;d.render("qtype_pmatch/newresponse",{newrowid:g.newRowId}).done(function(b){g.table.append(b);a("html, body").animate({scrollTop:a("#"+g.newRowId).offset().top},800);a(".new-expectedfraction").focus();M.core_formchangechecker.set_form_changed()});g.disableControlButtons(!0)});var b=null;a(document).on("keyup paste",".new-response",function(){var c=a(this).val().trim();if(b){M.util.js_complete("checkresponse");clearTimeout(b)}M.util.js_pending("checkresponse");b=setTimeout(function(){if(""===c){g.handleSaveNewResponseButton(!1,"")}else{g.checkResponse(c)}M.util.js_complete("checkresponse")},500)});a(document).on("keydown",".new-response",function(a){if(a.keyCode==f.enter){g.saveNewResponse();return!1}});a(document).on("keydown",".new-expectedfraction, .new-response, .savenewresponse, .cancelnewresponse",function(a){if(a.keyCode==f.escape){g.cancelNewResponse()}});a(document).on("click",".savenewresponse",function(){return g.saveNewResponse()});a(document).on("click",".cancelnewresponse",function(){g.cancelNewResponse()})},saveNewResponse:function saveNewResponse(){var b=a(".new-response").val().trim();if(""!==b){var d=a(".new-expectedfraction").is(":checked")?1:0,e=c.call([{methodname:"qtype_pmatch_create_response",args:{questionid:g.questionId,expectedfraction:d,response:b,curentrow:g.idxLastRow}}],!0);e[0].done(function(b){if("error"===b.status){g.handleSaveNewResponseButton(!1,b.message)}else{g.disableControlButtons(!1);a("#"+g.newRowId).detach();g.table.append(a(b.html));var c=M.util.get_string("testquestionresultssummary","qtype_pmatch",b.counts);a("#testquestion_gradesummary").html(c)}}).fail(function(a){g.handleSaveNewResponseButton(!1,a.message)});g.disableControlButtonAndSelectionBox();g.resetFormState()}},cancelNewResponse:function cancelNewResponse(){a("#"+g.newRowId).remove();g.disableControlButtons(!1);g.disableControlButtonAndSelectionBox();g.resetFormState();g.idxLastRow--},checkResponse:function checkResponse(a){var b=c.call([{methodname:"qtype_pmatch_check_response",args:{questionid:g.questionId,response:a}}],!0);b[0].done(function(a){var b=!1;if("success"==a.status){a.message="";b=!0}g.handleSaveNewResponseButton(b,a.message)}).fail(function(a){g.handleSaveNewResponseButton(!1,a.message)})},handleSaveNewResponseButton:function handleSaveNewResponseButton(b,c){if(b){a(".savenewresponse").removeAttr("disabled")}else{a(".savenewresponse").attr("disabled","true")}a(".response.error").html(c)},disableControlButtons:function disableControlButtons(b){if(b){a("#newresponsebutton").attr("disabled","true");a("#deleteresponsesbutton").attr("disabled","true");a("#testresponsesbutton").attr("disabled","true")}else{a("#newresponsebutton").removeAttr("disabled");a("#deleteresponsesbutton").removeAttr("disabled");a("#testresponsesbutton").removeAttr("disabled")}},resetFormState:function resetFormState(){if(M.core_formchangechecker.get_form_dirty_state()){M.core_formchangechecker.reset_form_dirty_state()}},disableControlButtonAndSelectionBox:function disableControlButtonAndSelectionBox(){var b=a("#tqheadercheckbox"),c=a("#responses");if(0>=c.find("tbody tr:not(.emptyrow)").length){b.attr("disabled",!0);a("#deleteresponsesbutton").attr("disabled","true");a("#testresponsesbutton").attr("disabled","true")}else{b.removeAttr("disabled");a("#deleteresponsesbutton").removeAttr("disabled");a("#testresponsesbutton").removeAttr("disabled")}}};return g});
define ("qtype_pmatch/rulecreator",["jquery"],function(a){var b={store:{},init:function init(){a("textarea[name^=\"answer\"]").each(function(){var c=a(this).attr("id").replace("id_answer_","");b.store["id_"+c]=[];if(""!==a(this).val()){a(this).parent().parent().next().addClass("rc-hidden")}else{a(this).parent().parent().next().addClass("rcw")}var d=a(this).parent().parent().next().find("div.rule-creator");d.attr("id","rc_"+c);a(this).parent().parent().next().find("a.rule-creator-btn").attr("id","rc_btn_"+c);d.find("div[class=\"rc-notice\"]").attr("id","rc_notice_"+c);d.find("label[for=\"term\"]").attr("for","rc_term_"+c);d.find("input[name=\"term\"]").attr("id","rc_term_"+c);d.find("input[name=\"termadd\"]").attr("id","rc_termadd_"+c).click(function(){b.termAdd(c);return!1});d.find("input[name=\"termexclude\"]").attr("id","rc_termexclude_"+c).click(function(){b.termExclude(c);return!1});d.find("input[name=\"termor\"]").attr("id","rc_termor_"+c).click(function(){b.termOr(c);return!1});d.find("label[for=\"template\"]").attr("for","rc_template_"+c);d.find("input[name=\"template\"]").attr("id","rc_template_"+c);d.find("input[name=\"templateadd\"]").attr("id","rc_templateadd_"+c).click(function(){b.templateAdd(c);return!1});d.find("input[name=\"templateexclude\"]").attr("id","rc_templateexclude_"+c).click(function(){b.templateExclude(c);return!1});d.find("label[for=\"precedesadd\"]").attr("for","rc_precedes1_"+c);d.find("select[name=\"precedes1\"]").attr("id","rc_precedes1_"+c);d.find("select[name=\"precedes2\"]").attr("id","rc_precedes2_"+c);d.find("input[name=\"precedesadd\"]").attr("id","rc_precedesadd_"+c).click(function(){b.precedesAdd(c);return!1});d.find("label[for=\"cprecedesadd\"]").attr("for","rc_cprecedes1_"+c);d.find("select[name=\"cprecedes1\"]").attr("id","rc_cprecedes1_"+c);d.find("select[name=\"cprecedes2\"]").attr("id","rc_cprecedes2_"+c);d.find("input[name=\"cprecedesadd\"]").attr("id","rc_cprecedesadd_"+c).click(function(){b.cprecedesAdd(c);return!1});d.find("div.rc-result").attr("id","rc_result_"+c);d.find("input[name=\"add\"]").attr("id","rc_add_"+c).click(function(){b.addToAnswer(c);return!1});d.find("input[name=\"clear\"]").attr("id","rc_clear_"+c).click(function(){b.clear(c);return!1})});a(".rule-creator-btn").click(function(b){var c=a(b.target).closest(".fitem.rcw"),d=a(b.target).closest(".rule-creator-btn").find("img.icon"),e=d.attr("src");c.find(".rule-creator").slideToggle();if(e===void 0){return!1}if(0<e.indexOf("collapsed")){e=e.slice(0,-9)+"expanded"}else{e=e.slice(0,-8)+"collapsed"}d.attr("src",e);return!1})},termAdd:function termAdd(b){var c=this.getTerm(b,"term");if(!c){a("#rc_term_"+b).focus();return}var d=this.addToStore(b,c,"and","term");this.addToPrecedes(b,d,c);this.displayResult(b);a("#rc_term_"+b).val("")},termExclude:function termExclude(b){var c=this.getTerm(b,"term");if(!c){a("#rc_term_"+b).focus();return}this.addToStore(b,c,"not","term");this.disablePrecedes(b,!0);this.displayResult(b);a("#rc_term_"+b).val("")},termOr:function termOr(b){var c=this.getTerm(b,"term");if(!c){a("#rc_term_"+b).focus();return}var d=this.addToStore(b,c,"or","term");this.addToPrecedes(b,d,c);this.displayResult(b);a("#rc_term_"+b).val("")},templateAdd:function templateAdd(b){var c=this.getTerm(b,"template");if(!c){a("#rc_template_"+b).focus();return}var d=this.addToStore(b,c,"and","template");this.addToPrecedes(b,d,c);this.displayResult(b);a("#rc_template_"+b).val("")},templateExclude:function templateExclude(b){var c=this.getTerm(b,"template");if(!c){a("#rc_template_"+b).focus();return}this.addToStore(b,c,"not","template");this.disablePrecedes(b,!0);this.displayResult(b);a("#rc_template_"+b).val("")},precedesAdd:function precedesAdd(a){var b=this.getPrecedesChoices(a,"precedes");if(!b){return}this.addToStore(a,b,"and","precedes");this.removeFromPrecedes(a,b);this.displayResult(a)},cprecedesAdd:function cprecedesAdd(a){var b=this.getPrecedesChoices(a,"cprecedes");if(!b){return}this.addToStore(a,b,"and","cprecedes");this.removeFromPrecedes(a,b);this.displayResult(a)},addToAnswer:function addToAnswer(b){var c=a("#rc_result_"+b).text();if(null===c||""===c){return}a("#id_answer_"+b).val(c);this.clear();a("#rc_btn_"+b).click();a("#id_fraction_"+b).val("1.0").change();a("#id_answer_"+b).focus()},clear:function clear(b){this.store["id_"+b]=[];a("#rc_term_"+b).val("");a("#rc_template_"+b).val("");a("#rc_result_"+b).text("");this.resetPrecedes(b)},getTerm:function getTerm(b,c){if(4<this.getStoreLength(b)){a("#rc_notice_"+b).text(M.util.get_string("rulecreationtoomanyterms","qtype_pmatch"));return!1}var d=a("#rc_"+c+"_"+b).val();if(d===void 0||null===d||""===d){return!1}d=d.trim();if(""===d){return!1}if(-1<d.indexOf(" ")){return!1}if(-1<d.indexOf("_")){d=d.replace(/_/g,"\\_")}if("term"===c){return d}else{if("*"===d.slice(-1)){return d}else{return d+"*"}}},getPrecedesChoices:function getPrecedesChoices(b,c){var d=a("#rc_"+c+"1_"+b).val();if("0"===d){a("#rc_"+c+"1_"+b).focus();return!1}var e=a("#rc_"+c+"2_"+b).val();if("0"===e){a("#rc_"+c+"2_"+b).focus();return!1}if(d===e){a("#rc_"+c+"2_"+b).focus();return!1}return[d,e]},addToPrecedes:function addToPrecedes(b,c,d){a("#rc_precedes1_"+b).append(a("<option>",{value:c}).text(d));a("#rc_precedes2_"+b).append(a("<option>",{value:c}).text(d));a("#rc_cprecedes1_"+b).append(a("<option>",{value:c}).text(d));a("#rc_cprecedes2_"+b).append(a("<option>",{value:c}).text(d))},disablePrecedes:function disablePrecedes(b,c){a("#rc_precedes1_"+b).prop("disabled",c);a("#rc_precedes2_"+b).prop("disabled",c);a("#rc_cprecedes1_"+b).prop("disabled",c);a("#rc_cprecedes2_"+b).prop("disabled",c)},resetPrecedes:function resetPrecedes(b){this.disablePrecedes(b,!1);a("#rc_precedes1_"+b).find("option[value!=\"0\"]").remove();a("#rc_precedes2_"+b).find("option[value!=\"0\"]").remove();a("#rc_cprecedes1_"+b).find("option[value!=\"0\"]").remove();a("#rc_cprecedes2_"+b).find("option[value!=\"0\"]").remove()},removeFromPrecedes:function removeFromPrecedes(b,c){var d;for(d=0;2>d;d++){a("#rc_precedes1_"+b+" option[value=\""+c[d]+"\"]").remove();a("#rc_precedes2_"+b+" option[value=\""+c[d]+"\"]").remove();a("#rc_cprecedes1_"+b+" option[value=\""+c[d]+"\"]").remove();a("#rc_cprecedes2_"+b+" option[value=\""+c[d]+"\"]").remove()}},addToStore:function addToStore(a,b,c,d){var e="id_"+a,f=this.store[e].length+1;this.store[e].push({termid:f,term:b,op:c,type:d});return f},getStoreLength:function getStoreLength(a){return this.store["id_"+a].length},getStoredResult:function getStoredResult(b){var c="",d=[],e=this.store["id_"+b].slice(0),f=e.length,g=0,h=0,j=0,k=[],l=0;if(0===f){return c}for(g=0;g<f;g++){var m="";if("term"===e[g].type){if("and"===e[g].op){m="match_w("+e[g].term+")"}if("or"===e[g].op){m="match_w("+e[g].term+")";if(0<g){k.push(g)}}if("not"===e[g].op){m="not(match_w("+e[g].term+"))"}}if("template"===e[g].type){if("and"===e[g].op){m="match_wm("+e[g].term+")"}if("not"===e[g].op){m="match_wm("+e[g].term+")"}}if("precedes"===e[g].type){h=e[g].term[0]-1;j=e[g].term[1]-1;m=" match_w("+e[h].term+" "+e[j].term+")"}if("cprecedes"===e[g].type){h=e[g].term[0]-1;j=e[g].term[1]-1;m=" match_w("+e[h].term+"_"+e[j].term+")"}d.push(m)}f=d.length;if(0===f){return""}if(1===f){return d[0]}l=k.length;if(0===l){c="match_all(\n  "+d[0];for(g=1;g<f;g++){c=c+" "+d[g]}c=c+"\n)";return c}if(f===l+1){c="match_any(\n  "+d[0];for(g=1;g<f;g++){c=c+" "+d[g]}c=c+"\n)";return c}if(1===l){if(1===k[0]){if(2===f){c="match_any(\n  "+d[0]+" "+d[1]+"\n)"}else{c="match_all(\n  match_any(\n    "+d[0]+" "+d[1]+"\n  )\n ";for(g=2;g<f;g++){c=c+" "+d[g]}c=c+"\n)"}}else{c="match_all(\n    "+d[0];for(g=1;g<k[0];g++){c=c+" "+d[g]}c="match_any(\n  "+c+"\n  )\n  "+d[k[0]]+"\n)";if(f>k[0]+1){c="match_all(\n"+c+"\n";for(g=k[0]+1;g<f;g++){c=c+" "+d[g]}c=c+"\n)"}}}else if(2===l){if(1===k[0]){c="match_any(\n  "+d[0]+" "+d[1];if(2===k[1]){c="match_all(\n"+c+" "+d[2]+"\n)\n";for(g=3;g<f;g++){c=c+" "+d[g]}c=c+"\n)"}else{c="match_all(\n"+c+"\n)\n";for(g=2;g<k[1];g++){c=c+" "+d[g]}c="match_any(\n"+c+"\n)\n "+d[k[1]];if(f>k[1]+1){c="\nmatch_all(\n"+c;for(g=k[1]+1;g<f;g++){c=c+" "+d[g]}c=c+"\n)"}c=c+"\n)"}}else{c="match_all(\n"+d[0];for(g=1;g<k[0];g++){c=c+" "+d[g]}c="match_any(\n"+c+"\n)\n  "+d[k[0]];if(k[1]===k[0]+1){c=c+" "+d[k[1]]+"\n)\n";if(f>k[1]+1){c="match_all(\n"+c;for(g=k[1]+1;g<f;g++){c=c+" "+d[g]}c=c+"\n)"}}else{c="match_all(\n"+c+"\n)\n";for(g=k[0]+1;g<k[1];g++){c=c+" "+d[g]}c="match_any(\n"+c+"\n)\n"+d[k[1]]+"\n)\n";if(f>k[1]+1){c="match_all(\n"+c;for(g=k[1]+1;g<f;g++){c=c+" "+d[g]}c=c+"\n)\n"}}}}else{a("#rc_notice_"+b).text(M.util.get_string("rulecreationtoomanyors","qtype_pmatch"));return""}return c.trim()},displayResult:function displayResult(b){var c=this.getStoredResult(b);a("#rc_result_"+b).text(c)}};return b});
define ("qtype_pmatch/tryrule",["jquery"],function(a){var b={baseUrl:"",sessKey:"",qid:"",pendingid:"",baseForm:null,init:function init(){b.pendingid="tryrule_"+Math.random().toString(36).slice(2);var c=window.location;b.baseUrl=c.protocol+"//"+c.host+c.pathname.replace("question.php","type/pmatch/api/api.php");if(a("#mform1").length){b.baseForm=a("#mform1")}else{b.baseForm=a("form.mform").first()}b.sessKey=b.baseForm.find("input[name=\"sesskey\"]").val();b.qid=b.baseForm.find("input[name=\"id\"]").val();a("input[name=\"tryrule\"]").on("click",function(c){c.preventDefault();var d=a(this).parents(".try-rule").prevAll(".answer-rule").first().attr("id").replace("fitem_id_answer_","");b.tryrule(d,this)})},tryrule:function tryrule(c,d){M.util.js_pending(b.pendingid);var e=a("#id_answer_"+c).val().trim();if(e===void 0||null===e||""===e){return}var f=a(d).next(".try-rule-result"),g=a("#id_fraction_"+c).val(),h={type:"tryrule",qid:b.qid,ruletxt:e,sesskey:b.sessKey,fraction:g};a.post(b.baseUrl,h,function(a){f.html(a);M.util.js_complete(b.pendingid)},"json")}};return b});
define ("qtype_pmatch/updater",["jquery","core/notification"],function(a,b){var c={baseUrl:"",sessKey:"",qid:"",headerCheckboxChecked:!0,REPLACESTRING:/qtype-pmatch-testquestion_r/g,init:function init(){var d=a("#attemptsform").attr("action"),e=a("body");c.baseUrl=d.replace("testquestion.php","api/updater.php");c.sessKey=a("#attemptsform input[name=\"sesskey\"]").val();c.qid=a("#attemptsform input[name=\"id\"]").val();a(document).on("click",".updater-ef",function(){var b=a(this).data("id");c.update(b);return!1});a(document).on("keypress","#tablecontainer :checkbox",function(b){if(13==(b.keyCode?b.keyCode:b.which)){b.preventDefault();a(this).trigger("click")}});a("#tqheadercheckbox").click(function(){if(c.headerCheckboxChecked){a(this).attr("title",M.util.get_string("deselectall","moodle"));c.headerCheckboxChecked=!1}else{a(this).attr("title",M.util.get_string("selectall","moodle"));c.headerCheckboxChecked=!0}a("#tablecontainer :checkbox").each(function(){this.checked=!c.headerCheckboxChecked});a(this).prop("checked",!1)});e.on("updatefailed","[data-inplaceeditable]",function(a){var c=a.exception;a.preventDefault();b.alert(M.util.get_string("error:title","qtype_pmatch"),c.message,M.util.get_string("ok","moodle"))});e.on("updated","[data-inplaceeditable]",function(a){c.handleUpdated(a,this)});c.bindInplaceEditEvent()},bindInplaceEditEvent:function bindInplaceEditEvent(){if(a("#qtype-pmatch-testquestion_r0").hasClass("emptyrow")){require(["core/inplace_editable"])}},handleUpdated:function handleUpdated(b,d){var e=b.ajaxreturn;if(e.value!==b.oldvalue){var f=a.parseJSON(e.value),g=a(d).parent().parent(),h=g.attr("id"),i=f.html;a(g).replaceWith(i.replace(c.REPLACESTRING,h));a("#testquestion_gradesummary").html(f.summary)}},update:function update(b){var d=a("#updater-ef_"+b).text(),e=0;if("1"===d){e=0}else{e=1}var f={qid:c.qid,rid:b,expectedfraction:e,sesskey:c.sessKey};a.post(c.baseUrl,f,function(d){if("success"===d.status){a("#updater-ef_"+b).text(d.ef);a("#updater-ef_"+b).parent().prev().text(d.gf);var e=a("#updater-ef_"+b).parent().parent();e.removeClass();e.addClass(d.rowclass);e.find("td[class=\"c3\"]").text(d.gf);var f=M.util.get_string("testquestionresultssummary","qtype_pmatch",d.counts);a("#testquestion_gradesummary").html(f)}else{window.console.log("Testquestion response updater has experienced an issue.\n"+d.data)}})}};return c});
function _typeof(a){if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("qtype_pmatchjme/jsme",["jquery"],function(a){"use strict";var b={max_loading_waits:10,insert_applet:function insert_applet(a,c,d,e,f,g){var h=[];if(f){h.push("nostereo")}if(g){h.push("autoez")}if(e){h.push("depict")}b.show_jsme(c,a,h,b.max_loading_waits)},show_jsme:function show_jsme(c,d,e,f){var g=a(c),h=!1,i=!1;if("object"!==("undefined"==typeof JSApplet?"undefined":_typeof(JSApplet))&&0<f){setTimeout(function(){b.show_jsme(c,d,e,f-1)},100);return}a("#"+d).html("");a("#"+d).removeClass("qtype_pmatchjme-applet-warning");i=new JSApplet.JSME(d,"368px","312px",{options:e.join(",")});i.name=d;h=g.find("input.jme").val();if(h){i.readMolecule(h)}g.parents("form").on("submit",function(){g.find("input.answer").val(i.smiles());g.find("input.jme").val(i.jmeFile());g.find("input.mol").val(i.molFile())})}};return b});
define('qtype_poodllrecording/poodllhelper', ["jquery","core/log"],(function($,log){return log.debug("poodll helper: initialising"),{init:function(opts){var that=this;window.prquestion=function(evt){if(evt)switch(evt[1]){case"filesubmitted":var filename=evt[2],updatecontrol=evt[3],prquestionUploaded=new CustomEvent("prquestionUploaded",{details:evt});if(document.dispatchEvent(prquestionUploaded),1==opts.safesave){var nextbtn=$(".submitbtns .mod_quiz-next-nav");nextbtn.removeClass("qtype_poodllrecording_disabledbtn"),nextbtn.removeAttr("disabled","disabled"),$(window).off("beforeunload",that.preventPrematureLeaving)}var upc="";if(void 0!==updatecontrol&&""!==updatecontrol&&(upc=$('[id="'+updatecontrol+'"]')),upc.length<1&&(upc=$('[id="'+updatecontrol+'"]',window.parent.document)),!(upc.length>0))return log.debug("upload failed #2"),!1;upc.get(0).value=filename,upc.trigger("change");break;case"started":if(1==opts.safesave){var savebtn=$(".submitbtns .mod_quiz-next-nav");savebtn.addClass("qtype_poodllrecording_disabledbtn"),savebtn.attr("disabled","disabled"),$(window).on("beforeunload",that.preventPrematureLeaving)}}}},preventPrematureLeaving:function(e){return log.debug("preventPrematureLeaving has been called"),e.preventDefault(),e.returnValue="Your recording has not been uploaded. Cancel to stay on this page.",e.returnValue}}}));
/**
 * Javascript to handle changing users via the user selector in the header.
 *
 * @module     mod_assign/grading_navigation
 * @package    mod_assign
 * @copyright  2016 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_assign/grading_navigation",["jquery","core/notification","core/str","core/form-autocomplete","core/ajax","mod_assign/grading_form_change_checker"],(function($,notification,str,autocomplete,ajax,checker){var GradingNavigation=function(selector){this._regionSelector=selector,this._region=$(selector),this._filters=[],this._users=[],this._filteredUsers=[],this._lastXofYUpdate=0,this._firstLoadUsers=!0,this._loadAllUsers(),this._region.find('[data-action="previous-user"]').on("click",this._handlePreviousUser.bind(this)),this._region.find('[data-action="next-user"]').on("click",this._handleNextUser.bind(this)),this._region.find('[data-action="change-user"]').on("change",this._handleChangeUser.bind(this)),this._region.find('[data-region="user-filters"]').on("click",this._toggleExpandFilters.bind(this)),$(document).on("user-changed",this._refreshSelector.bind(this)),$(document).on("done-saving-show-next",this._handleNextUser.bind(this));var toggleLink=this._region.find('[data-region="user-filters"]');$(document.getElementById(toggleLink.attr("aria-controls"))).on("change","select",this._filterChanged.bind(this));var userid=$('[data-region="grading-navigation-panel"]').data("first-userid");userid&&this._selectUserById(userid),str.get_string("changeuser","mod_assign").done((function(s){autocomplete.enhance("[data-action=change-user]",!1,"mod_assign/participant_selector",s)})).fail(notification.exception),$(document).bind("start-loading-user",function(){this._isLoading=!0}.bind(this)),$(document).bind("finish-loading-user",function(){this._isLoading=!1}.bind(this))};return GradingNavigation.prototype._isLoading=!1,GradingNavigation.prototype._regionSelector=null,GradingNavigation.prototype._filters=null,GradingNavigation.prototype._users=null,GradingNavigation.prototype._region=null,GradingNavigation.prototype._lastFilters="",GradingNavigation.prototype._loadAllUsers=function(){var select=this._region.find("[data-action=change-user]"),assignmentid=select.attr("data-assignmentid"),groupid=select.attr("data-groupid"),filterPanel=this._region.find('[data-region="configure-filters"]'),filter=filterPanel.find('select[name="filter"]').val(),workflowFilter=filterPanel.find('select[name="workflowfilter"]');workflowFilter&&(filter+=","+workflowFilter.val());var markerFilter=filterPanel.find('select[name="markerfilter"]');return markerFilter&&(filter+=","+markerFilter.val()),this._lastFilters!=filter&&(this._lastFilters=filter,ajax.call([{methodname:"mod_assign_list_participants",args:{assignid:assignmentid,groupid:groupid,filter:"",onlyids:!0,tablesort:!0},done:this._usersLoaded.bind(this),fail:notification.exception}]),!0)},GradingNavigation.prototype._usersLoaded=function(users){if(this._firstLoadUsers=!1,this._filteredUsers=this._users=users,this._users.length){var toggleLink=this._region.find('[data-region="user-filters"]');$(document.getElementById(toggleLink.attr("aria-controls"))).find('select[name="filter"]').trigger("change")}else this._selectNoUser();this._triggerNextUserEvent()},GradingNavigation.prototype._checkClickOutsideConfigureFilters=function(event){var configPanel=this._region.find('[data-region="configure-filters"]');if(!configPanel.is(event.target)&&0===configPanel.has(event.target).length){var toggleLink=this._region.find('[data-region="user-filters"]');configPanel.hide(),configPanel.attr("aria-hidden","true"),toggleLink.attr("aria-expanded","false"),$(document).unbind("click.mod_assign_grading_navigation")}},GradingNavigation.prototype._updateFilterPreferences=function(userId,filterList,preferenceNames){var preferences=[],i=0;if(0==filterList.length||this._firstLoadUsers){var deferred=$.Deferred();return deferred.resolve(),deferred}for(i=0;i<filterList.length;i++){var newValue=filterList[i];"none"==newValue&&(newValue=""),preferences.push({userid:userId,name:preferenceNames[i],value:newValue})}return ajax.call([{methodname:"core_user_set_user_preferences",args:{preferences:preferences}}])[0]},GradingNavigation.prototype._filterChanged=function(){var filterPanel=this._region.find('[data-region="configure-filters"]'),filters=filterPanel.find("select"),preferenceNames=[];this._filters=[],filters.each(function(idx,ele){var element=$(ele);this._filters.push(element.val()),preferenceNames.push("assign_"+element.prop("name"))}.bind(this));var filterlist=[];filterPanel.find("option:checked").each((function(idx,ele){filterlist[filterlist.length]=$(ele).text()})),filterlist.length?this._region.find('[data-region="user-filters"] span').text(filterlist.join(", ")):str.get_string("nofilters","mod_assign").done(function(s){this._region.find('[data-region="user-filters"] span').text(s)}.bind(this)).fail(notification.exception);var select=this._region.find("[data-action=change-user]"),currentUserID=select.data("currentuserid");this._updateFilterPreferences(currentUserID,this._filters,preferenceNames).done(function(){if(!this._loadAllUsers()){var userid=parseInt(select.attr("data-selected")),foundIndex=0;$.each(this._filteredUsers,(function(index,user){userid==user.id&&(foundIndex=index)})),this._filteredUsers.length?this._selectUserById(this._filteredUsers[foundIndex].id):this._selectNoUser()}}.bind(this)).fail(notification.exception),this._refreshCount()},GradingNavigation.prototype._selectNoUser=function(){this._isLoading||(checker.checkFormForChanges('[data-region="grade-panel"] .gradeform')?str.get_strings([{key:"unsavedchanges",component:"mod_assign"},{key:"unsavedchangesquestion",component:"mod_assign"},{key:"saveandcontinue",component:"mod_assign"},{key:"cancel",component:"core"}]).done((function(strs){notification.confirm(strs[0],strs[1],strs[2],strs[3],(function(){$(document).trigger("save-changes",-1)}))})):$(document).trigger("user-changed",-1))},GradingNavigation.prototype._selectUserById=function(userid){var select=this._region.find("[data-action=change-user]"),useridnumber=parseInt(userid,10);this._isLoading||(checker.checkFormForChanges('[data-region="grade-panel"] .gradeform')?str.get_strings([{key:"unsavedchanges",component:"mod_assign"},{key:"unsavedchangesquestion",component:"mod_assign"},{key:"saveandcontinue",component:"mod_assign"},{key:"cancel",component:"core"}]).done((function(strs){notification.confirm(strs[0],strs[1],strs[2],strs[3],(function(){$(document).trigger("save-changes",useridnumber)}))})):(select.attr("data-selected",userid),!isNaN(useridnumber)&&useridnumber>0&&$(document).trigger("user-changed",userid)))},GradingNavigation.prototype._toggleExpandFilters=function(event){event.preventDefault();var toggleLink=$(event.target).closest('[data-region="user-filters"]'),expanded="true"==toggleLink.attr("aria-expanded"),configPanel=$(document.getElementById(toggleLink.attr("aria-controls")));expanded?(configPanel.hide(),configPanel.attr("aria-hidden","true"),toggleLink.attr("aria-expanded","false"),$(document).unbind("click.mod_assign_grading_navigation")):(configPanel.css("display","inline-block"),configPanel.attr("aria-hidden","false"),toggleLink.attr("aria-expanded","true"),event.stopPropagation(),$(document).on("click.mod_assign_grading_navigation",this._checkClickOutsideConfigureFilters.bind(this)))},GradingNavigation.prototype._handlePreviousUser=function(e){e.preventDefault();var currentUserId=this._region.find("[data-action=change-user]").attr("data-selected"),i=0,currentIndex=0;for(i=0;i<this._filteredUsers.length;i++)if(this._filteredUsers[i].id==currentUserId){currentIndex=i;break}var count=this._filteredUsers.length,newIndex=currentIndex-1;newIndex<0&&(newIndex=count-1),count&&this._selectUserById(this._filteredUsers[newIndex].id)},GradingNavigation.prototype._handleNextUser=function(e,saved){e.preventDefault();var select=this._region.find("[data-action=change-user]"),currentUserId=select.attr("data-selected"),i=0,currentIndex=0;for(i=0;i<this._filteredUsers.length;i++)if(this._filteredUsers[i].id==currentUserId){currentIndex=i;break}var count=this._filteredUsers.length,newIndex=(currentIndex+1)%count;if(saved&&count){var userid=this._filteredUsers[newIndex].id,useridnumber=parseInt(userid,10);select.attr("data-selected",userid),!isNaN(useridnumber)&&useridnumber>0&&$(document).trigger("user-changed",userid)}else count&&this._selectUserById(this._filteredUsers[newIndex].id)},GradingNavigation.prototype._setCountString=function(x,y){var updateNumber;this._lastXofYUpdate++,updateNumber=this._lastXofYUpdate;var param={x:x,y:y};str.get_string("xofy","mod_assign",param).done(function(s){updateNumber==this._lastXofYUpdate&&this._region.find('[data-region="user-count-summary"]').text(s)}.bind(this)).fail(notification.exception)},GradingNavigation.prototype._refreshCount=function(){var userid=this._region.find("[data-action=change-user]").attr("data-selected"),i=0,currentIndex=0;if(isNaN(userid)||userid<=0)this._region.find('[data-region="user-count"]').hide();else{for(this._region.find('[data-region="user-count"]').show(),i=0;i<this._filteredUsers.length;i++)if(this._filteredUsers[i].id==userid){currentIndex=i;break}var count=this._filteredUsers.length;if(count&&(currentIndex+=1),this._setCountString(currentIndex,count),currentIndex>0){var url=new URL(window.location);if(parseInt(url.searchParams.get("blindid"))>0){var newid=this._filteredUsers[currentIndex-1].recordid;url.searchParams.set("blindid",newid)}else url.searchParams.set("userid",userid);window.history.replaceState({},"",url)}}},GradingNavigation.prototype._refreshSelector=function(event,userid){var select=this._region.find("[data-action=change-user]");userid=parseInt(userid,10),!isNaN(userid)&&userid>0&&select.attr("data-selected",userid),this._refreshCount()},GradingNavigation.prototype._triggerNextUserEvent=function(){this._filteredUsers.length>1?$(document).trigger("next-user",{nextUserId:null,nextUser:!0}):$(document).trigger("next-user",{nextUser:!1})},GradingNavigation.prototype._handleChangeUser=function(){var select=this._region.find("[data-action=change-user]"),userid=parseInt(select.val(),10);this._isLoading||(checker.checkFormForChanges('[data-region="grade-panel"] .gradeform')?str.get_strings([{key:"unsavedchanges",component:"mod_assign"},{key:"unsavedchangesquestion",component:"mod_assign"},{key:"saveandcontinue",component:"mod_assign"},{key:"cancel",component:"core"}]).done((function(strs){notification.confirm(strs[0],strs[1],strs[2],strs[3],(function(){$(document).trigger("save-changes",userid)}))})):!isNaN(userid)&&userid>0&&(select.attr("data-selected",userid),$(document).trigger("user-changed",userid)))},GradingNavigation}));
/**
 * Javascript controller for the "Review" panel at the left of the page.
 *
 * @module     mod_assign/grading_review_panel
 * @package    mod_assign
 * @class      GradingReviewPanel
 * @copyright  2016 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_assign/grading_review_panel",["jquery","mod_assign/grading_events"],(function($,GradingEvents){var GradingReviewPanel=function(){this._region=$('[data-region="review-panel-content"]'),this.registerEventListeners()};return GradingReviewPanel.prototype._region=null,GradingReviewPanel.prototype.getReviewPanel=function(pluginname){return void 0===this._region.data("panel-owner")&&this._region.data("review-panel-plugin",pluginname),this._region.data("review-panel-plugin")==pluginname&&this._region[0]},GradingReviewPanel.prototype.getTogglePanelButton=function(){return this.getPanelElement().find('[data-region="review-panel-toggle"]')},GradingReviewPanel.prototype.getPanelElement=function(){return $('[data-region="review-panel"]')},GradingReviewPanel.prototype.getPanelContentElement=function(){return $('[data-region="review-panel-content"]')},GradingReviewPanel.prototype.togglePanel=function(){this.getPanelElement().hasClass("collapsed")?$(document).trigger(GradingEvents.EXPAND_REVIEW_PANEL):$(document).trigger(GradingEvents.COLLAPSE_REVIEW_PANEL)},GradingReviewPanel.prototype.collapsePanel=function(){this.getPanelElement().addClass("collapsed").removeClass("grade-panel-collapsed"),this.getPanelContentElement().attr("aria-hidden",!0)},GradingReviewPanel.prototype.expandPanel=function(){this.getPanelElement().removeClass("collapsed"),this.getPanelContentElement().removeAttr("aria-hidden")},GradingReviewPanel.prototype.registerEventListeners=function(){var toggleReviewPanelButton=this.getTogglePanelButton();toggleReviewPanelButton.click(function(e){this.togglePanel(),e.preventDefault()}.bind(this)),toggleReviewPanelButton.keydown(function(e){e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||13!==e.keyCode&&32!==e.keyCode||(this.togglePanel(),e.preventDefault())}.bind(this));var docElement=$(document);docElement.on(GradingEvents.COLLAPSE_REVIEW_PANEL,function(){this.collapsePanel()}.bind(this)),docElement.on(GradingEvents.COLLAPSE_GRADE_PANEL,function(){this.expandPanel(),this.getPanelElement().addClass("grade-panel-collapsed")}.bind(this)),docElement.on(GradingEvents.EXPAND_REVIEW_PANEL,function(){this.expandPanel()}.bind(this)),docElement.on(GradingEvents.EXPAND_GRADE_PANEL,function(){this.getPanelElement().removeClass("grade-panel-collapsed")}.bind(this))},GradingReviewPanel}));
/**
 * Events for the grading interface.
 *
 * @module     mod_assign/grading_events
 * @package    mod_assign
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_assign/grading_events",(function(){return{COLLAPSE_REVIEW_PANEL:"grading:collapse-review-panel",EXPAND_REVIEW_PANEL:"grading:expand-review-panel",COLLAPSE_GRADE_PANEL:"grading:collapse-grade-panel",EXPAND_GRADE_PANEL:"grading:expand-grade-panel"}}));
define("mod_assign/override_form",["exports","jquery"],(function(_exports,_jquery){var obj;
/**
   * A javascript module to enhance the override form.
   *
   * @copyright  2019 Ryan Wyllie <ryan@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};_exports.init=function(formId,selectElementName){var form=document.getElementById(formId),selectElement=form.querySelector('[name="'.concat(selectElementName,'"]'));(0,_jquery.default)(selectElement).on("change",(function(){var inputElement=document.createElement("input");inputElement.setAttribute("type","hidden"),inputElement.setAttribute("name","userchange"),inputElement.setAttribute("value",!0),form.appendChild(inputElement),void 0!==M.core_formchangechecker&&M.core_formchangechecker.reset_form_dirty_state(),form.submit()}))}}));
/**
 * Simple method to check for changes to a form between two points in time.
 *
 * @module     mod_assign/grading_form_change_checker
 * @package    mod_assign
 * @copyright  2016 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_assign/grading_form_change_checker",["jquery"],(function($){return{saveFormState:function(selector){$(selector).trigger("save-form-state");var data=$(selector).serialize();$(selector).data("saved-form-state",data)},checkFormForChanges:function(selector){$(selector).trigger("save-form-state");var data=$(selector).serialize(),previousdata=$(selector).data("saved-form-state");return void 0!==previousdata&&previousdata!=data}}}));
/**
 * Custom auto-complete adapter to load users from the assignment list_participants webservice.
 *
 * @module     mod_assign/participants_selector
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_assign/participant_selector",["core/ajax","jquery","core/templates"],(function(ajax,$,templates){return{processResults:function(selector,data){return data},transport:function(selector,query,success,failure){var assignmentid=$(selector).attr("data-assignmentid"),groupid=$(selector).attr("data-groupid"),filters=$('[data-region="configure-filters"] input[type="checkbox"]'),filterstrings=[];filters.each((function(index,element){filterstrings[$(element).attr("name")]=$(element).prop("checked")})),ajax.call([{methodname:"mod_assign_list_participants",args:{assignid:assignmentid,groupid:groupid,filter:query,limit:30,includeenrolments:!1,tablesort:!0}}])[0].then((function(results){var promises=[],identityfields=$("[data-showuseridentity]").data("showuseridentity").split(",");return $.each(results,(function(index,user){var ctx=user,identity=[],show=!0;filterstrings.filter_submitted&&!user.submitted&&(show=!1),filterstrings.filter_notsubmitted&&user.submitted&&(show=!1),filterstrings.filter_requiregrading&&!user.requiregrading&&(show=!1),filterstrings.filter_grantedextension&&!user.grantedextension&&(show=!1),show&&($.each(identityfields,(function(i,k){void 0!==user[k]&&""!==user[k]&&(ctx.hasidentity=!0,identity.push(user[k]))})),ctx.identity=identity.join(", "),promises.push(templates.render("mod_assign/list_participant_user_summary",ctx).then((function(html){return{value:user.id,label:html}}))))})),$.when.apply($,promises)})).then((function(){var users=[];arguments[0]&&(users=Array.prototype.slice.call(arguments)),success(users)})).catch(failure)}}}));
/**
 * Javascript controller for the "Grading" panel at the right of the page.
 *
 * @module     mod_assign/grading_panel
 * @package    mod_assign
 * @class      GradingPanel
 * @copyright  2016 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_assign/grading_panel",["jquery","core/yui","core/notification","core/templates","core/fragment","core/ajax","core/str","mod_assign/grading_form_change_checker","mod_assign/grading_events","core/event"],(function($,Y,notification,templates,fragment,ajax,str,checker,GradingEvents,Event){var GradingPanel=function(selector){this._regionSelector=selector,this._region=$(selector),this._userCache=[],this.registerEventListeners()};return GradingPanel.prototype._regionSelector=null,GradingPanel.prototype._lastUserId=0,GradingPanel.prototype._lastAttemptNumber=-1,GradingPanel.prototype._region=null,GradingPanel.prototype.nextUserId=null,GradingPanel.prototype.nextUser=!1,GradingPanel.prototype._niceReplaceNodeContents=function(node,html,js){var promise=$.Deferred();return node.fadeOut("fast",(function(){templates.replaceNodeContents(node,html,js),node.fadeIn("fast",(function(){promise.resolve()}))})),promise.promise()},GradingPanel.prototype._saveFormState=function(){var checked=$('[data-region="grading-actions-form"] [name="sendstudentnotifications"]').prop("checked");$('.gradeform [name="sendstudentnotifications"]').val(checked)},GradingPanel.prototype._submitForm=function(event,nextUserId,nextUser){var form=$(this._region.find("form.gradeform"));$('[data-region="overlay"]').show(),form.trigger("save-form-state"),Event.notifyFormSubmitAjax(form[0]);var data=form.serialize(),assignmentid=this._region.attr("data-assignmentid");ajax.call([{methodname:"mod_assign_submit_grading_form",args:{assignmentid:assignmentid,userid:this._lastUserId,jsonformdata:JSON.stringify(data)},done:this._handleFormSubmissionResponse.bind(this,data,nextUserId,nextUser),fail:notification.exception}])},GradingPanel.prototype._handleFormSubmissionResponse=function(formdata,nextUserId,nextUser,response){void 0===nextUserId&&(nextUserId=this._lastUserId),response.length?$(document).trigger("reset",[this._lastUserId,formdata]):(str.get_strings([{key:"changessaved",component:"core"},{key:"gradechangessaveddetail",component:"mod_assign"}]).done((function(strs){notification.alert(strs[0],strs[1])})).fail(notification.exception),Y.use("moodle-core-formchangechecker",(function(){M.core_formchangechecker.reset_form_dirty_state()})),nextUserId==this._lastUserId?$(document).trigger("reset",nextUserId):nextUser?$(document).trigger("done-saving-show-next",!0):$(document).trigger("user-changed",nextUserId)),$('[data-region="overlay"]').hide()},GradingPanel.prototype._resetForm=function(e,userid,formdata){var event=$.Event("custom");void 0===userid&&(userid=this._lastUserId),this._lastUserId=0,this._refreshGradingPanel(event,userid,formdata)},GradingPanel.prototype._chooseAttempt=function(e){var submissionsId=$(e.target).data("submissions"),formhtml=$(document.getElementById(submissionsId)).clone().wrap($("<form/>")).html();str.get_strings([{key:"viewadifferentattempt",component:"mod_assign"},{key:"view",component:"core"},{key:"cancel",component:"core"}]).done(function(strs){notification.confirm(strs[0],formhtml,strs[1],strs[2],function(){var attemptnumber=$("input:radio[name='select-attemptnumber']:checked").val();this._refreshGradingPanel(null,this._lastUserId,"",attemptnumber)}.bind(this))}.bind(this)).fail(notification.exception)},GradingPanel.prototype._addPopoutButtons=function(selector){var region=$(selector);templates.render("mod_assign/popout_button",{}).done(function(html){region.find('[data-fieldtype="filemanager"],[data-fieldtype="editor"],[data-fieldtype="grading"]').closest(".fitem").addClass("has-popout").find("label").parent().append(html),region.on("click",'[data-region="popout-button"]',this._togglePopout.bind(this))}.bind(this)).fail(notification.exception)},GradingPanel.prototype._togglePopout=function(event){event.preventDefault();var container=$(event.target).closest(".fitem");container.hasClass("popout")?$(".popout").removeClass("popout"):($(".popout").removeClass("popout"),container.addClass("popout"),container.addClass("moodle-has-zindex"))},GradingPanel.prototype._refreshGradingPanel=function(event,userid,submissiondata,attemptnumber){var contextid=this._region.attr("data-contextid");void 0===submissiondata&&(submissiondata=""),void 0===attemptnumber&&(attemptnumber=-1),this._lastUserId==userid&&this._lastAttemptNumber==attemptnumber&&""===submissiondata||(this._lastUserId=userid,this._lastAttemptNumber=attemptnumber,$(document).trigger("start-loading-user"),window.M.util.js_pending("mod-assign-loading-user"),templates.render("mod_assign/loading",{}).done(function(html,js){this._niceReplaceNodeContents(this._region,html,js).done(function(){if(userid>0){this._region.show();var params={userid:userid,attemptnumber:attemptnumber,jsonformdata:JSON.stringify(submissiondata)};fragment.loadFragment("mod_assign","gradingpanel",contextid,params).done(function(html,js){this._niceReplaceNodeContents(this._region,html,js).done(function(){checker.saveFormState('[data-region="grade-panel"] .gradeform'),$(document).on("editor-content-restored",(function(){checker.saveFormState('[data-region="grade-panel"] .gradeform')})),$('[data-region="attempt-chooser"]').on("click",this._chooseAttempt.bind(this)),this._addPopoutButtons('[data-region="grade-panel"] .gradeform'),$(document).trigger("finish-loading-user"),window.M.util.js_complete("mod-assign-loading-user")}.bind(this)).fail(notification.exception)}.bind(this)).fail(notification.exception),$('[data-region="review-panel"]').show()}else this._region.hide(),$('[data-region="review-panel"]').hide(),$(document).trigger("finish-loading-user"),window.M.util.js_complete("mod-assign-loading-user")}.bind(this))}.bind(this)).fail(notification.exception))},GradingPanel.prototype._getNextUser=function(event,data){this.nextUserId=data.nextUserId,this.nextUser=data.nextUser},GradingPanel.prototype._handleSaveAndShowNext=function(){this._submitForm(null,this.nextUserId,this.nextUser)},GradingPanel.prototype.getPanelElement=function(){return $('[data-region="grade-panel"]')},GradingPanel.prototype.collapsePanel=function(){this.getPanelElement().addClass("collapsed")},GradingPanel.prototype.expandPanel=function(){this.getPanelElement().removeClass("collapsed")},GradingPanel.prototype.registerEventListeners=function(){var docElement=$(document);$(this._region).on("submit","form",(function(e){e.preventDefault()})),docElement.on("next-user",this._getNextUser.bind(this)),docElement.on("user-changed",this._refreshGradingPanel.bind(this)),docElement.on("save-changes",this._submitForm.bind(this)),docElement.on("save-and-show-next",this._handleSaveAndShowNext.bind(this)),docElement.on("reset",this._resetForm.bind(this)),docElement.on("save-form-state",this._saveFormState.bind(this)),docElement.on(GradingEvents.COLLAPSE_GRADE_PANEL,function(){this.collapsePanel()}.bind(this)),docElement.on(GradingEvents.COLLAPSE_REVIEW_PANEL,function(){this.expandPanel()}.bind(this)),docElement.on(GradingEvents.EXPAND_GRADE_PANEL,function(){this.expandPanel()}.bind(this))},GradingPanel}));
/**
 * Javascript controller for the "User summary" panel at the top of the page.
 *
 * @module     mod_assign/grading_navigation_user_info
 * @package    mod_assign
 * @class      UserInfo
 * @copyright  2016 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_assign/grading_navigation_user_info",["jquery","core/notification","core/ajax","core/templates"],(function($,notification,ajax,templates){var UserInfo=function(selector){this._regionSelector=selector,this._region=$(selector),this._userCache={},$(document).on("user-changed",this._refreshUserInfo.bind(this))};return UserInfo.prototype._regionSelector=null,UserInfo.prototype._userCache=null,UserInfo.prototype._region=null,UserInfo.prototype._lastUserId=0,UserInfo.prototype._getAssignmentId=function(){return this._region.attr("data-assignmentid")},UserInfo.prototype._refreshUserInfo=function(event,userid){var promise=$.Deferred();this._region.attr("data-userid",userid),this._lastUserId!=userid&&(this._lastUserId=userid,templates.render("mod_assign/loading",{}).done(function(html,js){if(this._region.fadeOut("fast",function(){templates.replaceNodeContents(this._region,html,js),this._region.fadeIn("fast")}.bind(this)),userid<0)templates.render("mod_assign/grading_navigation_no_users",{}).done(function(html,js){userid==this._lastUserId&&this._region.fadeOut("fast",function(){templates.replaceNodeContents(this._region,html,js),this._region.fadeIn("fast")}.bind(this))}.bind(this)).fail(notification.exception);else{if(void 0!==this._userCache[userid])promise.resolve(this._userCache[userid]);else{var assignmentId=this._getAssignmentId();ajax.call([{methodname:"mod_assign_get_participant",args:{userid:userid,assignid:assignmentId,embeduser:!0}}])[0].done(function(participant){participant.hasOwnProperty("id")?(this._userCache[userid]=participant,promise.resolve(this._userCache[userid])):promise.reject("No users")}.bind(this)).fail(notification.exception)}promise.done(function(context){var identityfields=$("[data-showuseridentity]").data("showuseridentity").split(","),identity=[];context.courseid=$('[data-region="grading-navigation-panel"]').attr("data-courseid"),context.user&&($.each(identityfields,(function(i,k){void 0!==context.user[k]&&""!==context.user[k]&&(context.hasidentity=!0,identity.push(context.user[k]))})),context.identity=identity.join(", "),context.user.profileimageurl&&(context.profileimageurl=context.user.profileimageurl)),templates.render("mod_assign/grading_navigation_user_summary",context).done(function(html,js){userid==this._lastUserId&&this._region.fadeOut("fast",function(){templates.replaceNodeContents(this._region,html,js),this._region.fadeIn("fast")}.bind(this))}.bind(this)).fail(notification.exception)}.bind(this)).fail(function(){templates.render("mod_assign/grading_navigation_no_users",{}).done(function(html,js){this._region.fadeOut("fast",function(){templates.replaceNodeContents(this._region,html,js),this._region.fadeIn("fast")}.bind(this))}.bind(this)).fail(notification.exception)}.bind(this))}}.bind(this)).fail(notification.exception))},UserInfo}));
/**
 * Javascript controller for the "Actions" panel at the bottom of the page.
 *
 * @module     mod_assign/grading_actions
 * @package    mod_assign
 * @class      GradingActions
 * @copyright  2016 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_assign/grading_actions",["jquery","mod_assign/grading_events"],(function($,GradingEvents){var GradingActions=function(selector){this._regionSelector=selector,this._region=$(selector),this.registerEventListeners()};return GradingActions.prototype._regionSelector=null,GradingActions.prototype._lastUserId=0,GradingActions.prototype._region=null,GradingActions.prototype._showActionsForm=function(event,userid){var form=this._region.find("[data-region=grading-actions-form]");userid!=this._lastUserId&&userid>0&&(this._lastUserId=userid),userid>0?form.removeClass("hide"):form.addClass("hide")},GradingActions.prototype._trigger=function(action){$(document).trigger(action)},GradingActions.prototype.getReviewPanelElement=function(){return $('[data-region="review-panel"]')},GradingActions.prototype.hasReviewPanelElement=function(){return this.getReviewPanelElement().length>0},GradingActions.prototype.getCollapseGradePanelButton=function(){return $('[data-region="grade-actions"] .collapse-grade-panel')},GradingActions.prototype.getCollapseReviewPanelButton=function(){return $('[data-region="grade-actions"] .collapse-review-panel')},GradingActions.prototype.getExpandAllPanelsButton=function(){return $('[data-region="grade-actions"] .collapse-none')},GradingActions.prototype.resetLayoutButtons=function(){this.getCollapseGradePanelButton().removeClass("active"),this.getCollapseReviewPanelButton().removeClass("active"),this.getExpandAllPanelsButton().removeClass("active")},GradingActions.prototype.collapseReviewPanel=function(){$(document).trigger(GradingEvents.COLLAPSE_REVIEW_PANEL),$(document).trigger(GradingEvents.EXPAND_GRADE_PANEL),this.resetLayoutButtons(),this.getCollapseReviewPanelButton().addClass("active")},GradingActions.prototype.collapseGradePanel=function(){$(document).trigger(GradingEvents.COLLAPSE_GRADE_PANEL),$(document).trigger(GradingEvents.EXPAND_REVIEW_PANEL),this.resetLayoutButtons(),this.getCollapseGradePanelButton().addClass("active")},GradingActions.prototype.expandAllPanels=function(){$(document).trigger(GradingEvents.EXPAND_GRADE_PANEL),$(document).trigger(GradingEvents.EXPAND_REVIEW_PANEL),this.resetLayoutButtons(),this.getExpandAllPanelsButton().addClass("active")},GradingActions.prototype.registerEventListeners=function(){if(this.hasReviewPanelElement()){var collapseReviewPanelButton=this.getCollapseReviewPanelButton();collapseReviewPanelButton.click(function(e){this.collapseReviewPanel(),e.preventDefault()}.bind(this)),collapseReviewPanelButton.keydown(function(e){e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||13!==e.keyCode&&32!==e.keyCode||(this.collapseReviewPanel(),e.preventDefault())}.bind(this));var collapseGradePanelButton=this.getCollapseGradePanelButton();collapseGradePanelButton.click(function(e){this.collapseGradePanel(),e.preventDefault()}.bind(this)),collapseGradePanelButton.keydown(function(e){e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||13!==e.keyCode&&32!==e.keyCode||(this.collapseGradePanel(),e.preventDefault())}.bind(this));var expandAllPanelsButton=this.getExpandAllPanelsButton();expandAllPanelsButton.click(function(e){this.expandAllPanels(),e.preventDefault()}.bind(this)),expandAllPanelsButton.keydown(function(e){e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||13!==e.keyCode&&32!==e.keyCode||(this.expandAllPanels(),e.preventDefault())}.bind(this))}$(document).on("user-changed",this._showActionsForm.bind(this)),this._region.find('[name="savechanges"]').on("click",this._trigger.bind(this,"save-changes")),this._region.find('[name="saveandshownext"]').on("click",this._trigger.bind(this,"save-and-show-next")),this._region.find('[name="resetbutton"]').on("click",this._trigger.bind(this,"reset")),this._region.find("form").on("submit",(function(e){e.preventDefault()}))},GradingActions}));
define ("mod_customcert/dialogue",["core/yui"],function(a){var b=function(b,c,d,e,f){this.yuiDialogue=null;var g=this;if("undefined"==typeof f){f=!1}a.use("moodle-core-notification","timers",function(){var h="480px";if(f){h="800px"}g.yuiDialogue=new M.core.dialogue({headerContent:b,bodyContent:c,draggable:!0,visible:!1,center:!0,modal:!0,width:h});g.yuiDialogue.after("visibleChange",function(b){if(b.newVal){if("undefined"!=typeof d){a.soon(function(){d(g);g.yuiDialogue.centerDialogue()})}}else{if("undefined"!=typeof e){a.soon(function(){e(g)})}}});g.yuiDialogue.show()})};b.prototype.close=function(){this.yuiDialogue.hide();this.yuiDialogue.destroy()};b.prototype.getContent=function(){return this.yuiDialogue.bodyNode.getDOMNode()};return b});
define ("mod_customcert/rearrange-area",["jquery","core/yui","core/fragment","mod_customcert/dialogue","core/notification","core/str","core/templates","core/ajax"],function(a,b,c,d,f,g,h,i){var j=function(b){this._node=a(b);this._setEvents()};j.prototype.CUSTOMCERT_REF_POINT_TOPLEFT=0;j.prototype.CUSTOMCERT_REF_POINT_TOPCENTER=1;j.prototype.CUSTOMCERT_REF_POINT_TOPRIGHT=2;j.prototype.PIXELSINMM=3.779527559055;j.prototype._setEvents=function(){this._node.on("click",".element",this._editElement.bind(this))};j.prototype._editElement=function(a){var e=a.currentTarget.id.substr(8),h=this._node.attr("data-contextid");c.loadFragment("mod_customcert","editelement",h,{elementid:e}).done(function(a,c){g.get_string("editelement","mod_customcert").done(function(f){b.use("moodle-core-formchangechecker",function(){new d(f,"<div id='elementcontent'></div>",this._editElementDialogueConfig.bind(this,e,a,c),void 0,!0)}.bind(this))}.bind(this))}.bind(this)).fail(f.exception)};j.prototype._editElementDialogueConfig=function(b,c,d,g){h.replaceNode("#elementcontent",c,d);this._setPositionInForm(b);var i=a(g.getContent());i.on("click","#id_submitbutton",function(c){M.core_formchangechecker.reset_form_dirty_state();this._saveElement(b).then(function(){this._getElementHTML(b).done(function(c){var d=this._node.find("#element-"+b),e=parseInt(a("#id_refpoint").val()),f="";if(e==this.CUSTOMCERT_REF_POINT_TOPLEFT){f="refpoint-left"}else if(e==this.CUSTOMCERT_REF_POINT_TOPCENTER){f="refpoint-center"}else if(e==this.CUSTOMCERT_REF_POINT_TOPRIGHT){f="refpoint-right"}d.empty().append(c);d.removeClass();d.addClass("element "+f);d.attr("data-refpoint",e);var h=a("#editelementform #id_posx").val(),i=a("#editelementform #id_posy").val();this._setPosition(b,e,h,i);g.close()}.bind(this))}.bind(this)).fail(f.exception);c.preventDefault()}.bind(this));i.on("click","#id_cancel",function(a){g.close();a.preventDefault()})};j.prototype._setPosition=function(a,c,d,e){var f=b.one("#element-"+a);d=b.one("#pdf").getX()+d*this.PIXELSINMM;e=b.one("#pdf").getY()+e*this.PIXELSINMM;var g=parseFloat(f.getComputedStyle("width")),h=f.width*this.PIXELSINMM;if(h&&g>h){g=h}switch(c){case this.CUSTOMCERT_REF_POINT_TOPCENTER:d-=g/2;break;case this.CUSTOMCERT_REF_POINT_TOPRIGHT:d=d-g+2;break;}f.setX(d);f.setY(e)};j.prototype._setPositionInForm=function(c){var d=a("#editelementform #id_posx"),e=a("#editelementform #id_posy");if(d.length&&e.length){var f=b.one("#element-"+c),g=f.getX()-b.one("#pdf").getX(),h=f.getY()-b.one("#pdf").getY(),i=parseInt(f.getData("refpoint")),j=parseFloat(f.getComputedStyle("width"));switch(i){case this.CUSTOMCERT_REF_POINT_TOPCENTER:g+=j/2;break;case this.CUSTOMCERT_REF_POINT_TOPRIGHT:g+=j;break;}g=Math.round(parseFloat(g/this.PIXELSINMM));h=Math.round(parseFloat(h/this.PIXELSINMM));d.val(g);e.val(h)}};j.prototype._getElementHTML=function(a){var b=this._node.attr("data-templateid"),c=i.call([{methodname:"mod_customcert_get_element_html",args:{templateid:b,elementid:a}}]);return c[0]};j.prototype._saveElement=function(b){var c=this._node.attr("data-templateid"),d=a("#editelementform").serializeArray(),e=i.call([{methodname:"mod_customcert_save_element",args:{templateid:c,elementid:b,values:d}}]);return e[0]};return{init:function init(a){new j(a)}}});
define("mod_feedback/edit",["jquery","core/ajax","core/str","core/notification"],(function($,ajax,str,notification){var manager={deleteItem:function(e){e.preventDefault();var targetUrl=$(e.currentTarget).attr("href");str.get_strings([{key:"confirmation",component:"admin"},{key:"confirmdeleteitem",component:"mod_feedback"},{key:"yes",component:"moodle"},{key:"no",component:"moodle"}]).then((function(s){notification.confirm(s[0],s[1],s[2],s[3],(function(){window.location=targetUrl}))})).catch()},setup:function(){$("body").delegate('[data-action="delete"]',"click",manager.deleteItem)}};return{setup:manager.setup}}));
/**
 * Module for the list of discussions on when viewing a forum.
 *
 * @module     mod_forum/discussion_list
 * @package    mod_forum
 * @copyright  2019 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_forum/discussion_list",["jquery","core/templates","core/str","core/notification","mod_forum/subscription_toggle","mod_forum/selectors","mod_forum/repository","core/pubsub","mod_forum/forum_events"],(function($,Templates,Str,Notification,SubscriptionToggle,Selectors,Repository,PubSub,ForumEvents){return{init:function(root){SubscriptionToggle.init(root,!1,(function(toggleElement,context){var toggleId=toggleElement.attr("id"),newTargetState=context.userstate.subscribed?0:1;toggleElement.data("targetstate",newTargetState);var stringKey=context.userstate.subscribed?"unsubscribediscussion":"subscribediscussion";return Str.get_string(stringKey,"mod_forum").then((function(string){return toggleElement.closest("td").find('label[for="'+toggleId+'"]').find("span").text(string),string}))})),function(root){PubSub.subscribe(ForumEvents.SUBSCRIPTION_TOGGLED,(function(data){var discussionId=data.discussionId,subscribed=data.subscriptionState,discussionListItem=root.find(Selectors.discussion.item+"[data-discussionid= "+discussionId+"]"),subscribedLabel=discussionListItem.find(Selectors.discussion.subscribedLabel);subscribed?(discussionListItem.addClass("subscribed"),subscribedLabel.removeAttr("hidden")):(discussionListItem.removeClass("subscribed"),subscribedLabel.attr("hidden",!0))})),root.on("click",Selectors.favourite.toggle,(function(){var toggleElement=$(this),forumId=toggleElement.data("forumid"),discussionId=toggleElement.data("discussionid"),subscriptionState=toggleElement.data("targetstate");Repository.setFavouriteDiscussionState(forumId,discussionId,subscriptionState).then((function(){return location.reload()})).catch(Notification.exception)})),root.on("click",Selectors.pin.toggle,(function(e){e.preventDefault();var toggleElement=$(this),forumId=toggleElement.data("forumid"),discussionId=toggleElement.data("discussionid"),state=toggleElement.data("targetstate");Repository.setPinDiscussionState(forumId,discussionId,state).then((function(){return location.reload()})).catch(Notification.exception)})),root.on("click",Selectors.lock.toggle,(function(e){var toggleElement=$(this),forumId=toggleElement.data("forumid"),discussionId=toggleElement.data("discussionid"),state=toggleElement.data("state");Repository.setDiscussionLockState(forumId,discussionId,state).then((function(context){var icon=toggleElement.parents(Selectors.summary.actions).find(Selectors.lock.icon),lockedLabel=toggleElement.parents(Selectors.discussion.item).find(Selectors.discussion.lockedLabel);return context.locked?(icon.removeClass("hidden"),lockedLabel.removeAttr("hidden")):(icon.addClass("hidden"),lockedLabel.attr("hidden",!0)),context})).then((function(context){return context.forumid=forumId,Templates.render("mod_forum/discussion_lock_toggle",context)})).then((function(html,js){return Templates.replaceNode(toggleElement,html,js)})).then((function(){return Str.get_string("lockupdated","forum").done((function(s){return Notification.addNotification({message:s,type:"info"})}))})).catch(Notification.exception),e.preventDefault()}))}(root)}}}));
/**
 * Module for viewing a discussion.
 *
 * @module     mod_forum/discussion_list
 * @package    mod_forum
 * @copyright  2019 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_forum/discussion",["jquery","core/custom_interaction_events","mod_forum/selectors","core/pubsub","mod_forum/forum_events","core/str","core/notification"],(function($,CustomEvents,Selectors,PubSub,ForumEvents,String,Notification){var isElementInInPageReplySection=function(element){return!!$(element).closest(Selectors.post.inpageReplyContent).length},initAccessibilityKeyboardNav=function(root){root.find(Selectors.post.post).each((function(index,post){var actions=$(post).find(Selectors.post.action),firstAction=actions.first();actions.attr("tabindex","-1"),firstAction.attr("tabindex",0)})),CustomEvents.define(root,[CustomEvents.events.up,CustomEvents.events.down,CustomEvents.events.next,CustomEvents.events.previous,CustomEvents.events.home,CustomEvents.events.end]),root.on(CustomEvents.events.up,(function(e,data){var activeElement=document.activeElement;if(!isElementInInPageReplySection(activeElement)){var focusPost=$(activeElement).closest(Selectors.post.post);focusPost.length?function(currentPost){var prevPost=currentPost.prev(Selectors.post.post);if(prevPost.length){var replyPost=prevPost.find(Selectors.post.post).last();replyPost.length?replyPost.focus():prevPost.focus()}else currentPost.parents(Selectors.post.post).first().focus()}(focusPost):root.find(Selectors.post.post).first().focus(),data.originalEvent.preventDefault()}})),root.on(CustomEvents.events.down,(function(e,data){var activeElement=document.activeElement;if(!isElementInInPageReplySection(activeElement)){var focusPost=$(activeElement).closest(Selectors.post.post);focusPost.length?function(currentPost){var replyPost=currentPost.find(Selectors.post.post).first();if(replyPost.length)replyPost.focus();else{var siblingPost=currentPost.next(Selectors.post.post);if(siblingPost.length)siblingPost.focus();else for(var parentPosts=currentPost.parents(Selectors.post.post).toArray(),i=0;i<parentPosts.length;i++){var ancestorSiblingPost=$(parentPosts[i]).next(Selectors.post.post);if(ancestorSiblingPost.length){ancestorSiblingPost.focus();break}}}}(focusPost):root.find(Selectors.post.post).first().focus(),data.originalEvent.preventDefault()}})),root.on(CustomEvents.events.home,(function(e,data){isElementInInPageReplySection(document.activeElement)||(root.find(Selectors.post.post).first().focus(),data.originalEvent.preventDefault())})),root.on(CustomEvents.events.end,(function(e,data){isElementInInPageReplySection(document.activeElement)||(root.find(Selectors.post.post).last().focus(),data.originalEvent.preventDefault())})),root.on(CustomEvents.events.next,Selectors.post.action,(function(e,data){var currentAction=$(e.target),actions=currentAction.closest(Selectors.post.actionsContainer).find(Selectors.post.action),nextAction=currentAction.next(Selectors.post.action);actions.attr("tabindex","-1"),nextAction.length||(nextAction=actions.first()),nextAction.attr("tabindex",0),nextAction.focus(),data.originalEvent.preventDefault()})),root.on(CustomEvents.events.previous,Selectors.post.action,(function(e,data){var currentAction=$(e.target),actions=currentAction.closest(Selectors.post.actionsContainer).find(Selectors.post.action),nextAction=currentAction.prev(Selectors.post.action);actions.attr("tabindex","-1"),nextAction.length||(nextAction=actions.last()),nextAction.attr("tabindex",0),nextAction.focus(),data.originalEvent.preventDefault()})),root.on(CustomEvents.events.home,Selectors.post.action,(function(e,data){var actions=$(e.target).closest(Selectors.post.actionsContainer).find(Selectors.post.action),firstAction=actions.first();actions.attr("tabindex","-1"),firstAction.attr("tabindex",0),firstAction.focus(),e.stopPropagation(),data.originalEvent.preventDefault()})),root.on(CustomEvents.events.end,Selectors.post.action,(function(e,data){var actions=$(e.target).closest(Selectors.post.actionsContainer).find(Selectors.post.action),lastAction=actions.last();actions.attr("tabindex","-1"),lastAction.attr("tabindex",0),lastAction.focus(),e.stopPropagation(),data.originalEvent.preventDefault()})),PubSub.subscribe(ForumEvents.SUBSCRIPTION_TOGGLED,(function(data){var updateMessage=data.subscriptionState?"discussionsubscribed":"discussionunsubscribed";String.get_string(updateMessage,"forum").then((function(s){return Notification.addNotification({message:s,type:"info"})})).catch(Notification.exception)}))};return{init:function(root){initAccessibilityKeyboardNav(root)}}}));
define("mod_forum/discussion_nested_v2",["exports","jquery","core/auto_rows","core/custom_interaction_events","core/notification","core/templates","mod_forum/discussion","mod_forum/inpage_reply","mod_forum/lock_toggle","mod_forum/favourite_toggle","mod_forum/pin_toggle","mod_forum/selectors","mod_forum/subscription_toggle"],(function(_exports,_jquery,_auto_rows,_custom_interaction_events,_notification,_templates,_discussion,_inpage_reply,_lock_toggle,_favourite_toggle,_pin_toggle,_selectors,_subscription_toggle){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_auto_rows=_interopRequireDefault(_auto_rows),_custom_interaction_events=_interopRequireDefault(_custom_interaction_events),_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates),_discussion=_interopRequireDefault(_discussion),_inpage_reply=_interopRequireDefault(_inpage_reply),_lock_toggle=_interopRequireDefault(_lock_toggle),_favourite_toggle=_interopRequireDefault(_favourite_toggle),_pin_toggle=_interopRequireDefault(_pin_toggle),_selectors=_interopRequireDefault(_selectors),_subscription_toggle=_interopRequireDefault(_subscription_toggle);var _systemImportTransformerGlobalIdentifier="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}var getPostContainer=function(element){return element.closest(_selectors.default.post.post)},getPostContainerById=function(element,id){return element.find("".concat(_selectors.default.post.post,"[data-post-id=").concat(id,"]"))},getPostContentContainer=function(postContainer){return postContainer.children().not(_selectors.default.post.repliesContainer).find(_selectors.default.post.forumCoreContent)},getInPageReplyContainer=function(postContainer){return postContainer.children().filter(_selectors.default.post.inpageReplyContainer)},getInPageReplyForm=function(postContainer){return getInPageReplyContainer(postContainer).find(_selectors.default.post.inpageReplyContent)},getInPageReplyCreateButton=function(postContainer){return getPostContentContainer(postContainer).find(_selectors.default.post.inpageReplyCreateButton)},getRepliesVisibilityToggleContainer=function(postContainer){return postContainer.children(_selectors.default.post.repliesVisibilityToggleContainer)},getRepliesContainer=function(postContainer){return postContainer.children(_selectors.default.post.repliesContainer)},hasReplies=function(postContainer){return getRepliesContainer(postContainer).children().length>0},getShowRepliesButton=function(replyVisibilityToggleContainer){return replyVisibilityToggleContainer.find(_selectors.default.post.showReplies)},getHideRepliesButton=function(replyVisibilityToggleContainer){return replyVisibilityToggleContainer.find(_selectors.default.post.hideReplies)},repliesVisible=function(postContainer){return getRepliesContainer(postContainer).is(":visible")},showReplies=function(postContainer){var postIdToSee=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,repliesContainer=getRepliesContainer(postContainer),replyVisibilityToggleContainer=getRepliesVisibilityToggleContainer(postContainer),showButton=getShowRepliesButton(replyVisibilityToggleContainer),hideButton=getHideRepliesButton(replyVisibilityToggleContainer);showButton.addClass("hidden"),hideButton.removeClass("hidden"),repliesContainer.slideDown({duration:150,queue:!1,complete:function(){if(postIdToSee){var postContainerToSee=getPostContainerById(repliesContainer,postIdToSee);postContainerToSee.length&&postContainerToSee[0].scrollIntoView()}}}).css("display","none").fadeIn(150)},hideReplies=function(postContainer){var repliesContainer=getRepliesContainer(postContainer),replyVisibilityToggleContainer=getRepliesVisibilityToggleContainer(postContainer),showButton=getShowRepliesButton(replyVisibilityToggleContainer),hideButton=getHideRepliesButton(replyVisibilityToggleContainer);showButton.removeClass("hidden"),hideButton.addClass("hidden"),repliesContainer.slideUp({duration:150,queue:!1}).fadeOut(150)},showInPageReplyForm=null,buildShowInPageReplyFormFunction=function(additionalTemplateContext){return fn=regeneratorRuntime.mark((function _callee(postContainer){var inPageReplyContainer,repliesVisibilityToggleContainer,inPageReplyCreateButton,html;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(inPageReplyContainer=getInPageReplyContainer(postContainer),repliesVisibilityToggleContainer=getRepliesVisibilityToggleContainer(postContainer),inPageReplyCreateButton=getInPageReplyCreateButton(postContainer),hasInPageReplyForm(inPageReplyContainer)){_context.next=15;break}return _context.prev=4,_context.next=7,renderInPageReplyTemplate(additionalTemplateContext,inPageReplyCreateButton,postContainer);case 7:html=_context.sent,_templates.default.appendNodeContents(inPageReplyContainer,html,""),_context.next=14;break;case 11:_context.prev=11,_context.t0=_context.catch(4),_notification.default.exception(_context.t0);case 14:("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core/yui"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core/yui")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core/yui"])).then((function(Y){return new Promise((function(resolve){Y.use("moodle-core-formchangechecker",(function(Y){resolve(Y)}))}))})).then((function(Y){return M.core_formchangechecker.init({formid:Y.one(postContainer[0].querySelector("form")).generateID()}),Y})).catch();case 15:inPageReplyCreateButton.fadeOut(150,(function(){var inPageReplyForm=getInPageReplyForm(postContainer);inPageReplyForm.slideDown({duration:150,queue:!1,complete:function(){inPageReplyForm.find("textarea").focus()}}).css("display","none").fadeIn(150),repliesVisibilityToggleContainer.length&&hasReplies(postContainer)&&(repliesVisibilityToggleContainer.fadeIn(150),hideReplies(postContainer))}));case 16:case"end":return _context.stop()}}),_callee,null,[[4,11]])})),_ref=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(_x){return _ref.apply(this,arguments)};var fn,_ref},hideInPageReplyForm=function(postContainer){var postIdToSee=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,inPageReplyForm=getInPageReplyForm(postContainer),inPageReplyCreateButton=getInPageReplyCreateButton(postContainer),repliesVisibilityToggleContainer=getRepliesVisibilityToggleContainer(postContainer);repliesVisibilityToggleContainer.length&&hasReplies(postContainer)&&(repliesVisibilityToggleContainer.fadeOut(150),repliesVisible(postContainer)||showReplies(postContainer,postIdToSee)),inPageReplyForm.slideUp({duration:150,queue:!1,complete:function(){inPageReplyCreateButton.fadeIn(150)}}).fadeOut(200)},hasInPageReplyForm=function(inPageReplyContainer){return inPageReplyContainer.find(_selectors.default.post.inpageReplyContent).length>0},renderInPageReplyTemplate=function(additionalTemplateContext,button,postContainer){var postContentContainer=getPostContentContainer(postContainer),currentSubject=postContentContainer.find(_selectors.default.post.forumSubject).text(),currentAuthorName=postContentContainer.find(_selectors.default.post.authorName).text(),context=function(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}({postid:postContainer.data("post-id"),reply_url:button.attr("data-href"),sesskey:M.cfg.sesskey,parentsubject:currentSubject,parentauthorname:currentAuthorName,canreplyprivately:button.data("can-reply-privately"),postformat:_inpage_reply.default.CONTENT_FORMATS.MOODLE},additionalTemplateContext);return _templates.default.render("mod_forum/inpage_reply_v2",context)},registerEventListeners=function(root){_custom_interaction_events.default.define(root,[_custom_interaction_events.default.events.activate]),_auto_rows.default.init(root),root.on(_custom_interaction_events.default.events.activate,_selectors.default.post.inpageReplyCreateButton,(function(e,data){data.originalEvent.preventDefault();var postContainer=getPostContainer((0,_jquery.default)(e.currentTarget));showInPageReplyForm(postContainer)})),root.on(_custom_interaction_events.default.events.activate,_selectors.default.post.inpageReplyCancelButton,(function(e,data){data.originalEvent.preventDefault();var postContainer=getPostContainer((0,_jquery.default)(e.currentTarget));hideInPageReplyForm(postContainer)})),root.on(_custom_interaction_events.default.events.activate,_selectors.default.post.showReplies,(function(e,data){data.originalEvent.preventDefault();var postContainer=getPostContainer((0,_jquery.default)(e.target));showReplies(postContainer)})),root.on(_custom_interaction_events.default.events.activate,_selectors.default.post.hideReplies,(function(e,data){data.originalEvent.preventDefault();var postContainer=getPostContainer((0,_jquery.default)(e.target));hideReplies(postContainer)})),root.on(_inpage_reply.default.EVENTS.POST_CREATED,_selectors.default.post.inpageSubmitBtn,(function(e,newPostId){var currentTarget=(0,_jquery.default)(e.currentTarget),postContainer=getPostContainer(currentTarget),postContainers=currentTarget.parents(_selectors.default.post.post);hideInPageReplyForm(postContainer,newPostId),postContainers.each((function(index,container){!function(postContainer){getRepliesVisibilityToggleContainer(postContainer).find(_selectors.default.post.replyCount).each((function(index,element){var currentCount=parseInt(element.innerText,10);element.innerText=currentCount+1}))}((0,_jquery.default)(container))}))}))};_exports.init=function(root,context){showInPageReplyForm=buildShowInPageReplyFormFunction(context),registerEventListeners(root),_discussion.default.init(root),_inpage_reply.default.init(root);var discussionToolsContainer=root.find(_selectors.default.discussion.tools);_lock_toggle.default.init(discussionToolsContainer,!1),_favourite_toggle.default.init(discussionToolsContainer,!1,(function(toggleElement,response){var newTargetState=response.userstate.favourited?0:1;return toggleElement.data("targetstate",newTargetState)})),_pin_toggle.default.init(discussionToolsContainer,!1,(function(toggleElement,response){var newTargetState=response.pinned?0:1;return toggleElement.data("targetstate",newTargetState)})),_subscription_toggle.default.init(discussionToolsContainer,!1,(function(toggleElement,response){var newTargetState=response.userstate.subscribed?0:1;toggleElement.data("targetstate",newTargetState)}))}}));
define("mod_forum/grades/grader/selectors",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;return _exports.default={launch:'[data-grade-action="launch"]',gradableItem:"[data-gradable-itemtype]",gradableItems:{wholeForum:'[data-gradable-itemtype="forum"]'},expandConversation:'[data-action="view-context"]',posts:'[data-region="posts"]',viewGrade:'[data-grade-action="view"]'},_exports.default}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("mod_forum/grades/expandconversation",["exports","./grader/selectors","mod_forum/repository","core/notification","core/templates","core/modal_factory","core/modal_events"],(function(_exports,ForumSelectors,_repository,_notification,_templates,Modal,ModalEvents){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.registerEventListeners=void 0,ForumSelectors=_interopRequireWildcard(ForumSelectors),_repository=_interopRequireDefault(_repository),_templates=_interopRequireDefault(_templates),Modal=_interopRequireWildcard(Modal),ModalEvents=_interopRequireWildcard(ModalEvents);var fn,_ref,showPostInContext=(fn=regeneratorRuntime.mark((function _callee(rootNode){var _ref2,_ref2$focusOnClose,focusOnClose,postId,discussionId,discussionName,experimentalDisplayMode,_yield$Promise$all,_yield$Promise$all2,allPosts,modal,postsById,posts,templatePromise,_args=arguments;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _ref2=_args.length>1&&void 0!==_args[1]?_args[1]:{},_ref2$focusOnClose=_ref2.focusOnClose,focusOnClose=void 0===_ref2$focusOnClose?null:_ref2$focusOnClose,postId=rootNode.dataset.postid,discussionId=rootNode.dataset.discussionid,discussionName=rootNode.dataset.name,experimentalDisplayMode="1"==rootNode.dataset.experimentalDisplayMode,_context.next=7,Promise.all([_repository.default.getDiscussionPosts(parseInt(discussionId)),Modal.create({title:discussionName,large:!0,type:Modal.types.CANCEL})]);case 7:_yield$Promise$all=_context.sent,_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2),allPosts=_yield$Promise$all2[0],modal=_yield$Promise$all2[1],postsById=new Map(allPosts.posts.map((function(post){return post.readonly=!0,post.hasreplies=!1,post.replies=[],[post.id,post]}))),posts=[],allPosts.posts.forEach((function(post){if(post.parentid){var parent=postsById.get(post.parentid);parent?(post.parentauthorname=parent.author.fullname,parent.hasreplies=!0,parent.replies.push(post)):posts.push(post)}else posts.push(post)})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy();try{focusOnClose.focus()}catch(e){}})),modal.getRoot().on(ModalEvents.bodyRendered,(function(){var relevantPost=modal.getRoot()[0].querySelector("#p".concat(postId));relevantPost&&relevantPost.scrollIntoView({behavior:"smooth"})})),modal.show(),templatePromise=_templates.default.render("mod_forum/grades/grader/discussion/post_modal",{posts:posts,experimentaldisplaymode:experimentalDisplayMode}),modal.setBody(templatePromise);case 19:case"end":return _context.stop()}}),_callee)})),_ref=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(_x){return _ref.apply(this,arguments)});_exports.registerEventListeners=function(rootNode){rootNode.addEventListener("click",(function(e){var rootNode=e.target.closest(ForumSelectors.expandConversation);if(rootNode){e.preventDefault();try{showPostInContext(rootNode,{focusOnClose:e.target})}catch(err){(0,_notification.exception)(err)}}}))}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("mod_forum/grades/grader",["exports","./grader/selectors","mod_forum/repository","core/templates","../local/grades/grader","core/notification","core_course/repository","core/url"],(function(_exports,Selectors,_repository,_templates,Grader,_notification,_repository2,_url){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.registerLaunchListeners=void 0,Selectors=_interopRequireWildcard(Selectors),_repository=_interopRequireDefault(_repository),_templates=_interopRequireDefault(_templates),Grader=_interopRequireWildcard(Grader),_notification=_interopRequireDefault(_notification),_repository2=_interopRequireDefault(_repository2);var _ref2,_ref4,templateNames_contentRegion="mod_forum/grades/grader/discussion/posts",getContentForUserIdFunction=function(cmid,experimentalDisplayMode){return function(userid){return _repository.default.getDiscussionByUserID(userid,cmid).then((function(context){return context.discussions=context.discussions.map(discussionPostMapper),context.experimentaldisplaymode=!!experimentalDisplayMode,_templates.default.render(templateNames_contentRegion,context)})).catch(_notification.default.exception)}},getUsersForCmidFunction=function(cmid,groupID){return _asyncToGenerator(regeneratorRuntime.mark((function _callee(){var context;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,_repository2.default.getUsersFromCourseModuleID(cmid,groupID);case 2:return context=_context.sent,_context.abrupt("return",context.users);case 4:case"end":return _context.stop()}}),_callee)})))},findGradableNode=function(node){return node.closest(Selectors.gradableItem)},discussionPostMapper=function(discussion){var parentMap=new Map;discussion.posts.parentposts.forEach((function(post){return parentMap.set(post.id,post)}));var userPosts=discussion.posts.userposts.map((function(post){post.readonly=!0,post.hasreplies=!1,post.replies=[];var parent=post.parentid?parentMap.get(post.parentid):null;return parent&&(parent.hasreplies=!1,parent.replies=[],parent.readonly=!0,post.parentauthorname=parent.author.fullname),{parent:parent,post:post}}));return _objectSpread(_objectSpread({},discussion),{},{posts:userPosts})},launchWholeForumGrading=(_ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(rootNode){var _ref3,_ref3$focusOnClose,focusOnClose,data,gradingPanelFunctions,groupID,_args2=arguments;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _ref3=_args2.length>1&&void 0!==_args2[1]?_args2[1]:{},_ref3$focusOnClose=_ref3.focusOnClose,focusOnClose=void 0===_ref3$focusOnClose?null:_ref3$focusOnClose,data=rootNode.dataset,_context2.next=4,Grader.getGradingPanelFunctions("mod_forum",data.contextid,data.gradingComponent,data.gradingComponentSubtype,data.gradableItemtype);case 4:return gradingPanelFunctions=_context2.sent,groupID=data.group?data.group:0,_context2.next=8,Grader.launch(getUsersForCmidFunction(data.cmid,groupID),getContentForUserIdFunction(data.cmid,"1"==data.experimentalDisplayMode),gradingPanelFunctions.getter,gradingPanelFunctions.setter,{groupid:data.groupid,initialUserId:data.initialuserid,moduleName:data.name,courseName:data.courseName,courseUrl:(0,_url.relativeUrl)("/course/view.php",{id:data.courseId}),sendStudentNotifications:data.sendStudentNotifications,focusOnClose:focusOnClose});case 8:case"end":return _context2.stop()}}),_callee2)}))),function(_x){return _ref2.apply(this,arguments)}),launchViewGrading=(_ref4=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(rootNode){var _ref5,_ref5$focusOnClose,focusOnClose,data,gradingPanelFunctions,_args3=arguments;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _ref5=_args3.length>1&&void 0!==_args3[1]?_args3[1]:{},_ref5$focusOnClose=_ref5.focusOnClose,focusOnClose=void 0===_ref5$focusOnClose?null:_ref5$focusOnClose,data=rootNode.dataset,_context3.next=4,Grader.getGradingPanelFunctions("mod_forum",data.contextid,data.gradingComponent,data.gradingComponentSubtype,data.gradableItemtype);case 4:return gradingPanelFunctions=_context3.sent,_context3.next=7,Grader.view(gradingPanelFunctions.getter,data.userid,data.name,{focusOnClose:focusOnClose});case 7:case"end":return _context3.stop()}}),_callee3)}))),function(_x2){return _ref4.apply(this,arguments)});_exports.registerLaunchListeners=function(){var _ref6;document.addEventListener("click",(_ref6=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(e){var rootNode,_rootNode;return regeneratorRuntime.wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(!e.target.matches(Selectors.launch)){_context4.next=17;break}if(rootNode=findGradableNode(e.target)){_context4.next=4;break}throw Error("Unable to find a gradable item");case 4:if(!rootNode.matches(Selectors.gradableItems.wholeForum)){_context4.next=16;break}return e.preventDefault(),_context4.prev=6,_context4.next=9,launchWholeForumGrading(rootNode,{focusOnClose:e.target});case 9:_context4.next=14;break;case 11:_context4.prev=11,_context4.t0=_context4.catch(6),_notification.default.exception(_context4.t0);case 14:_context4.next=17;break;case 16:throw Error("Unable to find a valid gradable item");case 17:if(!e.target.matches(Selectors.viewGrade)){_context4.next=35;break}if(e.preventDefault(),_rootNode=findGradableNode(e.target)){_context4.next=22;break}throw Error("Unable to find a gradable item");case 22:if(!_rootNode.matches(Selectors.gradableItems.wholeForum)){_context4.next=34;break}return e.preventDefault(),_context4.prev=24,_context4.next=27,launchViewGrading(_rootNode,{focusOnClose:e.target});case 27:_context4.next=32;break;case 29:_context4.prev=29,_context4.t1=_context4.catch(24),_notification.default.exception(_context4.t1);case 32:_context4.next=35;break;case 34:throw Error("Unable to find a valid gradable item");case 35:case"end":return _context4.stop()}}),_callee4,null,[[6,11],[24,29]])}))),function(_x3){return _ref6.apply(this,arguments)}))}}));
define("mod_forum/local/layouts",["exports","./layout/fullscreen"],(function(_exports,_fullscreen){Object.defineProperty(_exports,"__esModule",{value:!0}),Object.defineProperty(_exports,"createFullScreenWindow",{enumerable:!0,get:function(){return _fullscreen.createLayout}})}));
define("mod_forum/local/grades/local/grader/user_picker/selectors",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;return _exports.default={regions:{currentUser:'[data-region="user_picker/current_user"]',userRegion:'[data-region="user_picker/user"]'},actions:{changeUser:'[data-action="change-user"]'}},_exports.default}));
define("mod_forum/local/grades/local/grader/gradingpanel",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;var _systemImportTransformerGlobalIdentifier="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}
/**
   * Grading panel functions.
   *
   * @module     mod_forum/local/grades/local/grader/gradingpnael
   * @package    mod_forum
   * @copyright  2019 Andrew Nicols <andrew@nicols.co.uk>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
var fn,_ref,_default=(fn=regeneratorRuntime.mark((function _callee(component,context,gradingComponent,gradingSubtype,itemName){var gradingMethodHandler,GradingMethod;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return gradingMethodHandler="".concat(gradingComponent,"/grades/grader/gradingpanel"),gradingSubtype&&(gradingMethodHandler+="/".concat(gradingSubtype)),_context.next=4,"function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require([gradingMethodHandler],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require(gradingMethodHandler)):Promise.resolve(_systemImportTransformerGlobalIdentifier[gradingMethodHandler]);case 4:return GradingMethod=_context.sent,_context.abrupt("return",{getter:function(userId){return GradingMethod.fetchCurrentGrade(component,context,itemName,userId)},setter:function(userId,notifyStudent,formData){return GradingMethod.storeCurrentGrade(component,context,itemName,userId,notifyStudent,formData)}});case 6:case"end":return _context.stop()}}),_callee)})),_ref=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(_x,_x2,_x3,_x4,_x5){return _ref.apply(this,arguments)});return _exports.default=_default,_exports.default}));
define("mod_forum/local/grades/local/grader/user_picker",["exports","core/templates","./user_picker/selectors","core/str"],(function(_exports,_templates,_selectors,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_templates=_interopRequireDefault(_templates),_selectors=_interopRequireDefault(_selectors);var _ref2,UserPicker=function(){function UserPicker(userList,showUserCallback,preChangeUserCallback){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,UserPicker),this.userList=userList,this.showUserCallback=showUserCallback,this.preChangeUserCallback=preChangeUserCallback,this.currentUserIndex=0,this.render=this.render.bind(this),this.setUserId=this.setUserId.bind(this)}var Constructor,protoProps,staticProps,_showUser,_render;return Constructor=UserPicker,protoProps=[{key:"setUserId",value:function(userId){var userIndex=this.userList.findIndex((function(user){return user.id===parseInt(userId)}));if(-1===userIndex)throw Error("User with id ".concat(userId," not found"));this.currentUserIndex=userIndex}},{key:"render",value:(_render=_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var _yield$this$renderNav,html,js;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return this.root=document.createElement("div"),_context.next=3,this.renderNavigator();case 3:return _yield$this$renderNav=_context.sent,html=_yield$this$renderNav.html,js=_yield$this$renderNav.js,_templates.default.replaceNodeContents(this.root,html,js),_context.next=9,this.showUser(this.currentUser);case 9:this.registerEventListeners();case 10:case"end":return _context.stop()}}),_callee,this)}))),function(){return _render.apply(this,arguments)})},{key:"renderNavigator",value:function(){return _templates.default.renderForPromise("".concat("mod_forum/local/grades/local/grader","/user_picker"),{})}},{key:"renderUserChange",value:function(context){return _templates.default.renderForPromise("".concat("mod_forum/local/grades/local/grader","/user_picker/user"),context)}},{key:"showUser",value:(_showUser=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(user){var _yield$Promise$all,_yield$Promise$all2,_yield$Promise$all2$,html,js,userRegion,currentUserRegion;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,Promise.all([this.renderUserChange(user),this.showUserCallback(user)]);case 2:return _yield$Promise$all=_context2.sent,_yield$Promise$all2=_slicedToArray(_yield$Promise$all,1),_yield$Promise$all2$=_yield$Promise$all2[0],html=_yield$Promise$all2$.html,js=_yield$Promise$all2$.js,userRegion=this.root.querySelector(_selectors.default.regions.userRegion),_templates.default.replaceNodeContents(userRegion,html,js),currentUserRegion=this.root.querySelector(_selectors.default.regions.currentUser),_context2.next=12,(0,_str.get_string)("nowgradinguser","mod_forum",user.fullname);case 12:currentUserRegion.textContent=_context2.sent;case 13:case"end":return _context2.stop()}}),_callee2,this)}))),function(_x){return _showUser.apply(this,arguments)})},{key:"registerEventListeners",value:function(){var _ref,_this=this;this.root.addEventListener("click",(_ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(e){var button;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(!(button=e.target.closest(_selectors.default.actions.changeUser))){_context3.next=9;break}return _context3.next=4,_this.preChangeUserCallback(_this.currentUser);case 4:if(_context3.sent.failed){_context3.next=9;break}return _this.updateIndex(parseInt(button.dataset.direction)),_context3.next=9,_this.showUser(_this.currentUser);case 9:case"end":return _context3.stop()}}),_callee3)}))),function(_x2){return _ref.apply(this,arguments)}))}},{key:"updateIndex",value:function(direction){return this.currentUserIndex+=direction,this.currentUserIndex<0?this.currentUserIndex=this.userList.length-1:this.currentUserIndex>this.userList.length-1&&(this.currentUserIndex=0),this.currentUserIndex}},{key:"currentUser",get:function(){return _objectSpread(_objectSpread({},this.userList[this.currentUserIndex]),{},{total:this.userList.length,displayIndex:this.currentUserIndex+1})}},{key:"rootNode",get:function(){return this.root}}],protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),UserPicker}(),_default=(_ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(users,showUserCallback,preChangeUserCallback){var _ref3,_ref3$initialUserId,initialUserId,userPicker,_args4=arguments;return regeneratorRuntime.wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _ref3=_args4.length>3&&void 0!==_args4[3]?_args4[3]:{},_ref3$initialUserId=_ref3.initialUserId,initialUserId=void 0===_ref3$initialUserId?null:_ref3$initialUserId,userPicker=new UserPicker(users,showUserCallback,preChangeUserCallback),initialUserId&&userPicker.setUserId(initialUserId),_context4.next=5,userPicker.render();case 5:return _context4.abrupt("return",userPicker);case 6:case"end":return _context4.stop()}}),_callee4)}))),function(_x3,_x4,_x5){return _ref2.apply(this,arguments)});return _exports.default=_default,_exports.default}));
define("mod_forum/local/grades/local/grader/selectors",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;
/**
   * Define all of the selectors we will be using on the grading interface.
   *
   * @module     mod_forum/local/grades/local/grader/selectors
   * @package    mod_forum
   * @copyright  2019 Mathew May <mathew.solutions>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
var getDataSelector=function(name,value){return"[data-".concat(name,'="').concat(value,'"]')},_default={buttons:{toggleFullscreen:getDataSelector("action","togglefullscreen"),closeGrader:getDataSelector("action","closegrader"),collapseGradingDrawer:getDataSelector("action","collapse-grading-drawer"),saveGrade:getDataSelector("action","savegrade"),selectUser:getDataSelector("action","select-user"),toggleSearch:getDataSelector("action","toggle-search")},regions:{bodyContainer:getDataSelector("region","body-container"),moduleContainer:getDataSelector("region","module_content_container"),moduleReplace:getDataSelector("region","module_content"),pickerRegion:getDataSelector("region","user_picker"),gradingInfoContainer:getDataSelector("region","grading-info-container"),gradingPanel:getDataSelector("region","grade"),gradingPanelContainer:getDataSelector("region","grading-panel-container"),gradingPanelErrors:getDataSelector("region","grade-errors"),searchResultsContainer:getDataSelector("region","search-results-container"),statusContainer:getDataSelector("region","status-container"),userSearchContainer:getDataSelector("region","user-search-container"),userSearchInput:getDataSelector("region","user-search-input")},values:{sendStudentNotifications:'[data-region="notification"] input[type="radio"]:checked'}};return _exports.default=_default,_exports.default}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("mod_forum/local/grades/grader",["exports","core/templates","./local/grader/selectors","./local/grader/user_picker","mod_forum/local/layout/fullscreen","./local/grader/gradingpanel","core/toast","core/notification","core/str","core_grades/grades/grader/gradingpanel/normalise","core/loadingicon","core/utils","core_grades/grades/grader/gradingpanel/comparison","core/modal_factory","core/modal_events","core/pubsub","core/drawer_events"],(function(_exports,_templates,_selectors,_user_picker,_fullscreen,_gradingpanel,_toast,_notification,_str,_normalise,_loadingicon,_utils,_comparison,Modal,ModalEvents,_pubsub,_drawer_events){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}Object.defineProperty(_exports,"__esModule",{value:!0}),Object.defineProperty(_exports,"getGradingPanelFunctions",{enumerable:!0,get:function(){return _gradingpanel.default}}),_exports.view=_exports.launch=void 0,_templates=_interopRequireDefault(_templates),_selectors=_interopRequireDefault(_selectors),_user_picker=_interopRequireDefault(_user_picker),_gradingpanel=_interopRequireDefault(_gradingpanel),Modal=_interopRequireWildcard(Modal),ModalEvents=_interopRequireWildcard(ModalEvents),_drawer_events=_interopRequireDefault(_drawer_events);var _ref2,_ref4,_ref5,templateNames_grader={app:"mod_forum/local/grades/grader",gradingPanel:{error:"mod_forum/local/grades/local/grader/gradingpanel/error"},searchResults:"mod_forum/local/grades/local/grader/user_picker/user_search",status:"mod_forum/local/grades/local/grader/status"},displayUserPicker=function(root,html){var pickerRegion=root.querySelector(_selectors.default.regions.pickerRegion);_templates.default.replaceNodeContents(pickerRegion,html,"")},fetchContentFromRender=function(html,js){return[html,js]},getUpdateUserContentFunction=function(root,getContentForUser,getGradeForUser,saveGradeForUser){var _ref,firstLoad=!0;return _ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(user){var spinner,_yield$Promise$all,_yield$Promise$all2,_yield$Promise$all2$,html,js,userGrade,_yield$Templates$rend,_yield$Templates$rend2,gradingPanelHtml,gradingPanelJS,panelContainer,panel,form;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return spinner=firstLoad?null:(0,_loadingicon.addIconToContainerWithPromise)(root),_context.next=3,Promise.all([getContentForUser(user.id).then(fetchContentFromRender),getGradeForUser(user.id)]);case 3:return _yield$Promise$all=_context.sent,_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2),_yield$Promise$all2$=_slicedToArray(_yield$Promise$all2[0],2),html=_yield$Promise$all2$[0],js=_yield$Promise$all2$[1],userGrade=_yield$Promise$all2[1],_templates.default.replaceNodeContents(root.querySelector(_selectors.default.regions.moduleReplace),html,js),_context.next=12,_templates.default.render(userGrade.templatename,userGrade.grade).then(fetchContentFromRender);case 12:return _yield$Templates$rend=_context.sent,_yield$Templates$rend2=_slicedToArray(_yield$Templates$rend,2),gradingPanelHtml=_yield$Templates$rend2[0],gradingPanelJS=_yield$Templates$rend2[1],panelContainer=root.querySelector(_selectors.default.regions.gradingPanelContainer),panel=panelContainer.querySelector(_selectors.default.regions.gradingPanel),_templates.default.replaceNodeContents(panel,gradingPanelHtml,gradingPanelJS),form=panel.querySelector("form"),(0,_comparison.fillInitialValues)(form),form.addEventListener("submit",(function(event){saveGradeForUser(user),event.preventDefault()})),panelContainer.scrollTop=0,firstLoad=!1,spinner&&spinner.resolve(),_context.abrupt("return",userGrade);case 26:case"end":return _context.stop()}}),_callee)}))),function(_x){return _ref.apply(this,arguments)}},hideSearchResultContainer=function(bodyContainer,userPickerContainer,searchResultsContainer){bodyContainer.classList.remove("hidden"),userPickerContainer.classList.remove("hidden"),searchResultsContainer.classList.add("hidden")},hideUserSearchInput=function(toggleSearchButton,searchContainer,searchInput){searchContainer.classList.add("collapsed"),toggleSearchButton.setAttribute("aria-expanded","false"),toggleSearchButton.classList.add("collapse"),toggleSearchButton.classList.remove("expand"),toggleSearchButton.focus(),searchContainer.parentElement.querySelector(_selectors.default.regions.gradingInfoContainer).removeAttribute("aria-hidden");var collapseGradingDrawer=searchContainer.parentElement.querySelector(_selectors.default.buttons.collapseGradingDrawer);collapseGradingDrawer.removeAttribute("aria-hidden"),collapseGradingDrawer.setAttribute("tabindex","0"),searchInput.value=""},renderSearchResults=(_ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(searchResultsContainer,users){var _yield$Templates$rend3,html,js;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,_templates.default.renderForPromise(templateNames_grader.searchResults,{users:users});case 2:_yield$Templates$rend3=_context2.sent,html=_yield$Templates$rend3.html,js=_yield$Templates$rend3.js,_templates.default.replaceNodeContents(searchResultsContainer,html,js);case 6:case"end":return _context2.stop()}}),_callee2)}))),function(_x2,_x3){return _ref2.apply(this,arguments)}),registerEventListeners=function(graderLayout,userPicker,saveGradeFunction,userList){var graderContainer=graderLayout.getContainer(),toggleSearchButton=graderContainer.querySelector(_selectors.default.buttons.toggleSearch),searchInputContainer=graderContainer.querySelector(_selectors.default.regions.userSearchContainer),searchInput=searchInputContainer.querySelector(_selectors.default.regions.userSearchInput),bodyContainer=graderContainer.querySelector(_selectors.default.regions.bodyContainer),userPickerContainer=graderContainer.querySelector(_selectors.default.regions.pickerRegion),searchResultsContainer=graderContainer.querySelector(_selectors.default.regions.searchResultsContainer);graderContainer.addEventListener("click",(function(e){if(e.target.closest(_selectors.default.buttons.toggleFullscreen))return e.stopImmediatePropagation(),e.preventDefault(),void graderLayout.toggleFullscreen();if(e.target.closest(_selectors.default.buttons.closeGrader))return e.stopImmediatePropagation(),e.preventDefault(),void graderLayout.close();if(e.target.closest(_selectors.default.buttons.saveGrade)&&saveGradeFunction(userPicker.currentUser),e.target.closest(_selectors.default.buttons.toggleSearch))"true"===toggleSearchButton.getAttribute("aria-expanded")?(hideUserSearchInput(toggleSearchButton,searchInputContainer,searchInput),hideSearchResultContainer(bodyContainer,userPickerContainer,searchResultsContainer),searchResultsContainer.innerHTML=""):(!function(toggleSearchButton,searchContainer,searchInput){searchContainer.classList.remove("collapsed"),toggleSearchButton.setAttribute("aria-expanded","true"),toggleSearchButton.classList.add("expand"),toggleSearchButton.classList.remove("collapse"),searchContainer.parentElement.querySelector(_selectors.default.regions.gradingInfoContainer).setAttribute("aria-hidden","true");var collapseGradingDrawer=searchContainer.parentElement.querySelector(_selectors.default.buttons.collapseGradingDrawer);collapseGradingDrawer.setAttribute("aria-hidden","true"),collapseGradingDrawer.setAttribute("tabindex","-1"),searchInput.focus()}(toggleSearchButton,searchInputContainer,searchInput),function(bodyContainer,userPickerContainer,searchResultsContainer){bodyContainer.classList.add("hidden"),userPickerContainer.classList.add("hidden"),searchResultsContainer.classList.remove("hidden")}(bodyContainer,userPickerContainer,searchResultsContainer),renderSearchResults(searchResultsContainer,userList));else{var selectUserButton=e.target.closest(_selectors.default.buttons.selectUser);if(selectUserButton){var userId=selectUserButton.getAttribute("data-userid"),user=userList.find((function(user){return user.id==userId}));userPicker.setUserId(userId),userPicker.showUser(user),hideUserSearchInput(toggleSearchButton,searchInputContainer,searchInput),hideSearchResultContainer(bodyContainer,userPickerContainer,searchResultsContainer),searchResultsContainer.innerHTML=""}}})),searchInput.addEventListener("input",(0,_utils.debounce)((function(){var users=function(userList,searchTerm){return""===searchTerm?userList:(searchTerm=searchTerm.toLowerCase(),userList.filter((function(user){return user.fullname.toLowerCase().includes(searchTerm)})))}(userList,searchInput.value);renderSearchResults(searchResultsContainer,users)}),300)),(0,_pubsub.subscribe)(_drawer_events.default.DRAWER_HIDDEN,(function(drawerRoot){drawerRoot[0].querySelector(_selectors.default.regions.gradingPanel)&&setContentContainerMargin(graderContainer,0)})),(0,_pubsub.subscribe)(_drawer_events.default.DRAWER_SHOWN,(function(drawerRoot){var gradingPanel=drawerRoot[0];gradingPanel.querySelector(_selectors.default.regions.gradingPanel)&&setContentContainerMargin(graderContainer,gradingPanel.offsetWidth)}))},setContentContainerMargin=function(graderContainer,rightMargin){var contentContainer=graderContainer.querySelector(_selectors.default.regions.moduleContainer);contentContainer&&(contentContainer.style.marginRight="".concat(rightMargin,"px"))},getSaveUserGradeFunction=function(root,setGradeForUser){return _ref3=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(user){var result;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.prev=0,root.querySelector(_selectors.default.regions.gradingPanelErrors).innerHTML="",_context3.next=4,setGradeForUser(user.id,root.querySelector(_selectors.default.values.sendStudentNotifications).value,root.querySelector(_selectors.default.regions.gradingPanel));case 4:if(!(result=_context3.sent).success){_context3.next=11;break}return _context3.t0=_toast.add,_context3.next=9,(0,_str.get_string)("grades:gradesavedfor","mod_forum",user);case 9:_context3.t1=_context3.sent,(0,_context3.t0)(_context3.t1);case 11:return result.failed&&displayGradingError(root,user,result.error),_context3.abrupt("return",result);case 15:return _context3.prev=15,_context3.t2=_context3.catch(0),displayGradingError(root,user,_context3.t2),_context3.abrupt("return",(0,_normalise.failedUpdate)(_context3.t2));case 19:case"end":return _context3.stop()}}),_callee3,null,[[0,15]])}))),function(_x4){return _ref3.apply(this,arguments)};var _ref3},displayGradingError=(_ref4=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(root,user,err){var _yield$Promise$all3,_yield$Promise$all4,_yield$Promise$all4$,html,js,errorString;return regeneratorRuntime.wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.t0=Promise,_context4.t1=_templates.default.renderForPromise(templateNames_grader.gradingPanel.error,{error:err}),_context4.next=4,(0,_str.get_string)("grades:gradesavefailed","mod_forum",_objectSpread({error:err.message},user));case 4:return _context4.t2=_context4.sent,_context4.t3=[_context4.t1,_context4.t2],_context4.next=8,_context4.t0.all.call(_context4.t0,_context4.t3);case 8:_yield$Promise$all3=_context4.sent,_yield$Promise$all4=_slicedToArray(_yield$Promise$all3,2),_yield$Promise$all4$=_yield$Promise$all4[0],html=_yield$Promise$all4$.html,js=_yield$Promise$all4$.js,errorString=_yield$Promise$all4[1],_templates.default.replaceNodeContents(root.querySelector(_selectors.default.regions.gradingPanelErrors),html,js),(0,_toast.add)(errorString);case 16:case"end":return _context4.stop()}}),_callee4)}))),function(_x5,_x6,_x7){return _ref4.apply(this,arguments)}),launch=(_ref5=_asyncToGenerator(regeneratorRuntime.mark((function _callee6(getListOfUsers,getContentForUser,getGradeForUser,setGradeForUser){var _ref6,_ref6$initialUserId,initialUserId,moduleName,courseName,courseUrl,sendStudentNotifications,_ref6$focusOnClose,focusOnClose,userList,_yield$Promise$all5,_yield$Promise$all6,graderLayout,_yield$Promise$all6$,html,js,graderContainer,saveGradeFunction,updateUserContent,userIds,statusContainer,userPicker,_args6=arguments;return regeneratorRuntime.wrap((function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return _ref6=_args6.length>4&&void 0!==_args6[4]?_args6[4]:{},_ref6$initialUserId=_ref6.initialUserId,initialUserId=void 0===_ref6$initialUserId?null:_ref6$initialUserId,moduleName=_ref6.moduleName,courseName=_ref6.courseName,courseUrl=_ref6.courseUrl,sendStudentNotifications=_ref6.sendStudentNotifications,_ref6$focusOnClose=_ref6.focusOnClose,focusOnClose=void 0===_ref6$focusOnClose?null:_ref6$focusOnClose,_context6.next=3,getListOfUsers();case 3:if((userList=_context6.sent).length){_context6.next=12;break}return _context6.t0=_notification.addNotification,_context6.next=8,(0,_str.get_string)("nouserstograde","core_grades");case 8:return _context6.t1=_context6.sent,_context6.t2={message:_context6.t1,type:"error"},(0,_context6.t0)(_context6.t2),_context6.abrupt("return");case 12:return _context6.next=14,Promise.all([(0,_fullscreen.createLayout)({fullscreen:!1,showLoader:!1,focusOnClose:focusOnClose}),_templates.default.renderForPromise(templateNames_grader.app,{moduleName:moduleName,courseName:courseName,courseUrl:courseUrl,drawer:{show:!0},defaultsendnotifications:sendStudentNotifications})]);case 14:return _yield$Promise$all5=_context6.sent,_yield$Promise$all6=_slicedToArray(_yield$Promise$all5,2),graderLayout=_yield$Promise$all6[0],_yield$Promise$all6$=_yield$Promise$all6[1],html=_yield$Promise$all6$.html,js=_yield$Promise$all6$.js,graderContainer=graderLayout.getContainer(),saveGradeFunction=getSaveUserGradeFunction(graderContainer,setGradeForUser),_templates.default.replaceNodeContents(graderContainer,html,js),updateUserContent=getUpdateUserContentFunction(graderContainer,getContentForUser,getGradeForUser,saveGradeFunction),userIds=userList.map((function(user){return user.id})),statusContainer=graderContainer.querySelector(_selectors.default.regions.statusContainer),_context6.next=28,(0,_user_picker.default)(userList,function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark((function _callee5(user){var userGrade,renderContext;return regeneratorRuntime.wrap((function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=2,updateUserContent(user);case 2:userGrade=_context5.sent,renderContext={status:userGrade.hasgrade,index:userIds.indexOf(user.id)+1,total:userList.length},_templates.default.render(templateNames_grader.status,renderContext).then((function(html){return statusContainer.innerHTML=html,html})).catch();case 5:case"end":return _context5.stop()}}),_callee5)})));return function(_x12){return _ref7.apply(this,arguments)}}(),saveGradeFunction,{initialUserId:initialUserId});case 28:userPicker=_context6.sent,registerEventListeners(graderLayout,userPicker,saveGradeFunction,userList),displayUserPicker(graderContainer,userPicker.rootNode);case 31:case"end":return _context6.stop()}}),_callee6)}))),function(_x8,_x9,_x10,_x11){return _ref5.apply(this,arguments)});_exports.launch=launch;var _ref8,view=(_ref8=_asyncToGenerator(regeneratorRuntime.mark((function _callee7(getGradeForUser,userid,moduleName){var _ref9,_ref9$focusOnClose,focusOnClose,_yield$Promise$all7,_yield$Promise$all8,userGrade,modal,spinner,output,_yield$Templates$rend4,html,js,_yield$renderGradeTem,_yield$renderGradeTem2,gradeHTML,gradeJS,gradeReplace,_args7=arguments;return regeneratorRuntime.wrap((function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return _ref9=_args7.length>3&&void 0!==_args7[3]?_args7[3]:{},_ref9$focusOnClose=_ref9.focusOnClose,focusOnClose=void 0===_ref9$focusOnClose?null:_ref9$focusOnClose,_context7.next=3,Promise.all([getGradeForUser(userid),Modal.create({title:moduleName,large:!0,type:Modal.types.CANCEL})]);case 3:return _yield$Promise$all7=_context7.sent,_yield$Promise$all8=_slicedToArray(_yield$Promise$all7,2),userGrade=_yield$Promise$all8[0],modal=_yield$Promise$all8[1],spinner=(0,_loadingicon.addIconToContainerWithPromise)(modal.getRoot()),modal.getRoot().on(ModalEvents.hidden,(function(){if(modal.destroy(),focusOnClose)try{focusOnClose.focus()}catch(e){}})),modal.show(),output=document.createElement("div"),_context7.next=13,_templates.default.renderForPromise("mod_forum/local/grades/view_grade",userGrade);case 13:return _yield$Templates$rend4=_context7.sent,html=_yield$Templates$rend4.html,js=_yield$Templates$rend4.js,_templates.default.replaceNodeContents(output,html,js),_context7.next=19,renderGradeTemplate(userGrade);case 19:_yield$renderGradeTem=_context7.sent,_yield$renderGradeTem2=_slicedToArray(_yield$renderGradeTem,2),gradeHTML=_yield$renderGradeTem2[0],gradeJS=_yield$renderGradeTem2[1],gradeReplace=output.querySelector('[data-region="grade-template"]'),_templates.default.replaceNodeContents(gradeReplace,gradeHTML,gradeJS),modal.setBody(output.outerHTML),spinner.resolve();case 27:case"end":return _context7.stop()}}),_callee7)}))),function(_x13,_x14,_x15){return _ref8.apply(this,arguments)});_exports.view=view;var _ref10,renderGradeTemplate=(_ref10=_asyncToGenerator(regeneratorRuntime.mark((function _callee8(userGrade){var _yield$Templates$rend5,html,js;return regeneratorRuntime.wrap((function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return _context8.next=2,_templates.default.renderForPromise(userGrade.templatename,userGrade.grade);case 2:return _yield$Templates$rend5=_context8.sent,html=_yield$Templates$rend5.html,js=_yield$Templates$rend5.js,_context8.abrupt("return",[html,js]);case 6:case"end":return _context8.stop()}}),_callee8)}))),function(_x16){return _ref10.apply(this,arguments)})}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("mod_forum/local/layout/fullscreen",["exports","core/loadingicon","core/toast","core/local/aria/focuslock"],(function(_exports,_loadingicon,_toast,FocusLockManager){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.createLayout=void 0,FocusLockManager=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}
/**
   * Full screen window layout.
   *
   * @copyright  2019 Andrew Nicols <andrew@nicols.co.uk>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */(FocusLockManager);var getLayoutHelpers=function(layoutNode,FocusLockManager,focusOnClose){var contentNode=document.createElement("div");layoutNode.append(contentNode);var loadingNode=document.createElement("div");layoutNode.append(loadingNode);var requestFullscreen=function(){layoutNode.requestFullscreen?layoutNode.requestFullscreen():layoutNode.msRequestFullscreen?layoutNode.msRequestFullscreen():layoutNode.mozRequestFullscreen?layoutNode.mozRequestFullscreen():layoutNode.webkitRequestFullscreen?layoutNode.webkitRequestFullscreen():layoutNode.setTop(0)},exitFullscreen=function(){if(document.exitRequestFullScreen){if(document.fullScreenElement!==layoutNode)return;document.exitRequestFullScreen()}else if(document.msExitFullscreen){if(document.msFullscreenElement!==layoutNode)return;document.msExitFullscreen()}else if(document.mozCancelFullScreen){if(document.mozFullScreenElement!==layoutNode)return;document.mozCancelFullScreen()}else if(document.webkitExitFullscreen){if(document.webkitFullscreenElement!==layoutNode)return;document.webkitExitFullscreen()}},hideLoadingIcon=function(){for(var child=loadingNode.lastElementChild;child;)loadingNode.removeChild(child),child=loadingNode.lastElementChild};return{close:function(){if(exitFullscreen(),unlockBodyScroll(),FocusLockManager.untrapFocus(),layoutNode.remove(),focusOnClose)try{focusOnClose.focus()}catch(e){}},toggleFullscreen:function(){document.exitRequestFullScreen?document.fullScreenElement===layoutNode?exitFullscreen():requestFullscreen():document.msExitFullscreen?document.msFullscreenElement===layoutNode?exitFullscreen():requestFullscreen():document.mozCancelFullScreen?document.mozFullScreenElement===layoutNode?exitFullscreen():requestFullscreen():document.webkitExitFullscreen&&(document.webkitFullscreenElement===layoutNode?exitFullscreen():requestFullscreen())},requestFullscreen:requestFullscreen,exitFullscreen:exitFullscreen,getContainer:function(){return contentNode},setContent:function(content){hideLoadingIcon();for(var child=contentNode.lastElementChild;child;)contentNode.removeChild(child),child=contentNode.lastElementChild;contentNode.append(content)},showLoadingIcon:function(){(0,_loadingicon.addIconToContainer)(loadingNode)},hideLoadingIcon:hideLoadingIcon}},lockBodyScroll=function(){document.querySelector("body").classList.add("overflow-hidden")},unlockBodyScroll=function(){document.querySelector("body").classList.remove("overflow-hidden")},createLayout=function(){var _ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_ref$fullscreen=_ref.fullscreen,fullscreen=void 0===_ref$fullscreen||_ref$fullscreen,_ref$showLoader=_ref.showLoader,showLoader=void 0!==_ref$showLoader&&_ref$showLoader,_ref$focusOnClose=_ref.focusOnClose,focusOnClose=void 0===_ref$focusOnClose?null:_ref$focusOnClose,container=document.createElement("div");document.body.append(container),container.classList.add("layout"),container.classList.add("fullscreen"),container.setAttribute("role","application"),(0,_toast.addToastRegion)(container),lockBodyScroll(),FocusLockManager.trapFocus(container);var helpers=getLayoutHelpers(container,FocusLockManager,focusOnClose);return showLoader&&helpers.showLoadingIcon(),fullscreen&&helpers.requestFullscreen(),helpers};_exports.createLayout=createLayout}));
/**
 * This module handles the in page replying to forum posts.
 *
 * @module     mod_forum/inpage_reply
 * @package    mod_forum
 * @copyright  2019 Peter Dias
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_forum/inpage_reply",["jquery","core/templates","core/notification","mod_forum/repository","mod_forum/selectors"],(function($,Templates,Notification,Repository,Selectors){var DISPLAYCONSTANTS_NESTED_V2=4,DISPLAYCONSTANTS_THREADED=2,DISPLAYCONSTANTS_NESTED=3,DISPLAYCONSTANTS_FLAT_NEWEST_FIRST=-1,EVENTS={POST_CREATED:"mod_forum-post-created"},CONTENT_FORMATS={MOODLE:0},hideSubmitButtonLoadingIcon=function(button){var textContainer=button.find(Selectors.post.inpageSubmitBtnText),loadingIconContainer=button.find(Selectors.post.loadingIconContainer);button.css("width",""),textContainer.removeClass("hidden"),loadingIconContainer.addClass("hidden")},registerEventListeners=function(root){root.on("click",Selectors.post.inpageSubmitBtn,(function(e){e.preventDefault();var newid,button,textContainer,loadingIconContainer,width,submitButton=$(e.currentTarget),allButtons=submitButton.parent().find(Selectors.post.inpageReplyButton),form=submitButton.parents(Selectors.post.inpageReplyForm).get(0),message=form.elements.post.value.trim(),messageformat=CONTENT_FORMATS.MOODLE,postid=form.elements.reply.value,subject=form.elements.subject.value,currentRoot=submitButton.closest(Selectors.post.post),isprivatereply=null!=form.elements.privatereply&&form.elements.privatereply.checked,modeSelector=root.find(Selectors.post.modeSelect),mode=modeSelector.length?parseInt(modeSelector.get(0).value):null;message.length&&(textContainer=(button=submitButton).find(Selectors.post.inpageSubmitBtnText),loadingIconContainer=button.find(Selectors.post.loadingIconContainer),width=button.outerWidth(),button.css("width",width),textContainer.addClass("hidden"),loadingIconContainer.removeClass("hidden"),allButtons.prop("disabled",!0),Repository.addDiscussionPost(postid,subject,message,messageformat,isprivatereply,!0).then((function(context){var message=context.messages.reduce((function(carry,message){return"success"==message.type&&(carry+="<p>"+message.message+"</p>"),carry}),"");return Notification.addNotification({message:message,type:"success"}),context})).then((function(context){form.reset();var post=context.post;switch(newid=post.id,mode){case DISPLAYCONSTANTS_NESTED_V2:var capabilities=post.capabilities,currentAuthorName=currentRoot.children().not(Selectors.post.repliesContainer).find(Selectors.post.authorName).text();return post.parentauthorname=currentAuthorName,post.showactionmenu=capabilities.view||capabilities.controlreadstatus||capabilities.edit||capabilities.split||capabilities.delete||capabilities.export||post.urls.viewparent,Templates.render("mod_forum/forum_discussion_nested_v2_post_reply",post);case DISPLAYCONSTANTS_THREADED:return Templates.render("mod_forum/forum_discussion_threaded_post",post);case DISPLAYCONSTANTS_NESTED:return Templates.render("mod_forum/forum_discussion_nested_post",post);default:return Templates.render("mod_forum/forum_discussion_post",post)}})).then((function(html,js){var repliesnode=currentRoot.find(Selectors.post.repliesContainer).first();return mode==DISPLAYCONSTANTS_FLAT_NEWEST_FIRST?Templates.prependNodeContents(repliesnode,html,js):Templates.appendNodeContents(repliesnode,html,js)})).then((function(){return submitButton.trigger(EVENTS.POST_CREATED,newid),hideSubmitButtonLoadingIcon(submitButton),allButtons.prop("disabled",!1),void 0!==M.core_formchangechecker&&M.core_formchangechecker.reset_form_dirty_state(),currentRoot.find(Selectors.post.inpageReplyContent).hide()})).then((function(){location.href="#p"+newid})).catch((function(error){return hideSubmitButtonLoadingIcon(submitButton),allButtons.prop("disabled",!1),Notification.exception(error)})))}))};return{init:function(root){registerEventListeners(root)},CONTENT_FORMATS:CONTENT_FORMATS,EVENTS:EVENTS}}));
/**
 * Handle discussion subscription toggling on a discussion list in
 * the forum view.
 *
 * @module     mod_forum/subscription_toggle
 * @package    mod_forum
 * @copyright  2019 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_forum/subscription_toggle",["jquery","core/templates","core/notification","mod_forum/repository","mod_forum/selectors","core/pubsub","mod_forum/forum_events"],(function($,Templates,Notification,Repository,Selectors,PubSub,ForumEvents){return{init:function(root,preventDefault,callback){root.on("click",Selectors.subscription.toggle,(function(e){var toggleElement=$(this),forumId=toggleElement.data("forumid"),discussionId=toggleElement.data("discussionid"),subscriptionState=toggleElement.data("targetstate");Repository.setDiscussionSubscriptionState(forumId,discussionId,subscriptionState).then((function(context){return PubSub.publish(ForumEvents.SUBSCRIPTION_TOGGLED,{discussionId:discussionId,subscriptionState:subscriptionState}),callback(toggleElement,context)})).catch(Notification.exception),preventDefault&&e.preventDefault()}))}}}));
/**
 * Handle the manual locking of individual discussions
 *
 * @module     mod_forum/lock_toggle
 * @package    mod_forum
 * @copyright  2019 Peter Dias <peter@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_forum/lock_toggle",["jquery","core/templates","core/notification","mod_forum/repository","mod_forum/selectors"],(function($,Templates,Notification,Repository,Selectors){return{init:function(root,preventDefault){root.on("click",Selectors.lock.toggle,(function(e){var toggleElement=$(this),forumId=toggleElement.data("forumid"),discussionId=toggleElement.data("discussionid"),state=toggleElement.data("state");Repository.setDiscussionLockState(forumId,discussionId,state).then((function(){return location.reload()})).catch(Notification.exception),preventDefault&&e.preventDefault()}))}}}));
/**
 * This module is the highest level module for the calendar. It is
 * responsible for initialising all of the components required for
 * the calendar to run. It also coordinates the interaction between
 * components by listening for and responding to different events
 * triggered within the calendar UI.
 *
 * @module     mod_forum/posts_list
 * @package    mod_forum
 * @copyright  2019 Peter Dias
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_forum/posts_list",["jquery","core/templates","core/notification","core/pending","core/yui","mod_forum/selectors","mod_forum/inpage_reply"],(function($,Templates,Notification,Pending,Y,Selectors,InPageReply){return{init:function(root){!function(root){root.on("click",Selectors.post.inpageReplyLink,(function(e){if(e.preventDefault(),window.location.hash){var url=window.location.href.split("#")[0];history.pushState({},document.title,url)}var pending=new Pending("inpage-reply"),currentTarget=$(e.currentTarget).parents(Selectors.post.forumCoreContent),currentSubject=currentTarget.find(Selectors.post.forumSubject),currentRoot=$(e.currentTarget).parents(Selectors.post.forumContent),context={postid:$(currentRoot).data("post-id"),reply_url:$(e.currentTarget).attr("href"),sesskey:M.cfg.sesskey,parentsubject:currentSubject.data("replySubject"),canreplyprivately:$(e.currentTarget).data("can-reply-privately"),postformat:InPageReply.CONTENT_FORMATS.MOODLE};if(currentRoot.find(Selectors.post.inpageReplyContent).length){var form=currentRoot.find(Selectors.post.inpageReplyContent);form.slideToggle(300,pending.resolve),form.is(":visible")&&form.find("textarea").focus()}else Templates.render("mod_forum/inpage_reply",context).then((function(html,js){return Templates.appendNodeContents(currentTarget,html,js)})).then((function(){return currentRoot.find(Selectors.post.inpageReplyContent).slideToggle(300,pending.resolve).find("textarea").focus()})).then((function(){Y.use("moodle-core-formchangechecker",(function(){M.core_formchangechecker.init({formid:"inpage-reply-".concat(context.postid)})}))})).fail(Notification.exception)}))}(root),InPageReply.init(root)}}}));
/**
 * Enrolled user selector module.
 *
 * @module     mod_forum/form-user-selector
 * @class      form-user-selector
 * @package    mod_forum
 * @copyright  2019 Shamim Rezaie
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_forum/form-user-selector",["jquery","core/ajax","core/templates"],(function($,Ajax,Templates){return{processResults:function(selector,results){var users=[];return $.each(results,(function(index,user){users.push({value:user.id,label:user._label})})),users},transport:function(selector,query,success,failure){var courseid=$(selector).attr("courseid");Ajax.call([{methodname:"core_enrol_search_users",args:{courseid:courseid,search:query,searchanywhere:!0,page:0,perpage:30}}])[0].then((function(results){var promises=[],i=0;return $.each(results,(function(index,user){promises.push(Templates.render("mod_forum/form-user-selector-suggestion",user))})),$.when.apply($.when,promises).then((function(){var args=arguments;$.each(results,(function(index,user){user._label=args[i],i++})),success(results)}))})).fail(failure)}}}));
/**
 * Common CSS selectors for the forum UI.
 *
 * @module     mod_forum/selectors
 * @package    mod_forum
 * @copyright  2019 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_forum/selectors",[],(function(){return{subscription:{toggle:"[data-type='subscription-toggle'][data-action='toggle']"},summary:{actions:"[data-container='discussion-summary-actions']"},post:{post:'[data-region="post"]',action:'[data-region="post-action"]',actionsContainer:'[data-region="post-actions-container"]',authorName:'[data-region="author-name"]',forumCoreContent:"[data-region-content='forum-post-core']",forumContent:"[data-content='forum-post']",forumSubject:"[data-region-content='forum-post-core-subject']",inpageReplyButton:"button",inpageReplyLink:"[data-action='collapsible-link']",inpageReplyCancelButton:"[data-action='cancel-inpage-reply']",inpageReplyCreateButton:"[data-action='create-inpage-reply']",inpageReplyContainer:'[data-region="inpage-reply-container"]',inpageReplyContent:"[data-content='inpage-reply-content']",inpageReplyForm:"form[data-content='inpage-reply-form']",inpageSubmitBtn:"[data-action='forum-inpage-submit']",inpageSubmitBtnText:"[data-region='submit-text']",loadingIconContainer:"[data-region='loading-icon-container']",repliesContainer:"[data-region='replies-container']",replyCount:'[data-region="reply-count"]',modeSelect:"select[name='mode']",showReplies:'[data-action="show-replies"]',hideReplies:'[data-action="hide-replies"]',repliesVisibilityToggleContainer:'[data-region="replies-visibility-toggle-container"]'},lock:{toggle:"[data-action='toggle'][data-type='lock-toggle']",icon:"[data-region='locked-icon']"},favourite:{toggle:"[data-type='favorite-toggle'][data-action='toggle']"},pin:{toggle:"[data-type='pin-toggle'][data-action='toggle']"},discussion:{tools:'[data-container="discussion-tools"]',item:'[data-region="discussion-list-item"]',lockedLabel:"[data-region='locked-label']",subscribedLabel:"[data-region='subscribed-label']",timedLabel:"[data-region='timed-label']"}}}));
/**
 * Handle discussion subscription toggling on a discussion list in
 * the forum view.
 *
 * @module     mod_forum/favourite_toggle
 * @package    mod_forum
 * @copyright  2019 Peter Dias <peter@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_forum/favourite_toggle",["jquery","core/templates","core/notification","mod_forum/repository","mod_forum/selectors","core/str"],(function($,Templates,Notification,Repository,Selectors,String){return{init:function(root,preventDefault,callback){root.on("click",Selectors.favourite.toggle,(function(e){var toggleElement=$(this),forumId=toggleElement.data("forumid"),discussionId=toggleElement.data("discussionid"),subscriptionState=toggleElement.data("targetstate");Repository.setFavouriteDiscussionState(forumId,discussionId,subscriptionState).then((function(context){return callback(toggleElement,context)})).then((function(){return String.get_string("favouriteupdated","forum").done((function(s){return Notification.addNotification({message:s,type:"info"})}))})).catch(Notification.exception),preventDefault&&e.preventDefault()}))}}}));
/**
 * This module is the highest level module for the calendar. It is
 * responsible for initialising all of the components required for
 * the calendar to run. It also coordinates the interaction between
 * components by listening for and responding to different events
 * triggered within the calendar UI.
 *
 * @module     mod_forum/pin_toggle
 * @package    mod_forum
 * @copyright  2018 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_forum/pin_toggle",["jquery","core/ajax","core/str","core/templates","core/notification","mod_forum/repository","mod_forum/selectors","core/str"],(function($,Ajax,Str,Templates,Notification,Repository,Selectors,String){return{init:function(root,preventDefault,callback){root.on("click",Selectors.pin.toggle,(function(e){var toggleElement=$(this),forumid=toggleElement.data("forumid"),discussionid=toggleElement.data("discussionid"),pinstate=toggleElement.data("targetstate");Repository.setPinDiscussionState(forumid,discussionid,pinstate).then((function(context){return callback(toggleElement,context)})).then((function(){return String.get_string("pinupdated","forum").done((function(s){return Notification.addNotification({message:s,type:"info"})}))})).fail(Notification.exception),preventDefault&&e.preventDefault()}))}}}));
/**
 * Events for the forum activity.
 *
 * @module     mod_forum/forum_events
 * @package    mod_forum
 * @copyright  2019 Jun Pataleta <jun@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_forum/forum_events",[],(function(){return{SUBSCRIPTION_TOGGLED:"mod_forum/subscription_toggle:subscriptionToggled"}}));
/**
 * Forum repository class to encapsulate all of the AJAX requests that subscribe or unsubscribe
 * can be sent for forum.
 *
 * @module     mod_forum/repository
 * @package    mod_forum
 * @copyright  2019 Andrew Nicols <andrew@nicols.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_forum/repository",["core/ajax"],(function(Ajax){return{setDiscussionSubscriptionState:function(forumId,discussionId,targetState){var request={methodname:"mod_forum_set_subscription_state",args:{forumid:forumId,discussionid:discussionId,targetstate:targetState}};return Ajax.call([request])[0]},addDiscussionPost:function(postid,subject,message,messageformat,isprivatereply,topreferredformat){var request={methodname:"mod_forum_add_discussion_post",args:{postid:postid,message:message,messageformat:messageformat,subject:subject,options:[{name:"private",value:isprivatereply},{name:"topreferredformat",value:topreferredformat}]}};return Ajax.call([request])[0]},setDiscussionLockState:function(forumId,discussionId,targetState){var request={methodname:"mod_forum_set_lock_state",args:{forumid:forumId,discussionid:discussionId,targetstate:targetState}};return Ajax.call([request])[0]},setFavouriteDiscussionState:function(forumId,discussionId,targetState){var request={methodname:"mod_forum_toggle_favourite_state",args:{discussionid:discussionId,targetstate:targetState}};return Ajax.call([request])[0]},setPinDiscussionState:function(forumid,discussionid,targetstate){var request={methodname:"mod_forum_set_pin_state",args:{discussionid:discussionid,targetstate:targetstate}};return Ajax.call([request])[0]},getDiscussionByUserID:function(userid,cmid){var sortby=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"modified",sortdirection=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"DESC",request={methodname:"mod_forum_get_discussion_posts_by_userid",args:{userid:userid,cmid:cmid,sortby:sortby,sortdirection:sortdirection}};return Ajax.call([request])[0]},getDiscussionPosts:function(discussionId){var sortby=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"created",sortdirection=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ASC",request={methodname:"mod_forum_get_discussion_posts",args:{discussionid:discussionId,sortby:sortby,sortdirection:sortdirection}};return Ajax.call([request])[0]}}}));
define ("mod_googlemeet/mod_form",["core/notification","core/str","mod_googlemeet/gapi"],function(a,b,c){return{init:function init(d,e,f){var p=["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],q="",r="",s="",t="",u="";b.get_strings([{key:"requirednamefield",component:"mod_googlemeet"},{key:"checkweekdays",component:"mod_googlemeet"},{key:"invalideventendtime",component:"mod_googlemeet"},{key:"invalideventenddate",component:"mod_googlemeet"},{key:"timeahead",component:"mod_googlemeet"}]).done(function(a){q=a[0];r=a[1];s=a[2];t=a[3];u=a[4]}).fail(a.exception);var v=document.getElementById("id_generateurlroom"),w=document.getElementById("id_url"),x=document.getElementById("id_url_viewer"),y=document.getElementById("id_originalname"),z=document.getElementById("id_creatoremail"),A=document.querySelector("#region-main .mform");function g(a,b){var c=new FormData(A),d=c.get(a+"[year]"),e=c.get(a+"[month]"),f=c.get(a+"[day]");e=("0"+e).slice(-2);f=("0"+f).slice(-2);if(b){return d+"-"+e+"-"+f}return d+e+f}function h(){var a=new FormData(A),b=a.get("starthour"),c=a.get("startminute"),d=a.get("endhour"),e=a.get("endminute");b=("0"+b).slice(-2);c=("0"+c).slice(-2);d=("0"+d).slice(-2);e=("0"+e).slice(-2);var f=b+":"+c+":00",h=d+":"+e+":00",j=g("eventdate",!0)+" "+f,k=g("eventenddate",!0)+" "+h,l=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],m=new Date(j),n=new Date(k),o=!1;while(m<=n){if(!o){for(var p=0;p<=l.length;p++){var q=l[m.getDay()],r=a.get("days["+l[p]+"]");if(r&&q===l[p]){o=!0;break}}}m=new Date(m.setDate(m.getDate()+1))}return o}function i(){var a=new FormData(A),b=document.getElementById("id_name"),c=document.getElementById("id_error_name");if(0===a.get("name").trim().length){b.classList.add("is-invalid");b.focus();c.innerText="- "+q;c.style.display="block";return!1}else{b.classList.remove("is-invalid");c.innerText="";c.style.display="none"}var d=document.getElementById("id_googlemeet_eventtime_error"),e=3600*a.get("starthour")+60*a.get("startminute"),f=3600*a.get("endhour")+60*a.get("endminute");if(f<e){d.innerText=s;d.style.display="block";document.getElementById("id_endhour").focus();return!1}else{d.innerText="";d.style.display="none"}var i=Math.floor(new Date(g("eventdate",!0)).getTime()/1e3),j=Math.floor(new Date(g("eventenddate",!0)).getTime()/1e3),k=document.getElementById("id_googlemeet_eventenddategroup_error");if(a.get("addmultiply")&&0!==i&&0!==j&&j<i){k.innerText=t;k.style.display="block";document.getElementById("id_eventenddate_day").focus();return!1}else if(a.get("addmultiply")&&1<Math.ceil((j-i)/31536e3)){k.innerText=u;k.style.display="block";document.getElementById("id_eventenddate_day").focus();return!1}else{k.innerText="";k.style.display="none"}if(a.get("addmultiply")){var l=document.getElementById("id_googlemeet_days_error");if(!h()){l.innerText=r;l.style.display="block";document.getElementById("id_days_Mon").focus();return!1}else{l.innerText="";l.style.display="none"}}return!0}function j(){n();if(!i()){return}c.auth2.getAuthInstance().signIn({prompt:"select_account"}).then(function(){o()}).catch()}function k(a){var b=document.getElementById("generateurlroomLoading");if(a){b.style.display="block";v.disabled=!0}else{b.style.display="none";v.disabled=!1}}function l(a){var b=Math.floor(Math.random()*8888)+1111;return a+" ("+b+")"}function m(a){var b=document.getElementById("googlemeetcontentlog"),c=document.createTextNode(a+"\n");b.style.display="block";b.appendChild(c)}function n(){var a=document.getElementById("googlemeetcontentlog");a.style.display="none";a.innerHTML=""}function o(){var a=new FormData(A),b=a.get("starthour"),d=a.get("startminute"),e=a.get("endhour"),h=a.get("endminute");b=("0"+b).slice(-2);d=("0"+d).slice(-2);e=("0"+e).slice(-2);h=("0"+h).slice(-2);var i=b+":"+d+":00",j=e+":"+h+":00",n={dateTime:g("eventdate",!0)+"T"+i,timeZone:f},o={dateTime:g("eventdate",!0)+"T"+j,timeZone:f},p=[];if(a.get("addmultiply")){var q="INTERVAL="+a.get("period"),r="UNTIL="+g("eventenddate",!1)+"T235959Z",s="BYDAY=",t={Sun:"SU",Mon:"MO",Tue:"TU",Wed:"WE",Thu:"TH",Fri:"FR",Sat:"SA"};for(var u in t){if(a.get("days["+u+"]")){s+=t[u]+","}}p=["RRULE:FREQ=WEEKLY;"+q+";"+r+";"+s]}var B=l(a.get("name")),C={summary:B,description:a.get("introeditor[text]"),start:n,end:o,recurrence:p};k(!0);c.client.calendar.events.insert({calendarId:"primary",resource:C}).then(function(a){var b=a.result,d={conferenceData:{createRequest:{requestId:b.id}}};c.client.calendar.events.patch({calendarId:"primary",eventId:b.id,resource:d,sendNotifications:!1,conferenceDataVersion:1}).then(function(a){var b=a.result;v.remove();y.value=B;w.value=b.hangoutLink;x.value=b.hangoutLink;z.value=b.creator.email;document.getElementById("id_googlemeet_generateurlgroup_error").style.display="none";k(!1)}).catch(function(a){m(JSON.stringify(a.result.error,null,2));k(!1)})}).catch(function(a){m(JSON.stringify(a.result.error,null,2));k(!1)})}c.load("client:auth2",function(){c.client.init({apiKey:e,clientId:d,discoveryDocs:p,scope:"https://www.googleapis.com/auth/calendar.events"}).then(function(){v.onclick=j;v.disabled=!1}).catch(function(a){v.disabled=!0;m(JSON.stringify(a,null,2))})})}}});
define ("mod_googlemeet/view",["core/ajax","core/str","core/notification","core/templates","mod_googlemeet/gapi"],function(a,b,c,d,e){return{init:function init(f,g,h,i,j,k){var w=["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],x=h.url.substr(24,12),y,z="",A="",B="",C="";b.get_strings([{key:"notpossiblesync",component:"mod_googlemeet"},{key:"notfoundrecordingsfolder",component:"mod_googlemeet"},{key:"notfoundrecordingname",component:"mod_googlemeet"},{key:"or",component:"mod_googlemeet"}]).done(function(a){z=a[0];A=a[1];B=a[2];C=a[3]}).fail(c.exception);var D=document.getElementById("id_syncdrivebutton");function l(){e.auth2.getAuthInstance().signIn({prompt:"select_account"}).then(function(){v()}).catch()}function m(a){var b=document.getElementById("googlemeet_syncimg");if(a){b.style.display="flex";D.disabled=!0}else{b.style.display="none";D.disabled=!1}}function n(a){var b=document.getElementById("googlemeetcontentlog"),c=document.createTextNode(a+"\n");b.style.display="block";b.appendChild(c)}function o(){var a=document.getElementById("googlemeetcontentlog");a.style.display="none";a.innerHTML=""}function p(a){e.client.drive.permissions.create({resource:{type:"anyone",role:"reader"},fileId:a,fields:"id"}).then().catch()}function q(){var a="and (name contains '"+x+"'";a+=" or name contains '"+h.originalname+"')";return a}function r(a){var b=Math.floor(parseInt(a,10)/1e3),c=Math.floor(b/3600),d=Math.floor((b-3600*c)/60),e=b-3600*c-60*d;if(10>e){e="0"+e}if(0<c){if(10>d){d="0"+d}return c+":"+d+":"+e}else{return d+":"+e}}function s(a){d.render("mod_googlemeet/recordingstable",{recordings:a,coursemoduleid:j,hascapability:k}).then(function(a,b){m(!1);d.replaceNodeContents("#googlemeet_recordings_table",a,b);document.getElementById("id_creatoremail").innerHTML=y;document.getElementById("id_lastsync").innerHTML=new Date().toLocaleString().substr(0,16)}).fail(c.exception).fail(function(){m(!1)})}function t(b){e.client.drive.files.list({q:"("+b+") and trashed=false and mimeType='video/mp4' "+q(),pageSize:1e3,fields:"files(id,name,permissionIds,createdTime,videoMediaMetadata,webViewLink)"}).then(function(b){var d=b.result.files;if(d&&0<d.length){for(var e=0,f;e<d.length;e++){f=d[e];if(!f.permissionIds.includes("anyoneWithLink")){p(f.id)}d[e].recordingId=f.id;d[e].duration=r(f.videoMediaMetadata.durationMillis);d[e].createdTime=Math.floor(new Date(f.createdTime).getTime()/1e3);delete d[e].id;delete d[e].permissionIds;delete d[e].videoMediaMetadata}a.call([{methodname:"mod_googlemeet_sync_recordings",args:{googlemeetid:h.id,creatoremail:y,files:d,coursemoduleid:j}}])[0].then(function(a){s(a);i=!0}).fail(c.exception).fail(function(){m(!1)})}else{var g=B+" \""+x+"\" ";if(h.originalname){g+=C+" \""+h.originalname+"\""}n(g);m(!1);if(i){m(!0);a.call([{methodname:"mod_googlemeet_delete_all_recordings",args:{googlemeetid:h.id,coursemoduleid:j}}])[0].then(function(a){s(a);i=!1;m(!1)}).fail(c.exception).fail(function(){m(!1)})}}}).catch(function(a){m(!1);n(JSON.stringify(a.result.error,null,2))})}function u(a,b){for(var c=0;c<b.length;c++){if(!0===b[c].me){return a===b[c].emailAddress}}return!1}function v(){m(!0);o();e.client.drive.files.list({q:"name='Meet Recordings' and trashed=false",pageSize:1e3,fields:"nextPageToken, files(id,owners)"}).then(function(a){var b=a.result.files;if(b&&0<b.length){for(var c="",d=0;d<b.length;d++){if(u(h.creatoremail,b[d].owners)){y=h.creatoremail;c+="parents='".concat(b[d].id,"'");if(d+1<b.length){c+=" or "}}}if(c){t(c);return}n(z);m(!1)}else{n(A);m(!1)}}).catch(function(a){m(!1);n(JSON.stringify(a.result.error,null,2))})}e.load("client:auth2",function(){e.client.init({apiKey:g,clientId:f,discoveryDocs:w,scope:"https://www.googleapis.com/auth/drive"}).then(function(){D.onclick=l;D.disabled=!1}).catch(function(a){D.disabled=!0;n(JSON.stringify(a,null,2))})})}}});
define ("mod_googlemeet/gapi",["mod_googlemeet/config","gapi"],function(a,b){return b});
define ("mod_googlemeet/config",[],function(){window.requirejs.config({paths:{gapi:"https://apis.google.com/js/api"},shim:{gapi:{exports:"gapi"}}})});
define('mod_hvp/embed', ["jquery","mod_hvp/communicator"],function(a,b){a(document).ready(function(){a(".h5p-iframe").ready(function(){var a=document.querySelector(".h5p-iframe"),c=a.contentWindow.H5P;if(c&&c.instances&&c.instances[0]){var d,e=c.instances[0],f=!1;b.on("ready",function(){b.send("hello")}),b.on("hello",function(){f=!0,a.contentDocument.body.style.overflow="hidden",document.body.classList.add("h5p-resizing"),c.trigger(e,"resize")}),b.on("resizePrepared",function(){b.send("resize",{scrollHeight:a.contentDocument.body.scrollHeight})}),b.on("resize",function(){c.trigger(e,"resize")}),c.on(e,"resize",function(){c.isFullscreen||(clearTimeout(d),d=setTimeout(function(){f?b.send("prepareResize",{scrollHeight:a.contentDocument.body.scrollHeight,clientHeight:a.contentDocument.body.clientHeight}):b.send("hello")},0))}),c.trigger(e,"resize")}})})});
define('mod_hvp/communicator', [],function(){var a=function(){this._actionHandlers={},this.registerEventListeners()};return a.prototype._actionHandlers={},a.prototype.on=function(a,b){this._actionHandlers[a]=b},a.prototype.send=function(a,b){void 0===b&&(b={}),b.context="h5p",b.action=a,window.parent.postMessage(b,"*")},a.prototype.registerEventListeners=function(){var a=this;window.addEventListener("message",function(b){window.parent===b.source&&"h5p"===b.data.context&&void 0!==a._actionHandlers[b.data.action]&&a._actionHandlers[b.data.action](b.data)},!1)},new a});
define ("mod_hvp/contenthubregistration",[],function(){return{init:function init(){var a=H5PSettings;a.container=document.getElementById("h5p-hub-registration");H5PHub.createRegistrationUI(a)}}});
/**
 * Provides a list of events that can be triggered in the LTI management
 * page.
 *
 * @module     mod_lti/events
 * @class      events
 * @package    mod_lti
 * @copyright  2015 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_lti/events",[],(function(){return{NEW_TOOL_TYPE:"lti.tool.type.new",START_EXTERNAL_REGISTRATION:"lti.registration.external.start",STOP_EXTERNAL_REGISTRATION:"lti.registration.external.stop",START_CARTRIDGE_REGISTRATION:"lti.registration.cartridge.start",STOP_CARTRIDGE_REGISTRATION:"lti.registration.cartridge.stop",REGISTRATION_FEEDBACK:"lti.registration.feedback",CAPABILITIES_AGREE:"lti.tool.type.capabilities.agree",CAPABILITIES_DECLINE:"lti.tool.type.capabilities.decline"}}));
/**
 * A module that enables the setting of form field values on the client side.
 *
 * @module     mod_lti/form-field
 * @class      form-field
 * @package    mod_lti
 * @copyright  2016 Jun Pataleta <jun@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.2
 */
define("mod_lti/form-field",["jquery"],(function($){var FormField=function(name,type,resetIfUndefined,defaultValue){this.name=name,this.id="id_"+this.name,this.selector="#"+this.id,this.type=type,this.resetIfUndefined=resetIfUndefined,this.defaultValue=defaultValue};return FormField.TYPES={TEXT:1,SELECT:2,CHECKBOX:3,EDITOR:4},FormField.prototype.setFieldValue=function(value){if(null===value){if(!this.resetIfUndefined)return;value=this.defaultValue}switch(this.type){case FormField.TYPES.CHECKBOX:value?$(this.selector).prop("checked",!0):$(this.selector).prop("checked",!1);break;case FormField.TYPES.EDITOR:if(void 0!==value.text){var attoEditor=$(this.selector+"editable");attoEditor.length?attoEditor.html(value.text):"undefined"!=typeof tinyMCE&&tinyMCE.execInstanceCommand(this.id,"mceInsertContent",!1,value.text),$(this.selector).val(value.text)}break;default:$(this.selector).val(value)}},FormField}));
/**
 * Controls all of the behaviour and interaction with a tool type card. These are
 * listed on the LTI tool type management page.
 *
 * See template: mod_lti/tool_card
 *
 * @module     mod_lti/tool_card_controller
 * @class      tool_card_controller
 * @package    mod_lti
 * @copyright  2015 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_lti/tool_card_controller",["jquery","core/ajax","core/notification","core/templates","core/modal_factory","mod_lti/tool_type","mod_lti/events","mod_lti/keys","core/str"],(function($,ajax,notification,templates,modalFactory,toolType,ltiEvents,KEYS,str){var SELECTORS_DELETE_BUTTON=".delete",SELECTORS_NAME_ELEMENT=".name",SELECTORS_DESCRIPTION_ELEMENT=".description",SELECTORS_CAPABILITIES_CONTAINER=".capabilities-container",SELECTORS_ACTIVATE_BUTTON=".tool-card-footer a.activate",getNameElement=function(element){return element.find(SELECTORS_NAME_ELEMENT)},getDescriptionElement=function(element){return element.find(SELECTORS_DESCRIPTION_ELEMENT)},getActivateButton=function(element){return element.find(SELECTORS_ACTIVATE_BUTTON)},getCapabilitiesContainer=function(element){return element.find(SELECTORS_CAPABILITIES_CONTAINER)},hasCapabilitiesContainer=function(element){return!!getCapabilitiesContainer(element).length},getTypeId=function(element){return element.attr("data-type-id")},clearAllAnnouncements=function(element){element.removeClass("announcement loading success fail capabilities")},startLoading=function(element){clearAllAnnouncements(element),element.addClass("announcement loading")},stopLoading=function(element){element.removeClass("announcement loading")},announceSuccess=function(element){var promise=$.Deferred();return clearAllAnnouncements(element),element.addClass("announcement success"),setTimeout((function(){element.removeClass("announcement success"),promise.resolve()}),2e3),promise},announceFailure=function(element){var promise=$.Deferred();return clearAllAnnouncements(element),element.addClass("announcement fail"),setTimeout((function(){element.removeClass("announcement fail"),promise.resolve()}),2e3),promise},setValueSnapshot=function(element,value){element.attr("data-val-snapshot",value)},getValueSnapshot=function(element){return element.attr("data-val-snapshot")},setStatusActive=function(element){var id=getTypeId(element);if(""===id)return $.Deferred().resolve();startLoading(element);var promise=toolType.update({id:id,state:toolType.constants.state.configured});return promise.then((function(toolTypeData){return stopLoading(element),announceSuccess(element),toolTypeData})).then((function(toolTypeData){return templates.render("mod_lti/tool_card",toolTypeData)})).then((function(renderResult){var html=renderResult[0],js=renderResult[1];templates.replaceNode(element,html,js)})).catch((function(){stopLoading(element),announceFailure(element)})),promise},registerEventListeners=function(element){var deleteButton=function(element){return element.find(SELECTORS_DELETE_BUTTON)}(element);deleteButton.click((function(e){e.preventDefault(),function(element){var promise=$.Deferred(),typeId=getTypeId(element);startLoading(element),""===typeId?$.Deferred().resolve():str.get_strings([{key:"delete",component:"mod_lti"},{key:"delete_confirmation",component:"mod_lti"},{key:"delete",component:"mod_lti"},{key:"cancel",component:"core"}]).done((function(strs){notification.confirm(strs[0],strs[1],strs[2],strs[3],(function(){toolType.delete(typeId).done((function(){stopLoading(element),announceSuccess(element).done((function(){element.remove()})).fail(notification.exception).always((function(){promise.resolve()}))})).fail((function(error){announceFailure(element),promise.reject(error)}))}),(function(){stopLoading(element),promise.resolve()}))})).fail((function(error){stopLoading(element),notification.exception(error),promise.reject(error)}))}(element)})),deleteButton.keypress((function(e){e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||e.keyCode!=KEYS.ENTER&&e.keyCode!=KEYS.SPACE||(e.preventDefault(),deleteButton.click())}));var descriptionElement=getDescriptionElement(element);descriptionElement.focus((function(e){e.preventDefault(),function(element){var descriptionElement=getDescriptionElement(element);if(!descriptionElement.hasClass("loading")){var description=descriptionElement.text().trim();setValueSnapshot(descriptionElement,description)}}(element)})),descriptionElement.blur((function(e){e.preventDefault(),function(element){var typeId=getTypeId(element);if(""===typeId)return $.Deferred().resolve();var descriptionElement=getDescriptionElement(element);if(descriptionElement.hasClass("loading"))return $.Deferred().resolve();var description=descriptionElement.text().trim();if(getValueSnapshot(descriptionElement)==description)return $.Deferred().resolve();descriptionElement.addClass("loading");var promise=toolType.update({id:typeId,description:description});promise.done((function(type){descriptionElement.removeClass("loading"),descriptionElement.text(type.description)})).fail(notification.exception),promise.fail((function(){descriptionElement.removeClass("loading")}))}(element)})),descriptionElement.keypress((function(e){e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||e.keyCode==KEYS.ENTER&&(e.preventDefault(),descriptionElement.blur())}));var nameElement=getNameElement(element);if(nameElement.focus((function(e){e.preventDefault(),function(element){var nameElement=getNameElement(element);if(!nameElement.hasClass("loading")){var name=nameElement.text().trim();setValueSnapshot(nameElement,name)}}(element)})),nameElement.blur((function(e){e.preventDefault(),function(element){var typeId=getTypeId(element);if(""===typeId)return $.Deferred().resolve();var nameElement=getNameElement(element);if(nameElement.hasClass("loading"))return $.Deferred().resolve();var name=nameElement.text().trim();if(getValueSnapshot(nameElement)==name)return $.Deferred().resolve();nameElement.addClass("loading");var promise=toolType.update({id:typeId,name:name});promise.done((function(type){nameElement.removeClass("loading"),nameElement.text(type.name)})),promise.fail((function(){nameElement.removeClass("loading")}))}(element)})),nameElement.keypress((function(e){e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||e.keyCode==KEYS.ENTER&&(e.preventDefault(),nameElement.blur())})),function(element){return!!getActivateButton(element).length}(element)){var activateButton=getActivateButton(element);activateButton.click((function(e){e.preventDefault(),function(element){hasCapabilitiesContainer(element)?function(element){element.addClass("announcement capabilities")}(element):setStatusActive(element)}(element)})),activateButton.keypress((function(e){e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||e.keyCode!=KEYS.ENTER&&e.keyCode!=KEYS.SPACE||(e.preventDefault(),activateButton.click())}))}if(hasCapabilitiesContainer(element)){var capabilitiesContainer=getCapabilitiesContainer(element);capabilitiesContainer.on(ltiEvents.CAPABILITIES_AGREE,(function(){setStatusActive(element)})),capabilitiesContainer.on(ltiEvents.CAPABILITIES_DECLINE,(function(){!function(element){element.removeClass("announcement capabilities")}(element)}))}};return{init:function(element){registerEventListeners(element),function(element){var trigger=$("#"+element.data("uniqid")+"-"+element.data("deploymentid")),context={uniqid:element.data("uniqid"),platformid:element.data("platformid"),clientid:element.data("clientid"),deploymentid:element.data("deploymentid"),urls:{publickeyset:element.data("publickeyseturl"),accesstoken:element.data("accesstokenurl"),authrequest:element.data("authrequesturl")}},bodyPromise=templates.render("mod_lti/tool_config_modal_body",context);context={mailto:"mailto:?subject="+encodeURIComponent(element.data("mailtosubject"))+"&body="+encodeURIComponent(element.data("platformidstr"))+":%20"+encodeURIComponent(element.data("platformid"))+"%0D%0A"+encodeURIComponent(element.data("clientidstr"))+":%20"+encodeURIComponent(element.data("clientid"))+"%0D%0A"+encodeURIComponent(element.data("deploymentidstr"))+":%20"+encodeURIComponent(element.data("deploymentid"))+"%0D%0A"+encodeURIComponent(element.data("publickeyseturlstr"))+":%20"+encodeURIComponent(element.data("publickeyseturl"))+"%0D%0A"+encodeURIComponent(element.data("accesstokenurlstr"))+":%20"+encodeURIComponent(element.data("accesstokenurl"))+"%0D%0A"+encodeURIComponent(element.data("authrequesturlstr"))+":%20"+encodeURIComponent(element.data("authrequesturl"))+"%0D%0A"};var footerPromise=templates.render("mod_lti/tool_config_modal_footer",context);modalFactory.create({large:!0,title:element.data("modaltitle"),body:bodyPromise,footer:footerPromise},trigger)}(element)}}}));
/**
 * Controls all of the behaviour and interaction with a tool type card. These are
 * listed on the LTI tool type management page.
 *
 * See template: mod_lti/tool_proxy_card
 *
 * @module     mod_lti/tool_proxy_card_controller
 * @class      tool_card_controller
 * @package    mod_lti
 * @copyright  2016 John Okely <john@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_lti/tool_proxy_card_controller",["jquery","core/ajax","core/notification","core/templates","mod_lti/tool_proxy","mod_lti/events","mod_lti/keys","core/str"],(function($,ajax,notification,templates,toolProxy,ltiEvents,KEYS,str){var SELECTORS_DELETE_BUTTON=".delete",SELECTORS_ACTIVATE_BUTTON=".tool-card-footer a.activate",getTypeId=function(element){return element.attr("data-proxy-id")},clearAllAnnouncements=function(element){element.removeClass("announcement loading success fail capabilities")},stopLoading=function(element){element.removeClass("announcement loading")},deleteType=function(element){var promise=$.Deferred(),typeId=getTypeId(element);return function(element){clearAllAnnouncements(element),element.addClass("announcement loading")}(element),""===typeId?$.Deferred().resolve():(str.get_strings([{key:"delete",component:"mod_lti"},{key:"delete_confirmation",component:"mod_lti"},{key:"delete",component:"mod_lti"},{key:"cancel",component:"core"}]).done((function(strs){notification.confirm(strs[0],strs[1],strs[2],strs[3],(function(){toolProxy.delete(typeId).done((function(){stopLoading(element),function(element){var promise=$.Deferred();return clearAllAnnouncements(element),element.addClass("announcement success"),setTimeout((function(){element.removeClass("announcement success"),promise.resolve()}),2e3),promise}(element).done((function(){element.remove(),promise.resolve()})).fail(notification.exception)})).fail((function(error){!function(element){var promise=$.Deferred();clearAllAnnouncements(element),element.addClass("announcement fail"),setTimeout((function(){element.removeClass("announcement fail"),promise.resolve()}),2e3)}(element),promise.reject(error)}))}),(function(){stopLoading(element),promise.resolve()}))})).fail((function(error){stopLoading(element),notification.exception(error),promise.reject(error)})),promise)},registerEventListeners=function(element){var deleteButton=function(element){return element.find(SELECTORS_DELETE_BUTTON)}(element);deleteButton.click((function(e){e.preventDefault(),deleteType(element)})),deleteButton.keypress((function(e){e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||e.keyCode!=KEYS.ENTER&&e.keyCode!=KEYS.SPACE||(e.preventDefault(),deleteButton.click())}));var activateButton=function(element){return element.find(SELECTORS_ACTIVATE_BUTTON)}(element);activateButton.click((function(e){e.preventDefault(),function(element){var data={proxyid:getTypeId(element)};$(document).trigger(ltiEvents.START_EXTERNAL_REGISTRATION,data)}(element)})),activateButton.keypress((function(e){e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||e.keyCode!=KEYS.ENTER&&e.keyCode!=KEYS.SPACE||(e.preventDefault(),activateButton.click())}))};return{init:function(element){registerEventListeners(element)}}}));
/**
 * Handles the return params from the external registration page after it
 * redirects back to Moodle.
 *
 * See also: mod/lti/externalregistrationreturn.php
 *
 * @module     mod_lti/external_registration_return
 * @class      external_registration_return
 * @package    mod_lti
 * @copyright  2015 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_lti/external_registration_return",[],(function(){return{init:function(message,error,id,status){window.parent&&window.parent.triggerExternalRegistrationComplete({message:message,error:error,id:id,status:status})}}}));
/**
 * Provides an interface for a tool type in the Moodle server.
 *
 * @module     mod_lti/tool_type
 * @class      tool_type
 * @package    mod_lti
 * @copyright  2015 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_lti/tool_type",["core/ajax","core/notification"],(function(ajax,notification){return{query:function(args){var request={methodname:"mod_lti_get_tool_types",args:args||{}},promise=ajax.call([request])[0];return promise.fail(notification.exception),promise},create:function(args){var request={methodname:"mod_lti_create_tool_type",args:args};return ajax.call([request])[0]},update:function(args){var request={methodname:"mod_lti_update_tool_type",args:args},promise=ajax.call([request])[0];return promise.fail(notification.exception),promise},delete:function(id){var request={methodname:"mod_lti_delete_tool_type",args:{id:id}},promise=ajax.call([request])[0];return promise.fail(notification.exception),promise},getFromToolProxyId:function(id){return this.query({toolproxyid:id})},isCartridge:function(url){var request={methodname:"mod_lti_is_cartridge",args:{url:url}};return ajax.call([request])[0]},constants:{state:{configured:1,pending:2,rejected:3}}}}));
/**
 * Encapsules the behavior for creating a tool type and tool proxy from a
 * registration url in Moodle.
 *
 * Manages the UI while operations are occuring, including rendering external
 * registration page within the iframe.
 *
 * See template: mod_lti/external_registration
 *
 * @module     mod_lti/external_registration
 * @class      external_registration
 * @package    mod_lti
 * @copyright  2015 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_lti/external_registration",["jquery","core/ajax","core/notification","core/templates","mod_lti/events","mod_lti/tool_proxy","mod_lti/tool_type","mod_lti/keys","core/str"],(function($,ajax,notification,templates,ltiEvents,toolProxy,toolType,KEYS,str){var SELECTORS_EXTERNAL_REGISTRATION_CONTAINER="#external-registration-page-container",SELECTORS_EXTERNAL_REGISTRATION_TEMPLATE_CONTAINER="#external-registration-template-container",SELECTORS_EXTERNAL_REGISTRATION_CANCEL_BUTTON="#cancel-external-registration",SELECTORS_TOOL_TYPE_CAPABILITIES_CONTAINER="#tool-type-capabilities-container",SELECTORS_TOOL_TYPE_CAPABILITIES_TEMPLATE_CONTAINER="#tool-type-capabilities-template-container",SELECTORS_CAPABILITIES_AGREE_CONTAINER=".capabilities-container",getExternalRegistrationCancelButton=function(){return $(SELECTORS_EXTERNAL_REGISTRATION_CANCEL_BUTTON)},getExternalRegistrationContainer=function(){return $(SELECTORS_EXTERNAL_REGISTRATION_CONTAINER)},getExternalRegistrationTemplateContainer=function(){return $(SELECTORS_EXTERNAL_REGISTRATION_TEMPLATE_CONTAINER)},getToolTypeCapabilitiesContainer=function(){return $(SELECTORS_TOOL_TYPE_CAPABILITIES_CONTAINER)},stopLoadingCancel=function(){getExternalRegistrationCancelButton().removeClass("loading")},hideExternalRegistrationContent=function(){getExternalRegistrationContainer().addClass("hidden")},getToolProxyId=function(){return getExternalRegistrationCancelButton().attr("data-tool-proxy-id")},hasToolProxyId=function(){return!!getToolProxyId()},hasCreatedToolProxy=function(){return getExternalRegistrationCancelButton().attr("data-tool-proxy-new")&&hasToolProxyId()},cancelRegistration=function(){getExternalRegistrationCancelButton().addClass("loading");var promise=$.Deferred();if(hasCreatedToolProxy()){var id=getToolProxyId();toolProxy.delete(id).done((function(){promise.resolve()})).fail((function(failure){promise.reject(failure)}))}else promise.resolve();return promise.done((function(){finishExternalRegistration(),stopLoadingCancel()})).fail((function(failure){notification.exception(failure),finishExternalRegistration(),stopLoadingCancel(),str.get_string("failedtodeletetoolproxy","mod_lti").done((function(s){var feedback={message:s,error:!0};$(document).trigger(ltiEvents.REGISTRATION_FEEDBACK,feedback)})).fail(notification.exception)})),promise},renderExternalRegistrationWindow=function(registrationRequest){var promise=templates.render("mod_lti/tool_proxy_registration_form",registrationRequest);return promise.done((function(html,js){var container=getExternalRegistrationTemplateContainer();container.append(html),templates.runTemplateJS(js),container.find("form").submit(),getExternalRegistrationContainer().removeClass("hidden")})).fail(notification.exception),promise},promptForToolTypeCapabilitiesAgreement=function(typeData){var promise=$.Deferred();return templates.render("mod_lti/tool_type_capabilities_agree",typeData).done((function(html,js){var container=$(SELECTORS_TOOL_TYPE_CAPABILITIES_TEMPLATE_CONTAINER);hideExternalRegistrationContent(),getToolTypeCapabilitiesContainer().removeClass("hidden"),templates.replaceNodeContents(container,html,js);var choiceContainer=container.find(SELECTORS_CAPABILITIES_AGREE_CONTAINER);choiceContainer.on(ltiEvents.CAPABILITIES_AGREE,(function(){getToolTypeCapabilitiesContainer().addClass("loading"),function(typeData){return toolType.update({id:typeData.id,state:toolType.constants.state.configured})}(typeData).always((function(){getToolTypeCapabilitiesContainer().removeClass("loading"),container.empty(),promise.resolve()}))})),choiceContainer.on(ltiEvents.CAPABILITIES_DECLINE,(function(){container.empty(),promise.resolve()}))})).fail(promise.reject),promise.done((function(){getToolTypeCapabilitiesContainer().addClass("hidden")})).fail(notification.exception),promise},createAndRegisterToolProxy=function(url){var promise=$.Deferred();return url&&""!==url?toolProxy.create({regurl:url}).done((function(result){getExternalRegistrationCancelButton().attr("data-tool-proxy-new","new"),promise=registerProxy(result.id)})).fail((function(exception){cancelRegistration();var feedback={message:exception.message,error:!0};$(document).trigger(ltiEvents.REGISTRATION_FEEDBACK,feedback),promise.reject(exception)})):promise.resolve(),promise},registerProxy=function(id){var promise=$.Deferred();return function(id){getExternalRegistrationCancelButton().attr("data-tool-proxy-id",id)}(id),function(id){var request={methodname:"mod_lti_get_tool_proxy_registration_request",args:{id:id}};return ajax.call([request])[0]}(id).done((function(registrationRequest){renderExternalRegistrationWindow(registrationRequest).done((function(){promise.resolve()})).fail(promise.fail)})).fail(promise.fail),promise},finishExternalRegistration=function(){hasToolProxyId()&&getExternalRegistrationCancelButton().removeAttr("data-tool-proxy-id"),getExternalRegistrationCancelButton().removeAttr("data-tool-proxy-new"),hideExternalRegistrationContent(),getExternalRegistrationTemplateContainer().empty(),$(document).trigger(ltiEvents.STOP_EXTERNAL_REGISTRATION)};return{init:function(){!function(){$(document).on(ltiEvents.START_EXTERNAL_REGISTRATION,(function(event,data){data&&(data.url&&createAndRegisterToolProxy(data.url),data.proxyid&&registerProxy(data.proxyid))}));var cancelExternalRegistrationButton=getExternalRegistrationCancelButton();cancelExternalRegistrationButton.click((function(e){e.preventDefault(),cancelRegistration()})),cancelExternalRegistrationButton.keypress((function(e){e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||e.keyCode!=KEYS.ENTER&&e.keyCode!=KEYS.SPACE||(e.preventDefault(),cancelRegistration())})),window.triggerExternalRegistrationComplete=function(data){var promise=$.Deferred(),feedback={message:"",error:!1};if("success"==data.status){if(str.get_string("successfullycreatedtooltype","mod_lti").done((function(s){feedback.message=s})).fail(notification.exception),promise.done((function(){finishExternalRegistration(),$(document).trigger(ltiEvents.REGISTRATION_FEEDBACK,feedback),$(document).trigger(ltiEvents.NEW_TOOL_TYPE)})).fail(notification.exception),hasCreatedToolProxy()){var proxyId=getToolProxyId();toolType.getFromToolProxyId(proxyId).done((function(types){if(types&&types.length){var typeData=types[0];typeData.hascapabilitygroups?promptForToolTypeCapabilitiesAgreement(typeData).always((function(){promise.resolve()})):promise.resolve()}else promise.resolve()})).fail((function(){promise.resolve()}))}}else feedback.message=data.error,feedback.error=!0,promise.done((function(){cancelRegistration().always((function(){$(document).trigger(ltiEvents.REGISTRATION_FEEDBACK,feedback)}))})).fail(notification.exception),promise.resolve();return promise}}()}}}));
/**
 * Processes the result of LTI tool creation from a Content-Item message type.
 *
 * @module     mod_lti/contentitem_return
 * @class      contentitem_return
 * @package    mod_lti
 * @copyright  2016 Jun Pataleta <jun@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.2
 */
define("mod_lti/contentitem_return",["jquery"],(function($){return{init:function(returnData){$(window).ready((function(){window!=top?parent.processContentItemReturnData(returnData):window.processContentItemReturnData(returnData)}))}}}));
/**
 * Encapsules the behavior for creating a tool type from a cartridge URL
 * in Moodle. Manages the UI while operations are occuring.
 *
 * See template: mod_lti/cartridge_registration_form
 *
 * @module     mod_lti/cartridge_registration_form
 * @class      cartridge_registration_form
 * @package    mod_lti
 * @copyright  2015 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_lti/cartridge_registration_form",["jquery","core/ajax","core/notification","mod_lti/tool_type","mod_lti/events","mod_lti/keys","core/str"],(function($,ajax,notification,toolType,ltiEvents,KEYS,str){var SELECTORS_CONSUMER_KEY="#registration-key",SELECTORS_SHARED_SECRET="#registration-secret",SELECTORS_REGISTRATION_FORM="#cartridge-registration-form",SELECTORS_REGISTRATION_SUBMIT_BUTTON="#cartridge-registration-submit",SELECTORS_REGISTRATION_CANCEL_BUTTON="#cartridge-registration-cancel",getSubmitButton=function(){return $(SELECTORS_REGISTRATION_SUBMIT_BUTTON)},submitCartridgeURL=function(){if(getSubmitButton().hasClass("loading"))return!1;var url=$(SELECTORS_REGISTRATION_FORM).attr("data-cartridge-url");if(""===url)return!1;getSubmitButton().addClass("loading");var consumerKey=$(SELECTORS_CONSUMER_KEY).val(),sharedSecret=$(SELECTORS_SHARED_SECRET).val(),promise=toolType.create({cartridgeurl:url,key:consumerKey,secret:sharedSecret});return promise.done((function(){str.get_string("successfullycreatedtooltype","mod_lti").done((function(s){$(document).trigger(ltiEvents.NEW_TOOL_TYPE),$(document).trigger(ltiEvents.STOP_CARTRIDGE_REGISTRATION),$(document).trigger(ltiEvents.REGISTRATION_FEEDBACK,{message:s})})).fail(notification.exception)})).fail((function(){str.get_string("failedtocreatetooltype","mod_lti").done((function(s){$(document).trigger(ltiEvents.NEW_TOOL_TYPE),$(document).trigger(ltiEvents.STOP_CARTRIDGE_REGISTRATION),$(document).trigger(ltiEvents.REGISTRATION_FEEDBACK,{message:s,error:!0})})).fail(notification.exception)})).always((function(){getSubmitButton().removeClass("loading")})),promise},registerEventListeners=function(){$(SELECTORS_REGISTRATION_FORM).submit((function(e){e.preventDefault(),submitCartridgeURL()}));var cancelButton=$(SELECTORS_REGISTRATION_CANCEL_BUTTON);cancelButton.click((function(e){e.preventDefault(),$(document).trigger(ltiEvents.STOP_CARTRIDGE_REGISTRATION)})),cancelButton.keypress((function(e){e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||e.keyCode!=KEYS.ENTER&&e.keyCode!=KEYS.SPACE||(e.preventDefault(),cancelButton.click())}))};return{init:function(){registerEventListeners()}}}));
/**
 * Launches the modal dialogue that contains the iframe that sends the Content-Item selection request to an
 * LTI tool provider that supports Content-Item type message.
 *
 * See template: mod_lti/contentitem
 *
 * @module     mod_lti/contentitem
 * @class      contentitem
 * @package    mod_lti
 * @copyright  2016 Jun Pataleta <jun@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.2
 */
define("mod_lti/contentitem",["jquery","core/notification","core/str","core/templates","mod_lti/form-field","core/modal_factory","core/modal_events"],(function($,notification,str,templates,FormField,ModalFactory,ModalEvents){var dialogue,doneCallback,contentItem={init:function(url,postData,cb){doneCallback=cb;var context={url:url,postData:postData},bodyPromise=templates.render("mod_lti/contentitem",context);if(dialogue)return dialogue.setBody(bodyPromise),void dialogue.show();str.get_string("selectcontent","lti").then((function(title){return ModalFactory.create({title:title,body:bodyPromise,large:!0})})).then((function(modal){dialogue=modal,modal.getRoot().on(ModalEvents.hidden,(function(){modal.setBody(""),notification.fetchNotifications()})),modal.show()})).catch(notification.exception)}},ltiFormFields=[new FormField("name",FormField.TYPES.TEXT,!1,""),new FormField("introeditor",FormField.TYPES.EDITOR,!1,""),new FormField("toolurl",FormField.TYPES.TEXT,!0,""),new FormField("securetoolurl",FormField.TYPES.TEXT,!0,""),new FormField("instructorchoiceacceptgrades",FormField.TYPES.CHECKBOX,!0,!0),new FormField("instructorchoicesendname",FormField.TYPES.CHECKBOX,!0,!0),new FormField("instructorchoicesendemailaddr",FormField.TYPES.CHECKBOX,!0,!0),new FormField("instructorcustomparameters",FormField.TYPES.TEXT,!0,""),new FormField("icon",FormField.TYPES.TEXT,!0,""),new FormField("secureicon",FormField.TYPES.TEXT,!0,""),new FormField("launchcontainer",FormField.TYPES.SELECT,!0,0),new FormField("grade_modgrade_point",FormField.TYPES.TEXT,!1,""),new FormField("lineitemresourceid",FormField.TYPES.TEXT,!0,""),new FormField("lineitemtag",FormField.TYPES.TEXT,!0,"")];return window.processContentItemReturnData=function(returnData){var index;for(index in dialogue&&dialogue.hide(),ltiFormFields){var field=ltiFormFields[index],value=null;void 0!==returnData[field.name]&&(value=returnData[field.name]),field.setFieldValue(value)}doneCallback&&doneCallback()},contentItem}));
/**
 * Standard Ajax wrapper for Moodle. It calls the central Ajax script,
 * which can call any existing webservice using the current session.
 * In addition, it can batch multiple requests and return multiple responses.
 *
 * @module     mod_lti/tool_configure_controller
 * @class      tool_configure_controller
 * @package    mod_lti
 * @copyright  2015 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_lti/tool_configure_controller",["jquery","core/ajax","core/notification","core/templates","mod_lti/events","mod_lti/keys","mod_lti/tool_type","mod_lti/tool_proxy","core/str"],(function($,ajax,notification,templates,ltiEvents,KEYS,toolType,toolProxy,str){var SELECTORS_EXTERNAL_REGISTRATION_CONTAINER="#external-registration-container",SELECTORS_CARTRIDGE_REGISTRATION_CONTAINER="#cartridge-registration-container",SELECTORS_CARTRIDGE_REGISTRATION_FORM="#cartridge-registration-form",SELECTORS_ADD_TOOL_FORM="#add-tool-form",SELECTORS_TOOL_LIST_CONTAINER="#tool-list-container",SELECTORS_TOOL_CREATE_BUTTON="#tool-create-button",SELECTORS_REGISTRATION_CHOICE_CONTAINER="#registration-choice-container",SELECTORS_TOOL_URL="#tool-url",getToolListContainer=function(){return $(SELECTORS_TOOL_LIST_CONTAINER)},getExternalRegistrationContainer=function(){return $(SELECTORS_EXTERNAL_REGISTRATION_CONTAINER)},getCartridgeRegistrationContainer=function(){return $(SELECTORS_CARTRIDGE_REGISTRATION_CONTAINER)},getRegistrationChoiceContainer=function(){return $(SELECTORS_REGISTRATION_CHOICE_CONTAINER)},hideExternalRegistration=function(){getExternalRegistrationContainer().addClass("hidden")},hideCartridgeRegistration=function(){getCartridgeRegistrationContainer().addClass("hidden")},hideRegistrationChoices=function(){getRegistrationChoiceContainer().addClass("hidden")},showRegistrationChoices=function(){hideExternalRegistration(),hideCartridgeRegistration(),getRegistrationChoiceContainer().removeClass("hidden"),screenReaderAnnounce(getRegistrationChoiceContainer())},screenReaderAnnounce=function(element){element.children().detach().appendTo(element)},startLoading=function(element){element.addClass("loading")},stopLoading=function(element){element.removeClass("loading")},reloadToolList=function(){var promise=$.Deferred(),container=getToolListContainer();startLoading(container),$.when(toolType.query(),toolProxy.query({orphanedonly:!0})).done((function(types,proxies){templates.render("mod_lti/tool_list",{tools:types,proxies:proxies}).done((function(html,js){container.empty(),container.append(html),templates.runTemplateJS(js),promise.resolve()})).fail(promise.reject)})).fail(promise.reject),promise.fail(notification.exception).always((function(){stopLoading(container)}))},addTool=function(){var url=$(SELECTORS_TOOL_URL).val().trim();if(""===url)return $.Deferred().resolve();var toolButton=$(SELECTORS_TOOL_CREATE_BUTTON);startLoading(toolButton);var promise=toolType.isCartridge(url);return promise.always((function(){stopLoading(toolButton)})),promise.done((function(result){result.iscartridge?($(SELECTORS_TOOL_URL).val(""),$(document).trigger(ltiEvents.START_CARTRIDGE_REGISTRATION,url)):$(document).trigger(ltiEvents.START_EXTERNAL_REGISTRATION,{url:url})})),promise.fail((function(){str.get_string("errorbadurl","mod_lti").done((function(s){$(document).trigger(ltiEvents.REGISTRATION_FEEDBACK,{message:s,error:!0})})).fail(notification.exception)})),promise},registerEventListeners=function(){$(document).on(ltiEvents.NEW_TOOL_TYPE,(function(){reloadToolList()})),$(document).on(ltiEvents.START_EXTERNAL_REGISTRATION,(function(){hideCartridgeRegistration(),hideRegistrationChoices(),getExternalRegistrationContainer().removeClass("hidden"),screenReaderAnnounce(getExternalRegistrationContainer()),$(SELECTORS_TOOL_URL).val(""),getToolListContainer().addClass("hidden")})),$(document).on(ltiEvents.STOP_EXTERNAL_REGISTRATION,(function(){getToolListContainer().removeClass("hidden"),showRegistrationChoices()})),$(document).on(ltiEvents.START_CARTRIDGE_REGISTRATION,(function(event,url){!function(url){hideExternalRegistration(),hideRegistrationChoices();var container=getCartridgeRegistrationContainer();container.find("input").val(""),container.removeClass("hidden"),container.find(SELECTORS_CARTRIDGE_REGISTRATION_FORM).attr("data-cartridge-url",url),screenReaderAnnounce(container)}(url)})),$(document).on(ltiEvents.STOP_CARTRIDGE_REGISTRATION,(function(){getCartridgeRegistrationContainer().find(SELECTORS_CARTRIDGE_REGISTRATION_FORM).removeAttr("data-cartridge-url"),showRegistrationChoices()})),$(document).on(ltiEvents.REGISTRATION_FEEDBACK,(function(event,data){!function(data){var type=data.error?"error":"success";notification.addNotification({message:data.message,type:type})}(data)})),$(SELECTORS_ADD_TOOL_FORM).submit((function(e){e.preventDefault(),addTool()}))};return{init:function(){registerEventListeners(),reloadToolList()}}}));
/**
 * A list of keys and their keycodes that are used by the LTI modules.
 *
 * @module     mod_lti/keys
 * @class      keys
 * @package    mod_lti
 * @copyright  2015 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_lti/keys",[],(function(){return{ENTER:13,SPACE:32}}));
/**
 * Provides an interface for a tool proxy in the Moodle server.
 *
 * @module     mod_lti/tool_proxy
 * @class      tool_proxy
 * @package    mod_lti
 * @copyright  2015 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("mod_lti/tool_proxy",["core/ajax","core/notification"],(function(ajax,notification){return{query:function(args){var request={methodname:"mod_lti_get_tool_proxies",args:args||{}},promise=ajax.call([request])[0];return promise.fail(notification.exception),promise},delete:function(id){var request={methodname:"mod_lti_delete_tool_proxy",args:{id:id}},promise=ajax.call([request])[0];return promise.fail(notification.exception),promise},create:function(args){var request={methodname:"mod_lti_create_tool_proxy",args:args};return ajax.call([request])[0]}}}));
/**
 * Contain the logic for the add random question modal.
 *
 * @module     mod_quiz/modal_add_random_question
 * @package    mod_quiz
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_quiz/modal_add_random_question",["jquery","core/yui","core/notification","core/modal","core/modal_events","core/modal_registry","core/fragment","core/templates"],(function($,Y,Notification,Modal,ModalEvents,ModalRegistry,Fragment,Templates){var registered=!1,SELECTORS_EXISTING_CATEGORY_CONTAINER='[data-region="existing-category-container"]',SELECTORS_EXISTING_CATEGORY_FORM_ELEMENT="#id_existingcategoryheader",SELECTORS_NEW_CATEGORY_CONTAINER='[data-region="new-category-container"]',SELECTORS_NEW_CATEGORY_FORM_ELEMENT="#id_newcategoryheader",SELECTORS_TAB_CONTENT='[data-region="tab-content"]',SELECTORS_ADD_ON_PAGE_FORM_ELEMENT='[name="addonpage"]',SELECTORS_SUBMIT_BUTTON_ELEMENT='input[type="submit"]',SELECTORS_CANCEL_BUTTON_ELEMENT='input[type="submit"][name="cancel"]',SELECTORS_FORM_HEADER="legend",SELECTORS_BUTTON_CONTAINER=".fitem",ModalAddRandomQuestion=function(root){Modal.call(this,root),this.contextId=null,this.addOnPageId=null,this.category=null,this.returnUrl=null,this.cmid=null,this.loadedForm=!1};return ModalAddRandomQuestion.TYPE="mod_quiz-quiz-add-random-question",(ModalAddRandomQuestion.prototype=Object.create(Modal.prototype)).constructor=ModalAddRandomQuestion,ModalAddRandomQuestion.prototype.setContextId=function(id){this.contextId=id},ModalAddRandomQuestion.prototype.getContextId=function(){return this.contextId},ModalAddRandomQuestion.prototype.setAddOnPageId=function(id){this.addOnPageId=id,this.getBody().find(SELECTORS_ADD_ON_PAGE_FORM_ELEMENT).val(id)},ModalAddRandomQuestion.prototype.getAddOnPageId=function(){return this.addOnPageId},ModalAddRandomQuestion.prototype.setCategory=function(category){this.category=category},ModalAddRandomQuestion.prototype.getCategory=function(){return this.category},ModalAddRandomQuestion.prototype.setReturnUrl=function(url){this.returnUrl=url},ModalAddRandomQuestion.prototype.getReturnUrl=function(){return this.returnUrl},ModalAddRandomQuestion.prototype.setCMID=function(id){this.cmid=id},ModalAddRandomQuestion.prototype.getCMID=function(){return this.cmid},ModalAddRandomQuestion.prototype.moveFormElementIntoTab=function(formElement,tabElement){var submitButtons=formElement.find(SELECTORS_SUBMIT_BUTTON_ELEMENT),footer=$('<div class="modal-footer mt-1" data-region="footer"></div>');formElement.find(SELECTORS_FORM_HEADER).addClass("hidden"),formElement.wrap(tabElement),submitButtons.closest(SELECTORS_BUTTON_CONTAINER).remove(),submitButtons.appendTo(footer),footer.appendTo(formElement)},ModalAddRandomQuestion.prototype.moveTabsIntoTabContent=function(form){var tabContent=this.getBody().find(SELECTORS_TAB_CONTENT).empty();form.find('[role="tabpanel"]').wrapAll(tabContent)},ModalAddRandomQuestion.prototype.moveCancelButtonToTabs=function(form){var cancelButton=form.find(SELECTORS_CANCEL_BUTTON_ELEMENT).addClass("ml-1"),tabFooters=form.find('[data-region="footer"]');cancelButton.closest(SELECTORS_BUTTON_CONTAINER).remove(),cancelButton.clone().appendTo(tabFooters)},ModalAddRandomQuestion.prototype.loadForm=function(){return Fragment.loadFragment("mod_quiz","add_random_question_form",this.getContextId(),{addonpage:this.getAddOnPageId(),cat:this.getCategory(),returnurl:this.getReturnUrl(),cmid:this.getCMID()}).then(function(html,js){var form=$(html),existingCategoryFormElement=form.find(SELECTORS_EXISTING_CATEGORY_FORM_ELEMENT),existingCategoryTab=this.getBody().find(SELECTORS_EXISTING_CATEGORY_CONTAINER),newCategoryFormElement=form.find(SELECTORS_NEW_CATEGORY_FORM_ELEMENT),newCategoryTab=this.getBody().find(SELECTORS_NEW_CATEGORY_CONTAINER);this.moveFormElementIntoTab(existingCategoryFormElement,existingCategoryTab),this.moveFormElementIntoTab(newCategoryFormElement,newCategoryTab),this.moveTabsIntoTabContent(form),this.moveCancelButtonToTabs(form),Templates.replaceNode(this.getBody().find(SELECTORS_TAB_CONTENT),form,js)}.bind(this)).then((function(){Y.use("moodle-core-formchangechecker",(function(){M.core_formchangechecker.reset_form_dirty_state()}))})).fail(Notification.exception)},ModalAddRandomQuestion.prototype.show=function(){Modal.prototype.show.call(this),this.loadedForm||(this.loadForm(),this.loadedForm=!0)},registered||(ModalRegistry.register(ModalAddRandomQuestion.TYPE,ModalAddRandomQuestion,"mod_quiz/modal_add_random_question"),registered=!0),ModalAddRandomQuestion}));
/**
 * This class manages the confirmation pop-up (also called the pre-flight check)
 * that is sometimes shown when a use clicks the start attempt button.
 *
 * This is also responsible for opening the pop-up window, if the quiz requires to be in one.
 *
 * @module    mod_quiz/preflightcheck
 * @class     preflightcheck
 * @package   mod_quiz
 * @copyright 2016 The Open University
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since     3.1
 */
define("mod_quiz/preflightcheck",["jquery","core/yui"],(function($,Y){var t={confirmDialogue:null,init:function(startButton,confirmationTitle,confirmationForm,popupoptions){var finalStartButton=startButton;Y.use("moodle-core-notification",(function(){Y.one(confirmationForm)&&(t.confirmDialogue=new M.core.dialogue({headerContent:confirmationTitle,bodyContent:Y.one(confirmationForm),draggable:!0,visible:!1,center:!0,modal:!0,width:null,extraClasses:["mod_quiz_preflight_popup"]}),Y.one(startButton).on("click",t.displayDialogue),Y.one("#id_cancel").on("click",t.hideDialogue),finalStartButton=t.confirmDialogue.get("boundingBox").one('[name="submitbutton"]')),popupoptions&&Y.one(finalStartButton).on("click",t.launchQuizPopup,t,popupoptions)}))},displayDialogue:function(e){e&&e.halt(),t.confirmDialogue.show()},hideDialogue:function(e){e&&e.halt(),t.confirmDialogue.hide(e)},launchQuizPopup:function(e,popupoptions){e.halt(),Y.use("moodle-core-formchangechecker","io-form",(function(){M.core_formchangechecker.reset_form_dirty_state();var form=e.target.ancestor("form");window.openpopup(e,{url:form.get("action")+"?"+Y.IO.stringify(form).replace(/\bcancel=/,"x="),windowname:"quizpopup",options:popupoptions,fullscreen:!0})}))}};return t}));
/**
 * Initialise the add random question modal on the quiz page.
 *
 * @module    mod_quiz/add_random_question
 * @package   mod_quiz
 * @copyright 2018 Ryan Wyllie <ryan@moodle.com>
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_quiz/add_random_question",["mod_quiz/add_question_modal_launcher","mod_quiz/modal_add_random_question"],(function(AddQuestionModalLauncher,ModalAddRandomQuestion){return{init:function(contextId,category,returnUrl,cmid){AddQuestionModalLauncher.init(ModalAddRandomQuestion.TYPE,'.menu [data-action="addarandomquestion"]',contextId,(function(triggerElement,modal){modal.setCategory(category),modal.setReturnUrl(returnUrl),modal.setCMID(cmid)}))}}}));
/**
 * JavaScript for the random_question_form_preview of the
 * add_random_form class.
 *
 * @module    mod_quiz/random_question_form_preview
 * @package   mod_quiz
 * @copyright 2018 Ryan Wyllie <ryan@moodle.com>
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_quiz/random_question_form_preview",["jquery","core/ajax","core/str","core/notification","core/templates","core/paged_content_factory"],(function($,Ajax,Str,Notification,Templates,PagedContentFactory){var TEMPLATE_NAME="mod_quiz/random_question_form_preview_question_list",SELECTORS_LOADING_ICON_CONTAINER='[data-region="overlay-icon-container"]',SELECTORS_QUESTION_COUNT_CONTAINER='[data-region="question-count-container"]',SELECTORS_QUESTION_LIST_CONTAINER='[data-region="question-list-container"]',showLoadingIcon=function(root){root.find(SELECTORS_LOADING_ICON_CONTAINER).removeClass("hidden")},hideLoadingIcon=function(root){root.find(SELECTORS_LOADING_ICON_CONTAINER).addClass("hidden")},requestQuestions=function(categoryId,includeSubcategories,tagIds,contextId,limit,offset){var request={methodname:"core_question_get_random_question_summaries",args:{categoryid:categoryId,includesubcategories:includeSubcategories,tagids:tagIds,contextid:contextId,limit:limit,offset:offset}};return Ajax.call([request])[0]};return{reload:function(root,categoryId,includeSubcategories,tagIds,contextId){return showLoadingIcon(root),requestQuestions(categoryId,includeSubcategories,tagIds,contextId,5,0).then((function(response){var totalCount=response.totalcount;return function(root,questionCount){Str.get_string("questionsmatchingfilter","mod_quiz",questionCount).then((function(string){root.find(SELECTORS_QUESTION_COUNT_CONTAINER).html(string)})).fail(Notification.exception)}(root,totalCount),response})).then((function(response){var totalQuestionCount=response.totalcount,questions=response.questions;return questions.length?function(categoryId,includeSubcategories,tagIds,contextId,totalQuestionCount,firstPageQuestions){return PagedContentFactory.createFromAjax(totalQuestionCount,5,(function(pagesData){return pagesData.map((function(pageData){var limit=pageData.limit,offset=pageData.offset;return 0==offset?Templates.render(TEMPLATE_NAME,{questions:firstPageQuestions}):requestQuestions(categoryId,includeSubcategories,tagIds,contextId,limit,offset).then((function(response){var questions=response.questions;return Templates.render(TEMPLATE_NAME,{questions:questions})})).fail(Notification.exception)}))}))}(categoryId,includeSubcategories,tagIds,contextId,totalQuestionCount,questions):$.Deferred().resolve("","")})).then((function(html,js){var container=root.find(SELECTORS_QUESTION_LIST_CONTAINER);Templates.replaceNodeContents(container,html,js)})).always((function(){hideLoadingIcon(root)})).fail(Notification.exception)},showLoadingIcon:showLoadingIcon,hideLoadingIcon:hideLoadingIcon}}));
/**
 * Initialise the an add question modal on the quiz page.
 *
 * @module    mod_quiz/add_question_modal_launcher
 * @package   mod_quiz
 * @copyright 2018 Ryan Wyllie <ryan@moodle.com>
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_quiz/add_question_modal_launcher",["jquery","core/notification","core/modal_factory"],(function($,Notification,ModalFactory){return{init:function(modalType,selector,contextId,_preShowCallback){var body=$("body");return ModalFactory.create({type:modalType,large:!0,preShowCallback:function(triggerElement,modal){triggerElement=$(triggerElement),modal.setContextId(contextId),modal.setAddOnPageId(triggerElement.attr("data-addonpage")),modal.setTitle(triggerElement.attr("data-header")),_preShowCallback&&_preShowCallback(triggerElement,modal)}},[body,selector]).fail(Notification.exception)}}}));
/**
 * Contain the logic for the question bank modal.
 *
 * @module     mod_quiz/modal_quiz_question_bank
 * @package    mod_quiz
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_quiz/modal_quiz_question_bank",["jquery","core/yui","core/notification","core/modal","core/modal_events","core/modal_registry","core/fragment"],(function($,Y,Notification,Modal,ModalEvents,ModalRegistry,Fragment){var registered=!1,SELECTORS_ADD_TO_QUIZ_CONTAINER="td.addtoquizaction",SELECTORS_ANCHOR="a[href]",SELECTORS_PREVIEW_CONTAINER="td.previewaction",SELECTORS_SEARCH_OPTIONS="#advancedsearch",SELECTORS_DISPLAY_OPTIONS="#displayoptions",SELECTORS_ADD_QUESTIONS_FORM='form[action="edit.php"]',ModalQuizQuestionBank=function(root){Modal.call(this,root),this.contextId=null,this.addOnPageId=null};return ModalQuizQuestionBank.TYPE="mod_quiz-quiz-question-bank",(ModalQuizQuestionBank.prototype=Object.create(Modal.prototype)).constructor=ModalQuizQuestionBank,ModalQuizQuestionBank.prototype.setContextId=function(id){this.contextId=id},ModalQuizQuestionBank.prototype.getContextId=function(){return this.contextId},ModalQuizQuestionBank.prototype.setAddOnPageId=function(id){this.addOnPageId=id},ModalQuizQuestionBank.prototype.getAddOnPageId=function(){return this.addOnPageId},ModalQuizQuestionBank.prototype.show=function(){return this.reloadBodyContent(window.location.search),Modal.prototype.show.call(this)},ModalQuizQuestionBank.prototype.reloadBodyContent=function(queryString){var promise=Fragment.loadFragment("mod_quiz","quiz_question_bank",this.getContextId(),{querystring:queryString}).fail(Notification.exception);this.setBody(promise)},ModalQuizQuestionBank.prototype.handleAddToQuizEvent=function(e,anchorElement){var href=anchorElement.attr("href")+"&addonpage="+this.getAddOnPageId();anchorElement.attr("href",href)},ModalQuizQuestionBank.prototype.handlePreviewContainerEvent=function(e,anchorElement){window.openpopup(e,{url:anchorElement.attr("href"),name:"questionpreview",options:["height=600","width=800","top=0","left=0","menubar=0","location=0","scrollbars","resizable","toolbar","status","directories=0","fullscreen=0","dependent"].join(",")})},ModalQuizQuestionBank.prototype.handleDisplayOptionFormEvent=function(e){e.stopPropagation(),e.preventDefault();var queryString="?"+$(e.target).closest(SELECTORS_DISPLAY_OPTIONS).serialize();this.reloadBodyContent(queryString)},ModalQuizQuestionBank.prototype.registerDisplayOptionListeners=function(){this.getModal().on("change",SELECTORS_DISPLAY_OPTIONS,function(e){$(e.target).attr("aria-autocomplete")||this.handleDisplayOptionFormEvent(e)}.bind(this)),this.getModal().on("submit",SELECTORS_DISPLAY_OPTIONS,function(e){this.handleDisplayOptionFormEvent(e)}.bind(this))},ModalQuizQuestionBank.prototype.registerEventListeners=function(){Modal.prototype.registerEventListeners.call(this),this.registerDisplayOptionListeners(),this.getModal().on("submit",SELECTORS_ADD_QUESTIONS_FORM,function(e){var formElement=$(e.currentTarget);$("<input />").attr("type","hidden").attr("name","addonpage").attr("value",this.getAddOnPageId()).appendTo(formElement)}.bind(this)),this.getModal().on("click",SELECTORS_ANCHOR,function(e){var anchorElement=$(e.currentTarget);anchorElement.closest(SELECTORS_ADD_TO_QUIZ_CONTAINER).length?this.handleAddToQuizEvent(e,anchorElement):anchorElement.closest(SELECTORS_PREVIEW_CONTAINER).length?this.handlePreviewContainerEvent(e,anchorElement):anchorElement.closest(SELECTORS_SEARCH_OPTIONS).length||(e.preventDefault(),this.reloadBodyContent(anchorElement.prop("search")))}.bind(this)),this.getRoot().on(ModalEvents.bodyRendered,(function(){Y.use("moodle-core-formchangechecker",(function(){M.core_formchangechecker.reset_form_dirty_state()}))}))},registered||(ModalRegistry.register(ModalQuizQuestionBank.TYPE,ModalQuizQuestionBank,"core/modal"),registered=!0),ModalQuizQuestionBank}));
/**
 * JavaScript for the add_random_form class.
 *
 * @module    mod_quiz/add_random_form
 * @package   mod_quiz
 * @copyright 2018 Ryan Wyllie <ryan@moodle.com>
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_quiz/add_random_form",["jquery","mod_quiz/random_question_form_preview"],(function($,RandomQuestionFormPreview){var SELECTORS_PREVIEW_CONTAINER='[data-region="random-question-preview-container"]',SELECTORS_CATEGORY_FORM_ELEMENT='[name="category"]',SELECTORS_SUBCATEGORY_FORM_ELEMENT='[name="includesubcategories"]',SELECTORS_TAG_IDS_FORM_ELEMENT='[name="fromtags[]"]',getCategorySelectValue=function(form){return form.find(SELECTORS_CATEGORY_FORM_ELEMENT).val()},shouldIncludeSubcategories=function(form,topCategories){return!!function(form,topCategories){var selectedValue=getCategorySelectValue(form);return topCategories.indexOf(selectedValue)>-1}(form,topCategories)||form.find(SELECTORS_SUBCATEGORY_FORM_ELEMENT).is(":checked")},reloadQuestionPreview=function(form,contextId,topCategories){var previewContainer=form.find(SELECTORS_PREVIEW_CONTAINER);RandomQuestionFormPreview.reload(previewContainer,function(form){return getCategorySelectValue(form).split(",")[0]}(form),shouldIncludeSubcategories(form,topCategories),function(form){return form.find(SELECTORS_TAG_IDS_FORM_ELEMENT).val().map((function(value){return value.split(",")[0]}))}(form),contextId)},addEventListeners=function(form,contextId,topCategories){var reloadTimerId=null;form.on("change",(function(e){var element;((element=$(e.target)).closest(SELECTORS_CATEGORY_FORM_ELEMENT).length>0||element.closest(SELECTORS_SUBCATEGORY_FORM_ELEMENT).length>0||element.closest(SELECTORS_TAG_IDS_FORM_ELEMENT).length>0)&&(RandomQuestionFormPreview.showLoadingIcon(form),reloadTimerId&&clearTimeout(reloadTimerId),reloadTimerId=setTimeout((function(){reloadQuestionPreview(form,contextId,topCategories)}),2e3))}))};return{init:function(formId,contextId,topCategories,isTagsEnabled){if(1==isTagsEnabled){var form=$("#"+formId);reloadQuestionPreview(form,contextId,topCategories),addEventListeners(form,contextId,topCategories)}}}}));
/**
 * Initialise the repaginate dialogue on quiz editing page.
 *
 * @module    mod_quiz/repaginate
 * @package   mod_quiz
 * @copyright 2019 The Open University
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_quiz/repaginate",["jquery","core/modal_factory"],(function($,ModalFactory){var SELECTORS_REPAGINATECOMMAND="#repaginatecommand",SELECTORS_HEADER="header",SELECTORS_BODY="form";return{init:function(){ModalFactory.create({title:$(SELECTORS_REPAGINATECOMMAND).data(SELECTORS_HEADER),body:$(SELECTORS_REPAGINATECOMMAND).data(SELECTORS_BODY),large:!1},$(SELECTORS_REPAGINATECOMMAND))}}}));
/**
 * Initialise the question bank modal on the quiz page.
 *
 * @module    mod_quiz/quizquestionbank
 * @package   mod_quiz
 * @copyright 2018 Ryan Wyllie <ryan@moodle.com>
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_quiz/quizquestionbank",["mod_quiz/add_question_modal_launcher","mod_quiz/modal_quiz_question_bank"],(function(AddQuestionModalLauncher,ModalQuizQuestionBank){return{init:function(contextId){AddQuestionModalLauncher.init(ModalQuizQuestionBank.TYPE,'.menu [data-action="questionbank"]',contextId)}}}));
/*
 * Control the element in comment area.
 *
 * @module    mod_studentquiz/comment_area
 * @copyright 2020 The Open University
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_studentquiz/comment_area",["jquery","core/str","core/ajax","core/modal_factory","core/templates","core/fragment","core/modal_events"],(function($,str,ajax,ModalFactory,Templates,fragment,ModalEvents){var t={EMPTY_CONTENT:["<br><p><br></p>","<p><br></p>","<br>",""],ROOT_COMMENT_VALUE:0,GET_ALL_VALUE:0,TEMPLATE_COMMENTS:"mod_studentquiz/comments",TEMPLATE_COMMENT:"mod_studentquiz/comment",ACTION_CREATE:"mod_studentquiz_create_comment",ACTION_CREATE_REPLY:"mod_studentquiz_create_reply",ACTION_GET_ALL:"mod_studentquiz_get_comments",ACTION_EXPAND:"mod_studentquiz_expand_comment",ACTION_DELETE:"mod_studentquiz_delete_comment",ACTION_EDIT:"mod_studentquiz_edit_comment",ACTION_LOAD_FRAGMENT_FORM:"mod_studentquiz_load_fragment_form",ACTION_LOAD_FRAGMENT_EDIT_FORM:"mod_studentquiz_load_fragment_edit_form",ACTION_EXPAND_ALL:"action_expand_all",ACTION_COLLAPSE_ALL:"action_collapse_all",ACTION_RENDER_COMMENT:"action_render_comment",ACTION_APPEND_COMMENT:"action_append_comment",ACTION_EDITOR_INIT:"action_editor_init",ACTION_INIT:"action_init",ACTION_UPDATE_COMMENT_COUNT:"action_update_comment_count",ACTION_CLEAR_FORM:"action_clear_form",ACTION_SHOW_ERROR:"action_show_error",FRAGMENT_FORM_CALLBACK:"commentform",FRAGMENT_EDIT_FORM_CALLBACK:"commenteditform",HAS_COMMENT_CLASS:"has-comment",ATTO_CONTENT_TYPE:{HAS_CONTENT:"has-content",NO_CONTENT:"no-content"},SELECTOR:{CONTAINER:".studentquiz-comment-container",EXPAND_ALL:".studentquiz-comment-expand",COLLAPSE_ALL:".studentquiz-comment-collapse",SUBMIT_BUTTON:"#id_submitbutton",CONTAINER_REPLIES:".studentquiz-container-replies",COMMENT_REPLIES_CONTAINER:".studentquiz-comment-replies",COMMENT_COUNT:".studentquiz-comment-postcount",COMMENT_TEXT_CONTAINER:".studentquiz-comment-text",COMMENT_TEXT:".studentquiz-comment-text-inside",COMMENT_HISTORY:".studentquiz-comment-history",COMMENT_REPLIES_TEXT:".studentquiz-comment-replies .studentquiz-comment-text .studentquiz-comment-text-inside",LOADING_ICON:".studentquiz-comment-loading",COMMENT_AREA_FORM:"div.comment-area-form",FORM_SELECTOR:".studentquiz-comment-postform > div.comment-area-form",NO_COMMENT:".no-comment",COLLAPSE_LINK:".studentquiz-comment-collapselink",EXPAND_LINK:".studentquiz-comment-expandlink",COMMENT_ITEM:".studentquiz-comment-item",COMMENT_REPLIES_CONTAINER_TO_ITEM:".studentquiz-comment-replies .studentquiz-comment-item",FRAGMENT_FORM:".studentquiz-comment-postfragmentform",BTN_DELETE:".studentquiz-comment-btndelete",BTN_REPLY:".studentquiz-comment-btnreply",BTN_DELETE_REPLY:".studentquiz-comment-btndeletereply",ATTO_EDITOR_WRAP:".editor_atto_wrap",TEXTAREA:'textarea[id^="id_editor_question_"]',COMMENT_COUNT_NUMBER:".studentquiz-comment-count-number",COMMENT_COUNT_TEXT:".studentquiz-comment-count-text",ATTO:{CONTENT_WRAP:".editor_atto_content_wrap",CONTENT:".editor_atto_content",TOOLBAR:".editor_atto_toolbar"},COMMENT_ID:"#comment_",SPAN_COMMENT_ID:"#c",TOTAL_REPLY:".studentquiz-comment-totalreply",COMMENT_FILTER:".studentquiz-comment-filter",COMMENT_FILTER_HIDE:".hide-comment-filter",COMMENT_ERROR:".studentquiz-comment-container .comment-error",BTN_REPORT:".studentquiz-comment-btnreport",COMMENT_FILTER_ITEM:".studentquiz-comment-filter-item",COMMENT_FILTER_NAME:".studentquiz-comment-filter-name",COMMENT_FILTER_TYPE:".studentquiz-comment-filter-type",BTN_EDIT:".studentquiz-comment-btnedit",BTN_EDIT_REPLY:".studentquiz-comment-btneditreply",ATTO_HTML_BUTTON:"button.atto_html_button",POST_FOOTER:".studentquiz-comment-postfooter"},get:function(){return{elementSelector:null,btnExpandAll:null,btnCollapseAll:null,addComment:null,containerSelector:null,questionId:null,dialogue:null,loadingIcon:null,lastFocusElement:null,formSelector:null,contextId:null,userId:null,string:{},deleteDialog:null,deleteTarget:null,numberToShow:5,cmId:null,countServerData:[],lastCurrentCount:0,lastTotal:0,expand:!1,forceCommenting:!1,canViewDeleted:!1,hasComment:!1,referer:null,highlight:0,sortFeature:null,sortable:[],workingState:!1,isNoComment:!1,type:0,init:function(params){M.util.js_pending(t.ACTION_INIT);this.elementSelector=$("#"+$.escapeSelector(params.id));var el=this.elementSelector;this.btnExpandAll=el.find(t.SELECTOR.EXPAND_ALL),this.btnCollapseAll=el.find(t.SELECTOR.COLLAPSE_ALL),this.addComment=el.find(t.SELECTOR.SUBMIT_BUTTON),this.containerSelector=el.find(t.SELECTOR.CONTAINER_REPLIES),this.loadingIcon=el.find(t.SELECTOR.LOADING_ICON),this.formSelector=el.find(t.SELECTOR.FORM_SELECTOR),this.questionId=parseInt(el.data("questionid")),this.contextId=parseInt(el.data("contextid")),this.userId=parseInt(el.data("userid")),this.numberToShow=parseInt(el.data("numbertoshow")),this.cmId=parseInt(el.data("cmid")),this.countServerData={count:params.count,total:params.total},this.expand=params.expand||!1,this.referer=el.data("referer"),this.sortFeature=params.sortfeature,this.sortable=el.data("sortable"),this.type=params.type,this.string=el.data("strings"),this.forceCommenting=params.forcecommenting,this.canViewDeleted=params.canviewdeleted,this.isNoComment=params.isnocomment,this.allowSelfCommentRating=params.allowselfcommentrating,this.initServerRender(),params.allowselfcommentrating&&this.initBindEditor(),this.bindEvents(),M.util.js_complete(t.ACTION_INIT)},initServerRender:function(){var self=this;self.changeWorkingState(!0),self.elementSelector.find(t.SELECTOR.COMMENT_ITEM).each((function(){var id=$(this).data("id"),attrs=$(this).find(t.SELECTOR.SPAN_COMMENT_ID+id),replies=[];self.expand&&(replies=attrs.data("replies")||[]);var comment={id:$(this).data("id"),deleted:attrs.data("deleted"),numberofreply:attrs.data("numberofreply"),expanded:self.expand,replies:replies,root:!0,type:self.type};self.bindCommentEvent(comment)}));var commentcount=self.expand?self.countServerData.total:self.countServerData.count.commentcount;self.updateCommentCount(commentcount,self.countServerData.total),self.expand?(self.btnExpandAll.hide(),self.btnCollapseAll.show()):(self.btnExpandAll.show(),self.btnCollapseAll.hide());var query=window.location.search.substring(1),getParams=self.parseQueryString(query);if(self.highlight=parseInt(getParams.highlight)||0,0!==self.highlight){var target=$(t.SELECTOR.COMMENT_ID+self.highlight);target.length&&self.scrollToElement(target)}self.changeWorkingState(!1)},initBindEditor:function(){var self=this,isEditorLoaded=!1;M.util.js_pending(t.ACTION_EDITOR_INIT);var interval=setInterval((function(){0!==self.formSelector.find(t.SELECTOR.ATTO.CONTENT).length&&(self.bindEditorEvent(self.formSelector),isEditorLoaded=!0,clearInterval(interval),M.util.js_complete(t.ACTION_EDITOR_INIT))}),500),editorWaiting=setInterval((function(){isEditorLoaded&&(self.checkEditorContent(self.formSelector),clearInterval(editorWaiting))}),1e3)},bindEvents:function(){var self=this;self.btnExpandAll.click((function(e){e.preventDefault(),M.util.js_pending(t.ACTION_EXPAND_ALL),self.changeWorkingState(!0),self.containerSelector.empty(),self.btnExpandAll.hide(),self.btnCollapseAll.show(),self.loadingIcon.show(),self.getComments(t.GET_ALL_VALUE).then((function(response){var total=self.countCommentAndReplies(response.data).total;return self.updateCommentCount(total,response.total),self.renderComment(response.data,!0),M.util.js_complete(t.ACTION_EXPAND_ALL),!0})).fail((function(err){return M.util.js_complete(t.ACTION_EXPAND_ALL),self.showError(err.message),!1}))})),self.btnCollapseAll.click((function(e){e.preventDefault(),M.util.js_pending(t.ACTION_COLLAPSE_ALL),self.changeWorkingState(!0),self.loadingIcon.show(),self.btnCollapseAll.hide(),self.btnExpandAll.show(),self.containerSelector[0].innerHTML="",self.getComments(self.numberToShow).then((function(response){var count=self.countCommentAndReplies(response.data),commentCount=count.commentCount,deletedComments=count.totalDelete;return 0!==commentCount||0!==deletedComments?(self.btnExpandAll.show(),self.updateCommentCount(commentCount,response.total),self.renderComment(response.data,!1)):(self.loadingIcon.hide(),self.changeWorkingState(!1),self.updateCommentCount(0,0)),M.util.js_complete(t.ACTION_COLLAPSE_ALL),!0})).fail((function(err){return M.util.js_complete(t.ACTION_COLLAPSE_ALL),self.showError(err.message),!1}))})),self.addComment.click((function(e){e.preventDefault(),M.util.js_pending(t.ACTION_CREATE),self.changeWorkingState(!0),self.loadingIcon.show(),$(t.SELECTOR.COMMENT_ERROR).addClass("hide"),$(t.SELECTOR.NO_COMMENT).hide();var rootId=t.ROOT_COMMENT_VALUE,unique=self.questionId+"_"+self.type+"_"+rootId,formSelector=self.formSelector,formData=self.convertFormToJson(formSelector);if(0===formData["message[text]"].length){var attoWrap=formSelector.find(t.SELECTOR.ATTO_EDITOR_WRAP);return 0===attoWrap.length||attoWrap.hasClass("error")||(attoWrap.addClass("error"),attoWrap.prepend('<span class="error" tabindex="0">'+self.string.required+"</span>")),M.util.js_complete(t.ACTION_CREATE),!1}var params={replyto:rootId,message:{text:formData["message[text]"],format:formData["message[format]"]}};return self.createComment(params).then((function(response){M.util.js_pending(t.ACTION_CLEAR_FORM),setTimeout((function(){formSelector.trigger("reset"),formSelector.find("#id_editor_question_"+unique+"editable").is(":visible")||self.elementSelector.find(t.SELECTOR.ATTO_HTML_BUTTON).trigger("click"),formSelector.find("#id_editor_question_"+unique+"editable").empty(),formSelector.find(t.SELECTOR.TEXTAREA).trigger("change"),M.util.js_complete(t.ACTION_CLEAR_FORM)}));var data=self.convertForTemplate(response,!0);return formSelector.find(t.SELECTOR.SUBMIT_BUTTON).addClass("disabled"),self.appendComment(data,self.elementSelector.find(t.SELECTOR.CONTAINER_REPLIES),!1),M.util.js_complete(t.ACTION_CREATE),!0})).fail((function(e){self.handleFailWhenCreateComment(e,params),M.util.js_complete(t.ACTION_CREATE)})),!0})),self.elementSelector.find(t.SELECTOR.COMMENT_FILTER_ITEM).on("click",(function(e){if(e.preventDefault(),!self.workingState){var asc=self.string.sort.asc,desc=self.string.sort.desc,nameSelector=$(this).find(t.SELECTOR.COMMENT_FILTER_NAME),iconSelector=$(this).find(t.SELECTOR.COMMENT_FILTER_TYPE),type=$(this).data("type"),orderBy=$(this).attr("data-order"),isCurrent=$(this).hasClass("current"),ascString=$(this).attr("data-asc-string"),descString=$(this).attr("data-desc-string");orderBy="desc"===orderBy?"asc":"desc",$(this).attr("data-order",orderBy),isCurrent||$(this).addClass("current"),"desc"===orderBy?(nameSelector.attr("title",ascString),nameSelector.attr("alt",ascString),iconSelector.attr("title",desc),iconSelector.attr("alt",desc)):(nameSelector.attr("title",descString),nameSelector.attr("alt",descString),iconSelector.attr("title",asc),iconSelector.attr("alt",asc)),self.elementSelector.find(t.SELECTOR.COMMENT_FILTER_ITEM).not(this).each((function(){var each=$(this),eachName=$(this).find(t.SELECTOR.COMMENT_FILTER_NAME),eachType=$(this).find(t.SELECTOR.COMMENT_FILTER_TYPE),defaultString=$(this).attr("data-asc-string");each.attr("data-order","desc"),each.removeClass("filter-asc"),each.removeClass("filter-desc"),each.removeClass("current"),eachName.attr("title",defaultString),eachName.attr("alt",defaultString),eachType.attr("title",asc),eachType.attr("alt",asc)})),"desc"===orderBy?($(this).removeClass("filter-asc"),$(this).addClass("filter-desc")):($(this).removeClass("filter-desc"),$(this).addClass("filter-asc"));var sortType=type+"_"+orderBy;self.setSort(sortType),self.expand?self.btnExpandAll.trigger("click"):self.btnCollapseAll.trigger("click")}}))},getComments:function(numberToShow){var params=this.getParamsBeforeCallApi({numbertoshow:numberToShow,sort:this.sortFeature,type:this.type});return ajax.call([{methodname:t.ACTION_GET_ALL,args:params}])[0]},getParamsBeforeCallApi:function(params){return params.questionid=this.questionId,params.cmid=this.cmId,params.type=this.type,params},showError:function(message){var self=this;M.util.js_pending(t.ACTION_SHOW_ERROR),$.when(self.string.error).done((function(string){self.showDialog(string,message),self.changeWorkingState(!1),M.util.js_complete(t.ACTION_SHOW_ERROR)}))},showDialog:function(title,body){var dialogue=this.dialogue;if(dialogue)return dialogue.title.html(title),dialogue.body.html(body),void dialogue.show();ModalFactory.create({type:ModalFactory.types.CANCEL,title:title,body:body}).done((function(modal){(dialogue=modal).show(),dialogue.getRoot().on(ModalEvents.hidden,{},(function(){location.reload()}))}))},updateCommentCount:function(current,total){M.util.js_pending(t.ACTION_UPDATE_COMMENT_COUNT);var self=this;-1===total?total=self.lastTotal:self.lastTotal=total,-1===current?current=self.lastCurrentCount:self.lastCurrentCount=current;var s=str.get_string("current_of_total","studentquiz",{current:current,total:total}),noCommentSelector=self.elementSelector.find(t.SELECTOR.NO_COMMENT),filter=self.elementSelector.find(t.SELECTOR.COMMENT_FILTER),emptyReplies=self.checkEmptyElement(self.elementSelector.find(t.SELECTOR.CONTAINER_REPLIES));0===self.lastCurrentCount&&emptyReplies&&self.isNoComment?(self.elementSelector.find(t.SELECTOR.CONTAINER_REPLIES).hide(),filter.hide(),noCommentSelector.show()):(self.elementSelector.find(t.SELECTOR.CONTAINER_REPLIES).show(),noCommentSelector.hide(),filter.show()),$.when(s).done((function(text){self.elementSelector.find(t.SELECTOR.COMMENT_COUNT).text(text),M.util.js_complete(t.ACTION_UPDATE_COMMENT_COUNT)}))},renderComment:function(comments,expanded){var self=this;M.util.js_pending(t.ACTION_RENDER_COMMENT),comments=self.convertForTemplate(comments,expanded),Templates.render(t.TEMPLATE_COMMENTS,{comments:comments}).done((function(html){self.containerSelector[0].innerHTML=html,self.loadingIcon.hide();for(var i=0;i<comments.length;i++)self.bindCommentEvent(comments[i]);self.changeWorkingState(!1),M.util.js_complete(t.ACTION_RENDER_COMMENT)}))},bindCommentEvent:function(data){var self=this,el=self.containerSelector.find(t.SELECTOR.COMMENT_ID+data.id),i=0;if(data.root&&data.hasOwnProperty("replies"))for(;i<data.replies.length;i++){var reply=data.replies[i];reply.hasOwnProperty("expand")||(reply.expand=!0),reply.hasOwnProperty("root")||(reply.root=!1),self.bindReplyEvent(reply,el)}el.find(t.SELECTOR.BTN_DELETE).click((function(e){self.bindDeleteEvent(data),e.preventDefault()})),el.find(t.SELECTOR.BTN_REPLY).click((function(e){e.preventDefault(),self.getFragmentFormReplyEvent(data)})),el.find(t.SELECTOR.EXPAND_LINK).click((function(e){e.preventDefault(),self.bindExpandEvent(data)})),el.find(t.SELECTOR.COLLAPSE_LINK).click((function(e){e.preventDefault(),self.bindCollapseEvent(data)})),el.find(t.SELECTOR.BTN_REPORT).click((function(e){e.preventDefault(),window.location=$(this).data("href")})),el.find(t.SELECTOR.BTN_EDIT).click((function(e){e.preventDefault(),self.getFragmentEditFormEvent(data)}))},bindReplyEvent:function(reply,el){var self=this,replySelector=el.find(t.SELECTOR.COMMENT_ID+reply.id);replySelector.find(t.SELECTOR.BTN_DELETE_REPLY).click((function(e){self.bindDeleteEvent(reply),e.preventDefault()})),replySelector.find(t.SELECTOR.BTN_REPORT).click((function(e){e.preventDefault(),window.location=$(this).data("href")})),replySelector.find(t.SELECTOR.BTN_EDIT_REPLY).click((function(e){e.preventDefault(),self.getFragmentEditFormEvent(reply)}))},changeWorkingState:function(boolean){var elementToHide=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,visibility=boolean?"hidden":"visible",self=this;self.workingState=boolean,self.btnExpandAll.prop("disabled",boolean),self.btnCollapseAll.prop("disabled",boolean),self.elementSelector.find(t.SELECTOR.BTN_REPLY).prop("disabled",boolean),self.elementSelector.find(t.SELECTOR.BTN_DELETE).prop("disabled",boolean),self.elementSelector.find(t.SELECTOR.BTN_DELETE_REPLY).prop("disabled",boolean),self.elementSelector.find(t.SELECTOR.BTN_REPORT).prop("disabled",boolean),self.elementSelector.find(t.SELECTOR.EXPAND_LINK).css("visibility",visibility),self.elementSelector.find(t.SELECTOR.COLLAPSE_LINK).css("visibility",visibility),self.elementSelector.find(t.SELECTOR.BTN_EDIT).prop("disabled",boolean),self.elementSelector.find(t.SELECTOR.BTN_EDIT_REPLY).prop("disabled",boolean),self.deleteDialog&&self.deleteDialog.getFooter().find('button[data-action="yes"]').prop("disabled",boolean),boolean?(self.addComment.prop("disabled",boolean),null!==elementToHide&&elementToHide instanceof $&&elementToHide.hide()):(self.lastFocusElement&&(self.lastFocusElement.focus(),self.lastFocusElement=null),self.elementSelector.find(t.SELECTOR.POST_FOOTER).show())},countCommentAndReplies:function(data){var commentCount=0,deleteCommentCount=0,replyCount=0,deleteReplyCount=0;data.constructor!==Array&&(data=[data]);for(var i=0;i<data.length;i++){var item=data[i];0==item.deletedtime?commentCount++:deleteCommentCount++;for(var j=0;j<item.replies.length;j++){0==item.replies[j].deletedtime?replyCount++:deleteReplyCount++}}return{total:commentCount+replyCount,totalDelete:deleteCommentCount+deleteReplyCount,commentCount:commentCount,deleteCommentCount:deleteCommentCount,replyCount:replyCount,deleteReplyCount:deleteReplyCount}},expandComment:function(id){var params=this.getParamsBeforeCallApi({commentid:id,type:this.type});return ajax.call([{methodname:t.ACTION_EXPAND,args:params}])[0]},bindExpandEvent:function(item){var self=this,itemSelector=self.elementSelector.find(t.SELECTOR.COMMENT_ID+item.id),key=t.ACTION_EXPAND;M.util.js_pending(key),self.changeWorkingState(!0);var loadingIcon=self.loadingIcon.clone().show();itemSelector.find(t.SELECTOR.COMMENT_REPLIES_CONTAINER).append(loadingIcon),$(self).hide(),self.expandComment(item.id).then((function(response){var convertedItem=self.convertForTemplate(response,!0),currentDisplayComment=itemSelector.find(t.SELECTOR.COMMENT_REPLIES_CONTAINER_TO_ITEM).length,total=self.countCommentAndReplies(convertedItem).replyCount,newCount=self.lastCurrentCount+total-currentDisplayComment,newTotalCount=self.lastTotal+(convertedItem.numberofreply-item.numberofreply);return item.deleted&&!convertedItem.deleted&&(newCount++,newTotalCount++),!item.deleted&&convertedItem.deleted&&(newCount--,newTotalCount--),newCount===newTotalCount&&(self.btnExpandAll.hide(),self.btnCollapseAll.show()),self.updateCommentCount(newCount,newTotalCount),Templates.render(t.TEMPLATE_COMMENT,convertedItem).done((function(html){var el=$(html);return itemSelector.replaceWith(el),self.lastFocusElement=el.find(t.SELECTOR.COLLAPSE_LINK),self.bindCommentEvent(response),self.changeWorkingState(!1),M.util.js_complete(key),!0}))})).fail((function(e){M.util.js_complete(key),self.showError(e.message)}))},bindCollapseEvent:function(item){var el=this.elementSelector.find(t.SELECTOR.COMMENT_ID+item.id),commentCount=el.find(t.SELECTOR.COMMENT_REPLIES_TEXT).length;this.updateCommentCount(this.lastCurrentCount-commentCount,-1),item.numberofreply=commentCount,el.find(t.SELECTOR.COMMENT_REPLIES_CONTAINER).empty(),item.deleted?el.find(".studentquiz-comment-delete-content").html(item.shortcontent):el.find(t.SELECTOR.COMMENT_TEXT).html(item.shortcontent),el.find(t.SELECTOR.COLLAPSE_LINK).hide(),el.find(t.SELECTOR.EXPAND_LINK).show().focus(),item.expanded=!1},convertForTemplate:function(data,expanded){var single=!1;data.constructor!==Array&&(data=[data],single=!0);for(var i=0;i<data.length;i++){var item=data[i];if(item.expanded=expanded,item.canviewdeleted=this.canViewDeleted,item.hasOwnProperty("replies")||(item.replies=[]),this.setHasComment(item.hascomment),item.highlight=item.id===this.highlight,this.referer&&item.reportlink&&(item.reportlink=this.buildRefererReportLink(item.reportlink,item.id)),item.root)for(var j=0;j<item.replies.length;j++){var reply=item.replies[j];reply.expanded=!0,reply.canviewdeleted=this.canViewDeleted,reply.hasOwnProperty("replies")||(reply.replies=[]),reply.highlight=reply.id===this.highlight,this.referer&&reply.reportlink&&(reply.reportlink=this.buildRefererReportLink(reply.reportlink,reply.id))}item.allowselfcommentrating=this.allowSelfCommentRating}return single?data[0]:data},convertFormToJson:function(form){var data={};return form.find(":input").each((function(){var type=$(this).prop("type"),name=$(this).attr("name");(("checkbox"===type||"radio"===type)&&this.checked||"button"!==type&&"submit"!==type)&&(data[name]=$(this).val())})),data},createComment:function(data){return data=this.getParamsBeforeCallApi(data),ajax.call([{methodname:t.ACTION_CREATE,args:data}])[0]},appendComment:function(item,target,isReply){var self=this;M.util.js_pending(t.ACTION_APPEND_COMMENT),Templates.render(t.TEMPLATE_COMMENT,item).done((function(html){var el=$(html);target.append(el),self.lastCurrentCount?self.updateCommentCount(self.lastCurrentCount+1,self.lastTotal+1):(self.elementSelector.find(t.SELECTOR.COMMENT_FILTER).removeClass(t.SELECTOR.COMMENT_FILTER_HIDE),self.updateCommentCount(1,1),self.btnExpandAll.prop("disabled",!0),self.btnExpandAll.hide(),self.btnCollapseAll.prop("disabled",!1),self.btnCollapseAll.show(),self.expand=!0,self.isNoComment=!1),isReply?self.bindReplyEvent(item,el.parent()):self.bindCommentEvent(item),self.loadingIcon.hide(),self.changeWorkingState(!1),M.util.js_complete(t.ACTION_APPEND_COMMENT)}))},loadFragmentForm:function(fragmentForm,item){var self=this;M.util.js_pending(t.ACTION_LOAD_FRAGMENT_FORM);var params=self.getParamsBeforeCallApi({replyto:item.id,cancelbutton:!0,forcecommenting:self.forceCommenting,type:self.type}),attoWrap=self.formSelector.find(t.SELECTOR.ATTO_EDITOR_WRAP);0!==attoWrap.length&&attoWrap.hasClass("error")&&(attoWrap.removeClass("error"),attoWrap.find("#id_error_message_5btext_5d").remove()),fragment.loadFragment("mod_studentquiz",t.FRAGMENT_FORM_CALLBACK,self.contextId,params).done((function(html,js){Templates.replaceNodeContents(fragmentForm,html,js);var textFragmentFormId="#id_editor_question_"+self.questionId+"_"+self.type+"_"+item.id+"editable";fragmentForm.find(textFragmentFormId).focus(),self.bindFragmentFormEvent(fragmentForm,item),M.util.js_complete(t.ACTION_LOAD_FRAGMENT_FORM)}))},bindFragmentFormEvent:function(fragmentForm,item){var self=this,formFragmentSelector=fragmentForm.find(t.SELECTOR.COMMENT_AREA_FORM);fragmentForm.find(t.SELECTOR.SUBMIT_BUTTON).click((function(e){e.preventDefault(),self.changeWorkingState(!0);var data=self.convertFormToJson(formFragmentSelector);return 0===data["message[text]"].length||(self.loadingIcon.clone().show().appendTo(fragmentForm),formFragmentSelector.hide(),self.createReplyComment(fragmentForm,item,formFragmentSelector,data)),!0})),self.fragmentFormCancelEvent(formFragmentSelector,!1),self.bindEditorEvent(fragmentForm)},createReplyComment:function(replyContainer,item,formSelector,formData){var self=this,params={replyto:item.id,message:{text:formData["message[text]"],format:formData["message[format]"]}};M.util.js_pending(t.ACTION_CREATE_REPLY),self.createComment(params).then((function(response){$(t.SELECTOR.COMMENT_ERROR).addClass("hide");var el=self.elementSelector.find(t.SELECTOR.COMMENT_ID+item.id),repliesEl=el.find(t.SELECTOR.COMMENT_REPLIES_CONTAINER);item.numberofreply++;var numReply=parseInt(el.find(t.SELECTOR.COMMENT_COUNT_NUMBER).text())+1;el.find(t.SELECTOR.COMMENT_COUNT_NUMBER).text(numReply),el.find(t.SELECTOR.COMMENT_COUNT_TEXT).html(1===numReply?self.string.reply:self.string.replies),replyContainer.empty();var data=self.convertForTemplate(response,!0);return self.appendComment(data,repliesEl,!0),M.util.js_complete(t.ACTION_CREATE_REPLY),!0})).fail((function(e){self.handleFailWhenCreateComment(e,params),M.util.js_complete(t.ACTION_CREATE_REPLY)}))},handleFailWhenCreateComment:function(e,params){this.showError(e.message);var fragmentFormSelector=t.SELECTOR.COMMENT_ID+params.replyto+" "+t.SELECTOR.FRAGMENT_FORM;this.elementSelector.find(fragmentFormSelector).empty()},getFragmentFormReplyEvent:function(item){var el=this.elementSelector.find(t.SELECTOR.COMMENT_ID+item.id),fragmentForm=el.find(t.SELECTOR.FRAGMENT_FORM).first(),postFooter=el.find(t.SELECTOR.POST_FOOTER).first(),clone=this.loadingIcon.clone().show();fragmentForm.append(clone),fragmentForm.removeClass("edit"),fragmentForm.addClass("reply"),this.loadFragmentForm(fragmentForm,item),this.changeWorkingState(!0,postFooter)},fragmentFormCancelEvent:function(formSelector,isEdit){var self=this;formSelector.find("#id_cancel").click((function(e){e.preventDefault();var commentSelector=formSelector.closest(t.SELECTOR.COMMENT_ITEM);self.lastFocusElement=isEdit?commentSelector.find(t.SELECTOR.BTN_EDIT):commentSelector.find(t.SELECTOR.BTN_REPLY),self.changeWorkingState(!1),formSelector.parent().empty()}))},bindDeleteEvent:function(data){var self=this;self.deleteTarget=data,self.deleteDialog?self.deleteDialog.show():(self.changeWorkingState(!0),ModalFactory.create({type:ModalFactory.types.DEFAULT,title:self.string.deletecomment,body:self.string.confirmdeletecomment,footer:'<button class="btn btn-primary" type="button" data-action="yes" title="'+self.string.deletecomment+'">'+self.string.deletetext+'</button><button class="btn btn-secondary" type="button" data-action="no" title="'+self.string.cancel+'">'+self.string.cancel+"</button>"}).done((function(modal){self.deleteDialog=modal,modal.getFooter().find('button[data-action="no"]').click((function(e){e.preventDefault(),modal.hide()})),modal.getFooter().find('button[data-action="yes"]').click((function(e){e.preventDefault(),M.util.js_pending(t.ACTION_DELETE),self.changeWorkingState(!0),self.deleteComment(self.deleteTarget.id).then((function(response){if(!response.success)return self.showError(response.message),!0;var convertedCommentData=self.convertForTemplate(response.data,self.deleteTarget.expanded),commentSelector=self.elementSelector.find(t.SELECTOR.COMMENT_ID+convertedCommentData.id);return self.updateCommentCount(self.lastCurrentCount-1,self.lastTotal-1),convertedCommentData.root||(convertedCommentData.expanded=!0),Templates.render(t.TEMPLATE_COMMENT,convertedCommentData).done((function(html){var el=$(html);if(!convertedCommentData.root){var parentCountSelector=commentSelector.parent().closest(t.SELECTOR.COMMENT_ITEM).find(t.SELECTOR.TOTAL_REPLY),countSelector=parentCountSelector.find(t.SELECTOR.COMMENT_COUNT_NUMBER),newCount=parseInt(countSelector.text())-1;parentCountSelector.find(t.SELECTOR.COMMENT_COUNT_NUMBER).text(newCount),parentCountSelector.find(t.SELECTOR.COMMENT_COUNT_TEXT).html(1===newCount?self.string.reply:self.string.replies)}var oldReplies=commentSelector.find(t.SELECTOR.COMMENT_REPLIES_CONTAINER).clone(!0);commentSelector.replaceWith(el),el.find(t.SELECTOR.COMMENT_REPLIES_CONTAINER).replaceWith(oldReplies),self.deleteTarget.root?self.bindCommentEvent(response.data):self.bindReplyEvent(response.data,el.parent()),self.changeWorkingState(!1),M.util.js_complete(t.ACTION_DELETE)})),modal.hide(),!0})).fail((function(err){return self.showError(err.message),!1}))})),modal.getRoot().on(ModalEvents.hidden,(function(){var el=self.elementSelector.find(t.SELECTOR.COMMENT_ID+self.deleteTarget.id);self.deleteTarget.root?el.find(t.SELECTOR.BTN_DELETE).first().focus():el.find(t.SELECTOR.BTN_DELETE_REPLY).first().focus()})),modal.getRoot().on(ModalEvents.shown,(function(){self.changeWorkingState(!1)})),modal.show(),self.changeWorkingState(!1)})))},deleteComment:function(id){var params=this.getParamsBeforeCallApi({commentid:id});return ajax.call([{methodname:t.ACTION_DELETE,args:params}])[0]},bindEditorEvent:function(formSelector){var self=this;M.util.js_pending("init_editor"),self.triggerAttoNoContent(formSelector),formSelector.find(t.SELECTOR.ATTO.TOOLBAR).fadeIn();var textareaSelector=formSelector.find(t.SELECTOR.TEXTAREA),attoEditableId=textareaSelector.attr("id")+"editable",attoEditable=document.getElementById(attoEditableId);new MutationObserver((function(mutationsList){mutationsList.forEach((function(mutation){"attributes"!==mutation.type||"style"!==mutation.attributeName&&"hidden"!==mutation.attributeName||self.checkEditorContent(formSelector)}))})).observe(attoEditable,{attributes:!0,childList:!0,subtree:!0}),textareaSelector.change((function(){self.checkEditorContent(formSelector)})),M.util.js_complete("init_editor");var interval=setInterval((function(){formSelector.find('textarea[id^="id_message"]').trigger("change")}),350);setTimeout((function(){clearInterval(interval)}),5e3)},checkEmptyElement:function(el){return 0===el.children().length},setHasComment:function(value){var container=this.elementSelector,hasCommentClass=t.HAS_COMMENT_CLASS;this.forceCommenting?(this.hasComment=value,this.hasComment?container.addClass(hasCommentClass):container.removeClass(hasCommentClass)):(this.hasComment=!0,container.addClass(hasCommentClass))},parseQueryString:function(query){for(var vars=query.split("&"),queryString={},i=0;i<vars.length;i++){var pair=vars[i].split("="),key=decodeURIComponent(pair[0]),value=decodeURIComponent(pair[1]);void 0===queryString[key]?queryString[key]=decodeURIComponent(value):"string"==typeof queryString[key]?queryString[key]=[queryString[key],decodeURIComponent(value)]:queryString[key].push(decodeURIComponent(value))}return queryString},scrollToElement:function(target,speed){if(target.length){void 0===speed&&(speed=1e3);var top=target.offset().top;$("html,body").animate({scrollTop:top},speed)}},buildRefererReportLink:function(link,id){var referer=decodeURIComponent(this.referer);return link+="&referer="+encodeURIComponent(referer+"&highlight="+id)},triggerAttoHasContent:function(formSelector){var editorContentWrap=formSelector.find(t.SELECTOR.ATTO.CONTENT_WRAP),submitBtn=formSelector.find(t.SELECTOR.SUBMIT_BUTTON);submitBtn.removeClass("disabled"),submitBtn.prop("disabled",!1),editorContentWrap.attr("data-placeholder",""),editorContentWrap.addClass(t.ATTO_CONTENT_TYPE.HAS_CONTENT),editorContentWrap.removeClass(t.ATTO_CONTENT_TYPE.NO_CONTENT)},triggerAttoNoContent:function(formSelector){var placeholder=formSelector.attr("data-textarea-placeholder"),editorContentWrap=formSelector.find(t.SELECTOR.ATTO.CONTENT_WRAP),submitBtn=formSelector.find(t.SELECTOR.SUBMIT_BUTTON);submitBtn.addClass("disabled"),submitBtn.prop("disabled",!0),editorContentWrap.attr("data-placeholder",placeholder),editorContentWrap.addClass(t.ATTO_CONTENT_TYPE.NO_CONTENT),editorContentWrap.removeClass(t.ATTO_CONTENT_TYPE.HAS_CONTENT)},setSort:function(string){-1!==$.inArray(string,this.sortable)&&(this.sortFeature=string)},getFragmentEditFormEvent:function(item){var el=this.elementSelector.find(t.SELECTOR.COMMENT_ID+item.id),fragmentForm=el.find(t.SELECTOR.FRAGMENT_FORM).first(),postFooter=el.find(t.SELECTOR.POST_FOOTER).first(),clone=this.loadingIcon.clone().show();fragmentForm.append(clone),fragmentForm.removeClass("reply"),fragmentForm.addClass("edit"),this.loadFragmentEditForm(fragmentForm,item),this.changeWorkingState(!0,postFooter)},loadFragmentEditForm:function(fragmentForm,item){var self=this;M.util.js_pending(t.ACTION_LOAD_FRAGMENT_EDIT_FORM);var params=self.getParamsBeforeCallApi({cancelbutton:!0,forcecommenting:self.forceCommenting,commentid:item.id}),attoWrap=self.formSelector.find(t.SELECTOR.ATTO_EDITOR_WRAP);0!==attoWrap.length&&attoWrap.hasClass("error")&&(attoWrap.removeClass("error"),attoWrap.find("#id_error_message_5btext_5d").remove()),fragment.loadFragment("mod_studentquiz",t.FRAGMENT_EDIT_FORM_CALLBACK,self.contextId,params).done((function(html,js){Templates.replaceNodeContents(fragmentForm,html,js);var textFragmentFormId="#id_editor_question_"+self.questionId+"_"+self.type+"_"+item.id+"editable";fragmentForm.find(textFragmentFormId).focus(),self.bindFragmentEditFormEvent(fragmentForm,item),M.util.js_complete(t.ACTION_LOAD_FRAGMENT_EDIT_FORM)}))},bindFragmentEditFormEvent:function(fragmentForm,item){var self=this,formFragmentSelector=fragmentForm.find(t.SELECTOR.COMMENT_AREA_FORM);fragmentForm.find(t.SELECTOR.SUBMIT_BUTTON).click((function(e){e.preventDefault(),self.changeWorkingState(!0);var data=self.convertFormToJson(formFragmentSelector);return 0===data["message[text]"].length||(self.loadingIcon.clone().show().appendTo(fragmentForm),formFragmentSelector.hide(),self.editCommentEvent(fragmentForm,item,formFragmentSelector,data)),!0})),self.fragmentFormCancelEvent(formFragmentSelector,!0),self.bindEditorEvent(fragmentForm)},editCommentEvent:function(container,item,formSelector,formData){var self=this;M.util.js_pending(t.ACTION_EDIT);var params={commentid:item.id,message:{text:formData["message[text]"],format:formData["message[format]"]}};self.editComment(params).then((function(response){self.elementSelector.find(t.SELECTOR.COMMENT_ERROR).addClass("hide");var el=self.elementSelector.find(t.SELECTOR.COMMENT_ID+item.id);return self.lastFocusElement=el.find(t.SELECTOR.BTN_EDIT),0===self.lastFocusElement.length&&(self.lastFocusElement=el.find(t.SELECTOR.BTN_EDIT_REPLY)),item.shortcontent=response.shortcontent,response.expanded=item.expanded,Templates.render(t.TEMPLATE_COMMENT,response).done((function(html){var el=$(html),commentTextSelector=t.SELECTOR.COMMENT_ID+response.id+" "+t.SELECTOR.COMMENT_TEXT_CONTAINER;self.elementSelector.find(commentTextSelector).first().html(el.find(t.SELECTOR.COMMENT_TEXT_CONTAINER).html())})),container.empty(),self.changeWorkingState(!1),M.util.js_complete(t.ACTION_EDIT),!0})).fail((function(e){self.handleFailWhenCreateComment(e,params),M.util.js_complete(t.ACTION_EDIT)}))},editComment:function(data){return data=this.getParamsBeforeCallApi(data),ajax.call([{methodname:t.ACTION_EDIT,args:data}])[0]},checkEditorContent:function(formSelector){var key="text_change_"+Date.now();M.util.js_pending(key);var attoEditableId=formSelector.find(t.SELECTOR.TEXTAREA).attr("id")+"editable",attoEditableEle=$("#"+attoEditableId);t.EMPTY_CONTENT.indexOf(attoEditableEle.html())>-1||attoEditableEle.text().trim().length<1?this.triggerAttoNoContent(formSelector):this.triggerAttoHasContent(formSelector),M.util.js_complete(key)}}},generate:function(params){t.get().init(params)}};return t}));
define("mod_studentquiz/question_nav_tabs",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0;
/**
   * Javascript for question-nav-tabs.
   *
   * @module    mod_studentquiz/question_nav_tabs
   * @copyright 2021 The Open University
   * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
var updateActiveTab=function(e){return M.util.set_user_preference("mod_studentquiz_question_active_tab",e.target.dataset.tabId)};_exports.init=function(){document.querySelectorAll(".question-nav-tabs > .nav-tabs > .nav-item.nav-link").forEach((function(tab){tab.addEventListener("click",updateActiveTab)}))}}));
/**
 * Javascript to toggle filter checkbox.
 *
 * @module    mod_studentquiz/toggle_filter_checkbox
 * @copyright 2019 The Open University
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_studentquiz/toggle_filter_checkbox",["jquery","core/key_codes"],(function($,keyCodes){var t={SELECTOR:{TIME_EDT:{CALENDAR:"a[name='timecreated_edt[calendar]",SELECT_DAY_CALENDAR:"select[name='timecreated_edt[day]",INPUT:"input[name='timecreated_edt[enabled]']"},TIME_SDT:{CALENDAR:"a[name='timecreated_sdt[calendar]",SELECT_DAY_CALENDAR:"select[name='timecreated_sdt[day]",INPUT:"input[name='timecreated_sdt[enabled]']"}},dependencies:[],init:function(){var linkToggles=$("a.link-toggle");linkToggles.each((function(index,linkToggle){var link=$(linkToggle),disableElements=link.data("disableelements").split(",");for(index in disableElements){var disableId="id_"+disableElements[index];void 0===t.dependencies[disableId]&&(t.dependencies[disableId]=[]),t.dependencies[disableId].push($("#"+link.attr("for")))}})),linkToggles.click((function(e){e.preventDefault(),t.linkToggleHandler($(this))})).keypress((function(e){e.keyCode===keyCodes.space&&(e.preventDefault(),t.linkToggleHandler($(this)))})),t.initCalendarTabIndex()},linkToggleHandler:function(linkToggle){var checkbox=$(".toggle#"+linkToggle.attr("for")),toggle=!checkbox.prop("checked");checkbox.prop("checked",toggle);var data=linkToggle.data("disableelements");if(data.length>0){var index,disableElements=data.split(",");for(index in disableElements){var disableId="id_"+disableElements[index];!toggle&&t.checkDependOn(disableId)&&(toggle=!0),$("#"+disableId).attr("disabled",toggle)}}},checkDependOn:function(id){var index,dependOn=t.dependencies[id];for(index in dependOn)if(dependOn[index].prop("checked"))return!0;return!1},initCalendarTabIndex:function(){$(t.SELECTOR.TIME_SDT.INPUT).change((function(){var calendar=$(t.SELECTOR.TIME_SDT.CALENDAR),focus=$(t.SELECTOR.TIME_SDT.SELECT_DAY_CALENDAR),isCheck=$(this).is(":checked");t.toggleCalendarTabIndex(calendar,focus,isCheck)})),$(t.SELECTOR.TIME_EDT.INPUT).change((function(){var calendar=$(t.SELECTOR.TIME_EDT.CALENDAR),focus=$(t.SELECTOR.TIME_EDT.SELECT_DAY_CALENDAR),isCheck=$(this).is(":checked");t.toggleCalendarTabIndex(calendar,focus,isCheck)}))},toggleCalendarTabIndex:function(calendar,focusElement,isCheck){isCheck?(calendar.removeAttr("tabindex"),focusElement.focus()):calendar.attr("tabindex",-1)}};return t}));
/**
 * Javascript for save rating and save, remove and listing comments
 *
 * @module    mod_studentquiz/studentquiz
 * @copyright 2017 HSR (http://www.hsr.ch)
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_studentquiz/studentquiz",["jquery"],(function($){return{initialise:function(forcerating,forcecommenting,isanswered){var ratingElements=$(".studentquiz_behaviour .rate .rating .rateable");ratingElements.off("click").on("click",(function(){addRating(this)})),ratingElements.on("keypress",(function(e){13!==e.keyCode&&32!==e.keyCode||(e.preventDefault(),addRating(this))})),$('input[name="next"], input[name="previous"], input[name="finish"]').off("click").on("click",(function(){var $that=$(this);if(isanswered){var hasrated=$(".rating span").hasClass("star"),hascommented=$(".studentquiz-comment-container").hasClass("has-comment");return forcerating&&!hasrated&&$(".studentquiz_behaviour > .rate > .rate_error").removeClass("hide"),forcecommenting&&!hascommented&&$(".studentquiz_behaviour > .comments .comment-error").removeClass("hide"),forcerating&&!hasrated?$(".studentquiz_behaviour .rate .rating .rateable:first-child").focus():forcecommenting&&!hascommented&&$(".studentquiz_behaviour .comments .studentquiz-comment-container .editor_atto_content").focus(),!(forcerating&&!hasrated||forcecommenting&&!hascommented)&&($that.submit(),!0)}return $that.submit(),!0}))},setFocus:function(){$(document).ready((function(){var sortIcon=$("#categoryquestions .iconsort");sortIcon&&sortIcon.parent().focus()}))},selectAllQuestions:function(){var headerCheckbox=document.getElementById("qbheadercheckbox");require(["core/checkbox-toggleall"],(function(){headerCheckbox.checked||headerCheckbox.click()}))}};function addRating(element){var $element=$(element),rate=$element.attr("data-rate"),$that=$element,cmid=$element.closest("form").find(".cmid_field").attr("value");$.post(M.cfg.wwwroot+"/mod/studentquiz/save.php",{save:"rate",cmid:cmid,questionid:$element.attr("data-questionid"),sesskey:M.cfg.sesskey,rate:rate},(function(){var $ratingStars=$that.closest(".rating").children("span");$ratingStars.removeClass("star"),$ratingStars.addClass("star-empty"),$ratingStars.each((function(){$(this).attr("data-rate")<=rate&&($(this).removeClass("star-empty"),$(this).addClass("star"))})),$(".studentquiz_behaviour > .rate > .rate_error").addClass("hide")}))}}));
/**
 * Javascript for state change dialog
 *
 * @module    mod_studentquiz/state_change
 * @copyright 2019 HSR (http://www.hsr.ch)
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_studentquiz/state_change",["jquery","core/ajax","core/notification","core/str"],(function($,Ajax,Notification,Str){var t={SELECTOR:{STATE_SELECT:"#menustatetype",CHANGE_STATE_BUTTON:"div.singlebutton.continue_state_change [type=submit]",STATE_VALUE_INPUT:"input[name=state]",SUBMIT_STATE_BUTTON:"#change_state",CHANGE_STATE_NOTIFICATION:"span.change-question-state",CURRENT_STATE_TEXT:"div.current-state"},init:function(){var lastSelectedState=$(t.SELECTOR.SUBMIT_STATE_BUTTON).attr("data-currentstate");$(document).on("change",t.SELECTOR.STATE_SELECT,{},(function(){var stateChangeSelect=$(t.SELECTOR.STATE_SELECT),changeStateButton=$(t.SELECTOR.CHANGE_STATE_BUTTON),stateValueInput=$(t.SELECTOR.STATE_VALUE_INPUT),submitStateButton=$(t.SELECTOR.SUBMIT_STATE_BUTTON);""!==stateChangeSelect.val()&&stateChangeSelect.val()!==lastSelectedState?(stateValueInput.val(stateChangeSelect.val()),changeStateButton.removeAttr("disabled"),submitStateButton.removeAttr("disabled")):(changeStateButton.attr("disabled","disabled"),submitStateButton.attr("disabled","disabled"))})),$(document).on("click",t.SELECTOR.SUBMIT_STATE_BUTTON,{},(function(){var stateChangeSelect=$(t.SELECTOR.STATE_SELECT),submitStateButton=$(t.SELECTOR.SUBMIT_STATE_BUTTON),currentStateText=$(t.SELECTOR.CURRENT_STATE_TEXT);submitStateButton.attr("disabled","disabled");var pendingPromise=t.addPendingJSPromise("studentquizStateChange");require(["core/loadingicon"],(function(LoadingIcon){var parentElement=$(t.SELECTOR.CHANGE_STATE_NOTIFICATION);LoadingIcon.addIconToContainerRemoveOnCompletion(parentElement,pendingPromise)}));var args={courseid:submitStateButton.attr("data-courseid"),cmid:submitStateButton.attr("data-cmid"),questionid:submitStateButton.attr("data-questionid"),state:stateChangeSelect.val()};Ajax.call([{methodname:"mod_studentquiz_set_state",args:args}],!0,!0)[0].then((function(results){Notification.alert(results.status,results.message),pendingPromise.resolve(),lastSelectedState=stateChangeSelect.val();var currentSelectedText=stateChangeSelect.find("option:selected").text();Str.get_string("changecurrentstate","studentquiz",currentSelectedText).done((function(newString){currentStateText.html(newString)})),window.opener.location.reload()})).fail(undefined)}))},addPendingJSPromise:function(pendingKey){M.util.js_pending(pendingKey);var pendingPromise=$.Deferred();return pendingPromise.then((function(){return M.util.js_complete(pendingKey),arguments[0]})).catch(Notification.exception),pendingPromise}};return t}));
/**
 * Javascript to handle survey validation.
 *
 * @module     mod_survey/validation
 * @package    mod_survey
 * @copyright  2017 Dan Poltawski <dan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.3
 */
define("mod_survey/validation",["jquery","core/str","core/modal_factory","core/notification"],(function($,Str,ModalFactory,Notification){return{ensureRadiosChosen:function(formid){var modalPromise=Str.get_strings([{key:"error",component:"moodle"},{key:"questionsnotanswered",component:"survey"}]).then((function(strings){return ModalFactory.create({type:ModalFactory.types.CANCEL,title:strings[0],body:strings[1]})})).catch(Notification.exception),form=$("#"+formid);form.submit((function(e){return 0===form.find('input:radio[data-survey-default="true"]:checked').length||(e.preventDefault(),modalPromise.then((function(modal){return modal.show(),!1})))}))}}}));
define('mod_turnitintooltwo/modal_migration_tool', ["jquery","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/modal_events","core/config","mod_turnitintooltwo/migration_tool_migrate"],function(a,b,c,d,e,f,g,h){var i=!1,j={MIGRATE_BUTTON:'[data-action="migrate-assignment"]',CANCEL_BUTTON:'[data-action="cancel"]'},k=function(a){d.call(this,a)};return k.TYPE="mod_turnitintooltwo-migration_tool",k.prototype=Object.create(d.prototype),k.prototype.constructor=k,k.prototype.registerEventListeners=function(){d.prototype.registerEventListeners.call(this),this.getModal().on(c.events.activate,j.MIGRATE_BUTTON,function(){a(".asktomigrate").hide(),a(".migrating").show(),h.migration_tool_migrate(a("#migrate_type").data("courseid"),a("#migrate_type").data("turnitintoolid"))}.bind(this)),this.getModal().on(c.events.activate,j.CANCEL_BUTTON,function(b,c){var d=a.Event(f.cancel);this.getRoot().trigger(d,this),d.isDefaultPrevented()||(this.hide(),c.originalEvent.preventDefault())}.bind(this))},i||(e.register(k.TYPE,k,"mod_turnitintooltwo/modal_migration_tool"),i=!0),k});
define('mod_turnitintooltwo/migration_tool_migrate', ["jquery"],function(a){return{migration_tool_migrate:function(b,c){a.ajax({dataType:"json",type:"POST",url:M.cfg.wwwroot+"/mod/turnitintooltwo/ajax.php",data:{action:"begin_migration",courseid:b,turnitintoolid:c,sesskey:M.cfg.sesskey},success:function(a){window.location.href=M.cfg.wwwroot+"/mod/turnitintooltwo/view.php?id="+a.id},error:function(b){var c=b.responseJSON;a("#turnitintool_style").prepend('<div id="full-error" class="box generalbox noticebox">'+c.error+" "+c.message+"</div>")}})}}});
define('mod_turnitintooltwo/migration_tool_launch', ["jquery","core/templates","core/modal_factory","core/modal_events","mod_turnitintooltwo/modal_migration_tool","mod_turnitintooltwo/migration_tool_migrate"],function(a,b,c,d,e,f){return{migration_tool_launch:function(){a.ajax({dataType:"json",type:"POST",url:M.cfg.wwwroot+"/mod/turnitintooltwo/ajax.php",data:{action:"check_migrated",turnitintoolid:a("#migrate_type").data("turnitintoolid"),sesskey:M.cfg.sesskey},success:function(b){b.migrated===!0?window.location.href=M.cfg.wwwroot+"/mod/turnitintooltwo/view.php?id="+b.v2id:c.create({type:e.TYPE}).then(function(b){b.show(),2===a("#migrate_type").data("migratetype")&&(a(".asktomigrate").hide(),a(".migrating").show(),f.migration_tool_migrate(a("#migrate_type").data("courseid"),a("#migrate_type").data("turnitintoolid")))})}})}}});
/**
 * Code files extension method using ACE editorfiles. Add to VPLFile object.
 *
 * @copyright 2013 Juan Carlos Rodrguez-del-Pino
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @author Juan Carlos Rodrguez-del-Pino <jcrodriguez@dis.ulpgc.es>
 */
define("mod_vpl/vplidecodefile",["jquery","mod_vpl/vplutil"],(function($,VPLUtil){return function(){var self=this,editor=null,session=null,readOnly=self.getFileManager().readOnly,getOldContent=this.getContent;this.getContent=function(){return this.isOpen()?editor.getValue():getOldContent.call(this)};var setOldContent=this.setContent;this.setContent=function(c){setOldContent.call(this,c),this.isOpen()&&editor.setValue(c)};var oldDestroy=this.destroy;this.destroy=function(){this.isOpen()&&editor.destroy(),oldDestroy.call(this)},this.setFontSize=function(size){this.isOpen()&&editor.setFontSize(size)};var oldAdjustSize=this.adjustSize;this.adjustSize=function(){return!!oldAdjustSize.call(this)&&(editor.resize(!0),!0)},this.gotoLine=function(line){this.isOpen()&&(editor.gotoLine(line,0),editor.scrollToLine(line,!0),editor.focus())},this.setReadOnly=function(s){readOnly=s,this.isOpen()&&editor.setReadOnly(s)},this.focus=function(){if(this.isOpen()){var tid=this.getTId();$(tid).removeClass("ui-widget-content ui-tabs-panel"),editor.focus()}},this.blur=function(){this.isOpen()&&editor.blur()},this.undo=function(){this.isOpen()&&(editor.undo(),editor.focus())},this.redo=function(){this.isOpen()&&(editor.redo(),editor.focus())},this.selectAll=function(){this.isOpen()&&(editor.selectAll(),editor.focus())},this.hasUndo=function(){return!!this.isOpen()&&session.getUndoManager().hasUndo()},this.hasRedo=function(){return!!this.isOpen()&&session.getUndoManager().hasRedo()},this.hasSelectAll=VPLUtil.returnTrue,this.hasFind=VPLUtil.returnTrue,this.hasFindReplace=VPLUtil.returnTrue,this.hasNext=VPLUtil.returnTrue,this.find=function(){this.isOpen()&&editor.execCommand("find")},this.replace=function(){this.isOpen()&&editor.execCommand("replace")},this.next=function(){this.isOpen()&&editor.execCommand("findnext")},this.getAnnotations=function(){return this.isOpen()?session.getAnnotations():[]},this.setAnnotations=function(a){return!!this.isOpen()&&session.setAnnotations(a)},this.clearAnnotations=function(){return!!this.isOpen()&&session.clearAnnotations()},this.langSelection=function(){if(this.isOpen()){var ext=VPLUtil.fileExtension(this.getFileName()),lang="text";""!==ext&&(lang=VPLUtil.langType(ext)),session.setMode("ace/mode/"+lang)}},this.getEditor=function(){return!!this.isOpen()&&editor},this.setTheme=function(theme){this.isOpen()&&editor.setTheme("ace/theme/"+theme)},this.open=function(){if(this.showFileName(),"undefined"==typeof ace)return VPLUtil.loadScript(["../editor/ace9/ace.js","../editor/ace9/ext-language_tools.js"],(function(){self.open()})),!1;if(this.isOpen())return editor;var fileManager=this.getFileManager(),tid=this.getTId();$(tid).removeClass("ui-widget-content ui-tabs-panel"),ace.require("ext/language_tools"),editor=ace.edit("vpl_file"+this.getId()),session=editor.getSession(),editor.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0}),editor.setValue(this.getContent()),editor.setFontSize(fileManager.getFontSize()),editor.setTheme("ace/theme/"+fileManager.getTheme()),editor.$blockScrolling=1/0,editor.gotoLine(1,0),editor.setReadOnly(readOnly),session.setUseSoftTabs(!0),session.setTabSize(4),session.setUndoManager(new ace.UndoManager),this.setOpen(!0),this.langSelection(),editor.execCommand("replace");editor.on("change",(function(){self.change()})),setTimeout((function addEventDrop(){var tag=$(tid+" div.ace_search");tag.length?(tag.on("drop",fileManager.dropHandler),$(".ace_searchbtn_close").trigger("click")):setTimeout(addEventDrop,50)}),5);var prevOnPaste=editor.onPaste;return editor.onPaste=function(s){fileManager.restrictedEdit?editor.insert(fileManager.getClipboard()):prevOnPaste.call(editor,s)},editor.on("copy",(function(t){fileManager.setClipboard(t.text)})),$(tid).on("paste","*",fileManager.restrictedPaste),$(tid+" div.ace_content").on("drop",fileManager.dropHandler),$(tid+" div.ace_content").on("dragover",fileManager.dragoverHandler),$(tid).find("div.ace_scroller").css("position","static"),this.adjustSize(),$(tid).find("div.ace_scroller").css("position","absolute"),editor},this.close=function(){this.setOpen(!1),null!==editor&&(this.setContent(editor.getValue()),editor.destroy(),editor=null,session=null)}}}));
/**
 * Binary files extension methods. Add to VPLFile object.
 *
 * @copyright 2013 Juan Carlos Rodrguez-del-Pino
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @author Juan Carlos Rodrguez-del-Pino <jcrodriguez@dis.ulpgc.es>
 */
define("mod_vpl/vplidebinaryfile",["jquery","mod_vpl/vplutil"],(function($,VPLUtil){return function(){this.isBinary=function(){return!0};var setOldContent=this.setContent;this.setContent=function(c){setOldContent.call(this,c),this.setModified(),this.updateDataURL()},this.updateDataURL=function(){var fileName=this.getFileName(),value=this.getContent(),tid=this.getTId();if(VPLUtil.isImage(fileName)){var prevalue="data:"+VPLUtil.getMIME(fileName)+";base64,";$(tid).find("img").attr("src",prevalue+value)}else $(tid).find("img").attr("src","")},this.adjustSize=function(){if(!this.isOpen())return!1;var editTag=$(this.getTId());if(0===editTag.length)return!1;var newHeight=editTag.parent().height();return(newHeight-=editTag.position().top)!=editTag.height()&&(editTag.height(newHeight),!0)},this.open=function(){this.showFileName();var fileName=this.getFileName(),tid=this.getTId();this.setOpen(!0),VPLUtil.isImage(fileName)?($(tid).addClass("vpl_ide_img").append("<img />"),this.updateDataURL()):$(tid).addClass("vpl_ide_binary").text(VPLUtil.str("binaryfile"))},this.close=function(){this.setOpen(!1)}}}));
/**
 * VNC client control
 *
 * @copyright 2014 Juan Carlos Rodrguez-del-Pino
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @author Juan Carlos Rodrguez-del-Pino <jcrodriguez@dis.ulpgc.es>
 */
define("mod_vpl/vplvnc",["jquery","jqueryui","mod_vpl/vplutil","mod_vpl/vplclipboard","core/log"],(function($,jqui,VPLUtil,VPLClipboard,console){window.INCLUDE_URI="../editor/noVNC/include/",VPLUtil.delay("loadVNCScripts",(function loadVNCScripts(){"undefined"==typeof Util?VPLUtil.delay("loadVNCScripts",loadVNCScripts):Util.load_scripts(["webutil.js","base64.js","websock.js","des.js","keysymdef.js","keyboard.js","input.js","display.js","jsunzip.js","rfb.js","keysym.js"])}));return function(VNCDialogId,str){var rfb,clipboard,titleText,self=this,title="",message="",lastState="",VNCDialog=$("#"+VNCDialogId),canvas=$("#"+VNCDialogId+" canvas"),onCloseAction=VPLUtil.doNothing,needResize=!0,inputarea=window.document.createElement("input");function keyboardButton(){$(inputarea).is(":focus")?inputarea.blur():inputarea.focus()}function receiveClipboard(rfb,text){clipboard.setEntry1(text)}function openClipboard(){clipboard.show()}function getFocus(){self.isConnected()&&rfb.get_keyboard().set_focused(!0)}function lostFocus(){self.isConnected()&&rfb.get_keyboard().set_focused(!1)}inputarea.style.position="absolute",inputarea.style.left="0px",inputarea.style.top="-10000px",inputarea.style.width="1em",inputarea.style.height="1ex",inputarea.style.opacity="0",inputarea.style.backgroundColor="transparent",inputarea.style.borderStyle="none",inputarea.style.outlineStyle="none",inputarea.autocapitalize="off",inputarea.autocomplete="off",inputarea.autocorrect="off",inputarea.wrap="off",inputarea.spellcheck="false",VNCDialog.append(inputarea);var HTMLUpdateClipboard=VPLUtil.genIcon("copy","sw")+" "+str("copy"),HTMLPaste=VPLUtil.genIcon("paste","sw")+" "+str("paste");function controlDialogSize(){var bw=$("html").width(),bh=$(window).height();VNCDialog.width()>bw&&(needResize=!0,VNCDialog.dialog("option","width",bw)),VNCDialog.parent().height()>bh&&(needResize=!0,VNCDialog.dialog("option","height",bh-VNCDialog.prev().outerHeight()))}function updateState(rfb,state,oldstate,msg){switch(lastState=state,state){case"normal":self.setMessage(""),self.setTitle(str("connected"));break;case"disconnect":case"disconnected":self.setTitle(str("connection_closed"));break;case"failed":self.setTitle(str("connection_fail")),console.log("VNC client: "+msg);break;default:self.setMessage(""),self.setTitle(str("connecting"))}}function round(v){return v<100&&(v=100),2*Math.floor(v/2)}clipboard=new VPLClipboard("vpl_dialog_vnc_clipboard",HTMLUpdateClipboard,(function(){clipboard.setEntry1(clipboard.getEntry1()),document.execCommand("copy")}),HTMLPaste,(function(){self.isConnected()&&rfb.clipboardPasteFrom(clipboard.getEntry2())}),lostFocus),canvas.on("click",(function(e){e.target==canvas[0]?getFocus():lostFocus()})),this.displayResize=function(){if(self.isConnected()){var w=VNCDialog.width(),h=VNCDialog.height();self.setCanvasSize(w,h),rfb.get_display().viewportChange(0,0,w,h)}},VNCDialog.dialog({closeOnEscape:!1,autoOpen:!1,modal:!0,width:"auto",height:"auto",dialogClass:"vpl_ide vpl_vnc",create:function(){titleText=VPLUtil.setTitleBar(VNCDialog,"vnc","graphic",["clipboard","keyboard"],[openClipboard,keyboardButton])},dragStop:controlDialogSize,focus:getFocus,open:controlDialogSize,beforeClose:function(){if(needResize){var w=VNCDialog.width(),h=VNCDialog.height();needResize=!1,self.setCanvasSize(w,h)}},close:function(){self.disconnect()},resizeStop:function(){controlDialogSize(),needResize=!0}}),VNCDialog.css("padding","1px"),VNCDialog.parent().css("z-index",2e3),this.updateTitle=function(){var text=title;""!==message&&(text+=" ("+message+")"),titleText.text(str("console")+": "+text)},this.setTitle=function(t){title=t,this.updateTitle()},this.setMessage=function(t){message=t,this.updateTitle()},this.connect=function(secure,host,port,password,path,onClose){clipboard.setEntry1(""),onCloseAction=onClose,self.show();var target=$("#"+VNCDialogId+" canvas")[0];rfb||(rfb=new RFB({target:target,encrypt:secure,repeaterID:"",true_color:!0,local_cursor:!0,shared:!1,view_only:!1,onUpdateState:updateState,onPasswordRequired:null,onClipboard:receiveClipboard})).set_local_cursor(rfb.get_display().get_cursor_uri()),port||(port=secure?443:80),rfb.connect(host,port,password,path)},this.isOpen=function(){return VNCDialog.dialog("isOpen")},this.close=function(){VNCDialog.dialog("close")},this.isConnected=function(){return rfb&&"disconnected"!=lastState},this.disconnect=function(){rfb&&rfb.disconnect(),onCloseAction(),clipboard.hide()},this.getCanvasSize=function(){return canvas.width()+"x"+canvas.height()},this.setCanvasSize=function(w,h){canvas.width(round(w)),canvas.height(round(h))},this.show=function(){VNCDialog.dialog("open"),VNCDialog.width("auto"),VNCDialog.height("auto")},self.setCanvasSize($(window).width()-150,$(window).height()-150)}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)
/**
 * Blockly file management
 *
 * @copyright 2013 Juan Carlos Rodrguez-del-Pino
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @author Juan Carlos Rodrguez-del-Pino <jcrodriguez@dis.ulpgc.es>
 */}define("mod_vpl/vplideblocklyfile",["jquery","mod_vpl/vplutil"],(function($,VPLUtil){return function(){var self=this,vplIdeInstance=this.getVPLIDE();this.firstContent=!0,this.workspaceInstance=!1;var breakpoint,lastSelection,oldAdjustSize=this.adjustSize;this.adjustSize=function(){if(oldAdjustSize.call(this)){var editTag=$(this.getTId());if(0===editTag.length)return!1;var newHeight=editTag.parent().height();return newHeight-=editTag.position().top,editTag.height(newHeight),$("#"+this.bdiv).height(newHeight),$("#"+this.bdiv).width(editTag.width()),Blockly.svgResize(this.workspaceInstance),!1}return!1},this.undo=function(){this.isOpen()&&this.workspaceInstance.undo(!1)},this.redo=function(){this.isOpen()&&this.workspaceInstance.undo(!0)},this.interpreter=!1,this.animateRun=!1,this.RUNSTATE=1,this.STEPSTATE=2,this.STOPSTATE=3,this.executionState=this.STOPSTATE,this.goNext=!1,this.initRun=function(animate){var ter=vplIdeInstance.getTerminal();ter.isConnected()&&ter.closeLocal(),this.animateRun=animate,Blockly.JavaScript.STATEMENT_PREFIX="highlightBlock(%1);\n",Blockly.JavaScript.addReservedWords("highlightBlock");var code=Blockly.JavaScript.workspaceToCode(self.workspaceInstance);self.interpreter=new Interpreter(code,(function(interpreter,scope){interpreter.setProperty(scope,"alert",interpreter.createNativeFunction((function(text){return text="string"!=typeof text?text.toString()+"\r\n":text+"\r\n",interpreter.createPrimitive(ter.writeLocal(text))})));interpreter.setProperty(scope,"prompt",interpreter.createAsyncFunction((function(text,callback){text="string"!=typeof text?text.toString():""+text,ter.writeLocal(text),ter.setDataCallback((function(t){ter.writeLocal("\n"),callback(t)}))})));interpreter.setProperty(scope,"highlightBlock",interpreter.createNativeFunction((function(id){id==self.getBreakpoint()&&(self.executionState=self.STEPSTATE,self.updateRunButtons(),vplIdeInstance.getTerminal().setMessage(VPLUtil.str("breakpoint"))),(self.animateRun||self.executionState==self.STEPSTATE)&&self.workspaceInstance.highlightBlock(id),self.goNext=!1})))})),ter.connectLocal(self.stop,VPLUtil.doNothing)},this.reservedWords={Infinity:!0,Array:!0,Boolean:!0,Date:!0,Error:!0,EvalError:!0,Function:!0,JSON:!0,Math:!0,NaN:!0,Number:!0,Object:!0,RangeError:!0,ReferenceError:!0,RegExp:!0,String:!0,SyntaxError:!0,TypeError:!0,URIError:!0,alert:!0,arguments:!0,constructor:!0,eval:!0,highlightBlock:!0,isFinite:!0,isNaN:!0,parseFloat:!0,parseInt:!0,prompt:!0,self:!0,this:!0,window:!0},breakpoint=null,lastSelection=null,self.getBreakpoint=function(){return breakpoint},self.setBreakpoint=function(){breakpoint=lastSelection},self.removeBreakpoint=function(){breakpoint=null},self.setLastSelection=function(selection){lastSelection=selection},self.isSelectingBreakpoint=function(){return null===breakpoint&&null!==lastSelection},this.getVarValue=function(val){var HTML="";if(null===val)HTML="<b>null</b>";else if(null!=val){var type=_typeof(val);if("string"==type)HTML='"'+VPLUtil.sanitizeText(val)+'"';else if("boolean"==type)HTML="<b>"+val+"</b>";else if("object"==type&&"Array"===val.class){HTML="[";for(var ar=val.properties,i=0;i<ar.length;i++)HTML+=self.getVarValue(ar[i]),i!=ar.length-1&&(HTML+=", ");HTML+="]"}else"object"==type?HTML="<b>"+val.toString()+"</b>":HTML+=""+val}return HTML},this.getVariables=function(properties){var HTML="";for(var proname in properties)if(!0!==this.reservedWords[proname]){var pro=properties[proname];if(null!=pro&&"Function"!==pro.class)HTML+="<b>"+proname+"</b>:&nbsp;"+VPLUtil.sanitizeText(self.getVarValue(pro))+"<br>\n"}return HTML},this.getParameters=function(args){for(var HTML="(",i=0;i<args.length;i++)HTML+=""+args[i],i<args.length-1&&(HTML+=", ");return HTML+")"},this.showStack=function(interpreter){for(var sn=0,HTML='<table class="generaltable">',stack=interpreter.stateStack,lastFunc="<tr><td>0</td><td><b>Globals</b></td>",i=0;i<stack.length;i++){var level=stack[i];lastFunc>""&&("CallExpression"==level.node.type||i==stack.length-1)&&(HTML+=lastFunc+"<td>"+self.getVariables(level.scope.properties),HTML+="</td></tr>"),"CallExpression"==level.node.type&&(!0!==self.reservedWords[level.node.callee.name]&&null!=level.node.callee.name?(lastFunc="<tr><td>"+ ++sn+"</td>",lastFunc+="<td>"+level.node.callee.name+self.getParameters(level.arguments_)+"</td>"):lastFunc="")}HTML+="</table>",vplIdeInstance.setResult({variables:HTML})},this.runLoop=function(){if(self.interpreter){self.goNext=!0;for(var i=0;i<3e4&&self.goNext&&self.executionState!=self.STOPSTATE;i++)if(!self.interpreter||!self.interpreter.step()){self.executionState=self.STOPSTATE,self.updateRunButtons();break}if(self.executionState==self.STOPSTATE)return self.workspaceInstance.highlightBlock(-1),vplIdeInstance.getTerminal().closeLocal(),void vplIdeInstance.setResult({variables:""});self.executionState==self.RUNSTATE?self.animateRun?(setTimeout(self.runLoop,1e3),self.showStack(self.interpreter)):setTimeout(self.runLoop,0):self.showStack(self.interpreter)}},this.start=function(){self.executionState==self.STOPSTATE&&(self.initRun(!1),self.executionState=self.RUNSTATE,self.updateRunButtons(),vplIdeInstance.getTerminal().setMessage(VPLUtil.str("start")),self.runLoop())},this.startAnimate=function(){self.executionState==self.STOPSTATE&&(self.initRun(!0),self.executionState=self.RUNSTATE,self.updateRunButtons(),vplIdeInstance.getTerminal().setMessage(VPLUtil.str("startanimate")),self.runLoop())},this.stop=function(){self.executionState=self.STOPSTATE,self.workspaceInstance.highlightBlock(-1),self.updateRunButtons(),vplIdeInstance.getTerminal().setMessage(VPLUtil.str("stop")),vplIdeInstance.getTerminal().closeLocal(),self.interpreter=!1,vplIdeInstance.setResult({variables:""})},this.pause=function(){self.executionState==self.RUNSTATE&&(self.executionState=self.STEPSTATE,vplIdeInstance.getTerminal().setMessage(VPLUtil.str("pause")),self.updateRunButtons())},this.resume=function(){self.executionState==self.STEPSTATE&&(self.executionState=self.RUNSTATE,vplIdeInstance.getTerminal().setMessage(VPLUtil.str("resume")),self.updateRunButtons(),self.runLoop())},this.step=function(){self.executionState==self.STOPSTATE&&self.initRun(!0),self.executionState=self.STEPSTATE,self.updateRunButtons(),vplIdeInstance.getTerminal().setMessage(VPLUtil.str("step")),self.runLoop()},this.hasUndo=function(){return!0},this.hasRedo=function(){return!0},this.oldSetFileName=this.setFileName,this.generatorMap={py:"Python",dart:"Dart",js:"JavaScript",lua:"Lua",php:"PHP"},this.generator="",this.setFileName=function(newName){var oldFileName=this.getFileName(),oldExt=VPLUtil.fileExtension(oldFileName);if(!self.oldSetFileName(newName))return VPLUtil.log("Blockly setFileName: name no acepted "+newName),!1;VPLUtil.log("Blockly set filename "+newName);var ext2=/\.([^.]+)\.blockly[123]?$/.exec(newName),fn2=/(.+)\.blockly[123]?$/.exec(newName);return null!==ext2&&null!==fn2&&"string"==typeof this.generatorMap[ext2[1]]?(this.generator=this.generatorMap[ext2[1]],this.generatedFilename=fn2[1],VPLUtil.log("Blockly generator "+this.generator+" for filename "+this.generatedFilename),this.updateGeneratedCode()):this.generator="",oldExt!=VPLUtil.fileExtension(newName)&&(VPLUtil.log("Blockly extension changed"),VPLUtil.afterAll("reopenBlockly",(function(){VPLUtil.log("reopenBlockly"),self.close(),self.open()}))),!0},this.updateGeneratedCode=function(){if(!self.blocklyNotLoaded){var fileManager=self.getFileManager();if(""!=self.generator){VPLUtil.log("Blockly generate "+self.generator);var fid=fileManager.fileNameExists(self.generatedFilename);if(-1==fid&&(VPLUtil.log("try to create "+self.generatedFilename+" files"),fileManager.addFile({name:self.generatedFilename,contents:""},!1,VPLUtil.doNothing,VPLUtil.doNothing),fid=fileManager.fileNameExists(self.generatedFilename)),-1!=fid){var code=Blockly[self.generator].workspaceToCode(self.workspaceInstance),fileGenerated=fileManager.getFile(fid);fileGenerated.getContent()!=code&&(fileGenerated.setContent(code),fileGenerated.change(),fileGenerated.gotoLine(1),fileGenerated.setReadOnly(!0))}}}},this.changeCode=function(event){if(VPLUtil.log(event),"ui"!=event.type||"selected"!=event.element)if("ui"!=event.type||"category"!=event.element||event.newValue!=VPLUtil.str("run")){if(self.firstContent){if("finished_loading"!=event.type)return;self.firstContent=!1,self.workspaceInstance.clearUndo()}event.recordUndo&&(VPLUtil.log("Call change due changeCode"),self.change(),""!=self.generator&&VPLUtil.afterAll("generate"+self.getFileName(),self.updateGeneratedCode))}else VPLUtil.longDelay("updateRunButtons",self.updateRunButtons);else self.setLastSelection(event.newValue)};var triesUpdateRunButtons=0;this.updateRunButtons=function(){if(0==$(".blocklySelectBreakpointC").length)return++triesUpdateRunButtons>20?(triesUpdateRunButtons=0,void VPLUtil.log("Giving up to tries of updateRunButtons")):void VPLUtil.longDelay("updateRunButtons",self.updateRunButtons);VPLUtil.log("updateRunButtons"),triesUpdateRunButtons=0;var dimmed="vpl_dimmed";switch(self.isSelectingBreakpoint()?$(".blocklySelectBreakpointC").removeClass(dimmed):$(".blocklySelectBreakpointC").addClass(dimmed),null===self.getBreakpoint()?$(".blocklyRemoveBreakpointC").addClass(dimmed):$(".blocklyRemoveBreakpointC").removeClass(dimmed),self.executionState){case self.RUNSTATE:$(".blocklyStartC").addClass(dimmed),$(".blocklyStartAnimateC").addClass(dimmed),$(".blocklyStopC").removeClass(dimmed),$(".blocklyPauseC").removeClass(dimmed),$(".blocklyResumeC").addClass(dimmed),$(".blocklyStepC").addClass(dimmed);break;case self.STEPSTATE:$(".blocklyStartC").addClass(dimmed),$(".blocklyStartAnimateC").addClass(dimmed),$(".blocklyStopC").removeClass(dimmed),$(".blocklyPauseC").addClass(dimmed),$(".blocklyResumeC").removeClass(dimmed),$(".blocklyStepC").removeClass(dimmed);break;case self.STOPSTATE:$(".blocklyStartC").removeClass(dimmed),$(".blocklyStartAnimateC").removeClass(dimmed),$(".blocklyStopC").addClass(dimmed),$(".blocklyPauseC").addClass(dimmed),$(".blocklyResumeC").addClass(dimmed),$(".blocklyStepC").removeClass(dimmed)}},this.setToolbox=function(){var toolboxname=VPLUtil.fileExtension(this.getFileName())+"Toolbox";if(!1!==self[toolboxname]){var addUpdateButtons=function(func){return function(){func(),self.updateRunButtons()}},callBacks={blocklyStartButton:this.start,blocklyStartAnimateButton:this.startAnimate,blocklyStopButton:this.stop,blocklyPauseButton:this.pause,blocklyResumeButton:this.resume,blocklyStepButton:this.step,blocklySelectBreakpointButton:this.setBreakpoint,blocklyRemoveBreakpointButton:this.removeBreakpoint},wp=this.workspaceInstance;for(var key in wp.updateToolbox(this[toolboxname]),callBacks)wp.registerButtonCallback(key,addUpdateButtons(callBacks[key]));this.adjustSize()}else $.ajax({url:"../editor/blocklytoolboxes/"+toolboxname+".xml",dataType:"text",success:function(data){self[toolboxname]=self.blocklyIn18(data),self.setToolbox()}})},this.open=function(){if(this.showFileName(),self.blocklyNotLoaded)return VPLUtil.loadScript(["../editor/blockly/blockly_compressed.js","../editor/blockly/msg/js/en.js","../editor/blockly/blocks_compressed.js","../editor/blockly/python_compressed.js","../editor/blockly/javascript_compressed.js","../editor/blockly/php_compressed.js","../editor/blockly/lua_compressed.js","../editor/blockly/dart_compressed.js","../editor/acorn/acorn.js","../editor/acorn/interpreter.js"],(function(){VPLUtil.log("Blocklyloaded",!0),void 0===Blockly.PHP.workspaceToCodeOld&&(Blockly.PHP.workspaceToCodeOld=Blockly.PHP.workspaceToCode,Blockly.PHP.workspaceToCode=function(workspace){return"<?php\n"+Blockly.PHP.workspaceToCodeOld(workspace)}),void 0===Blockly.Python.workspaceToCodeOld&&(Blockly.Python.workspaceToCodeOld=Blockly.Python.workspaceToCode,Blockly.Python.workspaceToCode=function(workspace){return"# -*- coding: utf-8 -*-\n"+Blockly.Python.workspaceToCodeOld(workspace)}),self.blocklyNotLoaded=!1,self.open()})),!1;var code=this.getContent();this.setOpen(!0);var fileName=this.getFileName(),horizontalMenu=!1;/.*[0-9]$/.test(VPLUtil.fileExtension(fileName))&&(horizontalMenu=!0);var tid=this.getTId();$(tid).removeClass("ui-widget-content ui-tabs-panel"),$(tid).addClass("ui-corner-bottom"),this.bdiv="bkdiv"+this.getId(),$(tid).html('<div id="'+this.bdiv+'" style="height: 480px; width: 600px;"></div>');var options={toolbox:'<xml><category name="" colour="330"><block type="math_number"></block></category></xml>',media:"../editor/blockly/media/",horizontalLayout:horizontalMenu,zoom:{controls:!0,wheel:!0,startScale:1,maxScale:3,minScale:.2,scaleSpeed:1.05}};return this.workspaceInstance=Blockly.inject(this.bdiv,options),this.setToolbox(),this.firstContent=code>"",self.workspaceInstance.addChangeListener(self.changeCode),this.setContent(code),VPLUtil.adjustBlockly(self.workspaceInstance,10,10),self.workspaceInstance.scrollX=0,self.workspaceInstance.scrollY=0,Blockly.svgResize(self.workspaceInstance),Blockly.resizeSvgContents(self.workspaceInstance),self.setFileName(self.getFileName()),self.adjustSize(),!1};var getContentOld=this.getContent;this.getContent=function(){if(!this.isOpen())return getContentOld.call(this);var xml=Blockly.Xml.workspaceToDom(this.workspaceInstance);return Blockly.Xml.domToPrettyText(xml)};var setContentOld=this.setContent;this.setContent=function(c){if(setContentOld.call(this,c),c.length>0&&this.isOpen()){this.workspaceInstance.clear();var xml=Blockly.Xml.textToDom(c);Blockly.Xml.domToWorkspace(xml,this.workspaceInstance)}},this.close=function(){this.isOpen()&&(setContentOld.call(this,this.getContent()),this.workspaceInstance.dispose(),this.workspaceInstance=!1,this.setOpen(!1))},this.blocklyNotLoaded=!0,this.blocklyToolbox=!1,this.blockly0Toolbox=!1,this.blockly1Toolbox=!1,this.blockly2Toolbox=!1,this.blockly3Toolbox=!1,this.blocklyStrs=["basic","intermediate","advanced","variables","operatorsvalues","control","inputoutput","functions","lists","math","text","run","start","startanimate","stop","pause","resume","step","breakpoint","selectbreakpoint","removebreakpoint"],this.blocklyIn18=function(data){for(var l=this.blocklyStrs.length,i=0;i<l;i++){var str=this.blocklyStrs[i],reg=new RegExp("\\[\\["+str+"\\]\\]","g"),rep=VPLUtil.str(str);data=data.replace(reg,rep)}return data}}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)
/**
 * IDE Control
 *
 * @copyright 2017 Juan Carlos Rodrguez-del-Pino
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @author Juan Carlos Rodrguez-del-Pino <jcrodriguez@dis.ulpgc.es>
 */}define("mod_vpl/vplide",["jquery","jqueryui","mod_vpl/vplutil","mod_vpl/vplidefile","mod_vpl/vplidebutton","mod_vpl/vplterminal","mod_vpl/vplvnc"],(function($,jqui,VPLUtil,VPLFile,VPLIDEButtons,VPLTerminal,VPLVNCClient){if(void 0!==VPLIDE)return VPLIDE;var vplIdeInstance,VPLIDE=function(rootId,options){var fileManager,adjustTabsTitles,autoResizeTab,showErrorMessage,updateMenu,executionActions,self=this,minNumberOfFiles=options.minfiles||0,maxNumberOfFiles=options.maxfiles||0,restrictedEdit=options.restrictededitor||options.example,readOnly=options.example,isTeacher=options.isTeacher,fullScreen=!1,scrollBarWidth=VPLUtil.scrollBarWidth(),str=VPLUtil.str,rootObj=$("#"+rootId);if($("head").append('<meta name="viewport" content="initial-scale=1">').append('<meta name="viewport" width="device-width">').append('<link rel="stylesheet" href="../editor/VPLIDE.css"/>'),"object"!=_typeof(rootObj))throw new Error("VPL: constructor tag_id not found");var activateModification,optionsToCheck={new:!0,rename:!0,delete:!0,save:!0,run:!0,edit:!0,debug:!0,evaluate:!0,import:!0,resetfiles:!0,sort:!0,multidelete:!0,acetheme:!0,console:!0,comments:!0};void 0===options.loadajaxurl&&(options.loadajaxurl=options.ajaxurl),activateModification=minNumberOfFiles<maxNumberOfFiles,options.new=activateModification,options.rename=activateModification,options.delete=activateModification,options.comments=options.comments&&!options.example,options.acetheme=!0,options.sort=maxNumberOfFiles-minNumberOfFiles>=2,options.multidelete=options.sort,options.import=!restrictedEdit;var isOptionAllowed=function(op){return!optionsToCheck[op]||options[op]};function dragoverHandler(e){e.originalEvent.dataTransfer.dropEffect=restrictedEdit?"none":"copy",e.preventDefault()}function dropHandler(e){if(restrictedEdit)return e.stopImmediatePropagation(),!1;var dt=e.originalEvent.dataTransfer;return dt.files.length>0&&(VPLUtil.readSelectedFiles(dt.files,(function(file){return fileManager.addFile(file,!0,updateMenu,showErrorMessage)}),(function(){fileManager.fileListVisibleIfNeeded()})),e.stopImmediatePropagation(),!1)}function restrictedPaste(e){return!restrictedEdit||(e.stopPropagation(),!1)}options.console=isOptionAllowed("run")||isOptionAllowed("debug"),void 0===options.fontSize&&(options.fontSize=12),options.fontSize=parseInt(options.fontSize),rootObj.on("drop",dropHandler),rootObj.on("dragover",dragoverHandler);var menu=$("#vpl_menu"),menuButtons=new VPLIDEButtons(menu,isOptionAllowed),tr=$("#vpl_tr"),fileListContainer=$("#vpl_filelist"),fileList=$("#vpl_filelist_header"),fileListContent=$("#vpl_filelist_content"),tabsUl=$("#vpl_tabs_ul"),tabs=$("#vpl_tabs"),resultContainer=$("#vpl_results"),result=$("#vpl_results_accordion");fileListContainer.vplMinWidth=80,resultContainer.vplMinWidth=100,this.updateEvaluationNumber=function(res){if(void 0!==res.nevaluations){var text=res.nevaluations;void 0!==res.reductionbyevaluation&&res.reductionbyevaluation>""&&0!=res.reductionbyevaluation&&(0!=res.freeevaluations&&(text=text+"/"+res.freeevaluations),text=text+" -"+res.reductionbyevaluation),menuButtons.setExtracontent("evaluate",text)}},this.lastResult=null,this.getTerminal=function(){return terminal},this.setResultGrade=function(content,raw){var titleclass="vpl_ide_accordion_t_grade";if(0==result.find(".vpl_ide_accordion_c_grade").length&&(result.append('<div class="'+titleclass+'"></div>'),result.append('<div class="vpl_ide_accordion_c_grade"></div>')),void 0===raw)return result.find("h4."+titleclass).length>0;var titleTag=result.find("."+titleclass);return content>""?(titleTag.replaceWith('<h4 class="'+titleclass+'">'+content+"</h4>"),!0):(titleTag.replaceWith('<div class="'+titleclass+'"></div>'),!1)},this.setResultTab=function(name,content,raw){var titleclass="vpl_ide_accordion_t_"+name,contentclass="vpl_ide_accordion_c_"+name;if(0==result.find("."+contentclass).length&&(result.append('<div class="'+titleclass+'"></div>'),result.append('<div class="'+contentclass+'"></div>')),void 0===raw)return result.find("h4."+titleclass).length>0;var titleTag=result.find("."+titleclass),contentTag=result.find("."+contentclass),HTMLcontent=$("<div>"+content+"</div>");return HTMLcontent.find("h4").replaceWith((function(){return $("<h5>").append($(this).contents())})),contentTag.html()==HTMLcontent.html()?content>"":content>""?(titleTag.replaceWith('<h4 class="'+titleclass+'">'+str(name)+"</h4>"),contentTag.replaceWith('<div class="ui-widget '+contentclass+'">'+HTMLcontent.html()+"</div>"),!0):(titleTag.replaceWith('<div class="'+titleclass+'"></div>'),contentTag.replaceWith('<div class="'+contentclass+'"></div>'),!1)},this.setResult=function(res,go){self.updateEvaluationNumber(res);var i,files=fileManager.getFiles(),fileNames=[];for(i=0;i<files.length;i++)fileNames[i]=files[i].getFileName(),files[i].clearAnnotations();var hasContent,gradeShow,formated,show=!1,grade=VPLUtil.sanitizeText(res.grade);if(gradeShow=self.setResultGrade(grade,res.grade),show=show||gradeShow,hasContent=self.setResultTab("variables",res.variables,res.variables),show=show||hasContent,formated=VPLUtil.processResult(res.compilation,fileNames,files,!0,!1),hasContent=self.setResultTab("compilation",formated,res.compilation),show=show||hasContent,formated=VPLUtil.processResult(res.evaluation,fileNames,files,!1,!1),hasContent=self.setResultTab("comments",formated,res.evaluation),show=show||hasContent,formated=VPLUtil.sanitizeText(res.execution),hasContent=self.setResultTab("execution",formated,res.execution),show=show||hasContent,(hasContent=self.setResultTab("description",window.VPLDescription,window.VPLDescription))&&"object"==("undefined"==typeof MathJax?"undefined":_typeof(MathJax))){var math=result.find(".vpl_ide_accordion_c_description")[0];MathJax.Hub.Queue(["Typeset",MathJax.Hub,math])}if(show=show||hasContent){for(resultContainer.show(),resultContainer.vplVisible=!0,result.accordion("refresh"),result.accordion("option","active",gradeShow?1:0),i=0;i<files.length;i++)for(var anot=files[i].getAnnotations(),j=0;j<anot.length;j++)if(go||"error"==anot[j].type){fileManager.gotoFile(i,anot[j].row+1);break}$("#vpl_ide_rightpanel").show()}else resultContainer.hide(),resultContainer.vplVisible=!1,$("#vpl_ide_rightpanel").hide();VPLUtil.delay("autoResizeTab",autoResizeTab)},result.accordion({heightStyle:"fill",header:"h4",animate:!1,beforeActivate:function(event,ui){return!("newHeader"in ui)||!ui.newHeader.hasClass("vpl_ide_accordion_t_grade")}}),resultContainer.width(2*resultContainer.vplMinWidth),result.on("click","a",(function(event){fileManager.gotoFileLink(event.currentTarget)&&event.preventDefault()})),resultContainer.vplVisible=!1,resultContainer.hide(),fileListContainer.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all"),fileList.text(str("filelist")),fileList.html(VPLUtil.iconFolder()+fileList.html()),fileList.addClass("ui-widget-header ui-button-text-only ui-corner-all"),fileListContent.addClass("ui-widget ui-corner-all"),fileListContainer.width(2*fileListContainer.vplMinWidth),fileListContainer.on("click","a",(function(event){event.preventDefault(),fileManager.gotoFileLink(event.currentTarget)})),fileListContainer.vplVisible=!1,fileListContainer.hide();var tabsAir=!1;function getTabsAir(){return!1===tabsAir&&(tabsAir=(tabs.outerWidth(!0)-tabs.width())/2),tabsAir}function resizeTabWidth(e,ui){var maxWidth,diffLeft=ui.position.left-ui.originalPosition.left;if(0!==diffLeft)maxWidth=tabs.width()+fileListContainer.width()-fileListContainer.vplMinWidth,tabs.resizable("option","maxWidth",maxWidth),fileListContainer.width(fileListContainer.vplOriginalWidth+diffLeft);else{maxWidth=tabs.width()+resultContainer.width()-resultContainer.vplMinWidth,tabs.resizable("option","maxWidth",maxWidth);var diffWidth=ui.size.width-ui.originalSize.width;resultContainer.width(resultContainer.vplOriginalWidth-diffWidth)}fileManager.currentFile("adjustSize")}var resizableOptions={containment:"parent",resize:resizeTabWidth,start:function(){$(window).off("resize",autoResizeTab),tabs.resizable("option","minWidth",100),resultContainer.vplVisible&&(resultContainer.vplOriginalWidth=resultContainer.width()),fileListContainer.vplVisible&&(fileListContainer.vplOriginalWidth=fileListContainer.width())},stop:function(e,ui){resizeTabWidth(0,ui),tabs.resizable("option","maxWidth",1e5),tabs.resizable("option","minWidth",0),autoResizeTab(),$(window).on("resize",autoResizeTab)},handles:""};function focusCurrentFile(){fileManager.currentFile("focus")}tabs.resizable(resizableOptions),adjustTabsTitles=function(center){var newWidth=tabs.width(),tabsUlWidth=0;tabsUl.width(1e5);var last=tabsUl.children("li:visible").last();if(last.length){var parentScrollLeft=tabsUl.parent().scrollLeft();tabsUlWidth=parentScrollLeft+last.position().left+last.width()+tabsAir,tabsUl.width(tabsUlWidth);var file=fileManager.currentFile();if(file&&center){var fileTab=$(file.getTabNameId()),scroll=parentScrollLeft+fileTab.position().left;(scroll-=(newWidth-fileTab.outerWidth())/2)<0&&(scroll=0),tabsUl.parent().finish().animate({scrollLeft:scroll},"slow")}}tabsUlWidth<newWidth&&tabsUl.width("")},autoResizeTab=function(){var index,oldWidth=tabs.width(),newWidth=menu.width(),planb=!1;if(index=0,index+=fileListContainer.vplVisible?1:0,index+=resultContainer.vplVisible?2:0,tabs.resizable("destroy"),resizableOptions.handles=["e","w","e","e, w"][index],resizableOptions.disable=0===index,tabs.resizable(resizableOptions),tr.width(menu.outerWidth()),fileListContainer.vplVisible){var left=fileListContainer.outerWidth()+tabsAir;oldWidth+=left,left>=100?(newWidth-=left,tabs.css("left",left)):planb=!0}else tabs.css("left",0);if(resultContainer.vplVisible){var right=resultContainer.outerWidth()+tabsAir;oldWidth+=right,(newWidth-=right)<100&&(planb=!0)}if(planb){var rel=menu.width()/oldWidth,wfl=0;fileListContainer.vplVisible&&(wfl=fileListContainer.width()*rel,fileListContainer.width(wfl-tabsAir),wfl+=tabsAir,tabs.css("left",wfl)),tabs.width(tabs.width()*rel),resultContainer.vplVisible&&resultContainer.width(menu.width()-(wfl+tabs.width()+tabsAir))}else tabs.width(newWidth);adjustTabsTitles(!0),function(){var newHeight=$(window).outerHeight();(newHeight-=menu.offset().top+menu.height()+(fullScreen?getTabsAir():20))<150&&(newHeight=150),tr.height(newHeight);var panelHeight=newHeight-3*getTabsAir();tabs.height(panelHeight),resultContainer.vplVisible&&(resultContainer.height(panelHeight+getTabsAir()),result.accordion("refresh")),fileListContainer.vplVisible&&(fileListContent.height(panelHeight-(fileList.outerHeight()+getTabsAir())),fileListContainer.height(panelHeight))}(),fileManager.currentFile("adjustSize")};var dialogbaseOptions=$.extend({},{close:focusCurrentFile},VPLUtil.dialogbaseOptions);function showMessage(message,options){return VPLUtil.showMessage(message,$.extend({},dialogbaseOptions,options))}showErrorMessage=function(message){return VPLUtil.showErrorMessage(message,{close:focusCurrentFile})};var dialogNew=$("#vpl_ide_dialog_new");function newFileHandler(event){if("click"!=event.type&&("keypress"!=event.type||13!=event.keyCode))return!0;dialogNew.dialog("close");var file={name:$("#vpl_ide_input_newfilename").val(),contents:"",encoding:0},newfile=fileManager.addFile(file,!1,updateMenu,showErrorMessage);return!!newfile&&(fileManager.open(newfile),tabs.tabs("option","active",fileManager.getTabPos(newfile)),newfile.focus(),!0)}var dialogButtons={};dialogButtons[str("ok")]=newFileHandler,dialogButtons[str("cancel")]=function(){$(this).dialog("close")},dialogNew.find("input").on("keypress",newFileHandler),dialogNew.dialog($.extend({},dialogbaseOptions,{title:str("create_new_file"),buttons:dialogButtons})),VPLUtil.setDialogTitleIcon(dialogNew,"new");var dialogRename=$("#vpl_ide_dialog_rename");function renameHandler(event){("click"==event.type||"keypress"==event.type&&13==event.keyCode)&&(dialogRename.dialog("close"),fileManager.renameFile(fileManager.currentFile("getFileName"),$("#vpl_ide_input_renamefilename").val(),showErrorMessage),event.preventDefault())}dialogRename.find("input").on("keypress",renameHandler),dialogButtons[str("ok")]=renameHandler,dialogRename.dialog($.extend({},dialogbaseOptions,{open:function(){$("#vpl_ide_input_renamefilename").val(fileManager.currentFile("getFileName"))},title:str("rename_file"),buttons:dialogButtons})),VPLUtil.setDialogTitleIcon(dialogRename,"rename"),dialogButtons[str("ok")]=function(){$(this).dialog("close")};var dialogComments=$("#vpl_ide_dialog_comments");dialogComments.dialog($.extend({},dialogbaseOptions,{title:str("comments"),width:"40em",buttons:dialogButtons})),VPLUtil.setDialogTitleIcon(dialogComments,"comments"),$("#vpl_ide_input_comments").width("30em");var aboutDialog=$("#vpl_ide_dialog_about"),OKButtons={};OKButtons[str("ok")]=function(){$(this).dialog("close")};var shortcutDialog=$("#vpl_ide_dialog_shortcuts");shortcutDialog.dialog($.extend({},dialogbaseOptions,{open:function(){var html=menuButtons.getShortcuts(fileManager.currentFile("getEditor"));$("#vpl_ide_dialog_shortcuts").html(html)},title:str("shortcuts"),width:400,height:300,buttons:OKButtons})),shortcutDialog.dialog("option","height",300),VPLUtil.setDialogTitleIcon(shortcutDialog,"shortcuts"),OKButtons[str("shortcuts")]=function(){$(this).dialog("close"),shortcutDialog.dialog("open")},aboutDialog.dialog($.extend({},dialogbaseOptions,{open:function(){var html=menuButtons.getShortcuts(fileManager.currentFile("getEditor"));aboutDialog.next().find("button").filter((function(){return $(this).text()==str("shortcuts")})).button(""!=html?"enable":"disable")},title:str("about"),width:400,height:300,buttons:OKButtons})),aboutDialog.dialog("option","height",300),VPLUtil.setDialogTitleIcon(aboutDialog,"about");var dialogSort=$("#vpl_ide_dialog_sort"),dialogSortButtons={};dialogSortButtons[str("ok")]=function(){var files=fileManager.getFiles(),regNoNumber=/[^\d]*/,sorted=[],i=0,newOrder=$("#vpl_sort_list li");if(newOrder.length==files.length){for(newOrder.each((function(){var orig=parseInt(this.id.replace(regNoNumber,""));sorted.push(files[orig])})),i=0;i<newOrder.length;i++)files[i]=sorted[i];fileManager.setModified(),$(this).dialog("close")}},dialogSortButtons[str("cancel")]=function(){$(this).dialog("close")},dialogSort.dialog($.extend({},dialogbaseOptions,{title:str("sort"),buttons:dialogSortButtons,open:function(){var list=$("#vpl_sort_list");list.html("");for(var files=fileManager.getFiles(),i=0;i<files.length;i++){var file=$('<li id="vpl_fsort_'+i+'"class="ui-widget-content"></li>');i<minNumberOfFiles&&file.addClass("ui-state-disabled"),file.text(i+1+"-"+files[i].getFileName()),list.append(file)}list.sortable({items:"li:not(.ui-state-disabled)",placeholder:"ui-state-highlight",start:function(event,ui){ui.item.addClass("ui-state-highlight")},stop:function(event,ui){ui.item.removeClass("ui-state-highlight")}}),list.disableSelection()},maxHeight:400})),VPLUtil.setDialogTitleIcon(dialogSort,"sort");var dialogMultidelete=$("#vpl_ide_dialog_multidelete"),dialogMultideleteButtons={};dialogMultideleteButtons[str("selectall")]=function(){$(this).find("input").prop("checked",!0)},dialogMultideleteButtons[str("deselectall")]=function(){$(this).find("input").prop("checked",!1)},dialogMultideleteButtons[str("deleteselected")]=function(){var files=fileManager.getFiles(),toDeleteList=[];$("#vpl_multidelete_list label").each((function(){var label=$(this);if(label.find("input").prop("checked")){var id=label.data("fileid");toDeleteList.push(files[id].getFileName())}}));for(var i=0;i<toDeleteList.length;i++)fileManager.deleteFile(toDeleteList[i],showErrorMessage);VPLUtil.delay("updateMenu",updateMenu),VPLUtil.delay("updateFileList",fileManager.updateFileList),$(this).dialog("close")},dialogMultideleteButtons[str("cancel")]=function(){$(this).dialog("close")},dialogMultidelete.dialog($.extend({},dialogbaseOptions,{title:str("multidelete"),buttons:dialogMultideleteButtons,open:function(){var list=$("#vpl_multidelete_list");list.html("");for(var files=fileManager.getFiles(),i=minNumberOfFiles;i<files.length;i++){var name=VPLUtil.sanitizeText(files[i].getFileName()),file=$('<label><input type="checkbox"> '+name+"</label>");file.data("fileid",i),list.append(file),list.append("<br>")}list.find("label").button()},maxHeight:400,maxWidth:400})),VPLUtil.setDialogTitleIcon(dialogMultidelete,"multidelete");var dialogFontsize=$("#vpl_ide_dialog_fontsize"),fontsizeSlider=$("#vpl_ide_dialog_fontsize .vpl_fontsize_slider"),dialogFontFizeButtons={};dialogFontFizeButtons[str("ok")]=function(){var value=fontsizeSlider.slider("value");fileManager.setFontSize(value),$(this).dialog("close"),$.ajax({async:!0,type:"POST",url:"../editor/userpreferences.json.php",data:JSON.stringify({fontSize:value}),contentType:"application/json; charset=utf-8",dataType:"json"})},dialogFontFizeButtons[str("cancel")]=function(){fileManager.setFontSize(fontsizeSlider.data("vpl_fontsize")),$(this).dialog("close")},dialogFontFizeButtons[str("reset")]=function(){fontsizeSlider.slider("value",12)},dialogFontsize.dialog($.extend({},dialogbaseOptions,{title:str("fontsize"),buttons:dialogFontFizeButtons,open:function(){fontsizeSlider.data("vpl_fontsize",fileManager.getFontSize()),fontsizeSlider.slider("value",fileManager.getFontSize())}})),fontsizeSlider.slider({min:1,max:48,change:function(){var value=fontsizeSlider.slider("value");fileManager.setFontSize(value),dialogFontsize.find(".vpl_fontsize_slider_value").text(value)}}),VPLUtil.setDialogTitleIcon(dialogFontsize,"fontsize");var dialogAceTheme=$("#vpl_ide_dialog_acetheme"),acethemeSelect=$("#vpl_ide_dialog_acetheme select"),dialogAceThemeButtons={};dialogAceThemeButtons[str("ok")]=function(){fileManager.setTheme(acethemeSelect.val()),$(this).dialog("close"),VPLUtil.setUserPreferences({aceTheme:acethemeSelect.val()})},dialogAceThemeButtons[str("cancel")]=function(){fileManager.setTheme(acethemeSelect.data("acetheme")),$(this).dialog("close")},dialogAceThemeButtons[str("reset")]=function(){acethemeSelect.val(acethemeSelect.data("acetheme")),fileManager.setTheme(acethemeSelect.val())},dialogAceTheme.dialog($.extend({},dialogbaseOptions,{title:str("theme"),buttons:dialogAceThemeButtons,modal:!1,open:function(){acethemeSelect.data("acetheme",fileManager.getTheme()),acethemeSelect.val(fileManager.getTheme())}})),acethemeSelect.on("change",(function(){fileManager.setTheme(acethemeSelect.val())})),VPLUtil.setDialogTitleIcon(dialogAceTheme,"theme");var terminal=new VPLTerminal("vpl_dialog_terminal","vpl_terminal",str),VNCClient=new VPLVNCClient("vpl_dialog_vnc",str),lastConsole=terminal,fileSelect=$("#vpl_ide_input_file");function resetFiles(){VPLUtil.requestAction("resetfiles","",{},options.ajaxurl).done((function(response){var files=response.files;for(var fileName in files)files.hasOwnProperty(fileName)&&fileManager.addFile(files[fileName],!0,VPLUtil.doNothing,showErrorMessage);fileManager.fileListVisibleIfNeeded(),VPLUtil.delay("updateMenu",updateMenu)})).fail(showErrorMessage)}function executionRequest(action,acting,data){data||(data={}),lastConsole.isConnected()||VPLUtil.requestAction(action,"",data,options.ajaxurl).done((function(response){VPLUtil.webSocketMonitor(response,action,acting,executionActions)})).fail(showErrorMessage)}function runAction(){executionRequest("run","running",{XGEOMETRY:VNCClient.getCanvasSize()})}function debugAction(){executionRequest("debug","debugging",{XGEOMETRY:VNCClient.getCanvasSize()})}function evaluateAction(){executionRequest("evaluate","evaluating")}fileSelect.on("change",(function(){VPLUtil.readSelectedFiles(this.files,(function(file){return fileManager.addFile(file,!0,updateMenu,showErrorMessage)}),(function(){fileManager.fileListVisibleIfNeeded()}))})),menuButtons.add({name:"filelist",originalAction:function(){fileManager.fileListVisible(!fileManager.isFileListVisible()),VPLUtil.delay("updateMenu",updateMenu),VPLUtil.delay("autoResizeTab",autoResizeTab),VPLUtil.delay("updateFileList",fileManager.updateFileList)},bindKey:{win:"Ctrl-L",mac:"Ctrl-L"}}),menuButtons.add({name:"new",originalAction:function(){fileManager.length()<maxNumberOfFiles&&dialogNew.dialog("open")},bindKey:{win:"Alt-N",mac:"Option-N"}}),menuButtons.add({name:"rename",originalAction:function(){var file=fileManager.currentFile();file&&fileManager.getFilePosById(file.getId())>=minNumberOfFiles&&dialogRename.dialog("open")},bindKey:{win:"Ctrl-R",mac:"Ctrl-R"}}),menuButtons.add({name:"delete",originalAction:function(){var file=fileManager.currentFile();if(file){var filename=file.getFileName();showMessage(str("delete_file_fq",filename),{ok:function(){fileManager.deleteFile(filename,showErrorMessage)},title:str("delete_file_q"),icon:"trash"})}},bindKey:{win:"Ctrl-D",mac:"Ctrl-D"}}),menuButtons.add({name:"close",originalAction:function(){var file=fileManager.currentFile();file&&fileManager.close(file)},bindKey:{win:"Alt-W",mac:"Option-W"}}),menuButtons.add({name:"import",originalAction:function(){fileSelect.val(""),fileSelect.trigger("click")},bindKey:{win:"Ctrl-I",mac:"Ctrl-I"}}),menuButtons.add({name:"sort",originalAction:function(){dialogSort.dialog("open")},bindKey:{win:"Ctrl-O",mac:"Ctrl-O"}}),menuButtons.add({name:"multidelete",originalAction:function(){dialogMultidelete.dialog("open")}}),menuButtons.add({name:"fontsize",originalAction:function(){dialogFontsize.dialog("open")}}),menuButtons.add({name:"theme",originalAction:function(){dialogAceTheme.dialog("open")}}),menuButtons.add({name:"print",originalAction:function(){window.print()},bindKey:{win:"Alt-P",mac:"Command-P"}}),menuButtons.add({name:"undo",originalAction:function(){fileManager.currentFile("undo")}}),menuButtons.add({name:"redo",originalAction:function(){fileManager.currentFile("redo")}}),menuButtons.add({name:"select_all",editorName:"selectall",originalAction:function(){fileManager.currentFile("selectAll")}}),menuButtons.add({name:"find",originalAction:function(){fileManager.currentFile("find")}}),menuButtons.add({name:"find_replace",editorName:"replace",originalAction:function(){fileManager.currentFile("replace")}}),menuButtons.add({name:"next",editorName:"findnext",originalAction:function(){fileManager.currentFile("next")}}),menuButtons.add({name:"fullscreen",originalAction:function(){var tags="header, nav, footer, aside, .dropdown, #page-header, div.navbar, #nav-drawer";tags+=", div.tabtree, #dock, .breadcrumb-nav, .moodle-actionmenu",fullScreen?(rootObj.removeClass("vpl_ide_root_fullscreen"),$("body").removeClass("vpl_body_fullscreen"),menuButtons.setText("fullscreen","fullscreen"),$(tags).show(),$("#vpl_ide_user").hide(),fullScreen=!1):($("body").addClass("vpl_body_fullscreen").scrollTop(0),$(tags).hide(),rootObj.addClass("vpl_ide_root_fullscreen"),menuButtons.setText("fullscreen","regularscreen"),options.username&&$("#vpl_ide_user").show(),fullScreen=!0),focusCurrentFile(),setTimeout(autoResizeTab,10)},bindKey:{win:"Alt-F",mac:"Ctrl-F"}}),menuButtons.add({name:"download",originalAction:function(){window.location=options.download}}),menuButtons.add({name:"resetfiles",originalAction:function(){showMessage(str("sureresetfiles"),{title:str("resetfiles"),ok:resetFiles,icon:"resetfiles"})}}),menuButtons.add({name:"save",originalAction:function(){var data={files:fileManager.getFilesToSave(),comments:$("#vpl_ide_input_comments").val(),version:fileManager.getVersion()};JSON.stringify(data).length>options.postMaxSize?showErrorMessage(str("maxpostsizeexceeded")):function doSave(){VPLUtil.requestAction("save","saving",data,options.ajaxurl).done((function(response){response.requestsconfirmation?showMessage(response.question,{title:str("saving"),icon:"alert",yes:function(){data.version=response.version,doSave()}}):(fileManager.resetModified(),fileManager.setVersion(response.version),menuButtons.setTimeLeft(response),VPLUtil.delay("updateMenu",updateMenu),VPLUtil.monitorRunning()&&(data.processid=VPLUtil.getProcessId(),VPLUtil.requestAction("update","updating",data,options.ajaxurl)))})).fail(showErrorMessage)}()},bindKey:{win:"Ctrl-S",mac:"Command-S"}}),menuButtons.add({name:"run",originalAction:function(){executionActions.setLastAction(runAction),runAction()},bindKey:{win:"Ctrl-F11",mac:"Command-U"}}),menuButtons.add({name:"debug",originalAction:function(){executionActions.setLastAction(debugAction),debugAction()},bindKey:{win:"Alt-F11",mac:"Option-U"}}),menuButtons.add({name:"evaluate",originalAction:function(){executionActions.setLastAction(evaluateAction),evaluateAction()},bindKey:{win:"Shift-F11",mac:"Command-Option-U"}}),menuButtons.add({name:"comments",originalAction:function(){dialogComments.dialog("open")}}),menuButtons.add({name:"console",originalAction:function(){lastConsole.isOpen()?lastConsole.close():lastConsole.show()}}),menuButtons.add({name:"user"}),menuButtons.add({name:"about",originalAction:function(){aboutDialog.dialog("open")}}),menuButtons.add({name:"timeleft",originalAction:function(){menuButtons.toggleTimeLeft()}}),menuButtons.add({name:"more",originalAction:function(){var tag=$("#vpl_ide_menuextra");tag.is(":visible")?(menuButtons.setText("more","more",VPLUtil.str("more")),tag.hide()):(menuButtons.setText("more","less",VPLUtil.str("less")),tag.show()),VPLUtil.delay("updateMenu",updateMenu),VPLUtil.delay("autoResizeTab",autoResizeTab)}}),menuButtons.add({name:"rightpanel",icon:"close-rightpanel",originalAction:function(){resultContainer.vplVisible?(resultContainer.hide(),resultContainer.vplVisible=!1,menuButtons.setText("rightpanel","open-rightpanel",VPLUtil.str("rightpanel"))):(menuButtons.setText("rightpanel","close-rightpanel",VPLUtil.str("rightpanel")),resultContainer.show(),resultContainer.vplVisible=!0),VPLUtil.delay("autoResizeTab",autoResizeTab)},bindKey:{win:"Ctrl-M",mac:"Ctrl-M"}});tr.append('<span style="position:absolute;right:0;top:60px;z-index:100;margin:3px">'+menuButtons.getHTML("rightpanel")+"</span>");var rightPanelButton=$("#vpl_ide_rightpanel");menuButtons.setText("rightpanel","close-rightpanel",VPLUtil.str("rightpanel")),rightPanelButton.button(),rightPanelButton.css("padding","0"),$("#vpl_ide_rightpanel.ui-button-text").css("padding","0"),rightPanelButton.on("click",(function(){menuButtons.launchAction("rightpanel")})),rightPanelButton.hide(),menu.addClass("ui-widget-header ui-corner-all");var menuHtml="";menuHtml+=menuButtons.getHTML("more"),menuHtml+=menuButtons.getHTML("save"),menuHtml+="<span id='vpl_ide_mexecution'>",menuHtml+=menuButtons.getHTML("run"),menuHtml+=menuButtons.getHTML("debug"),menuHtml+=menuButtons.getHTML("evaluate"),menuHtml+=menuButtons.getHTML("comments"),menuHtml+=menuButtons.getHTML("console"),menuHtml+="</span> ",menuHtml+="<span id='vpl_ide_menuextra'>",menuHtml+="<span id='vpl_ide_file'>",menuHtml+=menuButtons.getHTML("filelist"),menuHtml+=menuButtons.getHTML("new"),menuHtml+=menuButtons.getHTML("rename"),menuHtml+=menuButtons.getHTML("delete"),menuHtml+=menuButtons.getHTML("import"),menuHtml+=menuButtons.getHTML("download"),menuHtml+=menuButtons.getHTML("resetfiles"),menuHtml+=menuButtons.getHTML("sort"),menuHtml+=menuButtons.getHTML("multidelete"),menuHtml+=menuButtons.getHTML("fontsize"),menuHtml+=menuButtons.getHTML("theme"),menuHtml+="</span> ",menuHtml+="<span id='vpl_ide_edit'>",menuHtml+=menuButtons.getHTML("undo"),menuHtml+=menuButtons.getHTML("redo"),menuHtml+=menuButtons.getHTML("select_all"),menuHtml+=menuButtons.getHTML("find"),menuHtml+=menuButtons.getHTML("find_replace"),menuHtml+=menuButtons.getHTML("next"),menuHtml+="</span> ",menuHtml+="</span> ",menuHtml+=menuButtons.getHTML("fullscreen")+" ",menuHtml+=menuButtons.getHTML("about")+" ",menuHtml+=menuButtons.getHTML("user")+" ",menuHtml+=menuButtons.getHTML("timeleft"),menuHtml+='<div class="clearfix"></div>',menu.append(menuHtml),$("#vpl_ide_more").button(),$("#vpl_ide_save").button(),$("#vpl_ide_menuextra").hide(),$("#vpl_ide_file").controlgroup(),$("#vpl_ide_edit").controlgroup(),$("#vpl_ide_mexecution").controlgroup(),$("#vpl_ide_fullscreen").button(),$("#vpl_ide_acetheme").button(),$("#vpl_ide_about").button(),$("#vpl_ide_user").button().css("float","right").hide(),$("#vpl_ide_timeleft").button().css("float","right").hide(),$("#vpl_menu .ui-button").css("padding","6px"),$("#vpl_menu .ui-button-text").css("padding","0");for(var alwaysActive=["filelist","more","fullscreen","about","resetfiles","download","comments","console","import","fontsize","timeleft"],i=0;i<alwaysActive.length;i++)menuButtons.enable(alwaysActive[i],!0);menuButtons.setExtracontent("user",options.username),menuButtons.setTimeLeft(options),updateMenu=function(){var i,file=fileManager.currentFile(),nfiles=fileManager.length();nfiles?tabs.show():tabs.hide(),fileManager.isFileListVisible()?menuButtons.setText("filelist","filelistclose",VPLUtil.str("filelist")):menuButtons.setText("filelist","filelist",VPLUtil.str("filelist"));var modified=fileManager.isModified();menuButtons.enable("save",modified);var sel,running=VPLUtil.monitorRunning();if(running?menuButtons.setText("run","running"):menuButtons.setText("run","run"),menuButtons.enable("run",!running&&(!modified||options.example)&&isOptionAllowed("run")),menuButtons.enable("debug",!running&&(!modified||options.example)&&isOptionAllowed("debug")),menuButtons.enable("evaluate",!running&&(!modified||options.example)&&isOptionAllowed("evaluate")),menuButtons.enable("download",!modified),menuButtons.enable("new",nfiles<maxNumberOfFiles),menuButtons.enable("sort",nfiles-minNumberOfFiles>1),menuButtons.enable("multidelete",nfiles-minNumberOfFiles>1),menuButtons.enable("theme",!0),file&&0!==nfiles){var id=fileManager.getFilePosById(file.getId());menuButtons.enable("rename",id>=minNumberOfFiles&&0!==nfiles),menuButtons.enable("delete",id>=minNumberOfFiles&&0!==nfiles),menuButtons.enable("undo",file.hasUndo()),menuButtons.enable("redo",file.hasRedo()),menuButtons.enable("select_all",file.hasSelectAll()),menuButtons.enable("find",file.hasFind()),menuButtons.enable("find_replace",file.hasFindReplace()),menuButtons.enable("next",file.hasNext()),VPLUtil.delay("updateFileList",fileManager.updateFileList)}else for(sel=["rename","delete","undo","redo","select_all","find","find_replace","next"],i=0;i<sel.length;i++)menuButtons.enable(sel[i],!1)},executionActions={open:updateMenu,close:updateMenu,getConsole:function(){return lastConsole},setResult:self.setResult,ajaxurl:options.ajaxurl,run:function(content,coninfo,ws){var parsed=/^([^:]*):?(.*)/i.exec(content),type=parsed[1];if("terminal"==type||"webterminal"==type){if(lastConsole&&lastConsole.isOpen()&&lastConsole.close(),lastConsole=terminal,terminal.connect(coninfo.executionURL,(function(){ws.close(),focusCurrentFile()})),"webterminal"==type){var URLfavicon=(coninfo.secure?"https":"http")+"://"+coninfo.server+":"+coninfo.portToUse;URLfavicon+="/favicon.ico";var imgFavicon=$("<img>");imgFavicon.attr("src",URLfavicon),imgFavicon.attr("style","display:none"),$("body").append(imgFavicon)}}else if("vnc"==type)lastConsole&&lastConsole.isOpen()&&lastConsole.close(),lastConsole=VNCClient,VNCClient.connect(coninfo.secure,coninfo.server,coninfo.portToUse,coninfo.VNCpassword,coninfo.executionPath,(function(){ws.close(),focusCurrentFile()}));else if("browser"==type){var URL=(coninfo.secure?"https":"http")+"://"+coninfo.server+":"+coninfo.portToUse+"/";URL+=parsed[2]+"/httpPassthrough",isTeacher&&(URL+="?private");var message='<a href="'+URL+'" target="_blank">';showMessage(message+=VPLUtil.str("open")+"</a>",{width:200,icon:"run",title:VPLUtil.str("run")})}else VPLUtil.log("Type of run error "+content,!0)},lastAction:!1,getLastAction:function(){var ret=this.lastAction;return this.lastAction=!1,ret},setLastAction:function(action){this.lastAction=action}},tabs.on("tabsactivate",(function(){fileManager.currentFile("focus"),VPLUtil.delay("updateMenu",updateMenu),VPLUtil.delay("autoResizeTab",autoResizeTab)}));var jw=$(window);jw.on("resize",autoResizeTab),options.example||jw.on("beforeunload",(function(){if(fileManager.isModified())return str("changesNotSaved")})),fileManager=new function(){var tabsUl=$("#vpl_tabs_ul");$("#vpl_tabs").tabs();var version,tabs=$("#vpl_tabs").tabs("widget"),files=[],openFiles=[],modified=!0,self=this;function fileNameIncluded(name){for(var checkName=name.toLowerCase()+"/",i=0;i<files.length;i++){var nameMod=files[i].getFileName().toLowerCase()+"/";if(0===nameMod.indexOf(checkName)||0===checkName.indexOf(nameMod))return!0}return!1}function twoBlockly(oldname,newname){if(VPLUtil.isBlockly(oldname))return!1;if(VPLUtil.isBlockly(newname))for(var i=0;i<files.length;i++)if(VPLUtil.isBlockly(files[i].getFileName()))return!0;return!1}self.setVersion=function(v){version=v},self.getVersion=function(){return version},this.updateFileList=function(){self.generateFileList()},this.fileNameExists=function(name){for(var checkName=name.toLowerCase(),i=0;i<files.length;i++)if(files[i].getFileName().toLowerCase()==checkName)return i;return-1},this.restrictedPaste=restrictedPaste,this.dropHandler=dropHandler,this.dragoverHandler=dragoverHandler,this.readOnly=readOnly,this.restrictedEdit=restrictedEdit,this.adjustTabsTitles=adjustTabsTitles,this.minNumberOfFiles=minNumberOfFiles,this.scrollBarWidth=scrollBarWidth;var localClipboard="";this.setClipboard=function(t){localClipboard=t},this.getClipboard=function(){return localClipboard},this.getTabPos=function(file){for(var i=0;i<openFiles.length;i++)if(openFiles[i]==file)return i;return openFiles.length},this.getTheme=function(){return options.theme},this.setTheme=function(theme){options.theme=theme;for(var i=0;i<files.length;i++)files[i].setTheme(theme)},this.addTab=function(fid){var hlink='<a href="#vpl_file'+fid+'"></a>';tabsUl.append('<li id="vpl_tab_name'+fid+'">'+hlink+"</li>"),tabs.append('<div id="vpl_file'+fid+'" class="vpl_ide_file"></div>')},this.removeTab=function(fid){tabsUl.find("#vpl_tab_name"+fid).remove(),tabs.find("#vpl_file"+fid).remove()},this.open=function(pos){var file;if(!(file="object"==_typeof(pos)?pos:files[pos]).isOpen()){var fid=file.getId();self.addTab(fid),openFiles.push(file),menuButtons.setGetkeys(file.open()),tabs.tabs("refresh"),adjustTabsTitles(!1),VPLUtil.delay("updateFileList",self.updateFileList),VPLUtil.delay("updateMenu",updateMenu)}},this.close=function(file){if(file.isOpen()){var pos,fid=file.getId();file.close(),self.removeTab(fid);var ptab=self.getTabPos(file);return openFiles.splice(ptab,1),tabs.tabs("refresh"),adjustTabsTitles(!1),self.fileListVisible(!0),VPLUtil.delay("updateFileList",self.updateFileList),VPLUtil.delay("adjustTabsTitles",adjustTabsTitles,!1),openFiles.length>ptab?(pos=self.getFilePosById(openFiles[ptab].getId()),void self.gotoFile(pos,"c")):ptab>0?(pos=self.getFilePosById(openFiles[ptab-1].getId()),void self.gotoFile(pos,"c")):void 0}},this.isClosed=function(pos){return!files[pos].isOpen()},this.fileListVisible=function(b){b!==fileListContainer.vplVisible&&(b?VPLUtil.delay("fileListVisible",(function(){fileListContainer.vplVisible=!0,self.updateFileList(),fileListContainer.show(),autoResizeTab()})):VPLUtil.delay("fileListVisible",(function(){fileListContainer.vplVisible=!1,fileListContainer.hide(),autoResizeTab()})))},this.isFileListVisible=function(){return fileListContainer.vplVisible},this.fileListVisibleIfNeeded=function(){if(!this.isFileListVisible())for(var i=0;i<files.length;i++)if(!files[i].isOpen())return void this.fileListVisible(!0)},this.setFontSize=function(size){options.fontSize=size;for(var i=0;i<files.length;i++)files[i].setFontSize(size);terminal.setFontSize(size)},this.getFontSize=function(){return options.fontSize},this.addFile=function(file,replace,ok,showError){if("string"!=typeof file.name||!VPLUtil.validPath(file.name))return showError(str("incorrect_file_name")+" ("+file.name+")"),!1;!0!==replace&&(replace=!1);var pos=this.fileNameExists(file.name);if(-1!=pos)return replace?(files[pos].setContent(file.contents),self.setModified(),ok(),VPLUtil.delay("updateFileList",self.updateFileList),file):(showError(str("filenotadded",file.name)),!1);if(fileNameIncluded(file.name)||twoBlockly("",file.name))return showError(str("filenotadded",file.name)),!1;if(files.length>=maxNumberOfFiles)return showError(str("maxfilesexceeded")+" ("+maxNumberOfFiles+")"),!1;var fid=VPLUtil.getUniqueId(),newfile=new VPLFile(fid,file.name,file.contents,this,vplIdeInstance);return 1==file.encoding?newfile.extendToBinary():VPLUtil.isBlockly(file.name)?newfile.extendToBlockly():newfile.extendToCodeEditor(),newfile.setFileName(file.name),files.push(newfile),self.setModified(),files.length>5&&self.fileListVisible(!0),ok(),newfile},this.renameFile=function(oldname,newname,showError){var pos=this.fileNameExists(oldname);try{if(-1==pos)throw new Error("Internal error: File name not found");if(pos<minNumberOfFiles)throw new Error("Internal error: Renaming requested filename");if(files[pos].getFileName()==newname)return!0;if(!VPLUtil.validPath(newname)||fileNameIncluded(newname)||twoBlockly(oldname,newname))throw str("incorrect_file_name");if(VPLUtil.isBinary(oldname)&&VPLUtil.fileExtension(oldname)!=VPLUtil.fileExtension(newname))throw str("incorrect_file_name");if(VPLUtil.isBlockly(oldname)!=VPLUtil.isBlockly(newname)){if(files[pos].getContent()>"")showMessage(str("delete_file_fq",oldname),{ok:function(){var file={name:newname,contents:"",encoding:0};fileManager.deleteFile(oldname,showError),fileManager.addFile(file,!1,updateMenu,showErrorMessage)&&fileManager.gotoFileName(newname)}});else{var file={name:newname,contents:"",encoding:0};fileManager.deleteFile(oldname,showError),fileManager.addFile(file,!1,updateMenu,showError)&&fileManager.gotoFileName(newname)}return!0}files[pos].setFileName(newname)}catch(e){return showError(str("filenotrenamed",newname)+": "+e),!1}return self.setModified(),adjustTabsTitles(!1),VPLUtil.delay("updateFileList",self.updateFileList),!0},this.deleteFile=function(name,showError){var pos=this.fileNameExists(name);return-1==pos||pos<minNumberOfFiles?(showError(str("filenotdeleted",name)),!1):(self.setModified(),self.close(files[pos]),files.splice(pos,1),VPLUtil.delay("updateFileList",self.updateFileList),!0)},this.currentFile=function(){var id=tabs.tabs("option","active");if(id in openFiles){var file=openFiles[id];if(0===arguments.length)return file;var action=arguments[0];if("function"==typeof file[action]){var fun=file[action],args=Array.prototype.slice(arguments);return args.shift(),fun.apply(file,args)}}return!1},this.currentPos=function(){return tabs.tabs("option","active")},this.getFileTab=function(id){for(var i=0;i<openFiles.length;i++)if(openFiles[i].getId()==id)return i;return-1},this.getFilePosById=function(id){for(var i=0;i<files.length;i++)if(files[i].getId()==id)return i;return-1},this.gotoFile=function(pos,l){var file=files[pos];self.open(file),tabs.tabs("option","active",self.getFileTab(file.getId())),"c"!==l&&file.gotoLine(parseInt(l,10)),file.focus()},this.gotoFileLink=function(a){var tag=$(a),fname=tag.data("file"),fpos=-1;if((fpos=fname>""?this.fileNameExists(fname):self.getFilePosById(tag.data("fileid")))>=0){var line=tag.data("line");return void 0===line&&(line="c"),self.gotoFile(fpos,line),!0}return!1},this.gotoFileName=function(fname,line){var fpos=this.fileNameExists(fname);return fpos>=0&&(void 0===line&&(line="c"),self.gotoFile(fpos,line),!0)},this.getFilesToSave=function(){for(var ret=[],i=0;i<files.length;i++){var file={};file.name=files[i].getFileName(),file.contents=files[i].getContent(),file.encoding=files[i].isBinary()?1:0,ret.push(file)}return ret},this.resetModified=function(){modified=!1;for(var i=0;i<files.length;i++)files[i].resetModified();VPLUtil.delay("updateMenu",updateMenu),VPLUtil.delay("updateFileList",self.updateFileList)},this.setModified=function(){modified=!0,VPLUtil.delay("updateFileList",self.updateFileList),VPLUtil.delay("updateMenu",updateMenu)},this.isModified=function(){return modified},this.length=function(){return files.length},this.clearAnnotations=function(){for(var i=0;i<files.length;i++)files[i].clearAnnotations()},this.getFile=function(i){return files[i]},this.getFiles=function(){return files},this.getDirectoryStructure=function(){var structure={isDir:!0,content:{}};function addFilePath(i){var file=files[i],path=file.getFileName().split("/"),curdir=structure;for(var p in path)if(path.hasOwnProperty(p)){var part=path[p];p==path.length-1?curdir.content[part]={isDir:!1,content:file,pos:i}:(curdir.content[part]||(curdir.content[part]={isDir:!0,content:{}}),curdir=curdir.content[part])}}for(var i in files)files.hasOwnProperty(i)&&addFilePath(i);return structure},this.generateFileList=function(){if(self.isFileListVisible()){var lines=[],html="";!function lister(dir,indent,lines){for(var name in dir.content)if(dir.content.hasOwnProperty(name)){var fd=dir.content[name];if(fd.isDir)lines.push(indent+VPLUtil.iconFolder()+VPLUtil.sanitizeText(name)),lister(fd,indent+'<span class="vpl_ide_dirindent"></span>',lines);else{var file=fd.content,sname=VPLUtil.sanitizeText(name),path=VPLUtil.sanitizeText(file.getFileName());file.isOpen()&&(sname="<b>"+sname+"</b>");var line="<a "+('href="#" data-fileid="'+file.getId()+'" title="'+path+'"')+">"+sname+"</a>";file.isModified()&&(line=VPLUtil.iconModified()+line),fd.pos<minNumberOfFiles&&(line+=VPLUtil.iconRequired()),lines.push(indent+line)}}}(self.getDirectoryStructure(),"",lines);for(var i=0;i<lines.length;i++)html+=lines[i]+"<br>";fileListContent.html("<div>"+html+"</div>")}},tabsUl.on("click","span.vpl_ide_closeicon",(function(){fileManager.close(fileManager.currentFile())})),tabsUl.on("dblclick","span.vpl_ide_closeicon",menuButtons.getAction("delete")),tabsUl.on("dblclick","a",menuButtons.getAction("rename")),fileListContent.on("dblclick","a",menuButtons.getAction("rename"))},autoResizeTab(),function(){var oldMenuWidth=menu.width();function checkMenuWidth(){var newMenuWidth=menu.width();oldMenuWidth!=newMenuWidth&&(oldMenuWidth=newMenuWidth,autoResizeTab())}checkMenuWidth(),setInterval(checkMenuWidth,1e3)}(),fileManager.resetModified(),VPLUtil.requestAction("load","loading",options,options.loadajaxurl).done((function(response){for(var allOK=!0,files=response.files,showFileList=!1,i=0;i<files.length;i++){var file=files[i],r=fileManager.addFile(file,!1,updateMenu,showErrorMessage);r?(r.resetModified(),i<minNumberOfFiles||files.length<=5?fileManager.open(r):showFileList=!0):allOK=!1}tabs.tabs("option","active",0),response.compilationexecution&&self.setResult(response.compilationexecution,!1),menuButtons.setTimeLeft(response),response.comments>""&&$("#vpl_ide_input_comments").val(response.comments),allOK?fileManager.resetModified():fileManager.setModified(),0===fileManager.length()&&maxNumberOfFiles>0?menuButtons.getAction("new")():options.saved||fileManager.setModified(),fileManager.setFontSize(options.fontSize),fileManager.setVersion(response.version),fileManager.fileListVisible(showFileList),VPLUtil.afterAll("AfterLoadFiles",(function(){updateMenu(),autoResizeTab(),adjustTabsTitles(!0)}))})).fail(showErrorMessage)};return window.VPLIDE=VPLIDE,{init:function(rootId,options){vplIdeInstance=new VPLIDE(rootId,options)}}}));
/**
 * File management
 *
 * @copyright 2013 Juan Carlos Rodrguez-del-Pino
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @author Juan Carlos Rodrguez-del-Pino <jcrodriguez@dis.ulpgc.es>
 */
define("mod_vpl/vplidefile",["jquery","jqueryui","mod_vpl/vplutil","mod_vpl/vplidecodefile","mod_vpl/vplideblocklyfile","mod_vpl/vplidebinaryfile"],(function($,jqui,VPLUtil,codeExtension,blocklyExtension,binaryExtension){return function(id,name,value,fileManager,vplIdeInstance){var tid="#vpl_file"+id,tabnameid="#vpl_tab_name"+id,fileName=name,modified=!0,opened=!1,self=this;this.getContent=function(){return value},this.setContent=function(c){value=c},this.getFileManager=function(){return fileManager},this.getFileName=function(){return fileName},this.getId=function(){return id},this.getTabNameId=function(){return tabnameid},this.getTId=function(){return tid},this.getFileName=function(){return fileName},this.isModified=function(){return modified},this.resetModified=function(){modified=!1,this.showFileName()},this.setModified=function(){modified=!0,this.showFileName()},this.getTabPos=function(){return fileManager.getTabPos(this)},this.isOpen=function(){return opened},this.setOpen=function(openState){opened=openState},this.getVPLIDE=function(){return vplIdeInstance},this.change=function(){modified||(this.setModified(),fileManager.generateFileList(),this.showFileName(),VPLUtil.longDelay("setModified",fileManager.setModified))},this.setFileName=function(name){return!!VPLUtil.validPath(name)&&(name!=fileName&&(fileName=name,self.change()),!this.isOpen()||(this.showFileName(),this.langSelection(),!0))},this.showFileName=function(){var name=this.getFileName(),fn=VPLUtil.getFileName(name);fn.length>20&&(fn=fn.substring(0,16)+"...");var html=(modified?VPLUtil.iconModified():"")+fn;this.getTabPos()<fileManager.minNumberOfFiles?html+=VPLUtil.iconRequired():html+=VPLUtil.iconClose(),$(tabnameid+" a").html(html),fn!=name&&$(tabnameid+" a").attr("title",name),VPLUtil.afterAll("adjustTabsTitles"+self.id,(function(){fileManager.adjustTabsTitles(!0),VPLUtil.delay("adjustTabsTitles"+self.id,(function(){self.adjustSize()}))}))},this.destroy=function(){$(tabnameid).remove(),$(tid).remove()},this.adjustSize=function(){if(!this.isOpen())return!1;var editTag=$(tid),tabs=editTag.parent();if(0===editTag.length)return!1;var editorHeight=editTag.height(),editorWidth=editTag.width(),newHeight=tabs.height();newHeight-=editTag.position().top;var newWidth=$("#vpl_tabs_scroll").width();return(newHeight!=editorHeight||newWidth!=editorWidth)&&($(editTag).height(newHeight),$(editTag).width(newWidth),!0)},this.gotoLine=VPLUtil.doNothing,this.setReadOnly=VPLUtil.doNothing,this.focus=VPLUtil.doNothing,this.blur=VPLUtil.doNothing,this.undo=VPLUtil.doNothing,this.redo=VPLUtil.doNothing,this.selectAll=VPLUtil.doNothing,this.open=VPLUtil.doNothing,this.hasUndo=VPLUtil.returnFalse,this.hasRedo=VPLUtil.returnFalse,this.hasSelectAll=VPLUtil.returnFalse,this.hasFind=VPLUtil.returnFalse,this.hasFindReplace=VPLUtil.returnFalse,this.hasNext=VPLUtil.returnFalse,this.find=VPLUtil.doNothing,this.replace=VPLUtil.doNothing,this.next=VPLUtil.doNothing,this.getAnnotations=function(){return[]},this.setAnnotations=VPLUtil.doNothing,this.setFontSize=VPLUtil.doNothing,this.setTheme=VPLUtil.doNothing,this.clearAnnotations=VPLUtil.doNothing,this.langSelection=VPLUtil.doNothing,this.isBinary=VPLUtil.returnFalse,this.extendToCodeEditor=codeExtension,this.extendToBlockly=blocklyExtension,this.extendToBinary=binaryExtension}}));
/**
 * Tools for the VPL IDE
 *
 * @copyright 2016 Juan Carlos Rodrguez-del-Pino
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @author Juan Carlos Rodrguez-del-Pino <jcrodriguez@dis.ulpgc.es>
 */
define("mod_vpl/vplutil",["jquery","jqueryui","core/log"],(function($,jqui,log){var VPLUtil={};VPLUtil.doNothing=$.noop,VPLUtil.returnFalse=function(){return!1},VPLUtil.returnTrue=function(){return!0};var fileUniqueId,MIME,maplang,i18n,strreg,menuIcons,lastProccessID,scriptsLoaded,debugMode=!1;return VPLUtil.log=function(m,forced){(debugMode||forced)&&log.debug(m)},VPLUtil.setUserPreferences=function(pref){$.ajax({async:!0,type:"POST",url:"../editor/userpreferences.json.php",data:JSON.stringify(pref),contentType:"application/json; charset=utf-8",dataType:"json"})},VPLUtil.getUserPreferences=function(func){$.ajax({async:!0,type:"POST",url:"../editor/userpreferences.json.php",data:JSON.stringify({getPreferences:!0}),contentType:"application/json; charset=utf-8",dataType:"json"}).done(func)},VPLUtil.scrollBarWidth=function(){var parent,child,width;return width=(child=(parent=$('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body")).children()).innerWidth()-child.height(99).innerWidth(),parent.remove(),width},VPLUtil.sanitizeHTML=function(t){return void 0===t||""==t.replace(/^\s+$/g,"")?"":$("<div>"+t+"</div>").html()},VPLUtil.sanitizeText=function(s){return void 0===s||""==s.replace(/^\s+$/g,"")?"":s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},VPLUtil.setProtocol=function(coninfo){var secure;if(0==coninfo.securePort||0==coninfo.port)secure=0==coninfo.port;else switch(coninfo.wsProtocol){case"always_use_wss":secure=!0;break;case"always_use_ws":secure=!1;break;default:secure="https:"==window.location.protocol}var URLBase=(secure?"wss://":"ws://")+coninfo.server;coninfo.secure=secure,coninfo.portToUse=secure?coninfo.securePort:coninfo.port,URLBase+=":"+coninfo.portToUse+"/",coninfo.monitorURL=URLBase+coninfo.monitorPath,coninfo.executionURL=URLBase+coninfo.executionPath},VPLUtil.ArrayBuffer2String=function(data){var i,len,view=new Uint8Array(data),chunks=[];for(i=0,len=view.length;i<len;i+=32e3)chunks.push(String.fromCharCode.apply(String,view.subarray(i,Math.min(i+32e3,len))));return chunks.join("")},VPLUtil.String2ArrayBuffer=function(data){for(var len=data.length,ret=new ArrayBuffer(len),u8=new Uint8Array(ret),i=0;i<len;i++)u8[i]=data.charCodeAt(i);return ret},fileUniqueId=0,VPLUtil.getUniqueId=function(){return fileUniqueId++},function(){var regExt=/\.([^.]*)$/,regImg=/^(gif|jpg|jpeg|png|ico)$/i,regBin=/^(zip|jar|pdf|tar|bin|7z|arj|deb|gzip|rar|rpm|dat|db|dll|rtf|doc|docx|odt|exe|com)$/i,regBlk=/^blockly[0123]?$/;VPLUtil.fileExtension=function(fileName){var res=regExt.exec(fileName);return null!==res?res[1]:""},VPLUtil.isImage=function(fileName){return regImg.test(VPLUtil.fileExtension(fileName))},VPLUtil.isBinary=function(fileName){return VPLUtil.isImage(fileName)||regBin.test(VPLUtil.fileExtension(fileName))},VPLUtil.isBlockly=function(fileName){return regBlk.test(VPLUtil.fileExtension(fileName))};var regInvalidFileName=/[\cA-\cZ]|[:-@]|[{-~]|\\|\[|\]|[/^`]|^-|^ | $|\.\./;VPLUtil.validFileName=function(fileName){return!(fileName.length<1)&&(!(fileName.length>128)&&!regInvalidFileName.test(fileName))}}(),VPLUtil.getCurrentTime=function(){return parseInt((new Date).valueOf()/1e3)},VPLUtil.encodeBinary=function(name,data){return VPLUtil.isBinary(name)?btoa(VPLUtil.ArrayBuffer2String(data)):btoa(unescape(encodeURIComponent(data)))},VPLUtil.decodeBinary=function(name,data){var decoded=atob(data);return VPLUtil.isBinary(name)?VPLUtil.String2ArrayBuffer(decoded):decodeURIComponent(escape(decoded))},VPLUtil.validPath=function(path){if(path.length>256)return!1;for(var dirs=path.split("/"),i=0;i<dirs.length;i++)if(!VPLUtil.validFileName(dirs[i]))return!1;return!0},VPLUtil.getFileName=function(path){var dirs=path.split("/");return dirs[dirs.length-1]},VPLUtil.dataFromURLData=function(data){return data.substr(data.indexOf(",")+1)},VPLUtil.readZipFile=function(data,save,progressBar,end){if(end||(end=VPLUtil.doNothing),"undefined"!=typeof JUnzip){var ab=VPLUtil.ArrayBuffer2String(data),unzipper=new JUnzip(ab);if(!unzipper.isZipFile())return VPLUtil.log("Not a ZIP file"),void end();unzipper.readEntries();var out=unzipper.entries.length;!function process(i){if(i>=out||progressBar.isClosed())end();else{var data,entry=unzipper.entries[i],fileName=entry.fileName;if(fileName.match(/\/$/))process(i+1);else{progressBar.processFile(fileName);var uncompressed="";if(0===entry.compressionMethod?uncompressed=entry.data:8===entry.compressionMethod&&(uncompressed=JSInflate.inflate(entry.data)),VPLUtil.isBinary(fileName))save({name:fileName,contents:btoa(uncompressed),encoding:1}),process(i+1);else{data=VPLUtil.String2ArrayBuffer(uncompressed);var blob=new Blob([data],{type:"text/plain"}),fr=new FileReader;fr.onload=function(e){save({name:fileName,contents:e.target.result,encoding:0}),process(i+1)},fr.onerror=function(e){VPLUtil.log(e),process((i=out)+1)},fr.readAsText(blob)}}}}(0)}else VPLUtil.loadScript(["../editor/zip/inflate.js","../editor/zip/unzip.js"],(function(){VPLUtil.readZipFile(data,save,progressBar,end)}))},VPLUtil.readSelectedFiles=function(filesToRead,save,end){var pb=new VPLUtil.progressBar("import","import"),errorsMessages="";end||(end=VPLUtil.doNothing),pb.processFile=function(name){pb.setLabel(name)},function readSecuencial(sec){if(sec>=filesToRead.length||pb.isClosed())return end(),pb.close(),void(errorsMessages>""&&VPLUtil.showErrorMessage(errorsMessages));var f=filesToRead[sec];pb.processFile(f.name);var binary=VPLUtil.isBinary(f.name),reader=new FileReader,ext=VPLUtil.fileExtension(f.name).toLowerCase();reader.onload=function(e){if(binary)if("zip"==ext)try{return void VPLUtil.readZipFile(e.target.result,save,pb,(function(){readSecuencial(sec+1)}))}catch(ex){VPLUtil.showErrorMessage(ex+" : "+f.name)}else{var data=VPLUtil.dataFromURLData(e.target.result);save({name:f.name,contents:data,encoding:1})}else save({name:f.name,contents:e.target.result,encoding:0});readSecuencial(sec+1)},reader.onerror=function(e){errorsMessages+='Error "'+e.target.error+'" reading '+f.name+"\n",readSecuencial(sec+1)},binary?"zip"==ext?reader.readAsArrayBuffer(f):reader.readAsDataURL(f):reader.readAsText(f)}(0)},MIME={gif:"image/gif",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",ico:"image/vnd.microsoft.icon",pdf:"application/pdf"},VPLUtil.getMIME=function(fileName){var ext=VPLUtil.fileExtension(fileName);return ext in MIME?MIME[ext]:"application/octet-stream"},VPLUtil.getTimeLeft=function(timeLeft){var res="";timeLeft<0&&(res+="-",timeLeft=-timeLeft);var timePending=timeLeft,days=parseInt(timePending/86400);timePending-=86400*days,0!==days&&(res+=days+"T");var hours=parseInt(timePending/3600);timePending-=3600*hours;var minutes=parseInt(timePending/60);timePending-=60*minutes;var seconds=parseInt(timePending);return res+=("00"+hours).substr(-2)+":",res+=("00"+minutes).substr(-2),timeLeft<3600&&(res+=":"+("00"+seconds).substr(-2)),res},maplang={abap:"abap",abc:"abc",ada:"ada",ads:"ada",adb:"ada",as:"actionscript",as3:"actionscript",asm:"assembly_x86",bash:"sh",bat:"batchfile",c:"c_cpp",C:"c_cpp",cc:"c_cpp",cpp:"c_cpp","c++":"c_cpp",hxx:"c_cpp",h:"c_cpp",H:"c_cpp",cases:"cases",cbl:"cobol",cob:"cobol",coffee:"coffee",clj:"clojure",cs:"csharp",css:"css",d:"d",dart:"dart",e:"eiffel",erl:"erlang",hrl:"erlang",f:"fortran",f77:"fortran",f90:"fortran",for:"fortran",go:"golang",groovy:"groovy",gv:"dot",hs:"haskell",htm:"html",html:"html",hx:"haxe",java:"java",jl:"julia",js:"javascript",json:"json",jsp:"jsp",jsx:"jsx",kt:"kotlin",kts:"kotlin",m:"matlab",md:"markdown",less:"less",lisp:"lisp",lsp:"lisp",lua:"lua",pas:"pascal",p:"pascal",perl:"perl",prl:"perl",php:"php",pro:"prolog",pl:"prolog",py:"python",R:"r",r:"r",rb:"ruby",ruby:"ruby",s:"assembly_x86",sass:"sass",scala:"scala",scm:"scheme",scss:"scss",sh:"sh",swift:"swift",sql:"sql",svg:"svg",tex:"tex",tcl:"tcl",ts:"typescript",twig:"twig",vbs:"vbscript",v:"verilog",vh:"verilog",vhd:"vhdl",vhdl:"vhdl",xml:"xml",yaml:"yaml"},VPLUtil.langType=function(ext){return ext in maplang?maplang[ext]:"plain_text"},i18n={},strreg=/\{\\*\$a\\*}/g,VPLUtil.str=function(key,parm){return i18n[key]?void 0!==parm?i18n[key].replace(strreg,parm):i18n[key]:"{"+key+"}"},VPLUtil.setStr=function(newi18n){for(var key in newi18n)newi18n.hasOwnProperty(key)&&(i18n[key]=newi18n[key]);VPLUtil.dialogbaseOptions={minWidth:200,autoOpen:!1,width:"auto",closeText:VPLUtil.str("cancel"),modal:!0,dialogClass:"vpl_ide vpl_ide_dialog"}},VPLUtil.setStr(window.VPLi18n),function(){var delayedActions={},afterAllActions={},numberDelayed=0;VPLUtil.delay=function(id,func,arg1,arg2){void 0!==delayedActions[id]&&(clearTimeout(delayedActions[id]),numberDelayed--),numberDelayed++,delayedActions[id]=setTimeout((function(){numberDelayed--,func(arg1,arg2),delete delayedActions[id]}),20)},VPLUtil.longDelay=function(id,func,arg1,arg2){void 0!==delayedActions[id]&&(clearTimeout(delayedActions[id]),numberDelayed--),numberDelayed++,delayedActions[id]=setTimeout((function(){numberDelayed--,func(arg1,arg2),delete delayedActions[id]}),100)};var setAfterTimeout=function setAfterTimeout(id,func,arg1,arg2){return void 0!==afterAllActions[id]&&clearTimeout(afterAllActions[id]),setTimeout((function(){numberDelayed>0?afterAllActions[id]=setAfterTimeout(id,func,arg1,arg2):(func(arg1,arg2),delete afterAllActions[id])}),100)};VPLUtil.afterAll=function(id,func,arg1,arg2){afterAllActions[id]=setAfterTimeout(id,func,arg1,arg2)}}(),VPLUtil.iconModified=function(){var html='<span title="'+VPLUtil.str("modified")+'" class="vpl_ide_charicon">';return html+='<i class="fa fa-star"></i></span> '},VPLUtil.iconDelete=function(){var html=' <span title="'+VPLUtil.str("delete")+'" class="vpl_ide_charicon vpl_ide_delicon">';return html+='<i class="fa fa-trash"></i></span> '},VPLUtil.iconClose=function(){var html=' <span title="'+VPLUtil.str("closebuttontitle");return html+='" class="vpl_ide_charicon vpl_ide_closeicon"><i class="fa fa-remove"></i></span> '},VPLUtil.iconRequired=function(){var html=' <span title="'+VPLUtil.str("required")+'" class="vpl_ide_charicon">';return html+='<i class="fa fa-shield"></i></span> '},VPLUtil.iconFolder=function(){return'<i class="fa fa-folder-open-o"></i>'},menuIcons={filelist:"folder-open-o",filelistclose:"folder-o",new:"file-code-o",rename:"pencil",delete:"trash",multidelete:"trash|list",close:"remove",comments:"commenting",import:"upload",print:"print",edit:"edit",undo:"undo",redo:"repeat",select_all:"location-arrow",find:"search",find_replace:"exchange",next:"search-plus",resetfiles:"refresh",download:"download",fullscreen:"expand",regularscreen:"compress",save:"save",shortcuts:"flash",sort:"list-ol",run:"rocket",running:"rocket fa-spin",debug:"bug",evaluate:"check-square-o",console:"terminal",about:"question",info:"info-circle",alert:"warning",trash:"trash",retrieve:"download",spinner:"refresh fa-spin",keyboard:"keyboard-o",clipboard:"clipboard",timeleft:"clock-o",copy:"copy",paste:"paste",more:"plus-square",less:"minus-square",resize:"arrows-alt",graphic:"picture-o",send:"send",theme:"paint-brush",user:"user",fontsize:"text-height","close-rightpanel":"caret-square-o-right","open-rightpanel":"caret-square-o-left"},VPLUtil.genIcon=function(icon,size){if(!menuIcons[icon])return"";var classes="fa fa-";classes+=size||"lg";for(var icons=menuIcons[icon].split("|"),ret="",i=0;i<icons.length;i++)ret+="<i class='"+classes+" fa-"+icons[i]+"'></i>";return ret},VPLUtil.setTitleBar=function(dialog,type,icon,buttons,handler){var title=$(dialog).parent().find("span.ui-dialog-title");function genButton(e){var html="<a id='vpl_"+type+"_"+e+"' href='#' title='"+VPLUtil.str(e)+"'>";return html+=VPLUtil.genIcon(e,"fw")+"</a>"}var html=VPLUtil.genIcon(icon);html+=" <span class='"+type+"-title-buttons'></span>",html+="<span class='"+type+"-title-text'></span>",title.html(html);var titleButtons=title.find("span."+type+"-title-buttons"),titleText=title.find("span."+type+"-title-text");html="";for(var i=0;i<buttons.length;i++)html+=genButton(buttons[i]);titleButtons.html(html);for(var ih=0;ih<handler.length;ih++){var button=title.find("#vpl_"+type+"_"+buttons[ih]);button.button().click(handler[ih]),button.css("padding","1px 3px")}return titleButtons.on("focus","*",(function(){$(this).blur()})),titleText},VPLUtil.setDialogTitleIcon=function(dialog,icon){var title=$(dialog).parent().find("span.ui-dialog-title");title.html(VPLUtil.genIcon(icon)+" "+title.html())},VPLUtil.progressBar=function(title,message,onUserClose){var sppiner='<div class="vpl_ide_progressbaricon">'+VPLUtil.genIcon("spinner")+"</div>",dialog=$('<div class="vpl_ide_dialog" style="display:none;">'+(' <div class="vpl_ide_progressbar">'+sppiner+'<span class="vpl_ide_progressbarlabel"></span></div>')+"</div>");$("body").append(dialog);var label=dialog.find(".vpl_ide_progressbar").find(".vpl_ide_progressbarlabel");dialog.dialog({title:VPLUtil.str(title),resizable:!1,autoOpen:!1,width:200,height:20,minHeight:20,modal:!0,dialogClass:"vpl_ide vpl_ide_dialog",close:function(event){dialog&&(onUserClose&&event.originalEvent&&onUserClose(),onUserClose=!1)}}),this.setLabel=function(t,icon){dialog&&(label.text(t),icon&&label.html(VPLUtil.genIcon(icon)+" "+label.html()))},this.close=function(){dialog&&(dialog.dialog("destroy"),$(dialog).remove(),dialog=!1)},this.isClosed=function(){return!1===dialog};var titleTag=dialog.siblings().find(".ui-dialog-title");titleTag.html(VPLUtil.genIcon(title)+" "+titleTag.html()),this.setLabel(VPLUtil.str(message)),dialog.dialog("open"),dialog.dialog("option","height","auto")},VPLUtil.showMessage=function(message,initialoptions){var options=$.extend({},VPLUtil.dialogbaseOptions,initialoptions),messageDialog=$('<div class="vpl_ide_dialog" style="display:none"></div>'),icon="",contents=' <span class="dmessage">'+message.replace(/\n/g,"<br>")+"</span>";messageDialog.html(contents),void 0===options.icon?icon="info":(icon=options.icon,delete options.icon),options.title||(options.title=VPLUtil.str("warning")),$("body").append(messageDialog);var messageButtons={};"function"==typeof initialoptions.ok?(messageButtons[VPLUtil.str("ok")]=function(){$(this).dialog("close"),initialoptions.ok()},messageButtons[VPLUtil.str("cancel")]=function(){$(this).dialog("close")},delete options.ok):"function"==typeof initialoptions.yes?(messageButtons[VPLUtil.str("yes")]=function(){$(this).dialog("close"),initialoptions.yes()},messageButtons[VPLUtil.str("no")]=function(){$(this).dialog("close")},delete options.yes):messageButtons[VPLUtil.str("close")]=function(){$(this).dialog("close")},options.next&&(messageButtons[VPLUtil.str("next")]=function(){$(this).dialog("close"),initialoptions.next()}),options.close=function(){$(this).remove(),initialoptions.close&&initialoptions.close()},options.buttons=messageButtons,messageDialog.dialog(options);var titleTag=messageDialog.siblings().find(".ui-dialog-title");return titleTag.html(VPLUtil.genIcon(icon)+" "+titleTag.html()),messageDialog.setMessage=function(men){$(messageDialog).find(".dmessage").html(men.replace(/\n/g,"<br>"))},messageDialog.dialog("open"),messageDialog},VPLUtil.showErrorMessage=function(message,options){var currentOptions=$.extend({},VPLUtil.dialogbaseOptions,{title:VPLUtil.str("error"),icon:"alert"});return options&&(currentOptions=$.extend(currentOptions,options)),VPLUtil.showMessage(message,currentOptions)},VPLUtil.requestAction=function(action,title,data,URL,noDialog){var deferred=$.Deferred(),request=null,xhr=!1,apb=!1;return noDialog||(""===title&&(title="connecting"),apb=new VPLUtil.progressBar(action,title,(function(){4!=request.readyState&&xhr&&xhr.abort&&xhr.abort()}))),request=$.ajax({beforeSend:function(jqXHR){return xhr=jqXHR,!0},async:!0,type:"POST",url:URL+action,data:JSON.stringify(data),contentType:"application/json; charset=utf-8",dataType:"json"}).always((function(){noDialog||apb.close()})).done((function(response){response.success?deferred.resolve(response.response):deferred.reject(response.error)})).fail((function(jqXHR,textStatus,errorThrown){var message=VPLUtil.str("connection_fail")+": "+textStatus;debugMode&&null!=errorThrown.message&&(message+=": "+errorThrown.message),VPLUtil.log(message),deferred.reject(message)})),deferred},VPLUtil.supportWebSocket=function(){return"WebSocket"in window},VPLUtil.isAndroid=function(){return window.navigator.userAgent.indexOf("Android")>-1},VPLUtil.isFirefox=function(){return window.navigator.userAgent.indexOf("Firefox")>-1},VPLUtil.isMac=function(){return window.navigator.userAgent.indexOf("Mac")>-1},VPLUtil.clickServer=function(e){var left=screen.width/2-275,top=screen.height/2-225;try{var features="toolbar=no, location=no, directories=no, status=no, menubar=no";if(features+=", resizable=yes, scrollbars=yes, copyhistory=no, width=550",features+=", height=450, top="+top+", left="+left,!window.open($(this).attr("href"),"_blank",features))return!0}catch(ex){return VPLUtil.log(ex),!0}return e.preventDefault(),$(this).parent().hide(),!1},VPLUtil.acceptCertificates=function(servers,getLastAction){if(servers.length>0){var i,html=VPLUtil.str("acceptcertificatesnote");for(i in html+="<ol>",servers)if(servers.hasOwnProperty(i)){var n=1+i;html+='<li><a href="'+servers[i]+'" target="_blank">Server ',html+=n+"</a></li>"}html+="</ol>";var m=VPLUtil.showMessage(html,{ok:function(){var action=getLastAction();action&&action()},icon:"unlocked",title:VPLUtil.str("acceptcertificates")});$(m).find("a").on("click keypress",VPLUtil.clickServer)}else VPLUtil.log("servers.length == 0"),VPLUtil.showErrorMessage(VPLUtil.str("connection_fail"))},VPLUtil.monitorRunning=VPLUtil.returnFalse,lastProccessID=-1,VPLUtil.setProcessId=function(id){lastProccessID=id},VPLUtil.getProcessId=function(){return lastProccessID},VPLUtil.webSocketMonitor=function(coninfo,title,running,externalActions){VPLUtil.setProtocol(coninfo),VPLUtil.setProcessId(coninfo.processid);var ws=null,pb=null,deferred=$.Deferred(),defail=function(m){deferred.reject(m)},delegated=!1,messageActions={message:function(content){var parsed=/^([^:]*):?([^]*)/.exec(content),state=parsed[1],detail=parsed[2];"running"==state&&(state=running);var text=VPLUtil.str(state);detail>""&&(text+=": "+detail),null===pb||pb.isClosed()?externalActions.getConsole&&externalActions.getConsole().isOpen()?externalActions.getConsole().setMessage(text):VPLUtil.log("Error: no dialogo. Message not shown: "+text):pb.setLabel(text)},compilation:function(content){externalActions.setResult&&externalActions.setResult({compilation:content},!1)},retrieve:function(){var data={processid:VPLUtil.getProcessId()};pb.close(),delegated=!0,VPLUtil.requestAction("retrieve","",data,externalActions.ajaxurl).done((function(response){deferred.resolve(),externalActions.setResult&&externalActions.setResult(response,!0)})).fail(defail)},run:function(content){pb.close(),externalActions.run(content,coninfo,ws)},close:function(){VPLUtil.log("ws close message from jail"),ws.close();var data={processid:VPLUtil.getProcessId()};VPLUtil.requestAction("cancel","",data,externalActions.ajaxurl,!0)}};try{if(!VPLUtil.supportWebSocket())return VPLUtil.log("ws not available"),deferred.reject(VPLUtil.str("browserupdate")),deferred;ws=new WebSocket(coninfo.monitorURL)}catch(e){return VPLUtil.log("ws new say "+e),deferred.reject(e.message),deferred}return pb=new VPLUtil.progressBar(title,"connecting",(function(){deferred.reject("Stopped by user"),ws.close()})),ws.notOpen=!0,ws.onopen=function(){ws.notOpen=!1,pb.setLabel(VPLUtil.str("connected")),externalActions.open&&externalActions.open()},ws.onerror=function(event){VPLUtil.log("ws error "+event),pb.close(),coninfo.secure&&ws.notOpen?VPLUtil.requestAction("getjails","retrieve",{},externalActions.ajaxurl).done((function(response){VPLUtil.acceptCertificates(response.servers,(function(){return externalActions.getLastAction()}))})).fail(defail):deferred.reject(VPLUtil.str("connection_fail")),externalActions.close&&VPLUtil.delay("externalActions.close",externalActions.close)},ws.onclose=function(){externalActions.getConsole&&externalActions.getConsole().disconnect(),ws.notOpen||(pb.close(),delegated||"rejected"==deferred.state()||deferred.resolve()),externalActions.close&&externalActions.close()},ws.onmessage=function(event){var message=/^([^:]+):([^]*)/.exec(event.data);if(null!==message){var action=message[1],content=message[2];messageActions[action]&&messageActions[action](content)}else pb.setLabel(VPLUtil.str("error")+": "+event.data)},VPLUtil.monitorRunning=function(){return null!==ws&&ws.readyState!=WebSocket.CLOSED},deferred},VPLUtil.directRun=function(URL,command,files){var deferred=$.Deferred();return $.ajax({async:!0,type:"POST",url:URL+"directrun",data:JSON.stringify({command:command,files:files}),contentType:"application/json; charset=utf-8",dataType:"json"}).done((function(result){if(result.success){var response=result.response;VPLUtil.setProtocol(response);var ws=new WebSocket(response.executionURL);log.debug("Conecting with:"+response.executionURL),deferred.resolve({processid:response.processid,homepath:response.homepath,connection:ws})}else deferred.reject(result.error)})).fail((function(jqXHR,textStatus,errorThrown){var message="Connection fail: "+textStatus;null!=errorThrown.message&&(message+=": "+errorThrown.message),log.debug(message),deferred.reject(message)})),deferred},VPLUtil.directRunTest=function(URL,command,data){VPLUtil.directRun(URL,command,[{name:"a.c",contents:"int main(){return 0;}",encoding:0},{name:"b.c",contents:"int f(){return 1;}",encoding:0}]).done((function(result){var mcount=0;result.connection.onopen=function(){log.debug("Ws open "+result.homepath+" processid "+result.processid),null!=data&&result.connection.send(data),setTimeout((function(){result.connection.close()}),6e5)},result.connection.onmessage=function(event){log.debug("WS Message ("+ ++mcount+"): "+event.data),mcount>=10&&result.connection.close()},result.connection.onerror=function(event){log.debug("WS error: "+event)},result.connection.onclose=function(event){log.debug("WS close: "+event.code+" "+event.reason)}})).fail((function(message){log.debug("Direct run fail. URL: "+URL+" command: "+command+" message: "+message)}))},VPLUtil.processResult=function(text,filenames,sh,noFormat,folding){if(void 0===text||""==text.replace(/^\s+$/gm,""))return"";function escReg(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/,"\\$&")}var regtitgra=/\([-]?[\d]+[.]?[\d]*\)\s*$/,regtit=/^-.*/,regcas=/^\s*>/,regError=new RegExp("\\[err\\]|error|"+escReg(VPLUtil.str("error")),"i"),regWarning=new RegExp("\\[warn\\]|warning|note|"+escReg(VPLUtil.str("warning")),"i"),regInformation=new RegExp("\\[info\\]|information","i"),state="",html="",comment="",case_="",lines=text.split(/\r\n|\n|\r/),regFiles=[],lastAnotation=!1,lastAnotationFile=!1,afterTitle=!1;function getHref(i){return void 0===sh[i].getTagId?'href="#" ':'href="#'+sh[i].getTagId()+'" '}function genFileLinks(line,rawline){for(var used=!1,i=0;i<regFiles.length;i++)for(var match,reg=regFiles[i];null!==(match=reg.exec(line));){var type,anot=sh[i].getAnnotations();lastAnotationFile=i,used=!0,type=line.search(regError)>-1?"error":line.search(regWarning)>-1?"warning":line.search(regInformation)>-1?"info":"error",lastAnotation={row:match[3]-1,column:match[5],type:type,text:rawline},anot.push(lastAnotation);var fileName=filenames[i],href=getHref(i),lt=VPLUtil.sanitizeText(fileName),data='data-file="'+fileName+'" data-line="'+match[3]+'"';line=line.replace(reg,"$1<a "+href+' class="vpl_fl" '+data+">"+lt+"$2$3$4$5$6</a>"),sh[i].setAnnotations(anot)}return!used&&lastAnotation&&(""!==rawline?(lastAnotation.text+="\n"+rawline,sh[lastAnotationFile].setAnnotations(sh[lastAnotationFile].getAnnotations())):lastAnotation=!1),line}function getTitle(line){lastAnotation=!1,line=line.substr(1);var end=regtitgra.exec(line);null!==end&&(line=line.substr(0,line.length-end[0].length));var html="";return folding&&(html+='<a href="javascript:void(0)" onclick="VPLUtil.showHideDiv(this)">[+]</a>'),html=genFileLinks(html+='<b class="ui-widget-header ui-corner-all">'+VPLUtil.sanitizeText(line)+"</b><br>",line)}function getComment(){lastAnotation=!1;var ret=comment;return comment="",ret}function addComment(rawline){var line=VPLUtil.sanitizeText(rawline);comment+=genFileLinks(line,rawline)+"<br>"}function addCase(rawline){var line=VPLUtil.sanitizeText(rawline);case_+=genFileLinks(line,rawline)+"\n"}function getCase(){lastAnotation=!1;var ret=case_;return case_="","<pre><i>"+ret+"</i></pre>"}!function(){for(var i=0;i<filenames.length;i++){var reg="(^| |/)"+escReg(filenames[i])+"( on line | line |:|\\()(\\d+)(:|,)?(\\d+)?(\\))?";regFiles[i]=new RegExp(reg,"m")}}();for(var i=0;i<lines.length;i++){var line=lines[i];if(noFormat)html+=genFileLinks(VPLUtil.sanitizeText(line),line)+"\n";else{var match=regcas.exec(line),regcasv=regcas.test(line);if(null!==match!=regcasv&&VPLUtil.log("error"),regtit.test(line)){switch(state){case"comment":html+=getComment();break;case"case":html+=getCase()}afterTitle&&(html+="</div>"),html+=getTitle(line),html+=folding?'<div style="display:none">':"<div>",afterTitle=!0,state=""}else regcasv?("comment"==state&&(html+=getComment()),addCase(line.substr(match[0].length)),state="case"):("case"==state&&(html+=getCase()),addComment(line),state="comment")}}switch(state){case"comment":html+=getComment();break;case"case":html+=getCase()}return afterTitle&&(html+="</div>"),html},scriptsLoaded=[],VPLUtil.loadScript=function(scripts,end){if(0!=scripts.length){var scriptURL=scripts[0];if(void 0===scriptsLoaded[scriptURL]){scripts.shift(),scriptsLoaded[scriptURL]=1;var script=document.createElement("script");script.type="text/javascript",script.src=VPLUtil.options.scriptPath+scriptURL,script.onload=function(){scriptsLoaded[scriptURL]=2,VPLUtil.loadScript(scripts,end)},document.head.appendChild(script)}else 2==scriptsLoaded[scriptURL]?(scripts.shift(),VPLUtil.loadScript(scripts,end)):(VPLUtil.log("Error loading js "+scriptURL+" "+scriptsLoaded[scriptURL]),setTimeout((function(){VPLUtil.loadScript(scripts,end)}),50))}else end()},VPLUtil.isScriptLoading=function(scriptURL){return void 0!==scriptsLoaded[scriptURL]&&1==scriptsLoaded[scriptURL]},VPLUtil.isScriptLoaded=function(scriptURL){return void 0!==scriptsLoaded[scriptURL]&&2==scriptsLoaded[scriptURL]},VPLUtil.adjustBlockly=function(work,offx,offy){for(var blocks=work.getAllBlocks(),miy=2e4,may=-2e4,mix=2e4,max=-2e4,i=0;i<blocks.length;i++){var xy=blocks[i].getRelativeToSurfaceXY();miy=Math.min(miy,xy.y),may=Math.max(may,xy.y),mix=Math.min(mix,xy.x),max=Math.max(max,xy.x)}blocks=work.getTopBlocks();for(var j=0;j<blocks.length;j++)blocks[j].moveBy(offx-mix,offy-miy);return may-miy+100+offy},function(){var files=[],results=[],shs=[];function SubmissionHighlighter(files,results){var self=this;this.files=files,this.results=results,setTimeout((function(){self.highlight()}),10)}SubmissionHighlighter.prototype.highlightBlockly=function(preid){VPLUtil.loadScript(["../editor/blockly/blockly_compressed.js","../editor/blockly/msg/js/en.js","../editor/blockly/blocks_compressed.js"],(function(){var tag=$("#"+preid),c=tag.html();$("#"+preid+"load").remove(),tag.html(""),tag.show(),c=$("<div />").html(c).text().replace(/\n/g,"");var xml=Blockly.Xml.textToDom(c);tag.html("").height(300).width(tag.parent().width());var work=Blockly.inject(preid,{toolbox:"",readOnly:!0,media:"../editor/blockly/media/"});Blockly.Xml.domToWorkspace(xml,work);var hg=VPLUtil.adjustBlockly(work,10,10);tag.height(hg),tag.width("100%"),Blockly.svgResize(work),Blockly.resizeSvgContents(work);var h=tag.html();work.dispose(),tag.html(h)}))},SubmissionHighlighter.prototype.highlight=function(){for(var self=this,needAce=!1,files=this.files,i=0;i<files.length;i++){var file=files[i];if(!VPLUtil.isBinary(file.fileName)&&!VPLUtil.isBlockly(file.fileName)){needAce=!0;break}}if(needAce&&"undefined"==typeof ace)VPLUtil.loadScript(["../editor/ace9/ace.js"],(function(){self.highlight()}));else{for(var results=this.results,shFiles=[],shFileNames=[],_i=0;_i<files.length;_i++){var _file=files[_i],preid="code"+_file.tagId;if(VPLUtil.isBlockly(_file.fileName))self.highlightBlockly(preid);else{var ext=VPLUtil.fileExtension(_file.fileName),lang=VPLUtil.langType(ext);$("#"+preid).show(),$("#"+preid+"load").remove();var sh=ace.edit(preid);sh.setTheme("ace/theme/"+_file.theme),sh.getSession().setMode("ace/mode/"+lang),sh.renderer.setShowGutter(_file.showln),sh.setReadOnly(!0),sh.setHighlightActiveLine(!1),sh.setAutoScrollEditorIntoView(!0),sh.setOption("maxLines",_file.nl),sh.getAnnotations=function(){return this.getSession().getAnnotations()},sh.setAnnotations=function(a){return this.getSession().setAnnotations(a)},sh.getTagId=function(){return this.vplTagId},sh.vplTagId=_file.tagId,shFiles.push(sh),shFileNames.push(_file.fileName),shs[_file.tagId]=sh}}for(var ri=0;ri<results.length;ri++){var tag=document.getElementById(results[ri].tagId),text=tag.textContent||tag.innerText;tag.innerHTML=VPLUtil.processResult(text,shFileNames,shFiles,results[ri].noFormat,results[ri].folding)}}},VPLUtil.addResults=function(tagId,noFormat,folding){results.push({tagId:tagId,noFormat:noFormat,folding:folding})},VPLUtil.syntaxHighlightFile=function(tagId,fileName,theme,showln,nl){files.push({tagId:tagId,fileName:fileName,theme:theme,showln:showln,nl:nl})},VPLUtil.syntaxHighlight=function(){new SubmissionHighlighter(files,results),files=[],results=[]},VPLUtil.flEventHandler=function(event){var tag=event.target.getAttribute("href").substring(1),line=event.target.getAttribute("data-line"),sh=shs[tag];sh.gotoLine(line,0),sh.scrollToLine(line,!0)},VPLUtil.setflEventHandler=function(){for(var links=document.getElementsByClassName("vpl_fl"),i=0;i<links.length;i++)links[i].onclick=VPLUtil.flEventHandler},VPLUtil.showHideDiv=function(a){var text=a,div=a;for(div.nextSibling||(div=div.parentNode),div=div.nextSibling;"DIV"!=div.nodeName&&"PRE"!=div.nodeName;)if(!(div=div.nextSibling))return;text&&("[+]"==text.innerHTML?(div.savedDisplay?div.style.display=div.savedDisplay:div.style.display="",text.innerHTML="[-]"):(div.savedDisplay=div.style.display,div.style.display="none",text.innerHTML="[+]"))}}(),VPLUtil.options={scriptPath:""},void 0!==window.VPLDebugMode&&(debugMode=window.VPLDebugMode),VPLUtil.init=function(options){VPLUtil.options={scriptPath:""},$.extend(VPLUtil.options,options),void 0!==window.VPLDebugMode&&(debugMode=window.VPLDebugMode),VPLUtil.log(VPLUtil.options)},window.VPLUtil=VPLUtil,VPLUtil}));
/**
 * Evaluation monitoring
 *
 * @copyright 2013 onward Juan Carlos Rodrguez-del-Pino
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @author Juan Carlos Rodrguez-del-Pino <jcrodriguez@dis.ulpgc.es>
 */
define("mod_vpl/evaluationmonitor",["mod_vpl/vplutil"],(function(VPLUtil){return{init:function(options){function showErrorMessage(message){VPLUtil.showErrorMessage(message,{next:options.next})}var action;options.next=function(){window.location=options.nexturl};var executionActions={ajaxurl:options.ajaxurl,run:showErrorMessage,getLastAction:function(){action()}};(action=function(){VPLUtil.requestAction("evaluate","evaluating",{},options.ajaxurl).done((function(response){VPLUtil.webSocketMonitor(response,"evaluate","evaluating",executionActions).done(options.next).fail(showErrorMessage)})).fail(showErrorMessage)})()}}}));
/**
 * IDE Buttons
 *
 * @copyright 2016 Juan Carlos Rodrguez-del-Pino
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @author Juan Carlos Rodrguez-del-Pino <jcrodriguez@dis.ulpgc.es>
 */
define("mod_vpl/vplidebutton",["jquery","jqueryui","mod_vpl/vplutil"],(function($,jqui,VPLUtil){if(void 0!==VPLIDEButtons)return VPLIDEButtons;var VPLIDEButtons=function(menuElement,isOptionAllowed){var start,lastLap,interval,show,element,precision,checkt,timeLeft,updatePrecision,updateTimeLeft,self=this,buttons={};this.notAdded=function(buttonName){return!buttons[buttonName]},this.setText=function(buttonName,icon,title){self.notAdded(buttonName)||(icon||(icon=buttons[buttonName].icon),title||(title=buttons[buttonName].title),title||(title=VPLUtil.str(icon)),buttons[buttonName].icon=icon,buttons[buttonName].title=title,buttons[buttonName].hasOwnProperty("key")&&(title+=" ("+buttons[buttonName].key+")"),$("#vpl_ide_"+buttonName).attr("title",title),$("#vpl_ide_"+buttonName+" i").replaceWith(VPLUtil.genIcon(icon)))},this.setExtracontent=function(buttonName,html){if(!self.notAdded(buttonName)){var cl="bt_extrahtml",btag=$("#vpl_ide_"+buttonName+" i");0==btag.find("."+cl).length&&btag.append(' <span class="'+cl+'"><span>'),btag.find("."+cl).html(html)}},this.add=function(button){"string"==typeof button&&(button={name:button});if(isOptionAllowed(button.name)){if(button.hasOwnProperty("icon")||(button.icon=button.name),button.hasOwnProperty("title")||(button.title=VPLUtil.str(button.name)),button.hasOwnProperty("active")||(button.active=!0),button.hasOwnProperty("editorName")||(button.editorName=button.name),button.hasOwnProperty("originalAction")||(button.originalAction=VPLUtil.doNothing),!self.notAdded(button.name))throw new Error("Button already set "+button.name);if(buttons[button.name]=button,self.setAction(button.name,button.originalAction),button.hasOwnProperty("bindKey")){button.command={name:button.editorName,bindKey:button.bindKey,exec:button.action};var platform="win";navigator.platform.startsWith("Mac")&&(platform="mac"),button.key=button.bindKey[platform]}}},this.getHTML=function(buttonName){if(self.notAdded(buttonName))return"";var title=buttons[buttonName].title;buttons[buttonName].hasOwnProperty("key")&&(title+=" ("+buttons[buttonName].key+")");var html="<a id='vpl_ide_"+buttonName+"' href='#' title='"+title+"'>";return html+=VPLUtil.genIcon(buttons[buttonName].icon)+"</a>"},this.enable=function(buttonName,active){if(!self.notAdded(buttonName)){var bw=$("#vpl_ide_"+buttonName);buttons[buttonName].active=active,bw.data("vpl-active",active),active?bw.removeClass("ui-button-disabled ui-state-disabled"):bw.addClass("ui-button-disabled ui-state-disabled")}},this.setAction=function(buttonName,action){self.notAdded(buttonName)||(buttons[buttonName].originalAction=action,buttons[buttonName].action=function(){buttons[buttonName].active&&action()})},this.getAction=function(buttonName){return self.notAdded(buttonName)?VPLUtil.doNothing:buttons[buttonName].action},this.launchAction=function(buttonName){self.notAdded(buttonName)||buttons[buttonName].originalAction()},this.setGetkeys=function(editor){if(editor){var commands=editor.commands.commands,platform=editor.commands.platform;for(var buttonName in buttons)if(buttons.hasOwnProperty(buttonName)){var editorName=buttons[buttonName].editorName;commands[editorName]&&commands[editorName].bindKey&&!buttons[buttonName].Key?(buttons[buttonName].key=commands[editorName].bindKey[platform],self.setText(buttonName)):buttons[buttonName].bindKey&&!buttons[buttonName].hasOwnProperty("key")&&(buttons[buttonName].key=buttons[buttonName].bindKey[platform],self.setText(buttonName))}}},this.getShortcuts=function(editor){var html="<ul>";for(var buttonName in buttons)buttons[buttonName].hasOwnProperty("key")&&(html+="<li>",html+=buttons[buttonName].title+" ("+buttons[buttonName].key+")",html+="</li>");if(html+="</ul>",editor){html+="<h5>"+VPLUtil.str("edit")+"</h5>";var commands=editor.commands.commands,platform=editor.commands.platform;for(var editorName in html+="<ul>",commands)commands[editorName].hasOwnProperty("bindKey")&&commands[editorName].bindKey[platform]>""&&(html+="<li>",html+=editorName+" ("+commands[editorName].bindKey[platform]+")",html+="</li>");html+="</ul>"}return"<ul></ul>"==html?"":html},$(menuElement).on("click","a",(function(event){if($(this).data("vpl-active")){var actionid=$(this).attr("id");if("string"!=typeof actionid||!actionid.startsWith("vpl_ide_"))return!0;if(actionid=actionid.replace("vpl_ide_",""),self.notAdded(actionid))return!0;if(buttons[actionid]&&!buttons[actionid].active)return!0;var action=self.getAction(actionid);"import"!=actionid?setTimeout(action,10):action()}return event.stopImmediatePropagation(),!1})),$("body").on("keydown",(function(event){var check=!1,strkey="";if(event.shiftKey&&(strkey+="shift-"),event.altKey&&(strkey+="alt-",check=!0),event.ctrlKey&&(strkey+="ctrl-",check=!0),event.metaKey&&(strkey+="meta-",check=!0),event.which>=112&&event.which<=123)strkey+="f"+(event.which-111),check=!0;else{var char=String.fromCharCode(event.which).toLowerCase();char<"a"||char>"z"?check=!1:strkey+=char}if(check)for(var buttonName in buttons)if(buttons[buttonName].hasOwnProperty("key")&&strkey==buttons[buttonName].key.toLowerCase())return event.preventDefault(),event.stopImmediatePropagation(),buttons[buttonName].action(),!1;return!0})),this.multiple=function(v,m){return v-v%m},start=0,lastLap=0,interval=!1,show=!1,element=null,precision=5,checkt=1e3,timeLeft=0,updatePrecision=function(timeLeft){precision=5,checkt=1e3,timeLeft>3600?(precision=60,checkt=5e3):timeLeft>86400&&(precision=300,checkt=25e3)},updateTimeLeft=function(){var now=self.multiple(VPLUtil.getCurrentTime(),precision);if(now!==lastLap&&null!==element){var tl=timeLeft-((lastLap=now)-start),cssclass="";tl<=0?cssclass="vpl_buttonleft_black":tl<=300?(show=!0,cssclass="vpl_buttonleft_red"):tl<=900?cssclass="vpl_buttonleft_orange":updatePrecision(tl);var thtml='<span class="'+cssclass+'">'+VPLUtil.genIcon("timeleft");show&&(thtml+=" "+VPLUtil.getTimeLeft(tl)),thtml+="</span>",element.html(thtml),element.removeClass("vpl_buttonleft_orange vpl_buttonleft_red vpl_buttonleft_black"),element.addClass(cssclass)}},self.toggleTimeLeft=function(){show=!show,lastLap=0,updateTimeLeft()},self.setTimeLeft=function(options){if(element=$("#vpl_ide_timeleft"),!1!==interval&&(clearInterval(interval),interval=!1),options.hasOwnProperty("timeLeft")){timeLeft=options.timeLeft,updatePrecision(timeLeft);var sync=timeLeft%precision;timeLeft=self.multiple(timeLeft,precision),start=self.multiple(VPLUtil.getCurrentTime(),precision),lastLap=start-precision,setTimeout((function(){interval=setInterval(updateTimeLeft,checkt)}),1e3*sync),$("#vpl_ide_timeleft").show(),updateTimeLeft()}else $("#vpl_ide_timeleft").hide()}};return window.VPLIDEButtons=VPLIDEButtons,VPLIDEButtons}));
/**
 * Terminal control
 *
 * @copyright 2014 Juan Carlos Rodrguez-del-Pino
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @author Juan Carlos Rodrguez-del-Pino <jcrodriguez@dis.ulpgc.es>
 */
define("mod_vpl/vplterminal",["jquery","jqueryui","mod_vpl/vplutil","mod_vpl/vplclipboard"],(function($,jqui,VPLUtil,VPLClipboard){if(void 0!==VPLTerminal)return VPLTerminal;var VPLTerminal=function(dialogId,terminalId,str){var terminal,self=this,ws=null,onCloseAction=VPLUtil.doNothing,title="",message="",tdialog=$("#"+dialogId),tIde=$("#vplide"),titleText="",clipboard=null,clipboardData="",terminalTag=$("#"+terminalId);function receiveClipboard(data){if((clipboardData+=data).length>64e3){var from=clipboardData.length-32e3;clipboardData=clipboardData.substr(from)}}function updateClipboard(){clipboard.setEntry1(clipboardData)}function openClipboard(){updateClipboard(),clipboard.show()}this.updateTitle=function(){var text=title;""!==message&&(text+=" ("+message+")"),titleText.text(str("console")+": "+text)},this.setTitle=function(t){title=t,this.updateTitle()},this.setMessage=function(t){message=t,this.updateTitle()},this.write=function(text){return terminal.write(text),text},this.connect=function(server,onClose){onCloseAction=onClose,"WebSocket"in window?(terminal.reset(),terminal.startBlink(),self.show(),ws&&ws.close(),clipboardData="",self.setMessage(""),self.setTitle(str("connecting")),(ws=new WebSocket(server)).writeBuffer="",ws.writeIt=function(){terminal.write(ws.writeBuffer),receiveClipboard(ws.writeBuffer),ws.writeBuffer=""},ws.onmessage=function(event){ws.writeBuffer.length>0?ws.writeBuffer+=event.data:(ws.writeBuffer=event.data,setTimeout(ws.writeIt,35))},ws.onopen=function(){self.setMessage(""),self.setTitle(str("connected"))},ws.onclose=function(){self.setTitle(str("connection_closed")),terminal.blur(),terminal.stopBlink(),onClose(),ws.stopOutput=!0}):terminal.write("WebSocket not available: Upgrade your browser")},this.writeLocal=function(text){return ws.onmessage({data:text}),text},this.setDataCallback=function(call){ws.onData=call},this.closeLocal=function(){ws&&(ws.writeIt(),ws.close(),terminal.stopBlink(),self.setTitle(str("connection_closed")))},this.connectLocal=function(onClose,onData){onCloseAction=onClose,terminal.reset(),terminal.startBlink(),self.show(),ws&&ws.close(),clipboardData="",self.setMessage(""),self.setTitle(str("running")),(ws={}).onData=onData,ws.writeBuffer="",ws.readBuffer="",ws.readyState=1,ws.OPEN=1,ws.close=function(){ws=!1},ws.onmessage=function(event){ws.writeBuffer=event.data,ws.writeIt()},ws.writeIt=function(){ws&&(terminal.write(ws.writeBuffer),receiveClipboard(ws.writeBuffer),ws.writeBuffer="")},ws.send=function(text){""==text?ws.readBuffer.length>0&&(self.writeLocal("\b \b"),ws.readBuffer=ws.readBuffer.substr(0,ws.readBuffer.length-1)):(self.writeLocal(text),ws.readBuffer+=text);var pos=ws.readBuffer.indexOf("\r");if(-1!=pos){var data=ws.readBuffer.substr(0,pos);ws.readBuffer=ws.readBuffer.substr(pos+1),ws.onData(data)}}},this.isOpen=function(){return tdialog.dialog("isOpen")},this.close=function(){tdialog.dialog("close")},this.isConnected=function(){return ws&&ws.readyState!=ws.CLOSED},this.disconnect=function(){ws&&ws.readyState==ws.OPEN&&(onCloseAction(),ws&&ws.close(),terminal.stopBlink())};var HTMLUpdateClipboard=VPLUtil.genIcon("copy","sw")+" "+str("copy"),HTMLPaste=VPLUtil.genIcon("paste","sw")+" "+str("paste");function setTheme(theme){var cbase="vpl_terminal_theme";tdialog.data("terminal_theme",theme),VPLUtil.setUserPreferences({terminalTheme:theme});for(var i=0;i<5;i++)tdialog.removeClass(cbase+i);tdialog.addClass(cbase+theme)}function controlDialogSize(){var bw=tIde.width(),bh=tIde.height();tdialog.width()>bw&&tdialog.dialog("option","width",bw),tdialog.parent().height()>bh&&tdialog.dialog("option","height",bh-tdialog.prev().outerHeight())}clipboard=new VPLClipboard("vpl_dialog_terminal_clipboard",HTMLUpdateClipboard,(function(){updateClipboard(),document.execCommand("copy")}),HTMLPaste,(function(){ws&&ws.readyState==ws.OPEN&&ws.send(clipboard.getEntry2())})),this.closeDialog=function(){clipboard.hide(),self.disconnect()},tdialog.dialog({closeOnEscape:!1,autoOpen:!1,width:"auto",height:"auto",resizable:!0,dragStop:controlDialogSize,open:controlDialogSize,focus:function(){controlDialogSize(),terminal.focus()},dialogClass:"vpl_ide vpl_vnc",create:function(){titleText=VPLUtil.setTitleBar(tdialog,"console","console",["clipboard","keyboard","theme"],[openClipboard,function(){terminal.focus()},function(){setTheme((tdialog.data("terminal_theme")+1)%5)}])},close:function(){self.closeDialog()},resizeStop:function(){tdialog.width(tdialog.parent().width()),tdialog.height(tdialog.parent().height()-tdialog.prev().outerHeight()),controlDialogSize(),terminal.focus()}}),this.setFontSize=function(size){terminalTag.css("font-size",size+"px")},VPLUtil.getUserPreferences((function(data){setTheme(data.preferences.terminalTheme)})),tdialog.css("padding","1px"),tdialog.parent().css("z-index",2e3),this.show=function(){tdialog.dialog("open"),terminal.focus()},this.init=function(){"undefined"!=typeof Terminal?((terminal=new Terminal({cols:80,rows:24,useStyle:!0,screenKeys:!0})).on("data",(function(data){ws&&ws.readyState==ws.OPEN&&ws.send(data)})),terminal.open(terminalTag[0]),terminal.reset(),terminal.stopBlink(),terminal.setLineCallback((function(line,nlines){var height=terminalTag.height(),offset=tdialog.scrollTop(),viewHeight=tdialog.innerHeight();if(!(viewHeight>=height)){var lineHeight=height/nlines,pos=line*lineHeight;pos>=offset&&pos<viewHeight+offset-lineHeight||(pos<offset?tdialog.scrollTop(pos):tdialog.scrollTop(pos-viewHeight+2*lineHeight))}}))):VPLUtil.loadScript(["../../vpl/editor/xterm/term.js"],(function(){self.init()}))},this.init()};return window.VPLTerminal=VPLTerminal,VPLTerminal}));
/**
 * Terminal Clipboard
 *
 * @copyright 2014 Juan Carlos Rodrguez-del-Pino
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @author Juan Carlos Rodrguez-del-Pino <jcrodriguez@dis.ulpgc.es>
 */
define("mod_vpl/vplclipboard",["jquery","jqueryui","mod_vpl/vplutil"],(function($,jqui,VPLUtil){return function(dialogId,hlabel1,action1,hlabel2,action2,onFocus){var tdialog=$("#"+dialogId),label1=tdialog.find(".vpl_clipboard_label1"),label2=tdialog.find(".vpl_clipboard_label2"),entry1=tdialog.find(".vpl_clipboard_entry1"),entry2=tdialog.find(".vpl_clipboard_entry2");label1.html(hlabel1),label2.html(hlabel2),action1&&label1.button().click(action1),action2&&label2.button().click(action2),tdialog.dialog({title:VPLUtil.str("clipboard"),closeOnEscape:!0,autoOpen:!1,width:"auto",height:"auto",resizable:!0,dialogClass:"vpl_clipboard vpl_ide"}),onFocus&&tdialog.on("click",onFocus),this.show=function(){tdialog.dialog("open")},this.hide=function(){tdialog.dialog("close")},this.setEntry1=function(v){entry1.val(v),entry1.select()},this.getEntry1=function(){return entry1.val()},this.setEntry2=function(v){entry2.val(v)},this.getEntry2=function(){return entry2.val()};var titleTag=tdialog.siblings().find(".ui-dialog-title"),clipboardTitle=VPLUtil.genIcon("clipboard","sw");clipboardTitle+=" "+VPLUtil.str("clipboard"),titleTag.html(clipboardTitle),tdialog.parent().css("overflow","")}}));
/**
 * Additional javascript for the Workshop module form.
 *
 * @module      mod_workshop/modform
 * @copyright   The Open University 2018
 * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_workshop/modform",["jquery"],(function($){var submissionTypes={text:{available:null,required:null,requiredHidden:null},file:{available:null,required:null,requiredHidden:null}};function checkAvailability(checkUnavailable,checkAvailable){checkUnavailable.available.prop("checked")||(checkUnavailable.required.prop("disabled",!0),checkUnavailable.required.prop("checked",!1),checkAvailable.available.prop("checked")&&(checkAvailable.required.prop("disabled",!0),checkAvailable.required.prop("checked",!0),checkAvailable.requiredHidden.val(1)))}function enableRequired(submissionType){submissionType.required.prop("disabled",!1),submissionType.required.prop("checked",!1),submissionType.requiredHidden.val(0)}function submissionTypeChanged(){checkAvailability(submissionTypes.file,submissionTypes.text),checkAvailability(submissionTypes.text,submissionTypes.file),submissionTypes.text.available.prop("checked")&&submissionTypes.file.available.prop("checked")&&(enableRequired(submissionTypes.text),enableRequired(submissionTypes.file))}return{init:function(){submissionTypes.text.available=$("#id_submissiontypetextavailable"),submissionTypes.text.required=$("#id_submissiontypetextrequired"),submissionTypes.text.requiredHidden=$('input[name="submissiontypetextrequired"][type="hidden"]'),submissionTypes.file.available=$("#id_submissiontypefileavailable"),submissionTypes.file.required=$("#id_submissiontypefilerequired"),submissionTypes.file.requiredHidden=$('input[name="submissiontypefilerequired"][type="hidden"]'),submissionTypes.text.available.on("change",submissionTypeChanged),submissionTypes.file.available.on("change",submissionTypeChanged),submissionTypeChanged()}}}));
/**
 * Sets the equal height to the user plan widget boxes.
 *
 * @module      mod_workshop/workshopview
 * @category    output
 * @copyright   Loc Nguyen <loc.nguyendinh@harveynash.vn>
 * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_workshop/workshopview",["jquery"],(function($){function equalHeight(group){var tallest=0;group.height("auto"),group.each((function(){var thisHeight=$(this).height();thisHeight>tallest&&(tallest=thisHeight)})),group.height(tallest)}return{init:function(){var $dt=$(".path-mod-workshop .userplan dt"),$dd=$(".path-mod-workshop .userplan dd");equalHeight($dt),equalHeight($dd),$(window).on("resize",(function(){equalHeight($dt),equalHeight($dd)}))}}}));
define("mod_zoom/scheduleforchooser",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0;
/**
   * Schedule for selection handler.
   *
   * @module     mod_zoom/scheduleforchooser
   * @copyright  2022 Antonio Duran Terres <antonio@joomdle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
const Selectors_fields={selector:'[data-scheduleforchooser-field="selector"]',updateButton:'[data-scheduleforchooser-field="updateButton"]'};_exports.init=()=>{document.querySelector(Selectors_fields.selector).addEventListener("change",(e=>{const form=e.target.closest("form"),updateButton=form.querySelector(Selectors_fields.updateButton),fieldset=updateButton.closest("fieldset"),url=new URL(form.action);url.hash=fieldset.id,form.action=url.toString(),updateButton.click()}))}}));
/**
 * Populates or de-populates password field based on whether the
 * password is required or not.
 *
 * @copyright  2018 UC Regents
 * @author     Kubilay Agi
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_zoom/form",["jquery","core/form-autocomplete","core/str","core/notification"],(function($,autocomplete,str,notification){var SELECTORS_REPEAT_SELECT='select[name="recurrence_type"]',SELECTORS_REPEAT_INTERVAL=".repeat_interval",SELECTORS_REPEAT_INTERVAL_DAILY="#interval_daily",SELECTORS_REPEAT_INTERVAL_WEEKLY="#interval_weekly",SELECTORS_REPEAT_INTERVAL_MONTHLY="#interval_monthly",SELECTORS_REPEAT_INTERVAL_OPTIONS='select[name="repeat_interval"] option',SELECTORS_START_TIME='select[name*="start_time"]',SELECTORS_DURATION='*[name*="duration"]',SELECTORS_RECURRING='input[name="recurring"][type!="hidden"]',SELECTORS_OPTION_JBH='input[name="option_jbh"][type!="hidden"]',SELECTORS_OPTION_WAITING_ROOM='input[name="option_waiting_room"][type!="hidden"]',REPEAT_OPTIONS_REPEAT_OPTION_NONE=0,REPEAT_OPTIONS_REPEAT_OPTION_DAILY=1,REPEAT_OPTIONS_REPEAT_OPTION_WEEKLY=2,REPEAT_OPTIONS_REPEAT_OPTION_MONTHLY=3,REPEAT_MAX_OPTIONS_REPEAT_OPTION_WEEKLY=12,REPEAT_MAX_OPTIONS_REPEAT_OPTION_MONTHLY=3,toggleStartTimeDuration=function(){var disabled=!1,repeatVal=parseInt($(SELECTORS_REPEAT_SELECT).val(),10);$(SELECTORS_RECURRING).prop("checked")&&repeatVal===REPEAT_OPTIONS_REPEAT_OPTION_NONE&&(disabled=!0),$(SELECTORS_START_TIME).prop("disabled",disabled),$(SELECTORS_DURATION).prop("disabled",disabled)},toggleRepeatIntervalText=function(){$(SELECTORS_REPEAT_INTERVAL).hide();var repeatSelectVal=parseInt($(SELECTORS_REPEAT_SELECT).val(),10);repeatSelectVal===REPEAT_OPTIONS_REPEAT_OPTION_DAILY?$(SELECTORS_REPEAT_INTERVAL_DAILY).show():repeatSelectVal===REPEAT_OPTIONS_REPEAT_OPTION_WEEKLY?$(SELECTORS_REPEAT_INTERVAL_WEEKLY).show():repeatSelectVal===REPEAT_OPTIONS_REPEAT_OPTION_MONTHLY&&$(SELECTORS_REPEAT_INTERVAL_MONTHLY).show()},limitRepeatValues=function(){var selectedValue=parseInt($(SELECTORS_REPEAT_SELECT).val(),10);$(SELECTORS_REPEAT_INTERVAL_OPTIONS).each((function(){selectedValue===REPEAT_OPTIONS_REPEAT_OPTION_WEEKLY?this.value>REPEAT_MAX_OPTIONS_REPEAT_OPTION_WEEKLY&&$(this).hide():selectedValue===REPEAT_OPTIONS_REPEAT_OPTION_MONTHLY?this.value>REPEAT_MAX_OPTIONS_REPEAT_OPTION_MONTHLY&&$(this).hide():$(this).show()}))},TabsComponent=function(tabsColumn,tabsContentColumn,initialTabsCount,emptyAlert){this.tabsColumn=tabsColumn,this.tabsContentColumn=tabsContentColumn,this.emptyAlert=emptyAlert,this.countTabs=initialTabsCount,this.buildTab=function(item){var tab=item.tab.element,tabLink=$(".nav-link",tab);return tab.attr("id","tab-"+this.countTabs),$(".tab-name",tabLink).text(item.tab.name),tabLink.attr("href","#link"+this.countTabs),$("li a",this.tabsColumn).removeClass("active"),tabLink.addClass("active"),tab},this.buildTabContent=function(item){var tabContent=item.tabContent.element;return tabContent.attr("id","link"+this.countTabs),$(".tab-pane",this.tabsContentColumn).removeClass("active"),tabContent.addClass("active"),tabContent},this.addTab=function(item){var tab=this.buildTab(item),tabContent=this.buildTabContent(item);return this.emptyAlert.addClass("hidden"),$("ul",this.tabsColumn).append(tab),$(".tab-content",this.tabsContentColumn).append(tabContent),{element:tab,content:tabContent}},this.deleteTab=function(item){var tab=item,tabContent=$($("a",tab).attr("href"));(tab.remove(),tabContent.remove(),$("li",this.tabsColumn).length)?$("li a.active",this.tabsColumn).length||$("li:first-child a",this.tabsColumn).trigger("click"):this.emptyAlert.removeClass("hidden")}},BreakoutroomsEditor=function(){this.roomsListColumn=$("#meeting-rooms-list"),this.roomsList=$("ul",this.roomsListColumn),this.addBtn=$("#add-room",this.roomsListColumn),this.emptyAlert=$(".empty-alert",this.roomsListColumn),this.deleteBtn=$(".delete-room",this.roomsListColumn),this.roomsDataColumn=$("#meeting-rooms-data"),this.roomItemToClone=$("#rooms-list-item").html(),this.roomItemDataToClone=$("#rooms-list-item-data").html(),this.initialRoomsCount=parseInt(this.roomsListColumn.attr("data-initial-rooms-count")),this.tabsComponent=new TabsComponent(this.roomsListColumn,this.roomsDataColumn,this.initialRoomsCount,this.emptyAlert),this.init=function(){str.get_strings([{key:"room",component:"zoom"}]).then().fail(notification.exception),this.addRoomEvent(),this.deleteRoomEvent(),$("li",this.roomsListColumn).length?(this.changeRoomNameEvent(),this.buildAutocompleteComponents()):this.emptyAlert.removeClass("hidden")},this.addRoomEvent=function(){var thisObject=this;thisObject.addBtn.click((function(){thisObject.tabsComponent.countTabs++;var newRoomName=M.util.get_string("room","zoom")+" "+thisObject.tabsComponent.countTabs,newRoomElement=$(thisObject.roomItemToClone),newRoomDataElement=$(thisObject.roomItemDataToClone),newRoomIndex=thisObject.tabsComponent.countTabs,roomNameInputId="room-name-"+newRoomIndex;$("input[type=text]",newRoomDataElement).prev().attr("for",roomNameInputId),$("input[type=text]",newRoomDataElement).attr("id",roomNameInputId),$("input[type=text]",newRoomDataElement).attr("name",roomNameInputId),$("input[type=text]",newRoomDataElement).val(newRoomName),$("input[type=text]",newRoomDataElement).next().attr("name","rooms["+newRoomIndex+"]"),$("input[type=text]",newRoomDataElement).next().val(newRoomName);var roomParticipantsSelectId="participants-"+newRoomIndex;$(".room-participants",newRoomDataElement).attr("id",roomParticipantsSelectId),$(".room-participants",newRoomDataElement).attr("name","roomsparticipants["+newRoomIndex+"][]");var roomGroupsSelectId="groups-"+newRoomIndex;$(".room-groups",newRoomDataElement).attr("id",roomGroupsSelectId),$(".room-groups",newRoomDataElement).attr("name","roomsgroups["+newRoomIndex+"][]");var newRoom={tab:{name:newRoomName,element:newRoomElement},tabContent:{element:newRoomDataElement}},addedTab=thisObject.tabsComponent.addTab(newRoom);$("li:last .delete-room",thisObject.roomsList).click((function(){var thisItem=$(this).closest("li");thisObject.tabsComponent.deleteTab(thisItem)})),$("input[type=text]",addedTab.content).on("change keyup paste",(function(){var newHiddenValue=this.value;$(this).next().val(newHiddenValue),$(".tab-name",addedTab.element).text(this.value)})),thisObject.buildAutocompleteComponent(roomParticipantsSelectId,"addparticipant"),thisObject.buildAutocompleteComponent(roomGroupsSelectId,"addparticipantgroup")}))},this.deleteRoomEvent=function(){var thisObject=this;thisObject.deleteBtn.click((function(){var thisItem=$(this).closest("li");thisObject.tabsComponent.deleteTab(thisItem)}))},this.changeRoomNameEvent=function(){var thisObject=this;$("li",this.roomsListColumn).each((function(){var tabIndex=$(this).attr("id").split("-")[1];$('input[name="room-name-'+tabIndex+'"]',thisObject.roomsDataColumn).on("change keyup paste",(function(){var newHiddenValue=this.value;$(this).next().val(newHiddenValue),$("#tab-"+tabIndex+" .tab-name").text(this.value)}))}))},this.buildAutocompleteComponents=function(){var thisObject=this;$(".room-participants",thisObject.roomsDataColumn).each((function(){var thisItemId=$(this).attr("id");thisObject.buildAutocompleteComponent(thisItemId,"addparticipant")})),$(".room-groups",thisObject.roomsDataColumn).each((function(){var thisItemId=$(this).attr("id");thisObject.buildAutocompleteComponent(thisItemId,"addparticipantgroup")}))},this.buildAutocompleteComponent=function(id,placeholder){var stringkeys=[{key:placeholder,component:"zoom"},{key:"selectionarea",component:"zoom"}];str.get_strings(stringkeys).then((function(langstrings){var placeholderString=langstrings[0],noSelectionString=langstrings[1];return autocomplete.enhance("#"+id,!1,"",placeholderString,!1,!0,noSelectionString,!0),null})).fail(notification.exception)}};return{init:function(){var optionJoinBeforeHost=$(SELECTORS_OPTION_JBH),optionWaitingRoom=$(SELECTORS_OPTION_WAITING_ROOM);optionJoinBeforeHost.change((function(){!0===optionJoinBeforeHost.is(":checked")&&optionWaitingRoom.prop("checked",!1)})),optionWaitingRoom.change((function(){!0===optionWaitingRoom.is(":checked")&&optionJoinBeforeHost.prop("checked",!1)})),toggleStartTimeDuration(),toggleRepeatIntervalText(),limitRepeatValues(),$(SELECTORS_REPEAT_SELECT).change((function(){toggleStartTimeDuration(),toggleRepeatIntervalText(),limitRepeatValues()})),$(SELECTORS_RECURRING).change((function(){toggleStartTimeDuration()})),(new BreakoutroomsEditor).init()}}}));
define("mod_zoom/toggle_text",["exports","core/str"],(function(_exports,_str){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0;_exports.init=()=>{const button=document.querySelector("#show-more-button");if(null!==button){const body=document.querySelector("#show-more-body");button.addEventListener("click",(async()=>{""===body.style.display?(body.style.display="none",button.innerHTML=await(0,_str.get_string)("meeting_invite_show","mod_zoom")):(body.style.display="",button.innerHTML=await(0,_str.get_string)("meeting_invite_hide","mod_zoom"))}))}}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("enrol_manual/quickenrolment",["exports","core_table/dynamic","core/str","core/toast","core/config","core/fragment","core/modal_events","core/modal_factory","core/notification","jquery","core/pending","core/prefetch"],(function(_exports,DynamicTable,Str,Toast,_config,_fragment,_modal_events,_modal_factory,_notification,_jquery,_pending,_prefetch){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,DynamicTable=_interopRequireWildcard(DynamicTable),Str=_interopRequireWildcard(Str),Toast=_interopRequireWildcard(Toast),_config=_interopRequireDefault(_config),_fragment=_interopRequireDefault(_fragment),_modal_events=_interopRequireDefault(_modal_events),_modal_factory=_interopRequireDefault(_modal_factory),_notification=_interopRequireDefault(_notification),_jquery=_interopRequireDefault(_jquery),_pending=_interopRequireDefault(_pending),_prefetch=_interopRequireDefault(_prefetch);var Selectors_cohortSelector="#id_cohortlist",Selectors_triggerButtons=".enrolusersbutton.enrol_manual_plugin [type='submit']",Selectors_unwantedHiddenFields="input[value='_qf__force_multiselect_submission']",Selectors_buttonWrapper='[data-region="wrapper"]',getBodyForContext=function(contextId){return _fragment.default.loadFragment("enrol_manual","enrol_users_form",contextId,{})},registerEventListeners=function(contextId){document.addEventListener("click",(function(e){if(e.target.closest(Selectors_triggerButtons))return e.preventDefault(),void showModal((element=e.target,wrapper=element.closest(Selectors_buttonWrapper),DynamicTable.getTableFromId(wrapper.dataset.tableUniqueid)),contextId);var element,wrapper}))},showModal=function(dynamicTable,contextId){var pendingPromise=new _pending.default("enrol_manual/quickenrolment:showModal");return _modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,large:!0,title:Str.get_string("enrolusers","enrol_manual"),body:getBodyForContext(contextId),buttons:{save:Str.get_string("enrolusers","enrol_manual")}}).then((function(modal){return modal.getRoot().on(_modal_events.default.save,(function(e){e.preventDefault(),modal.getRoot().find("form").submit()})),modal.getRoot().on("submit","form",(function(e){e.preventDefault(),submitFormAjax(dynamicTable,modal)})),modal.getRoot().on(_modal_events.default.hidden,(function(){modal.destroy()})),modal.show(),modal})).then((function(modal){return Promise.all([modal,modal.getBodyPromise()])})).then((function(_ref){var _ref2=_slicedToArray(_ref,2),modal=_ref2[0];return _ref2[1].get(0).querySelector(Selectors_cohortSelector)?modal.setSaveButtonText(Str.get_string("enroluserscohorts","enrol_manual")).then((function(){return modal})):modal})).then((function(modal){return pendingPromise.resolve(),modal})).catch(_notification.default.exception)},submitFormAjax=function(dynamicTable,modal){var form=modal.getRoot().find("form");form.get(0).querySelectorAll(Selectors_unwantedHiddenFields).forEach((function(hiddenField){return hiddenField.remove()})),modal.hide(),modal.destroy(),_jquery.default.ajax("".concat(_config.default.wwwroot,"/enrol/manual/ajax.php?").concat(form.serialize()),{type:"GET",processData:!1,contentType:"application/json"}).then((function(response){if(response.error)throw new Error(response.error);return response.count})).then((function(count){return Promise.all([Str.get_string("totalenrolledusers","enrol",count),DynamicTable.refreshTableContent(dynamicTable)])})).then((function(_ref3){return _slicedToArray(_ref3,1)[0]})).then((function(notificationBody){return Toast.add(notificationBody)})).catch((function(error){_notification.default.addNotification({message:error.message,type:"error"})}))};_exports.init=function(_ref5){var contextid=_ref5.contextid;registerEventListeners(contextid),_prefetch.default.prefetchStrings("enrol_manual",["enrolusers","enroluserscohorts"]),_prefetch.default.prefetchString("enrol","totalenrolledusers")}}));
/**
 * Potential user selector module.
 *
 * @module     enrol_manual/form-potential-user-selector
 * @class      form-potential-user-selector
 * @package    enrol_manual
 * @copyright  2016 Damyon Wiese
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("enrol_manual/form-potential-user-selector",["jquery","core/ajax","core/templates","core/str"],(function($,Ajax,Templates,Str){return{processResults:function(selector,results){var users=[];return $.isArray(results)?($.each(results,(function(index,user){users.push({value:user.id,label:user._label})})),users):results},transport:function(selector,query,success,failure){var courseid=$(selector).attr("courseid"),userfields=$(selector).attr("userfields").split(",");void 0===courseid&&(courseid="1");var enrolid=$(selector).attr("enrolid");void 0===enrolid&&(enrolid="");var perpage=parseInt($(selector).attr("perpage"));isNaN(perpage)&&(perpage=100),Ajax.call([{methodname:"core_enrol_get_potential_users",args:{courseid:courseid,enrolid:enrolid,search:query,searchanywhere:!0,page:0,perpage:perpage+1}}])[0].then((function(results){var promises=[],i=0;return results.length<=perpage?($.each(results,(function(index,user){var ctx=user,identity=[];$.each(userfields,(function(i,k){void 0!==user[k]&&""!==user[k]&&(ctx.hasidentity=!0,identity.push(user[k]))})),ctx.identity=identity.join(", "),promises.push(Templates.render("enrol_manual/form-user-selector-suggestion",ctx))})),$.when.apply($.when,promises).then((function(){var args=arguments;$.each(results,(function(index,user){user._label=args[i],i++})),success(results)}))):Str.get_string("toomanyuserstoshow","core",">"+perpage).then((function(toomanyuserstoshow){success(toomanyuserstoshow)}))})).fail(failure)}}}));
/**
 * Controls the notification popover in the nav bar.
 *
 * See template: message_popup/notification_popover
 *
 * @module     message_popup/notification_popover_controller
 * @class      notification_popover_controller
 * @package    message_popup
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("message_popup/notification_popover_controller",["jquery","core/ajax","core/templates","core/str","core/url","core/notification","core/custom_interaction_events","core/popover_region_controller","message_popup/notification_repository","message_popup/notification_area_events"],(function($,Ajax,Templates,Str,URL,DebugNotification,CustomEvents,PopoverController,NotificationRepo,NotificationAreaEvents){var SELECTORS_MARK_ALL_READ_BUTTON='[data-action="mark-all-read"]',SELECTORS_ALL_NOTIFICATIONS_CONTAINER='[data-region="all-notifications"]',SELECTORS_NOTIFICATION='[data-region="notification-content-item-container"]',SELECTORS_UNREAD_NOTIFICATION='[data-region="notification-content-item-container"].unread',SELECTORS_NOTIFICATION_LINK='[data-action="content-item-link"]',SELECTORS_COUNT_CONTAINER='[data-region="count-container"]',NotificationPopoverController=function(element){PopoverController.call(this,element),this.markAllReadButton=this.root.find(SELECTORS_MARK_ALL_READ_BUTTON),this.unreadCount=0,this.lastQueried=0,this.userId=this.root.attr("data-userid"),this.container=this.root.find(SELECTORS_ALL_NOTIFICATIONS_CONTAINER),this.limit=20,this.offset=0,this.loadedAll=!1,this.initialLoad=!1,this.unreadCount=this.root.find(SELECTORS_COUNT_CONTAINER).html()};return(NotificationPopoverController.prototype=Object.create(PopoverController.prototype)).constructor=NotificationPopoverController,NotificationPopoverController.prototype.updateButtonAriaLabel=function(){this.isMenuOpen()?Str.get_string("hidenotificationwindow","message").done(function(string){this.menuToggle.attr("aria-label",string)}.bind(this)):this.unreadCount?Str.get_string("shownotificationwindowwithcount","message",this.unreadCount).done(function(string){this.menuToggle.attr("aria-label",string)}.bind(this)):Str.get_string("shownotificationwindownonew","message").done(function(string){this.menuToggle.attr("aria-label",string)}.bind(this))},NotificationPopoverController.prototype.getContent=function(){return this.container},NotificationPopoverController.prototype.getOffset=function(){return this.offset},NotificationPopoverController.prototype.incrementOffset=function(){this.offset+=this.limit},NotificationPopoverController.prototype.hasDoneInitialLoad=function(){return this.initialLoad},NotificationPopoverController.prototype.hasLoadedAllContent=function(){return this.loadedAll},NotificationPopoverController.prototype.setLoadedAllContent=function(val){this.loadedAll=val},NotificationPopoverController.prototype.renderUnreadCount=function(){var element=this.root.find(SELECTORS_COUNT_CONTAINER);this.unreadCount?(element.text(this.unreadCount),element.removeClass("hidden")):element.addClass("hidden")},NotificationPopoverController.prototype.hideUnreadCount=function(){this.root.find(SELECTORS_COUNT_CONTAINER).addClass("hidden")},NotificationPopoverController.prototype.getNotificationElement=function(id){var element=this.root.find(SELECTORS_NOTIFICATION+'[data-id="'+id+'"]');return 1==element.length?element:null},NotificationPopoverController.prototype.renderNotifications=function(notifications,container){var promises=[];return $.each(notifications,function(index,notification){var offset=this.getOffset()-this.limit;notification.viewmoreurl=URL.relativeUrl("/message/output/popup/notifications.php",{notificationid:notification.id,offset:offset});var notificationurlparams={notificationid:notification.id};notification.contexturl=URL.relativeUrl("message/output/popup/mark_notification_read.php",notificationurlparams);var promise=Templates.render("message_popup/notification_content_item",notification).then((function(html,js){return{html:html,js:js}}));promises.push(promise)}.bind(this)),$.when.apply($,promises).then((function(){$.each(arguments,(function(index,argument){container.append(argument.html),Templates.runTemplateJS(argument.js)}))}))},NotificationPopoverController.prototype.loadMoreNotifications=function(){if(this.isLoading||this.hasLoadedAllContent())return $.Deferred().resolve();this.startLoading();var request={limit:this.limit,offset:this.getOffset(),useridto:this.userId},container=this.getContent();return NotificationRepo.query(request).then(function(result){var notifications=result.notifications;return this.unreadCount=result.unreadcount,this.lastQueried=Math.floor((new Date).getTime()/1e3),this.setLoadedAllContent(!notifications.length||notifications.length<this.limit),this.initialLoad=!0,this.updateButtonAriaLabel(),!!notifications.length&&(this.incrementOffset(),this.renderNotifications(notifications,container))}.bind(this)).always(function(){this.stopLoading()}.bind(this))},NotificationPopoverController.prototype.markAllAsRead=function(){this.markAllReadButton.addClass("loading");var request={useridto:this.userId,timecreatedto:this.lastQueried};return NotificationRepo.markAllAsRead(request).then(function(){this.unreadCount=0,this.root.find(SELECTORS_UNREAD_NOTIFICATION).removeClass("unread")}.bind(this)).always(function(){this.markAllReadButton.removeClass("loading")}.bind(this))},NotificationPopoverController.prototype.registerEventListeners=function(){CustomEvents.define(this.root,[CustomEvents.events.activate]),this.root.on(CustomEvents.events.activate,SELECTORS_MARK_ALL_READ_BUTTON,function(e,data){this.markAllAsRead(),e.stopPropagation(),data.originalEvent.preventDefault()}.bind(this)),this.root.on(CustomEvents.events.activate,SELECTORS_NOTIFICATION_LINK,function(e){var element=$(e.target).closest(SELECTORS_NOTIFICATION);element.hasClass("unread")&&(this.unreadCount--,element.removeClass("unread")),e.stopPropagation()}.bind(this)),this.root.on(this.events().menuOpened,function(){this.hideUnreadCount(),this.updateButtonAriaLabel(),this.hasDoneInitialLoad()||this.loadMoreNotifications()}.bind(this)),this.root.on(this.events().menuClosed,function(){this.renderUnreadCount(),this.updateButtonAriaLabel()}.bind(this)),this.root.on(this.events().startLoading,function(){this.getContent().attr("aria-busy","true")}.bind(this)),this.root.on(this.events().stopLoading,function(){this.getContent().attr("aria-busy","false")}.bind(this)),this.getContentContainer().on(CustomEvents.events.scrollBottom,function(){this.isLoading||this.hasLoadedAllContent()||this.loadMoreNotifications()}.bind(this)),CustomEvents.define(this.getContentContainer(),[CustomEvents.events.scrollLock]),$(document).on(NotificationAreaEvents.notificationShown,function(e,notification){if(!notification.read){var element=this.getNotificationElement(notification.id);element&&element.removeClass("unread"),this.unreadCount--,this.renderUnreadCount()}}.bind(this))},NotificationPopoverController}));
/**
 * Retrieves notifications from the server.
 *
 * @module     message_popup/notification_repository
 * @class      notification_repository
 * @package    message_popup
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("message_popup/notification_repository",["core/ajax","core/notification"],(function(Ajax,Notification){return{query:function(args){void 0===args.limit&&(args.limit=20),void 0===args.offset&&(args.offset=0);var request={methodname:"message_popup_get_popup_notifications",args:args},promise=Ajax.call([request])[0];return promise.fail(Notification.exception),promise},countUnread:function(args){var request={methodname:"message_popup_get_unread_popup_notification_count",args:args},promise=Ajax.call([request])[0];return promise.fail(Notification.exception),promise},markAllAsRead:function(args){var request={methodname:"core_message_mark_all_notifications_as_read",args:args},promise=Ajax.call([request])[0];return promise.fail(Notification.exception),promise},markAsRead:function(id,timeread){var args={notificationid:id};timeread&&(args.timeread=timeread);var request={methodname:"core_message_mark_notification_read",args:args},promise=Ajax.call([request])[0];return promise.fail(Notification.exception),promise}}}));
/**
 * Controls the content area of the notification area on the
 * notification page.
 *
 * @module     message_popup/notification_area_content_area
 * @class      notification_area_content_area
 * @package    message
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("message_popup/notification_area_content_area",["jquery","core/templates","core/notification","core/custom_interaction_events","message_popup/notification_repository","message_popup/notification_area_events"],(function($,Templates,DebugNotification,CustomEvents,NotificationRepo,NotificationAreaEvents){var SELECTORS={CONTAINER:'[data-region="notification-area"]',CONTENT:'[data-region="content"]',HEADER:'[data-region="header"]',FOOTER:'[data-region="footer"]',TOGGLE_MODE:'[data-action="toggle-mode"]'},TEMPLATES_HEADER="message_popup/notification_area_content_area_header",TEMPLATES_CONTENT="message_popup/notification_area_content_area_content",TEMPLATES_FOOTER="message_popup/notification_area_content_area_footer",ContentArea=function(root,userId){this.root=$(root),this.container=this.root.closest(SELECTORS.CONTAINER),this.userId=userId,this.header=this.root.find(SELECTORS.HEADER),this.content=this.root.find(SELECTORS.CONTENT),this.footer=this.root.find(SELECTORS.FOOTER),this.registerEventListeners()};return ContentArea.prototype.getRoot=function(){return this.root},ContentArea.prototype.getContainer=function(){return this.container},ContentArea.prototype.getUserId=function(){return this.userId},ContentArea.prototype.getHeader=function(){return this.header},ContentArea.prototype.getContent=function(){return this.content},ContentArea.prototype.getFooter=function(){return this.footer},ContentArea.prototype.show=function(){this.getContainer().addClass("show-content-area")},ContentArea.prototype.hide=function(){this.getContainer().removeClass("show-content-area")},ContentArea.prototype.setHeaderHTML=function(html){this.getHeader().empty().html(html)},ContentArea.prototype.setContentHTML=function(html){this.getContent().empty().html(html)},ContentArea.prototype.setFooterHTML=function(html){this.getFooter().empty().html(html)},ContentArea.prototype.showNotification=function(notification){var headerPromise=Templates.render(TEMPLATES_HEADER,notification).done(function(html){this.setHeaderHTML(html)}.bind(this)),contentPromise=Templates.render(TEMPLATES_CONTENT,notification).done(function(html){this.setContentHTML(html)}.bind(this)),footerPromise=Templates.render(TEMPLATES_FOOTER,notification).done(function(html){this.setFooterHTML(html)}.bind(this));return $.when(headerPromise,contentPromise,footerPromise).done(function(){this.show(),this.getContainer().trigger(NotificationAreaEvents.notificationShown,[notification])}.bind(this))},ContentArea.prototype.registerEventListeners=function(){CustomEvents.define(this.getRoot(),[CustomEvents.events.activate]),this.getRoot().on(CustomEvents.events.activate,SELECTORS.VIEW_TOGGLE,function(){this.hide()}.bind(this)),this.getContainer().on(NotificationAreaEvents.showNotification,function(e,notification){this.showNotification(notification)}.bind(this))},ContentArea}));
/**
 * Contain the events that can be fired in the notification area on
 * the notifications page.
 *
 * @module     message_popup/notification_area_events
 * @class      notification_area_events
 * @package    core
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("message_popup/notification_area_events",[],(function(){return{showNotification:"notification-area-events:showNotification",notificationShown:"notification-area-events:notificationShown"}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)
/**
 * Controls the notification area on the notification page.
 *
 * @module     message_popup/notification_area_control_area
 * @class      notification_area_control_area
 * @package    message
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */}define("message_popup/notification_area_control_area",["jquery","core/templates","core/notification","core/custom_interaction_events","message_popup/notification_repository","message_popup/notification_area_events"],(function($,Templates,DebugNotification,CustomEvents,NotificationRepo,NotificationAreaEvents){var SELECTORS_CONTAINER='[data-region="notification-area"]',SELECTORS_CONTENT='[data-region="content"]',SELECTORS_NOTIFICATION='[data-region="notification-content-item-container"]',SELECTORS_CAN_RECEIVE_FOCUS='input:not([type="hidden"]), a[href], button, textarea, select, [tabindex]',TEMPLATES_NOTIFICATION="message_popup/notification_content_item",ControlArea=function(root,userId){this.root=$(root),this.container=this.root.closest(SELECTORS_CONTAINER),this.userId=userId,this.content=this.root.find(SELECTORS_CONTENT),this.offset=0,this.limit=20,this.initialLoad=!1,this.isLoading=!1,this.loadedAll=!1,this.notifications={},this.registerEventListeners()};return ControlArea.prototype.getRoot=function(){return this.root},ControlArea.prototype.getContainer=function(){return this.container},ControlArea.prototype.getUserId=function(){return this.userId},ControlArea.prototype.getContent=function(){return this.content},ControlArea.prototype.getOffset=function(){return this.offset},ControlArea.prototype.getLimit=function(){return this.limit},ControlArea.prototype.setOffset=function(value){this.offset=value},ControlArea.prototype.setLimit=function(value){this.limit=value},ControlArea.prototype.incrementOffset=function(){this.offset+=this.limit},ControlArea.prototype.startLoading=function(){this.isLoading=!0,this.getRoot().addClass("loading")},ControlArea.prototype.stopLoading=function(){this.isLoading=!1,this.getRoot().removeClass("loading")},ControlArea.prototype.hasDoneInitialLoad=function(){return this.initialLoad},ControlArea.prototype.hasLoadedAllContent=function(){return this.loadedAll},ControlArea.prototype.setLoadedAllContent=function(val){this.loadedAll=val},ControlArea.prototype.setCacheNotification=function(notification){this.notifications[notification.id]=notification},ControlArea.prototype.getCacheNotification=function(id){return this.notifications[id]},ControlArea.prototype.getNotificationElement=function(id){var element=this.getRoot().find(SELECTORS_NOTIFICATION+'[data-id="'+id+'"]');return 1==element.length?element:null},ControlArea.prototype.scrollNotificationIntoView=function(notificationElement){var position=notificationElement.position(),container=this.getRoot();if(position.top-container.scrollTop()>container.innerHeight()){var height=notificationElement.outerHeight();height*=4;var scrollTo=position.top-height;container.scrollTop(scrollTo)}},ControlArea.prototype.showNotification=function(notificationElement){if("object"!==_typeof(notificationElement)&&(notificationElement=this.getNotificationElement(notificationElement)),notificationElement&&notificationElement.length){this.getRoot().find(SELECTORS_NOTIFICATION).removeClass("selected"),notificationElement.addClass("selected").find(SELECTORS_CAN_RECEIVE_FOCUS).focus();var notificationId=notificationElement.attr("data-id"),notification=this.getCacheNotification(notificationId);this.scrollNotificationIntoView(notificationElement),this.getContainer().trigger(NotificationAreaEvents.showNotification,[$.extend({},notification)])}},ControlArea.prototype.markNotificationAsRead=function(notificationElement){return NotificationRepo.markAsRead(notificationElement.attr("data-id")).done((function(){notificationElement.removeClass("unread")}))},ControlArea.prototype.renderNotifications=function(notifications){var promises=[],container=this.getContent();return $.each(notifications,function(index,notification){var contextUrl=notification.contexturl;delete notification.contexturl;var promise=Templates.render(TEMPLATES_NOTIFICATION,notification).then(function(html,js){return notification.contexturl=contextUrl,this.setCacheNotification(notification),{html:html,js:js}}.bind(this));promises.push(promise)}.bind(this)),$.when.apply($,promises).then((function(){$.each(arguments,(function(index,argument){container.append(argument.html),Templates.runTemplateJS(argument.js)}))}))},ControlArea.prototype.loadMoreNotifications=function(){if(this.isLoading||this.hasLoadedAllContent())return $.Deferred().resolve();this.startLoading();var request={limit:this.getLimit(),offset:this.getOffset(),useridto:this.getUserId()};return this.initialLoad||(request.limit=this.getOffset()+this.getLimit(),request.offset=0),NotificationRepo.query(request).then(function(result){var notifications=result.notifications;return this.unreadCount=result.unreadcount,this.setLoadedAllContent(!notifications.length||notifications.length<this.getLimit()),this.initialLoad=!0,!!notifications.length&&(this.incrementOffset(),this.renderNotifications(notifications))}.bind(this)).always(function(){this.stopLoading()}.bind(this))},ControlArea.prototype.registerEventListeners=function(){CustomEvents.define(this.getRoot(),[CustomEvents.events.activate,CustomEvents.events.scrollBottom,CustomEvents.events.scrollLock,CustomEvents.events.up,CustomEvents.events.down]),this.getRoot().on(CustomEvents.events.scrollBottom,function(){this.loadMoreNotifications()}.bind(this)),this.getRoot().on(CustomEvents.events.activate,SELECTORS_NOTIFICATION,function(e){var notificationElement=$(e.target).closest(SELECTORS_NOTIFICATION);this.showNotification(notificationElement)}.bind(this)),this.getRoot().on(CustomEvents.events.up,SELECTORS_NOTIFICATION,function(e,data){var notificationElement=$(e.target).closest(SELECTORS_NOTIFICATION);this.showNotification(notificationElement.prev()),data.originalEvent.preventDefault()}.bind(this)),this.getRoot().on(CustomEvents.events.down,SELECTORS_NOTIFICATION,function(e,data){var notificationElement=$(e.target).closest(SELECTORS_NOTIFICATION);this.showNotification(notificationElement.next()),data.originalEvent.preventDefault()}.bind(this)),this.getContainer().on(NotificationAreaEvents.notificationShown,function(e,notification){if(!notification.read){var element=this.getNotificationElement(notification.id);element&&this.markNotificationAsRead(element);var cachedNotification=this.getCacheNotification(notification.id);cachedNotification&&(cachedNotification.read=!0)}}.bind(this))},ControlArea}));
/**
 * Completion Progress overview page behaviour.
 *
 * @module     block_completion_progress/overview
 * @copyright  2020 Jonathon Fowler <fowlerj@usq.edu.au>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_completion_progress/overview",["core_user/participants"],(function(Participants){return{init:function(options){var form=document.getElementById("participantsform"),action=document.getElementById("formactionid");function checkaction(){action.disabled=null===form.querySelector("input.usercheckbox:checked")}Participants.init(options),checkaction(),form.addEventListener("change",checkaction)}}}));
/**
 * Completion Progress block progress bar behaviour.
 *
 * @module     block_completion_progress/progressbar
 * @copyright  2020 Jonathon Fowler <fowlerj@usq.edu.au>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_completion_progress/progressbar",["jquery","core/pubsub","core/utils"],(function($,PubSub,Utils){function showInfo(event){var cell=$(this),container=cell.closest(".block_completion_progress .barContainer"),visibleinfo=container.siblings(".progressEventInfo:visible"),infotoshow=container.siblings("#"+cell.data("infoRef"));visibleinfo.is(infotoshow)||(visibleinfo.hide(),infotoshow.show()),event.preventDefault()}function showAllInfo(event){var initialinfo=$(this).closest(".progressEventInfo");initialinfo.siblings(".progressEventInfo").show(),initialinfo.hide(),event.preventDefault()}function viewActivity(){var cell=$(this),infolink=cell.closest(".block_completion_progress .barContainer").siblings("#"+cell.data("infoRef")).find("a.action_link");document.location=infolink.prop("href")}function scrollContainer(event){var barrow=$(this).closest(".block_completion_progress .barContainer").find(".barRow"),amount=event.data*barrow.prop("scrollWidth")*.15;barrow.prop("scrollLeft",barrow.prop("scrollLeft")+amount),event.preventDefault()}function checkArrows(){var barrow=$(this),barcontainer=barrow.closest(".block_completion_progress .barContainer"),leftarrow=barcontainer.find(".left-arrow-svg"),rightarrow=barcontainer.find(".right-arrow-svg"),scrolled=barrow.prop("scrollLeft"),scrollWidth=barrow.prop("scrollWidth")-barrow.prop("offsetWidth"),threshold=Math.floor(.25*barrow.find(".progressBarCell:first-child").width());"rtl"===document.dir?((scrolled=-scrolled)>threshold?rightarrow.css("display","block"):rightarrow.css("display","none"),scrollWidth>threshold&&scrolled<scrollWidth-threshold?leftarrow.css("display","block"):leftarrow.css("display","none")):(scrolled>threshold?leftarrow.css("display","block"):leftarrow.css("display","none"),scrollWidth>threshold&&scrolled<scrollWidth-threshold?rightarrow.css("display","block"):rightarrow.css("display","none"))}function initialiseBar(instanceid){var barcontainers=$('.block_completion_progress .barContainer[data-instanceid="'+instanceid+'"]');barcontainers.on("touchstart mouseover",".progressBarCell",showInfo),barcontainers.on("click",".progressBarCell[data-haslink=true]",viewActivity),barcontainers.siblings(".progressEventInfo").find(".progressShowAllInfo").click(showAllInfo),function(barcontainers){var barrows=barcontainers.find(".barRow");function checkEachBar(){barrows.each(checkArrows)}barrows.scroll(checkArrows),$(window).resize(checkEachBar),PubSub.subscribe("nav-drawer-toggle-end",checkEachBar),$(document).on("theme_boost/drawers:shown theme_boost/drawers:hidden",Utils.debounce(checkEachBar,250)),$((function(){barcontainers.find(".nowicon").each((function(){var nowicon=$(this),barrow=nowicon.closest(".block_completion_progress .barRow");barrow.prop("scrollLeft",0),barrow.prop("scrollLeft",nowicon.offset().left-barrow.offset().left-barrow.width()/2)})),barrows.each(checkArrows)})),barcontainers.on("click",".left-arrow-svg",-1,scrollContainer),barcontainers.on("click",".right-arrow-svg",1,scrollContainer)}(barcontainers)}return{init:function(instanceids){for(var i=instanceids.length-1;i>=0;i--)initialiseBar(instanceids[i])}}}));
function _typeof(e){if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(e){return typeof e}}else{_typeof=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return _typeof(e)}(function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define ("block_configurable_reports/codemirror",t):e.CodeMirror=t()})(this,function(){'use strict';var fl=navigator.userAgent,ml=navigator.platform,yl=/gecko\/\d/i.test(fl),xl=/MSIE \d/.test(fl),vl=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(fl),bl=/Edge\/(\d+)/.exec(fl),Cl=xl||vl||bl,ie=Cl&&(xl?document.documentMode||6:+(bl||vl)[1]),wl=!bl&&/WebKit\//.test(fl),Sl=wl&&/Qt\/\d+\.\d+/.test(fl),Ll=!bl&&/Chrome\//.test(fl),kl=/Opera\//.test(fl),Tl=/Apple Computer/.test(navigator.vendor),Nl=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(fl),Ol=/PhantomJS/.test(fl),Al=!bl&&/AppleWebKit/.test(fl)&&/Mobile\/\w+/.test(fl),Ml=/Android/.test(fl),Wl=Al||Ml||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(fl),Dl=Al||/Mac/.test(ml),Hl=/\bCrOS\b/.test(fl),Fl=/win/i.test(ml),Pl=kl&&fl.match(/Version\/(\d*\.\d*)/);if(Pl){Pl=+Pl[1]}if(Pl&&15<=Pl){kl=!1;wl=!0}var Il=Dl&&(Sl||kl&&(null==Pl||12.11>Pl)),zl=yl||Cl&&9<=ie;function e(e){return new RegExp("(^|\\s)"+e+"(?:$|\\s)\\s*")}var El=function(t,i){var n=t.className,o=e(i).exec(n);if(o){var r=n.slice(o.index+o[0].length);t.className=n.slice(0,o.index)+(r?o[1]+r:"")}};function t(t){for(var e=t.childNodes.length;0<e;--e){t.removeChild(t.firstChild)}return t}function n(i,n){return t(i).appendChild(n)}function o(t,n,o,r){var l=document.createElement(t);if(o){l.className=o}if(r){l.style.cssText=r}if("string"==typeof n){l.appendChild(document.createTextNode(n))}else if(n){for(var e=0;e<n.length;++e){l.appendChild(n[e])}}return l}function r(t,i,n,r){var l=o(t,i,n,r);l.setAttribute("role","presentation");return l}var Rl;if(document.createRange){Rl=function(e,t,i,n){var o=document.createRange();o.setEnd(n||e,i);o.setStart(e,t);return o}}else{Rl=function(e,t,i){var n=document.body.createTextRange();try{n.moveToElementText(e.parentNode)}catch(t){return n}n.collapse(!0);n.moveEnd("character",i);n.moveStart("character",t);return n}}function l(e,t){if(3==t.nodeType){t=t.parentNode}if(e.contains){return e.contains(t)}do{if(11==t.nodeType){t=t.host}if(t==e){return!0}}while(t=t.parentNode)}function s(){var t;try{t=document.activeElement}catch(i){t=document.body||null}while(t&&t.shadowRoot&&t.shadowRoot.activeElement){t=t.shadowRoot.activeElement}return t}function d(t,i){var n=t.className;if(!e(i).test(n)){t.className+=(n?" ":"")+i}}function a(t,n){for(var o=t.split(" "),r=0;r<o.length;r++){if(o[r]&&!e(o[r]).test(n)){n+=" "+o[r]}}return n}var Bl=function(e){e.select()};if(Al){Bl=function(e){e.selectionStart=0;e.selectionEnd=e.value.length}}else if(Cl){Bl=function(e){try{e.select()}catch(e){}}}function p(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function c(e,t,i){if(!t){t={}}for(var n in e){if(e.hasOwnProperty(n)&&(!1!==i||!t.hasOwnProperty(n))){t[n]=e[n]}}return t}function h(e,t,o,r,l){if(null==t){t=e.search(/[^\s\u00a0]/);if(-1==t){t=e.length}}for(var s=r||0,d=l||0,a;;){a=e.indexOf("\t",s);if(0>a||a>=t){return d+(t-s)}d+=a-s;d+=o-d%o;s=a+1}}var Gl=function(){this.id=null};Gl.prototype.set=function(e,t){clearTimeout(this.id);this.id=setTimeout(t,e)};function g(e,t){for(var n=0;n<e.length;++n){if(e[n]==t){return n}}return-1}var $l={toString:function toString(){return"CodeMirror.Pass"}},Ul={scroll:!1},jl={origin:"*mouse"},Vl={origin:"+move"};function u(e,t,i){for(var n=0,o=0,r;;){r=e.indexOf("\t",n);if(-1==r){r=e.length}var l=r-n;if(r==e.length||o+l>=t){return n+Math.min(l,t-o)}o+=r-n;o+=i-o%i;n=r+1;if(o>=t){return n}}}var Kl=[""];function f(e){while(Kl.length<=e){Kl.push(y(Kl)+" ")}return Kl[e]}function y(e){return e[e.length-1]}function x(e,t){for(var n=[],o=0;o<e.length;o++){n[o]=t(e[o],o)}return n}function v(e,t,i){var n=0,o=i(t);while(n<e.length&&i(e[n])<=o){n++}e.splice(n,0,t)}function b(){}function C(e,t){var i;if(Object.create){i=Object.create(e)}else{b.prototype=e;i=new b}if(t){c(t,i)}return i}var Xl=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function w(e){return /\w/.test(e)||"\x80"<e&&(e.toUpperCase()!=e.toLowerCase()||Xl.test(e))}function S(e,t){if(!t){return w(e)}if(-1<t.source.indexOf("\\w")&&w(e)){return!0}return t.test(e)}function L(e){for(var t in e){if(e.hasOwnProperty(t)&&e[t]){return!1}}return!0}var Yl=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function k(e){return 768<=e.charCodeAt(0)&&Yl.test(e)}function T(e,t,i){while((0>i?0<t:t<e.length)&&k(e.charAt(t))){t+=i}return t}function N(e,t,i){var n=t>i?-1:1;for(;;){if(t==i){return t}var o=(t+i)/2,r=0>n?Math.ceil(o):Math.floor(o);if(r==t){return e(r)?t:i}if(e(r)){i=r}else{t=r+n}}}function O(e,t,i){var n=this;this.input=i;n.scrollbarFiller=o("div",null,"CodeMirror-scrollbar-filler");n.scrollbarFiller.setAttribute("cm-not-content","true");n.gutterFiller=o("div",null,"CodeMirror-gutter-filler");n.gutterFiller.setAttribute("cm-not-content","true");n.lineDiv=r("div",null,"CodeMirror-code");n.selectionDiv=o("div",null,null,"position: relative; z-index: 1");n.cursorDiv=o("div",null,"CodeMirror-cursors");n.measure=o("div",null,"CodeMirror-measure");n.lineMeasure=o("div",null,"CodeMirror-measure");n.lineSpace=r("div",[n.measure,n.lineMeasure,n.selectionDiv,n.cursorDiv,n.lineDiv],null,"position: relative; outline: none");var l=r("div",[n.lineSpace],"CodeMirror-lines");n.mover=o("div",[l],null,"position: relative");n.sizer=o("div",[n.mover],"CodeMirror-sizer");n.sizerWidth=null;n.heightForcer=o("div",null,null,"position: absolute; height: 30px; width: 1px;");n.gutters=o("div",null,"CodeMirror-gutters");n.lineGutter=null;n.scroller=o("div",[n.sizer,n.heightForcer,n.gutters],"CodeMirror-scroll");n.scroller.setAttribute("tabIndex","-1");n.wrapper=o("div",[n.scrollbarFiller,n.gutterFiller,n.scroller],"CodeMirror");if(Cl&&8>ie){n.gutters.style.zIndex=-1;n.scroller.style.paddingRight=0}if(!wl&&!(yl&&Wl)){n.scroller.draggable=!0}if(e){if(e.appendChild){e.appendChild(n.wrapper)}else{e(n.wrapper)}}n.viewFrom=n.viewTo=t.first;n.reportedViewFrom=n.reportedViewTo=t.first;n.view=[];n.renderedView=null;n.externalMeasured=null;n.viewOffset=0;n.lastWrapHeight=n.lastWrapWidth=0;n.updateLineNumbers=null;n.nativeBarWidth=n.barHeight=n.barWidth=0;n.scrollbarsClipped=!1;n.lineNumWidth=n.lineNumInnerWidth=n.lineNumChars=null;n.alignWidgets=!1;n.cachedCharWidth=n.cachedTextHeight=n.cachedPaddingH=null;n.maxLine=null;n.maxLineLength=0;n.maxLineChanged=!1;n.wheelDX=n.wheelDY=n.wheelStartX=n.wheelStartY=null;n.shift=!1;n.selForContextMenu=null;n.activeTouch=null;i.init(n)}function A(e,t){t-=e.first;if(0>t||t>=e.size){throw new Error("There is no line "+(t+e.first)+" in the document.")}var o=e;while(!o.lines){for(var r=0;;++r){var l=o.children[r],s=l.chunkSize();if(t<s){o=l;break}t-=s}}return o.lines[t]}function M(e,t,i){var o=[],r=t.line;e.iter(t.line,i.line+1,function(e){var n=e.text;if(r==i.line){n=n.slice(0,i.ch)}if(r==t.line){n=n.slice(t.ch)}o.push(n);++r});return o}function W(e,t,i){var n=[];e.iter(t,i,function(e){n.push(e.text)});return n}function D(e,t){var i=t-e.height;if(i){for(var o=e;o;o=o.parent){o.height+=i}}}function H(e){if(null==e.parent){return null}for(var t=e.parent,n=g(t.lines,e),o=t.parent;o;t=o,o=o.parent){for(var r=0;;++r){if(o.children[r]==t){break}n+=o.children[r].chunkSize()}}return n+t.first}function F(e,t){var o=e.first;outer:do{for(var r=0;r<e.children.length;++r){var l=e.children[r],s=l.height;if(t<s){e=l;continue outer}t-=s;o+=l.chunkSize()}return o}while(!e.lines);var d=0;for(;d<e.lines.length;++d){var a=e.lines[d],p=a.height;if(t<p){break}t-=p}return o+d}function P(e,t){return t>=e.first&&t<e.first+e.size}function I(e,t){return e.lineNumberFormatter(t+e.firstLineNumber)+""}function z(e,t,i){if(void 0===i)i=null;if(!(this instanceof z)){return new z(e,t,i)}this.line=e;this.ch=t;this.sticky=i}function E(e,t){return e.line-t.line||e.ch-t.ch}function R(e,t){return e.sticky==t.sticky&&0==E(e,t)}function B(e){return z(e.line,e.ch)}function G(e,t){return 0>E(e,t)?t:e}function $(e,t){return 0>E(e,t)?e:t}function U(e,t){return Math.max(e.first,Math.min(t,e.first+e.size-1))}function j(e,t){if(t.line<e.first){return z(e.first,0)}var i=e.first+e.size-1;if(t.line>i){return z(i,A(e,i).text.length)}return V(t,A(e,t.line).text.length)}function V(e,t){var i=e.ch;if(null==i||i>t){return z(e.line,t)}else if(0>i){return z(e.line,0)}else{return e}}function K(e,t){for(var n=[],o=0;o<t.length;o++){n[o]=j(e,t[o])}return n}var _l=!1,ql=!1;function X(){_l=!0}function Y(){ql=!0}function _(e,t,i){this.marker=e;this.from=t;this.to=i}function q(e,t){if(e){for(var n=0,o;n<e.length;++n){o=e[n];if(o.marker==t){return o}}}}function Z(e,t){for(var n,o=0;o<e.length;++o){if(e[o]!=t){(n||(n=[])).push(e[o])}}return n}function Q(e,t){e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t];t.marker.attachLine(e)}function J(e,t,n){var o;if(e){for(var r=0;r<e.length;++r){var l=e[r],s=l.marker,d=null==l.from||(s.inclusiveLeft?l.from<=t:l.from<t);if(d||l.from==t&&"bookmark"==s.type&&(!n||!l.marker.insertLeft)){var a=null==l.to||(s.inclusiveRight?l.to>=t:l.to>t);(o||(o=[])).push(new _(s,l.from,a?null:l.to))}}}return o}function ee(e,t,n){var o;if(e){for(var r=0;r<e.length;++r){var l=e[r],s=l.marker,d=null==l.to||(s.inclusiveRight?l.to>=t:l.to>t);if(d||l.from==t&&"bookmark"==s.type&&(!n||l.marker.insertLeft)){var a=null==l.from||(s.inclusiveLeft?l.from<=t:l.from<t);(o||(o=[])).push(new _(s,a?null:l.from-t,null==l.to?null:l.to-t))}}}return o}function te(e,t){if(t.full){return null}var n=P(e,t.from.line)&&A(e,t.from.line).markedSpans,o=P(e,t.to.line)&&A(e,t.to.line).markedSpans;if(!n&&!o){return null}var r=t.from.ch,l=t.to.ch,s=0==E(t.from,t.to),d=J(n,r,s),a=ee(o,l,s),p=1==t.text.length,c=y(t.text).length+(p?r:0);if(d){for(var h=0,g;h<d.length;++h){g=d[h];if(null==g.to){var u=q(a,g.marker);if(!u){g.to=r}else if(p){g.to=null==u.to?null:u.to+c}}}}if(a){for(var f=0,m;f<a.length;++f){m=a[f];if(null!=m.to){m.to+=c}if(null==m.from){var x=q(d,m.marker);if(!x){m.from=c;if(p){(d||(d=[])).push(m)}}}else{m.from+=c;if(p){(d||(d=[])).push(m)}}}}if(d){d=ne(d)}if(a&&a!=d){a=ne(a)}var v=[d];if(!p){var b=t.text.length-2,C;if(0<b&&d){for(var w=0;w<d.length;++w){if(null==d[w].to){(C||(C=[])).push(new _(d[w].marker,null,null))}}}for(var S=0;S<b;++S){v.push(C)}v.push(a)}return v}function ne(e){for(var t=0,n;t<e.length;++t){n=e[t];if(null!=n.from&&n.from==n.to&&!1!==n.marker.clearWhenEmpty){e.splice(t--,1)}}if(!e.length){return null}return e}function oe(e,t,n){var o=null;e.iter(t.line,n.line+1,function(e){if(e.markedSpans){for(var t=0,n;t<e.markedSpans.length;++t){n=e.markedSpans[t].marker;if(n.readOnly&&(!o||-1==g(o,n))){(o||(o=[])).push(n)}}}});if(!o){return null}for(var r=[{from:t,to:n}],l=0;l<o.length;++l){for(var s=o[l],d=s.find(0),a=0,c;a<r.length;++a){c=r[a];if(0>E(c.to,d.from)||0<E(c.from,d.to)){continue}var h=[a,1],u=E(c.from,d.from),f=E(c.to,d.to);if(0>u||!s.inclusiveLeft&&!u){h.push({from:c.from,to:d.from})}if(0<f||!s.inclusiveRight&&!f){h.push({from:d.to,to:c.to})}r.splice.apply(r,h);a+=h.length-3}}return r}function re(e){var t=e.markedSpans;if(!t){return}for(var n=0;n<t.length;++n){t[n].marker.detachLine(e)}e.markedSpans=null}function le(e,t){if(!t){return}for(var n=0;n<t.length;++n){t[n].marker.attachLine(e)}e.markedSpans=t}function se(e){return e.inclusiveLeft?-1:0}function de(e){return e.inclusiveRight?1:0}function ae(e,t){var i=e.lines.length-t.lines.length;if(0!=i){return i}var n=e.find(),o=t.find(),r=E(n.from,o.from)||se(e)-se(t);if(r){return-r}var l=E(n.to,o.to)||de(e)-de(t);if(l){return l}return t.id-e.id}function pe(e,t){var n=ql&&e.markedSpans,o;if(n){for(var r=void 0,l=0;l<n.length;++l){r=n[l];if(r.marker.collapsed&&null==(t?r.from:r.to)&&(!o||0>ae(o,r.marker))){o=r.marker}}}return o}function ce(e){return pe(e,!0)}function he(e){return pe(e,!1)}function ge(e,t){var n=ql&&e.markedSpans,o;if(n){for(var r=0,l;r<n.length;++r){l=n[r];if(l.marker.collapsed&&(null==l.from||l.from<t)&&(null==l.to||l.to>t)&&(!o||0>ae(o,l.marker))){o=l.marker}}}return o}function ue(e,t,n,o,r){var l=A(e,t),s=ql&&l.markedSpans;if(s){for(var d=0,a;d<s.length;++d){a=s[d];if(!a.marker.collapsed){continue}var p=a.marker.find(0),c=E(p.from,n)||se(a.marker)-se(r),h=E(p.to,o)||de(a.marker)-de(r);if(0<=c&&0>=h||0>=c&&0<=h){continue}if(0>=c&&(a.marker.inclusiveRight&&r.inclusiveLeft?0<=E(p.to,n):0<E(p.to,n))||0<=c&&(a.marker.inclusiveRight&&r.inclusiveLeft?0>=E(p.from,o):0>E(p.from,o))){return!0}}}}function fe(e){var t;while(t=ce(e)){e=t.find(-1,!0).line}return e}function me(e){var t;while(t=he(e)){e=t.find(1,!0).line}return e}function ye(e){var t,i;while(t=he(e)){e=t.find(1,!0).line;(i||(i=[])).push(e)}return i}function xe(e,t){var i=A(e,t),n=fe(i);if(i==n){return t}return H(n)}function ve(e,t){if(t>e.lastLine()){return t}var i=A(e,t),n;if(!be(e,i)){return t}while(n=he(i)){i=n.find(1,!0).line}return H(i)+1}function be(e,t){var n=ql&&t.markedSpans;if(n){for(var o=void 0,r=0;r<n.length;++r){o=n[r];if(!o.marker.collapsed){continue}if(null==o.from){return!0}if(o.marker.widgetNode){continue}if(0==o.from&&o.marker.inclusiveLeft&&Ce(e,t,o)){return!0}}}}function Ce(e,t,n){if(null==n.to){var o=n.marker.find(1,!0);return Ce(e,o.line,q(o.line.markedSpans,n.marker))}if(n.marker.inclusiveRight&&n.to==t.text.length){return!0}for(var r=void 0,l=0;l<t.markedSpans.length;++l){r=t.markedSpans[l];if(r.marker.collapsed&&!r.marker.widgetNode&&r.from==n.to&&(null==r.to||r.to!=n.from)&&(r.marker.inclusiveLeft||n.marker.inclusiveRight)&&Ce(e,t,r)){return!0}}}function we(e){e=fe(e);for(var t=0,n=e.parent,o=0,r;o<n.lines.length;++o){r=n.lines[o];if(r==e){break}else{t+=r.height}}for(var l=n.parent;l;n=l,l=n.parent){for(var s=0,d;s<l.children.length;++s){d=l.children[s];if(d==n){break}else{t+=d.height}}}return t}function Se(e){if(0==e.height){return 0}var t=e.text.length,i,n=e;while(i=ce(n)){var o=i.find(0,!0);n=o.from.line;t+=o.from.ch-o.to.ch}n=e;while(i=he(n)){var r=i.find(0,!0);t-=n.text.length-r.from.ch;n=r.to.line;t+=n.text.length-r.to.ch}return t}function Le(e){var t=e.display,i=e.doc;t.maxLine=A(i,i.first);t.maxLineLength=Se(t.maxLine);t.maxLineChanged=!0;i.iter(function(e){var i=Se(e);if(i>t.maxLineLength){t.maxLineLength=i;t.maxLine=e}})}function ke(e,t,n,o){if(!e){return o(t,n,"ltr",0)}for(var r=!1,l=0,s;l<e.length;++l){s=e[l];if(s.from<n&&s.to>t||t==n&&s.to==t){o(Math.max(s.from,t),Math.min(s.to,n),1==s.level?"rtl":"ltr",l);r=!0}}if(!r){o(t,n,"ltr")}}var Zl=null;function Te(e,t,n){var o;Zl=null;for(var r=0,l;r<e.length;++r){l=e[r];if(l.from<t&&l.to>t){return r}if(l.to==t){if(l.from!=l.to&&"before"==n){o=r}else{Zl=r}}if(l.from==t){if(l.from!=l.to&&"before"!=n){o=r}else{Zl=r}}}return null!=o?o:Zl}var Ql=function(){function e(e){if(247>=e){return"bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN".charAt(e)}else if(1424<=e&&1524>=e){return"R"}else if(1536<=e&&1785>=e){return"nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111".charAt(e-1536)}else if(1774<=e&&2220>=e){return"r"}else if(8192<=e&&8203>=e){return"w"}else if(8204==e){return"b"}else{return"L"}}var n=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,o=/[stwN]/,r=/[LRr]/,l=/[Lb1n]/,s=/[1n]/;function t(e,t,i){this.level=e;this.from=t;this.to=i}return function(d,a){var p="ltr"==a?"L":"R";if(0==d.length||"ltr"==a&&!n.test(d)){return!1}for(var c=d.length,h=[],g=0;g<c;++g){h.push(e(d.charCodeAt(g)))}for(var u=0,f=p,x;u<c;++u){x=h[u];if("m"==x){h[u]=f}else{f=x}}for(var v=0,b=p,C;v<c;++v){C=h[v];if("1"==C&&"r"==b){h[v]="n"}else if(r.test(C)){b=C;if("r"==C){h[v]="R"}}}for(var w=1,S=h[0],L;w<c-1;++w){L=h[w];if("+"==L&&"1"==S&&"1"==h[w+1]){h[w]="1"}else if(","==L&&S==h[w+1]&&("1"==S||"n"==S)){h[w]=S}S=L}for(var k=0,T;k<c;++k){T=h[k];if(","==T){h[k]="N"}else if("%"==T){var N=void 0;for(N=k+1;N<c&&"%"==h[N];++N){}for(var O=k&&"!"==h[k-1]||N<c&&"1"==h[N]?"1":"N",A=k;A<N;++A){h[A]=O}k=N-1}}for(var M=0,W=p,D;M<c;++M){D=h[M];if("L"==W&&"1"==D){h[M]="L"}else if(r.test(D)){W=D}}for(var H=0;H<c;++H){if(o.test(h[H])){var F=void 0;for(F=H+1;F<c&&o.test(h[F]);++F){}for(var P="L"==(H?h[H-1]:p),I="L"==(F<c?h[F]:p),z=P==I?P?"L":"R":p,E=H;E<F;++E){h[E]=z}H=F-1}}for(var R=[],B,G=0;G<c;){if(l.test(h[G])){var $=G;for(++G;G<c&&l.test(h[G]);++G){}R.push(new t(0,$,G))}else{var U=G,V=R.length;for(++G;G<c&&"L"!=h[G];++G){}for(var K=U;K<G;){if(s.test(h[K])){if(U<K){R.splice(V,0,new t(1,U,K))}var X=K;for(++K;K<G&&s.test(h[K]);++K){}R.splice(V,0,new t(2,X,K));U=K}else{++K}}if(U<G){R.splice(V,0,new t(1,U,G))}}}if("ltr"==a){if(1==R[0].level&&(B=d.match(/^\s+/))){R[0].from=B[0].length;R.unshift(new t(0,0,B[0].length))}if(1==y(R).level&&(B=d.match(/\s+$/))){y(R).to-=B[0].length;R.push(new t(0,c-B[0].length,c))}}return"rtl"==a?R.reverse():R}}();function Ne(e,t){var i=e.order;if(null==i){i=e.order=Ql(e.text,t)}return i}var Jl=[],es=function(e,t,i){if(e.addEventListener){e.addEventListener(t,i,!1)}else if(e.attachEvent){e.attachEvent("on"+t,i)}else{var n=e._handlers||(e._handlers={});n[t]=(n[t]||Jl).concat(i)}};function Oe(e,t){return e._handlers&&e._handlers[t]||Jl}function Ae(e,t,i){if(e.removeEventListener){e.removeEventListener(t,i,!1)}else if(e.detachEvent){e.detachEvent("on"+t,i)}else{var n=e._handlers,o=n&&n[t];if(o){var r=g(o,i);if(-1<r){n[t]=o.slice(0,r).concat(o.slice(r+1))}}}}function Me(e,t){var n=Oe(e,t);if(!n.length){return}for(var o=Array.prototype.slice.call(arguments,2),r=0;r<n.length;++r){n[r].apply(null,o)}}function We(t,i,n){if("string"==typeof i){i={type:i,preventDefault:function preventDefault(){this.defaultPrevented=!0}}}Me(t,n||i.type,t,i);return ze(i)||i.codemirrorIgnore}function De(e){var t=e._handlers&&e._handlers.cursorActivity;if(!t){return}for(var n=e.curOp.cursorActivityHandlers||(e.curOp.cursorActivityHandlers=[]),o=0;o<t.length;++o){if(-1==g(n,t[o])){n.push(t[o])}}}function He(e,t){return 0<Oe(e,t).length}function Fe(e){e.prototype.on=function(e,t){es(this,e,t)};e.prototype.off=function(e,t){Ae(this,e,t)}}function Pe(t){if(t.preventDefault){t.preventDefault()}else{t.returnValue=!1}}function Ie(t){if(t.stopPropagation){t.stopPropagation()}else{t.cancelBubble=!0}}function ze(t){return null!=t.defaultPrevented?t.defaultPrevented:!1==t.returnValue}function Ee(t){Pe(t);Ie(t)}function Re(t){return t.target||t.srcElement}function Be(t){var e=t.which;if(null==e){if(1&t.button){e=1}else if(2&t.button){e=3}else if(4&t.button){e=2}}if(Dl&&t.ctrlKey&&1==e){e=3}return e}var m=function(){if(Cl&&9>ie){return!1}var e=o("div");return"draggable"in e||"dragDrop"in e}(),on;function Ge(e){if(null==on){var t=o("span","\u200B");n(e,o("span",[t,document.createTextNode("x")]));if(0!=e.firstChild.offsetHeight){on=1>=t.offsetWidth&&2<t.offsetHeight&&!(Cl&&8>ie)}}var i=on?o("span","\u200B"):o("span","\xA0",null,"display: inline-block; width: 1px; margin-right: -1px");i.setAttribute("cm-text","");return i}var ts;function $e(e){if(null!=ts){return ts}var i=n(e,document.createTextNode("A\u062EA")),o=Rl(i,0,1).getBoundingClientRect(),r=Rl(i,1,2).getBoundingClientRect();t(e);if(!o||o.left==o.right){return!1}return ts=3>r.right-o.right}var is=3!="\n\nb".split(/\n/).length?function(e){var t=0,i=[],n=e.length;while(t<=n){var o=e.indexOf("\n",t);if(-1==o){o=e.length}var r=e.slice(t,"\r"==e.charAt(o-1)?o-1:o),l=r.indexOf("\r");if(-1!=l){i.push(r.slice(0,l));t+=l+1}else{i.push(r);t=o+1}}return i}:function(e){return e.split(/\r\n?|\n/)},ns=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(t){return!1}}:function(e){var t;try{t=e.ownerDocument.selection.createRange()}catch(t){}if(!t||t.parentElement()!=e){return!1}return 0!=t.compareEndPoints("StartToEnd",t)},os=function(){var t=o("div");if("oncopy"in t){return!0}t.setAttribute("oncopy","return;");return"function"==typeof t.oncopy}(),rs=null;function Ue(e){if(null!=rs){return rs}var t=n(e,o("span","x")),i=t.getBoundingClientRect(),r=Rl(t,0,1).getBoundingClientRect();return rs=1<Math.abs(i.left-r.left)}var ls={},ss={};function je(e,t){if(2<arguments.length){t.dependencies=Array.prototype.slice.call(arguments,2)}ls[e]=t}function Ve(e){if("string"==typeof e&&ss.hasOwnProperty(e)){e=ss[e]}else if(e&&"string"==typeof e.name&&ss.hasOwnProperty(e.name)){var t=ss[e.name];if("string"==typeof t){t={name:t}}e=C(t,e);e.name=t.name}else if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+xml$/.test(e)){return Ve("application/xml")}else if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+json$/.test(e)){return Ve("application/json")}if("string"==typeof e){return{name:e}}else{return e||{name:"null"}}}function Ke(e,t){t=Ve(t);var i=ls[t.name];if(!i){return Ke(e,"text/plain")}var n=i(e,t);if(ds.hasOwnProperty(t.name)){var o=ds[t.name];for(var r in o){if(!o.hasOwnProperty(r)){continue}if(n.hasOwnProperty(r)){n["_"+r]=n[r]}n[r]=o[r]}}n.name=t.name;if(t.helperType){n.helperType=t.helperType}if(t.modeProps){for(var l in t.modeProps){n[l]=t.modeProps[l]}}return n}var ds={};function Xe(e,t){var i=ds.hasOwnProperty(e)?ds[e]:ds[e]={};c(t,i)}function Ye(e,t){if(!0===t){return t}if(e.copyState){return e.copyState(t)}var i={};for(var o in t){var n=t[o];if(n instanceof Array){n=n.concat([])}i[o]=n}return i}function _e(e,t){var i;while(e.innerMode){i=e.innerMode(t);if(!i||i.mode==e){break}t=i.state;e=i.mode}return i||{mode:e,state:t}}function qe(e,t,i){return e.startState?e.startState(t,i):!0}var as=function(e,t,i){this.pos=this.start=0;this.string=e;this.tabSize=t||8;this.lastColumnPos=this.lastColumnValue=0;this.lineStart=0;this.lineOracle=i};as.prototype.eol=function(){return this.pos>=this.string.length};as.prototype.sol=function(){return this.pos==this.lineStart};as.prototype.peek=function(){return this.string.charAt(this.pos)||void 0};as.prototype.next=function(){if(this.pos<this.string.length){return this.string.charAt(this.pos++)}};as.prototype.eat=function(e){var t=this.string.charAt(this.pos),i;if("string"==typeof e){i=t==e}else{i=t&&(e.test?e.test(t):e(t))}if(i){++this.pos;return t}};as.prototype.eatWhile=function(e){var t=this.pos;while(this.eat(e)){}return this.pos>t};as.prototype.eatSpace=function(){var e=this.pos;while(/[\s\u00a0]/.test(this.string.charAt(this.pos))){++this.pos}return this.pos>e};as.prototype.skipToEnd=function(){this.pos=this.string.length};as.prototype.skipTo=function(e){var t=this.string.indexOf(e,this.pos);if(-1<t){this.pos=t;return!0}};as.prototype.backUp=function(e){this.pos-=e};as.prototype.column=function(){if(this.lastColumnPos<this.start){this.lastColumnValue=h(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue);this.lastColumnPos=this.start}return this.lastColumnValue-(this.lineStart?h(this.string,this.lineStart,this.tabSize):0)};as.prototype.indentation=function(){return h(this.string,null,this.tabSize)-(this.lineStart?h(this.string,this.lineStart,this.tabSize):0)};as.prototype.match=function(e,t,i){if("string"==typeof e){var n=function(e){return i?e.toLowerCase():e},o=this.string.substr(this.pos,e.length);if(n(o)==n(e)){if(!1!==t){this.pos+=e.length}return!0}}else{var r=this.string.slice(this.pos).match(e);if(r&&0<r.index){return null}if(r&&!1!==t){this.pos+=r[0].length}return r}};as.prototype.current=function(){return this.string.slice(this.start,this.pos)};as.prototype.hideFirstChars=function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}};as.prototype.lookAhead=function(e){var t=this.lineOracle;return t&&t.lookAhead(e)};as.prototype.baseToken=function(){var e=this.lineOracle;return e&&e.baseToken(this.pos)};var ps=function(e,t){this.state=e;this.lookAhead=t},cs=function(e,t,i,n){this.state=t;this.doc=e;this.line=i;this.maxLookAhead=n||0;this.baseTokens=null;this.baseTokenPos=1};cs.prototype.lookAhead=function(e){var t=this.doc.getLine(this.line+e);if(null!=t&&e>this.maxLookAhead){this.maxLookAhead=e}return t};cs.prototype.baseToken=function(e){if(!this.baseTokens){return null}while(this.baseTokens[this.baseTokenPos]<=e){this.baseTokenPos+=2}var t=this.baseTokens[this.baseTokenPos+1];return{type:t&&t.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-e}};cs.prototype.nextLine=function(){this.line++;if(0<this.maxLookAhead){this.maxLookAhead--}};cs.fromSaved=function(e,t,i){if(t instanceof ps){return new cs(e,Ye(e.mode,t.state),i,t.lookAhead)}else{return new cs(e,Ye(e.mode,t),i)}};cs.prototype.save=function(e){var t=!1!==e?Ye(this.doc.mode,this.state):this.state;return 0<this.maxLookAhead?new ps(t,this.maxLookAhead):t};function Ze(e,t,n,r){var l=[e.state.modeGen],s={};rt(e,t.text,e.doc.mode,n,function(e,t){return l.push(e,t)},s,r);for(var d=n.state,a=function(r){n.baseTokens=l;var o=e.state.overlays[r],a=1,p=0;n.state=!0;rt(e,t.text,o.mode,n,function(e,t){var i=a;while(p<e){var n=l[a];if(n>e){l.splice(a,1,e,l[a+1],n)}a+=2;p=Math.min(e,n)}if(!t){return}if(o.opaque){l.splice(i,a-i,e,"overlay "+t);a=i+2}else{for(;i<a;i+=2){var r=l[i+1];l[i+1]=(r?r+" ":"")+"overlay "+t}}},s);n.state=d;n.baseTokens=null;n.baseTokenPos=1},p=0;p<e.state.overlays.length;++p){a(p)}return{styles:l,classes:s.bgClass||s.textClass?s:null}}function Qe(e,t,i){if(!t.styles||t.styles[0]!=e.state.modeGen){var n=Je(e,H(t)),o=t.text.length>e.options.maxHighlightLength&&Ye(e.doc.mode,n.state),r=Ze(e,t,n);if(o){n.state=o}t.stateAfter=n.save(!o);t.styles=r.styles;if(r.classes){t.styleClasses=r.classes}else if(t.styleClasses){t.styleClasses=null}if(i===e.doc.highlightFrontier){e.doc.modeFrontier=Math.max(e.doc.modeFrontier,++e.doc.highlightFrontier)}}return t.styles}function Je(e,t,i){var n=e.doc,o=e.display;if(!n.mode.startState){return new cs(n,!0,t)}var r=lt(e,t,i),l=r>n.first&&A(n,r-1).stateAfter,s=l?cs.fromSaved(n,l,r):new cs(n,qe(n.mode),r);n.iter(r,t,function(i){et(e,i.text,s);var n=s.line;i.stateAfter=n==t-1||0==n%5||n>=o.viewFrom&&n<o.viewTo?s.save():null;s.nextLine()});if(i){n.modeFrontier=s.line}return s}function et(e,t,i,n){var o=e.doc.mode,r=new as(t,e.options.tabSize,i);r.start=r.pos=n||0;if(""==t){tt(o,i.state)}while(!r.eol()){it(o,r,i.state);r.start=r.pos}}function tt(e,t){if(e.blankLine){return e.blankLine(t)}if(!e.innerMode){return}var i=_e(e,t);if(i.mode.blankLine){return i.mode.blankLine(i.state)}}function it(e,t,n,o){for(var r=0;10>r;r++){if(o){o[0]=_e(e,n).mode}var l=e.token(t,n);if(t.pos>t.start){return l}}throw new Error("Mode "+e.name+" failed to advance stream.")}var hs=function(e,t,i){this.start=e.start;this.end=e.pos;this.string=e.current();this.type=t||null;this.state=i};function nt(e,t,i,n){var o=e.doc,r=o.mode,l;t=j(o,t);var s=A(o,t.line),d=Je(e,t.line,i),a=new as(s.text,e.options.tabSize,d),p;if(n){p=[]}while((n||a.pos<t.ch)&&!a.eol()){a.start=a.pos;l=it(r,a,d.state);if(n){p.push(new hs(a,l,Ye(o.mode,d.state)))}}return n?p:new hs(a,l,d.state)}function ot(e,t){if(e){for(;;){var i=e.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!i){break}e=e.slice(0,i.index)+e.slice(i.index+i[0].length);var n=i[1]?"bgClass":"textClass";if(null==t[n]){t[n]=i[2]}else if(!new RegExp("(?:^|s)"+i[2]+"(?:$|s)").test(t[n])){t[n]+=" "+i[2]}}}return e}function rt(e,t,i,n,o,r,l){var s=i.flattenSpans;if(null==s){s=e.options.flattenSpans}var d=0,a=null,p=new as(t,e.options.tabSize,n),c,h=e.options.addModeClass&&[null];if(""==t){ot(tt(i,n.state),r)}while(!p.eol()){if(p.pos>e.options.maxHighlightLength){s=!1;if(l){et(e,t,n,p.pos)}p.pos=t.length;c=null}else{c=ot(it(i,p,n.state,h),r)}if(h){var g=h[0].name;if(g){c="m-"+(c?g+" "+c:g)}}if(!s||a!=c){while(d<p.start){d=Math.min(p.start,d+5e3);o(d,a)}a=c}p.start=p.pos}while(d<p.pos){var u=Math.min(p.pos,d+5e3);o(u,a);d=u}}function lt(e,t,i){for(var n,o,r=e.doc,l=i?-1:t-(e.doc.mode.innerMode?1e3:100),s=t;s>l;--s){if(s<=r.first){return r.first}var d=A(r,s-1),a=d.stateAfter;if(a&&(!i||s+(a instanceof ps?a.lookAhead:0)<=r.modeFrontier)){return s}var p=h(d.text,null,e.options.tabSize);if(null==o||n>p){o=s-1;n=p}}return o}function st(e,t){e.modeFrontier=Math.min(e.modeFrontier,t);if(e.highlightFrontier<t-10){return}for(var i=e.first,n=t-1,o;n>i;n--){o=A(e,n).stateAfter;if(o&&(!(o instanceof ps)||n+o.lookAhead<t)){i=n+1;break}}e.highlightFrontier=Math.min(e.highlightFrontier,i)}var gs=function(e,t,i){this.text=e;le(this,t);this.height=i?i(this):1};gs.prototype.lineNo=function(){return H(this)};Fe(gs);function dt(e,t,i,n){e.text=t;if(e.stateAfter){e.stateAfter=null}if(e.styles){e.styles=null}if(null!=e.order){e.order=null}re(e);le(e,i);var o=n?n(e):1;if(o!=e.height){D(e,o)}}function at(e){e.parent=null;re(e)}var us={},fs={};function pt(e,t){if(!e||/^\s*$/.test(e)){return null}var i=t.addModeClass?fs:us;return i[e]||(i[e]=e.replace(/\S+/g,"cm-$&"))}function ct(e,t){var n=r("span",null,null,wl?"padding-right: .1px":null),o={pre:r("pre",[n],"CodeMirror-line"),content:n,col:0,pos:0,cm:e,trailingSpace:!1,splitSpaces:e.getOption("lineWrapping")};t.measure={};for(var l=0;l<=(t.rest?t.rest.length:0);l++){var s=l?t.rest[l-1]:t.line,d=void 0;o.pos=0;o.addToken=gt;if($e(e.display.measure)&&(d=Ne(s,e.doc.direction))){o.addToken=ft(o.addToken,d)}o.map=[];var p=t!=e.display.externalMeasured&&H(s);yt(s,o,Qe(e,s,p));if(s.styleClasses){if(s.styleClasses.bgClass){o.bgClass=a(s.styleClasses.bgClass,o.bgClass||"")}if(s.styleClasses.textClass){o.textClass=a(s.styleClasses.textClass,o.textClass||"")}}if(0==o.map.length){o.map.push(0,0,o.content.appendChild(Ge(e.display.measure)))}if(0==l){t.measure.map=o.map;t.measure.cache={}}else{(t.measure.maps||(t.measure.maps=[])).push(o.map);(t.measure.caches||(t.measure.caches=[])).push({})}}if(wl){var c=o.content.lastChild;if(/\bcm-tab\b/.test(c.className)||c.querySelector&&c.querySelector(".cm-tab")){o.content.className="cm-tab-wrap-hack"}}Me(e,"renderLine",e,t.line,o.pre);if(o.pre.className){o.textClass=a(o.pre.className,o.textClass||"")}return o}function ht(e){var t=o("span","\u2022","cm-invalidchar");t.title="\\u"+e.charCodeAt(0).toString(16);t.setAttribute("aria-label",t.title);return t}function gt(e,t,i,n,r,l,s){if(!t){return}var d=e.splitSpaces?ut(t,e.trailingSpace):t,a=e.cm.state.specialChars,p=!1,c;if(!a.test(t)){e.col+=t.length;c=document.createTextNode(d);e.map.push(e.pos,e.pos+t.length,c);if(Cl&&9>ie){p=!0}e.pos+=t.length}else{c=document.createDocumentFragment();var h=0;while(!0){a.lastIndex=h;var g=a.exec(t),u=g?g.index-h:t.length-h;if(u){var m=document.createTextNode(d.slice(h,h+u));if(Cl&&9>ie){c.appendChild(o("span",[m]))}else{c.appendChild(m)}e.map.push(e.pos,e.pos+u,m);e.col+=u;e.pos+=u}if(!g){break}h+=u+1;var y=void 0;if("\t"==g[0]){var x=e.cm.options.tabSize,v=x-e.col%x;y=c.appendChild(o("span",f(v),"cm-tab"));y.setAttribute("role","presentation");y.setAttribute("cm-text","\t");e.col+=v}else if("\r"==g[0]||"\n"==g[0]){y=c.appendChild(o("span","\r"==g[0]?"\u240D":"\u2424","cm-invalidchar"));y.setAttribute("cm-text",g[0]);e.col+=1}else{y=e.cm.options.specialCharPlaceholder(g[0]);y.setAttribute("cm-text",g[0]);if(Cl&&9>ie){c.appendChild(o("span",[y]))}else{c.appendChild(y)}e.col+=1}e.map.push(e.pos,e.pos+1,y);e.pos++}}e.trailingSpace=32==d.charCodeAt(t.length-1);if(i||n||r||p||s){var b=i||"";if(n){b+=n}if(r){b+=r}var C=o("span",[c],b,s);if(l){C.title=l}return e.content.appendChild(C)}e.content.appendChild(c)}function ut(e,t){if(1<e.length&&!/  /.test(e)){return e}for(var n=t,o="",r=0,l;r<e.length;r++){l=e.charAt(r);if(" "==l&&n&&(r==e.length-1||32==e.charCodeAt(r+1))){l="\xA0"}o+=l;n=" "==l}return o}function ft(e,t){return function(n,o,r,l,s,d,a){r=r?r+" cm-force-border":"cm-force-border";var p=n.pos,c=p+o.length;for(;;){for(var h=void 0,g=0;g<t.length;g++){h=t[g];if(h.to>p&&h.from<=p){break}}if(h.to>=c){return e(n,o,r,l,s,d,a)}e(n,o.slice(0,h.to-p),r,l,null,d,a);l=null;o=o.slice(h.to-p);p=h.to}}}function mt(e,t,i,n){var o=!n&&i.widgetNode;if(o){e.map.push(e.pos,e.pos+t,o)}if(!n&&e.cm.display.input.needsContentAttribute){if(!o){o=e.content.appendChild(document.createElement("span"))}o.setAttribute("cm-marker",i.id)}if(o){e.cm.display.input.setUneditable(o);e.content.appendChild(o)}e.pos+=t;e.trailingSpace=!1}function yt(e,t,n){var o=e.markedSpans,r=e.text,l=0;if(!o){for(var s=1;s<n.length;s+=2){t.addToken(t,r.slice(l,l=n[s]),pt(n[s+1],t.cm.options))}return}var d=r.length,a=0,p=1,c="",h,g,u=0,f,y,x,v,b;for(;;){if(u==a){f=y=x=v=g="";b=null;u=1/0;for(var C=[],w=void 0,S=0;S<o.length;++S){var L=o[S],k=L.marker;if("bookmark"==k.type&&L.from==a&&k.widgetNode){C.push(k)}else if(L.from<=a&&(null==L.to||L.to>a||k.collapsed&&L.to==a&&L.from==a)){if(null!=L.to&&L.to!=a&&u>L.to){u=L.to;y=""}if(k.className){f+=" "+k.className}if(k.css){g=(g?g+";":"")+k.css}if(k.startStyle&&L.from==a){x+=" "+k.startStyle}if(k.endStyle&&L.to==u){(w||(w=[])).push(k.endStyle,L.to)}if(k.title&&!v){v=k.title}if(k.collapsed&&(!b||0>ae(b.marker,k))){b=L}}else if(L.from>a&&u>L.from){u=L.from}}if(w){for(var m=0;m<w.length;m+=2){if(w[m+1]==u){y+=" "+w[m]}}}if(!b||b.from==a){for(var T=0;T<C.length;++T){mt(t,0,C[T])}}if(b&&(b.from||0)==a){mt(t,(null==b.to?d+1:b.to)-a,b.marker,null==b.from);if(null==b.to){return}if(b.to==a){b=!1}}}if(a>=d){break}var N=Math.min(d,u);while(!0){if(c){var O=a+c.length;if(!b){var A=O>N?c.slice(0,N-a):c;t.addToken(t,A,h?h+f:f,x,a+A.length==u?y:"",v,g)}if(O>=N){c=c.slice(N-a);a=N;break}a=O;x=""}c=r.slice(l,l=n[p++]);h=pt(n[p++],t.cm.options)}}}function xt(e,t,i){this.line=t;this.rest=ye(t);this.size=this.rest?H(y(this.rest))-i+1:1;this.node=this.text=null;this.hidden=be(e,t)}function vt(e,t,i){for(var n=[],o,r=t,l;r<i;r=o){l=new xt(e.doc,A(e.doc,r),r);o=r+l.size;n.push(l)}return n}var ms=null;function bt(e){if(ms){ms.ops.push(e)}else{e.ownsGroup=ms={ops:[e],delayedCallbacks:[]}}}function Ct(e){var t=e.delayedCallbacks,n=0;do{for(;n<t.length;n++){t[n].call(null)}for(var o=0,r;o<e.ops.length;o++){r=e.ops[o];if(r.cursorActivityHandlers){while(r.cursorActivityCalled<r.cursorActivityHandlers.length){r.cursorActivityHandlers[r.cursorActivityCalled++].call(null,r.cm)}}}}while(n<t.length)}function wt(e,t){var i=e.ownsGroup;if(!i){return}try{Ct(i)}finally{ms=null;t(i)}}var ys=null;function St(e,t){var n=Oe(e,t);if(!n.length){return}var o=Array.prototype.slice.call(arguments,2),r;if(ms){r=ms.delayedCallbacks}else if(ys){r=ys}else{r=ys=[];setTimeout(Lt,0)}for(var l=function(e){r.push(function(){return n[e].apply(null,o)})},s=0;s<n.length;++s){l(s)}}function Lt(){var e=ys;ys=null;for(var t=0;t<e.length;++t){e[t]()}}function kt(e,t,i,n){for(var o=0,r;o<t.changes.length;o++){r=t.changes[o];if("text"==r){At(e,t)}else if("gutter"==r){Wt(e,t,i,n)}else if("class"==r){Mt(e,t)}else if("widget"==r){Dt(e,t,n)}}t.changes=null}function Tt(e){if(e.node==e.text){e.node=o("div",null,null,"position: relative");if(e.text.parentNode){e.text.parentNode.replaceChild(e.node,e.text)}e.node.appendChild(e.text);if(Cl&&8>ie){e.node.style.zIndex=2}}return e.node}function Nt(e,t){var i=t.bgClass?t.bgClass+" "+(t.line.bgClass||""):t.line.bgClass;if(i){i+=" CodeMirror-linebackground"}if(t.background){if(i){t.background.className=i}else{t.background.parentNode.removeChild(t.background);t.background=null}}else if(i){var n=Tt(t);t.background=n.insertBefore(o("div",null,i),n.firstChild);e.display.input.setUneditable(t.background)}}function Ot(e,t){var i=e.display.externalMeasured;if(i&&i.line==t.line){e.display.externalMeasured=null;t.measure=i.measure;return i.built}return ct(e,t)}function At(e,t){var i=t.text.className,n=Ot(e,t);if(t.text==t.node){t.node=n.pre}t.text.parentNode.replaceChild(n.pre,t.text);t.text=n.pre;if(n.bgClass!=t.bgClass||n.textClass!=t.textClass){t.bgClass=n.bgClass;t.textClass=n.textClass;Mt(e,t)}else if(i){t.text.className=i}}function Mt(e,t){Nt(e,t);if(t.line.wrapClass){Tt(t).className=t.line.wrapClass}else if(t.node!=t.text){t.node.className=""}var i=t.textClass?t.textClass+" "+(t.line.textClass||""):t.line.textClass;t.text.className=i||""}function Wt(e,t,i,n){if(t.gutter){t.node.removeChild(t.gutter);t.gutter=null}if(t.gutterBackground){t.node.removeChild(t.gutterBackground);t.gutterBackground=null}if(t.line.gutterClass){var r=Tt(t);t.gutterBackground=o("div",null,"CodeMirror-gutter-background "+t.line.gutterClass,"left: "+(e.options.fixedGutter?n.fixedPos:-n.gutterTotalWidth)+"px; width: "+n.gutterTotalWidth+"px");e.display.input.setUneditable(t.gutterBackground);r.insertBefore(t.gutterBackground,t.text)}var l=t.line.gutterMarkers;if(e.options.lineNumbers||l){var s=Tt(t),d=t.gutter=o("div",null,"CodeMirror-gutter-wrapper","left: "+(e.options.fixedGutter?n.fixedPos:-n.gutterTotalWidth)+"px");e.display.input.setUneditable(d);s.insertBefore(d,t.text);if(t.line.gutterClass){d.className+=" "+t.line.gutterClass}if(e.options.lineNumbers&&(!l||!l["CodeMirror-linenumbers"])){t.lineNumber=d.appendChild(o("div",I(e.options,i),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+n.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+e.display.lineNumInnerWidth+"px"))}if(l){for(var a=0;a<e.options.gutters.length;++a){var p=e.options.gutters[a],c=l.hasOwnProperty(p)&&l[p];if(c){d.appendChild(o("div",[c],"CodeMirror-gutter-elt","left: "+n.gutterLeft[p]+"px; width: "+n.gutterWidth[p]+"px"))}}}}}function Dt(e,t,i){if(t.alignable){t.alignable=null}for(var n=t.node.firstChild,o=void 0;n;n=o){o=n.nextSibling;if("CodeMirror-linewidget"==n.className){t.node.removeChild(n)}}Ft(e,t,i)}function Ht(e,t,i,n){var o=Ot(e,t);t.text=t.node=o.pre;if(o.bgClass){t.bgClass=o.bgClass}if(o.textClass){t.textClass=o.textClass}Mt(e,t);Wt(e,t,i,n);Ft(e,t,n);return t.node}function Ft(e,t,n){Pt(e,t.line,t,n,!0);if(t.rest){for(var o=0;o<t.rest.length;o++){Pt(e,t.rest[o],t,n,!1)}}}function Pt(e,t,n,r,l){if(!t.widgets){return}for(var s=Tt(n),d=0,a=t.widgets;d<a.length;++d){var p=a[d],c=o("div",[p.node],"CodeMirror-linewidget");if(!p.handleMouseEvents){c.setAttribute("cm-ignore-events","true")}It(p,c,n,r);e.display.input.setUneditable(c);if(l&&p.above){s.insertBefore(c,n.gutter||n.text)}else{s.appendChild(c)}St(p,"redraw")}}function It(e,t,i,n){if(e.noHScroll){(i.alignable||(i.alignable=[])).push(t);var o=n.wrapperWidth;t.style.left=n.fixedPos+"px";if(!e.coverGutter){o-=n.gutterTotalWidth;t.style.paddingLeft=n.gutterTotalWidth+"px"}t.style.width=o+"px"}if(e.coverGutter){t.style.zIndex=5;t.style.position="relative";if(!e.noHScroll){t.style.marginLeft=-n.gutterTotalWidth+"px"}}}function zt(e){if(null!=e.height){return e.height}var t=e.doc.cm;if(!t){return 0}if(!l(document.body,e.node)){var i="position: relative;";if(e.coverGutter){i+="margin-left: -"+t.display.gutters.offsetWidth+"px;"}if(e.noHScroll){i+="width: "+t.display.wrapper.clientWidth+"px;"}n(t.display.measure,o("div",[e.node],null,i))}return e.height=e.node.parentNode.offsetHeight}function Et(t,i){for(var e=Re(i);e!=t.wrapper;e=e.parentNode){if(!e||1==e.nodeType&&"true"==e.getAttribute("cm-ignore-events")||e.parentNode==t.sizer&&e!=t.mover){return!0}}}function Rt(e){return e.lineSpace.offsetTop}function Bt(e){return e.mover.offsetHeight-e.lineSpace.offsetHeight}function Gt(t){if(t.cachedPaddingH){return t.cachedPaddingH}var i=n(t.measure,o("pre","x")),e=window.getComputedStyle?window.getComputedStyle(i):i.currentStyle,r={left:parseInt(e.paddingLeft),right:parseInt(e.paddingRight)};if(!isNaN(r.left)&&!isNaN(r.right)){t.cachedPaddingH=r}return r}function $t(e){return 30-e.display.nativeBarWidth}function Ut(e){return e.display.scroller.clientWidth-$t(e)-e.display.barWidth}function jt(e){return e.display.scroller.clientHeight-$t(e)-e.display.barHeight}function Vt(e,t,n){var o=e.options.lineWrapping,r=o&&Ut(e);if(!t.measure.heights||o&&t.measure.width!=r){var l=t.measure.heights=[];if(o){t.measure.width=r;for(var s=t.text.firstChild.getClientRects(),d=0;d<s.length-1;d++){var a=s[d],p=s[d+1];if(2<Math.abs(a.bottom-p.bottom)){l.push((a.bottom+p.top)/2-n.top)}}}l.push(n.bottom-n.top)}}function Kt(e,t,n){if(e.line==t){return{map:e.measure.map,cache:e.measure.cache}}for(var o=0;o<e.rest.length;o++){if(e.rest[o]==t){return{map:e.measure.maps[o],cache:e.measure.caches[o]}}}for(var r=0;r<e.rest.length;r++){if(H(e.rest[r])>n){return{map:e.measure.maps[r],cache:e.measure.caches[r],before:!0}}}}function Xt(e,t){t=fe(t);var i=H(t),o=e.display.externalMeasured=new xt(e.doc,t,i);o.lineN=i;var r=o.built=ct(e,o);o.text=r.pre;n(e.display.lineMeasure,r.pre);return o}function Yt(e,t,i,n){return Zt(e,qt(e,t),i,n)}function _t(e,t){if(t>=e.display.viewFrom&&t<e.display.viewTo){return e.display.view[Oi(e,t)]}var i=e.display.externalMeasured;if(i&&t>=i.lineN&&t<i.lineN+i.size){return i}}function qt(e,t){var i=H(t),n=_t(e,i);if(n&&!n.text){n=null}else if(n&&n.changes){kt(e,n,i,Si(e));e.curOp.forceUpdate=!0}if(!n){n=Xt(e,t)}var o=Kt(n,t,i);return{line:t,view:n,rect:null,map:o.map,cache:o.cache,before:o.before,hasHeights:!1}}function Zt(e,t,i,n,o){if(t.before){i=-1}var r=i+(n||""),l;if(t.cache.hasOwnProperty(r)){l=t.cache[r]}else{if(!t.rect){t.rect=t.view.text.getBoundingClientRect()}if(!t.hasHeights){Vt(e,t.view,t.rect);t.hasHeights=!0}l=ei(e,t,i,n);if(!l.bogus){t.cache[r]=l}}return{left:l.left,right:l.right,top:o?l.rtop:l.top,bottom:o?l.rbottom:l.bottom}}var xs={left:0,right:0,top:0,bottom:0};function Qt(e,t,n){for(var o,r,l,s,d,a,p=0;p<e.length;p+=3){d=e[p];a=e[p+1];if(t<d){r=0;l=1;s="left"}else if(t<a){r=t-d;l=r+1}else if(p==e.length-3||t==a&&e[p+3]>t){l=a-d;r=l-1;if(t>=a){s="right"}}if(null!=r){o=e[p+2];if(d==a&&n==(o.insertLeft?"left":"right")){s=n}if("left"==n&&0==r){while(p&&e[p-2]==e[p-3]&&e[p-1].insertLeft){o=e[(p-=3)+2];s="left"}}if("right"==n&&r==a-d){while(p<e.length-3&&e[p+3]==e[p+4]&&!e[p+5].insertLeft){o=e[(p+=3)+2];s="right"}}break}}return{node:o,start:r,end:l,collapse:s,coverStart:d,coverEnd:a}}function Jt(e,t){var n=xs;if("left"==t){for(var o=0;o<e.length;o++){if((n=e[o]).left!=n.right){break}}}else{for(var r=e.length-1;0<=r;r--){if((n=e[r]).left!=n.right){break}}}return n}function ei(e,t,n,o){var r=Qt(t.map,n,o),l=r.node,s=r.start,d=r.end,a=r.collapse,p;if(3==l.nodeType){for(var c=0;4>c;c++){while(s&&k(t.line.text.charAt(r.coverStart+s))){--s}while(r.coverStart+d<r.coverEnd&&k(t.line.text.charAt(r.coverStart+d))){++d}if(Cl&&9>ie&&0==s&&d==r.coverEnd-r.coverStart){p=l.parentNode.getBoundingClientRect()}else{p=Jt(Rl(l,s,d).getClientRects(),o)}if(p.left||p.right||0==s){break}d=s;s=s-1;a="right"}if(Cl&&11>ie){p=ti(e.display.measure,p)}}else{if(0<s){a=o="right"}var h;if(e.options.lineWrapping&&1<(h=l.getClientRects()).length){p=h["right"==o?h.length-1:0]}else{p=l.getBoundingClientRect()}}if(Cl&&9>ie&&!s&&(!p||!p.left&&!p.right)){var g=l.parentNode.getClientRects()[0];if(g){p={left:g.left,right:g.left+wi(e.display),top:g.top,bottom:g.bottom}}else{p=xs}}var u=p.top-t.rect.top,f=p.bottom-t.rect.top,m=t.view.measure.heights,y=0;for(;y<m.length-1;y++){if((u+f)/2<m[y]){break}}var x=y?m[y-1]:0,v=m[y],b={left:("right"==a?p.right:p.left)-t.rect.left,right:("left"==a?p.left:p.right)-t.rect.left,top:x,bottom:v};if(!p.left&&!p.right){b.bogus=!0}if(!e.options.singleCursorHeightPerLine){b.rtop=u;b.rbottom=f}return b}function ti(e,t){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!Ue(e)){return t}var i=screen.logicalXDPI/screen.deviceXDPI,n=screen.logicalYDPI/screen.deviceYDPI;return{left:t.left*i,right:t.right*i,top:t.top*n,bottom:t.bottom*n}}function ii(e){if(e.measure){e.measure.cache={};e.measure.heights=null;if(e.rest){for(var t=0;t<e.rest.length;t++){e.measure.caches[t]={}}}}}function ni(e){e.display.externalMeasure=null;t(e.display.lineMeasure);for(var n=0;n<e.display.view.length;n++){ii(e.display.view[n])}}function oi(e){ni(e);e.display.cachedCharWidth=e.display.cachedTextHeight=e.display.cachedPaddingH=null;if(!e.options.lineWrapping){e.display.maxLineChanged=!0}e.display.lineNumChars=null}function ri(){if(Ll&&Ml){return-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft))}return window.pageXOffset||(document.documentElement||document.body).scrollLeft}function li(){if(Ll&&Ml){return-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop))}return window.pageYOffset||(document.documentElement||document.body).scrollTop}function si(e){var t=0;if(e.widgets){for(var n=0;n<e.widgets.length;++n){if(e.widgets[n].above){t+=zt(e.widgets[n])}}}return t}function di(e,t,i,n,o){if(!o){var r=si(t);i.top+=r;i.bottom+=r}if("line"==n){return i}if(!n){n="local"}var l=we(t);if("local"==n){l+=Rt(e.display)}else{l-=e.display.viewOffset}if("page"==n||"window"==n){var s=e.display.lineSpace.getBoundingClientRect();l+=s.top+("window"==n?0:li());var d=s.left+("window"==n?0:ri());i.left+=d;i.right+=d}i.top+=l;i.bottom+=l;return i}function ai(e,t,i){if("div"==i){return t}var n=t.left,o=t.top;if("page"==i){n-=ri();o-=li()}else if("local"==i||!i){var r=e.display.sizer.getBoundingClientRect();n+=r.left;o+=r.top}var l=e.display.lineSpace.getBoundingClientRect();return{left:n-l.left,top:o-l.top}}function pi(e,t,i,n,o){if(!n){n=A(e.doc,t.line)}return di(e,n,Yt(e,n,t.ch,o),i)}function ci(e,t,i,n,o,r){n=n||A(e.doc,t.line);if(!o){o=qt(e,n)}function l(t,l){var s=Zt(e,o,t,l?"right":"left",r);if(l){s.left=s.right}else{s.right=s.left}return di(e,n,s,i)}var d=Ne(n,e.doc.direction),a=t.ch,p=t.sticky;if(a>=n.text.length){a=n.text.length;p="before"}else if(0>=a){a=0;p="after"}if(!d){return l("before"==p?a-1:a,"before"==p)}function s(e,t,i){var n=d[t],o=1==n.level;return l(i?e-1:e,o!=i)}var c=Te(d,a,p),h=Zl,g=s(a,c,"before"==p);if(null!=h){g.other=s(a,h,"before"!=p)}return g}function hi(e,t){var i=0;t=j(e.doc,t);if(!e.options.lineWrapping){i=wi(e.display)*t.ch}var n=A(e.doc,t.line),o=we(n)+Rt(e.display);return{left:i,right:i,top:o,bottom:o+n.height}}function gi(e,t,i,n,o){var r=z(e,t,i);r.xRel=o;if(n){r.outside=!0}return r}function ui(e,t,i){var n=e.doc;i+=e.display.viewOffset;if(0>i){return gi(n.first,0,null,!0,-1)}var o=F(n,i),r=n.first+n.size-1;if(o>r){return gi(n.first+n.size-1,A(n,r).text.length,null,!0,1)}if(0>t){t=0}var l=A(n,o);for(;;){var s=xi(e,l,o,t,i),d=ge(l,s.ch+(0<s.xRel?1:0));if(!d){return s}var a=d.find(1);if(a.line==o){return a}l=A(n,o=a.line)}}function fi(e,t,i,n){n-=si(t);var o=t.text.length,r=N(function(t){return Zt(e,i,t-1).bottom<=n},o,0);o=N(function(t){return Zt(e,i,t).top>n},r,o);return{begin:r,end:o}}function mi(e,t,i,n){if(!i){i=qt(e,t)}var o=di(e,t,Zt(e,i,n),"line").top;return fi(e,t,i,o)}function yi(e,t,i,n){return e.bottom<=i?!1:e.top>i?!0:(n?e.left:e.right)>t}function xi(e,t,i,n,o){o-=we(t);var r=qt(e,t),l=si(t),s=0,d=t.text.length,a=!0,p=Ne(t,e.doc.direction);if(p){var c=(e.options.lineWrapping?bi:vi)(e,t,i,r,p,n,o);a=1!=c.level;s=a?c.from:c.to-1;d=a?c.to:c.from-1}var h=null,g=null,u=N(function(t){var i=Zt(e,r,t);i.top+=l;i.bottom+=l;if(!yi(i,n,o,!1)){return!1}if(i.top<=o&&i.left<=n){h=t;g=i}return!0},s,d),f,m,x=!1;if(g){var v=n-g.left<g.right-n,b=v==a;u=h+(b?0:1);m=b?"after":"before";f=v?g.left:g.right}else{if(!a&&(u==d||u==s)){u++}m=0==u?"after":u==t.text.length?"before":Zt(e,r,u-(a?1:0)).bottom+l<=o==a?"after":"before";var C=ci(e,z(i,u,m),"line",t,r);f=C.left;x=o<C.top||o>=C.bottom}u=T(t.text,u,1);return gi(i,u,m,x,n-f)}function vi(e,t,n,o,r,l,s){var i=N(function(d){var i=r[d],a=1!=i.level;return yi(ci(e,z(n,a?i.to:i.from,a?"before":"after"),"line",t,o),l,s,!0)},0,r.length-1),d=r[i];if(0<i){var a=1!=d.level,p=ci(e,z(n,a?d.from:d.to,a?"after":"before"),"line",t,o);if(yi(p,l,s,!0)&&p.top>s){d=r[i-1]}}return d}function bi(e,t,n,o,r,l,s){var d=fi(e,t,o,s),a=d.begin,c=d.end;if(/\s/.test(t.text.charAt(c-1))){c--}for(var h=null,g=null,u=0,f;u<r.length;u++){f=r[u];if(f.from>=c||f.to<=a){continue}var m=1!=f.level,y=Zt(e,o,m?Math.min(c,f.to)-1:Math.max(a,f.from)).right,x=y<l?l-y+1e9:y-l;if(!h||g>x){h=f;g=x}}if(!h){h=r[r.length-1]}if(h.from<a){h={from:a,to:h.to,level:h.level}}if(h.to>c){h={from:h.from,to:c,level:h.level}}return h}var vs;function Ci(e){if(null!=e.cachedTextHeight){return e.cachedTextHeight}if(null==vs){vs=o("pre");for(var r=0;49>r;++r){vs.appendChild(document.createTextNode("x"));vs.appendChild(o("br"))}vs.appendChild(document.createTextNode("x"))}n(e.measure,vs);var l=vs.offsetHeight/50;if(3<l){e.cachedTextHeight=l}t(e.measure);return l||1}function wi(e){if(null!=e.cachedCharWidth){return e.cachedCharWidth}var t=o("span","xxxxxxxxxx"),i=o("pre",[t]);n(e.measure,i);var r=t.getBoundingClientRect(),l=(r.right-r.left)/10;if(2<l){e.cachedCharWidth=l}return l||10}function Si(e){for(var t=e.display,o={},r={},l=t.gutters.clientLeft,s=t.gutters.firstChild,d=0;s;s=s.nextSibling,++d){o[e.options.gutters[d]]=s.offsetLeft+s.clientLeft+l;r[e.options.gutters[d]]=s.clientWidth}return{fixedPos:Li(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:o,gutterWidth:r,wrapperWidth:t.wrapper.clientWidth}}function Li(e){return e.scroller.getBoundingClientRect().left-e.sizer.getBoundingClientRect().left}function ki(e){var t=Ci(e.display),n=e.options.lineWrapping,o=n&&Math.max(5,e.display.scroller.clientWidth/wi(e.display)-3);return function(r){if(be(e.doc,r)){return 0}var l=0;if(r.widgets){for(var s=0;s<r.widgets.length;s++){if(r.widgets[s].height){l+=r.widgets[s].height}}}if(n){return l+(Math.ceil(r.text.length/o)||1)*t}else{return l+t}}}function Ti(e){var t=e.doc,i=ki(e);t.iter(function(e){var t=i(e);if(t!=e.height){D(e,t)}})}function Ni(t,i,e,n){var o=t.display;if(!e&&"true"==Re(i).getAttribute("cm-not-content")){return null}var r,l,s=o.lineSpace.getBoundingClientRect();try{r=i.clientX-s.left;l=i.clientY-s.top}catch(t){return null}var d=ui(t,r,l),a;if(n&&1==d.xRel&&(a=A(t.doc,d.line).text).length==d.ch){var p=h(a,a.length,t.options.tabSize)-a.length;d=z(d.line,Math.max(0,Math.round((r-Gt(t.display).left)/wi(t.display))-p))}return d}function Oi(e,t){if(t>=e.display.viewTo){return null}t-=e.display.viewFrom;if(0>t){return null}for(var o=e.display.view,r=0;r<o.length;r++){t-=o[r].size;if(0>t){return r}}}function Ai(e){e.display.input.showSelection(e.display.input.prepareSelection())}function Mi(e,t){if(void 0===t)t=!0;for(var n=e.doc,o={},r=o.cursors=document.createDocumentFragment(),l=o.selection=document.createDocumentFragment(),s=0;s<n.sel.ranges.length;s++){if(!t&&s==n.sel.primIndex){continue}var d=n.sel.ranges[s];if(d.from().line>=e.display.viewTo||d.to().line<e.display.viewFrom){continue}var a=d.empty();if(a||e.options.showCursorWhenSelecting){Wi(e,d.head,r)}if(!a){Hi(e,d,l)}}return o}function Wi(e,t,i){var n=ci(e,t,"div",null,null,!e.options.singleCursorHeightPerLine),r=i.appendChild(o("div","\xA0","CodeMirror-cursor"));r.style.left=n.left+"px";r.style.top=n.top+"px";r.style.height=Math.max(0,n.bottom-n.top)*e.options.cursorHeight+"px";if(n.other){var l=i.appendChild(o("div","\xA0","CodeMirror-cursor CodeMirror-secondarycursor"));l.style.display="";l.style.left=n.other.left+"px";l.style.top=n.other.top+"px";l.style.height=.85*(n.other.bottom-n.other.top)+"px"}}function Di(e,t){return e.top-t.top||e.left-t.left}function Hi(e,t,i){var l=e.display,s=e.doc,d=document.createDocumentFragment(),a=Gt(e.display),p=a.left,c=Math.max(l.sizerWidth,Ut(e)-l.sizer.offsetLeft)-a.right,h="ltr"==s.direction;function n(e,t,i,n){if(0>t){t=0}t=Math.round(t);n=Math.round(n);d.appendChild(o("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px;\n                             top: "+t+"px; width: "+(null==i?c-e:i)+"px;\n                             height: "+(n-t)+"px"))}function r(t,o,r){var a=A(s,t),g=a.text.length,u,f;function l(i,n){return pi(e,z(t,i),"div",a,n)}function d(t,i,n){var o=mi(e,a,null,t),r="ltr"==i==("after"==n)?"left":"right",s="after"==n?o.begin:o.end-(/\s/.test(a.text.charAt(o.end-1))?2:1);return l(s,r)[r]}var m=Ne(a,s.direction);ke(m,o||0,null==r?g:r,function(e,t,s,a){var i="ltr"==s,y=l(e,i?"left":"right"),x=l(t-1,i?"right":"left"),v=null==o&&0==e,b=null==r&&t==g,C=0==a,w=!m||a==m.length-1;if(3>=x.top-y.top){var S=(h?v:b)&&C,L=(h?b:v)&&w,k=S?p:(i?y:x).left,T=L?c:(i?x:y).right;n(k,y.top,T-k,y.bottom)}else{var N,O,A,M;if(i){N=h&&v&&C?p:y.left;O=h?c:d(e,s,"before");A=h?p:d(t,s,"after");M=h&&b&&w?c:x.right}else{N=!h?p:d(e,s,"before");O=!h&&v&&C?c:y.right;A=!h&&b&&w?p:x.left;M=!h?c:d(t,s,"after")}n(N,y.top,O-N,y.bottom);if(y.bottom<x.top){n(p,y.bottom,null,x.top)}n(A,x.top,M-A,x.bottom)}if(!u||0>Di(y,u)){u=y}if(0>Di(x,u)){u=x}if(!f||0>Di(y,f)){f=y}if(0>Di(x,f)){f=x}});return{start:u,end:f}}var g=t.from(),u=t.to();if(g.line==u.line){r(g.line,g.ch,u.ch)}else{var f=A(s,g.line),m=A(s,u.line),y=fe(f)==fe(m),x=r(g.line,g.ch,y?f.text.length+1:null).end,v=r(u.line,y?0:null,u.ch).start;if(y){if(x.top<v.top-2){n(x.right,x.top,null,x.bottom);n(p,v.top,v.left,v.bottom)}else{n(x.right,x.top,v.left-x.right,x.bottom)}}if(x.bottom<v.top){n(p,x.bottom,null,v.top)}}i.appendChild(d)}function Fi(e){if(!e.state.focused){return}var t=e.display;clearInterval(t.blinker);var i=!0;t.cursorDiv.style.visibility="";if(0<e.options.cursorBlinkRate){t.blinker=setInterval(function(){return t.cursorDiv.style.visibility=(i=!i)?"":"hidden"},e.options.cursorBlinkRate)}else if(0>e.options.cursorBlinkRate){t.cursorDiv.style.visibility="hidden"}}function Pi(e){if(!e.state.focused){e.display.input.focus();zi(e)}}function Ii(e){e.state.delayingBlurEvent=!0;setTimeout(function(){if(e.state.delayingBlurEvent){e.state.delayingBlurEvent=!1;Ei(e)}},100)}function zi(t,i){if(t.state.delayingBlurEvent){t.state.delayingBlurEvent=!1}if("nocursor"==t.options.readOnly){return}if(!t.state.focused){Me(t,"focus",t,i);t.state.focused=!0;d(t.display.wrapper,"CodeMirror-focused");if(!t.curOp&&t.display.selForContextMenu!=t.doc.sel){t.display.input.reset();if(wl){setTimeout(function(){return t.display.input.reset(!0)},20)}}t.display.input.receivedFocus()}Fi(t)}function Ei(t,i){if(t.state.delayingBlurEvent){return}if(t.state.focused){Me(t,"blur",t,i);t.state.focused=!1;El(t.display.wrapper,"CodeMirror-focused")}clearInterval(t.display.blinker);setTimeout(function(){if(!t.state.focused){t.display.shift=!1}},150)}function Ri(e){for(var t=e.display,n=t.lineDiv.offsetTop,o=0;o<t.view.length;o++){var r=t.view[o],l=void 0;if(r.hidden){continue}if(Cl&&8>ie){var s=r.node.offsetTop+r.node.offsetHeight;l=s-n;n=s}else{var d=r.node.getBoundingClientRect();l=d.bottom-d.top}var a=r.line.height-l;if(2>l){l=Ci(t)}if(.005<a||-.005>a){D(r.line,l);Bi(r.line);if(r.rest){for(var p=0;p<r.rest.length;p++){Bi(r.rest[p])}}}}}function Bi(e){if(e.widgets){for(var t=0;t<e.widgets.length;++t){var n=e.widgets[t],o=n.node.parentNode;if(o){n.height=o.offsetHeight}}}}function Gi(e,t,i){var n=i&&null!=i.top?Math.max(0,i.top):e.scroller.scrollTop;n=Math.floor(n-Rt(e));var o=i&&null!=i.bottom?i.bottom:n+e.wrapper.clientHeight,r=F(t,n),l=F(t,o);if(i&&i.ensure){var s=i.ensure.from.line,d=i.ensure.to.line;if(s<r){r=s;l=F(t,we(A(t,s))+e.wrapper.clientHeight)}else if(Math.min(d,t.lastLine())>=l){r=F(t,we(A(t,d))-e.wrapper.clientHeight);l=d}}return{from:r,to:Math.max(l,r+1)}}function $i(e){var t=e.display,n=t.view;if(!t.alignWidgets&&(!t.gutters.firstChild||!e.options.fixedGutter)){return}for(var o=Li(t)-t.scroller.scrollLeft+e.doc.scrollLeft,r=t.gutters.offsetWidth,l=o+"px",s=0;s<n.length;s++){if(!n[s].hidden){if(e.options.fixedGutter){if(n[s].gutter){n[s].gutter.style.left=l}if(n[s].gutterBackground){n[s].gutterBackground.style.left=l}}var d=n[s].alignable;if(d){for(var a=0;a<d.length;a++){d[a].style.left=l}}}}if(e.options.fixedGutter){t.gutters.style.left=o+r+"px"}}function Ui(e){if(!e.options.lineNumbers){return!1}var t=e.doc,i=I(e.options,t.first+t.size-1),n=e.display;if(i.length!=n.lineNumChars){var r=n.measure.appendChild(o("div",[o("div",i)],"CodeMirror-linenumber CodeMirror-gutter-elt")),l=r.firstChild.offsetWidth,s=r.offsetWidth-l;n.lineGutter.style.width="";n.lineNumInnerWidth=Math.max(l,n.lineGutter.offsetWidth-s)+1;n.lineNumWidth=n.lineNumInnerWidth+s;n.lineNumChars=n.lineNumInnerWidth?i.length:-1;n.lineGutter.style.width=n.lineNumWidth+"px";In(e);return!0}return!1}function ji(e,t){if(We(e,"scrollCursorIntoView")){return}var i=e.display,n=i.sizer.getBoundingClientRect(),r=null;if(0>t.top+n.top){r=!0}else if(t.bottom+n.top>(window.innerHeight||document.documentElement.clientHeight)){r=!1}if(null!=r&&!Ol){var l=o("div","\u200B",null,"position: absolute;\n                         top: "+(t.top-i.viewOffset-Rt(e.display))+"px;\n                         height: "+(t.bottom-t.top+$t(e)+i.barHeight)+"px;\n                         left: "+t.left+"px; width: "+Math.max(2,t.right-t.left)+"px;");e.display.lineSpace.appendChild(l);l.scrollIntoView(r);e.display.lineSpace.removeChild(l)}}function Vi(e,t,i,n){if(null==n){n=0}var o;if(!e.options.lineWrapping&&t==i){t=t.ch?z(t.line,"before"==t.sticky?t.ch-1:t.ch,"after"):t;i="before"==t.sticky?z(t.line,t.ch+1,"before"):t}for(var r=0;5>r;r++){var l=!1,s=ci(e,t),d=!i||i==t?s:ci(e,i);o={left:Math.min(s.left,d.left),top:Math.min(s.top,d.top)-n,right:Math.max(s.left,d.left),bottom:Math.max(s.bottom,d.bottom)+n};var a=Xi(e,o),p=e.doc.scrollTop,c=e.doc.scrollLeft;if(null!=a.scrollTop){en(e,a.scrollTop);if(1<Math.abs(e.doc.scrollTop-p)){l=!0}}if(null!=a.scrollLeft){nn(e,a.scrollLeft);if(1<Math.abs(e.doc.scrollLeft-c)){l=!0}}if(!l){break}}return o}function Ki(e,t){var i=Xi(e,t);if(null!=i.scrollTop){en(e,i.scrollTop)}if(null!=i.scrollLeft){nn(e,i.scrollLeft)}}function Xi(e,t){var i=e.display,n=Ci(e.display);if(0>t.top){t.top=0}var o=e.curOp&&null!=e.curOp.scrollTop?e.curOp.scrollTop:i.scroller.scrollTop,r=jt(e),l={};if(t.bottom-t.top>r){t.bottom=t.top+r}var s=e.doc.height+Bt(i),d=t.top<n,a=t.bottom>s-n;if(t.top<o){l.scrollTop=d?0:t.top}else if(t.bottom>o+r){var p=Math.min(t.top,(a?s:t.bottom)-r);if(p!=o){l.scrollTop=p}}var c=e.curOp&&null!=e.curOp.scrollLeft?e.curOp.scrollLeft:i.scroller.scrollLeft,h=Ut(e)-(e.options.fixedGutter?i.gutters.offsetWidth:0),g=t.right-t.left>h;if(g){t.right=t.left+h}if(10>t.left){l.scrollLeft=0}else if(t.left<c){l.scrollLeft=Math.max(0,t.left-(g?0:10))}else if(t.right>h+c-3){l.scrollLeft=t.right+(g?0:10)-h}return l}function Yi(e,t){if(null==t){return}Qi(e);e.curOp.scrollTop=(null==e.curOp.scrollTop?e.doc.scrollTop:e.curOp.scrollTop)+t}function _i(e){Qi(e);var t=e.getCursor();e.curOp.scrollToPos={from:t,to:t,margin:e.options.cursorScrollMargin}}function qi(e,t,i){if(null!=t||null!=i){Qi(e)}if(null!=t){e.curOp.scrollLeft=t}if(null!=i){e.curOp.scrollTop=i}}function Zi(e,t){Qi(e);e.curOp.scrollToPos=t}function Qi(e){var t=e.curOp.scrollToPos;if(t){e.curOp.scrollToPos=null;var i=hi(e,t.from),n=hi(e,t.to);Ji(e,i,n,t.margin)}}function Ji(e,t,i,n){var o=Xi(e,{left:Math.min(t.left,i.left),top:Math.min(t.top,i.top)-n,right:Math.max(t.right,i.right),bottom:Math.max(t.bottom,i.bottom)+n});qi(e,o.scrollLeft,o.scrollTop)}function en(e,t){if(2>Math.abs(e.doc.scrollTop-t)){return}if(!yl){Fn(e,{top:t})}tn(e,t,!0);if(yl){Fn(e)}Nn(e,100)}function tn(e,t,i){t=Math.min(e.display.scroller.scrollHeight-e.display.scroller.clientHeight,t);if(e.display.scroller.scrollTop==t&&!i){return}e.doc.scrollTop=t;e.display.scrollbars.setScrollTop(t);if(e.display.scroller.scrollTop!=t){e.display.scroller.scrollTop=t}}function nn(e,t,i,n){t=Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth);if((i?t==e.doc.scrollLeft:2>Math.abs(e.doc.scrollLeft-t))&&!n){return}e.doc.scrollLeft=t;$i(e);if(e.display.scroller.scrollLeft!=t){e.display.scroller.scrollLeft=t}e.display.scrollbars.setScrollLeft(t)}function rn(e){var t=e.display,i=t.gutters.offsetWidth,n=Math.round(e.doc.height+Bt(e.display));return{clientHeight:t.scroller.clientHeight,viewHeight:t.wrapper.clientHeight,scrollWidth:t.scroller.scrollWidth,clientWidth:t.scroller.clientWidth,viewWidth:t.wrapper.clientWidth,barLeft:e.options.fixedGutter?i:0,docHeight:n,scrollHeight:n+$t(e)+t.barHeight,nativeBarWidth:t.nativeBarWidth,gutterWidth:i}}var bs=function(e,t,i){this.cm=i;var n=this.vert=o("div",[o("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),r=this.horiz=o("div",[o("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");n.tabIndex=r.tabIndex=-1;e(n);e(r);es(n,"scroll",function(){if(n.clientHeight){t(n.scrollTop,"vertical")}});es(r,"scroll",function(){if(r.clientWidth){t(r.scrollLeft,"horizontal")}});this.checkedZeroWidth=!1;if(Cl&&8>ie){this.horiz.style.minHeight=this.vert.style.minWidth="18px"}};bs.prototype.update=function(e){var t=e.scrollWidth>e.clientWidth+1,i=e.scrollHeight>e.clientHeight+1,n=e.nativeBarWidth;if(i){this.vert.style.display="block";this.vert.style.bottom=t?n+"px":"0";var o=e.viewHeight-(t?n:0);this.vert.firstChild.style.height=Math.max(0,e.scrollHeight-e.clientHeight+o)+"px"}else{this.vert.style.display="";this.vert.firstChild.style.height="0"}if(t){this.horiz.style.display="block";this.horiz.style.right=i?n+"px":"0";this.horiz.style.left=e.barLeft+"px";var r=e.viewWidth-e.barLeft-(i?n:0);this.horiz.firstChild.style.width=Math.max(0,e.scrollWidth-e.clientWidth+r)+"px"}else{this.horiz.style.display="";this.horiz.firstChild.style.width="0"}if(!this.checkedZeroWidth&&0<e.clientHeight){if(0==n){this.zeroWidthHack()}this.checkedZeroWidth=!0}return{right:i?n:0,bottom:t?n:0}};bs.prototype.setScrollLeft=function(e){if(this.horiz.scrollLeft!=e){this.horiz.scrollLeft=e}if(this.disableHoriz){this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")}};bs.prototype.setScrollTop=function(e){if(this.vert.scrollTop!=e){this.vert.scrollTop=e}if(this.disableVert){this.enableZeroWidthBar(this.vert,this.disableVert,"vert")}};bs.prototype.zeroWidthHack=function(){var e=Dl&&!Nl?"12px":"18px";this.horiz.style.height=this.vert.style.width=e;this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none";this.disableHoriz=new Gl;this.disableVert=new Gl};bs.prototype.enableZeroWidthBar=function(e,t,i){e.style.pointerEvents="auto";function n(){var o=e.getBoundingClientRect(),r="vert"==i?document.elementFromPoint(o.right-1,(o.top+o.bottom)/2):document.elementFromPoint((o.right+o.left)/2,o.bottom-1);if(r!=e){e.style.pointerEvents="none"}else{t.set(1e3,n)}}t.set(1e3,n)};bs.prototype.clear=function(){var e=this.horiz.parentNode;e.removeChild(this.horiz);e.removeChild(this.vert)};var Cs=function(){};Cs.prototype.update=function(){return{bottom:0,right:0}};Cs.prototype.setScrollLeft=function(){};Cs.prototype.setScrollTop=function(){};Cs.prototype.clear=function(){};function ln(e,t){if(!t){t=rn(e)}var n=e.display.barWidth,o=e.display.barHeight;sn(e,t);for(var r=0;4>r&&n!=e.display.barWidth||o!=e.display.barHeight;r++){if(n!=e.display.barWidth&&e.options.lineWrapping){Ri(e)}sn(e,rn(e));n=e.display.barWidth;o=e.display.barHeight}}function sn(e,t){var i=e.display,n=i.scrollbars.update(t);i.sizer.style.paddingRight=(i.barWidth=n.right)+"px";i.sizer.style.paddingBottom=(i.barHeight=n.bottom)+"px";i.heightForcer.style.borderBottom=n.bottom+"px solid transparent";if(n.right&&n.bottom){i.scrollbarFiller.style.display="block";i.scrollbarFiller.style.height=n.bottom+"px";i.scrollbarFiller.style.width=n.right+"px"}else{i.scrollbarFiller.style.display=""}if(n.bottom&&e.options.coverGutterNextToScrollbar&&e.options.fixedGutter){i.gutterFiller.style.display="block";i.gutterFiller.style.height=n.bottom+"px";i.gutterFiller.style.width=t.gutterWidth+"px"}else{i.gutterFiller.style.display=""}}var ws={native:bs,null:Cs};function dn(e){if(e.display.scrollbars){e.display.scrollbars.clear();if(e.display.scrollbars.addClass){El(e.display.wrapper,e.display.scrollbars.addClass)}}e.display.scrollbars=new ws[e.options.scrollbarStyle](function(t){e.display.wrapper.insertBefore(t,e.display.scrollbarFiller);es(t,"mousedown",function(){if(e.state.focused){setTimeout(function(){return e.display.input.focus()},0)}});t.setAttribute("cm-not-content","true")},function(t,i){if("horizontal"==i){nn(e,t)}else{en(e,t)}},e);if(e.display.scrollbars.addClass){d(e.display.wrapper,e.display.scrollbars.addClass)}}var Ss=0;function an(e){e.curOp={cm:e,viewChanged:!1,startHeight:e.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++Ss};bt(e.curOp)}function pn(e){var t=e.curOp;if(t){wt(t,function(e){for(var t=0;t<e.ops.length;t++){e.ops[t].cm.curOp=null}cn(e)})}}function cn(e){for(var t=e.ops,n=0;n<t.length;n++){hn(t[n])}for(var o=0;o<t.length;o++){gn(t[o])}for(var r=0;r<t.length;r++){un(t[r])}for(var l=0;l<t.length;l++){fn(t[l])}for(var s=0;s<t.length;s++){mn(t[s])}}function hn(e){var t=e.cm,i=t.display;An(t);if(e.updateMaxLine){Le(t)}e.mustUpdate=e.viewChanged||e.forceUpdate||null!=e.scrollTop||e.scrollToPos&&(e.scrollToPos.from.line<i.viewFrom||e.scrollToPos.to.line>=i.viewTo)||i.maxLineChanged&&t.options.lineWrapping;e.update=e.mustUpdate&&new Ls(t,e.mustUpdate&&{top:e.scrollTop,ensure:e.scrollToPos},e.forceUpdate)}function gn(e){e.updatedDisplay=e.mustUpdate&&Dn(e.cm,e.update)}function un(e){var t=e.cm,i=t.display;if(e.updatedDisplay){Ri(t)}e.barMeasure=rn(t);if(i.maxLineChanged&&!t.options.lineWrapping){e.adjustWidthTo=Yt(t,i.maxLine,i.maxLine.text.length).left+3;t.display.sizerWidth=e.adjustWidthTo;e.barMeasure.scrollWidth=Math.max(i.scroller.clientWidth,i.sizer.offsetLeft+e.adjustWidthTo+$t(t)+t.display.barWidth);e.maxScrollLeft=Math.max(0,i.sizer.offsetLeft+e.adjustWidthTo-Ut(t))}if(e.updatedDisplay||e.selectionChanged){e.preparedSelection=i.input.prepareSelection()}}function fn(e){var t=e.cm;if(null!=e.adjustWidthTo){t.display.sizer.style.minWidth=e.adjustWidthTo+"px";if(e.maxScrollLeft<t.doc.scrollLeft){nn(t,Math.min(t.display.scroller.scrollLeft,e.maxScrollLeft),!0)}t.display.maxLineChanged=!1}var i=e.focus&&e.focus==s();if(e.preparedSelection){t.display.input.showSelection(e.preparedSelection,i)}if(e.updatedDisplay||e.startHeight!=t.doc.height){ln(t,e.barMeasure)}if(e.updatedDisplay){zn(t,e.barMeasure)}if(e.selectionChanged){Fi(t)}if(t.state.focused&&e.updateInput){t.display.input.reset(e.typing)}if(i){Pi(e.cm)}}function mn(e){var t=e.cm,n=t.display,o=t.doc;if(e.updatedDisplay){Hn(t,e.update)}if(null!=n.wheelStartX&&(null!=e.scrollTop||null!=e.scrollLeft||e.scrollToPos)){n.wheelStartX=n.wheelStartY=null}if(null!=e.scrollTop){tn(t,e.scrollTop,e.forceScroll)}if(null!=e.scrollLeft){nn(t,e.scrollLeft,!0,!0)}if(e.scrollToPos){var r=Vi(t,j(o,e.scrollToPos.from),j(o,e.scrollToPos.to),e.scrollToPos.margin);ji(t,r)}var l=e.maybeHiddenMarkers,s=e.maybeUnhiddenMarkers;if(l){for(var d=0;d<l.length;++d){if(!l[d].lines.length){Me(l[d],"hide")}}}if(s){for(var a=0;a<s.length;++a){if(s[a].lines.length){Me(s[a],"unhide")}}}if(n.wrapper.offsetHeight){o.scrollTop=t.display.scroller.scrollTop}if(e.changeObjs){Me(t,"changes",t,e.changeObjs)}if(e.update){e.update.finish()}}function yn(e,t){if(e.curOp){return t()}an(e);try{return t()}finally{pn(e)}}function xn(e,t){return function(){if(e.curOp){return t.apply(e,arguments)}an(e);try{return t.apply(e,arguments)}finally{pn(e)}}}function vn(e){return function(){if(this.curOp){return e.apply(this,arguments)}an(this);try{return e.apply(this,arguments)}finally{pn(this)}}}function bn(e){return function(){var t=this.cm;if(!t||t.curOp){return e.apply(this,arguments)}an(t);try{return e.apply(this,arguments)}finally{pn(t)}}}function Cn(e,t,i,n){if(null==t){t=e.doc.first}if(null==i){i=e.doc.first+e.doc.size}if(!n){n=0}var o=e.display;if(n&&i<o.viewTo&&(null==o.updateLineNumbers||o.updateLineNumbers>t)){o.updateLineNumbers=t}e.curOp.viewChanged=!0;if(t>=o.viewTo){if(ql&&xe(e.doc,t)<o.viewTo){Sn(e)}}else if(i<=o.viewFrom){if(ql&&ve(e.doc,i+n)>o.viewFrom){Sn(e)}else{o.viewFrom+=n;o.viewTo+=n}}else if(t<=o.viewFrom&&i>=o.viewTo){Sn(e)}else if(t<=o.viewFrom){var r=Ln(e,i,i+n,1);if(r){o.view=o.view.slice(r.index);o.viewFrom=r.lineN;o.viewTo+=n}else{Sn(e)}}else if(i>=o.viewTo){var l=Ln(e,t,t,-1);if(l){o.view=o.view.slice(0,l.index);o.viewTo=l.lineN}else{Sn(e)}}else{var s=Ln(e,t,t,-1),d=Ln(e,i,i+n,1);if(s&&d){o.view=o.view.slice(0,s.index).concat(vt(e,s.lineN,d.lineN)).concat(o.view.slice(d.index));o.viewTo+=n}else{Sn(e)}}var a=o.externalMeasured;if(a){if(i<a.lineN){a.lineN+=n}else if(t<a.lineN+a.size){o.externalMeasured=null}}}function wn(e,t,i){e.curOp.viewChanged=!0;var n=e.display,o=e.display.externalMeasured;if(o&&t>=o.lineN&&t<o.lineN+o.size){n.externalMeasured=null}if(t<n.viewFrom||t>=n.viewTo){return}var r=n.view[Oi(e,t)];if(null==r.node){return}var l=r.changes||(r.changes=[]);if(-1==g(l,i)){l.push(i)}}function Sn(e){e.display.viewFrom=e.display.viewTo=e.doc.first;e.display.view=[];e.display.viewOffset=0}function Ln(e,t,o,r){var l=Oi(e,t),s,d=e.display.view;if(!ql||o==e.doc.first+e.doc.size){return{index:l,lineN:o}}for(var a=e.display.viewFrom,p=0;p<l;p++){a+=d[p].size}if(a!=t){if(0<r){if(l==d.length-1){return null}s=a+d[l].size-t;l++}else{s=a-t}t+=s;o+=s}while(xe(e.doc,o)!=o){if(l==(0>r?0:d.length-1)){return null}o+=r*d[l-(0>r?1:0)].size;l+=r}return{index:l,lineN:o}}function kn(e,t,i){var n=e.display,o=n.view;if(0==o.length||t>=n.viewTo||i<=n.viewFrom){n.view=vt(e,t,i);n.viewFrom=t}else{if(n.viewFrom>t){n.view=vt(e,t,n.viewFrom).concat(n.view)}else if(n.viewFrom<t){n.view=n.view.slice(Oi(e,t))}n.viewFrom=t;if(n.viewTo<i){n.view=n.view.concat(vt(e,n.viewTo,i))}else if(n.viewTo>i){n.view=n.view.slice(0,Oi(e,i))}}n.viewTo=i}function Tn(e){for(var t=e.display.view,n=0,o=0,r;o<t.length;o++){r=t[o];if(!r.hidden&&(!r.node||r.changes)){++n}}return n}function Nn(e,t){if(e.doc.highlightFrontier<e.display.viewTo){e.state.highlight.set(t,p(On,e))}}function On(e){var t=e.doc;if(t.highlightFrontier>=e.display.viewTo){return}var n=+new Date+e.options.workTime,o=Je(e,t.highlightFrontier),r=[];t.iter(o.line,Math.min(t.first+t.size,e.display.viewTo+500),function(l){if(o.line>=e.display.viewFrom){var s=l.styles,d=l.text.length>e.options.maxHighlightLength?Ye(t.mode,o.state):null,a=Ze(e,l,o,!0);if(d){o.state=d}l.styles=a.styles;var p=l.styleClasses,c=a.classes;if(c){l.styleClasses=c}else if(p){l.styleClasses=null}for(var h=!s||s.length!=l.styles.length||p!=c&&(!p||!c||p.bgClass!=c.bgClass||p.textClass!=c.textClass),g=0;!h&&g<s.length;++g){h=s[g]!=l.styles[g]}if(h){r.push(o.line)}l.stateAfter=o.save();o.nextLine()}else{if(l.text.length<=e.options.maxHighlightLength){et(e,l.text,o)}l.stateAfter=0==o.line%5?o.save():null;o.nextLine()}if(+new Date>n){Nn(e,e.options.workDelay);return!0}});t.highlightFrontier=o.line;t.modeFrontier=Math.max(t.modeFrontier,o.line);if(r.length){yn(e,function(){for(var t=0;t<r.length;t++){wn(e,r[t],"text")}})}}var Ls=function(e,t,i){var n=e.display;this.viewport=t;this.visible=Gi(n,e.doc,t);this.editorIsHidden=!n.wrapper.offsetWidth;this.wrapperHeight=n.wrapper.clientHeight;this.wrapperWidth=n.wrapper.clientWidth;this.oldDisplayWidth=Ut(e);this.force=i;this.dims=Si(e);this.events=[]};Ls.prototype.signal=function(e,t){if(He(e,t)){this.events.push(arguments)}};Ls.prototype.finish=function(){for(var e=0;e<this.events.length;e++){Me.apply(null,this.events[e])}};function An(e){var t=e.display;if(!t.scrollbarsClipped&&t.scroller.offsetWidth){t.nativeBarWidth=t.scroller.offsetWidth-t.scroller.clientWidth;t.heightForcer.style.height=$t(e)+"px";t.sizer.style.marginBottom=-t.nativeBarWidth+"px";t.sizer.style.borderRightWidth=$t(e)+"px";t.scrollbarsClipped=!0}}function Mn(e){if(e.hasFocus()){return null}var t=s();if(!t||!l(e.display.lineDiv,t)){return null}var i={activeElt:t};if(window.getSelection){var n=window.getSelection();if(n.anchorNode&&n.extend&&l(e.display.lineDiv,n.anchorNode)){i.anchorNode=n.anchorNode;i.anchorOffset=n.anchorOffset;i.focusNode=n.focusNode;i.focusOffset=n.focusOffset}}return i}function Wn(e){if(!e||!e.activeElt||e.activeElt==s()){return}e.activeElt.focus();if(e.anchorNode&&l(document.body,e.anchorNode)&&l(document.body,e.focusNode)){var t=window.getSelection(),i=document.createRange();i.setEnd(e.anchorNode,e.anchorOffset);i.collapse(!1);t.removeAllRanges();t.addRange(i);t.extend(e.focusNode,e.focusOffset)}}function Dn(e,i){var n=e.display,o=e.doc;if(i.editorIsHidden){Sn(e);return!1}if(!i.force&&i.visible.from>=n.viewFrom&&i.visible.to<=n.viewTo&&(null==n.updateLineNumbers||n.updateLineNumbers>=n.viewTo)&&n.renderedView==n.view&&0==Tn(e)){return!1}if(Ui(e)){Sn(e);i.dims=Si(e)}var r=o.first+o.size,l=Math.max(i.visible.from-e.options.viewportMargin,o.first),s=Math.min(r,i.visible.to+e.options.viewportMargin);if(n.viewFrom<l&&20>l-n.viewFrom){l=Math.max(o.first,n.viewFrom)}if(n.viewTo>s&&20>n.viewTo-s){s=Math.min(r,n.viewTo)}if(ql){l=xe(e.doc,l);s=ve(e.doc,s)}var d=l!=n.viewFrom||s!=n.viewTo||n.lastWrapHeight!=i.wrapperHeight||n.lastWrapWidth!=i.wrapperWidth;kn(e,l,s);n.viewOffset=we(A(e.doc,n.viewFrom));e.display.mover.style.top=n.viewOffset+"px";var a=Tn(e);if(!d&&0==a&&!i.force&&n.renderedView==n.view&&(null==n.updateLineNumbers||n.updateLineNumbers>=n.viewTo)){return!1}var p=Mn(e);if(4<a){n.lineDiv.style.display="none"}Pn(e,n.updateLineNumbers,i.dims);if(4<a){n.lineDiv.style.display=""}n.renderedView=n.view;Wn(p);t(n.cursorDiv);t(n.selectionDiv);n.gutters.style.height=n.sizer.style.minHeight=0;if(d){n.lastWrapHeight=i.wrapperHeight;n.lastWrapWidth=i.wrapperWidth;Nn(e,400)}n.updateLineNumbers=null;return!0}function Hn(e,t){for(var i=t.viewport,n=!0;;n=!1){if(!n||!e.options.lineWrapping||t.oldDisplayWidth==Ut(e)){if(i&&null!=i.top){i={top:Math.min(e.doc.height+Bt(e.display)-jt(e),i.top)}}t.visible=Gi(e.display,e.doc,i);if(t.visible.from>=e.display.viewFrom&&t.visible.to<=e.display.viewTo){break}}if(!Dn(e,t)){break}Ri(e);var o=rn(e);Ai(e);ln(e,o);zn(e,o);t.force=!1}t.signal(e,"update",e);if(e.display.viewFrom!=e.display.reportedViewFrom||e.display.viewTo!=e.display.reportedViewTo){t.signal(e,"viewportChange",e,e.display.viewFrom,e.display.viewTo);e.display.reportedViewFrom=e.display.viewFrom;e.display.reportedViewTo=e.display.viewTo}}function Fn(e,t){var i=new Ls(e,t);if(Dn(e,i)){Ri(e);Hn(e,i);var n=rn(e);Ai(e);ln(e,n);zn(e,n);i.finish()}}function Pn(e,n,o){var l=e.display,s=e.options.lineNumbers,d=l.lineDiv,a=d.firstChild;function r(t){var i=t.nextSibling;if(wl&&Dl&&e.display.currentWheelTarget==t){t.style.display="none"}else{t.parentNode.removeChild(t)}return i}for(var p=l.view,c=l.viewFrom,h=0,u;h<p.length;h++){u=p[h];if(u.hidden);else if(!u.node||u.node.parentNode!=d){var f=Ht(e,u,c,o);d.insertBefore(f,a)}else{while(a!=u.node){a=r(a)}var m=s&&null!=n&&n<=c&&u.lineNumber;if(u.changes){if(-1<g(u.changes,"gutter")){m=!1}kt(e,u,c,o)}if(m){t(u.lineNumber);u.lineNumber.appendChild(document.createTextNode(I(e.options,c)))}a=u.node.nextSibling}c+=u.size}while(a){a=r(a)}}function In(e){var t=e.display.gutters.offsetWidth;e.display.sizer.style.marginLeft=t+"px"}function zn(e,t){e.display.sizer.style.minHeight=t.docHeight+"px";e.display.heightForcer.style.top=t.docHeight+"px";e.display.gutters.style.height=t.docHeight+e.display.barHeight+$t(e)+"px"}function En(e){var n=e.display.gutters,r=e.options.gutters;t(n);var l=0;for(;l<r.length;++l){var s=r[l],d=n.appendChild(o("div",null,"CodeMirror-gutter "+s));if("CodeMirror-linenumbers"==s){e.display.lineGutter=d;d.style.width=(e.display.lineNumWidth||1)+"px"}}n.style.display=l?"":"none";In(e)}function Rn(e){var t=g(e.gutters,"CodeMirror-linenumbers");if(-1==t&&e.lineNumbers){e.gutters=e.gutters.concat(["CodeMirror-linenumbers"])}else if(-1<t&&!e.lineNumbers){e.gutters=e.gutters.slice(0);e.gutters.splice(t,1)}}var ks=0,Ts=null;if(Cl){Ts=-.53}else if(yl){Ts=15}else if(Ll){Ts=-.7}else if(Tl){Ts=-1/3}function Bn(t){var e=t.wheelDeltaX,i=t.wheelDeltaY;if(null==e&&t.detail&&t.axis==t.HORIZONTAL_AXIS){e=t.detail}if(null==i&&t.detail&&t.axis==t.VERTICAL_AXIS){i=t.detail}else if(null==i){i=t.wheelDelta}return{x:e,y:i}}function Gn(t){var e=Bn(t);e.x*=Ts;e.y*=Ts;return e}function $n(t,n){var e=Bn(n),o=e.x,r=e.y,l=t.display,s=l.scroller,d=s.scrollWidth>s.clientWidth,a=s.scrollHeight>s.clientHeight;if(!(o&&d||r&&a)){return}if(r&&Dl&&wl){outer:for(var p=n.target,c=l.view;p!=s;p=p.parentNode){for(var h=0;h<c.length;h++){if(c[h].node==p){t.display.currentWheelTarget=p;break outer}}}}if(o&&!yl&&!kl&&null!=Ts){if(r&&a){en(t,Math.max(0,s.scrollTop+r*Ts))}nn(t,Math.max(0,s.scrollLeft+o*Ts));if(!r||r&&a){Pe(n)}l.wheelStartX=null;return}if(r&&null!=Ts){var g=r*Ts,u=t.doc.scrollTop,f=u+l.wrapper.clientHeight;if(0>g){u=Math.max(0,u+g-50)}else{f=Math.min(t.doc.height,f+g+50)}Fn(t,{top:u,bottom:f})}if(20>ks){if(null==l.wheelStartX){l.wheelStartX=s.scrollLeft;l.wheelStartY=s.scrollTop;l.wheelDX=o;l.wheelDY=r;setTimeout(function(){if(null==l.wheelStartX){return}var e=s.scrollLeft-l.wheelStartX,t=s.scrollTop-l.wheelStartY,i=t&&l.wheelDY&&t/l.wheelDY||e&&l.wheelDX&&e/l.wheelDX;l.wheelStartX=l.wheelStartY=null;if(!i){return}Ts=(Ts*ks+i)/(ks+1);++ks},200)}else{l.wheelDX+=o;l.wheelDY+=r}}}var Ns=function(e,t){this.ranges=e;this.primIndex=t};Ns.prototype.primary=function(){return this.ranges[this.primIndex]};Ns.prototype.equals=function(e){if(e==this){return!0}if(e.primIndex!=this.primIndex||e.ranges.length!=this.ranges.length){return!1}for(var t=0;t<this.ranges.length;t++){var n=this.ranges[t],o=e.ranges[t];if(!R(n.anchor,o.anchor)||!R(n.head,o.head)){return!1}}return!0};Ns.prototype.deepCopy=function(){for(var e=[],t=0;t<this.ranges.length;t++){e[t]=new Os(B(this.ranges[t].anchor),B(this.ranges[t].head))}return new Ns(e,this.primIndex)};Ns.prototype.somethingSelected=function(){for(var e=0;e<this.ranges.length;e++){if(!this.ranges[e].empty()){return!0}}return!1};Ns.prototype.contains=function(e,t){if(!t){t=e}for(var n=0,o;n<this.ranges.length;n++){o=this.ranges[n];if(0<=E(t,o.from())&&0>=E(e,o.to())){return n}}return-1};var Os=function(e,t){this.anchor=e;this.head=t};Os.prototype.from=function(){return $(this.anchor,this.head)};Os.prototype.to=function(){return G(this.anchor,this.head)};Os.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch};function Un(e,t,n){var o=e&&e.options.selectionsMayTouch,r=t[n];t.sort(function(e,t){return E(e.from(),t.from())});n=g(t,r);for(var l=1;l<t.length;l++){var s=t[l],d=t[l-1],a=E(d.to(),s.from());if(o&&!s.empty()?0<a:0<=a){var p=$(d.from(),s.from()),c=G(d.to(),s.to()),h=d.empty()?s.from()==s.head:d.from()==d.head;if(l<=n){--n}t.splice(--l,2,new Os(h?c:p,h?p:c))}}return new Ns(t,n)}function jn(e,t){return new Ns([new Os(e,t||e)],0)}function Vn(e){if(!e.text){return e.to}return z(e.from.line+e.text.length-1,y(e.text).length+(1==e.text.length?e.from.ch:0))}function Kn(e,t){if(0>E(e,t.from)){return e}if(0>=E(e,t.to)){return Vn(t)}var i=e.line+t.text.length-(t.to.line-t.from.line)-1,n=e.ch;if(e.line==t.to.line){n+=Vn(t).ch-t.to.ch}return z(i,n)}function Xn(e,t){for(var n=[],o=0,r;o<e.sel.ranges.length;o++){r=e.sel.ranges[o];n.push(new Os(Kn(r.anchor,t),Kn(r.head,t)))}return Un(e.cm,n,e.sel.primIndex)}function Yn(e,t,i){if(e.line==t.line){return z(i.line,e.ch-t.ch+i.ch)}else{return z(i.line+(e.line-t.line),e.ch)}}function _n(e,t,n){for(var o=[],r=z(e.first,0),l=r,s=0;s<t.length;s++){var d=t[s],a=Yn(d.from,r,l),p=Yn(Vn(d),r,l);r=d.to;l=p;if("around"==n){var c=e.sel.ranges[s],h=0>E(c.head,c.anchor);o[s]=new Os(h?p:a,h?a:p)}else{o[s]=new Os(a,a)}}return new Ns(o,e.sel.primIndex)}function qn(e){e.doc.mode=Ke(e.options,e.doc.modeOption);Zn(e)}function Zn(e){e.doc.iter(function(e){if(e.stateAfter){e.stateAfter=null}if(e.styles){e.styles=null}});e.doc.modeFrontier=e.doc.highlightFrontier=e.doc.first;Nn(e,100);e.state.modeGen++;if(e.curOp){Cn(e)}}function Qn(e,t){return 0==t.from.ch&&0==t.to.ch&&""==y(t.text)&&(!e.cm||e.cm.options.wholeLineUpdateBefore)}function Jn(e,t,i,n){function o(e){return i?i[e]:null}function r(e,i,o){dt(e,i,o,n);St(e,"change",e,t)}function l(e,t){for(var r=[],l=e;l<t;++l){r.push(new gs(a[l],o(l),n))}return r}var s=t.from,d=t.to,a=t.text,p=A(e,s.line),c=A(e,d.line),h=y(a),g=o(a.length-1),u=d.line-s.line;if(t.full){e.insert(0,l(0,a.length));e.remove(a.length,e.size-a.length)}else if(Qn(e,t)){var f=l(0,a.length-1);r(c,c.text,g);if(u){e.remove(s.line,u)}if(f.length){e.insert(s.line,f)}}else if(p==c){if(1==a.length){r(p,p.text.slice(0,s.ch)+h+p.text.slice(d.ch),g)}else{var m=l(1,a.length-1);m.push(new gs(h+p.text.slice(d.ch),g,n));r(p,p.text.slice(0,s.ch)+a[0],o(0));e.insert(s.line+1,m)}}else if(1==a.length){r(p,p.text.slice(0,s.ch)+a[0]+c.text.slice(d.ch),o(0));e.remove(s.line+1,u)}else{r(p,p.text.slice(0,s.ch)+a[0],o(0));r(c,h+c.text.slice(d.ch),g);var x=l(1,a.length-1);if(1<u){e.remove(s.line+1,u-1)}e.insert(s.line+1,x)}St(e,"change",e,t)}function eo(e,t,n){function o(e,r,l){if(e.linked){for(var s=0,d;s<e.linked.length;++s){d=e.linked[s];if(d.doc==r){continue}var a=l&&d.sharedHist;if(n&&!a){continue}t(d.doc,a);o(d.doc,e,a)}}}o(e,null,!0)}function to(e,t){if(t.cm){throw new Error("This document is already in use.")}e.doc=t;t.cm=e;Ti(e);qn(e);io(e);if(!e.options.lineWrapping){Le(e)}e.options.mode=t.modeOption;Cn(e)}function io(e){("rtl"==e.doc.direction?d:El)(e.display.lineDiv,"CodeMirror-rtl")}function no(e){yn(e,function(){io(e);Cn(e)})}function oo(e){this.done=[];this.undone=[];this.undoDepth=1/0;this.lastModTime=this.lastSelTime=0;this.lastOp=this.lastSelOp=null;this.lastOrigin=this.lastSelOrigin=null;this.generation=this.maxGeneration=e||1}function ro(e,t){var i={from:B(t.from),to:Vn(t),text:M(e,t.from,t.to)};go(e,i,t.from.line,t.to.line+1);eo(e,function(e){return go(e,i,t.from.line,t.to.line+1)},!0);return i}function lo(e){while(e.length){var t=y(e);if(t.ranges){e.pop()}else{break}}}function so(e,t){if(t){lo(e.done);return y(e.done)}else if(e.done.length&&!y(e.done).ranges){return y(e.done)}else if(1<e.done.length&&!e.done[e.done.length-2].ranges){e.done.pop();return y(e.done)}}function ao(e,t,i,n){var o=e.history;o.undone.length=0;var r=+new Date,l,s;if((o.lastOp==n||o.lastOrigin==t.origin&&t.origin&&("+"==t.origin.charAt(0)&&o.lastModTime>r-(e.cm?e.cm.options.historyEventDelay:500)||"*"==t.origin.charAt(0)))&&(l=so(o,o.lastOp==n))){s=y(l.changes);if(0==E(t.from,t.to)&&0==E(t.from,s.to)){s.to=Vn(t)}else{l.changes.push(ro(e,t))}}else{var d=y(o.done);if(!d||!d.ranges){ho(e.sel,o.done)}l={changes:[ro(e,t)],generation:o.generation};o.done.push(l);while(o.done.length>o.undoDepth){o.done.shift();if(!o.done[0].ranges){o.done.shift()}}}o.done.push(i);o.generation=++o.maxGeneration;o.lastModTime=o.lastSelTime=r;o.lastOp=o.lastSelOp=n;o.lastOrigin=o.lastSelOrigin=t.origin;if(!s){Me(e,"historyAdded")}}function po(e,t,i,n){var o=t.charAt(0);return"*"==o||"+"==o&&i.ranges.length==n.ranges.length&&i.somethingSelected()==n.somethingSelected()&&new Date-e.history.lastSelTime<=(e.cm?e.cm.options.historyEventDelay:500)}function co(e,t,i,n){var o=e.history,r=n&&n.origin;if(i==o.lastSelOp||r&&o.lastSelOrigin==r&&(o.lastModTime==o.lastSelTime&&o.lastOrigin==r||po(e,r,y(o.done),t))){o.done[o.done.length-1]=t}else{ho(t,o.done)}o.lastSelTime=+new Date;o.lastSelOrigin=r;o.lastSelOp=i;if(n&&!1!==n.clearRedo){lo(o.undone)}}function ho(e,t){var i=y(t);if(!(i&&i.ranges&&i.equals(e))){t.push(e)}}function go(e,t,i,o){var r=t["spans_"+e.id],l=0;e.iter(Math.max(e.first,i),Math.min(e.first+e.size,o),function(i){if(i.markedSpans){(r||(r=t["spans_"+e.id]={}))[l]=i.markedSpans}++l})}function uo(e){if(!e){return null}for(var t,n=0;n<e.length;++n){if(e[n].marker.explicitlyCleared){if(!t){t=e.slice(0,n)}}else if(t){t.push(e[n])}}return!t?e:t.length?t:null}function fo(e,t){var n=t["spans_"+e.id];if(!n){return null}for(var o=[],r=0;r<t.text.length;++r){o.push(uo(n[r]))}return o}function mo(e,t){var n=fo(e,t),o=te(e,t);if(!n){return o}if(!o){return n}for(var r=0;r<n.length;++r){var l=n[r],s=o[r];if(l&&s){spans:for(var d=0,a;d<s.length;++d){a=s[d];for(var p=0;p<l.length;++p){if(l[p].marker==a.marker){continue spans}}l.push(a)}}else if(s){n[r]=s}}return n}function yo(e,t,n){for(var o=[],r=0,l;r<e.length;++r){l=e[r];if(l.ranges){o.push(n?Ns.prototype.deepCopy.call(l):l);continue}var s=l.changes,d=[];o.push({changes:d});for(var a=0;a<s.length;++a){var p=s[a],c=void 0;d.push({from:p.from,to:p.to,text:p.text});if(t){for(var h in p){if(c=h.match(/^spans_(\d+)$/)){if(-1<g(t,+c[1])){y(d)[h]=p[h];delete p[h]}}}}}}return o}function xo(e,t,i,n){if(n){var o=e.anchor;if(i){var r=0>E(t,o);if(r!=0>E(i,o)){o=t;t=i}else if(r!=0>E(t,i)){t=i}}return new Os(o,t)}else{return new Os(i||t,t)}}function vo(e,t,i,n,o){if(null==o){o=e.cm&&(e.cm.display.shift||e.extend)}ko(e,new Ns([xo(e.sel.primary(),t,i,o)],0),n)}function bo(e,t,n){for(var o=[],r=e.cm&&(e.cm.display.shift||e.extend),l=0;l<e.sel.ranges.length;l++){o[l]=xo(e.sel.ranges[l],t[l],null,r)}var s=Un(e.cm,o,e.sel.primIndex);ko(e,s,n)}function Co(e,t,i,n){var o=e.sel.ranges.slice(0);o[t]=i;ko(e,Un(e.cm,o,e.sel.primIndex),n)}function wo(e,t,i,n){ko(e,jn(t,i),n)}function So(e,t,i){var n={ranges:t.ranges,update:function update(t){this.ranges=[];for(var n=0;n<t.length;n++){this.ranges[n]=new Os(j(e,t[n].anchor),j(e,t[n].head))}},origin:i&&i.origin};Me(e,"beforeSelectionChange",e,n);if(e.cm){Me(e.cm,"beforeSelectionChange",e.cm,n)}if(n.ranges!=t.ranges){return Un(e.cm,n.ranges,n.ranges.length-1)}else{return t}}function Lo(e,t,i){var n=e.history.done,o=y(n);if(o&&o.ranges){n[n.length-1]=t;To(e,t,i)}else{ko(e,t,i)}}function ko(e,t,i){To(e,t,i);co(e,e.sel,e.cm?e.cm.curOp.id:NaN,i)}function To(e,t,i){if(He(e,"beforeSelectionChange")||e.cm&&He(e.cm,"beforeSelectionChange")){t=So(e,t,i)}var n=i&&i.bias||(0>E(t.primary().head,e.sel.primary().head)?-1:1);No(e,Ao(e,t,n,!0));if(!(i&&!1===i.scroll)&&e.cm){_i(e.cm)}}function No(e,t){if(t.equals(e.sel)){return}e.sel=t;if(e.cm){e.cm.curOp.updateInput=e.cm.curOp.selectionChanged=!0;De(e.cm)}St(e,"cursorActivity",e)}function Oo(e){No(e,Ao(e,e.sel,null,!1))}function Ao(e,t,n,o){for(var r,l=0;l<t.ranges.length;l++){var s=t.ranges[l],d=t.ranges.length==e.sel.ranges.length&&e.sel.ranges[l],a=Wo(e,s.anchor,d&&d.anchor,n,o),p=Wo(e,s.head,d&&d.head,n,o);if(r||a!=s.anchor||p!=s.head){if(!r){r=t.ranges.slice(0,l)}r[l]=new Os(a,p)}}return r?Un(e.cm,r,t.primIndex):t}function Mo(e,t,n,o,r){var l=A(e,t.line);if(l.markedSpans){for(var s=0;s<l.markedSpans.length;++s){var d=l.markedSpans[s],a=d.marker;if((null==d.from||(a.inclusiveLeft?d.from<=t.ch:d.from<t.ch))&&(null==d.to||(a.inclusiveRight?d.to>=t.ch:d.to>t.ch))){if(r){Me(a,"beforeCursorEnter");if(a.explicitlyCleared){if(!l.markedSpans){break}else{--s;continue}}}if(!a.atomic){continue}if(n){var p=a.find(0>o?1:-1),c=void 0;if(0>o?a.inclusiveRight:a.inclusiveLeft){p=Do(e,p,-o,p&&p.line==t.line?l:null)}if(p&&p.line==t.line&&(c=E(p,n))&&(0>o?0>c:0<c)){return Mo(e,p,t,o,r)}}var h=a.find(0>o?-1:1);if(0>o?a.inclusiveLeft:a.inclusiveRight){h=Do(e,h,o,h.line==t.line?l:null)}return h?Mo(e,h,t,o,r):null}}}return t}function Wo(e,t,i,n,o){var r=n||1,l=Mo(e,t,i,r,o)||!o&&Mo(e,t,i,r,!0)||Mo(e,t,i,-r,o)||!o&&Mo(e,t,i,-r,!0);if(!l){e.cantEdit=!0;return z(e.first,0)}return l}function Do(e,t,i,n){if(0>i&&0==t.ch){if(t.line>e.first){return j(e,z(t.line-1))}else{return null}}else if(0<i&&t.ch==(n||A(e,t.line)).text.length){if(t.line<e.first+e.size-1){return z(t.line+1,0)}else{return null}}else{return new z(t.line,t.ch+i)}}function Ho(e){e.setSelection(z(e.firstLine(),0),z(e.lastLine()),Ul)}function Fo(e,t,i){var n={canceled:!1,from:t.from,to:t.to,text:t.text,origin:t.origin,cancel:function cancel(){return n.canceled=!0}};if(i){n.update=function(t,i,o,r){if(t){n.from=j(e,t)}if(i){n.to=j(e,i)}if(o){n.text=o}if(r!==void 0){n.origin=r}}}Me(e,"beforeChange",e,n);if(e.cm){Me(e.cm,"beforeChange",e.cm,n)}if(n.canceled){return null}return{from:n.from,to:n.to,text:n.text,origin:n.origin}}function Po(e,t,n){if(e.cm){if(!e.cm.curOp){return xn(e.cm,Po)(e,t,n)}if(e.cm.state.suppressEdits){return}}if(He(e,"beforeChange")||e.cm&&He(e.cm,"beforeChange")){t=Fo(e,t,!0);if(!t){return}}var o=_l&&!n&&oe(e,t.from,t.to);if(o){for(var r=o.length-1;0<=r;--r){Io(e,{from:o[r].from,to:o[r].to,text:r?[""]:t.text,origin:t.origin})}}else{Io(e,t)}}function Io(e,t){if(1==t.text.length&&""==t.text[0]&&0==E(t.from,t.to)){return}var i=Xn(e,t);ao(e,t,i,e.cm?e.cm.curOp.id:NaN);Ro(e,t,i,te(e,t));var n=[];eo(e,function(e,i){if(!i&&-1==g(n,e.history)){jo(e.history,t);n.push(e.history)}Ro(e,t,null,te(e,t))})}function zo(e,t,n){var o=e.cm&&e.cm.state.suppressEdits;if(o&&!n){return}var r=e.history,l,s=e.sel,d="undo"==t?r.done:r.undone,a="undo"==t?r.undone:r.done,p=0;for(;p<d.length;p++){l=d[p];if(n?l.ranges&&!l.equals(e.sel):!l.ranges){break}}if(p==d.length){return}r.lastOrigin=r.lastSelOrigin=null;for(;;){l=d.pop();if(l.ranges){ho(l,a);if(n&&!l.equals(e.sel)){ko(e,l,{clearRedo:!1});return}s=l}else if(o){d.push(l);return}else{break}}var c=[];ho(s,a);a.push({changes:c,generation:r.generation});r.generation=l.generation||++r.maxGeneration;for(var h=He(e,"beforeChange")||e.cm&&He(e.cm,"beforeChange"),u=function(n){var i=l.changes[n];i.origin=t;if(h&&!Fo(e,i,!1)){d.length=0;return{}}c.push(ro(e,i));var o=n?Xn(e,i):y(d);Ro(e,i,o,mo(e,i));if(!n&&e.cm){e.cm.scrollIntoView({from:i.from,to:Vn(i)})}var r=[];eo(e,function(e,t){if(!t&&-1==g(r,e.history)){jo(e.history,i);r.push(e.history)}Ro(e,i,null,mo(e,i))})},f=l.changes.length-1,m;0<=f;--f){m=u(f);if(m)return m.v}}function Eo(e,t){if(0==t){return}e.first+=t;e.sel=new Ns(x(e.sel.ranges,function(e){return new Os(z(e.anchor.line+t,e.anchor.ch),z(e.head.line+t,e.head.ch))}),e.sel.primIndex);if(e.cm){Cn(e.cm,e.first,e.first-t,t);for(var i=e.cm.display,n=i.viewFrom;n<i.viewTo;n++){wn(e.cm,n,"gutter")}}}function Ro(e,t,i,n){if(e.cm&&!e.cm.curOp){return xn(e.cm,Ro)(e,t,i,n)}if(t.to.line<e.first){Eo(e,t.text.length-1-(t.to.line-t.from.line));return}if(t.from.line>e.lastLine()){return}if(t.from.line<e.first){var o=t.text.length-1-(e.first-t.from.line);Eo(e,o);t={from:z(e.first,0),to:z(t.to.line+o,t.to.ch),text:[y(t.text)],origin:t.origin}}var r=e.lastLine();if(t.to.line>r){t={from:t.from,to:z(r,A(e,r).text.length),text:[t.text[0]],origin:t.origin}}t.removed=M(e,t.from,t.to);if(!i){i=Xn(e,t)}if(e.cm){Bo(e.cm,t,n)}else{Jn(e,t,n)}To(e,i,Ul)}function Bo(e,t,i){var n=e.doc,o=e.display,r=t.from,l=t.to,s=!1,d=r.line;if(!e.options.lineWrapping){d=H(fe(A(n,r.line)));n.iter(d,l.line+1,function(e){if(e==o.maxLine){s=!0;return!0}})}if(-1<n.sel.contains(t.from,t.to)){De(e)}Jn(n,t,i,ki(e));if(!e.options.lineWrapping){n.iter(d,r.line+t.text.length,function(e){var t=Se(e);if(t>o.maxLineLength){o.maxLine=e;o.maxLineLength=t;o.maxLineChanged=!0;s=!1}});if(s){e.curOp.updateMaxLine=!0}}st(n,r.line);Nn(e,400);var a=t.text.length-(l.line-r.line)-1;if(t.full){Cn(e)}else if(r.line==l.line&&1==t.text.length&&!Qn(e.doc,t)){wn(e,r.line,"text")}else{Cn(e,r.line,l.line+1,a)}var p=He(e,"changes"),c=He(e,"change");if(c||p){var h={from:r,to:l,text:t.text,removed:t.removed,origin:t.origin};if(c){St(e,"change",e,h)}if(p){(e.curOp.changeObjs||(e.curOp.changeObjs=[])).push(h)}}e.display.selForContextMenu=null}function Go(e,t,i,n,o){var r;if(!n){n=i}if(0>E(n,i)){r=[n,i],i=r[0],n=r[1]}if("string"==typeof t){t=e.splitLines(t)}Po(e,{from:i,to:n,text:t,origin:o})}function $o(e,t,i,n){if(i<e.line){e.line+=n}else if(t<e.line){e.line=t;e.ch=0}}function Uo(e,t,n,o){for(var r=0;r<e.length;++r){var l=e[r],s=!0;if(l.ranges){if(!l.copied){l=e[r]=l.deepCopy();l.copied=!0}for(var d=0;d<l.ranges.length;d++){$o(l.ranges[d].anchor,t,n,o);$o(l.ranges[d].head,t,n,o)}continue}for(var a=0,p;a<l.changes.length;++a){p=l.changes[a];if(n<p.from.line){p.from=z(p.from.line+o,p.from.ch);p.to=z(p.to.line+o,p.to.ch)}else if(t<=p.to.line){s=!1;break}}if(!s){e.splice(0,r+1);r=0}}}function jo(e,t){var i=t.from.line,n=t.to.line,o=t.text.length-(n-i)-1;Uo(e.done,i,n,o);Uo(e.undone,i,n,o)}function Vo(e,t,i,n){var o=t,r=t;if("number"==typeof t){r=A(e,U(e,t))}else{o=H(t)}if(null==o){return null}if(n(r,o)&&e.cm){wn(e.cm,o,i)}return r}function Ko(e){this.lines=e;this.parent=null;for(var t=0,n=0;n<e.length;++n){e[n].parent=this;t+=e[n].height}this.height=t}Ko.prototype={chunkSize:function chunkSize(){return this.lines.length},removeInner:function removeInner(e,t){for(var n=e,o;n<e+t;++n){o=this.lines[n];this.height-=o.height;at(o);St(o,"delete")}this.lines.splice(e,t)},collapse:function collapse(e){e.push.apply(e,this.lines)},insertInner:function insertInner(e,t,n){this.height+=n;this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var o=0;o<t.length;++o){t[o].parent=this}},iterN:function iterN(t,i,n){for(var o=t+i;t<o;++t){if(n(this.lines[t])){return!0}}}};function Xo(e){this.children=e;for(var t=0,n=0,o=0,r;o<e.length;++o){r=e[o];t+=r.chunkSize();n+=r.height;r.parent=this}this.size=t;this.height=n;this.parent=null}Xo.prototype={chunkSize:function chunkSize(){return this.size},removeInner:function removeInner(e,t){this.size-=t;for(var o=0;o<this.children.length;++o){var r=this.children[o],l=r.chunkSize();if(e<l){var s=Math.min(t,l-e),d=r.height;r.removeInner(e,s);this.height-=d-r.height;if(l==s){this.children.splice(o--,1);r.parent=null}if(0==(t-=s)){break}e=0}else{e-=l}}if(25>this.size-t&&(1<this.children.length||!(this.children[0]instanceof Ko))){var a=[];this.collapse(a);this.children=[new Ko(a)];this.children[0].parent=this}},collapse:function collapse(e){for(var t=0;t<this.children.length;++t){this.children[t].collapse(e)}},insertInner:function insertInner(e,t,n){this.size+=t.length;this.height+=n;for(var o=0;o<this.children.length;++o){var r=this.children[o],l=r.chunkSize();if(e<=l){r.insertInner(e,t,n);if(r.lines&&50<r.lines.length){for(var s=r.lines.length%25+25,d=s,a;d<r.lines.length;){a=new Ko(r.lines.slice(d,d+=25));r.height-=a.height;this.children.splice(++o,0,a);a.parent=this}r.lines=r.lines.slice(0,s);this.maybeSpill()}break}e-=l}},maybeSpill:function maybeSpill(){if(10>=this.children.length){return}var e=this;do{var t=e.children.splice(e.children.length-5,5),i=new Xo(t);if(!e.parent){var n=new Xo(e.children);n.parent=e;e.children=[n,i];e=n}else{e.size-=i.size;e.height-=i.height;var o=g(e.parent.children,e);e.parent.children.splice(o+1,0,i)}i.parent=e.parent}while(10<e.children.length);e.parent.maybeSpill()},iterN:function iterN(e,t,o){for(var r=0;r<this.children.length;++r){var l=this.children[r],s=l.chunkSize();if(e<s){var d=Math.min(t,s-e);if(l.iterN(e,d,o)){return!0}if(0==(t-=d)){break}e=0}else{e-=s}}}};var As=function(e,t,i){if(i){for(var n in i){if(i.hasOwnProperty(n)){this[n]=i[n]}}}this.doc=e;this.node=t};As.prototype.clear=function(){var e=this.doc.cm,t=this.line.widgets,n=this.line,o=H(n);if(null==o||!t){return}for(var r=0;r<t.length;++r){if(t[r]==this){t.splice(r--,1)}}if(!t.length){n.widgets=null}var l=zt(this);D(n,Math.max(0,n.height-l));if(e){yn(e,function(){Yo(e,n,-l);wn(e,o,"widget")});St(e,"lineWidgetCleared",e,this,o)}};As.prototype.changed=function(){var e=this,t=this.height,i=this.doc.cm,n=this.line;this.height=null;var o=zt(this)-t;if(!o){return}if(!be(this.doc,n)){D(n,n.height+o)}if(i){yn(i,function(){i.curOp.forceUpdate=!0;Yo(i,n,o);St(i,"lineWidgetChanged",i,e,H(n))})}};Fe(As);function Yo(e,t,i){if(we(t)<(e.curOp&&e.curOp.scrollTop||e.doc.scrollTop)){Yi(e,i)}}function _o(e,t,i,n){var o=new As(e,i,n),r=e.cm;if(r&&o.noHScroll){r.display.alignWidgets=!0}Vo(e,t,"widget",function(t){var i=t.widgets||(t.widgets=[]);if(null==o.insertAt){i.push(o)}else{i.splice(Math.min(i.length-1,Math.max(0,o.insertAt)),0,o)}o.line=t;if(r&&!be(e,t)){var n=we(t)<e.scrollTop;D(t,t.height+zt(o));if(n){Yi(r,o.height)}r.curOp.forceUpdate=!0}return!0});if(r){St(r,"lineWidgetAdded",r,o,"number"==typeof t?t:H(t))}return o}var Ms=0,Ws=function(e,t){this.lines=[];this.type=t;this.doc=e;this.id=++Ms};Ws.prototype.clear=function(){if(this.explicitlyCleared){return}var e=this.doc.cm,t=e&&!e.curOp;if(t){an(e)}if(He(this,"clear")){var n=this.find();if(n){St(this,"clear",n.from,n.to)}}for(var o=null,r=null,l=0;l<this.lines.length;++l){var s=this.lines[l],d=q(s.markedSpans,this);if(e&&!this.collapsed){wn(e,H(s),"text")}else if(e){if(null!=d.to){r=H(s)}if(null!=d.from){o=H(s)}}s.markedSpans=Z(s.markedSpans,d);if(null==d.from&&this.collapsed&&!be(this.doc,s)&&e){D(s,Ci(e.display))}}if(e&&this.collapsed&&!e.options.lineWrapping){for(var a=0;a<this.lines.length;++a){var p=fe(this.lines[a]),c=Se(p);if(c>e.display.maxLineLength){e.display.maxLine=p;e.display.maxLineLength=c;e.display.maxLineChanged=!0}}}if(null!=o&&e&&this.collapsed){Cn(e,o,r+1)}this.lines.length=0;this.explicitlyCleared=!0;if(this.atomic&&this.doc.cantEdit){this.doc.cantEdit=!1;if(e){Oo(e.doc)}}if(e){St(e,"markerCleared",e,this,o,r)}if(t){pn(e)}if(this.parent){this.parent.clear()}};Ws.prototype.find=function(e,t){if(null==e&&"bookmark"==this.type){e=1}for(var n,o,r=0;r<this.lines.length;++r){var l=this.lines[r],s=q(l.markedSpans,this);if(null!=s.from){n=z(t?l:H(l),s.from);if(-1==e){return n}}if(null!=s.to){o=z(t?l:H(l),s.to);if(1==e){return o}}}return n&&{from:n,to:o}};Ws.prototype.changed=function(){var e=this,t=this.find(-1,!0),i=this,n=this.doc.cm;if(!t||!n){return}yn(n,function(){var o=t.line,r=H(t.line),l=_t(n,r);if(l){ii(l);n.curOp.selectionChanged=n.curOp.forceUpdate=!0}n.curOp.updateMaxLine=!0;if(!be(i.doc,o)&&null!=i.height){var s=i.height;i.height=null;var d=zt(i)-s;if(d){D(o,o.height+d)}}St(n,"markerChanged",n,e)})};Ws.prototype.attachLine=function(e){if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;if(!t.maybeHiddenMarkers||-1==g(t.maybeHiddenMarkers,this)){(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}}this.lines.push(e)};Ws.prototype.detachLine=function(e){this.lines.splice(g(this.lines,e),1);if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)}};Fe(Ws);function qo(e,t,n,o,l){if(o&&o.shared){return Zo(e,t,n,o,l)}if(e.cm&&!e.cm.curOp){return xn(e.cm,qo)(e,t,n,o,l)}var s=new Ws(e,l),d=E(t,n);if(o){c(o,s,!1)}if(0<d||0==d&&!1!==s.clearWhenEmpty){return s}if(s.replacedWith){s.collapsed=!0;s.widgetNode=r("span",[s.replacedWith],"CodeMirror-widget");if(!o.handleMouseEvents){s.widgetNode.setAttribute("cm-ignore-events","true")}if(o.insertLeft){s.widgetNode.insertLeft=!0}}if(s.collapsed){if(ue(e,t.line,t,n,s)||t.line!=n.line&&ue(e,n.line,t,n,s)){throw new Error("Inserting collapsed marker partially overlapping an existing one")}Y()}if(s.addToHistory){ao(e,{from:t,to:n,origin:"markText"},e.sel,NaN)}var a=t.line,p=e.cm,h;e.iter(a,n.line+1,function(e){if(p&&s.collapsed&&!p.options.lineWrapping&&fe(e)==p.display.maxLine){h=!0}if(s.collapsed&&a!=t.line){D(e,0)}Q(e,new _(s,a==t.line?t.ch:null,a==n.line?n.ch:null));++a});if(s.collapsed){e.iter(t.line,n.line+1,function(t){if(be(e,t)){D(t,0)}})}if(s.clearOnEnter){es(s,"beforeCursorEnter",function(){return s.clear()})}if(s.readOnly){X();if(e.history.done.length||e.history.undone.length){e.clearHistory()}}if(s.collapsed){s.id=++Ms;s.atomic=!0}if(p){if(h){p.curOp.updateMaxLine=!0}if(s.collapsed){Cn(p,t.line,n.line+1)}else if(s.className||s.title||s.startStyle||s.endStyle||s.css){for(var g=t.line;g<=n.line;g++){wn(p,g,"text")}}if(s.atomic){Oo(p.doc)}St(p,"markerAdded",p,s)}return s}var Ds=function(e,t){this.markers=e;this.primary=t;for(var n=0;n<e.length;++n){e[n].parent=this}};Ds.prototype.clear=function(){if(this.explicitlyCleared){return}this.explicitlyCleared=!0;for(var e=0;e<this.markers.length;++e){this.markers[e].clear()}St(this,"clear")};Ds.prototype.find=function(e,t){return this.primary.find(e,t)};Fe(Ds);function Zo(e,t,n,o,r){o=c(o);o.shared=!1;var l=[qo(e,t,n,o,r)],s=l[0],d=o.widgetNode;eo(e,function(e){if(d){o.widgetNode=d.cloneNode(!0)}l.push(qo(e,j(e,t),j(e,n),o,r));for(var a=0;a<e.linked.length;++a){if(e.linked[a].isParent){return}}s=y(l)});return new Ds(l,s)}function Qo(e){return e.findMarks(z(e.first,0),e.clipPos(z(e.lastLine())),function(e){return e.parent})}function Jo(e,t){for(var n=0;n<t.length;n++){var o=t[n],r=o.find(),l=e.clipPos(r.from),s=e.clipPos(r.to);if(E(l,s)){var d=qo(e,l,s,o.primary,o.primary.type);o.markers.push(d);d.parent=o}}}function er(e){for(var t=function(t){var i=e[t],n=[i.primary.doc];eo(i.primary.doc,function(e){return n.push(e)});for(var o=0,r;o<i.markers.length;o++){r=i.markers[o];if(-1==g(n,r.doc)){r.parent=null;i.markers.splice(o--,1)}}},n=0;n<e.length;n++){t(n)}}var Hs=0,Fs=function(e,t,i,n,o){if(!(this instanceof Fs)){return new Fs(e,t,i,n,o)}if(null==i){i=0}Xo.call(this,[new Ko([new gs("",null)])]);this.first=i;this.scrollTop=this.scrollLeft=0;this.cantEdit=!1;this.cleanGeneration=1;this.modeFrontier=this.highlightFrontier=i;var r=z(i,0);this.sel=jn(r);this.history=new oo(null);this.id=++Hs;this.modeOption=t;this.lineSep=n;this.direction="rtl"==o?"rtl":"ltr";this.extend=!1;if("string"==typeof e){e=this.splitLines(e)}Jn(this,{from:r,to:r,text:e});ko(this,jn(r),Ul)};Fs.prototype=C(Xo.prototype,{constructor:Fs,iter:function iter(e,t,i){if(i){this.iterN(e-this.first,t-e,i)}else{this.iterN(this.first,this.first+this.size,e)}},insert:function insert(e,t){for(var n=0,o=0;o<t.length;++o){n+=t[o].height}this.insertInner(e-this.first,t,n)},remove:function remove(e,t){this.removeInner(e-this.first,t)},getValue:function getValue(e){var t=W(this,this.first,this.first+this.size);if(!1===e){return t}return t.join(e||this.lineSeparator())},setValue:bn(function(e){var t=z(this.first,0),i=this.first+this.size-1;Po(this,{from:t,to:z(i,A(this,i).text.length),text:this.splitLines(e),origin:"setValue",full:!0},!0);if(this.cm){qi(this.cm,0,0)}ko(this,jn(t),Ul)}),replaceRange:function replaceRange(e,t,i,n){t=j(this,t);i=i?j(this,i):t;Go(this,e,t,i,n)},getRange:function getRange(e,t,i){var n=M(this,j(this,e),j(this,t));if(!1===i){return n}return n.join(i||this.lineSeparator())},getLine:function(e){var t=this.getLineHandle(e);return t&&t.text},getLineHandle:function getLineHandle(e){if(P(this,e)){return A(this,e)}},getLineNumber:function getLineNumber(e){return H(e)},getLineHandleVisualStart:function getLineHandleVisualStart(e){if("number"==typeof e){e=A(this,e)}return fe(e)},lineCount:function lineCount(){return this.size},firstLine:function firstLine(){return this.first},lastLine:function lastLine(){return this.first+this.size-1},clipPos:function clipPos(e){return j(this,e)},getCursor:function getCursor(e){var t=this.sel.primary(),i;if(null==e||"head"==e){i=t.head}else if("anchor"==e){i=t.anchor}else if("end"==e||"to"==e||!1===e){i=t.to()}else{i=t.from()}return i},listSelections:function listSelections(){return this.sel.ranges},somethingSelected:function somethingSelected(){return this.sel.somethingSelected()},setCursor:bn(function(e,t,i){wo(this,j(this,"number"==typeof e?z(e,t||0):e),null,i)}),setSelection:bn(function(e,t,i){wo(this,j(this,e),j(this,t||e),i)}),extendSelection:bn(function(e,t,i){vo(this,j(this,e),t&&j(this,t),i)}),extendSelections:bn(function(e,t){bo(this,K(this,e),t)}),extendSelectionsBy:bn(function(e,t){var i=x(this.sel.ranges,e);bo(this,K(this,i),t)}),setSelections:bn(function(e,t,n){if(!e.length){return}for(var o=[],r=0;r<e.length;r++){o[r]=new Os(j(this,e[r].anchor),j(this,e[r].head))}if(null==t){t=Math.min(e.length-1,this.sel.primIndex)}ko(this,Un(this.cm,o,t),n)}),addSelection:bn(function(e,t,i){var n=this.sel.ranges.slice(0);n.push(new Os(j(this,e),j(this,t||e)));ko(this,Un(this.cm,n,n.length-1),i)}),getSelection:function getSelection(e){for(var t=this.sel.ranges,n,o=0,r;o<t.length;o++){r=M(this,t[o].from(),t[o].to());n=n?n.concat(r):r}if(!1===e){return n}else{return n.join(e||this.lineSeparator())}},getSelections:function getSelections(e){for(var t=[],n=this.sel.ranges,o=0,r;o<n.length;o++){r=M(this,n[o].from(),n[o].to());if(!1!==e){r=r.join(e||this.lineSeparator())}t[o]=r}return t},replaceSelection:function replaceSelection(e,t,n){for(var o=[],r=0;r<this.sel.ranges.length;r++){o[r]=e}this.replaceSelections(o,t,n||"+input")},replaceSelections:bn(function(e,t,n){for(var o=[],r=this.sel,l=0,s;l<r.ranges.length;l++){s=r.ranges[l];o[l]={from:s.from(),to:s.to(),text:this.splitLines(e[l]),origin:n}}for(var d=t&&"end"!=t&&_n(this,o,t),a=o.length-1;0<=a;a--){Po(this,o[a])}if(d){Lo(this,d)}else if(this.cm){_i(this.cm)}}),undo:bn(function(){zo(this,"undo")}),redo:bn(function(){zo(this,"redo")}),undoSelection:bn(function(){zo(this,"undo",!0)}),redoSelection:bn(function(){zo(this,"redo",!0)}),setExtending:function setExtending(e){this.extend=e},getExtending:function getExtending(){return this.extend},historySize:function historySize(){for(var e=this.history,t=0,n=0,o=0;o<e.done.length;o++){if(!e.done[o].ranges){++t}}for(var r=0;r<e.undone.length;r++){if(!e.undone[r].ranges){++n}}return{undo:t,redo:n}},clearHistory:function clearHistory(){this.history=new oo(this.history.maxGeneration)},markClean:function markClean(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function changeGeneration(e){if(e){this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null}return this.history.generation},isClean:function isClean(e){return this.history.generation==(e||this.cleanGeneration)},getHistory:function getHistory(){return{done:yo(this.history.done),undone:yo(this.history.undone)}},setHistory:function setHistory(e){var t=this.history=new oo(this.history.maxGeneration);t.done=yo(e.done.slice(0),null,!0);t.undone=yo(e.undone.slice(0),null,!0)},setGutterMarker:bn(function(e,t,i){return Vo(this,e,"gutter",function(e){var n=e.gutterMarkers||(e.gutterMarkers={});n[t]=i;if(!i&&L(n)){e.gutterMarkers=null}return!0})}),clearGutter:bn(function(e){var t=this;this.iter(function(i){if(i.gutterMarkers&&i.gutterMarkers[e]){Vo(t,i,"gutter",function(){i.gutterMarkers[e]=null;if(L(i.gutterMarkers)){i.gutterMarkers=null}return!0})}})}),lineInfo:function lineInfo(e){var t;if("number"==typeof e){if(!P(this,e)){return null}t=e;e=A(this,e);if(!e){return null}}else{t=H(e);if(null==t){return null}}return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},addLineClass:bn(function(t,i,n){return Vo(this,t,"gutter"==i?"gutter":"class",function(t){var o="text"==i?"textClass":"background"==i?"bgClass":"gutter"==i?"gutterClass":"wrapClass";if(!t[o]){t[o]=n}else if(e(n).test(t[o])){return!1}else{t[o]+=" "+n}return!0})}),removeLineClass:bn(function(t,i,n){return Vo(this,t,"gutter"==i?"gutter":"class",function(t){var o="text"==i?"textClass":"background"==i?"bgClass":"gutter"==i?"gutterClass":"wrapClass",r=t[o];if(!r){return!1}else if(null==n){t[o]=null}else{var l=r.match(e(n));if(!l){return!1}var s=l.index+l[0].length;t[o]=r.slice(0,l.index)+(!l.index||s==r.length?"":" ")+r.slice(s)||null}return!0})}),addLineWidget:bn(function(e,t,i){return _o(this,e,t,i)}),removeLineWidget:function removeLineWidget(e){e.clear()},markText:function markText(e,t,i){return qo(this,j(this,e),j(this,t),i,i&&i.type||"range")},setBookmark:function setBookmark(e,t){var i={replacedWith:t&&(null==t.nodeType?t.widget:t),insertLeft:t&&t.insertLeft,clearWhenEmpty:!1,shared:t&&t.shared,handleMouseEvents:t&&t.handleMouseEvents};e=j(this,e);return qo(this,e,e,i,"bookmark")},findMarksAt:function findMarksAt(e){e=j(this,e);var t=[],n=A(this,e.line).markedSpans;if(n){for(var o=0,r;o<n.length;++o){r=n[o];if((null==r.from||r.from<=e.ch)&&(null==r.to||r.to>=e.ch)){t.push(r.marker.parent||r.marker)}}}return t},findMarks:function findMarks(e,t,n){e=j(this,e);t=j(this,t);var o=[],r=e.line;this.iter(e.line,t.line+1,function(l){var s=l.markedSpans;if(s){for(var d=0,a;d<s.length;d++){a=s[d];if(!(null!=a.to&&r==e.line&&e.ch>=a.to||null==a.from&&r!=e.line||null!=a.from&&r==t.line&&a.from>=t.ch)&&(!n||n(a.marker))){o.push(a.marker.parent||a.marker)}}}++r});return o},getAllMarks:function getAllMarks(){var e=[];this.iter(function(t){var n=t.markedSpans;if(n){for(var o=0;o<n.length;++o){if(null!=n[o].from){e.push(n[o].marker)}}}});return e},posFromIndex:function posFromIndex(e){var t,i=this.first,n=this.lineSeparator().length;this.iter(function(o){var r=o.text.length+n;if(r>e){t=e;return!0}e-=r;++i});return j(this,z(i,t))},indexFromPos:function indexFromPos(e){e=j(this,e);var t=e.ch;if(e.line<this.first||0>e.ch){return 0}var i=this.lineSeparator().length;this.iter(this.first,e.line,function(e){t+=e.text.length+i});return t},copy:function copy(e){var t=new Fs(W(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);t.scrollTop=this.scrollTop;t.scrollLeft=this.scrollLeft;t.sel=this.sel;t.extend=!1;if(e){t.history.undoDepth=this.history.undoDepth;t.setHistory(this.getHistory())}return t},linkedDoc:function linkedDoc(e){if(!e){e={}}var t=this.first,i=this.first+this.size;if(null!=e.from&&e.from>t){t=e.from}if(null!=e.to&&e.to<i){i=e.to}var n=new Fs(W(this,t,i),e.mode||this.modeOption,t,this.lineSep,this.direction);if(e.sharedHist){n.history=this.history}(this.linked||(this.linked=[])).push({doc:n,sharedHist:e.sharedHist});n.linked=[{doc:this,isParent:!0,sharedHist:e.sharedHist}];Jo(n,Qo(this));return n},unlinkDoc:function unlinkDoc(e){if(e instanceof Zr){e=e.doc}if(this.linked){for(var t=0,n;t<this.linked.length;++t){n=this.linked[t];if(n.doc!=e){continue}this.linked.splice(t,1);e.unlinkDoc(this);er(Qo(this));break}}if(e.history==this.history){var o=[e.id];eo(e,function(e){return o.push(e.id)},!0);e.history=new oo(null);e.history.done=yo(this.history.done,o);e.history.undone=yo(this.history.undone,o)}},iterLinkedDocs:function iterLinkedDocs(e){eo(this,e)},getMode:function(){return this.mode},getEditor:function getEditor(){return this.cm},splitLines:function splitLines(e){if(this.lineSep){return e.split(this.lineSep)}return is(e)},lineSeparator:function lineSeparator(){return this.lineSep||"\n"},setDirection:bn(function(e){if("rtl"!=e){e="ltr"}if(e==this.direction){return}this.direction=e;this.iter(function(e){return e.order=null});if(this.cm){no(this.cm)}})});Fs.prototype.eachLine=Fs.prototype.iter;var Ps=0;function tr(t){var e=this;or(e);if(We(e,t)||Et(e.display,t)){return}Pe(t);if(Cl){Ps=+new Date}var o=Ni(e,t,!0),r=t.dataTransfer.files;if(!o||e.isReadOnly()){return}if(r&&r.length&&window.FileReader&&window.File){for(var l=r.length,n=Array(l),s=0,d=function(t,r){if(e.options.allowDropFileTypes&&-1==g(e.options.allowDropFileTypes,t.type)){return}var i=new FileReader;i.onload=xn(e,function(){var t=i.result;if(/[\x00-\x08\x0e-\x1f]{2}/.test(t)){t=""}n[r]=t;if(++s==l){o=j(e.doc,o);var d={from:o,to:o,text:e.doc.splitLines(n.join(e.doc.lineSeparator())),origin:"paste"};Po(e.doc,d);Lo(e.doc,jn(o,Vn(d)))}});i.readAsText(t)},a=0;a<l;++a){d(r[a],a)}}else{if(e.state.draggingText&&-1<e.doc.sel.contains(o)){e.state.draggingText(t);setTimeout(function(){return e.display.input.focus()},20);return}try{var p=t.dataTransfer.getData("Text");if(p){var c;if(e.state.draggingText&&!e.state.draggingText.copy){c=e.listSelections()}To(e.doc,jn(o,o));if(c){for(var h=0;h<c.length;++h){Go(e.doc,"",c[h].anchor,c[h].head,"drag")}}e.replaceSelection(p,"around","paste");e.display.input.focus()}}catch(t){}}}function ir(t,i){if(Cl&&(!t.state.draggingText||100>+new Date-Ps)){Ee(i);return}if(We(t,i)||Et(t.display,i)){return}i.dataTransfer.setData("Text",t.getSelection());i.dataTransfer.effectAllowed="copyMove";if(i.dataTransfer.setDragImage&&!Tl){var e=o("img",null,null,"position: fixed; left: 0; top: 0;");e.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";if(kl){e.width=e.height=1;t.display.wrapper.appendChild(e);e._top=e.offsetTop}i.dataTransfer.setDragImage(e,0,0);if(kl){e.parentNode.removeChild(e)}}}function nr(t,i){var e=Ni(t,i);if(!e){return}var r=document.createDocumentFragment();Wi(t,e,r);if(!t.display.dragCursor){t.display.dragCursor=o("div",null,"CodeMirror-cursors CodeMirror-dragcursors");t.display.lineSpace.insertBefore(t.display.dragCursor,t.display.cursorDiv)}n(t.display.dragCursor,r)}function or(e){if(e.display.dragCursor){e.display.lineSpace.removeChild(e.display.dragCursor);e.display.dragCursor=null}}function rr(e){if(!document.getElementsByClassName){return}for(var t=document.getElementsByClassName("CodeMirror"),n=0,o;n<t.length;n++){o=t[n].CodeMirror;if(o){e(o)}}}var Is=!1;function lr(){if(Is){return}sr();Is=!0}function sr(){var e;es(window,"resize",function(){if(null==e){e=setTimeout(function(){e=null;rr(dr)},100)}});es(window,"blur",function(){return rr(Ei)})}function dr(e){var t=e.display;t.cachedCharWidth=t.cachedTextHeight=t.cachedPaddingH=null;t.scrollbarsClipped=!1;e.setSize()}for(var zs={3:"Pause",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",127:"Delete",145:"ScrollLock",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},Es=0;10>Es;Es++){zs[Es+48]=zs[Es+96]=Es+""}for(var Rs=65;90>=Rs;Rs++){zs[Rs]=String.fromCharCode(Rs)}for(var Bs=1;12>=Bs;Bs++){zs[Bs+111]=zs[Bs+63235]="F"+Bs}var Gs={basic:{Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},pcDefault:{"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},emacsy:{"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},macDefault:{"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]}};Gs["default"]=Dl?Gs.macDefault:Gs.pcDefault;function ar(e){var t=e.split(/-(?!$)/);e=t[t.length-1];for(var n,o,r,l,s=0,d;s<t.length-1;s++){d=t[s];if(/^(cmd|meta|m)$/i.test(d)){l=!0}else if(/^a(lt)?$/i.test(d)){n=!0}else if(/^(c|ctrl|control)$/i.test(d)){o=!0}else if(/^s(hift)?$/i.test(d)){r=!0}else{throw new Error("Unrecognized modifier name: "+d)}}if(n){e="Alt-"+e}if(o){e="Ctrl-"+e}if(l){e="Cmd-"+e}if(r){e="Shift-"+e}return e}function pr(e){var t={};for(var n in e){if(e.hasOwnProperty(n)){var o=e[n];if(/^(name|fallthrough|(de|at)tach)$/.test(n)){continue}if("..."==o){delete e[n];continue}for(var r=x(n.split(" "),ar),l=0;l<r.length;l++){var s=void 0,d=void 0;if(l==r.length-1){d=r.join(" ");s=o}else{d=r.slice(0,l+1).join(" ");s="..."}var a=t[d];if(!a){t[d]=s}else if(a!=s){throw new Error("Inconsistent bindings for "+d)}}delete e[n]}}for(var p in t){e[p]=t[p]}return e}function cr(e,t,n,o){t=fr(t);var r=t.call?t.call(e,o):t[e];if(!1===r){return"nothing"}if("..."===r){return"multi"}if(null!=r&&n(r)){return"handled"}if(t.fallthrough){if("[object Array]"!=Object.prototype.toString.call(t.fallthrough)){return cr(e,t.fallthrough,n,o)}for(var l=0,s;l<t.fallthrough.length;l++){s=cr(e,t.fallthrough[l],n,o);if(s){return s}}}}function hr(e){var t="string"==typeof e?e:zs[e.keyCode];return"Ctrl"==t||"Alt"==t||"Shift"==t||"Mod"==t}function gr(e,t,i){var n=e;if(t.altKey&&"Alt"!=n){e="Alt-"+e}if((Il?t.metaKey:t.ctrlKey)&&"Ctrl"!=n){e="Ctrl-"+e}if((Il?t.ctrlKey:t.metaKey)&&"Cmd"!=n){e="Cmd-"+e}if(!i&&t.shiftKey&&"Shift"!=n){e="Shift-"+e}return e}function ur(e,t){if(kl&&34==e.keyCode&&e.char){return!1}var i=zs[e.keyCode];if(null==i||e.altGraphKey){return!1}if(3==e.keyCode&&e.code){i=e.code}return gr(i,e,t)}function fr(e){return"string"==typeof e?Gs[e]:e}function mr(e,t){for(var n=e.doc.sel.ranges,o=[],r=0,l;r<n.length;r++){l=t(n[r]);while(o.length&&0>=E(l.from,y(o).to)){var s=o.pop();if(0>E(s.from,l.from)){l.from=s.from;break}}o.push(l)}yn(e,function(){for(var t=o.length-1;0<=t;t--){Go(e.doc,"",o[t].from,o[t].to,"+delete")}_i(e)})}function yr(e,t,i){var n=T(e.text,t+i,i);return 0>n||n>e.text.length?null:n}function xr(e,t,i){var n=yr(e,t.ch,i);return null==n?null:new z(t.line,n,0>i?"after":"before")}function vr(e,t,i,n,o){if(e){var r=Ne(i,t.doc.direction);if(r){var l=0>o?y(r):r[0],s=0>o==(1==l.level),d=s?"after":"before",a;if(0<l.level||"rtl"==t.doc.direction){var p=qt(t,i);a=0>o?i.text.length-1:0;var c=Zt(t,p,a).top;a=N(function(e){return Zt(t,p,e).top==c},0>o==(1==l.level)?l.from:l.to-1,a);if("before"==d){a=yr(i,a,1)}}else{a=0>o?l.to:l.from}return new z(n,a,d)}}return new z(n,0>o?i.text.length:0,0>o?"before":"after")}function br(e,t,i,n){var o=Ne(t,e.doc.direction);if(!o){return xr(t,i,n)}if(i.ch>=t.text.length){i.ch=t.text.length;i.sticky="before"}else if(0>=i.ch){i.ch=0;i.sticky="after"}var r=Te(o,i.ch,i.sticky),l=o[r];if("ltr"==e.doc.direction&&0==l.level%2&&(0<n?l.to>i.ch:l.from<i.ch)){return xr(t,i,n)}var s=function(e,i){return yr(t,e instanceof z?e.ch:e,i)},d,a=function(i){if(!e.options.lineWrapping){return{begin:0,end:t.text.length}}d=d||qt(e,t);return mi(e,t,d,i)},p=a("before"==i.sticky?s(i,-1):i.ch);if("rtl"==e.doc.direction||1==l.level){var c=1==l.level==0>n,h=s(i,c?1:-1);if(null!=h&&(!c?h>=l.from&&h>=p.begin:h<=l.to&&h<=p.end)){var g=c?"before":"after";return new z(i.line,h,g)}}var u=function(e,t,n){var r=function(e,t){return t?new z(i.line,s(e,1),"before"):new z(i.line,e,"after")};for(;0<=e&&e<o.length;e+=t){var l=o[e],d=0<t==(1!=l.level),a=d?n.begin:s(n.end,-1);if(l.from<=a&&a<l.to){return r(a,d)}a=d?l.from:s(l.to,-1);if(n.begin<=a&&a<n.end){return r(a,d)}}},f=u(r+n,n,p);if(f){return f}var m=0<n?p.end:s(p.begin,-1);if(null!=m&&!(0<n&&m==t.text.length)){f=u(0<n?0:o.length-1,n,a(m));if(f){return f}}return null}var $s={selectAll:Ho,singleSelection:function singleSelection(e){return e.setSelection(e.getCursor("anchor"),e.getCursor("head"),Ul)},killLine:function killLine(e){return mr(e,function(t){if(t.empty()){var i=A(e.doc,t.head.line).text.length;if(t.head.ch==i&&t.head.line<e.lastLine()){return{from:t.head,to:z(t.head.line+1,0)}}else{return{from:t.head,to:z(t.head.line,i)}}}else{return{from:t.from(),to:t.to()}}})},deleteLine:function deleteLine(e){return mr(e,function(t){return{from:z(t.from().line,0),to:j(e.doc,z(t.to().line+1,0))}})},delLineLeft:function delLineLeft(e){return mr(e,function(e){return{from:z(e.from().line,0),to:e.from()}})},delWrappedLineLeft:function delWrappedLineLeft(e){return mr(e,function(t){var i=e.charCoords(t.head,"div").top+5,n=e.coordsChar({left:0,top:i},"div");return{from:n,to:t.from()}})},delWrappedLineRight:function delWrappedLineRight(e){return mr(e,function(t){var i=e.charCoords(t.head,"div").top+5,n=e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:i},"div");return{from:t.from(),to:n}})},undo:function undo(e){return e.undo()},redo:function redo(e){return e.redo()},undoSelection:function undoSelection(e){return e.undoSelection()},redoSelection:function redoSelection(e){return e.redoSelection()},goDocStart:function goDocStart(e){return e.extendSelection(z(e.firstLine(),0))},goDocEnd:function goDocEnd(e){return e.extendSelection(z(e.lastLine()))},goLineStart:function goLineStart(e){return e.extendSelectionsBy(function(t){return Cr(e,t.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function goLineStartSmart(e){return e.extendSelectionsBy(function(t){return Sr(e,t.head)},{origin:"+move",bias:1})},goLineEnd:function goLineEnd(e){return e.extendSelectionsBy(function(t){return wr(e,t.head.line)},{origin:"+move",bias:-1})},goLineRight:function goLineRight(e){return e.extendSelectionsBy(function(t){var i=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:i},"div")},Vl)},goLineLeft:function goLineLeft(e){return e.extendSelectionsBy(function(t){var i=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:0,top:i},"div")},Vl)},goLineLeftSmart:function goLineLeftSmart(e){return e.extendSelectionsBy(function(t){var i=e.cursorCoords(t.head,"div").top+5,n=e.coordsChar({left:0,top:i},"div");if(n.ch<e.getLine(n.line).search(/\S/)){return Sr(e,t.head)}return n},Vl)},goLineUp:function goLineUp(e){return e.moveV(-1,"line")},goLineDown:function goLineDown(e){return e.moveV(1,"line")},goPageUp:function goPageUp(e){return e.moveV(-1,"page")},goPageDown:function goPageDown(e){return e.moveV(1,"page")},goCharLeft:function goCharLeft(e){return e.moveH(-1,"char")},goCharRight:function goCharRight(e){return e.moveH(1,"char")},goColumnLeft:function goColumnLeft(e){return e.moveH(-1,"column")},goColumnRight:function goColumnRight(e){return e.moveH(1,"column")},goWordLeft:function goWordLeft(e){return e.moveH(-1,"word")},goGroupRight:function goGroupRight(e){return e.moveH(1,"group")},goGroupLeft:function goGroupLeft(e){return e.moveH(-1,"group")},goWordRight:function goWordRight(e){return e.moveH(1,"word")},delCharBefore:function delCharBefore(e){return e.deleteH(-1,"char")},delCharAfter:function delCharAfter(e){return e.deleteH(1,"char")},delWordBefore:function delWordBefore(e){return e.deleteH(-1,"word")},delWordAfter:function delWordAfter(e){return e.deleteH(1,"word")},delGroupBefore:function delGroupBefore(e){return e.deleteH(-1,"group")},delGroupAfter:function delGroupAfter(e){return e.deleteH(1,"group")},indentAuto:function indentAuto(e){return e.indentSelection("smart")},indentMore:function indentMore(e){return e.indentSelection("add")},indentLess:function indentLess(e){return e.indentSelection("subtract")},insertTab:function insertTab(e){return e.replaceSelection("\t")},insertSoftTab:function insertSoftTab(e){for(var t=[],n=e.listSelections(),o=e.options.tabSize,r=0;r<n.length;r++){var l=n[r].from(),s=h(e.getLine(l.line),l.ch,o);t.push(f(o-s%o))}e.replaceSelections(t)},defaultTab:function defaultTab(e){if(e.somethingSelected()){e.indentSelection("add")}else{e.execCommand("insertTab")}},transposeChars:function transposeChars(e){return yn(e,function(){for(var t=e.listSelections(),n=[],o=0;o<t.length;o++){if(!t[o].empty()){continue}var r=t[o].head,l=A(e.doc,r.line).text;if(l){if(r.ch==l.length){r=new z(r.line,r.ch-1)}if(0<r.ch){r=new z(r.line,r.ch+1);e.replaceRange(l.charAt(r.ch-1)+l.charAt(r.ch-2),z(r.line,r.ch-2),r,"+transpose")}else if(r.line>e.doc.first){var s=A(e.doc,r.line-1).text;if(s){r=new z(r.line,1);e.replaceRange(l.charAt(0)+e.doc.lineSeparator()+s.charAt(s.length-1),z(r.line-1,s.length-1),r,"+transpose")}}}n.push(new Os(r,r))}e.setSelections(n)})},newlineAndIndent:function newlineAndIndent(e){return yn(e,function(){for(var t=e.listSelections(),n=t.length-1;0<=n;n--){e.replaceRange(e.doc.lineSeparator(),t[n].anchor,t[n].head,"+input")}t=e.listSelections();for(var o=0;o<t.length;o++){e.indentLine(t[o].from().line,null,!0)}_i(e)})},openLine:function openLine(e){return e.replaceSelection("\n","start")},toggleOverwrite:function toggleOverwrite(e){return e.toggleOverwrite()}};function Cr(e,t){var i=A(e.doc,t),n=fe(i);if(n!=i){t=H(n)}return vr(!0,e,n,t,1)}function wr(e,t){var i=A(e.doc,t),n=me(i);if(n!=i){t=H(n)}return vr(!0,e,i,t,-1)}function Sr(e,t){var i=Cr(e,t.line),n=A(e.doc,i.line),o=Ne(n,e.doc.direction);if(!o||0==o[0].level){var r=Math.max(0,n.text.search(/\S/)),l=t.line==i.line&&t.ch<=r&&t.ch;return z(i.line,l?0:r,i.sticky)}return i}function Lr(e,t,i){if("string"==typeof t){t=$s[t];if(!t){return!1}}e.display.input.ensurePolled();var n=e.display.shift,o=!1;try{if(e.isReadOnly()){e.state.suppressEdits=!0}if(i){e.display.shift=!1}o=t(e)!=$l}finally{e.display.shift=n;e.state.suppressEdits=!1}return o}function kr(e,t,n){for(var o=0,r;o<e.state.keyMaps.length;o++){r=cr(t,e.state.keyMaps[o],n,e);if(r){return r}}return e.options.extraKeys&&cr(t,e.options.extraKeys,n,e)||cr(t,e.options.keyMap,n,e)}var Us=new Gl;function Tr(t,i,n,e){var o=t.state.keySeq;if(o){if(hr(i)){return"handled"}if(/\'$/.test(i)){t.state.keySeq=null}else{Us.set(50,function(){if(t.state.keySeq==o){t.state.keySeq=null;t.display.input.reset()}})}if(Nr(t,o+" "+i,n,e)){return!0}}return Nr(t,i,n,e)}function Nr(t,i,n,e){var o=kr(t,i,e);if("multi"==o){t.state.keySeq=i}if("handled"==o){St(t,"keyHandled",t,i,n)}if("handled"==o||"multi"==o){Pe(n);Fi(t)}return!!o}function Or(t,i){var e=ur(i,!0);if(!e){return!1}if(i.shiftKey&&!t.state.keySeq){return Tr(t,"Shift-"+e,i,function(e){return Lr(t,e,!0)})||Tr(t,e,i,function(e){if("string"==typeof e?/^go[A-Z]/.test(e):e.motion){return Lr(t,e)}})}else{return Tr(t,e,i,function(e){return Lr(t,e)})}}function Ar(t,i,e){return Tr(t,"'"+e+"'",i,function(e){return Lr(t,e,!0)})}var js=null;function Mr(t){var e=this;e.curOp.focus=s();if(We(e,t)){return}if(Cl&&11>ie&&27==t.keyCode){t.returnValue=!1}var i=t.keyCode;e.display.shift=16==i||t.shiftKey;var n=Or(e,t);if(kl){js=n?i:null;if(!n&&88==i&&!os&&(Dl?t.metaKey:t.ctrlKey)){e.replaceSelection("",null,"cut")}}if(18==i&&!/\bCodeMirror-crosshair\b/.test(e.display.lineDiv.className)){Wr(e)}}function Wr(e){var i=e.display.lineDiv;d(i,"CodeMirror-crosshair");function t(n){if(18==n.keyCode||!n.altKey){El(i,"CodeMirror-crosshair");Ae(document,"keyup",t);Ae(document,"mouseover",t)}}es(document,"keyup",t);es(document,"mouseover",t)}function Dr(t){if(16==t.keyCode){this.doc.sel.shift=!1}We(this,t)}function Hr(t){var e=this;if(Et(e.display,t)||We(e,t)||t.ctrlKey&&!t.altKey||Dl&&t.metaKey){return}var i=t.keyCode,n=t.charCode;if(kl&&i==js){js=null;Pe(t);return}if(kl&&(!t.which||10>t.which)&&Or(e,t)){return}var o=String.fromCharCode(null==n?i:n);if("\b"==o){return}if(Ar(e,t,o)){return}e.display.input.onKeyPress(t)}var Vs=function(e,t,i){this.time=e;this.pos=t;this.button=i};Vs.prototype.compare=function(e,t,i){return this.time+400>e&&0==E(t,this.pos)&&i==this.button};var Ks,Xs;function Fr(e,t){var i=+new Date;if(Xs&&Xs.compare(i,e,t)){Ks=Xs=null;return"triple"}else if(Ks&&Ks.compare(i,e,t)){Xs=new Vs(i,e,t);Ks=null;return"double"}else{Ks=new Vs(i,e,t);Xs=null;return"single"}}function Pr(t){var e=this,i=e.display;if(We(e,t)||i.activeTouch&&i.input.supportsTouch()){return}i.input.ensurePolled();i.shift=t.shiftKey;if(Et(i,t)){if(!wl){i.scroller.draggable=!1;setTimeout(function(){return i.scroller.draggable=!0},100)}return}if(jr(e,t)){return}var n=Ni(e,t),o=Be(t),r=n?Fr(n,o):"single";window.focus();if(1==o&&e.state.selectingText){e.state.selectingText(t)}if(n&&Ir(e,o,n,r,t)){return}if(1==o){if(n){Er(e,n,r,t)}else if(Re(t)==i.scroller){Pe(t)}}else if(2==o){if(n){vo(e.doc,n)}setTimeout(function(){return i.input.focus()},20)}else if(3==o){if(zl){e.display.input.onContextMenu(t)}else{Ii(e)}}}function Ir(e,t,i,n,o){var r="Click";if("double"==n){r="Double"+r}else if("triple"==n){r="Triple"+r}r=(1==t?"Left":2==t?"Middle":"Right")+r;return Tr(e,gr(r,o),o,function(t){if("string"==typeof t){t=$s[t]}if(!t){return!1}var n=!1;try{if(e.isReadOnly()){e.state.suppressEdits=!0}n=t(e,i)!=$l}finally{e.state.suppressEdits=!1}return n})}function zr(e,t,i){var n=e.getOption("configureMouse"),o=n?n(e,t,i):{};if(null==o.unit){var r=Hl?i.shiftKey&&i.metaKey:i.altKey;o.unit=r?"rectangle":"single"==t?"char":"double"==t?"word":"line"}if(null==o.extend||e.doc.extend){o.extend=e.doc.extend||i.shiftKey}if(null==o.addNew){o.addNew=Dl?i.metaKey:i.ctrlKey}if(null==o.moveOnDrag){o.moveOnDrag=!(Dl?i.altKey:i.ctrlKey)}return o}function Er(e,t,i,n){if(Cl){setTimeout(p(Pi,e),0)}else{e.curOp.focus=s()}var o=zr(e,i,n),r=e.doc.sel,l;if(e.options.dragDrop&&m&&!e.isReadOnly()&&"single"==i&&-1<(l=r.contains(t))&&(0>E((l=r.ranges[l]).from(),t)||0<t.xRel)&&(0<E(l.to(),t)||0>t.xRel)){Rr(e,n,t,o)}else{Gr(e,n,t,o)}}function Rr(t,e,i,n){var o=t.display,r=!1,l=xn(t,function(a){if(wl){o.scroller.draggable=!1}t.state.draggingText=!1;Ae(o.wrapper.ownerDocument,"mouseup",l);Ae(o.wrapper.ownerDocument,"mousemove",s);Ae(o.scroller,"dragstart",d);Ae(o.scroller,"drop",l);if(!r){Pe(a);if(!n.addNew){vo(t.doc,i,null,null,n.extend)}if(wl||Cl&&9==ie){setTimeout(function(){o.wrapper.ownerDocument.body.focus();o.input.focus()},20)}else{o.input.focus()}}}),s=function(t){r=r||10<=Math.abs(e.clientX-t.clientX)+Math.abs(e.clientY-t.clientY)},d=function(){return r=!0};if(wl){o.scroller.draggable=!0}t.state.draggingText=l;l.copy=!n.moveOnDrag;if(o.scroller.dragDrop){o.scroller.dragDrop()}es(o.wrapper.ownerDocument,"mouseup",l);es(o.wrapper.ownerDocument,"mousemove",s);es(o.scroller,"dragstart",d);es(o.scroller,"drop",l);Ii(t);setTimeout(function(){return o.input.focus()},20)}function Br(e,t,i){if("char"==i){return new Os(t,t)}if("word"==i){return e.findWordAt(t)}if("line"==i){return new Os(z(t.line,0),j(e.doc,z(t.line+1,0)))}var n=i(e,t);return new Os(n.from,n.to)}function Gr(t,e,i,n){var d=t.display,a=t.doc;Pe(e);var p,c,g=a.sel,f=g.ranges;if(n.addNew&&!n.extend){c=a.sel.contains(i);if(-1<c){p=f[c]}else{p=new Os(i,i)}}else{p=a.sel.primary();c=a.sel.primIndex}if("rectangle"==n.unit){if(!n.addNew){p=new Os(i,i)}i=Ni(t,e,!0,!0);c=-1}else{var m=Br(t,i,n.unit);if(n.extend){p=xo(p,m.anchor,m.head,n.extend)}else{p=m}}if(!n.addNew){c=0;ko(a,new Ns([p],0),jl);g=a.sel}else if(-1==c){c=f.length;ko(a,Un(t,f.concat([p]),c),{scroll:!1,origin:"*mouse"})}else if(1<f.length&&f[c].empty()&&"char"==n.unit&&!n.extend){ko(a,Un(t,f.slice(0,c).concat(f.slice(c+1)),0),{scroll:!1,origin:"*mouse"});g=a.sel}else{Co(a,c,p,jl)}var y=i;function o(e){if(0==E(y,e)){return}y=e;if("rectangle"==n.unit){for(var o=[],r=t.options.tabSize,l=h(A(a,i.line).text,i.ch,r),s=h(A(a,e.line).text,e.ch,r),d=Math.min(l,s),f=Math.max(l,s),m=Math.min(i.line,e.line),x=Math.min(t.lastLine(),Math.max(i.line,e.line));m<=x;m++){var v=A(a,m).text,b=u(v,d,r);if(d==f){o.push(new Os(z(m,b),z(m,b)))}else if(v.length>b){o.push(new Os(z(m,b),z(m,u(v,f,r))))}}if(!o.length){o.push(new Os(i,i))}ko(a,Un(t,g.ranges.slice(0,c).concat(o),c),{origin:"*mouse",scroll:!1});t.scrollIntoView(e)}else{var C=p,w=Br(t,e,n.unit),S=C.anchor,L;if(0<E(w.anchor,S)){L=w.head;S=$(C.from(),w.anchor)}else{L=w.anchor;S=G(C.to(),w.head)}var k=g.ranges.slice(0);k[c]=$r(t,new Os(j(a,S),L));ko(a,Un(t,k,c),jl)}}var x=d.wrapper.getBoundingClientRect(),v=0;function r(i){var e=++v,l=Ni(t,i,!0,"rectangle"==n.unit);if(!l){return}if(0!=E(l,y)){t.curOp.focus=s();o(l);var p=Gi(d,a);if(l.line>=p.to||l.line<p.from){setTimeout(xn(t,function(){if(v==e){r(i)}}),150)}}else{var c=i.clientY<x.top?-20:i.clientY>x.bottom?20:0;if(c){setTimeout(xn(t,function(){if(v!=e){return}d.scroller.scrollTop+=c;r(i)}),50)}}}function l(i){t.state.selectingText=!1;v=1/0;Pe(i);d.input.focus();Ae(d.wrapper.ownerDocument,"mousemove",b);Ae(d.wrapper.ownerDocument,"mouseup",C);a.history.lastSelOrigin=null}var b=xn(t,function(t){if(0===t.buttons||!Be(t)){l(t)}else{r(t)}}),C=xn(t,l);t.state.selectingText=C;es(d.wrapper.ownerDocument,"mousemove",b);es(d.wrapper.ownerDocument,"mouseup",C)}function $r(e,t){var i=t.anchor,n=t.head,o=A(e.doc,i.line);if(0==E(i,n)&&i.sticky==n.sticky){return t}var r=Ne(o);if(!r){return t}var l=Te(r,i.ch,i.sticky),s=r[l];if(s.from!=i.ch&&s.to!=i.ch){return t}var d=l+(s.from==i.ch==(1!=s.level)?0:1);if(0==d||d==r.length){return t}var a;if(n.line!=i.line){a=0<(n.line-i.line)*("ltr"==e.doc.direction?1:-1)}else{var p=Te(r,n.ch,n.sticky),c=p-l||(n.ch-i.ch)*(1==s.level?-1:1);if(p==d-1||p==d){a=0>c}else{a=0<c}}var h=r[d+(a?-1:0)],g=a==(1==h.level),u=g?h.from:h.to,f=g?"after":"before";return i.ch==u&&i.sticky==f?t:new Os(new z(i.line,u,f),n)}function Ur(t,n,e,o){var r,l;if(n.touches){r=n.touches[0].clientX;l=n.touches[0].clientY}else{try{r=n.clientX;l=n.clientY}catch(t){return!1}}if(r>=Math.floor(t.display.gutters.getBoundingClientRect().right)){return!1}if(o){Pe(n)}var s=t.display,d=s.lineDiv.getBoundingClientRect();if(l>d.bottom||!He(t,e)){return ze(n)}l-=d.top-s.viewOffset;for(var a=0,p;a<t.options.gutters.length;++a){p=s.gutters.childNodes[a];if(p&&p.getBoundingClientRect().right>=r){var c=F(t.doc,l),h=t.options.gutters[a];Me(t,e,t,c,h,n);return ze(n)}}}function jr(t,i){return Ur(t,i,"gutterClick",!0)}function Vr(t,i){if(Et(t.display,i)||Kr(t,i)){return}if(We(t,i,"contextmenu")){return}if(!zl){t.display.input.onContextMenu(i)}}function Kr(t,i){if(!He(t,"gutterContextMenu")){return!1}return Ur(t,i,"gutterContextMenu",!1)}function Xr(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-");oi(e)}var Ys={toString:function toString(){return"CodeMirror.Init"}},_s={},qs={};function Yr(e){En(e);Cn(e);$i(e)}function _r(e,t,i){if(!t!=!(i&&i!=Ys)){var n=e.display.dragFunctions,o=t?es:Ae;o(e.display.scroller,"dragstart",n.start);o(e.display.scroller,"dragenter",n.enter);o(e.display.scroller,"dragover",n.over);o(e.display.scroller,"dragleave",n.leave);o(e.display.scroller,"drop",n.drop)}}function qr(e){if(e.options.lineWrapping){d(e.display.wrapper,"CodeMirror-wrap");e.display.sizer.style.minWidth="";e.display.sizerWidth=null}else{El(e.display.wrapper,"CodeMirror-wrap");Le(e)}Ti(e);Cn(e);oi(e);setTimeout(function(){return ln(e)},100)}function Zr(e,t){var n=this;if(!(this instanceof Zr)){return new Zr(e,t)}this.options=t=t?c(t):{};c(_s,t,!1);Rn(t);var o=t.value;if("string"==typeof o){o=new Fs(o,t.mode,null,t.lineSeparator,t.direction)}else if(t.mode){o.modeOption=t.mode}this.doc=o;var r=new Zr.inputStyles[t.inputStyle](this),l=this.display=new O(e,o,r);l.wrapper.CodeMirror=this;En(this);Xr(this);if(t.lineWrapping){this.display.wrapper.className+=" CodeMirror-wrap"}dn(this);this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,selectingText:!1,draggingText:!1,highlight:new Gl,keySeq:null,specialChars:null};if(t.autofocus&&!Wl){l.input.focus()}if(Cl&&11>ie){setTimeout(function(){return n.display.input.reset(!0)},20)}Qr(this);lr();an(this);this.curOp.forceUpdate=!0;to(this,o);if(t.autofocus&&!Wl||this.hasFocus()){setTimeout(p(zi,this),20)}else{Ei(this)}for(var s in qs){if(qs.hasOwnProperty(s)){qs[s](this,t[s],Ys)}}Ui(this);if(t.finishInit){t.finishInit(this)}for(var d=0;d<Zs.length;++d){Zs[d](this)}pn(this);if(wl&&t.lineWrapping&&"optimizelegibility"==getComputedStyle(l.lineDiv).textRendering){l.lineDiv.style.textRendering="auto"}}Zr.defaults=_s;Zr.optionHandlers=qs;function Qr(t){var r=t.display;es(r.scroller,"mousedown",xn(t,Pr));if(Cl&&11>ie){es(r.scroller,"dblclick",xn(t,function(i){if(We(t,i)){return}var e=Ni(t,i);if(!e||jr(t,i)||Et(t.display,i)){return}Pe(i);var n=t.findWordAt(e);vo(t.doc,n.anchor,n.head)}))}else{es(r.scroller,"dblclick",function(i){return We(t,i)||Pe(i)})}es(r.scroller,"contextmenu",function(i){return Vr(t,i)});var l,s={end:0};function i(){if(r.activeTouch){l=setTimeout(function(){return r.activeTouch=null},1e3);s=r.activeTouch;s.end=+new Date}}function n(t){if(1!=t.touches.length){return!1}var e=t.touches[0];return 1>=e.radiusX&&1>=e.radiusY}function o(e,t){if(null==t.left){return!0}var i=t.left-e.left,n=t.top-e.top;return i*i+n*n>400}es(r.scroller,"touchstart",function(i){if(!We(t,i)&&!n(i)&&!jr(t,i)){r.input.ensurePolled();clearTimeout(l);var e=+new Date;r.activeTouch={start:e,moved:!1,prev:300>=e-s.end?s:null};if(1==i.touches.length){r.activeTouch.left=i.touches[0].pageX;r.activeTouch.top=i.touches[0].pageY}}});es(r.scroller,"touchmove",function(){if(r.activeTouch){r.activeTouch.moved=!0}});es(r.scroller,"touchend",function(n){var e=r.activeTouch;if(e&&!Et(r,n)&&null!=e.left&&!e.moved&&300>new Date-e.start){var l=t.coordsChar(r.activeTouch,"page"),s;if(!e.prev||o(e,e.prev)){s=new Os(l,l)}else if(!e.prev.prev||o(e,e.prev.prev)){s=t.findWordAt(l)}else{s=new Os(z(l.line,0),j(t.doc,z(l.line+1,0)))}t.setSelection(s.anchor,s.head);t.focus();Pe(n)}i()});es(r.scroller,"touchcancel",i);es(r.scroller,"scroll",function(){if(r.scroller.clientHeight){en(t,r.scroller.scrollTop);nn(t,r.scroller.scrollLeft,!0);Me(t,"scroll",t)}});es(r.scroller,"mousewheel",function(i){return $n(t,i)});es(r.scroller,"DOMMouseScroll",function(i){return $n(t,i)});es(r.wrapper,"scroll",function(){return r.wrapper.scrollTop=r.wrapper.scrollLeft=0});r.dragFunctions={enter:function enter(i){if(!We(t,i)){Ee(i)}},over:function over(i){if(!We(t,i)){nr(t,i);Ee(i)}},start:function start(i){return ir(t,i)},drop:xn(t,tr),leave:function leave(i){if(!We(t,i)){or(t)}}};var d=r.input.getField();es(d,"keyup",function(i){return Dr.call(t,i)});es(d,"keydown",xn(t,Mr));es(d,"keypress",xn(t,Hr));es(d,"focus",function(i){return zi(t,i)});es(d,"blur",function(i){return Ei(t,i)})}var Zs=[];Zr.defineInitHook=function(e){return Zs.push(e)};function Jr(e,t,n,o){var r=e.doc,l;if(null==n){n="add"}if("smart"==n){if(!r.mode.indent){n="prev"}else{l=Je(e,t).state}}var s=e.options.tabSize,d=A(r,t),a=h(d.text,null,s);if(d.stateAfter){d.stateAfter=null}var p=d.text.match(/^\s*/)[0],c;if(!o&&!/\S/.test(d.text)){c=0;n="not"}else if("smart"==n){c=r.mode.indent(l,d.text.slice(p.length),d.text);if(c==$l||150<c){if(!o){return}n="prev"}}if("prev"==n){if(t>r.first){c=h(A(r,t-1).text,null,s)}else{c=0}}else if("add"==n){c=a+e.options.indentUnit}else if("subtract"==n){c=a-e.options.indentUnit}else if("number"==typeof n){c=a+n}c=Math.max(0,c);var g="",u=0;if(e.options.indentWithTabs){for(var m=Math.floor(c/s);m;--m){u+=s;g+="\t"}}if(u<c){g+=f(c-u)}if(g!=p){Go(r,g,z(t,0),z(t,p.length),"+input");d.stateAfter=null;return!0}else{for(var y=0,x;y<r.sel.ranges.length;y++){x=r.sel.ranges[y];if(x.head.line==t&&x.head.ch<p.length){var v=z(t,p.length);Co(r,y,new Os(v,v));break}}}}var Qs=null;function el(e){Qs=e}function tl(e,t,n,o,r){var l=e.doc;e.display.shift=!1;if(!o){o=l.sel}var s=e.state.pasteIncoming||"paste"==r,d=is(t),a=null;if(s&&1<o.ranges.length){if(Qs&&Qs.text.join("\n")==t){if(0==o.ranges.length%Qs.text.length){a=[];for(var p=0;p<Qs.text.length;p++){a.push(l.splitLines(Qs.text[p]))}}}else if(d.length==o.ranges.length&&e.options.pasteLinesPerSelection){a=x(d,function(e){return[e]})}}for(var c,h=o.ranges.length-1;0<=h;h--){var g=o.ranges[h],u=g.from(),f=g.to();if(g.empty()){if(n&&0<n){u=z(u.line,u.ch-n)}else if(e.state.overwrite&&!s){f=z(f.line,Math.min(A(l,f.line).text.length,f.ch+y(d).length))}else if(s&&Qs&&Qs.lineWise&&Qs.text.join("\n")==t){u=f=z(u.line,0)}}c=e.curOp.updateInput;var m={from:u,to:f,text:a?a[h%a.length]:d,origin:r||(s?"paste":e.state.cutIncoming?"cut":"+input")};Po(e.doc,m);St(e,"inputRead",e,m)}if(t&&!s){nl(e,t)}_i(e);e.curOp.updateInput=c;e.curOp.typing=!0;e.state.pasteIncoming=e.state.cutIncoming=!1}function il(t,e){var i=t.clipboardData&&t.clipboardData.getData("Text");if(i){t.preventDefault();if(!e.isReadOnly()&&!e.options.disableInput){yn(e,function(){return tl(e,i,0,null,"paste")})}return!0}}function nl(e,t){if(!e.options.electricChars||!e.options.smartIndent){return}for(var n=e.doc.sel,o=n.ranges.length-1,r;0<=o;o--){r=n.ranges[o];if(100<r.head.ch||o&&n.ranges[o-1].head.line==r.head.line){continue}var l=e.getModeAt(r.head),s=!1;if(l.electricChars){for(var d=0;d<l.electricChars.length;d++){if(-1<t.indexOf(l.electricChars.charAt(d))){s=Jr(e,r.head.line,"smart");break}}}else if(l.electricInput){if(l.electricInput.test(A(e.doc,r.head.line).text.slice(0,r.head.ch))){s=Jr(e,r.head.line,"smart")}}if(s){St(e,"electricInput",e,r.head.line)}}}function ol(e){for(var t=[],n=[],o=0;o<e.doc.sel.ranges.length;o++){var r=e.doc.sel.ranges[o].head.line,l={anchor:z(r,0),head:z(r+1,0)};n.push(l);t.push(e.getRange(l.anchor,l.head))}return{text:t,ranges:n}}function rl(e,t){e.setAttribute("autocorrect","off");e.setAttribute("autocapitalize","off");e.setAttribute("spellcheck",!!t)}function ll(){var e=o("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none"),t=o("div",[e],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");if(wl){e.style.width="1000px"}else{e.setAttribute("wrap","off")}if(Al){e.style.border="1px solid black"}rl(e);return t}function sl(e,t,i,n,o){var s=t,d=i,a=A(e,t.line);function r(){var n=t.line+i;if(n<e.first||n>=e.first+e.size){return!1}t=new z(n,t.ch,t.sticky);return a=A(e,n)}function l(n){var l;if(o){l=br(e.cm,a,t,i)}else{l=xr(a,t,i)}if(null==l){if(!n&&r()){t=vr(o,e.cm,a,t.line,i)}else{return!1}}else{t=l}return!0}if("char"==n){l()}else if("column"==n){l(!0)}else if("word"==n||"group"==n){for(var p=null,c="group"==n,h=e.cm&&e.cm.getHelper(t,"wordChars"),g=!0;;g=!1){if(0>i&&!l(!g)){break}var u=a.text.charAt(t.ch)||"\n",f=S(u,h)?"w":c&&"\n"==u?"n":!c||/\s/.test(u)?null:"p";if(c&&!g&&!f){f="s"}if(p&&p!=f){if(0>i){i=1;l();t.sticky="after"}break}if(f){p=f}if(0<i&&!l(!g)){break}}}var m=Wo(e,t,s,d,!0);if(R(s,m)){m.hitSide=!0}return m}function dl(e,t,i,n){var o=e.doc,r=t.left,l;if("page"==n){var s=Math.min(e.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),d=Math.max(s-.5*Ci(e.display),3);l=(0<i?t.bottom:t.top)+i*d}else if("line"==n){l=0<i?t.bottom+3:t.top-3}var a;for(;;){a=ui(e,r,l);if(!a.outside){break}if(0>i?0>=l:l>=o.height){a.hitSide=!0;break}l+=5*i}return a}var Js=function(e){this.cm=e;this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null;this.polling=new Gl;this.composing=null;this.gracePeriod=!1;this.readDOMTimeout=null};Js.prototype.init=function(e){var i=this,n=this,o=n.cm,r=n.div=e.lineDiv;rl(r,o.options.spellcheck);es(r,"paste",function(t){if(We(o,t)||il(t,o)){return}if(11>=ie){setTimeout(xn(o,function(){return i.updateFromDOM()}),20)}});es(r,"compositionstart",function(t){i.composing={data:t.data,done:!1}});es(r,"compositionupdate",function(t){if(!i.composing){i.composing={data:t.data,done:!1}}});es(r,"compositionend",function(t){if(i.composing){if(t.data!=i.composing.data){i.readFromDOMSoon()}i.composing.done=!0}});es(r,"touchstart",function(){return n.forceCompositionEnd()});es(r,"input",function(){if(!i.composing){i.readFromDOMSoon()}});function t(t){if(We(o,t)){return}if(o.somethingSelected()){el({lineWise:!1,text:o.getSelections()});if("cut"==t.type){o.replaceSelection("",null,"cut")}}else if(!o.options.lineWiseCopyCut){return}else{var e=ol(o);el({lineWise:!0,text:e.text});if("cut"==t.type){o.operation(function(){o.setSelections(e.ranges,0,Ul);o.replaceSelection("",null,"cut")})}}if(t.clipboardData){t.clipboardData.clearData();var i=Qs.text.join("\n");t.clipboardData.setData("Text",i);if(t.clipboardData.getData("Text")==i){t.preventDefault();return}}var l=ll(),s=l.firstChild;o.display.lineSpace.insertBefore(l,o.display.lineSpace.firstChild);s.value=Qs.text.join("\n");var d=document.activeElement;Bl(s);setTimeout(function(){o.display.lineSpace.removeChild(l);d.focus();if(d==r){n.showPrimarySelection()}},50)}es(r,"copy",t);es(r,"cut",t)};Js.prototype.prepareSelection=function(){var e=Mi(this.cm,!1);e.focus=this.cm.state.focused;return e};Js.prototype.showSelection=function(e,t){if(!e||!this.cm.display.view.length){return}if(e.focus||t){this.showPrimarySelection()}this.showMultipleSelections(e)};Js.prototype.getSelection=function(){return this.cm.display.wrapper.ownerDocument.getSelection()};Js.prototype.showPrimarySelection=function(){var e=this.getSelection(),t=this.cm,i=t.doc.sel.primary(),n=i.from(),o=i.to();if(t.display.viewTo==t.display.viewFrom||n.line>=t.display.viewTo||o.line<t.display.viewFrom){e.removeAllRanges();return}var r=gl(t,e.anchorNode,e.anchorOffset),l=gl(t,e.focusNode,e.focusOffset);if(r&&!r.bad&&l&&!l.bad&&0==E($(r,l),n)&&0==E(G(r,l),o)){return}var s=t.display.view,d=n.line>=t.display.viewFrom&&al(t,n)||{node:s[0].measure.map[2],offset:0},a=o.line<t.display.viewTo&&al(t,o);if(!a){var p=s[s.length-1].measure,c=p.maps?p.maps[p.maps.length-1]:p.map;a={node:c[c.length-1],offset:c[c.length-2]-c[c.length-3]}}if(!d||!a){e.removeAllRanges();return}var h=e.rangeCount&&e.getRangeAt(0),g;try{g=Rl(d.node,d.offset,a.offset,a.node)}catch(t){}if(g){if(!yl&&t.state.focused){e.collapse(d.node,d.offset);if(!g.collapsed){e.removeAllRanges();e.addRange(g)}}else{e.removeAllRanges();e.addRange(g)}if(h&&null==e.anchorNode){e.addRange(h)}else if(yl){this.startGracePeriod()}}this.rememberSelection()};Js.prototype.startGracePeriod=function(){var e=this;clearTimeout(this.gracePeriod);this.gracePeriod=setTimeout(function(){e.gracePeriod=!1;if(e.selectionChanged()){e.cm.operation(function(){return e.cm.curOp.selectionChanged=!0})}},20)};Js.prototype.showMultipleSelections=function(e){n(this.cm.display.cursorDiv,e.cursors);n(this.cm.display.selectionDiv,e.selection)};Js.prototype.rememberSelection=function(){var e=this.getSelection();this.lastAnchorNode=e.anchorNode;this.lastAnchorOffset=e.anchorOffset;this.lastFocusNode=e.focusNode;this.lastFocusOffset=e.focusOffset};Js.prototype.selectionInEditor=function(){var e=this.getSelection();if(!e.rangeCount){return!1}var t=e.getRangeAt(0).commonAncestorContainer;return l(this.div,t)};Js.prototype.focus=function(){if("nocursor"!=this.cm.options.readOnly){if(!this.selectionInEditor()){this.showSelection(this.prepareSelection(),!0)}this.div.focus()}};Js.prototype.blur=function(){this.div.blur()};Js.prototype.getField=function(){return this.div};Js.prototype.supportsTouch=function(){return!0};Js.prototype.receivedFocus=function(){var t=this;if(this.selectionInEditor()){this.pollSelection()}else{yn(this.cm,function(){return t.cm.curOp.selectionChanged=!0})}function e(){if(t.cm.state.focused){t.pollSelection();t.polling.set(t.cm.options.pollInterval,e)}}this.polling.set(this.cm.options.pollInterval,e)};Js.prototype.selectionChanged=function(){var e=this.getSelection();return e.anchorNode!=this.lastAnchorNode||e.anchorOffset!=this.lastAnchorOffset||e.focusNode!=this.lastFocusNode||e.focusOffset!=this.lastFocusOffset};Js.prototype.pollSelection=function(){if(null!=this.readDOMTimeout||this.gracePeriod||!this.selectionChanged()){return}var e=this.getSelection(),t=this.cm;if(Ml&&Ll&&this.cm.options.gutters.length&&pl(e.anchorNode)){this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs});this.blur();this.focus();return}if(this.composing){return}this.rememberSelection();var i=gl(t,e.anchorNode,e.anchorOffset),n=gl(t,e.focusNode,e.focusOffset);if(i&&n){yn(t,function(){ko(t.doc,jn(i,n),Ul);if(i.bad||n.bad){t.curOp.selectionChanged=!0}})}};Js.prototype.pollContent=function(){if(null!=this.readDOMTimeout){clearTimeout(this.readDOMTimeout);this.readDOMTimeout=null}var e=this.cm,t=e.display,i=e.doc.sel.primary(),n=i.from(),o=i.to();if(0==n.ch&&n.line>e.firstLine()){n=z(n.line-1,A(e.doc,n.line-1).length)}if(o.ch==A(e.doc,o.line).text.length&&o.line<e.lastLine()){o=z(o.line+1,0)}if(n.line<t.viewFrom||o.line>t.viewTo-1){return!1}var r,l,s;if(n.line==t.viewFrom||0==(r=Oi(e,n.line))){l=H(t.view[0].line);s=t.view[0].node}else{l=H(t.view[r].line);s=t.view[r-1].node.nextSibling}var d=Oi(e,o.line),a,p;if(d==t.view.length-1){a=t.viewTo-1;p=t.lineDiv.lastChild}else{a=H(t.view[d+1].line)-1;p=t.view[d+1].node.previousSibling}if(!s){return!1}var c=e.doc.splitLines(hl(e,s,p,l,a)),h=M(e.doc,z(l,0),z(a,A(e.doc,a).text.length));while(1<c.length&&1<h.length){if(y(c)==y(h)){c.pop();h.pop();a--}else if(c[0]==h[0]){c.shift();h.shift();l++}else{break}}var g=0,u=0,f=c[0],m=h[0],x=Math.min(f.length,m.length);while(g<x&&f.charCodeAt(g)==m.charCodeAt(g)){++g}var v=y(c),b=y(h),C=Math.min(v.length-(1==c.length?g:0),b.length-(1==h.length?g:0));while(u<C&&v.charCodeAt(v.length-u-1)==b.charCodeAt(b.length-u-1)){++u}if(1==c.length&&1==h.length&&l==n.line){while(g&&g>n.ch&&v.charCodeAt(v.length-u-1)==b.charCodeAt(b.length-u-1)){g--;u++}}c[c.length-1]=v.slice(0,v.length-u).replace(/^\u200b+/,"");c[0]=c[0].slice(g).replace(/\u200b+$/,"");var w=z(l,g),S=z(a,h.length?y(h).length-u:0);if(1<c.length||c[0]||E(w,S)){Go(e.doc,c,w,S,"+input");return!0}};Js.prototype.ensurePolled=function(){this.forceCompositionEnd()};Js.prototype.reset=function(){this.forceCompositionEnd()};Js.prototype.forceCompositionEnd=function(){if(!this.composing){return}clearTimeout(this.readDOMTimeout);this.composing=null;this.updateFromDOM();this.div.blur();this.div.focus()};Js.prototype.readFromDOMSoon=function(){var e=this;if(null!=this.readDOMTimeout){return}this.readDOMTimeout=setTimeout(function(){e.readDOMTimeout=null;if(e.composing){if(e.composing.done){e.composing=null}else{return}}e.updateFromDOM()},80)};Js.prototype.updateFromDOM=function(){var e=this;if(this.cm.isReadOnly()||!this.pollContent()){yn(this.cm,function(){return Cn(e.cm)})}};Js.prototype.setUneditable=function(e){e.contentEditable="false"};Js.prototype.onKeyPress=function(t){if(0==t.charCode||this.composing){return}t.preventDefault();if(!this.cm.isReadOnly()){xn(this.cm,tl)(this.cm,String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),0)}};Js.prototype.readOnlyChanged=function(e){this.div.contentEditable=("nocursor"!=e)+""};Js.prototype.onContextMenu=function(){};Js.prototype.resetPosition=function(){};Js.prototype.needsContentAttribute=!0;function al(e,t){var i=_t(e,t.line);if(!i||i.hidden){return null}var n=A(e.doc,t.line),o=Kt(i,n,t.line),r=Ne(n,e.doc.direction),l="left";if(r){var s=Te(r,t.ch);l=s%2?"right":"left"}var d=Qt(o.map,t.ch,l);d.offset="right"==d.collapse?d.end:d.start;return d}function pl(e){for(var t=e;t;t=t.parentNode){if(/CodeMirror-gutter-wrapper/.test(t.className)){return!0}}return!1}function cl(e,t){if(t){e.bad=!0}return e}function hl(e,t,i,n,o){var a="",p=!1,c=e.doc.lineSeparator(),h=!1;function r(e){return function(t){return t.id==e}}function l(){if(p){a+=c;if(h){a+=c}p=h=!1}}function s(e){if(e){l();a+=e}}function d(t){if(1==t.nodeType){var a=t.getAttribute("cm-text");if(a){s(a);return}var g=t.getAttribute("cm-marker"),u;if(g){var f=e.findMarks(z(n,0),z(o+1,0),r(+g));if(f.length&&(u=f[0].find(0))){s(M(e.doc,u.from,u.to).join(c))}return}if("false"==t.getAttribute("contenteditable")){return}var m=/^(pre|div|p|li|table|br)$/i.test(t.nodeName);if(!/^br$/i.test(t.nodeName)&&0==t.textContent.length){return}if(m){l()}for(var y=0;y<t.childNodes.length;y++){d(t.childNodes[y])}if(/^(pre|p)$/i.test(t.nodeName)){h=!0}if(m){p=!0}}else if(3==t.nodeType){s(t.nodeValue.replace(/\u200b/g,"").replace(/\u00a0/g," "))}}for(;;){d(t);if(t==i){break}t=t.nextSibling;h=!1}return a}function gl(e,t,n){var o;if(t==e.display.lineDiv){o=e.display.lineDiv.childNodes[n];if(!o){return cl(e.clipPos(z(e.display.viewTo-1)),!0)}t=null;n=0}else{for(o=t;;o=o.parentNode){if(!o||o==e.display.lineDiv){return null}if(o.parentNode&&o.parentNode==e.display.lineDiv){break}}}for(var r=0,l;r<e.display.view.length;r++){l=e.display.view[r];if(l.node==o){return ul(l,t,n)}}}function ul(e,t,i){var o=e.text.firstChild,r=!1;if(!t||!l(o,t)){return cl(z(H(e.line),0),!0)}if(t==o){r=!0;t=o.childNodes[i];i=0;if(!t){var s=e.rest?y(e.rest):e.line;return cl(z(H(s),s.text.length),r)}}var d=3==t.nodeType?t:null,a=t;if(!d&&1==t.childNodes.length&&3==t.firstChild.nodeType){d=t.firstChild;if(i){i=d.nodeValue.length}}while(a.parentNode!=o){a=a.parentNode}var p=e.measure,c=p.maps;function n(t,n,o){for(var r=-1,l;r<(c?c.length:0);r++){l=0>r?p.map:c[r];for(var s=0,d;s<l.length;s+=3){d=l[s+2];if(d==t||d==n){var a=H(0>r?e.line:e.rest[r]),h=l[s]+o;if(0>o||d!=t){h=l[s+(o?1:0)]}return z(a,h)}}}}var h=n(d,a,i);if(h){return cl(h,r)}for(var g=a.nextSibling,u=d?d.nodeValue.length-i:0;g;g=g.nextSibling){h=n(g,g.firstChild,0);if(h){return cl(z(h.line,h.ch-u),r)}else{u+=g.textContent.length}}for(var f=a.previousSibling,m=i;f;f=f.previousSibling){h=n(f,f.firstChild,-1);if(h){return cl(z(h.line,h.ch+m),r)}else{m+=f.textContent.length}}}var ed=function(e){this.cm=e;this.prevInput="";this.pollingFast=!1;this.polling=new Gl;this.hasSelection=!1;this.composing=null};ed.prototype.init=function(t){var n=this,o=this,r=this.cm;this.createField(t);var e=this.textarea;t.wrapper.insertBefore(this.wrapper,t.wrapper.firstChild);if(Al){e.style.width="0px"}es(e,"input",function(){if(Cl&&9<=ie&&n.hasSelection){n.hasSelection=null}o.poll()});es(e,"paste",function(t){if(We(r,t)||il(t,r)){return}r.state.pasteIncoming=!0;o.fastPoll()});function i(t){if(We(r,t)){return}if(r.somethingSelected()){el({lineWise:!1,text:r.getSelections()})}else if(!r.options.lineWiseCopyCut){return}else{var i=ol(r);el({lineWise:!0,text:i.text});if("cut"==t.type){r.setSelections(i.ranges,null,Ul)}else{o.prevInput="";e.value=i.text.join("\n");Bl(e)}}if("cut"==t.type){r.state.cutIncoming=!0}}es(e,"cut",i);es(e,"copy",i);es(t.scroller,"paste",function(i){if(Et(t,i)||We(r,i)){return}r.state.pasteIncoming=!0;o.focus()});es(t.lineSpace,"selectstart",function(i){if(!Et(t,i)){Pe(i)}});es(e,"compositionstart",function(){var e=r.getCursor("from");if(o.composing){o.composing.range.clear()}o.composing={start:e,range:r.markText(e,r.getCursor("to"),{className:"CodeMirror-composing"})}});es(e,"compositionend",function(){if(o.composing){o.poll();o.composing.range.clear();o.composing=null}})};ed.prototype.createField=function(){this.wrapper=ll();this.textarea=this.wrapper.firstChild};ed.prototype.prepareSelection=function(){var e=this.cm,t=e.display,i=e.doc,n=Mi(e);if(e.options.moveInputWithCursor){var o=ci(e,i.sel.primary().head,"div"),r=t.wrapper.getBoundingClientRect(),l=t.lineDiv.getBoundingClientRect();n.teTop=Math.max(0,Math.min(t.wrapper.clientHeight-10,o.top+l.top-r.top));n.teLeft=Math.max(0,Math.min(t.wrapper.clientWidth-10,o.left+l.left-r.left))}return n};ed.prototype.showSelection=function(e){var t=this.cm,i=t.display;n(i.cursorDiv,e.cursors);n(i.selectionDiv,e.selection);if(null!=e.teTop){this.wrapper.style.top=e.teTop+"px";this.wrapper.style.left=e.teLeft+"px"}};ed.prototype.reset=function(e){if(this.contextMenuPending||this.composing){return}var t=this.cm;if(t.somethingSelected()){this.prevInput="";var i=t.getSelection();this.textarea.value=i;if(t.state.focused){Bl(this.textarea)}if(Cl&&9<=ie){this.hasSelection=i}}else if(!e){this.prevInput=this.textarea.value="";if(Cl&&9<=ie){this.hasSelection=null}}};ed.prototype.getField=function(){return this.textarea};ed.prototype.supportsTouch=function(){return!1};ed.prototype.focus=function(){if("nocursor"!=this.cm.options.readOnly&&(!Wl||s()!=this.textarea)){try{this.textarea.focus()}catch(t){}}};ed.prototype.blur=function(){this.textarea.blur()};ed.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0};ed.prototype.receivedFocus=function(){this.slowPoll()};ed.prototype.slowPoll=function(){var e=this;if(this.pollingFast){return}this.polling.set(this.cm.options.pollInterval,function(){e.poll();if(e.cm.state.focused){e.slowPoll()}})};ed.prototype.fastPoll=function(){var t=!1,i=this;i.pollingFast=!0;function e(){var n=i.poll();if(!n&&!t){t=!0;i.polling.set(60,e)}else{i.pollingFast=!1;i.slowPoll()}}i.polling.set(20,e)};ed.prototype.poll=function(){var e=this,t=this.cm,i=this.textarea,n=this.prevInput;if(this.contextMenuPending||!t.state.focused||ns(i)&&!n&&!this.composing||t.isReadOnly()||t.options.disableInput||t.state.keySeq){return!1}var o=i.value;if(o==n&&!t.somethingSelected()){return!1}if(Cl&&9<=ie&&this.hasSelection===o||Dl&&/[\uf700-\uf7ff]/.test(o)){t.display.input.reset();return!1}if(t.doc.sel==t.display.selForContextMenu){var r=o.charCodeAt(0);if(8203==r&&!n){n="\u200B"}if(8666==r){this.reset();return this.cm.execCommand("undo")}}var s=0,d=Math.min(n.length,o.length);while(s<d&&n.charCodeAt(s)==o.charCodeAt(s)){++s}yn(t,function(){tl(t,o.slice(s),n.length-s,null,e.composing?"*compose":null);if(1e3<o.length||-1<o.indexOf("\n")){i.value=e.prevInput=""}else{e.prevInput=o}if(e.composing){e.composing.range.clear();e.composing.range=t.markText(e.composing.start,t.getCursor("to"),{className:"CodeMirror-composing"})}});return!0};ed.prototype.ensurePolled=function(){if(this.pollingFast&&this.poll()){this.pollingFast=!1}};ed.prototype.onKeyPress=function(){if(Cl&&9<=ie){this.hasSelection=null}this.fastPoll()};ed.prototype.onContextMenu=function(t){var n=this,o=n.cm,r=o.display,l=n.textarea,s=Ni(o,t),d=r.scroller.scrollTop;if(!s||kl){return}var a=o.options.resetSelectionOnContextMenu;if(a&&-1==o.doc.sel.contains(s)){xn(o,ko)(o.doc,jn(s),Ul)}var p=l.style.cssText,c=n.wrapper.style.cssText;n.wrapper.style.cssText="position: absolute";var h=n.wrapper.getBoundingClientRect();l.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+(t.clientY-h.top-5)+"px; left: "+(t.clientX-h.left-5)+"px;\n      z-index: 1000; background: "+(Cl?"rgba(255, 255, 255, .05)":"transparent")+";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";var g;if(wl){g=window.scrollY}r.input.focus();if(wl){window.scrollTo(null,g)}r.input.reset();if(!o.somethingSelected()){l.value=n.prevInput=" "}n.contextMenuPending=!0;r.selForContextMenu=o.doc.sel;clearTimeout(r.detectingSelectAll);function e(){if(null!=l.selectionStart){var e=o.somethingSelected(),t="\u200B"+(e?l.value:"");l.value="\u21DA";l.value=t;n.prevInput=e?"":"\u200B";l.selectionStart=1;l.selectionEnd=t.length;r.selForContextMenu=o.doc.sel}}function i(){n.contextMenuPending=!1;n.wrapper.style.cssText=c;l.style.cssText=p;if(Cl&&9>ie){r.scrollbars.setScrollTop(r.scroller.scrollTop=d)}if(null!=l.selectionStart){if(!Cl||Cl&&9>ie){e()}var t=0,s=function(){if(r.selForContextMenu==o.doc.sel&&0==l.selectionStart&&0<l.selectionEnd&&"\u200B"==n.prevInput){xn(o,Ho)(o)}else if(10>t++){r.detectingSelectAll=setTimeout(s,500)}else{r.selForContextMenu=null;r.input.reset()}};r.detectingSelectAll=setTimeout(s,200)}}if(Cl&&9<=ie){e()}if(zl){Ee(t);var u=function(){Ae(window,"mouseup",u);setTimeout(i,20)};es(window,"mouseup",u)}else{setTimeout(i,50)}};ed.prototype.readOnlyChanged=function(e){if(!e){this.reset()}this.textarea.disabled="nocursor"==e};ed.prototype.setUneditable=function(){};ed.prototype.needsContentAttribute=!1;(function(e){var i=e.optionHandlers;function t(t,n,o,r){e.defaults[t]=n;if(o){i[t]=r?function(e,t,i){if(i!=Ys){o(e,t,i)}}:o}}e.defineOption=t;e.Init=Ys;t("value","",function(e,t){return e.setValue(t)},!0);t("mode",null,function(e,t){e.doc.modeOption=t;qn(e)},!0);t("indentUnit",2,qn,!0);t("indentWithTabs",!1);t("smartIndent",!0);t("tabSize",4,function(e){Zn(e);oi(e);Cn(e)},!0);t("lineSeparator",null,function(e,t){e.doc.lineSep=t;if(!t){return}var n=[],o=e.doc.first;e.doc.iter(function(e){for(var i=0,r;;){r=e.text.indexOf(t,i);if(-1==r){break}i=r+t.length;n.push(z(o,r))}o++});for(var r=n.length-1;0<=r;r--){Go(e.doc,t,n[r],z(n[r].line,n[r].ch+t.length))}});t("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff]/g,function(e,t,i){e.state.specialChars=new RegExp(t.source+(t.test("\t")?"":"|\t"),"g");if(i!=Ys){e.refresh()}});t("specialCharPlaceholder",ht,function(e){return e.refresh()},!0);t("electricChars",!0);t("inputStyle",Wl?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},!0);t("spellcheck",!1,function(e,t){return e.getInputField().spellcheck=t},!0);t("rtlMoveVisually",!Fl);t("wholeLineUpdateBefore",!0);t("theme","default",function(e){Xr(e);Yr(e)},!0);t("keyMap","default",function(e,t,i){var n=fr(t),o=i!=Ys&&fr(i);if(o&&o.detach){o.detach(e,n)}if(n.attach){n.attach(e,o||null)}});t("extraKeys",null);t("configureMouse",null);t("lineWrapping",!1,qr,!0);t("gutters",[],function(e){Rn(e.options);Yr(e)},!0);t("fixedGutter",!0,function(e,t){e.display.gutters.style.left=t?Li(e.display)+"px":"0";e.refresh()},!0);t("coverGutterNextToScrollbar",!1,function(e){return ln(e)},!0);t("scrollbarStyle","native",function(e){dn(e);ln(e);e.display.scrollbars.setScrollTop(e.doc.scrollTop);e.display.scrollbars.setScrollLeft(e.doc.scrollLeft)},!0);t("lineNumbers",!1,function(e){Rn(e.options);Yr(e)},!0);t("firstLineNumber",1,Yr,!0);t("lineNumberFormatter",function(e){return e},Yr,!0);t("showCursorWhenSelecting",!1,Ai,!0);t("resetSelectionOnContextMenu",!0);t("lineWiseCopyCut",!0);t("pasteLinesPerSelection",!0);t("selectionsMayTouch",!1);t("readOnly",!1,function(e,t){if("nocursor"==t){Ei(e);e.display.input.blur()}e.display.input.readOnlyChanged(t)});t("disableInput",!1,function(e,t){if(!t){e.display.input.reset()}},!0);t("dragDrop",!0,_r);t("allowDropFileTypes",null);t("cursorBlinkRate",530);t("cursorScrollMargin",0);t("cursorHeight",1,Ai,!0);t("singleCursorHeightPerLine",!0,Ai,!0);t("workTime",100);t("workDelay",100);t("flattenSpans",!0,Zn,!0);t("addModeClass",!1,Zn,!0);t("pollInterval",100);t("undoDepth",200,function(e,t){return e.doc.history.undoDepth=t});t("historyEventDelay",1250);t("viewportMargin",10,function(e){return e.refresh()},!0);t("maxHighlightLength",1e4,Zn,!0);t("moveInputWithCursor",!0,function(e,t){if(!t){e.display.input.resetPosition()}});t("tabindex",null,function(e,t){return e.display.input.getField().tabIndex=t||""});t("autofocus",null);t("direction","ltr",function(e,t){return e.doc.setDirection(t)},!0);t("phrases",null)})(Zr);(function(e){var t=e.optionHandlers,n=e.helpers={};e.prototype={constructor:e,focus:function focus(){window.focus();this.display.input.focus()},setOption:function setOption(e,i){var n=this.options,o=n[e];if(n[e]==i&&"mode"!=e){return}n[e]=i;if(t.hasOwnProperty(e)){xn(this,t[e])(this,i,o)}Me(this,"optionChange",this,e)},getOption:function getOption(e){return this.options[e]},getDoc:function getDoc(){return this.doc},addKeyMap:function addKeyMap(e,t){this.state.keyMaps[t?"push":"unshift"](fr(e))},removeKeyMap:function removeKeyMap(e){for(var t=this.state.keyMaps,n=0;n<t.length;++n){if(t[n]==e||t[n].name==e){t.splice(n,1);return!0}}},addOverlay:vn(function(t,i){var n=t.token?t:e.getMode(this.options,t);if(n.startState){throw new Error("Overlays may not be stateful.")}v(this.state.overlays,{mode:n,modeSpec:t,opaque:i&&i.opaque,priority:i&&i.priority||0},function(e){return e.priority});this.state.modeGen++;Cn(this)}),removeOverlay:vn(function(e){for(var t=this.state.overlays,n=0,o;n<t.length;++n){o=t[n].modeSpec;if(o==e||"string"==typeof e&&o.name==e){t.splice(n,1);this.state.modeGen++;Cn(this);return}}}),indentLine:vn(function(e,t,i){if("string"!=typeof t&&"number"!=typeof t){if(null==t){t=this.options.smartIndent?"smart":"prev"}else{t=t?"add":"subtract"}}if(P(this.doc,e)){Jr(this,e,t,i)}}),indentSelection:vn(function(e){for(var t=this.doc.sel.ranges,n=-1,o=0,r;o<t.length;o++){r=t[o];if(!r.empty()){var l=r.from(),s=r.to(),d=Math.max(n,l.line);n=Math.min(this.lastLine(),s.line-(s.ch?0:1))+1;for(var a=d;a<n;++a){Jr(this,a,e)}var p=this.doc.sel.ranges;if(0==l.ch&&t.length==p.length&&0<p[o].from().ch){Co(this.doc,o,new Os(l,p[o].to()),Ul)}}else if(r.head.line>n){Jr(this,r.head.line,e,!0);n=r.head.line;if(o==this.doc.sel.primIndex){_i(this)}}}}),getTokenAt:function getTokenAt(e,t){return nt(this,e,t)},getLineTokens:function getLineTokens(e,t){return nt(this,z(e),t,!0)},getTokenTypeAt:function getTokenTypeAt(e){e=j(this.doc,e);var t=Qe(this,A(this.doc,e.line)),i=0,n=(t.length-1)/2,o=e.ch,r;if(0==o){r=t[2]}else{for(;;){var l=i+n>>1;if((l?t[2*l-1]:0)>=o){n=l}else if(t[2*l+1]<o){i=l+1}else{r=t[2*l+2];break}}}var s=r?r.indexOf("overlay "):-1;return 0>s?r:0==s?null:r.slice(0,s-1)},getModeAt:function getModeAt(t){var i=this.doc.mode;if(!i.innerMode){return i}return e.innerMode(i,this.getTokenAt(t).state).mode},getHelper:function getHelper(e,t){return this.getHelpers(e,t)[0]},getHelpers:function getHelpers(e,t){var o=[];if(!n.hasOwnProperty(t)){return o}var r=n[t],l=this.getModeAt(e);if("string"==typeof l[t]){if(r[l[t]]){o.push(r[l[t]])}}else if(l[t]){for(var s=0,d;s<l[t].length;s++){d=r[l[t][s]];if(d){o.push(d)}}}else if(l.helperType&&r[l.helperType]){o.push(r[l.helperType])}else if(r[l.name]){o.push(r[l.name])}for(var a=0,p;a<r._global.length;a++){p=r._global[a];if(p.pred(l,this)&&-1==g(o,p.val)){o.push(p.val)}}return o},getStateAfter:function getStateAfter(e,t){var i=this.doc;e=U(i,null==e?i.first+i.size-1:e);return Je(this,e+1,t).state},cursorCoords:function cursorCoords(e,t){var i,n=this.doc.sel.primary();if(null==e){i=n.head}else if("object"==_typeof(e)){i=j(this.doc,e)}else{i=e?n.from():n.to()}return ci(this,i,t||"page")},charCoords:function charCoords(e,t){return pi(this,j(this.doc,e),t||"page")},coordsChar:function coordsChar(e,t){e=ai(this,e,t||"page");return ui(this,e.left,e.top)},lineAtHeight:function lineAtHeight(e,t){e=ai(this,{top:e,left:0},t||"page").top;return F(this.doc,e+this.display.viewOffset)},heightAtLine:function heightAtLine(e,t,i){var n=!1,o;if("number"==typeof e){var r=this.doc.first+this.doc.size-1;if(e<this.doc.first){e=this.doc.first}else if(e>r){e=r;n=!0}o=A(this.doc,e)}else{o=e}return di(this,o,{top:0,left:0},t||"page",i||n).top+(n?this.doc.height-we(o):0)},defaultTextHeight:function defaultTextHeight(){return Ci(this.display)},defaultCharWidth:function defaultCharWidth(){return wi(this.display)},getViewport:function getViewport(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function addWidget(e,t,i,n,o){var r=this.display;e=ci(this,j(this.doc,e));var l=e.bottom,s=e.left;t.style.position="absolute";t.setAttribute("cm-ignore-events","true");this.display.input.setUneditable(t);r.sizer.appendChild(t);if("over"==n){l=e.top}else if("above"==n||"near"==n){var d=Math.max(r.wrapper.clientHeight,this.doc.height),a=Math.max(r.sizer.clientWidth,r.lineSpace.clientWidth);if(("above"==n||e.bottom+t.offsetHeight>d)&&e.top>t.offsetHeight){l=e.top-t.offsetHeight}else if(e.bottom+t.offsetHeight<=d){l=e.bottom}if(s+t.offsetWidth>a){s=a-t.offsetWidth}}t.style.top=l+"px";t.style.left=t.style.right="";if("right"==o){s=r.sizer.clientWidth-t.offsetWidth;t.style.right="0px"}else{if("left"==o){s=0}else if("middle"==o){s=(r.sizer.clientWidth-t.offsetWidth)/2}t.style.left=s+"px"}if(i){Ki(this,{left:s,top:l,right:s+t.offsetWidth,bottom:l+t.offsetHeight})}},triggerOnKeyDown:vn(Mr),triggerOnKeyPress:vn(Hr),triggerOnKeyUp:Dr,triggerOnMouseDown:vn(Pr),execCommand:function execCommand(e){if($s.hasOwnProperty(e)){return $s[e].call(null,this)}},triggerElectric:vn(function(e){nl(this,e)}),findPosH:function findPosH(e,t,n,o){var r=1;if(0>t){r=-1;t=-t}for(var l=j(this.doc,e),s=0;s<t;++s){l=sl(this.doc,l,r,n,o);if(l.hitSide){break}}return l},moveH:vn(function(e,t){var i=this;this.extendSelectionsBy(function(n){if(i.display.shift||i.doc.extend||n.empty()){return sl(i.doc,n.head,e,t,i.options.rtlMoveVisually)}else{return 0>e?n.from():n.to()}},Vl)}),deleteH:vn(function(e,t){var i=this.doc.sel,n=this.doc;if(i.somethingSelected()){n.replaceSelection("",null,"+delete")}else{mr(this,function(i){var o=sl(n,i.head,e,t,!1);return 0>e?{from:o,to:i.head}:{from:i.head,to:o}})}}),findPosV:function findPosV(e,t,n,o){var r=1,l=o;if(0>t){r=-1;t=-t}for(var s=j(this.doc,e),d=0,a;d<t;++d){a=ci(this,s,"div");if(null==l){l=a.left}else{a.left=l}s=dl(this,a,r,n);if(s.hitSide){break}}return s},moveV:vn(function(e,t){var n=this,o=this.doc,r=[],l=!this.display.shift&&!o.extend&&o.sel.somethingSelected();o.extendSelectionsBy(function(i){if(l){return 0>e?i.from():i.to()}var s=ci(n,i.head,"div");if(null!=i.goalColumn){s.left=i.goalColumn}r.push(s.left);var d=dl(n,s,e,t);if("page"==t&&i==o.sel.primary()){Yi(n,pi(n,d,"div").top-s.top)}return d},Vl);if(r.length){for(var s=0;s<o.sel.ranges.length;s++){o.sel.ranges[s].goalColumn=r[s]}}}),findWordAt:function findWordAt(e){var t=this.doc,i=A(t,e.line).text,n=e.ch,o=e.ch;if(i){var r=this.getHelper(e,"wordChars");if(("before"==e.sticky||o==i.length)&&n){--n}else{++o}var l=i.charAt(n),s=S(l,r)?function(e){return S(e,r)}:/\s/.test(l)?function(e){return /\s/.test(e)}:function(e){return!/\s/.test(e)&&!S(e)};while(0<n&&s(i.charAt(n-1))){--n}while(o<i.length&&s(i.charAt(o))){++o}}return new Os(z(e.line,n),z(e.line,o))},toggleOverwrite:function toggleOverwrite(e){if(null!=e&&e==this.state.overwrite){return}if(this.state.overwrite=!this.state.overwrite){d(this.display.cursorDiv,"CodeMirror-overwrite")}else{El(this.display.cursorDiv,"CodeMirror-overwrite")}Me(this,"overwriteToggle",this,this.state.overwrite)},hasFocus:function hasFocus(){return this.display.input.getField()==s()},isReadOnly:function isReadOnly(){return!!(this.options.readOnly||this.doc.cantEdit)},scrollTo:vn(function(e,t){qi(this,e,t)}),getScrollInfo:function getScrollInfo(){var e=this.display.scroller;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-$t(this)-this.display.barHeight,width:e.scrollWidth-$t(this)-this.display.barWidth,clientHeight:jt(this),clientWidth:Ut(this)}},scrollIntoView:vn(function(e,t){if(null==e){e={from:this.doc.sel.primary().head,to:null};if(null==t){t=this.options.cursorScrollMargin}}else if("number"==typeof e){e={from:z(e,0),to:null}}else if(null==e.from){e={from:e,to:null}}if(!e.to){e.to=e.from}e.margin=t||0;if(null!=e.from.line){Zi(this,e)}else{Ji(this,e.from,e.to,e.margin)}}),setSize:vn(function(e,t){var i=this,n=function(e){return"number"==typeof e||/^\d+$/.test(e+"")?e+"px":e};if(null!=e){this.display.wrapper.style.width=n(e)}if(null!=t){this.display.wrapper.style.height=n(t)}if(this.options.lineWrapping){ni(this)}var o=this.display.viewFrom;this.doc.iter(o,this.display.viewTo,function(e){if(e.widgets){for(var t=0;t<e.widgets.length;t++){if(e.widgets[t].noHScroll){wn(i,o,"widget");break}}}++o});this.curOp.forceUpdate=!0;Me(this,"refresh",this)}),operation:function(e){return yn(this,e)},startOperation:function startOperation(){return an(this)},endOperation:function endOperation(){return pn(this)},refresh:vn(function(){var e=this.display.cachedTextHeight;Cn(this);this.curOp.forceUpdate=!0;oi(this);qi(this,this.doc.scrollLeft,this.doc.scrollTop);In(this);if(null==e||.5<Math.abs(e-Ci(this.display))){Ti(this)}Me(this,"refresh",this)}),swapDoc:vn(function(e){var t=this.doc;t.cm=null;to(this,e);oi(this);this.display.input.reset();qi(this,e.scrollLeft,e.scrollTop);this.curOp.forceScroll=!0;St(this,"swapDoc",this,t);return t}),phrase:function phrase(e){var t=this.options.phrases;return t&&Object.prototype.hasOwnProperty.call(t,e)?t[e]:e},getInputField:function getInputField(){return this.display.input.getField()},getWrapperElement:function getWrapperElement(){return this.display.wrapper},getScrollerElement:function getScrollerElement(){return this.display.scroller},getGutterElement:function getGutterElement(){return this.display.gutters}};Fe(e);e.registerHelper=function(t,i,o){if(!n.hasOwnProperty(t)){n[t]=e[t]={_global:[]}}n[t][i]=o};e.registerGlobalHelper=function(t,i,o,r){e.registerHelper(t,i,r);n[t]._global.push({pred:o,val:r})}})(Zr);var td=["iter","insert","remove","copy","getEditor","constructor"];for(var id in Fs.prototype){if(Fs.prototype.hasOwnProperty(id)&&0>g(td,id)){Zr.prototype[id]=function(e){return function(){return e.apply(this.doc,arguments)}}(Fs.prototype[id])}}Fe(Fs);Zr.inputStyles={textarea:ed,contenteditable:Js};Zr.defineMode=function(e){if(!Zr.defaults.mode&&"null"!=e){Zr.defaults.mode=e}je.apply(this,arguments)};Zr.defineMIME=function(e,t){ss[e]=t};Zr.defineMode("null",function(){return{token:function token(e){return e.skipToEnd()}}});Zr.defineMIME("text/plain","null");Zr.defineExtension=function(e,t){Zr.prototype[e]=t};Zr.defineDocExtension=function(e,t){Fs.prototype[e]=t};Zr.fromTextArea=function(e,t){t=t?c(t):{};t.value=e.value;if(!t.tabindex&&e.tabIndex){t.tabindex=e.tabIndex}if(!t.placeholder&&e.placeholder){t.placeholder=e.placeholder}if(null==t.autofocus){var n=s();t.autofocus=n==e||null!=e.getAttribute("autofocus")&&n==document.body}function i(){e.value=d.getValue()}var o;if(e.form){es(e.form,"submit",i);if(!t.leaveSubmitMethodAlone){var r=e.form;o=r.submit;try{var l=r.submit=function(){i();r.submit=o;r.submit();r.submit=l}}catch(t){}}}t.finishInit=function(t){t.save=i;t.getTextArea=function(){return e};t.toTextArea=function(){t.toTextArea=isNaN;i();e.parentNode.removeChild(t.getWrapperElement());e.style.display="";if(e.form){Ae(e.form,"submit",i);if("function"==typeof e.form.submit){e.form.submit=o}}}};e.style.display="none";var d=Zr(function(t){return e.parentNode.insertBefore(t,e.nextSibling)},t);return d};(function(e){e.off=Ae;e.on=es;e.wheelEventPixels=Gn;e.Doc=Fs;e.splitLines=is;e.countColumn=h;e.findColumn=u;e.isWordChar=w;e.Pass=$l;e.signal=Me;e.Line=gs;e.changeEnd=Vn;e.scrollbarModel=ws;e.Pos=z;e.cmpPos=E;e.modes=ls;e.mimeModes=ss;e.resolveMode=Ve;e.getMode=Ke;e.modeExtensions=ds;e.extendMode=Xe;e.copyState=Ye;e.startState=qe;e.innerMode=_e;e.commands=$s;e.keyMap=Gs;e.keyName=ur;e.isModifierKey=hr;e.lookupKey=cr;e.normalizeKeyMap=pr;e.StringStream=as;e.SharedTextMarker=Ds;e.TextMarker=Ws;e.LineWidget=As;e.e_preventDefault=Pe;e.e_stopPropagation=Ie;e.e_stop=Ee;e.addClass=d;e.contains=l;e.rmClass=El;e.keyNames=zs})(Zr);Zr.version="5.41.0";return Zr});
function _typeof(e){if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(e){return typeof e}}else{_typeof=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return _typeof(e)}(function(window,document,undefined){(function(e){"use strict";if("function"==typeof define&&define.amd){define ("block_configurable_reports/jquery.dataTables",["jquery"],e)}else if(jQuery&&!jQuery.fn.dataTable){e(jQuery)}})(function($){"use strict";var DataTable=function(oInit){function _fnAddColumn(e,a){var t=DataTable.defaults.columns,n=e.aoColumns.length,i=$.extend({},DataTable.models.oColumn,t,{sSortingClass:e.oClasses.sSortable,sSortingClassJUI:e.oClasses.sSortJUI,nTh:a?a:document.createElement("th"),sTitle:t.sTitle?t.sTitle:a?a.innerHTML:"",aDataSort:t.aDataSort?t.aDataSort:[n],mData:t.mData?t.oDefaults:n});e.aoColumns.push(i);if(e.aoPreSearchCols[n]===void 0||null===e.aoPreSearchCols[n]){e.aoPreSearchCols[n]=$.extend({},DataTable.models.oSearch)}else{var s=e.aoPreSearchCols[n];if(s.bRegex===void 0){s.bRegex=!0}if(s.bSmart===void 0){s.bSmart=!0}if(s.bCaseInsensitive===void 0){s.bCaseInsensitive=!0}}_fnColumnOptions(e,n,null)}function _fnColumnOptions(e,a,t){var n=e.aoColumns[a];if(t!==void 0&&null!==t){if(t.mDataProp&&!t.mData){t.mData=t.mDataProp}if(t.sType!==void 0){n.sType=t.sType;n._bAutoType=!1}$.extend(n,t);_fnMap(n,t,"sWidth","sWidthOrig");if(t.iDataSort!==void 0){n.aDataSort=[t.iDataSort]}_fnMap(n,t,"aDataSort")}var i=n.mRender?_fnGetObjectDataFn(n.mRender):null,s=_fnGetObjectDataFn(n.mData);n.fnGetData=function(e,a){var t=s(e,a);if(n.mRender&&a&&""!==a){return i(t,a,e)}return t};n.fnSetData=_fnSetObjectDataFn(n.mData);if(!e.oFeatures.bSort){n.bSortable=!1}if(!n.bSortable||-1==$.inArray("asc",n.asSorting)&&-1==$.inArray("desc",n.asSorting)){n.sSortingClass=e.oClasses.sSortableNone;n.sSortingClassJUI=""}else if(-1==$.inArray("asc",n.asSorting)&&-1==$.inArray("desc",n.asSorting)){n.sSortingClass=e.oClasses.sSortable;n.sSortingClassJUI=e.oClasses.sSortJUI}else if(-1!=$.inArray("asc",n.asSorting)&&-1==$.inArray("desc",n.asSorting)){n.sSortingClass=e.oClasses.sSortableAsc;n.sSortingClassJUI=e.oClasses.sSortJUIAscAllowed}else if(-1==$.inArray("asc",n.asSorting)&&-1!=$.inArray("desc",n.asSorting)){n.sSortingClass=e.oClasses.sSortableDesc;n.sSortingClassJUI=e.oClasses.sSortJUIDescAllowed}}function _fnAdjustColumnSizing(e){if(!1===e.oFeatures.bAutoWidth){return!1}_fnCalculateColumnWidths(e);for(var a=0,t=e.aoColumns.length;a<t;a++){e.aoColumns[a].nTh.style.width=e.aoColumns[a].sWidth}}function _fnVisibleToColumnIndex(e,a){var t=_fnGetColumns(e,"bVisible");return"number"==typeof t[a]?t[a]:null}function _fnColumnIndexToVisible(e,a){var t=_fnGetColumns(e,"bVisible"),n=$.inArray(a,t);return-1!==n?n:null}function _fnVisbleColumns(e){return _fnGetColumns(e,"bVisible").length}function _fnGetColumns(e,t){var n=[];$.map(e.aoColumns,function(e,a){if(e[t]){n.push(a)}});return n}function _fnDetectType(e){for(var a=DataTable.ext.aTypes,t=a.length,n=0,s;n<t;n++){s=a[n](e);if(null!==s){return s}}return"string"}function _fnReOrderIndex(e,a){for(var t=a.split(","),n=[],s=0,o=e.aoColumns.length;s<o;s++){for(var l=0;l<o;l++){if(e.aoColumns[s].sName==t[l]){n.push(l);break}}}return n}function _fnColumnOrdering(e){for(var a="",t=0,n=e.aoColumns.length;t<n;t++){a+=e.aoColumns[t].sName+","}if(a.length==n){return""}return a.slice(0,-1)}function _fnApplyColumnDefs(e,a,t,n){var s,o,l,r,d,u;if(a){for(s=a.length-1;0<=s;s--){var p=a[s].aTargets;if(!$.isArray(p)){_fnLog(e,1,"aTargets must be an array of targets, not a "+_typeof(p))}for(l=0,r=p.length;l<r;l++){if("number"==typeof p[l]&&0<=p[l]){while(e.aoColumns.length<=p[l]){_fnAddColumn(e)}n(p[l],a[s])}else if("number"==typeof p[l]&&0>p[l]){n(e.aoColumns.length+p[l],a[s])}else if("string"==typeof p[l]){for(d=0,u=e.aoColumns.length;d<u;d++){if("_all"==p[l]||$(e.aoColumns[d].nTh).hasClass(p[l])){n(d,a[s])}}}}}}if(t){for(s=0,o=t.length;s<o;s++){n(s,t[s])}}}function _fnAddData(e,a){var t,n=$.isArray(a)?a.slice():$.extend(!0,{},a),s=e.aoData.length,o=$.extend(!0,{},DataTable.models.oRow);o._aData=n;e.aoData.push(o);for(var l,r=0,d=e.aoColumns.length;r<d;r++){t=e.aoColumns[r];if("function"==typeof t.fnRender&&t.bUseRendered&&null!==t.mData){_fnSetCellData(e,s,r,_fnRender(e,s,r))}else{_fnSetCellData(e,s,r,_fnGetCellData(e,s,r))}if(t._bAutoType&&"string"!=t.sType){var u=_fnGetCellData(e,s,r,"type");if(null!==u&&""!==u){l=_fnDetectType(u);if(null===t.sType){t.sType=l}else if(t.sType!=l&&"html"!=t.sType){t.sType="string"}}}}e.aiDisplayMaster.push(s);if(!e.oFeatures.bDeferRender){_fnCreateTr(e,s)}return s}function _fnGatherData(e){var a,t,n,s,o,l,r,d,u,p,c,g,h,f,b;if(e.bDeferLoading||null===e.sAjaxSource){r=e.nTBody.firstChild;while(r){if("TR"==r.nodeName.toUpperCase()){d=e.aoData.length;r._DT_RowIndex=d;e.aoData.push($.extend(!0,{},DataTable.models.oRow,{nTr:r}));e.aiDisplayMaster.push(d);l=r.firstChild;n=0;while(l){h=l.nodeName.toUpperCase();if("TD"==h||"TH"==h){_fnSetCellData(e,d,n,$.trim(l.innerHTML));n++}l=l.nextSibling}}r=r.nextSibling}}o=_fnGetTrNodes(e);s=[];for(a=0,t=o.length;a<t;a++){l=o[a].firstChild;while(l){h=l.nodeName.toUpperCase();if("TD"==h||"TH"==h){s.push(l)}l=l.nextSibling}}for(c=0,g=e.aoColumns.length;c<g;c++){f=e.aoColumns[c];if(null===f.sTitle){f.sTitle=f.nTh.innerHTML}var S=f._bAutoType,C="function"==typeof f.fnRender,m=null!==f.sClass,D=f.bVisible,T,y,_,x;if(S||C||m||!D){for(u=0,p=e.aoData.length;u<p;u++){b=e.aoData[u];T=s[u*g+c];if(S&&"string"!=f.sType){x=_fnGetCellData(e,u,c,"type");if(""!==x){y=_fnDetectType(x);if(null===f.sType){f.sType=y}else if(f.sType!=y&&"html"!=f.sType){f.sType="string"}}}if(f.mRender){T.innerHTML=_fnGetCellData(e,u,c,"display")}else if(f.mData!==c){T.innerHTML=_fnGetCellData(e,u,c,"display")}if(C){_=_fnRender(e,u,c);T.innerHTML=_;if(f.bUseRendered){_fnSetCellData(e,u,c,_)}}if(m){T.className+=" "+f.sClass}if(!D){b._anHidden[c]=T;T.parentNode.removeChild(T)}else{b._anHidden[c]=null}if(f.fnCreatedCell){f.fnCreatedCell.call(e.oInstance,T,_fnGetCellData(e,u,c,"display"),b._aData,u,c)}}}}if(0!==e.aoRowCreatedCallback.length){for(a=0,t=e.aoData.length;a<t;a++){b=e.aoData[a];_fnCallbackFire(e,"aoRowCreatedCallback",null,[b.nTr,b._aData,a])}}}function _fnNodeToDataIndex(e,a){return a._DT_RowIndex!==void 0?a._DT_RowIndex:null}function _fnNodeToColumnIndex(e,a,t){for(var n=_fnGetTdNodes(e,a),s=0,o=e.aoColumns.length;s<o;s++){if(n[s]===t){return s}}return-1}function _fnGetRowData(e,a,t,n){for(var s=[],o=0,l=n.length;o<l;o++){s.push(_fnGetCellData(e,a,n[o],t))}return s}function _fnGetCellData(e,a,t,n){var i,s=e.aoColumns[t],o=e.aoData[a]._aData;if((i=s.fnGetData(o,n))===void 0){if(e.iDrawError!=e.iDraw&&null===s.sDefaultContent){_fnLog(e,0,"Requested unknown parameter "+("function"==typeof s.mData?"{mData function}":"'"+s.mData+"'")+" from the data source for row "+a);e.iDrawError=e.iDraw}return s.sDefaultContent}if(null===i&&null!==s.sDefaultContent){i=s.sDefaultContent}else if("function"==typeof i){return i()}if("display"==n&&null===i){return""}return i}function _fnSetCellData(e,a,t,n){var i=e.aoColumns[t],s=e.aoData[a]._aData;i.fnSetData(s,n)}var __reArray=/\[.*?\]$/;function _fnGetObjectDataFn(e){if(null===e){return function(){return null}}else if("function"==typeof e){return function(a,t,n){return e(a,t,n)}}else if("string"==typeof e&&(-1!==e.indexOf(".")||-1!==e.indexOf("["))){var a=function(e,t,n){var s=n.split("."),o,l,r;if(""!==n){for(var d=0,u=s.length;d<u;d++){o=s[d].match(__reArray);if(o){s[d]=s[d].replace(__reArray,"");if(""!==s[d]){e=e[s[d]]}l=[];s.splice(0,d+1);r=s.join(".");for(var p=0,c=e.length;p<c;p++){l.push(a(e[p],t,r))}var g=o[0].substring(1,o[0].length-1);e=""===g?l:l.join(g);break}if(null===e||e[s[d]]===void 0){return void 0}e=e[s[d]]}}return e};return function(t,n){return a(t,n,e)}}else{return function(a){return a[e]}}}function _fnSetObjectDataFn(e){if(null===e){return function(){}}else if("function"==typeof e){return function(a,t){e(a,"set",t)}}else if("string"==typeof e&&(-1!==e.indexOf(".")||-1!==e.indexOf("["))){var t=function(e,n,s){for(var l=s.split("."),a,r,d,u,p=0,c=l.length-1;p<c;p++){r=l[p].match(__reArray);if(r){l[p]=l[p].replace(__reArray,"");e[l[p]]=[];a=l.slice();a.splice(0,p+1);u=a.join(".");for(var g=0,h=n.length;g<h;g++){d={};t(d,n[g],u);e[l[p]].push(d)}return}if(null===e[l[p]]||e[l[p]]===void 0){e[l[p]]={}}e=e[l[p]]}e[l[l.length-1].replace(__reArray,"")]=n};return function(a,n){return t(a,n,e)}}else{return function(a,t){a[e]=t}}}function _fnGetDataMaster(e){for(var a=[],t=e.aoData.length,n=0;n<t;n++){a.push(e.aoData[n]._aData)}return a}function _fnClearTable(e){e.aoData.splice(0,e.aoData.length);e.aiDisplayMaster.splice(0,e.aiDisplayMaster.length);e.aiDisplay.splice(0,e.aiDisplay.length);_fnCalculateEnd(e)}function _fnDeleteIndex(e,a){for(var t=-1,n=0,s=e.length;n<s;n++){if(e[n]==a){t=n}else if(e[n]>a){e[n]--}}if(-1!=t){e.splice(t,1)}}function _fnRender(e,a,t){var n=e.aoColumns[t];return n.fnRender({iDataRow:a,iDataColumn:t,oSettings:e,aData:e.aoData[a]._aData,mDataProp:n.mData},_fnGetCellData(e,a,t,"display"))}function _fnCreateTr(e,a){var t=e.aoData[a],n;if(null===t.nTr){t.nTr=document.createElement("tr");t.nTr._DT_RowIndex=a;if(t._aData.DT_RowId){t.nTr.id=t._aData.DT_RowId}if(t._aData.DT_RowClass){t.nTr.className=t._aData.DT_RowClass}for(var s=0,o=e.aoColumns.length,l;s<o;s++){l=e.aoColumns[s];n=document.createElement(l.sCellType);n.innerHTML="function"==typeof l.fnRender&&(!l.bUseRendered||null===l.mData)?_fnRender(e,a,s):_fnGetCellData(e,a,s,"display");if(null!==l.sClass){n.className=l.sClass}if(l.bVisible){t.nTr.appendChild(n);t._anHidden[s]=null}else{t._anHidden[s]=n}if(l.fnCreatedCell){l.fnCreatedCell.call(e.oInstance,n,_fnGetCellData(e,a,s,"display"),t._aData,a,s)}}_fnCallbackFire(e,"aoRowCreatedCallback",null,[t.nTr,t._aData,a])}}function _fnBuildHead(e){var a,t,n,s=$("th, td",e.nTHead).length;if(0!==s){for(a=0,n=e.aoColumns.length;a<n;a++){t=e.aoColumns[a].nTh;t.setAttribute("role","columnheader");if(e.aoColumns[a].bSortable){t.setAttribute("tabindex",e.iTabIndex);t.setAttribute("aria-controls",e.sTableId)}if(null!==e.aoColumns[a].sClass){$(t).addClass(e.aoColumns[a].sClass)}if(e.aoColumns[a].sTitle!=t.innerHTML){t.innerHTML=e.aoColumns[a].sTitle}}}else{var o=document.createElement("tr");for(a=0,n=e.aoColumns.length;a<n;a++){t=e.aoColumns[a].nTh;t.innerHTML=e.aoColumns[a].sTitle;t.setAttribute("tabindex","0");if(null!==e.aoColumns[a].sClass){$(t).addClass(e.aoColumns[a].sClass)}o.appendChild(t)}$(e.nTHead).html("")[0].appendChild(o);_fnDetectHeader(e.aoHeader,e.nTHead)}$(e.nTHead).children("tr").attr("role","row");if(e.bJUI){for(a=0,n=e.aoColumns.length;a<n;a++){t=e.aoColumns[a].nTh;var l=document.createElement("div");l.className=e.oClasses.sSortJUIWrapper;$(t).contents().appendTo(l);var r=document.createElement("span");r.className=e.oClasses.sSortIcon;l.appendChild(r);t.appendChild(l)}}if(e.oFeatures.bSort){for(a=0;a<e.aoColumns.length;a++){if(!1!==e.aoColumns[a].bSortable){_fnSortAttachListener(e,e.aoColumns[a].nTh,a)}else{$(e.aoColumns[a].nTh).addClass(e.oClasses.sSortableNone)}}}if(""!==e.oClasses.sFooterTH){$(e.nTFoot).children("tr").children("th").addClass(e.oClasses.sFooterTH)}if(null!==e.nTFoot){var d=_fnGetUniqueThs(e,null,e.aoFooter);for(a=0,n=e.aoColumns.length;a<n;a++){if(d[a]){e.aoColumns[a].nTf=d[a];if(e.aoColumns[a].sClass){$(d[a]).addClass(e.aoColumns[a].sClass)}}}}}function _fnDrawHead(e,a,t){var s,o,l,r,d,u,p,c=[],g=[],h=e.aoColumns.length,f,b;if(t===void 0){t=!1}for(s=0,o=a.length;s<o;s++){c[s]=a[s].slice();c[s].nTr=a[s].nTr;for(l=h-1;0<=l;l--){if(!e.aoColumns[l].bVisible&&!t){c[s].splice(l,1)}}g.push([])}for(s=0,o=c.length;s<o;s++){p=c[s].nTr;if(p){while(u=p.firstChild){p.removeChild(u)}}for(l=0,r=c[s].length;l<r;l++){f=1;b=1;if(g[s][l]===void 0){p.appendChild(c[s][l].cell);g[s][l]=1;while(c[s+f]!==void 0&&c[s][l].cell==c[s+f][l].cell){g[s+f][l]=1;f++}while(c[s][l+b]!==void 0&&c[s][l].cell==c[s][l+b].cell){for(d=0;d<f;d++){g[s+d][l+b]=1}b++}c[s][l].cell.rowSpan=f;c[s][l].cell.colSpan=b}}}}function _fnDraw(e){var a=_fnCallbackFire(e,"aoPreDrawCallback","preDraw",[e]);if(-1!==$.inArray(!1,a)){_fnProcessingDisplay(e,!1);return}var t,s,o,l=[],r=0,d=e.asStripeClasses.length,u=e.aoOpenRows.length;e.bDrawing=!0;if(e.iInitDisplayStart!==void 0&&-1!=e.iInitDisplayStart){if(e.oFeatures.bServerSide){e._iDisplayStart=e.iInitDisplayStart}else{e._iDisplayStart=e.iInitDisplayStart>=e.fnRecordsDisplay()?0:e.iInitDisplayStart}e.iInitDisplayStart=-1;_fnCalculateEnd(e)}if(e.bDeferLoading){e.bDeferLoading=!1;e.iDraw++}else if(!e.oFeatures.bServerSide){e.iDraw++}else if(!e.bDestroying&&!_fnAjaxUpdate(e)){return}if(0!==e.aiDisplay.length){var p=e._iDisplayStart,c=e._iDisplayEnd;if(e.oFeatures.bServerSide){p=0;c=e.aoData.length}for(var g=p,h;g<c;g++){h=e.aoData[e.aiDisplay[g]];if(null===h.nTr){_fnCreateTr(e,e.aiDisplay[g])}var f=h.nTr;if(0!==d){var b=e.asStripeClasses[r%d];if(h._sRowStripe!=b){$(f).removeClass(h._sRowStripe).addClass(b);h._sRowStripe=b}}_fnCallbackFire(e,"aoRowCallback",null,[f,e.aoData[e.aiDisplay[g]]._aData,r,g]);l.push(f);r++;if(0!==u){for(var S=0;S<u;S++){if(f==e.aoOpenRows[S].nParent){l.push(e.aoOpenRows[S].nTr);break}}}}}else{l[0]=document.createElement("tr");if(e.asStripeClasses[0]){l[0].className=e.asStripeClasses[0]}var C=e.oLanguage,m=C.sZeroRecords;if(1==e.iDraw&&null!==e.sAjaxSource&&!e.oFeatures.bServerSide){m=C.sLoadingRecords}else if(C.sEmptyTable&&0===e.fnRecordsTotal()){m=C.sEmptyTable}var D=document.createElement("td");D.setAttribute("valign","top");D.colSpan=_fnVisbleColumns(e);D.className=e.oClasses.sRowEmpty;D.innerHTML=_fnInfoMacros(e,m);l[r].appendChild(D)}_fnCallbackFire(e,"aoHeaderCallback","header",[$(e.nTHead).children("tr")[0],_fnGetDataMaster(e),e._iDisplayStart,e.fnDisplayEnd(),e.aiDisplay]);_fnCallbackFire(e,"aoFooterCallback","footer",[$(e.nTFoot).children("tr")[0],_fnGetDataMaster(e),e._iDisplayStart,e.fnDisplayEnd(),e.aiDisplay]);var T=document.createDocumentFragment(),y=document.createDocumentFragment(),_;if(e.nTBody){_=e.nTBody.parentNode;y.appendChild(e.nTBody);if(!e.oScroll.bInfinite||!e._bInitComplete||e.bSorted||e.bFiltered){while(o=e.nTBody.firstChild){e.nTBody.removeChild(o)}}for(t=0,s=l.length;t<s;t++){T.appendChild(l[t])}e.nTBody.appendChild(T);if(null!==_){_.appendChild(e.nTBody)}}_fnCallbackFire(e,"aoDrawCallback","draw",[e]);e.bSorted=!1;e.bFiltered=!1;e.bDrawing=!1;if(e.oFeatures.bServerSide){_fnProcessingDisplay(e,!1);if(!e._bInitComplete){_fnInitComplete(e)}}}function _fnReDraw(e){if(e.oFeatures.bSort){_fnSort(e,e.oPreviousSearch)}else if(e.oFeatures.bFilter){_fnFilterComplete(e,e.oPreviousSearch)}else{_fnCalculateEnd(e);_fnDraw(e)}}function _fnAddOptionsHtml(e){var a=$("<div></div>")[0];e.nTable.parentNode.insertBefore(a,e.nTable);e.nTableWrapper=$("<div id=\""+e.sTableId+"_wrapper\" class=\""+e.oClasses.sWrapper+"\" role=\"grid\"></div>")[0];e.nTableReinsertBefore=e.nTable.nextSibling;for(var t=e.nTableWrapper,n=e.sDom.split(""),s,o,l,r,d,u,p,c=0;c<n.length;c++){o=0;l=n[c];if("<"==l){r=$("<div></div>")[0];d=n[c+1];if("'"==d||"\""==d){u="";p=2;while(n[c+p]!=d){u+=n[c+p];p++}if("H"==u){u=e.oClasses.sJUIHeader}else if("F"==u){u=e.oClasses.sJUIFooter}if(-1!=u.indexOf(".")){var g=u.split(".");r.id=g[0].substr(1,g[0].length-1);r.className=g[1]}else if("#"==u.charAt(0)){r.id=u.substr(1,u.length-1)}else{r.className=u}c+=p}t.appendChild(r);t=r}else if(">"==l){t=t.parentNode}else if("l"==l&&e.oFeatures.bPaginate&&e.oFeatures.bLengthChange){s=_fnFeatureHtmlLength(e);o=1}else if("f"==l&&e.oFeatures.bFilter){s=_fnFeatureHtmlFilter(e);o=1}else if("r"==l&&e.oFeatures.bProcessing){s=_fnFeatureHtmlProcessing(e);o=1}else if("t"==l){s=_fnFeatureHtmlTable(e);o=1}else if("i"==l&&e.oFeatures.bInfo){s=_fnFeatureHtmlInfo(e);o=1}else if("p"==l&&e.oFeatures.bPaginate){s=_fnFeatureHtmlPaginate(e);o=1}else if(0!==DataTable.ext.aoFeatures.length){for(var h=DataTable.ext.aoFeatures,f=0,b=h.length;f<b;f++){if(l==h[f].cFeature){s=h[f].fnInit(e);if(s){o=1}break}}}if(1==o&&null!==s){if("object"!==_typeof(e.aanFeatures[l])){e.aanFeatures[l]=[]}e.aanFeatures[l].push(s);t.appendChild(s)}}a.parentNode.replaceChild(e.nTableWrapper,a)}function _fnDetectHeader(e,a){var t=$(a).children("tr"),n,s,o,r,d,u,p,c,g,h,f,b=function(e,a,t){var n=e[a];while(n[t]){t++}return t};e.splice(0,e.length);for(o=0,u=t.length;o<u;o++){e.push([])}for(o=0,u=t.length;o<u;o++){n=t[o];c=0;s=n.firstChild;while(s){if("TD"==s.nodeName.toUpperCase()||"TH"==s.nodeName.toUpperCase()){g=1*s.getAttribute("colspan");h=1*s.getAttribute("rowspan");g=!g||0===g||1===g?1:g;h=!h||0===h||1===h?1:h;p=b(e,o,c);f=1===g?!0:!1;for(d=0;d<g;d++){for(r=0;r<h;r++){e[o+r][p+d]={cell:s,unique:f};e[o+r].nTr=n}}}s=s.nextSibling}}}function _fnGetUniqueThs(e,a,t){var n=[];if(!t){t=e.aoHeader;if(a){t=[];_fnDetectHeader(t,a)}}for(var s=0,o=t.length;s<o;s++){for(var l=0,r=t[s].length;l<r;l++){if(t[s][l].unique&&(!n[l]||!e.bSortCellsTop)){n[l]=t[s][l].cell}}}return n}function _fnAjaxUpdate(e){if(e.bAjaxDataGet){e.iDraw++;_fnProcessingDisplay(e,!0);var a=e.aoColumns.length,t=_fnAjaxParameters(e);_fnServerParams(e,t);e.fnServerData.call(e.oInstance,e.sAjaxSource,t,function(a){_fnAjaxUpdateDraw(e,a)},e);return!1}else{return!0}}function _fnAjaxParameters(e){var a=e.aoColumns.length,t=[],n,s,o,l,r;t.push({name:"sEcho",value:e.iDraw});t.push({name:"iColumns",value:a});t.push({name:"sColumns",value:_fnColumnOrdering(e)});t.push({name:"iDisplayStart",value:e._iDisplayStart});t.push({name:"iDisplayLength",value:!1!==e.oFeatures.bPaginate?e._iDisplayLength:-1});for(l=0;l<a;l++){n=e.aoColumns[l].mData;t.push({name:"mDataProp_"+l,value:"function"==typeof n?"function":n})}if(!1!==e.oFeatures.bFilter){t.push({name:"sSearch",value:e.oPreviousSearch.sSearch});t.push({name:"bRegex",value:e.oPreviousSearch.bRegex});for(l=0;l<a;l++){t.push({name:"sSearch_"+l,value:e.aoPreSearchCols[l].sSearch});t.push({name:"bRegex_"+l,value:e.aoPreSearchCols[l].bRegex});t.push({name:"bSearchable_"+l,value:e.aoColumns[l].bSearchable})}}if(!1!==e.oFeatures.bSort){var d=0;s=null!==e.aaSortingFixed?e.aaSortingFixed.concat(e.aaSorting):e.aaSorting.slice();for(l=0;l<s.length;l++){o=e.aoColumns[s[l][0]].aDataSort;for(r=0;r<o.length;r++){t.push({name:"iSortCol_"+d,value:o[r]});t.push({name:"sSortDir_"+d,value:s[l][1]});d++}}t.push({name:"iSortingCols",value:d});for(l=0;l<a;l++){t.push({name:"bSortable_"+l,value:e.aoColumns[l].bSortable})}}return t}function _fnServerParams(e,a){_fnCallbackFire(e,"aoServerParams","serverParams",[a])}function _fnAjaxUpdateDraw(e,a){if(a.sEcho!==void 0){if(1*a.sEcho<e.iDraw){return}else{e.iDraw=1*a.sEcho}}if(!e.oScroll.bInfinite||e.oScroll.bInfinite&&(e.bSorted||e.bFiltered)){_fnClearTable(e)}e._iRecordsTotal=parseInt(a.iTotalRecords,10);e._iRecordsDisplay=parseInt(a.iTotalDisplayRecords,10);var t=_fnColumnOrdering(e),n=a.sColumns!==void 0&&""!==t&&a.sColumns!=t,s;if(n){s=_fnReOrderIndex(e,a.sColumns)}for(var o=_fnGetObjectDataFn(e.sAjaxDataProp)(a),l=0,r=o.length;l<r;l++){if(n){for(var d=[],u=0,p=e.aoColumns.length;u<p;u++){d.push(o[l][s[u]])}_fnAddData(e,d)}else{_fnAddData(e,o[l])}}e.aiDisplay=e.aiDisplayMaster.slice();e.bAjaxDataGet=!1;_fnDraw(e);e.bAjaxDataGet=!0;_fnProcessingDisplay(e,!1)}function _fnFeatureHtmlFilter(e){var a=e.oPreviousSearch,t=e.oLanguage.sSearch;t=-1!==t.indexOf("_INPUT_")?t.replace("_INPUT_","<input type=\"text\" />"):""===t?"<input type=\"text\" />":t+" <input type=\"text\" />";var n=document.createElement("div");n.className=e.oClasses.sFilter;n.innerHTML="<label>"+t+"</label>";if(!e.aanFeatures.f){n.id=e.sTableId+"_filter"}var i=$("input[type=\"text\"]",n);n._DT_Input=i[0];i.val(a.sSearch.replace("\"","&quot;"));i.bind("keyup.DT",function(){for(var t=e.aanFeatures.f,n=""===this.value?"":this.value,s=0,o=t.length;s<o;s++){if(t[s]!=$(this).parents("div.dataTables_filter")[0]){$(t[s]._DT_Input).val(n)}}if(n!=a.sSearch){_fnFilterComplete(e,{sSearch:n,bRegex:a.bRegex,bSmart:a.bSmart,bCaseInsensitive:a.bCaseInsensitive})}});i.attr("aria-controls",e.sTableId).bind("keypress.DT",function(a){if(13==a.keyCode){return!1}});return n}function _fnFilterComplete(e,a,t){var n=e.oPreviousSearch,s=e.aoPreSearchCols,o=function(e){n.sSearch=e.sSearch;n.bRegex=e.bRegex;n.bSmart=e.bSmart;n.bCaseInsensitive=e.bCaseInsensitive};if(!e.oFeatures.bServerSide){_fnFilter(e,a.sSearch,t,a.bRegex,a.bSmart,a.bCaseInsensitive);o(a);for(var l=0;l<e.aoPreSearchCols.length;l++){_fnFilterColumn(e,s[l].sSearch,l,s[l].bRegex,s[l].bSmart,s[l].bCaseInsensitive)}_fnFilterCustom(e)}else{o(a)}e.bFiltered=!0;$(e.oInstance).trigger("filter",e);e._iDisplayStart=0;_fnCalculateEnd(e);_fnDraw(e);_fnBuildSearchArray(e,0)}function _fnFilterCustom(e){for(var a=DataTable.ext.afnFiltering,t=_fnGetColumns(e,"bSearchable"),n=0,s=a.length,o;n<s;n++){o=0;for(var l=0,r=e.aiDisplay.length;l<r;l++){var d=e.aiDisplay[l-o],u=a[n](e,_fnGetRowData(e,d,"filter",t),d);if(!u){e.aiDisplay.splice(l-o,1);o++}}}}function _fnFilterColumn(e,a,t,n,s,o){if(""===a){return}for(var l=0,r=_fnFilterCreateSearch(a,n,s,o),d=e.aiDisplay.length-1,u;0<=d;d--){u=_fnDataToSearch(_fnGetCellData(e,e.aiDisplay[d],t,"filter"),e.aoColumns[t].sType);if(!r.test(u)){e.aiDisplay.splice(d,1);l++}}}function _fnFilter(e,a,t,n,s,o){var l,r=_fnFilterCreateSearch(a,n,s,o),d=e.oPreviousSearch;if(!t){t=0}if(0!==DataTable.ext.afnFiltering.length){t=1}if(0>=a.length){e.aiDisplay.splice(0,e.aiDisplay.length);e.aiDisplay=e.aiDisplayMaster.slice()}else{if(e.aiDisplay.length==e.aiDisplayMaster.length||d.sSearch.length>a.length||1==t||0!==a.indexOf(d.sSearch)){e.aiDisplay.splice(0,e.aiDisplay.length);_fnBuildSearchArray(e,1);for(l=0;l<e.aiDisplayMaster.length;l++){if(r.test(e.asDataSearch[l])){e.aiDisplay.push(e.aiDisplayMaster[l])}}}else{var u=0;for(l=0;l<e.asDataSearch.length;l++){if(!r.test(e.asDataSearch[l])){e.aiDisplay.splice(l-u,1);u++}}}}}function _fnBuildSearchArray(e,a){if(!e.oFeatures.bServerSide){e.asDataSearch=[];for(var t=_fnGetColumns(e,"bSearchable"),n=1===a?e.aiDisplayMaster:e.aiDisplay,s=0,o=n.length;s<o;s++){e.asDataSearch[s]=_fnBuildSearchRow(e,_fnGetRowData(e,n[s],"filter",t))}}}function _fnBuildSearchRow(e,a){var t=a.join("  ");if(-1!==t.indexOf("&")){t=$("<div>").html(t).text()}return t.replace(/[\n\r]/g," ")}function _fnFilterCreateSearch(e,a,t,n){var i,s;if(t){i=a?e.split(" "):_fnEscapeRegex(e).split(" ");s="^(?=.*?"+i.join(")(?=.*?")+").*$";return new RegExp(s,n?"i":"")}else{e=a?e:_fnEscapeRegex(e);return new RegExp(e,n?"i":"")}}function _fnDataToSearch(e,a){if("function"==typeof DataTable.ext.ofnSearch[a]){return DataTable.ext.ofnSearch[a](e)}else if(null===e){return""}else if("html"==a){return e.replace(/[\r\n]/g," ").replace(/<.*?>/g,"")}else if("string"==typeof e){return e.replace(/[\r\n]/g," ")}return e}function _fnEscapeRegex(e){var a=new RegExp("(\\"+["/",".","*","+","?","|","(",")","[","]","{","}","\\","$","^","-"].join("|\\")+")","g");return e.replace(a,"\\$1")}function _fnFeatureHtmlInfo(e){var a=document.createElement("div");a.className=e.oClasses.sInfo;if(!e.aanFeatures.i){e.aoDrawCallback.push({fn:_fnUpdateInfo,sName:"information"});a.id=e.sTableId+"_info"}e.nTable.setAttribute("aria-describedby",e.sTableId+"_info");return a}function _fnUpdateInfo(e){if(!e.oFeatures.bInfo||0===e.aanFeatures.i.length){return}var a=e.oLanguage,t=e._iDisplayStart+1,s=e.fnDisplayEnd(),o=e.fnRecordsTotal(),l=e.fnRecordsDisplay(),r;if(0===l){r=a.sInfoEmpty}else{r=a.sInfo}if(l!=o){r+=" "+a.sInfoFiltered}r+=a.sInfoPostFix;r=_fnInfoMacros(e,r);if(null!==a.fnInfoCallback){r=a.fnInfoCallback.call(e.oInstance,e,t,s,o,l,r)}for(var d=e.aanFeatures.i,n=0,u=d.length;n<u;n++){$(d[n]).html(r)}}function _fnInfoMacros(e,a){var t=e._iDisplayStart+1,n=e.fnFormatNumber(t),i=e.fnDisplayEnd(),s=e.fnFormatNumber(i),o=e.fnRecordsDisplay(),l=e.fnFormatNumber(o),r=e.fnRecordsTotal(),d=e.fnFormatNumber(r);if(e.oScroll.bInfinite){n=e.fnFormatNumber(1)}return a.replace(/_START_/g,n).replace(/_END_/g,s).replace(/_TOTAL_/g,l).replace(/_MAX_/g,d)}function _fnInitialise(e){var a,t,n=e.iInitDisplayStart;if(!1===e.bInitialised){setTimeout(function(){_fnInitialise(e)},200);return}_fnAddOptionsHtml(e);_fnBuildHead(e);_fnDrawHead(e,e.aoHeader);if(e.nTFoot){_fnDrawHead(e,e.aoFooter)}_fnProcessingDisplay(e,!0);if(e.oFeatures.bAutoWidth){_fnCalculateColumnWidths(e)}for(a=0,t=e.aoColumns.length;a<t;a++){if(null!==e.aoColumns[a].sWidth){e.aoColumns[a].nTh.style.width=_fnStringToCss(e.aoColumns[a].sWidth)}}if(e.oFeatures.bSort){_fnSort(e)}else if(e.oFeatures.bFilter){_fnFilterComplete(e,e.oPreviousSearch)}else{e.aiDisplay=e.aiDisplayMaster.slice();_fnCalculateEnd(e);_fnDraw(e)}if(null!==e.sAjaxSource&&!e.oFeatures.bServerSide){var s=[];_fnServerParams(e,s);e.fnServerData.call(e.oInstance,e.sAjaxSource,s,function(t){var i=""!==e.sAjaxDataProp?_fnGetObjectDataFn(e.sAjaxDataProp)(t):t;for(a=0;a<i.length;a++){_fnAddData(e,i[a])}e.iInitDisplayStart=n;if(e.oFeatures.bSort){_fnSort(e)}else{e.aiDisplay=e.aiDisplayMaster.slice();_fnCalculateEnd(e);_fnDraw(e)}_fnProcessingDisplay(e,!1);_fnInitComplete(e,t)},e);return}if(!e.oFeatures.bServerSide){_fnProcessingDisplay(e,!1);_fnInitComplete(e)}}function _fnInitComplete(e,a){e._bInitComplete=!0;_fnCallbackFire(e,"aoInitComplete","init",[e,a])}function _fnLanguageCompat(e){var a=DataTable.defaults.oLanguage;if(!e.sEmptyTable&&e.sZeroRecords&&"No data available in table"===a.sEmptyTable){_fnMap(e,e,"sZeroRecords","sEmptyTable")}if(!e.sLoadingRecords&&e.sZeroRecords&&"Loading..."===a.sLoadingRecords){_fnMap(e,e,"sZeroRecords","sLoadingRecords")}}function _fnFeatureHtmlLength(e){if(e.oScroll.bInfinite){return null}var a="name=\""+e.sTableId+"_length\"",t="<select size=\"1\" "+a+">",s,o,l=e.aLengthMenu;if(2==l.length&&"object"===_typeof(l[0])&&"object"===_typeof(l[1])){for(s=0,o=l[0].length;s<o;s++){t+="<option value=\""+l[0][s]+"\">"+l[1][s]+"</option>"}}else{for(s=0,o=l.length;s<o;s++){t+="<option value=\""+l[s]+"\">"+l[s]+"</option>"}}t+="</select>";var r=document.createElement("div");if(!e.aanFeatures.l){r.id=e.sTableId+"_length"}r.className=e.oClasses.sLength;r.innerHTML="<label>"+e.oLanguage.sLengthMenu.replace("_MENU_",t)+"</label>";$("select option[value=\""+e._iDisplayLength+"\"]",r).attr("selected",!0);$("select",r).bind("change.DT",function(){var a=$(this).val(),t=e.aanFeatures.l;for(s=0,o=t.length;s<o;s++){if(t[s]!=this.parentNode){$("select",t[s]).val(a)}}e._iDisplayLength=parseInt(a,10);_fnCalculateEnd(e);if(e.fnDisplayEnd()==e.fnRecordsDisplay()){e._iDisplayStart=e.fnDisplayEnd()-e._iDisplayLength;if(0>e._iDisplayStart){e._iDisplayStart=0}}if(-1==e._iDisplayLength){e._iDisplayStart=0}_fnDraw(e)});$("select",r).attr("aria-controls",e.sTableId);return r}function _fnCalculateEnd(e){if(!1===e.oFeatures.bPaginate){e._iDisplayEnd=e.aiDisplay.length}else{if(e._iDisplayStart+e._iDisplayLength>e.aiDisplay.length||-1==e._iDisplayLength){e._iDisplayEnd=e.aiDisplay.length}else{e._iDisplayEnd=e._iDisplayStart+e._iDisplayLength}}}function _fnFeatureHtmlPaginate(e){if(e.oScroll.bInfinite){return null}var a=document.createElement("div");a.className=e.oClasses.sPaging+e.sPaginationType;DataTable.ext.oPagination[e.sPaginationType].fnInit(e,a,function(e){_fnCalculateEnd(e);_fnDraw(e)});if(!e.aanFeatures.p){e.aoDrawCallback.push({fn:function fn(e){DataTable.ext.oPagination[e.sPaginationType].fnUpdate(e,function(e){_fnCalculateEnd(e);_fnDraw(e)})},sName:"pagination"})}return a}function _fnPageChange(e,a){var t=e._iDisplayStart;if("number"==typeof a){e._iDisplayStart=a*e._iDisplayLength;if(e._iDisplayStart>e.fnRecordsDisplay()){e._iDisplayStart=0}}else if("first"==a){e._iDisplayStart=0}else if("previous"==a){e._iDisplayStart=0<=e._iDisplayLength?e._iDisplayStart-e._iDisplayLength:0;if(0>e._iDisplayStart){e._iDisplayStart=0}}else if("next"==a){if(0<=e._iDisplayLength){if(e._iDisplayStart+e._iDisplayLength<e.fnRecordsDisplay()){e._iDisplayStart+=e._iDisplayLength}}else{e._iDisplayStart=0}}else if("last"==a){if(0<=e._iDisplayLength){var n=parseInt((e.fnRecordsDisplay()-1)/e._iDisplayLength,10)+1;e._iDisplayStart=(n-1)*e._iDisplayLength}else{e._iDisplayStart=0}}else{_fnLog(e,0,"Unknown paging action: "+a)}$(e.oInstance).trigger("page",e);return t!=e._iDisplayStart}function _fnFeatureHtmlProcessing(e){var a=document.createElement("div");if(!e.aanFeatures.r){a.id=e.sTableId+"_processing"}a.innerHTML=e.oLanguage.sProcessing;a.className=e.oClasses.sProcessing;e.nTable.parentNode.insertBefore(a,e.nTable);return a}function _fnProcessingDisplay(e,a){if(e.oFeatures.bProcessing){for(var t=e.aanFeatures.r,n=0,s=t.length;n<s;n++){t[n].style.visibility=a?"visible":"hidden"}}$(e.oInstance).trigger("processing",[e,a])}function _fnFeatureHtmlTable(e){if(""===e.oScroll.sX&&""===e.oScroll.sY){return e.nTable}var a=document.createElement("div"),t=document.createElement("div"),n=document.createElement("div"),i=document.createElement("div"),s=document.createElement("div"),o=document.createElement("div"),l=e.nTable.cloneNode(!1),r=e.nTable.cloneNode(!1),d=e.nTable.getElementsByTagName("thead")[0],u=0===e.nTable.getElementsByTagName("tfoot").length?null:e.nTable.getElementsByTagName("tfoot")[0],p=e.oClasses;t.appendChild(n);s.appendChild(o);i.appendChild(e.nTable);a.appendChild(t);a.appendChild(i);n.appendChild(l);l.appendChild(d);if(null!==u){a.appendChild(s);o.appendChild(r);r.appendChild(u)}a.className=p.sScrollWrapper;t.className=p.sScrollHead;n.className=p.sScrollHeadInner;i.className=p.sScrollBody;s.className=p.sScrollFoot;o.className=p.sScrollFootInner;if(e.oScroll.bAutoCss){t.style.overflow="hidden";t.style.position="relative";s.style.overflow="hidden";i.style.overflow="auto"}t.style.border="0";t.style.width="100%";s.style.border="0";n.style.width=""!==e.oScroll.sXInner?e.oScroll.sXInner:"100%";l.removeAttribute("id");l.style.marginLeft="0";e.nTable.style.marginLeft="0";if(null!==u){r.removeAttribute("id");r.style.marginLeft="0"}var c=$(e.nTable).children("caption");if(0<c.length){c=c[0];if("top"===c._captionSide){l.appendChild(c)}else if("bottom"===c._captionSide&&u){r.appendChild(c)}}if(""!==e.oScroll.sX){t.style.width=_fnStringToCss(e.oScroll.sX);i.style.width=_fnStringToCss(e.oScroll.sX);if(null!==u){s.style.width=_fnStringToCss(e.oScroll.sX)}$(i).scroll(function(){t.scrollLeft=this.scrollLeft;if(null!==u){s.scrollLeft=this.scrollLeft}})}if(""!==e.oScroll.sY){i.style.height=_fnStringToCss(e.oScroll.sY)}e.aoDrawCallback.push({fn:_fnScrollDraw,sName:"scrolling"});if(e.oScroll.bInfinite){$(i).scroll(function(){if(!e.bDrawing&&0!==$(this).scrollTop()){if($(this).scrollTop()+$(this).height()>$(e.nTable).height()-e.oScroll.iLoadGap){if(e.fnDisplayEnd()<e.fnRecordsDisplay()){_fnPageChange(e,"next");_fnCalculateEnd(e);_fnDraw(e)}}}})}e.nScrollHead=t;e.nScrollFoot=s;return a}function _fnScrollDraw(e){var a=e.nScrollHead.getElementsByTagName("div")[0],t=a.getElementsByTagName("table")[0],n=e.nTable.parentNode,s,o,l,r,d,u,p,c,g,h,f=[],b=[],S,C=null!==e.nTFoot?e.nScrollFoot.getElementsByTagName("div")[0]:null,m=null!==e.nTFoot?C.getElementsByTagName("table")[0]:null,D=e.oBrowser.bScrollOversize,T=function(e){p=e.style;p.paddingTop="0";p.paddingBottom="0";p.borderTopWidth="0";p.borderBottomWidth="0";p.height=0};$(e.nTable).children("thead, tfoot").remove();g=$(e.nTHead).clone()[0];e.nTable.insertBefore(g,e.nTable.childNodes[0]);l=e.nTHead.getElementsByTagName("tr");r=g.getElementsByTagName("tr");if(null!==e.nTFoot){h=$(e.nTFoot).clone()[0];e.nTable.insertBefore(h,e.nTable.childNodes[1]);u=e.nTFoot.getElementsByTagName("tr");d=h.getElementsByTagName("tr")}if(""===e.oScroll.sX){n.style.width="100%";a.parentNode.style.width="100%"}var y=_fnGetUniqueThs(e,g);for(s=0,o=y.length;s<o;s++){c=_fnVisibleToColumnIndex(e,s);y[s].style.width=e.aoColumns[c].sWidth}if(null!==e.nTFoot){_fnApplyToChildren(function(e){e.style.width=""},d)}if(e.oScroll.bCollapse&&""!==e.oScroll.sY){n.style.height=n.offsetHeight+e.nTHead.offsetHeight+"px"}S=$(e.nTable).outerWidth();if(""===e.oScroll.sX){e.nTable.style.width="100%";if(D&&($("tbody",n).height()>n.offsetHeight||"scroll"==$(n).css("overflow-y"))){e.nTable.style.width=_fnStringToCss($(e.nTable).outerWidth()-e.oScroll.iBarWidth)}}else{if(""!==e.oScroll.sXInner){e.nTable.style.width=_fnStringToCss(e.oScroll.sXInner)}else if(S==$(n).width()&&$(n).height()<$(e.nTable).height()){e.nTable.style.width=_fnStringToCss(S-e.oScroll.iBarWidth);if($(e.nTable).outerWidth()>S-e.oScroll.iBarWidth){e.nTable.style.width=_fnStringToCss(S)}}else{e.nTable.style.width=_fnStringToCss(S)}}S=$(e.nTable).outerWidth();_fnApplyToChildren(T,r);_fnApplyToChildren(function(e){f.push(_fnStringToCss($(e).width()))},r);_fnApplyToChildren(function(e,a){e.style.width=f[a]},l);$(r).height(0);if(null!==e.nTFoot){_fnApplyToChildren(T,d);_fnApplyToChildren(function(e){b.push(_fnStringToCss($(e).width()))},d);_fnApplyToChildren(function(e,a){e.style.width=b[a]},u);$(d).height(0)}_fnApplyToChildren(function(e,a){e.innerHTML="";e.style.width=f[a]},r);if(null!==e.nTFoot){_fnApplyToChildren(function(e,a){e.innerHTML="";e.style.width=b[a]},d)}if($(e.nTable).outerWidth()<S){var _=n.scrollHeight>n.offsetHeight||"scroll"==$(n).css("overflow-y")?S+e.oScroll.iBarWidth:S;if(D&&(n.scrollHeight>n.offsetHeight||"scroll"==$(n).css("overflow-y"))){e.nTable.style.width=_fnStringToCss(_-e.oScroll.iBarWidth)}n.style.width=_fnStringToCss(_);e.nScrollHead.style.width=_fnStringToCss(_);if(null!==e.nTFoot){e.nScrollFoot.style.width=_fnStringToCss(_)}if(""===e.oScroll.sX){_fnLog(e,1,"The table cannot fit into the current element which will cause column misalignment. The table has been drawn at its minimum possible width.")}else if(""!==e.oScroll.sXInner){_fnLog(e,1,"The table cannot fit into the current element which will cause column misalignment. Increase the sScrollXInner value or remove it to allow automatic calculation")}}else{n.style.width=_fnStringToCss("100%");e.nScrollHead.style.width=_fnStringToCss("100%");if(null!==e.nTFoot){e.nScrollFoot.style.width=_fnStringToCss("100%")}}if(""===e.oScroll.sY){if(D){n.style.height=_fnStringToCss(e.nTable.offsetHeight+e.oScroll.iBarWidth)}}if(""!==e.oScroll.sY&&e.oScroll.bCollapse){n.style.height=_fnStringToCss(e.oScroll.sY);var x=""!==e.oScroll.sX&&e.nTable.offsetWidth>n.offsetWidth?e.oScroll.iBarWidth:0;if(e.nTable.offsetHeight<n.offsetHeight){n.style.height=_fnStringToCss(e.nTable.offsetHeight+x)}}var I=$(e.nTable).outerWidth();t.style.width=_fnStringToCss(I);a.style.width=_fnStringToCss(I);var v=$(e.nTable).height()>n.clientHeight||"scroll"==$(n).css("overflow-y");a.style.paddingRight=v?e.oScroll.iBarWidth+"px":"0px";if(null!==e.nTFoot){m.style.width=_fnStringToCss(I);C.style.width=_fnStringToCss(I);C.style.paddingRight=v?e.oScroll.iBarWidth+"px":"0px"}$(n).scroll();if(e.bSorted||e.bFiltered){n.scrollTop=0}}function _fnApplyToChildren(e,a,t){var n=0,s=0,o=a.length,l,r;while(s<o){l=a[s].firstChild;r=t?t[s].firstChild:null;while(l){if(1===l.nodeType){if(t){e(l,r,n)}else{e(l,n)}n++}l=l.nextSibling;r=t?r.nextSibling:null}s++}}function _fnConvertToWidth(e,a){if(!e||null===e||""===e){return 0}if(!a){a=document.body}var t,n=document.createElement("div");n.style.width=_fnStringToCss(e);a.appendChild(n);t=n.offsetWidth;a.removeChild(n);return t}function _fnCalculateColumnWidths(e){var a=e.nTable.offsetWidth,t=0,n,s=0,o=e.aoColumns.length,l,r,d,u=$("th",e.nTHead),p=e.nTable.getAttribute("width"),c=e.nTable.parentNode;for(l=0;l<o;l++){if(e.aoColumns[l].bVisible){s++;if(null!==e.aoColumns[l].sWidth){n=_fnConvertToWidth(e.aoColumns[l].sWidthOrig,c);if(null!==n){e.aoColumns[l].sWidth=_fnStringToCss(n)}t++}}}if(o==u.length&&0===t&&s==o&&""===e.oScroll.sX&&""===e.oScroll.sY){for(l=0;l<e.aoColumns.length;l++){n=$(u[l]).width();if(null!==n){e.aoColumns[l].sWidth=_fnStringToCss(n)}}}else{var g=e.nTable.cloneNode(!1),h=e.nTHead.cloneNode(!0),f=document.createElement("tbody"),b=document.createElement("tr");g.removeAttribute("id");g.appendChild(h);if(null!==e.nTFoot){g.appendChild(e.nTFoot.cloneNode(!0));_fnApplyToChildren(function(e){e.style.width=""},g.getElementsByTagName("tr"))}g.appendChild(f);f.appendChild(b);var S=$("thead th",g);if(0===S.length){S=$("tbody tr:eq(0)>td",g)}var C=_fnGetUniqueThs(e,h);r=0;for(l=0;l<o;l++){var m=e.aoColumns[l];if(m.bVisible&&null!==m.sWidthOrig&&""!==m.sWidthOrig){C[l-r].style.width=_fnStringToCss(m.sWidthOrig)}else if(m.bVisible){C[l-r].style.width=""}else{r++}}for(l=0;l<o;l++){if(e.aoColumns[l].bVisible){var D=_fnGetWidestNode(e,l);if(null!==D){D=D.cloneNode(!0);if(""!==e.aoColumns[l].sContentPadding){D.innerHTML+=e.aoColumns[l].sContentPadding}b.appendChild(D)}}}c.appendChild(g);if(""!==e.oScroll.sX&&""!==e.oScroll.sXInner){g.style.width=_fnStringToCss(e.oScroll.sXInner)}else if(""!==e.oScroll.sX){g.style.width="";if($(g).width()<c.offsetWidth){g.style.width=_fnStringToCss(c.offsetWidth)}}else if(""!==e.oScroll.sY){g.style.width=_fnStringToCss(c.offsetWidth)}else if(p){g.style.width=_fnStringToCss(p)}g.style.visibility="hidden";_fnScrollingWidthAdjust(e,g);var T=$("tbody tr:eq(0)",g).children();if(0===T.length){T=_fnGetUniqueThs(e,$("thead",g)[0])}if(""!==e.oScroll.sX){var y=0;r=0;for(l=0;l<e.aoColumns.length;l++){if(e.aoColumns[l].bVisible){if(null===e.aoColumns[l].sWidthOrig){y+=$(T[r]).outerWidth()}else{y+=parseInt(e.aoColumns[l].sWidth.replace("px",""),10)+($(T[r]).outerWidth()-$(T[r]).width())}r++}}g.style.width=_fnStringToCss(y);e.nTable.style.width=_fnStringToCss(y)}r=0;for(l=0;l<e.aoColumns.length;l++){if(e.aoColumns[l].bVisible){d=$(T[r]).width();if(null!==d&&0<d){e.aoColumns[l].sWidth=_fnStringToCss(d)}r++}}var _=$(g).css("width");e.nTable.style.width=-1!==_.indexOf("%")?_:_fnStringToCss($(g).outerWidth());g.parentNode.removeChild(g)}if(p){e.nTable.style.width=_fnStringToCss(p)}}function _fnScrollingWidthAdjust(e,a){if(""===e.oScroll.sX&&""!==e.oScroll.sY){$(a).width();a.style.width=_fnStringToCss($(a).outerWidth()-e.oScroll.iBarWidth)}else if(""!==e.oScroll.sX){a.style.width=_fnStringToCss($(a).outerWidth())}}function _fnGetWidestNode(e,a){var t=_fnGetMaxLenString(e,a);if(0>t){return null}if(null===e.aoData[t].nTr){var i=document.createElement("td");i.innerHTML=_fnGetCellData(e,t,a,"");return i}return _fnGetTdNodes(e,t)[a]}function _fnGetMaxLenString(e,a){for(var t=-1,n=-1,o=0,l;o<e.aoData.length;o++){l=_fnGetCellData(e,o,a,"display")+"";l=l.replace(/<.*?>/g,"");if(l.length>t){t=l.length;n=o}}return n}function _fnStringToCss(e){if(null===e){return"0px"}if("number"==typeof e){if(0>e){return"0px"}return e+"px"}var a=e.charCodeAt(e.length-1);if(48>a||57<a){return e}return e+"px"}function _fnScrollBarWidth(){var e=document.createElement("p"),a=e.style;a.width="100%";a.height="200px";a.padding="0px";var t=document.createElement("div");a=t.style;a.position="absolute";a.top="0px";a.left="0px";a.visibility="hidden";a.width="200px";a.height="150px";a.padding="0px";a.overflow="hidden";t.appendChild(e);document.body.appendChild(t);var n=e.offsetWidth;t.style.overflow="scroll";var i=e.offsetWidth;if(n==i){i=t.clientWidth}document.body.removeChild(t);return n-i}function _fnSort(e,a){var t,n,s,o,l,r,d,u,p=[],c=[],g=DataTable.ext.oSort,h=e.aoData,f=e.aoColumns,b=e.oLanguage.oAria;if(!e.oFeatures.bServerSide&&(0!==e.aaSorting.length||null!==e.aaSortingFixed)){p=null!==e.aaSortingFixed?e.aaSortingFixed.concat(e.aaSorting):e.aaSorting.slice();for(t=0;t<p.length;t++){var S=p[t][0],C=_fnColumnIndexToVisible(e,S);d=e.aoColumns[S].sSortDataType;if(DataTable.ext.afnSortData[d]){var m=DataTable.ext.afnSortData[d].call(e.oInstance,e,S,C);if(m.length===h.length){for(s=0,o=h.length;s<o;s++){_fnSetCellData(e,s,S,m[s])}}else{_fnLog(e,0,"Returned data sort array (col "+S+") is the wrong length")}}}for(t=0,n=e.aiDisplayMaster.length;t<n;t++){c[e.aiDisplayMaster[t]]=t}var D=p.length,T,y;for(t=0,n=h.length;t<n;t++){for(s=0;s<D;s++){y=f[p[s][0]].aDataSort;for(l=0,r=y.length;l<r;l++){d=f[y[l]].sType;T=g[(d?d:"string")+"-pre"];h[t]._aSortData[y[l]]=T?T(_fnGetCellData(e,t,y[l],"sort")):_fnGetCellData(e,t,y[l],"sort")}}}e.aiDisplayMaster.sort(function(e,a){var t,n,i,s,o,r;for(t=0;t<D;t++){o=f[p[t][0]].aDataSort;for(n=0,i=o.length;n<i;n++){r=f[o[n]].sType;s=g[(r?r:"string")+"-"+p[t][1]](h[e]._aSortData[o[n]],h[a]._aSortData[o[n]]);if(0!==s){return s}}}return g["numeric-asc"](c[e],c[a])})}if((a===void 0||a)&&!e.oFeatures.bDeferRender){_fnSortingClasses(e)}for(t=0,n=e.aoColumns.length;t<n;t++){var _=f[t].sTitle.replace(/<.*?>/g,"");u=f[t].nTh;u.removeAttribute("aria-sort");u.removeAttribute("aria-label");if(f[t].bSortable){if(0<p.length&&p[0][0]==t){u.setAttribute("aria-sort","asc"==p[0][1]?"ascending":"descending");var x=f[t].asSorting[p[0][2]+1]?f[t].asSorting[p[0][2]+1]:f[t].asSorting[0];u.setAttribute("aria-label",_+("asc"==x?b.sSortAscending:b.sSortDescending))}else{u.setAttribute("aria-label",_+("asc"==f[t].asSorting[0]?b.sSortAscending:b.sSortDescending))}}else{u.setAttribute("aria-label",_)}}e.bSorted=!0;$(e.oInstance).trigger("sort",e);if(e.oFeatures.bFilter){_fnFilterComplete(e,e.oPreviousSearch,1)}else{e.aiDisplay=e.aiDisplayMaster.slice();e._iDisplayStart=0;_fnCalculateEnd(e);_fnDraw(e)}}function _fnSortAttachListener(a,t,n,i){_fnBindAction(t,{},function(t){if(!1===a.aoColumns[n].bSortable){return}var e=function(){var e,s;if(t.shiftKey){for(var o=!1,l=0;l<a.aaSorting.length;l++){if(a.aaSorting[l][0]==n){o=!0;e=a.aaSorting[l][0];s=a.aaSorting[l][2]+1;if(!a.aoColumns[e].asSorting[s]){a.aaSorting.splice(l,1)}else{a.aaSorting[l][1]=a.aoColumns[e].asSorting[s];a.aaSorting[l][2]=s}break}}if(!1===o){a.aaSorting.push([n,a.aoColumns[n].asSorting[0],0])}}else{if(1==a.aaSorting.length&&a.aaSorting[0][0]==n){e=a.aaSorting[0][0];s=a.aaSorting[0][2]+1;if(!a.aoColumns[e].asSorting[s]){s=0}a.aaSorting[0][1]=a.aoColumns[e].asSorting[s];a.aaSorting[0][2]=s}else{a.aaSorting.splice(0,a.aaSorting.length);a.aaSorting.push([n,a.aoColumns[n].asSorting[0],0])}}_fnSort(a)};if(!a.oFeatures.bProcessing){e()}else{_fnProcessingDisplay(a,!0);setTimeout(function(){e();if(!a.oFeatures.bServerSide){_fnProcessingDisplay(a,!1)}},0)}if("function"==typeof i){i(a)}})}function _fnSortingClasses(e){var a,t,n,s,o,l,r=e.aoColumns.length,d=e.oClasses;for(a=0;a<r;a++){if(e.aoColumns[a].bSortable){$(e.aoColumns[a].nTh).removeClass(d.sSortAsc+" "+d.sSortDesc+" "+e.aoColumns[a].sSortingClass)}}if(null!==e.aaSortingFixed){o=e.aaSortingFixed.concat(e.aaSorting)}else{o=e.aaSorting.slice()}for(a=0;a<e.aoColumns.length;a++){if(e.aoColumns[a].bSortable){l=e.aoColumns[a].sSortingClass;s=-1;for(n=0;n<o.length;n++){if(o[n][0]==a){l="asc"==o[n][1]?d.sSortAsc:d.sSortDesc;s=n;break}}$(e.aoColumns[a].nTh).addClass(l);if(e.bJUI){var u=$("span."+d.sSortIcon,e.aoColumns[a].nTh);u.removeClass(d.sSortJUIAsc+" "+d.sSortJUIDesc+" "+d.sSortJUI+" "+d.sSortJUIAscAllowed+" "+d.sSortJUIDescAllowed);var p;if(-1==s){p=e.aoColumns[a].sSortingClassJUI}else if("asc"==o[s][1]){p=d.sSortJUIAsc}else{p=d.sSortJUIDesc}u.addClass(p)}}else{$(e.aoColumns[a].nTh).addClass(e.aoColumns[a].sSortingClass)}}l=d.sSortColumn;if(e.oFeatures.bSort&&e.oFeatures.bSortClasses){var c=_fnGetTdNodes(e),g,h,f=[];for(a=0;a<r;a++){f.push("")}for(a=0,g=1;a<o.length;a++){h=parseInt(o[a][0],10);f[h]=l+g;if(3>g){g++}}var b=new RegExp(l+"[123]"),S,C,m;for(a=0,t=c.length;a<t;a++){h=a%r;C=c[a].className;m=f[h];S=C.replace(b,m);if(S!=C){c[a].className=$.trim(S)}else if(0<m.length&&-1==C.indexOf(m)){c[a].className=C+" "+m}}}}function _fnSaveState(e){if(!e.oFeatures.bStateSave||e.bDestroying){return}var a,t,n=e.oScroll.bInfinite,s={iCreate:new Date().getTime(),iStart:n?0:e._iDisplayStart,iEnd:n?e._iDisplayLength:e._iDisplayEnd,iLength:e._iDisplayLength,aaSorting:$.extend(!0,[],e.aaSorting),oSearch:$.extend(!0,{},e.oPreviousSearch),aoSearchCols:$.extend(!0,[],e.aoPreSearchCols),abVisCols:[]};for(a=0,t=e.aoColumns.length;a<t;a++){s.abVisCols.push(e.aoColumns[a].bVisible)}_fnCallbackFire(e,"aoStateSaveParams","stateSaveParams",[e,s]);e.fnStateSave.call(e.oInstance,e,s)}function _fnLoadState(e,a){if(!e.oFeatures.bStateSave){return}var t=e.fnStateLoad.call(e.oInstance,e);if(!t){return}var n=_fnCallbackFire(e,"aoStateLoadParams","stateLoadParams",[e,t]);if(-1!==$.inArray(!1,n)){return}e.oLoadedState=$.extend(!0,{},t);e._iDisplayStart=t.iStart;e.iInitDisplayStart=t.iStart;e._iDisplayEnd=t.iEnd;e._iDisplayLength=t.iLength;e.aaSorting=t.aaSorting.slice();e.saved_aaSorting=t.aaSorting.slice();$.extend(e.oPreviousSearch,t.oSearch);$.extend(!0,e.aoPreSearchCols,t.aoSearchCols);a.saved_aoColumns=[];for(var s=0;s<t.abVisCols.length;s++){a.saved_aoColumns[s]={};a.saved_aoColumns[s].bVisible=t.abVisCols[s]}_fnCallbackFire(e,"aoStateLoaded","stateLoaded",[e,t])}function _fnCreateCookie(sName,sValue,iSecs,sBaseName,fnCallback){var date=new Date;date.setTime(date.getTime()+1e3*iSecs);var aParts=window.location.pathname.split("/"),sNameFile=sName+"_"+aParts.pop().replace(/[\/:]/g,"").toLowerCase(),sFullCookie,oData;if(null!==fnCallback){oData="function"==typeof $.parseJSON?$.parseJSON(sValue):eval("("+sValue+")");sFullCookie=fnCallback(sNameFile,oData,date.toGMTString(),aParts.join("/")+"/")}else{sFullCookie=sNameFile+"="+encodeURIComponent(sValue)+"; expires="+date.toGMTString()+"; path="+aParts.join("/")+"/"}var aCookies=document.cookie.split(";"),iNewCookieLen=sFullCookie.split(";")[0].length,aOldCookies=[];if(4096<iNewCookieLen+document.cookie.length+10){for(var i=0,iLen=aCookies.length;i<iLen;i++){if(-1!=aCookies[i].indexOf(sBaseName)){var aSplitCookie=aCookies[i].split("=");try{oData=eval("("+decodeURIComponent(aSplitCookie[1])+")");if(oData&&oData.iCreate){aOldCookies.push({name:aSplitCookie[0],time:oData.iCreate})}}catch(a){}}}aOldCookies.sort(function(e,a){return a.time-e.time});while(4096<iNewCookieLen+document.cookie.length+10){if(0===aOldCookies.length){return}var old=aOldCookies.pop();document.cookie=old.name+"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; path="+aParts.join("/")+"/"}}document.cookie=sFullCookie}function _fnReadCookie(e){for(var a=window.location.pathname.split("/"),t=e+"_"+a[a.length-1].replace(/[\/:]/g,"").toLowerCase()+"=",n=document.cookie.split(";"),s=0,o;s<n.length;s++){o=n[s];while(" "==o.charAt(0)){o=o.substring(1,o.length)}if(0===o.indexOf(t)){return decodeURIComponent(o.substring(t.length,o.length))}}return null}function _fnSettingsFromNode(e){for(var a=0;a<DataTable.settings.length;a++){if(DataTable.settings[a].nTable===e){return DataTable.settings[a]}}return null}function _fnGetTrNodes(e){for(var a=[],t=e.aoData,n=0,s=t.length;n<s;n++){if(null!==t[n].nTr){a.push(t[n].nTr)}}return a}function _fnGetTdNodes(e,a){var t=[],n,i,s,o,l=e.aoData.length,r,d,u,p,c=0,g=l;if(a!==void 0){c=a;g=a+1}for(o=c;o<g;o++){u=e.aoData[o];if(null!==u.nTr){i=[];s=u.nTr.firstChild;while(s){p=s.nodeName.toLowerCase();if("td"==p||"th"==p){i.push(s)}s=s.nextSibling}n=0;for(r=0,d=e.aoColumns.length;r<d;r++){if(e.aoColumns[r].bVisible){t.push(i[r-n])}else{t.push(u._anHidden[r]);n++}}}}return t}function _fnLog(e,a,t){var n=null===e?"DataTables warning: "+t:"DataTables warning (table id = '"+e.sTableId+"'): "+t;if(0===a){if("alert"==DataTable.ext.sErrMode){alert(n)}else{throw new Error(n)}}else if(window.console&&console.log){console.log(n)}}function _fnMap(e,a,t,n){if(n===void 0){n=t}if(a[t]!==void 0){e[n]=a[t]}}function _fnExtend(e,a){var t;for(var n in a){if(a.hasOwnProperty(n)){t=a[n];if("object"===_typeof(oInit[n])&&null!==t&&!1===$.isArray(t)){$.extend(!0,e[n],t)}else{e[n]=t}}}return e}function _fnBindAction(a,e,t){$(a).bind("click.DT",e,function(n){a.blur();t(n)}).bind("keypress.DT",e,function(a){if(13===a.which){t(a)}}).bind("selectstart.DT",function(){return!1})}function _fnCallbackReg(e,a,t,n){if(t){e[a].push({fn:t,sName:n})}}function _fnCallbackFire(e,a,t,n){for(var s=e[a],o=[],l=s.length-1;0<=l;l--){o.push(s[l].fn.apply(e.oInstance,n))}if(null!==t){$(e.oInstance).trigger(t,n)}return o}var _fnJsonString=window.JSON?JSON.stringify:function(e){var a=_typeof(e);if("object"!==a||null===e){if("string"===a){e="\""+e+"\""}return e+""}var t,n,i=[],s=$.isArray(e);for(t in e){n=e[t];a=_typeof(n);if("string"===a){n="\""+n+"\""}else if("object"===a&&null!==n){n=_fnJsonString(n)}i.push((s?"":"\""+t+"\":")+n)}return(s?"[":"{")+i+(s?"]":"}")};function _fnBrowserDetect(e){var a=$("<div style=\"position:absolute; top:0; left:0; height:1px; width:1px; overflow:hidden\"><div style=\"position:absolute; top:1px; left:1px; width:100px; overflow:scroll;\"><div id=\"DT_BrowserTest\" style=\"width:100%; height:10px;\"></div></div></div>")[0];document.body.appendChild(a);e.oBrowser.bScrollOversize=100===$("#DT_BrowserTest",a)[0].offsetWidth?!0:!1;document.body.removeChild(a)}this.$=function(e,t){var n,s,o=[],a,l=_fnSettingsFromNode(this[DataTable.ext.iApiIndex]),r=l.aoData,d=l.aiDisplay,u=l.aiDisplayMaster;if(!t){t={}}t=$.extend({},{filter:"none",order:"current",page:"all"},t);if("current"==t.page){for(n=l._iDisplayStart,s=l.fnDisplayEnd();n<s;n++){a=r[d[n]].nTr;if(a){o.push(a)}}}else if("current"==t.order&&"none"==t.filter){for(n=0,s=u.length;n<s;n++){a=r[u[n]].nTr;if(a){o.push(a)}}}else if("current"==t.order&&"applied"==t.filter){for(n=0,s=d.length;n<s;n++){a=r[d[n]].nTr;if(a){o.push(a)}}}else if("original"==t.order&&"none"==t.filter){for(n=0,s=r.length;n<s;n++){a=r[n].nTr;if(a){o.push(a)}}}else if("original"==t.order&&"applied"==t.filter){for(n=0,s=r.length;n<s;n++){a=r[n].nTr;if(-1!==$.inArray(n,d)&&a){o.push(a)}}}else{_fnLog(l,1,"Unknown selection options")}var p=$(o),c=p.filter(e),g=p.find(e);return $([].concat($.makeArray(c),$.makeArray(g)))};this._=function(e,a){var t=[],n,s,o=this.$(e,a);for(n=0,s=o.length;n<s;n++){t.push(this.fnGetData(o[n]))}return t};this.fnAddData=function(e,a){if(0===e.length){return[]}var t=[],n,s=_fnSettingsFromNode(this[DataTable.ext.iApiIndex]);if("object"===_typeof(e[0])&&null!==e[0]){for(var o=0;o<e.length;o++){n=_fnAddData(s,e[o]);if(-1==n){return t}t.push(n)}}else{n=_fnAddData(s,e);if(-1==n){return t}t.push(n)}s.aiDisplay=s.aiDisplayMaster.slice();if(a===void 0||a){_fnReDraw(s)}return t};this.fnAdjustColumnSizing=function(e){var a=_fnSettingsFromNode(this[DataTable.ext.iApiIndex]);_fnAdjustColumnSizing(a);if(e===void 0||e){this.fnDraw(!1)}else if(""!==a.oScroll.sX||""!==a.oScroll.sY){this.oApi._fnScrollDraw(a)}};this.fnClearTable=function(e){var a=_fnSettingsFromNode(this[DataTable.ext.iApiIndex]);_fnClearTable(a);if(e===void 0||e){_fnDraw(a)}};this.fnClose=function(e){for(var a=_fnSettingsFromNode(this[DataTable.ext.iApiIndex]),t=0;t<a.aoOpenRows.length;t++){if(a.aoOpenRows[t].nParent==e){var n=a.aoOpenRows[t].nTr.parentNode;if(n){n.removeChild(a.aoOpenRows[t].nTr)}a.aoOpenRows.splice(t,1);return 0}}return 1};this.fnDeleteRow=function(e,a,t){var n=_fnSettingsFromNode(this[DataTable.ext.iApiIndex]),s,o,l;l="object"===_typeof(e)?_fnNodeToDataIndex(n,e):e;var r=n.aoData.splice(l,1);for(s=0,o=n.aoData.length;s<o;s++){if(null!==n.aoData[s].nTr){n.aoData[s].nTr._DT_RowIndex=s}}var d=$.inArray(l,n.aiDisplay);n.asDataSearch.splice(d,1);_fnDeleteIndex(n.aiDisplayMaster,l);_fnDeleteIndex(n.aiDisplay,l);if("function"==typeof a){a.call(this,n,r)}if(n._iDisplayStart>=n.fnRecordsDisplay()){n._iDisplayStart-=n._iDisplayLength;if(0>n._iDisplayStart){n._iDisplayStart=0}}if(t===void 0||t){_fnCalculateEnd(n);_fnDraw(n)}return r};this.fnDestroy=function(e){var a=_fnSettingsFromNode(this[DataTable.ext.iApiIndex]),t=a.nTableWrapper.parentNode,n=a.nTBody,s,o;e=e===void 0?!1:e;a.bDestroying=!0;_fnCallbackFire(a,"aoDestroyCallback","destroy",[a]);if(!e){for(s=0,o=a.aoColumns.length;s<o;s++){if(!1===a.aoColumns[s].bVisible){this.fnSetColumnVis(s,!0)}}}$(a.nTableWrapper).find("*").andSelf().unbind(".DT");$("tbody>tr>td."+a.oClasses.sRowEmpty,a.nTable).parent().remove();if(a.nTable!=a.nTHead.parentNode){$(a.nTable).children("thead").remove();a.nTable.appendChild(a.nTHead)}if(a.nTFoot&&a.nTable!=a.nTFoot.parentNode){$(a.nTable).children("tfoot").remove();a.nTable.appendChild(a.nTFoot)}a.nTable.parentNode.removeChild(a.nTable);$(a.nTableWrapper).remove();a.aaSorting=[];a.aaSortingFixed=[];_fnSortingClasses(a);$(_fnGetTrNodes(a)).removeClass(a.asStripeClasses.join(" "));$("th, td",a.nTHead).removeClass([a.oClasses.sSortable,a.oClasses.sSortableAsc,a.oClasses.sSortableDesc,a.oClasses.sSortableNone].join(" "));if(a.bJUI){$("th span."+a.oClasses.sSortIcon+", td span."+a.oClasses.sSortIcon,a.nTHead).remove();$("th, td",a.nTHead).each(function(){var e=$("div."+a.oClasses.sSortJUIWrapper,this),t=e.contents();$(this).append(t);e.remove()})}if(!e&&a.nTableReinsertBefore){t.insertBefore(a.nTable,a.nTableReinsertBefore)}else if(!e){t.appendChild(a.nTable)}for(s=0,o=a.aoData.length;s<o;s++){if(null!==a.aoData[s].nTr){n.appendChild(a.aoData[s].nTr)}}if(!0===a.oFeatures.bAutoWidth){a.nTable.style.width=_fnStringToCss(a.sDestroyWidth)}o=a.asDestroyStripes.length;if(o){var l=$(n).children("tr");for(s=0;s<o;s++){l.filter(":nth-child("+o+"n + "+s+")").addClass(a.asDestroyStripes[s])}}for(s=0,o=DataTable.settings.length;s<o;s++){if(DataTable.settings[s]==a){DataTable.settings.splice(s,1)}}a=null;oInit=null};this.fnDraw=function(e){var a=_fnSettingsFromNode(this[DataTable.ext.iApiIndex]);if(!1===e){_fnCalculateEnd(a);_fnDraw(a)}else{_fnReDraw(a)}};this.fnFilter=function(a,t,s,o,l,r){var d=_fnSettingsFromNode(this[DataTable.ext.iApiIndex]);if(!d.oFeatures.bFilter){return}if(s===void 0||null===s){s=!1}if(o===void 0||null===o){o=!0}if(l===void 0||null===l){l=!0}if(r===void 0||null===r){r=!0}if(t===void 0||null===t){_fnFilterComplete(d,{sSearch:a+"",bRegex:s,bSmart:o,bCaseInsensitive:r},1);if(l&&d.aanFeatures.f){for(var u=d.aanFeatures.f,n=0,e=u.length;n<e;n++){try{if(u[n]._DT_Input!=document.activeElement){$(u[n]._DT_Input).val(a)}}catch(t){$(u[n]._DT_Input).val(a)}}}}else{$.extend(d.aoPreSearchCols[t],{sSearch:a+"",bRegex:s,bSmart:o,bCaseInsensitive:r});_fnFilterComplete(d,d.oPreviousSearch,1)}};this.fnGetData=function(e,a){var t=_fnSettingsFromNode(this[DataTable.ext.iApiIndex]);if(e!==void 0){var n=e;if("object"===_typeof(e)){var i=e.nodeName.toLowerCase();if("tr"===i){n=_fnNodeToDataIndex(t,e)}else if("td"===i){n=_fnNodeToDataIndex(t,e.parentNode);a=_fnNodeToColumnIndex(t,n,e)}}if(a!==void 0){return _fnGetCellData(t,n,a,"")}return t.aoData[n]!==void 0?t.aoData[n]._aData:null}return _fnGetDataMaster(t)};this.fnGetNodes=function(e){var a=_fnSettingsFromNode(this[DataTable.ext.iApiIndex]);if(e!==void 0){return a.aoData[e]!==void 0?a.aoData[e].nTr:null}return _fnGetTrNodes(a)};this.fnGetPosition=function(e){var a=_fnSettingsFromNode(this[DataTable.ext.iApiIndex]),t=e.nodeName.toUpperCase();if("TR"==t){return _fnNodeToDataIndex(a,e)}else if("TD"==t||"TH"==t){var n=_fnNodeToDataIndex(a,e.parentNode),i=_fnNodeToColumnIndex(a,n,e);return[n,_fnColumnIndexToVisible(a,i),i]}return null};this.fnIsOpen=function(e){for(var a=_fnSettingsFromNode(this[DataTable.ext.iApiIndex]),t=a.aoOpenRows,n=0;n<a.aoOpenRows.length;n++){if(a.aoOpenRows[n].nParent==e){return!0}}return!1};this.fnOpen=function(e,a,t){var n=_fnSettingsFromNode(this[DataTable.ext.iApiIndex]),i=_fnGetTrNodes(n);if(-1===$.inArray(e,i)){return}this.fnClose(e);var s=document.createElement("tr"),o=document.createElement("td");s.appendChild(o);o.className=t;o.colSpan=_fnVisbleColumns(n);if("string"==typeof a){o.innerHTML=a}else{$(o).html(a)}var l=$("tr",n.nTBody);if(-1!=$.inArray(e,l)){$(s).insertAfter(e)}n.aoOpenRows.push({nTr:s,nParent:e});return s};this.fnPageChange=function(e,a){var t=_fnSettingsFromNode(this[DataTable.ext.iApiIndex]);_fnPageChange(t,e);_fnCalculateEnd(t);if(a===void 0||a){_fnDraw(t)}};this.fnSetColumnVis=function(e,a,t){var n=_fnSettingsFromNode(this[DataTable.ext.iApiIndex]),s,o,l=n.aoColumns,r=n.aoData,d,u,p;if(l[e].bVisible==a){return}if(a){var c=0;for(s=0;s<e;s++){if(l[s].bVisible){c++}}u=c>=_fnVisbleColumns(n);if(!u){for(s=e;s<l.length;s++){if(l[s].bVisible){p=s;break}}}for(s=0,o=r.length;s<o;s++){if(null!==r[s].nTr){if(u){r[s].nTr.appendChild(r[s]._anHidden[e])}else{r[s].nTr.insertBefore(r[s]._anHidden[e],_fnGetTdNodes(n,s)[p])}}}}else{for(s=0,o=r.length;s<o;s++){if(null!==r[s].nTr){d=_fnGetTdNodes(n,s)[e];r[s]._anHidden[e]=d;d.parentNode.removeChild(d)}}}l[e].bVisible=a;_fnDrawHead(n,n.aoHeader);if(n.nTFoot){_fnDrawHead(n,n.aoFooter)}for(s=0,o=n.aoOpenRows.length;s<o;s++){n.aoOpenRows[s].nTr.colSpan=_fnVisbleColumns(n)}if(t===void 0||t){_fnAdjustColumnSizing(n);_fnDraw(n)}_fnSaveState(n)};this.fnSettings=function(){return _fnSettingsFromNode(this[DataTable.ext.iApiIndex])};this.fnSort=function(e){var a=_fnSettingsFromNode(this[DataTable.ext.iApiIndex]);a.aaSorting=e;_fnSort(a)};this.fnSortListener=function(e,a,t){_fnSortAttachListener(_fnSettingsFromNode(this[DataTable.ext.iApiIndex]),e,a,t)};this.fnUpdate=function(e,a,t,n,s){var o=_fnSettingsFromNode(this[DataTable.ext.iApiIndex]),l,r,d="object"===_typeof(a)?_fnNodeToDataIndex(o,a):a;if($.isArray(e)&&t===void 0){o.aoData[d]._aData=e.slice();for(l=0;l<o.aoColumns.length;l++){this.fnUpdate(_fnGetCellData(o,d,l),d,l,!1,!1)}}else if($.isPlainObject(e)&&t===void 0){o.aoData[d]._aData=$.extend(!0,{},e);for(l=0;l<o.aoColumns.length;l++){this.fnUpdate(_fnGetCellData(o,d,l),d,l,!1,!1)}}else{_fnSetCellData(o,d,t,e);r=_fnGetCellData(o,d,t,"display");var u=o.aoColumns[t];if(null!==u.fnRender){r=_fnRender(o,d,t);if(u.bUseRendered){_fnSetCellData(o,d,t,r)}}if(null!==o.aoData[d].nTr){_fnGetTdNodes(o,d)[t].innerHTML=r}}var p=$.inArray(d,o.aiDisplay);o.asDataSearch[p]=_fnBuildSearchRow(o,_fnGetRowData(o,d,"filter",_fnGetColumns(o,"bSearchable")));if(s===void 0||s){_fnAdjustColumnSizing(o)}if(n===void 0||n){_fnReDraw(o)}return 0};this.fnVersionCheck=DataTable.ext.fnVersionCheck;function _fnExternApiFunc(e){return function(){var a=[_fnSettingsFromNode(this[DataTable.ext.iApiIndex])].concat(Array.prototype.slice.call(arguments));return DataTable.ext.oApi[e].apply(this,a)}}this.oApi={_fnExternApiFunc:_fnExternApiFunc,_fnInitialise:_fnInitialise,_fnInitComplete:_fnInitComplete,_fnLanguageCompat:_fnLanguageCompat,_fnAddColumn:_fnAddColumn,_fnColumnOptions:_fnColumnOptions,_fnAddData:_fnAddData,_fnCreateTr:_fnCreateTr,_fnGatherData:_fnGatherData,_fnBuildHead:_fnBuildHead,_fnDrawHead:_fnDrawHead,_fnDraw:_fnDraw,_fnReDraw:_fnReDraw,_fnAjaxUpdate:_fnAjaxUpdate,_fnAjaxParameters:_fnAjaxParameters,_fnAjaxUpdateDraw:_fnAjaxUpdateDraw,_fnServerParams:_fnServerParams,_fnAddOptionsHtml:_fnAddOptionsHtml,_fnFeatureHtmlTable:_fnFeatureHtmlTable,_fnScrollDraw:_fnScrollDraw,_fnAdjustColumnSizing:_fnAdjustColumnSizing,_fnFeatureHtmlFilter:_fnFeatureHtmlFilter,_fnFilterComplete:_fnFilterComplete,_fnFilterCustom:_fnFilterCustom,_fnFilterColumn:_fnFilterColumn,_fnFilter:_fnFilter,_fnBuildSearchArray:_fnBuildSearchArray,_fnBuildSearchRow:_fnBuildSearchRow,_fnFilterCreateSearch:_fnFilterCreateSearch,_fnDataToSearch:_fnDataToSearch,_fnSort:_fnSort,_fnSortAttachListener:_fnSortAttachListener,_fnSortingClasses:_fnSortingClasses,_fnFeatureHtmlPaginate:_fnFeatureHtmlPaginate,_fnPageChange:_fnPageChange,_fnFeatureHtmlInfo:_fnFeatureHtmlInfo,_fnUpdateInfo:_fnUpdateInfo,_fnFeatureHtmlLength:_fnFeatureHtmlLength,_fnFeatureHtmlProcessing:_fnFeatureHtmlProcessing,_fnProcessingDisplay:_fnProcessingDisplay,_fnVisibleToColumnIndex:_fnVisibleToColumnIndex,_fnColumnIndexToVisible:_fnColumnIndexToVisible,_fnNodeToDataIndex:_fnNodeToDataIndex,_fnVisbleColumns:_fnVisbleColumns,_fnCalculateEnd:_fnCalculateEnd,_fnConvertToWidth:_fnConvertToWidth,_fnCalculateColumnWidths:_fnCalculateColumnWidths,_fnScrollingWidthAdjust:_fnScrollingWidthAdjust,_fnGetWidestNode:_fnGetWidestNode,_fnGetMaxLenString:_fnGetMaxLenString,_fnStringToCss:_fnStringToCss,_fnDetectType:_fnDetectType,_fnSettingsFromNode:_fnSettingsFromNode,_fnGetDataMaster:_fnGetDataMaster,_fnGetTrNodes:_fnGetTrNodes,_fnGetTdNodes:_fnGetTdNodes,_fnEscapeRegex:_fnEscapeRegex,_fnDeleteIndex:_fnDeleteIndex,_fnReOrderIndex:_fnReOrderIndex,_fnColumnOrdering:_fnColumnOrdering,_fnLog:_fnLog,_fnClearTable:_fnClearTable,_fnSaveState:_fnSaveState,_fnLoadState:_fnLoadState,_fnCreateCookie:_fnCreateCookie,_fnReadCookie:_fnReadCookie,_fnDetectHeader:_fnDetectHeader,_fnGetUniqueThs:_fnGetUniqueThs,_fnScrollBarWidth:_fnScrollBarWidth,_fnApplyToChildren:_fnApplyToChildren,_fnMap:_fnMap,_fnGetRowData:_fnGetRowData,_fnGetCellData:_fnGetCellData,_fnSetCellData:_fnSetCellData,_fnGetObjectDataFn:_fnGetObjectDataFn,_fnSetObjectDataFn:_fnSetObjectDataFn,_fnApplyColumnDefs:_fnApplyColumnDefs,_fnBindAction:_fnBindAction,_fnExtend:_fnExtend,_fnCallbackReg:_fnCallbackReg,_fnCallbackFire:_fnCallbackFire,_fnJsonString:_fnJsonString,_fnRender:_fnRender,_fnNodeToColumnIndex:_fnNodeToColumnIndex,_fnInfoMacros:_fnInfoMacros,_fnBrowserDetect:_fnBrowserDetect,_fnGetColumns:_fnGetColumns};$.extend(DataTable.ext.oApi,this.oApi);for(var sFunc in DataTable.ext.oApi){if(sFunc){this[sFunc]=_fnExternApiFunc(sFunc)}}var _that=this;this.each(function(){var e=0,a,t,n,s=this.getAttribute("id"),o=!1,l=!1;if("table"!=this.nodeName.toLowerCase()){_fnLog(null,0,"Attempted to initialise DataTables on a node which is not a table: "+this.nodeName);return}for(e=0,a=DataTable.settings.length;e<a;e++){if(DataTable.settings[e].nTable==this){if(oInit===void 0||oInit.bRetrieve){return DataTable.settings[e].oInstance}else if(oInit.bDestroy){DataTable.settings[e].oInstance.fnDestroy();break}else{_fnLog(DataTable.settings[e],0,"Cannot reinitialise DataTable.\n\nTo retrieve the DataTables object for this table, pass no arguments or see the docs for bRetrieve and bDestroy");return}}if(DataTable.settings[e].sTableId==this.id){DataTable.settings.splice(e,1);break}}if(null===s||""===s){s="DataTables_Table_"+DataTable.ext._oExternConfig.iNextUnique++;this.id=s}var r=$.extend(!0,{},DataTable.models.oSettings,{nTable:this,oApi:_that.oApi,oInit:oInit,sDestroyWidth:$(this).width(),sInstance:s,sTableId:s});DataTable.settings.push(r);r.oInstance=1===_that.length?_that:$(this).dataTable();if(!oInit){oInit={}}if(oInit.oLanguage){_fnLanguageCompat(oInit.oLanguage)}oInit=_fnExtend($.extend(!0,{},DataTable.defaults),oInit);_fnMap(r.oFeatures,oInit,"bPaginate");_fnMap(r.oFeatures,oInit,"bLengthChange");_fnMap(r.oFeatures,oInit,"bFilter");_fnMap(r.oFeatures,oInit,"bSort");_fnMap(r.oFeatures,oInit,"bInfo");_fnMap(r.oFeatures,oInit,"bProcessing");_fnMap(r.oFeatures,oInit,"bAutoWidth");_fnMap(r.oFeatures,oInit,"bSortClasses");_fnMap(r.oFeatures,oInit,"bServerSide");_fnMap(r.oFeatures,oInit,"bDeferRender");_fnMap(r.oScroll,oInit,"sScrollX","sX");_fnMap(r.oScroll,oInit,"sScrollXInner","sXInner");_fnMap(r.oScroll,oInit,"sScrollY","sY");_fnMap(r.oScroll,oInit,"bScrollCollapse","bCollapse");_fnMap(r.oScroll,oInit,"bScrollInfinite","bInfinite");_fnMap(r.oScroll,oInit,"iScrollLoadGap","iLoadGap");_fnMap(r.oScroll,oInit,"bScrollAutoCss","bAutoCss");_fnMap(r,oInit,"asStripeClasses");_fnMap(r,oInit,"asStripClasses","asStripeClasses");_fnMap(r,oInit,"fnServerData");_fnMap(r,oInit,"fnFormatNumber");_fnMap(r,oInit,"sServerMethod");_fnMap(r,oInit,"aaSorting");_fnMap(r,oInit,"aaSortingFixed");_fnMap(r,oInit,"aLengthMenu");_fnMap(r,oInit,"sPaginationType");_fnMap(r,oInit,"sAjaxSource");_fnMap(r,oInit,"sAjaxDataProp");_fnMap(r,oInit,"iCookieDuration");_fnMap(r,oInit,"sCookiePrefix");_fnMap(r,oInit,"sDom");_fnMap(r,oInit,"bSortCellsTop");_fnMap(r,oInit,"iTabIndex");_fnMap(r,oInit,"oSearch","oPreviousSearch");_fnMap(r,oInit,"aoSearchCols","aoPreSearchCols");_fnMap(r,oInit,"iDisplayLength","_iDisplayLength");_fnMap(r,oInit,"bJQueryUI","bJUI");_fnMap(r,oInit,"fnCookieCallback");_fnMap(r,oInit,"fnStateLoad");_fnMap(r,oInit,"fnStateSave");_fnMap(r.oLanguage,oInit,"fnInfoCallback");_fnCallbackReg(r,"aoDrawCallback",oInit.fnDrawCallback,"user");_fnCallbackReg(r,"aoServerParams",oInit.fnServerParams,"user");_fnCallbackReg(r,"aoStateSaveParams",oInit.fnStateSaveParams,"user");_fnCallbackReg(r,"aoStateLoadParams",oInit.fnStateLoadParams,"user");_fnCallbackReg(r,"aoStateLoaded",oInit.fnStateLoaded,"user");_fnCallbackReg(r,"aoRowCallback",oInit.fnRowCallback,"user");_fnCallbackReg(r,"aoRowCreatedCallback",oInit.fnCreatedRow,"user");_fnCallbackReg(r,"aoHeaderCallback",oInit.fnHeaderCallback,"user");_fnCallbackReg(r,"aoFooterCallback",oInit.fnFooterCallback,"user");_fnCallbackReg(r,"aoInitComplete",oInit.fnInitComplete,"user");_fnCallbackReg(r,"aoPreDrawCallback",oInit.fnPreDrawCallback,"user");if(r.oFeatures.bServerSide&&r.oFeatures.bSort&&r.oFeatures.bSortClasses){_fnCallbackReg(r,"aoDrawCallback",_fnSortingClasses,"server_side_sort_classes")}else if(r.oFeatures.bDeferRender){_fnCallbackReg(r,"aoDrawCallback",_fnSortingClasses,"defer_sort_classes")}if(oInit.bJQueryUI){$.extend(r.oClasses,DataTable.ext.oJUIClasses);if(oInit.sDom===DataTable.defaults.sDom&&"lfrtip"===DataTable.defaults.sDom){r.sDom="<\"H\"lfr>t<\"F\"ip>"}}else{$.extend(r.oClasses,DataTable.ext.oStdClasses)}$(this).addClass(r.oClasses.sTable);if(""!==r.oScroll.sX||""!==r.oScroll.sY){r.oScroll.iBarWidth=_fnScrollBarWidth()}if(r.iInitDisplayStart===void 0){r.iInitDisplayStart=oInit.iDisplayStart;r._iDisplayStart=oInit.iDisplayStart}if(oInit.bStateSave){r.oFeatures.bStateSave=!0;_fnLoadState(r,oInit);_fnCallbackReg(r,"aoDrawCallback",_fnSaveState,"state_save")}if(null!==oInit.iDeferLoading){r.bDeferLoading=!0;var d=$.isArray(oInit.iDeferLoading);r._iRecordsDisplay=d?oInit.iDeferLoading[0]:oInit.iDeferLoading;r._iRecordsTotal=d?oInit.iDeferLoading[1]:oInit.iDeferLoading}if(null!==oInit.aaData){l=!0}if(""!==oInit.oLanguage.sUrl){r.oLanguage.sUrl=oInit.oLanguage.sUrl;$.getJSON(r.oLanguage.sUrl,null,function(e){_fnLanguageCompat(e);$.extend(!0,r.oLanguage,oInit.oLanguage,e);_fnInitialise(r)});o=!0}else{$.extend(!0,r.oLanguage,oInit.oLanguage)}if(null===oInit.asStripeClasses){r.asStripeClasses=[r.oClasses.sStripeOdd,r.oClasses.sStripeEven]}a=r.asStripeClasses.length;r.asDestroyStripes=[];if(a){var u=!1,p=$(this).children("tbody").children("tr:lt("+a+")");for(e=0;e<a;e++){if(p.hasClass(r.asStripeClasses[e])){u=!0;r.asDestroyStripes.push(r.asStripeClasses[e])}}if(u){p.removeClass(r.asStripeClasses.join(" "))}}var c=[],g,h=this.getElementsByTagName("thead");if(0!==h.length){_fnDetectHeader(r.aoHeader,h[0]);c=_fnGetUniqueThs(r)}if(null===oInit.aoColumns){g=[];for(e=0,a=c.length;e<a;e++){g.push(null)}}else{g=oInit.aoColumns}for(e=0,a=g.length;e<a;e++){if(oInit.saved_aoColumns!==void 0&&oInit.saved_aoColumns.length==a){if(null===g[e]){g[e]={}}g[e].bVisible=oInit.saved_aoColumns[e].bVisible}_fnAddColumn(r,c?c[e]:null)}_fnApplyColumnDefs(r,oInit.aoColumnDefs,g,function(e,a){_fnColumnOptions(r,e,a)});for(e=0,a=r.aaSorting.length;e<a;e++){if(r.aaSorting[e][0]>=r.aoColumns.length){r.aaSorting[e][0]=0}var f=r.aoColumns[r.aaSorting[e][0]];if(r.aaSorting[e][2]===void 0){r.aaSorting[e][2]=0}if(oInit.aaSorting===void 0&&r.saved_aaSorting===void 0){r.aaSorting[e][1]=f.asSorting[0]}for(t=0,n=f.asSorting.length;t<n;t++){if(r.aaSorting[e][1]==f.asSorting[t]){r.aaSorting[e][2]=t;break}}}_fnSortingClasses(r);_fnBrowserDetect(r);var b=$(this).children("caption").each(function(){this._captionSide=$(this).css("caption-side")}),S=$(this).children("thead");if(0===S.length){S=[document.createElement("thead")];this.appendChild(S[0])}r.nTHead=S[0];var C=$(this).children("tbody");if(0===C.length){C=[document.createElement("tbody")];this.appendChild(C[0])}r.nTBody=C[0];r.nTBody.setAttribute("role","alert");r.nTBody.setAttribute("aria-live","polite");r.nTBody.setAttribute("aria-relevant","all");var m=$(this).children("tfoot");if(0===m.length&&0<b.length&&(""!==r.oScroll.sX||""!==r.oScroll.sY)){m=[document.createElement("tfoot")];this.appendChild(m[0])}if(0<m.length){r.nTFoot=m[0];_fnDetectHeader(r.aoFooter,r.nTFoot)}if(l){for(e=0;e<oInit.aaData.length;e++){_fnAddData(r,oInit.aaData[e])}}else{_fnGatherData(r)}r.aiDisplay=r.aiDisplayMaster.slice();r.bInitialised=!0;if(!1===o){_fnInitialise(r)}});_that=null;return this};DataTable.fnVersionCheck=function(e){for(var a=function(e,a){while(e.length<a){e+="0"}return e},t=DataTable.ext.sVersion.split("."),n=e.split("."),s="",o="",l=0,r=n.length;l<r;l++){s+=a(t[l],3);o+=a(n[l],3)}return parseInt(s,10)>=parseInt(o,10)};DataTable.fnIsDataTable=function(e){for(var a=DataTable.settings,t=0;t<a.length;t++){if(a[t].nTable===e||a[t].nScrollHead===e||a[t].nScrollFoot===e){return!0}}return!1};DataTable.fnTables=function(e){var a=[];jQuery.each(DataTable.settings,function(t,n){if(!e||!0===e&&$(n.nTable).is(":visible")){a.push(n.nTable)}});return a};DataTable.version="1.9.4";DataTable.settings=[];DataTable.models={};DataTable.models.ext={afnFiltering:[],afnSortData:[],aoFeatures:[],aTypes:[],fnVersionCheck:DataTable.fnVersionCheck,iApiIndex:0,ofnSearch:{},oApi:{},oStdClasses:{},oJUIClasses:{},oPagination:{},oSort:{},sVersion:DataTable.version,sErrMode:"alert",_oExternConfig:{iNextUnique:0}};DataTable.models.oSearch={bCaseInsensitive:!0,sSearch:"",bRegex:!1,bSmart:!0};DataTable.models.oRow={nTr:null,_aData:[],_aSortData:[],_anHidden:[],_sRowStripe:""};DataTable.models.oColumn={aDataSort:null,asSorting:null,bSearchable:null,bSortable:null,bUseRendered:null,bVisible:null,_bAutoType:!0,fnCreatedCell:null,fnGetData:null,fnRender:null,fnSetData:null,mData:null,mRender:null,nTh:null,nTf:null,sClass:null,sContentPadding:null,sDefaultContent:null,sName:null,sSortDataType:"std",sSortingClass:null,sSortingClassJUI:null,sTitle:null,sType:null,sWidth:null,sWidthOrig:null};DataTable.defaults={aaData:null,aaSorting:[[0,"asc"]],aaSortingFixed:null,aLengthMenu:[10,25,50,100],aoColumns:null,aoColumnDefs:null,aoSearchCols:[],asStripeClasses:null,bAutoWidth:!0,bDeferRender:!1,bDestroy:!1,bFilter:!0,bInfo:!0,bJQueryUI:!1,bLengthChange:!0,bPaginate:!0,bProcessing:!1,bRetrieve:!1,bScrollAutoCss:!0,bScrollCollapse:!1,bScrollInfinite:!1,bServerSide:!1,bSort:!0,bSortCellsTop:!1,bSortClasses:!0,bStateSave:!1,fnCookieCallback:null,fnCreatedRow:null,fnDrawCallback:null,fnFooterCallback:null,fnFormatNumber:function fnFormatNumber(e){if(1e3>e){return e}for(var t=e+"",n=t.split(""),a="",s=t.length,o=0;o<s;o++){if(0==o%3&&0!=o){a=this.oLanguage.sInfoThousands+a}a=n[s-o-1]+a}return a},fnHeaderCallback:null,fnInfoCallback:null,fnInitComplete:null,fnPreDrawCallback:null,fnRowCallback:null,fnServerData:function fnServerData(e,a,t,n){n.jqXHR=$.ajax({url:e,data:a,success:function success(e){if(e.sError){n.oApi._fnLog(n,0,e.sError)}$(n.oInstance).trigger("xhr",[n,e]);t(e)},dataType:"json",cache:!1,type:n.sServerMethod,error:function error(e,a){if("parsererror"==a){n.oApi._fnLog(n,0,"DataTables warning: JSON data from server could not be parsed. This is caused by a JSON formatting error.")}}})},fnServerParams:null,fnStateLoad:function fnStateLoad(oSettings){var sData=this.oApi._fnReadCookie(oSettings.sCookiePrefix+oSettings.sInstance),oData;try{oData="function"==typeof $.parseJSON?$.parseJSON(sData):eval("("+sData+")")}catch(a){oData=null}return oData},fnStateLoadParams:null,fnStateLoaded:null,fnStateSave:function fnStateSave(e,a){this.oApi._fnCreateCookie(e.sCookiePrefix+e.sInstance,this.oApi._fnJsonString(a),e.iCookieDuration,e.sCookiePrefix,e.fnCookieCallback)},fnStateSaveParams:null,iCookieDuration:7200,iDeferLoading:null,iDisplayLength:10,iDisplayStart:0,iScrollLoadGap:100,iTabIndex:0,oLanguage:{oAria:{sSortAscending:": activate to sort column ascending",sSortDescending:": activate to sort column descending"},oPaginate:{sFirst:"First",sLast:"Last",sNext:"Next",sPrevious:"Previous"},sEmptyTable:"No data available in table",sInfo:"Showing _START_ to _END_ of _TOTAL_ entries",sInfoEmpty:"Showing 0 to 0 of 0 entries",sInfoFiltered:"(filtered from _MAX_ total entries)",sInfoPostFix:"",sInfoThousands:",",sLengthMenu:"Show _MENU_ entries",sLoadingRecords:"Loading...",sProcessing:"Processing...",sSearch:"Search:",sUrl:"",sZeroRecords:"No matching records found"},oSearch:$.extend({},DataTable.models.oSearch),sAjaxDataProp:"aaData",sAjaxSource:null,sCookiePrefix:"SpryMedia_DataTables_",sDom:"lfrtip",sPaginationType:"two_button",sScrollX:"",sScrollXInner:"",sScrollY:"",sServerMethod:"GET"};DataTable.defaults.columns={aDataSort:null,asSorting:["asc","desc"],bSearchable:!0,bSortable:!0,bUseRendered:!0,bVisible:!0,fnCreatedCell:null,fnRender:null,iDataSort:-1,mData:null,mRender:null,sCellType:"td",sClass:"",sContentPadding:"",sDefaultContent:null,sName:"",sSortDataType:"std",sTitle:null,sType:null,sWidth:null};DataTable.models.oSettings={oFeatures:{bAutoWidth:null,bDeferRender:null,bFilter:null,bInfo:null,bLengthChange:null,bPaginate:null,bProcessing:null,bServerSide:null,bSort:null,bSortClasses:null,bStateSave:null},oScroll:{bAutoCss:null,bCollapse:null,bInfinite:null,iBarWidth:0,iLoadGap:null,sX:null,sXInner:null,sY:null},oLanguage:{fnInfoCallback:null},oBrowser:{bScrollOversize:!1},aanFeatures:[],aoData:[],aiDisplay:[],aiDisplayMaster:[],aoColumns:[],aoHeader:[],aoFooter:[],asDataSearch:[],oPreviousSearch:{},aoPreSearchCols:[],aaSorting:null,aaSortingFixed:null,asStripeClasses:null,asDestroyStripes:[],sDestroyWidth:0,aoRowCallback:[],aoHeaderCallback:[],aoFooterCallback:[],aoDrawCallback:[],aoRowCreatedCallback:[],aoPreDrawCallback:[],aoInitComplete:[],aoStateSaveParams:[],aoStateLoadParams:[],aoStateLoaded:[],sTableId:"",nTable:null,nTHead:null,nTFoot:null,nTBody:null,nTableWrapper:null,bDeferLoading:!1,bInitialised:!1,aoOpenRows:[],sDom:null,sPaginationType:"two_button",iCookieDuration:0,sCookiePrefix:"",fnCookieCallback:null,aoStateSave:[],aoStateLoad:[],oLoadedState:null,sAjaxSource:null,sAjaxDataProp:null,bAjaxDataGet:!0,jqXHR:null,fnServerData:null,aoServerParams:[],sServerMethod:null,fnFormatNumber:null,aLengthMenu:null,iDraw:0,bDrawing:!1,iDrawError:-1,_iDisplayLength:10,_iDisplayStart:0,_iDisplayEnd:10,_iRecordsTotal:0,_iRecordsDisplay:0,bJUI:null,oClasses:{},bFiltered:!1,bSorted:!1,bSortCellsTop:null,oInit:null,aoDestroyCallback:[],fnRecordsTotal:function fnRecordsTotal(){if(this.oFeatures.bServerSide){return parseInt(this._iRecordsTotal,10)}else{return this.aiDisplayMaster.length}},fnRecordsDisplay:function fnRecordsDisplay(){if(this.oFeatures.bServerSide){return parseInt(this._iRecordsDisplay,10)}else{return this.aiDisplay.length}},fnDisplayEnd:function fnDisplayEnd(){if(this.oFeatures.bServerSide){if(!1===this.oFeatures.bPaginate||-1==this._iDisplayLength){return this._iDisplayStart+this.aiDisplay.length}else{return Math.min(this._iDisplayStart+this._iDisplayLength,this._iRecordsDisplay)}}else{return this._iDisplayEnd}},oInstance:null,sInstance:null,iTabIndex:0,nScrollHead:null,nScrollFoot:null};DataTable.ext=$.extend(!0,{},DataTable.models.ext);$.extend(DataTable.ext.oStdClasses,{sTable:"dataTable",sPagePrevEnabled:"paginate_enabled_previous",sPagePrevDisabled:"paginate_disabled_previous",sPageNextEnabled:"paginate_enabled_next",sPageNextDisabled:"paginate_disabled_next",sPageJUINext:"",sPageJUIPrev:"",sPageButton:"paginate_button",sPageButtonActive:"paginate_active",sPageButtonStaticDisabled:"paginate_button paginate_button_disabled",sPageFirst:"first",sPagePrevious:"previous",sPageNext:"next",sPageLast:"last",sStripeOdd:"odd",sStripeEven:"even",sRowEmpty:"dataTables_empty",sWrapper:"dataTables_wrapper",sFilter:"dataTables_filter",sInfo:"dataTables_info",sPaging:"dataTables_paginate paging_",sLength:"dataTables_length",sProcessing:"dataTables_processing",sSortAsc:"sorting_asc",sSortDesc:"sorting_desc",sSortable:"sorting",sSortableAsc:"sorting_asc_disabled",sSortableDesc:"sorting_desc_disabled",sSortableNone:"sorting_disabled",sSortColumn:"sorting_",sSortJUIAsc:"",sSortJUIDesc:"",sSortJUI:"",sSortJUIAscAllowed:"",sSortJUIDescAllowed:"",sSortJUIWrapper:"",sSortIcon:"",sScrollWrapper:"dataTables_scroll",sScrollHead:"dataTables_scrollHead",sScrollHeadInner:"dataTables_scrollHeadInner",sScrollBody:"dataTables_scrollBody",sScrollFoot:"dataTables_scrollFoot",sScrollFootInner:"dataTables_scrollFootInner",sFooterTH:"",sJUIHeader:"",sJUIFooter:""});$.extend(DataTable.ext.oJUIClasses,DataTable.ext.oStdClasses,{sPagePrevEnabled:"fg-button ui-button ui-state-default ui-corner-left",sPagePrevDisabled:"fg-button ui-button ui-state-default ui-corner-left ui-state-disabled",sPageNextEnabled:"fg-button ui-button ui-state-default ui-corner-right",sPageNextDisabled:"fg-button ui-button ui-state-default ui-corner-right ui-state-disabled",sPageJUINext:"ui-icon ui-icon-circle-arrow-e",sPageJUIPrev:"ui-icon ui-icon-circle-arrow-w",sPageButton:"fg-button ui-button ui-state-default",sPageButtonActive:"fg-button ui-button ui-state-default ui-state-disabled",sPageButtonStaticDisabled:"fg-button ui-button ui-state-default ui-state-disabled",sPageFirst:"first ui-corner-tl ui-corner-bl",sPageLast:"last ui-corner-tr ui-corner-br",sPaging:"dataTables_paginate fg-buttonset ui-buttonset fg-buttonset-multi ui-buttonset-multi paging_",sSortAsc:"ui-state-default",sSortDesc:"ui-state-default",sSortable:"ui-state-default",sSortableAsc:"ui-state-default",sSortableDesc:"ui-state-default",sSortableNone:"ui-state-default",sSortJUIAsc:"css_right ui-icon ui-icon-triangle-1-n",sSortJUIDesc:"css_right ui-icon ui-icon-triangle-1-s",sSortJUI:"css_right ui-icon ui-icon-carat-2-n-s",sSortJUIAscAllowed:"css_right ui-icon ui-icon-carat-1-n",sSortJUIDescAllowed:"css_right ui-icon ui-icon-carat-1-s",sSortJUIWrapper:"DataTables_sort_wrapper",sSortIcon:"DataTables_sort_icon",sScrollHead:"dataTables_scrollHead ui-state-default",sScrollFoot:"dataTables_scrollFoot ui-state-default",sFooterTH:"ui-state-default",sJUIHeader:"fg-toolbar ui-toolbar ui-widget-header ui-corner-tl ui-corner-tr ui-helper-clearfix",sJUIFooter:"fg-toolbar ui-toolbar ui-widget-header ui-corner-bl ui-corner-br ui-helper-clearfix"});$.extend(DataTable.ext.oPagination,{two_button:{fnInit:function fnInit(a,t,n){var i=a.oLanguage.oPaginate,s=a.oClasses,o=function(t){if(a.oApi._fnPageChange(a,t.data.action)){n(a)}},l=!a.bJUI?"<a class=\""+a.oClasses.sPagePrevDisabled+"\" tabindex=\""+a.iTabIndex+"\" role=\"button\">"+i.sPrevious+"</a><a class=\""+a.oClasses.sPageNextDisabled+"\" tabindex=\""+a.iTabIndex+"\" role=\"button\">"+i.sNext+"</a>":"<a class=\""+a.oClasses.sPagePrevDisabled+"\" tabindex=\""+a.iTabIndex+"\" role=\"button\"><span class=\""+a.oClasses.sPageJUIPrev+"\"></span></a><a class=\""+a.oClasses.sPageNextDisabled+"\" tabindex=\""+a.iTabIndex+"\" role=\"button\"><span class=\""+a.oClasses.sPageJUINext+"\"></span></a>";$(t).append(l);var r=$("a",t),d=r[0],u=r[1];a.oApi._fnBindAction(d,{action:"previous"},o);a.oApi._fnBindAction(u,{action:"next"},o);if(!a.aanFeatures.p){t.id=a.sTableId+"_paginate";d.id=a.sTableId+"_previous";u.id=a.sTableId+"_next";d.setAttribute("aria-controls",a.sTableId);u.setAttribute("aria-controls",a.sTableId)}},fnUpdate:function fnUpdate(e){if(!e.aanFeatures.p){return}for(var a=e.oClasses,t=e.aanFeatures.p,n,s=0,o=t.length;s<o;s++){n=t[s].firstChild;if(n){n.className=0===e._iDisplayStart?a.sPagePrevDisabled:a.sPagePrevEnabled;n=n.nextSibling;n.className=e.fnDisplayEnd()==e.fnRecordsDisplay()?a.sPageNextDisabled:a.sPageNextEnabled}}}},iFullNumbersShowPages:5,full_numbers:{fnInit:function fnInit(a,t,n){var i=a.oLanguage.oPaginate,s=a.oClasses,o=function(t){if(a.oApi._fnPageChange(a,t.data.action)){n(a)}};$(t).append("<a  tabindex=\""+a.iTabIndex+"\" class=\""+s.sPageButton+" "+s.sPageFirst+"\">"+i.sFirst+"</a><a  tabindex=\""+a.iTabIndex+"\" class=\""+s.sPageButton+" "+s.sPagePrevious+"\">"+i.sPrevious+"</a><span></span><a tabindex=\""+a.iTabIndex+"\" class=\""+s.sPageButton+" "+s.sPageNext+"\">"+i.sNext+"</a><a tabindex=\""+a.iTabIndex+"\" class=\""+s.sPageButton+" "+s.sPageLast+"\">"+i.sLast+"</a>");var l=$("a",t),r=l[0],d=l[1],u=l[2],p=l[3];a.oApi._fnBindAction(r,{action:"first"},o);a.oApi._fnBindAction(d,{action:"previous"},o);a.oApi._fnBindAction(u,{action:"next"},o);a.oApi._fnBindAction(p,{action:"last"},o);if(!a.aanFeatures.p){t.id=a.sTableId+"_paginate";r.id=a.sTableId+"_first";d.id=a.sTableId+"_previous";u.id=a.sTableId+"_next";p.id=a.sTableId+"_last"}},fnUpdate:function fnUpdate(a,t){if(!a.aanFeatures.p){return}var n=DataTable.ext.oPagination.iFullNumbersShowPages,s=Math.floor(n/2),o=Math.ceil(a.fnRecordsDisplay()/a._iDisplayLength),l=Math.ceil(a._iDisplayStart/a._iDisplayLength)+1,r="",d,u,p,e,c=a.oClasses,g,h,f,b=a.aanFeatures.p,S=function(e){a.oApi._fnBindAction(this,{page:e+d-1},function(n){a.oApi._fnPageChange(a,n.data.page);t(a);n.preventDefault()})};if(-1===a._iDisplayLength){d=1;u=1;l=1}else if(o<n){d=1;u=o}else if(l<=s){d=1;u=n}else if(l>=o-s){d=o-n+1;u=o}else{d=l-Math.ceil(n/2)+1;u=d+n-1}for(p=d;p<=u;p++){r+=l!==p?"<a tabindex=\""+a.iTabIndex+"\" class=\""+c.sPageButton+"\">"+a.fnFormatNumber(p)+"</a>":"<a tabindex=\""+a.iTabIndex+"\" class=\""+c.sPageButtonActive+"\">"+a.fnFormatNumber(p)+"</a>"}for(p=0,e=b.length;p<e;p++){f=b[p];if(!f.hasChildNodes()){continue}$("span:eq(0)",f).html(r).children("a").each(S);g=f.getElementsByTagName("a");h=[g[0],g[1],g[g.length-2],g[g.length-1]];$(h).removeClass(c.sPageButton+" "+c.sPageButtonActive+" "+c.sPageButtonStaticDisabled);$([h[0],h[1]]).addClass(1==l?c.sPageButtonStaticDisabled:c.sPageButton);$([h[2],h[3]]).addClass(0===o||l===o||-1===a._iDisplayLength?c.sPageButtonStaticDisabled:c.sPageButton)}}}});$.extend(DataTable.ext.oSort,{"string-pre":function stringPre(e){if("string"!=typeof e){e=null!==e&&e.toString?e.toString():""}return e.toLowerCase()},"string-asc":function stringAsc(e,a){return e<a?-1:e>a?1:0},"string-desc":function stringDesc(e,a){return e<a?1:e>a?-1:0},"html-pre":function htmlPre(e){return e.replace(/<.*?>/g,"").toLowerCase()},"html-asc":function htmlAsc(e,a){return e<a?-1:e>a?1:0},"html-desc":function htmlDesc(e,a){return e<a?1:e>a?-1:0},"date-pre":function datePre(e){var a=Date.parse(e);if(isNaN(a)||""===a){a=Date.parse("01/01/1970 00:00:00")}return a},"date-asc":function dateAsc(e,a){return e-a},"date-desc":function dateDesc(e,a){return a-e},"numeric-pre":function numericPre(e){return"-"==e||""===e?0:1*e},"numeric-asc":function numericAsc(e,a){return e-a},"numeric-desc":function numericDesc(e,a){return a-e}});$.extend(DataTable.ext.aTypes,[function(e){if("number"==typeof e){return"numeric"}else if("string"!=typeof e){return null}var a,t=!1;a=e.charAt(0);if(-1=="0123456789-".indexOf(a)){return null}for(var n=1;n<e.length;n++){a=e.charAt(n);if(-1=="0123456789.".indexOf(a)){return null}if("."==a){if(t){return null}t=!0}}return"numeric"},function(e){var a=Date.parse(e);if(null!==a&&!isNaN(a)||"string"==typeof e&&0===e.length){return"date"}return null},function(e){if("string"==typeof e&&-1!=e.indexOf("<")&&-1!=e.indexOf(">")){return"html"}return null}]);$.fn.DataTable=DataTable;$.fn.dataTable=DataTable;$.fn.dataTableSettings=DataTable.settings;$.fn.dataTableExt=DataTable.ext})})(window,document);
function _typeof(e){if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(e){return typeof e}}else{_typeof=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return _typeof(e)}(function(e){if("function"==typeof define&&define.amd){define ("block_configurable_reports/jquery.tablesorter",["jquery"],e)}else if("object"===("undefined"==typeof module?"undefined":_typeof(module))&&"object"===_typeof(module.exports)){module.exports=e(require("jquery"))}else{e(jQuery)}})(function(e){(function(t){'use strict';var r=t.tablesorter={version:"2.31.0",parsers:[],widgets:[],defaults:{theme:"default",widthFixed:!1,showProcessing:!1,headerTemplate:"{content}",onRenderTemplate:null,onRenderHeader:null,cancelSelection:!0,tabIndex:!0,dateFormat:"mmddyyyy",sortMultiSortKey:"shiftKey",sortResetKey:"ctrlKey",usNumberFormat:!0,delayInit:!1,serverSideSorting:!1,resort:!0,headers:{},ignoreCase:!0,sortForce:null,sortList:[],sortAppend:null,sortStable:!1,sortInitialOrder:"asc",sortLocaleCompare:!1,sortReset:!1,sortRestart:!1,emptyTo:"bottom",stringTo:"max",duplicateSpan:!0,textExtraction:"basic",textAttribute:"data-text",textSorter:null,numberSorter:null,initWidgets:!0,widgetClass:"widget-{name}",widgets:[],widgetOptions:{zebra:["even","odd"]},initialized:null,tableClass:"",cssAsc:"",cssDesc:"",cssNone:"",cssHeader:"",cssHeaderRow:"",cssProcessing:"",cssChildRow:"tablesorter-childRow",cssInfoBlock:"tablesorter-infoOnly",cssNoSort:"tablesorter-noSort",cssIgnoreRow:"tablesorter-ignoreRow",cssIcon:"tablesorter-icon",cssIconNone:"",cssIconAsc:"",cssIconDesc:"",cssIconDisabled:"",pointerClick:"click",pointerDown:"mousedown",pointerUp:"mouseup",selectorHeaders:"> thead th, > thead td",selectorSort:"th, td",selectorRemove:".remove-me",debug:!1,headerList:[],empties:{},strings:{},parsers:[],globalize:0,imgAttr:0},css:{table:"tablesorter",cssHasChild:"tablesorter-hasChildRow",childRow:"tablesorter-childRow",colgroup:"tablesorter-colgroup",header:"tablesorter-header",headerRow:"tablesorter-headerRow",headerIn:"tablesorter-header-inner",icon:"tablesorter-icon",processing:"tablesorter-processing",sortAsc:"tablesorter-headerAsc",sortDesc:"tablesorter-headerDesc",sortNone:"tablesorter-headerUnSorted"},language:{sortAsc:"Ascending sort applied, ",sortDesc:"Descending sort applied, ",sortNone:"No sort applied, ",sortDisabled:"sorting is disabled",nextAsc:"activate to apply an ascending sort",nextDesc:"activate to apply a descending sort",nextNone:"activate to remove the sort"},regex:{templateContent:/\{content\}/g,templateIcon:/\{icon\}/g,templateName:/\{name\}/i,spaces:/\s+/g,nonWord:/\W/g,formElements:/(input|select|button|textarea)/i,chunk:/(^([+\-]?(?:\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[0-9a-f]+$|\d+)/gi,chunks:/(^\\0|\\0$)/,hex:/^0x[0-9a-f]+$/i,comma:/,/g,digitNonUS:/[\s|\.]/g,digitNegativeTest:/^\s*\([.\d]+\)/,digitNegativeReplace:/^\s*\(([.\d]+)\)/,digitTest:/^[\-+(]?\d+[)]?$/,digitReplace:/[,.'"\s]/g},string:{max:1,min:-1,emptymin:1,emptymax:-1,zero:0,none:0,null:0,top:!0,bottom:!1},keyCodes:{enter:13},dates:{},instanceMethods:{},setup:function setup(s,a){if(!s||!s.tHead||0===s.tBodies.length||!0===s.hasInitialized){if(r.debug(a,"core")){if(s.hasInitialized){console.warn("Stopping initialization. Tablesorter has already been initialized")}else{console.error("Stopping initialization! No table, thead or tbody",s)}}return}var e="",o=t(s),n=t.metadata;s.hasInitialized=!1;s.isProcessing=!0;s.config=a;t.data(s,"tablesorter",a);if(r.debug(a,"core")){console[console.group?"group":"log"]("Initializing tablesorter v"+r.version);t.data(s,"startoveralltimer",new Date)}a.supportsDataObject=function(e){e[0]=parseInt(e[0],10);return 1<e[0]||1===e[0]&&4<=parseInt(e[1],10)}(t.fn.jquery.split("."));a.emptyTo=a.emptyTo.toLowerCase();a.stringTo=a.stringTo.toLowerCase();a.last={sortList:[],clickedIndex:-1};if(!/tablesorter\-/.test(o.attr("class"))){e=""!==a.theme?" tablesorter-"+a.theme:""}if(!a.namespace){a.namespace=".tablesorter"+Math.random().toString(16).slice(2)}else{a.namespace="."+a.namespace.replace(r.regex.nonWord,"")}a.table=s;a.$table=o.addClass(r.css.table+" "+a.tableClass+e+" "+a.namespace.slice(1)).attr("role","grid");a.$headers=o.find(a.selectorHeaders);a.$table.children().children("tr").attr("role","row");a.$tbodies=o.children("tbody:not(."+a.cssInfoBlock+")").attr({"aria-live":"polite","aria-relevant":"all"});if(a.$table.children("caption").length){e=a.$table.children("caption")[0];if(!e.id){e.id=a.namespace.slice(1)+"caption"}a.$table.attr("aria-labelledby",e.id)}a.widgetInit={};a.textExtraction=a.$table.attr("data-text-extraction")||a.textExtraction||"basic";r.buildHeaders(a);r.fixColumnWidth(s);r.addWidgetFromClass(s);r.applyWidgetOptions(s);r.setupParsers(a);a.totalRows=0;if(a.debug){r.validateOptions(a)}if(!a.delayInit){r.buildCache(a)}r.bindEvents(s,a.$headers,!0);r.bindMethods(a);if(a.supportsDataObject&&"undefined"!=typeof o.data().sortlist){a.sortList=o.data().sortlist}else if(n&&o.metadata()&&o.metadata().sortlist){a.sortList=o.metadata().sortlist}r.applyWidget(s,!0);if(0<a.sortList.length){r.sortOn(a,a.sortList,{},!a.initWidgets)}else{r.setHeadersCss(a);if(a.initWidgets){r.applyWidget(s,!1)}}if(a.showProcessing){o.unbind("sortBegin"+a.namespace+" sortEnd"+a.namespace).bind("sortBegin"+a.namespace+" sortEnd"+a.namespace,function(t){clearTimeout(a.timerProcessing);r.isProcessing(s);if("sortBegin"===t.type){a.timerProcessing=setTimeout(function(){r.isProcessing(s,!0)},500)}})}s.hasInitialized=!0;s.isProcessing=!1;if(r.debug(a,"core")){console.log("Overall initialization time:"+r.benchmark(t.data(s,"startoveralltimer")));if(r.debug(a,"core")&&console.groupEnd){console.groupEnd()}}o.triggerHandler("tablesorter-initialized",s);if("function"==typeof a.initialized){a.initialized(s)}},bindMethods:function bindMethods(s){var e=s.$table,a=s.namespace,o="sortReset update updateRows updateAll updateHeaders addRows updateCell updateComplete sorton appendCache updateCache applyWidgetId applyWidgets refreshWidgets destroy mouseup mouseleave ".split(" ").join(a+" ");e.unbind(o.replace(r.regex.spaces," ")).bind("sortReset"+a,function(t,e){t.stopPropagation();r.sortReset(this.config,function(t){if(t.isApplyingWidgets){setTimeout(function(){r.applyWidget(t,"",e)},100)}else{r.applyWidget(t,"",e)}})}).bind("updateAll"+a,function(t,e,s){t.stopPropagation();r.updateAll(this.config,e,s)}).bind("update"+a+" updateRows"+a,function(t,e,s){t.stopPropagation();r.update(this.config,e,s)}).bind("updateHeaders"+a,function(t,e){t.stopPropagation();r.updateHeaders(this.config,e)}).bind("updateCell"+a,function(t,e,s,a){t.stopPropagation();r.updateCell(this.config,e,s,a)}).bind("addRows"+a,function(t,e,s,a){t.stopPropagation();r.addRows(this.config,e,s,a)}).bind("updateComplete"+a,function(){this.isUpdating=!1}).bind("sorton"+a,function(t,e,s,a){t.stopPropagation();r.sortOn(this.config,e,s,a)}).bind("appendCache"+a,function(s,e,a){s.stopPropagation();r.appendCache(this.config,a);if(t.isFunction(e)){e(this)}}).bind("updateCache"+a,function(t,e,s){t.stopPropagation();r.updateCache(this.config,e,s)}).bind("applyWidgetId"+a,function(t,e){t.stopPropagation();r.applyWidgetId(this,e)}).bind("applyWidgets"+a,function(t,e){t.stopPropagation();r.applyWidget(this,!1,e)}).bind("refreshWidgets"+a,function(t,e,s){t.stopPropagation();r.refreshWidgets(this,e,s)}).bind("removeWidget"+a,function(t,e,s){t.stopPropagation();r.removeWidget(this,e,s)}).bind("destroy"+a,function(t,e,s){t.stopPropagation();r.destroy(this,e,s)}).bind("resetToLoadState"+a,function(a){a.stopPropagation();r.removeWidget(this,!0,!1);var e=t.extend(!0,{},s.originalSettings);s=t.extend(!0,{},r.defaults,e);s.originalSettings=e;this.hasInitialized=!1;r.setup(this,s)})},bindEvents:function bindEvents(e,s,a){e=t(e)[0];var o,n=e.config,d=n.namespace,i=null;if(!0!==a){s.addClass(d.slice(1)+"_extra_headers");o=r.getClosest(s,"table");if(o.length&&"TABLE"===o[0].nodeName&&o[0]!==e){t(o[0]).addClass(d.slice(1)+"_extra_table")}}o=(n.pointerDown+" "+n.pointerUp+" "+n.pointerClick+" sort keyup ").replace(r.regex.spaces," ").split(" ").join(d+" ");s.find(n.selectorSort).add(s.filter(n.selectorSort)).unbind(o).bind(o,function(s,e){var a,o,d,l=t(s.target),c=" "+s.type+" ";if(1!==(s.which||s.button)&&!c.match(" "+n.pointerClick+" | sort | keyup ")||" keyup "==c&&s.which!==r.keyCodes.enter||c.match(" "+n.pointerClick+" ")&&"undefined"!=typeof s.which){return}if(c.match(" "+n.pointerUp+" ")&&i!==s.target&&!0!==e){return}if(c.match(" "+n.pointerDown+" ")){i=s.target;d=l.jquery.split(".");if("1"===d[0]&&4>d[1]){s.preventDefault()}return}i=null;a=r.getClosest(t(this),"."+r.css.header);if(r.regex.formElements.test(s.target.nodeName)||l.hasClass(n.cssNoSort)||0<l.parents("."+n.cssNoSort).length||a.hasClass("sorter-false")||0<l.parents("button").length){return!n.cancelSelection}if(n.delayInit&&r.isEmptyObject(n.cache)){r.buildCache(n)}n.last.clickedIndex=a.attr("data-column")||a.index();o=n.$headerIndexed[n.last.clickedIndex][0];if(o&&!o.sortDisabled){r.initSort(n,o,s)}});if(n.cancelSelection){s.attr("unselectable","on").bind("selectstart",!1).css({"user-select":"none",MozUserSelect:"none"})}},buildHeaders:function buildHeaders(e){var s,a,o,n;e.headerList=[];e.headerContent=[];e.sortVars=[];if(r.debug(e,"core")){o=new Date}e.columns=r.computeColumnIndex(e.$table.children("thead, tfoot").children("tr"));a=e.cssIcon?"<i class=\""+(e.cssIcon===r.css.icon?r.css.icon:e.cssIcon+" "+r.css.icon)+"\"></i>":"";e.$headers=t(t.map(e.$table.find(e.selectorHeaders),function(s,o){var n,d,i,l,c,g=t(s);if(r.getClosest(g,"tr").hasClass(e.cssIgnoreRow)){return}if(!/(th|td)/i.test(s.nodeName)){c=r.getClosest(g,"th, td");g.attr("data-column",c.attr("data-column"))}n=r.getColumnData(e.table,e.headers,o,!0);e.headerContent[o]=g.html();if(""!==e.headerTemplate&&!g.find("."+r.css.headerIn).length){l=e.headerTemplate.replace(r.regex.templateContent,g.html()).replace(r.regex.templateIcon,g.find("."+r.css.icon).length?"":a);if(e.onRenderTemplate){d=e.onRenderTemplate.apply(g,[o,l]);if(d&&"string"==typeof d){l=d}}g.html("<div class=\""+r.css.headerIn+"\">"+l+"</div>")}if(e.onRenderHeader){e.onRenderHeader.apply(g,[o,e,e.$table])}i=parseInt(g.attr("data-column"),10);s.column=i;c=r.getOrder(r.getData(g,n,"sortInitialOrder")||e.sortInitialOrder);e.sortVars[i]={count:-1,order:c?e.sortReset?[1,0,2]:[1,0]:e.sortReset?[0,1,2]:[0,1],lockedOrder:!1,sortedBy:""};c=r.getData(g,n,"lockedOrder")||!1;if("undefined"!=typeof c&&!1!==c){e.sortVars[i].lockedOrder=!0;e.sortVars[i].order=r.getOrder(c)?[1,1]:[0,0]}e.headerList[o]=s;g.addClass(r.css.header+" "+e.cssHeader);r.getClosest(g,"tr").addClass(r.css.headerRow+" "+e.cssHeaderRow).attr("role","row");if(e.tabIndex){g.attr("tabindex",0)}return s}));e.$headerIndexed=[];for(n=0;n<e.columns;n++){if(r.isEmptyObject(e.sortVars[n])){e.sortVars[n]={}}s=e.$headers.filter("[data-column=\""+n+"\"]");e.$headerIndexed[n]=s.length?s.not(".sorter-false").length?s.not(".sorter-false").filter(":last"):s.filter(":last"):t()}e.$table.find(e.selectorHeaders).attr({scope:"col",role:"columnheader"});r.updateHeader(e);if(r.debug(e,"core")){console.log("Built headers:"+r.benchmark(o));console.log(e.$headers)}},addInstanceMethods:function addInstanceMethods(e){t.extend(r.instanceMethods,e)},setupParsers:function setupParsers(e,t){var s,a,o,n,d,i,l,c,g,p,u,m,h,b,x=e.table,f=0,y=r.debug(e,"core"),w={};e.$tbodies=e.$table.children("tbody:not(."+e.cssInfoBlock+")");h="undefined"==typeof t?e.$tbodies:t;b=h.length;if(0===b){return y?console.warn("Warning: *Empty table!* Not building a parser cache"):""}else if(y){m=new Date;console[console.group?"group":"log"]("Detecting parsers for each column")}a={extractors:[],parsers:[]};while(f<b){s=h[f].rows;if(s.length){d=0;n=e.columns;for(i=0;i<n;i++){l=e.$headerIndexed[d];if(l&&l.length){c=r.getColumnData(x,e.headers,d);u=r.getParserById(r.getData(l,c,"extractor"));p=r.getParserById(r.getData(l,c,"sorter"));g="false"===r.getData(l,c,"parser");e.empties[d]=(r.getData(l,c,"empty")||e.emptyTo||(e.emptyToBottom?"bottom":"top")).toLowerCase();e.strings[d]=(r.getData(l,c,"string")||e.stringTo||"max").toLowerCase();if(g){p=r.getParserById("no-parser")}if(!u){u=!1}if(!p){p=r.detectParserForColumn(e,s,-1,d)}if(y){w["("+d+") "+l.text()]={parser:p.id,extractor:u?u.id:"none",string:e.strings[d],empty:e.empties[d]}}a.parsers[d]=p;a.extractors[d]=u;o=l[0].colSpan-1;if(0<o){d+=o;n+=o;while(0<o+1){a.parsers[d-o]=p;a.extractors[d-o]=u;o--}}}d++}}f+=a.parsers.length?b:1}if(y){if(!r.isEmptyObject(w)){console[console.table?"table":"log"](w)}else{console.warn("  No parsers detected!")}console.log("Completed detecting parsers"+r.benchmark(m));if(console.groupEnd){console.groupEnd()}}e.parsers=a.parsers;e.extractors=a.extractors},addParser:function addParser(e){var t,s=r.parsers.length,a=!0;for(t=0;t<s;t++){if(r.parsers[t].id.toLowerCase()===e.id.toLowerCase()){a=!1}}if(a){r.parsers[r.parsers.length]=e}},getParserById:function getParserById(e){if("false"==e){return!1}var t,s=r.parsers.length;for(t=0;t<s;t++){if(r.parsers[t].id.toLowerCase()===e.toString().toLowerCase()){return r.parsers[t]}}return!1},detectParserForColumn:function detectParserForColumn(e,s,a,o){var n,d,i,l=r.parsers.length,c=!1,g="",p=r.debug(e,"core"),u=!0;while(""===g&&u){a++;i=s[a];if(i&&50>a){if(0>i.className.indexOf(r.cssIgnoreRow)){c=s[a].cells[o];g=r.getElementText(e,c,o);d=t(c);if(p){console.log("Checking if value was empty on row "+a+", column: "+o+": \""+g+"\"")}}}else{u=!1}}while(0<=--l){n=r.parsers[l];if(n&&"text"!==n.id&&n.is&&n.is(g,e.table,c,d)){return n}}return r.getParserById("text")},getElementText:function getElementText(e,s,a){if(!s){return""}var o,n=e.textExtraction||"",d=s.jquery?s:t(s);if("string"==typeof n){if("basic"===n&&"undefined"!=typeof(o=d.attr(e.textAttribute))){return t.trim(o)}return t.trim(s.textContent||d.text())}else{if("function"==typeof n){return t.trim(n(d[0],e.table,a))}else if("function"==typeof(o=r.getColumnData(e.table,n,a))){return t.trim(o(d[0],e.table,a))}}return t.trim(d[0].textContent||d.text())},getParsedText:function getParsedText(e,t,s,a){if("undefined"==typeof a){a=r.getElementText(e,t,s)}var o=""+a,n=e.parsers[s],d=e.extractors[s];if(n){if(d&&"function"==typeof d.format){a=d.format(a,e.table,t,s)}o="no-parser"===n.id?"":n.format(""+a,e.table,t,s);if(e.ignoreCase&&"string"==typeof o){o=o.toLowerCase()}}return o},buildCache:function buildCache(e,s,a){var o,n,d,i,l,c,g,p,u,m,h,b,x,f,y,w,C,I,$,R,v,T,L=e.table,A=e.parsers,D=r.debug(e,"core");e.$tbodies=e.$table.children("tbody:not(."+e.cssInfoBlock+")");g="undefined"==typeof a?e.$tbodies:a,e.cache={};e.totalRows=0;if(!A){return D?console.warn("Warning: *Empty table!* Not building a cache"):""}if(D){b=new Date}if(e.showProcessing){r.isProcessing(L,!0)}for(c=0;c<g.length;c++){w=[];o=e.cache[c]={normalized:[]};x=g[c]&&g[c].rows.length||0;for(i=0;i<x;++i){f={child:[],raw:[]};p=t(g[c].rows[i]);u=[];if(p.hasClass(e.selectorRemove.slice(1))){continue}if(p.hasClass(e.cssChildRow)&&0!==i){v=o.normalized.length-1;y=o.normalized[v][e.columns];y.$row=y.$row.add(p);if(!p.prev().hasClass(e.cssChildRow)){p.prev().addClass(r.css.cssHasChild)}m=p.children("th, td");v=y.child.length;y.child[v]=[];I=0;R=e.columns;for(l=0;l<R;l++){h=m[l];if(h){y.child[v][l]=r.getParsedText(e,h,l);C=m[l].colSpan-1;if(0<C){I+=C;R+=C}}I++}continue}f.$row=p;f.order=i;I=0;R=e.columns;for(l=0;l<R;++l){h=p[0].cells[l];if(h&&I<e.columns){$="undefined"!=typeof A[I];if(!$&&D){console.warn("No parser found for row: "+i+", column: "+l+"; cell containing: \""+t(h).text()+"\"; does it have a header?")}n=r.getElementText(e,h,I);f.raw[I]=n;d=r.getParsedText(e,h,I,n);u[I]=d;if($&&"numeric"===(A[I].type||"").toLowerCase()){w[I]=Math.max(Math.abs(d)||0,w[I]||0)}C=h.colSpan-1;if(0<C){T=0;while(T<=C){d=e.duplicateSpan||0===T?n:"string"!=typeof e.textExtraction?r.getElementText(e,h,I+T)||"":"";f.raw[I+T]=d;u[I+T]=d;T++}I+=C;R+=C}}I++}u[e.columns]=f;o.normalized[o.normalized.length]=u}o.colMax=w;e.totalRows+=o.normalized.length}if(e.showProcessing){r.isProcessing(L)}if(D){v=Math.min(5,e.cache[0].normalized.length);console[console.group?"group":"log"]("Building cache for "+e.totalRows+" rows (showing "+v+" rows in log) and "+e.columns+" columns"+r.benchmark(b));n={};for(l=0;l<e.columns;l++){for(I=0;I<v;I++){if(!n["row: "+I]){n["row: "+I]={}}n["row: "+I][e.$headerIndexed[l].text()]=e.cache[0].normalized[I][l]}}console[console.table?"table":"log"](n);if(console.groupEnd){console.groupEnd()}}if(t.isFunction(s)){s(L)}},getColumnText:function getColumnText(e,s,a,o){e=t(e)[0];var n,d,i,l,g,p,u,m,h,b,x="all"===s,f={raw:[],parsed:[],$cell:[]},y=e.config;if(r.isEmptyObject(y)){if(r.debug(y,"core")){console.warn("No cache found - aborting getColumnText function!")}}else{g=y.$tbodies.length;for(n=0;n<g;n++){i=y.cache[n].normalized;p=i.length;for(d=0;d<p;d++){l=i[d];if(o&&!l[y.columns].$row.is(o)){continue}b=!0;m=x?l.slice(0,y.columns):l[s];l=l[y.columns];u=x?l.raw:l.raw[s];h=x?l.$row.children():l.$row.children().eq(s);if("function"==typeof a){b=a({tbodyIndex:n,rowIndex:d,parsed:m,raw:u,$row:l.$row,$cell:h})}if(!1!==b){f.parsed[f.parsed.length]=m;f.raw[f.raw.length]=u;f.$cell[f.$cell.length]=h}}}return f}},setHeadersCss:function setHeadersCss(e){var s,a,o=e.sortList,n=o.length,d=r.css.sortNone+" "+e.cssNone,i=[r.css.sortAsc+" "+e.cssAsc,r.css.sortDesc+" "+e.cssDesc],l=[e.cssIconAsc,e.cssIconDesc,e.cssIconNone],c=["ascending","descending"],g=function(e,t){e.removeClass(d).addClass(i[t]).attr("aria-sort",c[t]).find("."+r.css.icon).removeClass(l[2]).addClass(l[t])},p=e.$table.find("tfoot tr").children("td, th").add(t(e.namespace+"_extra_headers")).removeClass(i.join(" ")),u=e.$headers.add(t("thead "+e.namespace+"_extra_headers")).removeClass(i.join(" ")).addClass(d).attr("aria-sort","none").find("."+r.css.icon).removeClass(l.join(" ")).end();u.not(".sorter-false").find("."+r.css.icon).addClass(l[2]);if(e.cssIconDisabled){u.filter(".sorter-false").find("."+r.css.icon).addClass(e.cssIconDisabled)}for(s=0;s<n;s++){if(2!==o[s][1]){u=e.$headers.filter(function(t){var s=!0,a=e.$headers.eq(t),o=parseInt(a.attr("data-column"),10),n=o+r.getClosest(a,"th, td")[0].colSpan;for(;o<n;o++){s=s?s||-1<r.isValueInArray(o,e.sortList):!1}return s});u=u.not(".sorter-false").filter("[data-column=\""+o[s][0]+"\"]"+(1===n?":last":""));if(u.length){for(a=0;a<u.length;a++){if(!u[a].sortDisabled){g(u.eq(a),o[s][1])}}}if(p.length){g(p.filter("[data-column=\""+o[s][0]+"\"]"),o[s][1])}}}n=e.$headers.length;for(s=0;s<n;s++){r.setColumnAriaLabel(e,e.$headers.eq(s))}},getClosest:function getClosest(e,r){if(t.fn.closest){return e.closest(r)}return e.is(r)?e:e.parents(r).filter(":first")},setColumnAriaLabel:function setColumnAriaLabel(e,s,a){if(s.length){var o=parseInt(s.attr("data-column"),10),n=e.sortVars[o],d=s.hasClass(r.css.sortAsc)?"sortAsc":s.hasClass(r.css.sortDesc)?"sortDesc":"sortNone",i=t.trim(s.text())+": "+r.language[d];if(s.hasClass("sorter-false")||!1===a){i+=r.language.sortDisabled}else{d=(n.count+1)%n.order.length;a=n.order[d];i+=r.language[0===a?"nextAsc":1===a?"nextDesc":"nextNone"]}s.attr("aria-label",i);if(n.sortedBy){s.attr("data-sortedBy",n.sortedBy)}else{s.removeAttr("data-sortedBy")}}},updateHeader:function updateHeader(e){var t,s,a,o,n=e.table,d=e.$headers.length;for(t=0;t<d;t++){a=e.$headers.eq(t);o=r.getColumnData(n,e.headers,t,!0);s="false"===r.getData(a,o,"sorter")||"false"===r.getData(a,o,"parser");r.setColumnSort(e,a,s)}},setColumnSort:function setColumnSort(e,t,r){var s=e.table.id;t[0].sortDisabled=r;t[r?"addClass":"removeClass"]("sorter-false").attr("aria-disabled",""+r);if(e.tabIndex){if(r){t.removeAttr("tabindex")}else{t.attr("tabindex","0")}}if(s){if(r){t.removeAttr("aria-controls")}else{t.attr("aria-controls",s)}}},updateHeaderSortCount:function updateHeaderSortCount(e,s){var a,o,n,d,i,l,c,g,p=s||e.sortList,u=p.length;e.sortList=[];for(d=0;d<u;d++){c=p[d];a=parseInt(c[0],10);if(a<e.columns){if(!e.sortVars[a].order){if(r.getOrder(e.sortInitialOrder)){g=e.sortReset?[1,0,2]:[1,0]}else{g=e.sortReset?[0,1,2]:[0,1]}e.sortVars[a].order=g;e.sortVars[a].count=0}g=e.sortVars[a].order;o=(""+c[1]).match(/^(1|d|s|o|n)/);o=o?o[0]:"";switch(o){case"1":case"d":o=1;break;case"s":o=i||0;break;case"o":l=g[(i||0)%g.length];o=0===l?1:1===l?0:2;break;case"n":o=g[++e.sortVars[a].count%g.length];break;default:o=0;break;}i=0===d?o:i;n=[a,parseInt(o,10)||0];e.sortList[e.sortList.length]=n;o=t.inArray(n[1],g);e.sortVars[a].count=0<=o?o:n[1]%g.length}}},updateAll:function updateAll(e,t,s){var a=e.table;a.isUpdating=!0;r.refreshWidgets(a,!0,!0);r.buildHeaders(e);r.bindEvents(a,e.$headers,!0);r.bindMethods(e);r.commonUpdate(e,t,s)},update:function update(e,t,s){var a=e.table;a.isUpdating=!0;r.updateHeader(e);r.commonUpdate(e,t,s)},updateHeaders:function updateHeaders(e,t){e.table.isUpdating=!0;r.buildHeaders(e);r.bindEvents(e.table,e.$headers,!0);r.resortComplete(e,t)},updateCell:function updateCell(e,s,a,o){if(t(s).closest("tr").hasClass(e.cssChildRow)){console.warn("Tablesorter Warning! \"updateCell\" for child row content has been disabled, use \"update\" instead");return}if(r.isEmptyObject(e.cache)){r.updateHeader(e);r.commonUpdate(e,a,o);return}e.table.isUpdating=!0;e.$table.find(e.selectorRemove).remove();var n,d,i,l,c,g,p=e.$tbodies,u=t(s),m=p.index(r.getClosest(u,"tbody")),h=e.cache[m],b=r.getClosest(u,"tr");s=u[0];if(p.length&&0<=m){i=p.eq(m).find("tr").not("."+e.cssChildRow).index(b);c=h.normalized[i];g=b[0].cells.length;if(g!==e.columns){l=0;n=!1;for(d=0;d<g;d++){if(!n&&b[0].cells[d]!==s){l+=b[0].cells[d].colSpan}else{n=!0}}}else{l=u.index()}n=r.getElementText(e,s,l);c[e.columns].raw[l]=n;n=r.getParsedText(e,s,l,n);c[l]=n;if("numeric"===(e.parsers[l].type||"").toLowerCase()){h.colMax[l]=Math.max(Math.abs(n)||0,h.colMax[l]||0)}n="undefined"!==a?a:e.resort;if(!1!==n){r.checkResort(e,n,o)}else{r.resortComplete(e,o)}}else{if(r.debug(e,"core")){console.error("updateCell aborted, tbody missing or not within the indicated table")}e.table.isUpdating=!1}},addRows:function addRows(e,s,a,o){var n,d,i,l,c,g,p,u,m,h,b,x,f,y="string"==typeof s&&1===e.$tbodies.length&&/<tr/.test(s||""),w=e.table;if(y){s=t(s);e.$tbodies.append(s)}else if(!s||!(s instanceof t)||r.getClosest(s,"table")[0]!==e.table){if(r.debug(e,"core")){console.error("addRows method requires (1) a jQuery selector reference to rows that have already been added to the table, or (2) row HTML string to be added to a table with only one tbody")}return!1}w.isUpdating=!0;if(r.isEmptyObject(e.cache)){r.updateHeader(e);r.commonUpdate(e,a,o)}else{c=s.filter("tr").attr("role","row").length;i=e.$tbodies.index(s.parents("tbody").filter(":first"));if(!(e.parsers&&e.parsers.length)){r.setupParsers(e)}for(l=0;l<c;l++){m=0;p=s[l].cells.length;u=e.cache[i].normalized.length;b=[];h={child:[],raw:[],$row:s.eq(l),order:u};for(g=0;g<p;g++){x=s[l].cells[g];n=r.getElementText(e,x,m);h.raw[m]=n;d=r.getParsedText(e,x,m,n);b[m]=d;if("numeric"===(e.parsers[m].type||"").toLowerCase()){e.cache[i].colMax[m]=Math.max(Math.abs(d)||0,e.cache[i].colMax[m]||0)}f=x.colSpan-1;if(0<f){m+=f}m++}b[e.columns]=h;e.cache[i].normalized[u]=b}r.checkResort(e,a,o)}},updateCache:function updateCache(e,t,s){if(!(e.parsers&&e.parsers.length)){r.setupParsers(e,s)}r.buildCache(e,t,s)},appendCache:function appendCache(e,t){var s,a,o,n,d,i,l,c=e.table,g=e.$tbodies,p=[],u=e.cache;if(r.isEmptyObject(u)){return e.appender?e.appender(c,p):c.isUpdating?e.$table.triggerHandler("updateComplete",c):""}if(r.debug(e,"core")){l=new Date}for(i=0;i<g.length;i++){o=g.eq(i);if(o.length){n=r.processTbody(c,o,!0);s=u[i].normalized;a=s.length;for(d=0;d<a;d++){p[p.length]=s[d][e.columns].$row;if(!e.appender||e.pager&&!e.pager.removeRows&&!e.pager.ajax){n.append(s[d][e.columns].$row)}}r.processTbody(c,n,!1)}}if(e.appender){e.appender(c,p)}if(r.debug(e,"core")){console.log("Rebuilt table"+r.benchmark(l))}if(!t&&!e.appender){r.applyWidget(c)}if(c.isUpdating){e.$table.triggerHandler("updateComplete",c)}},commonUpdate:function commonUpdate(e,t,s){e.$table.find(e.selectorRemove).remove();r.setupParsers(e);r.buildCache(e);r.checkResort(e,t,s)},initSort:function initSort(e,s,a){if(e.table.isUpdating){return setTimeout(function(){r.initSort(e,s,a)},50)}var o,n,d,i,l,c,g,p=!a[e.sortMultiSortKey],u=e.table,m=e.$headers.length,h=r.getClosest(t(s),"th, td"),b=parseInt(h.attr("data-column"),10),x="mouseup"===a.type?"user":a.type,f=e.sortVars[b].order;h=h[0];e.$table.triggerHandler("sortStart",u);c=(e.sortVars[b].count+1)%f.length;e.sortVars[b].count=a[e.sortResetKey]?2:c;if(e.sortRestart){for(d=0;d<m;d++){g=e.$headers.eq(d);c=parseInt(g.attr("data-column"),10);if(b!==c&&(p||g.hasClass(r.css.sortNone))){e.sortVars[c].count=-1}}}if(p){t.each(e.sortVars,function(t){e.sortVars[t].sortedBy=""});e.sortList=[];e.last.sortList=[];if(null!==e.sortForce){o=e.sortForce;for(n=0;n<o.length;n++){if(o[n][0]!==b){e.sortList[e.sortList.length]=o[n];e.sortVars[o[n][0]].sortedBy="sortForce"}}}i=f[e.sortVars[b].count];if(2>i){e.sortList[e.sortList.length]=[b,i];e.sortVars[b].sortedBy=x;if(1<h.colSpan){for(n=1;n<h.colSpan;n++){e.sortList[e.sortList.length]=[b+n,i];e.sortVars[b+n].count=t.inArray(i,f);e.sortVars[b+n].sortedBy=x}}}}else{e.sortList=t.extend([],e.last.sortList);if(0<=r.isValueInArray(b,e.sortList)){e.sortVars[b].sortedBy=x;for(n=0;n<e.sortList.length;n++){c=e.sortList[n];if(c[0]===b){c[1]=f[e.sortVars[b].count];if(2===c[1]){e.sortList.splice(n,1);e.sortVars[b].count=-1}}}}else{i=f[e.sortVars[b].count];e.sortVars[b].sortedBy=x;if(2>i){e.sortList[e.sortList.length]=[b,i];if(1<h.colSpan){for(n=1;n<h.colSpan;n++){e.sortList[e.sortList.length]=[b+n,i];e.sortVars[b+n].count=t.inArray(i,f);e.sortVars[b+n].sortedBy=x}}}}}e.last.sortList=t.extend([],e.sortList);if(e.sortList.length&&e.sortAppend){o=t.isArray(e.sortAppend)?e.sortAppend:e.sortAppend[e.sortList[0][0]];if(!r.isEmptyObject(o)){for(n=0;n<o.length;n++){if(o[n][0]!==b&&0>r.isValueInArray(o[n][0],e.sortList)){i=o[n][1];l=(""+i).match(/^(a|d|s|o|n)/);if(l){c=e.sortList[0][1];switch(l[0]){case"d":i=1;break;case"s":i=c;break;case"o":i=0===c?1:0;break;case"n":i=(c+1)%f.length;break;default:i=0;break;}}e.sortList[e.sortList.length]=[o[n][0],i];e.sortVars[o[n][0]].sortedBy="sortAppend"}}}}e.$table.triggerHandler("sortBegin",u);setTimeout(function(){r.setHeadersCss(e);r.multisort(e);r.appendCache(e);e.$table.triggerHandler("sortBeforeEnd",u);e.$table.triggerHandler("sortEnd",u)},1)},multisort:function multisort(e){var t,s,o,n,d,i=e.table,l=[],c=0,g=e.textSorter||"",p=e.sortList,u=p.length,m=e.$tbodies.length;if(e.serverSideSorting||r.isEmptyObject(e.cache)){return}if(r.debug(e,"core")){s=new Date}if("object"===_typeof(g)){o=e.columns;while(o--){d=r.getColumnData(i,g,o);if("function"==typeof d){l[o]=d}}}for(t=0;t<m;t++){o=e.cache[t].colMax;n=e.cache[t].normalized;n.sort(function(t,s){var a,n,d,m,h,b,f;for(a=0;a<u;a++){d=p[a][0];m=p[a][1];c=0===m;if(e.sortStable&&t[d]===s[d]&&1===u){return t[e.columns].order-s[e.columns].order}n=/n/i.test(r.getSortType(e.parsers,d));if(n&&e.strings[d]){if("boolean"==typeof r.string[e.strings[d]]){n=(c?1:-1)*(r.string[e.strings[d]]?-1:1)}else{n=e.strings[d]?r.string[e.strings[d]]||0:0}h=e.numberSorter?e.numberSorter(t[d],s[d],c,o[d],i):r["sortNumeric"+(c?"Asc":"Desc")](t[d],s[d],n,o[d],d,e)}else{b=c?t:s;f=c?s:t;if("function"==typeof g){h=g(b[d],f[d],c,d,i)}else if("function"==typeof l[d]){h=l[d](b[d],f[d],c,d,i)}else{h=r["sortNatural"+(c?"Asc":"Desc")](t[d]||"",s[d]||"",d,e)}}if(h){return h}}return t[e.columns].order-s[e.columns].order})}if(r.debug(e,"core")){console.log("Applying sort "+p.toString()+r.benchmark(s))}},resortComplete:function resortComplete(e,r){if(e.table.isUpdating){e.$table.triggerHandler("updateComplete",e.table)}if(t.isFunction(r)){r(e.table)}},checkResort:function checkResort(e,s,a){var o=t.isArray(s)?s:e.sortList,n="undefined"==typeof s?e.resort:s;if(!1!==n&&!e.serverSideSorting&&!e.table.isProcessing){if(o.length){r.sortOn(e,o,function(){r.resortComplete(e,a)},!0)}else{r.sortReset(e,function(){r.resortComplete(e,a);r.applyWidget(e.table,!1)})}}else{r.resortComplete(e,a);r.applyWidget(e.table,!1)}},sortOn:function sortOn(e,s,a,o){var n,d=e.table;e.$table.triggerHandler("sortStart",d);for(n=0;n<e.columns;n++){e.sortVars[n].sortedBy=-1<r.isValueInArray(n,s)?"sorton":""}r.updateHeaderSortCount(e,s);r.setHeadersCss(e);if(e.delayInit&&r.isEmptyObject(e.cache)){r.buildCache(e)}e.$table.triggerHandler("sortBegin",d);r.multisort(e);r.appendCache(e,o);e.$table.triggerHandler("sortBeforeEnd",d);e.$table.triggerHandler("sortEnd",d);r.applyWidget(d);if(t.isFunction(a)){a(d)}},sortReset:function sortReset(e,s){e.sortList=[];var a;for(a=0;a<e.columns;a++){e.sortVars[a].count=-1;e.sortVars[a].sortedBy=""}r.setHeadersCss(e);r.multisort(e);r.appendCache(e);if(t.isFunction(s)){s(e.table)}},getSortType:function getSortType(e,t){return e&&e[t]?e[t].type||"":""},getOrder:function getOrder(e){return /^d/i.test(e)||1===e},sortNatural:function sortNatural(e,t){if(e===t){return 0}e=(e||"").toString();t=(t||"").toString();var s,o,n,d,i,l,c=r.regex;if(c.hex.test(t)){s=parseInt(e.match(c.hex),16);o=parseInt(t.match(c.hex),16);if(s<o){return-1}if(s>o){return 1}}s=e.replace(c.chunk,"\\0$1\\0").replace(c.chunks,"").split("\\0");o=t.replace(c.chunk,"\\0$1\\0").replace(c.chunks,"").split("\\0");l=Math.max(s.length,o.length);for(i=0;i<l;i++){n=isNaN(s[i])?s[i]||0:parseFloat(s[i])||0;d=isNaN(o[i])?o[i]||0:parseFloat(o[i])||0;if(isNaN(n)!==isNaN(d)){return isNaN(n)?1:-1}if(_typeof(n)!==_typeof(d)){n+="";d+=""}if(n<d){return-1}if(n>d){return 1}}return 0},sortNaturalAsc:function sortNaturalAsc(e,t,s,a){if(e===t){return 0}var o=r.string[a.empties[s]||a.emptyTo];if(""===e&&0!==o){return"boolean"==typeof o?o?-1:1:-o||-1}if(""===t&&0!==o){return"boolean"==typeof o?o?1:-1:o||1}return r.sortNatural(e,t)},sortNaturalDesc:function sortNaturalDesc(e,t,s,a){if(e===t){return 0}var o=r.string[a.empties[s]||a.emptyTo];if(""===e&&0!==o){return"boolean"==typeof o?o?-1:1:o||1}if(""===t&&0!==o){return"boolean"==typeof o?o?1:-1:-o||-1}return r.sortNatural(t,e)},sortText:function sortText(e,t){return e>t?1:e<t?-1:0},getTextValue:function getTextValue(e,t,r){if(r){var s,a=e?e.length:0,o=r+t;for(s=0;s<a;s++){o+=e.charCodeAt(s)}return t*o}return 0},sortNumericAsc:function sortNumericAsc(e,t,s,o,n,d){if(e===t){return 0}var i=r.string[d.empties[n]||d.emptyTo];if(""===e&&0!==i){return"boolean"==typeof i?i?-1:1:-i||-1}if(""===t&&0!==i){return"boolean"==typeof i?i?1:-1:i||1}if(isNaN(e)){e=r.getTextValue(e,s,o)}if(isNaN(t)){t=r.getTextValue(t,s,o)}return e-t},sortNumericDesc:function sortNumericDesc(e,t,s,o,n,d){if(e===t){return 0}var i=r.string[d.empties[n]||d.emptyTo];if(""===e&&0!==i){return"boolean"==typeof i?i?-1:1:i||1}if(""===t&&0!==i){return"boolean"==typeof i?i?1:-1:-i||-1}if(isNaN(e)){e=r.getTextValue(e,s,o)}if(isNaN(t)){t=r.getTextValue(t,s,o)}return t-e},sortNumeric:function sortNumeric(e,t){return e-t},addWidget:function addWidget(e){if(e.id&&!r.isEmptyObject(r.getWidgetById(e.id))){console.warn("\""+e.id+"\" widget was loaded more than once!")}r.widgets[r.widgets.length]=e},hasWidget:function hasWidget(e,r){e=t(e);return e.length&&e[0].config&&e[0].config.widgetInit[r]||!1},getWidgetById:function getWidgetById(e){var t,s,a=r.widgets.length;for(t=0;t<a;t++){s=r.widgets[t];if(s&&s.id&&s.id.toLowerCase()===e.toLowerCase()){return s}}},applyWidgetOptions:function applyWidgetOptions(e){var s,a,o,n=e.config,d=n.widgets.length;if(d){for(s=0;s<d;s++){a=r.getWidgetById(n.widgets[s]);if(a&&a.options){o=t.extend(!0,{},a.options);n.widgetOptions=t.extend(!0,o,n.widgetOptions);t.extend(!0,r.defaults.widgetOptions,a.options)}}}},addWidgetFromClass:function addWidgetFromClass(e){var t,s,a=e.config,o="^"+a.widgetClass.replace(r.regex.templateName,"(\\S+)+")+"$",n=new RegExp(o,"g"),d=(e.className||"").split(r.regex.spaces);if(d.length){t=d.length;for(s=0;s<t;s++){if(d[s].match(n)){a.widgets[a.widgets.length]=d[s].replace(n,"$1")}}}},applyWidgetId:function applyWidgetId(e,s,a){e=t(e)[0];var o,n,d,i=e.config,l=i.widgetOptions,c=r.debug(i,"core"),g=r.getWidgetById(s);if(g){d=g.id;o=!1;if(0>t.inArray(d,i.widgets)){i.widgets[i.widgets.length]=d}if(c){n=new Date}if(a||!i.widgetInit[d]){i.widgetInit[d]=!0;if(e.hasInitialized){r.applyWidgetOptions(e)}if("function"==typeof g.init){o=!0;if(c){console[console.group?"group":"log"]("Initializing "+d+" widget")}g.init(e,g,i,l)}}if(!a&&"function"==typeof g.format){o=!0;if(c){console[console.group?"group":"log"]("Updating "+d+" widget")}g.format(e,i,l,!1)}if(c){if(o){console.log("Completed "+(a?"initializing ":"applying ")+d+" widget"+r.benchmark(n));if(console.groupEnd){console.groupEnd()}}}}},applyWidget:function applyWidget(e,s,a){e=t(e)[0];var o,n,d,i,l,g=e.config,c=r.debug(g,"core"),p=[];if(!1!==s&&e.hasInitialized&&(e.isApplyingWidgets||e.isUpdating)){return}if(c){l=new Date}r.addWidgetFromClass(e);clearTimeout(g.timerReady);if(g.widgets.length){e.isApplyingWidgets=!0;g.widgets=t.grep(g.widgets,function(e,r){return t.inArray(e,g.widgets)===r});d=g.widgets||[];n=d.length;for(o=0;o<n;o++){i=r.getWidgetById(d[o]);if(i&&i.id){if(!i.priority){i.priority=10}p[o]=i}else if(c){console.warn("\""+d[o]+"\" was enabled, but the widget code has not been loaded!")}}p.sort(function(e,t){return e.priority<t.priority?-1:e.priority===t.priority?0:1});n=p.length;if(c){console[console.group?"group":"log"]("Start "+(s?"initializing":"applying")+" widgets")}for(o=0;o<n;o++){i=p[o];if(i&&i.id){r.applyWidgetId(e,i.id,s)}}if(c&&console.groupEnd){console.groupEnd()}}g.timerReady=setTimeout(function(){e.isApplyingWidgets=!1;t.data(e,"lastWidgetApplication",new Date);g.$table.triggerHandler("tablesorter-ready");if(!s&&"function"==typeof a){a(e)}if(c){i=g.widgets.length;console.log("Completed "+(!0===s?"initializing ":"applying ")+i+" widget"+(1!==i?"s":"")+r.benchmark(l))}},10)},removeWidget:function removeWidget(e,s,a){e=t(e)[0];var o,n,d,i,l=e.config;if(!0===s){s=[];i=r.widgets.length;for(d=0;d<i;d++){n=r.widgets[d];if(n&&n.id){s[s.length]=n.id}}}else{s=(t.isArray(s)?s.join(","):s||"").toLowerCase().split(/[\s,]+/)}i=s.length;for(o=0;o<i;o++){n=r.getWidgetById(s[o]);d=t.inArray(s[o],l.widgets);if(0<=d&&!0!==a){l.widgets.splice(d,1)}if(n&&n.remove){if(r.debug(l,"core")){console.log((a?"Refreshing":"Removing")+" \""+s[o]+"\" widget")}n.remove(e,l,l.widgetOptions,a);l.widgetInit[s[o]]=!1}}l.$table.triggerHandler("widgetRemoveEnd",e)},refreshWidgets:function refreshWidgets(e,s,a){e=t(e)[0];var o,n,d=e.config,i=d.widgets,l=r.widgets,c=l.length,g=[],p=function(e){t(e).triggerHandler("refreshComplete")};for(o=0;o<c;o++){n=l[o];if(n&&n.id&&(s||0>t.inArray(n.id,i))){g[g.length]=n.id}}r.removeWidget(e,g.join(","),!0);if(!0!==a){r.applyWidget(e,s||!1,p);if(s){r.applyWidget(e,!1,p)}}else{p(e)}},benchmark:function benchmark(e){return" ("+(new Date().getTime()-e.getTime())+" ms)"},log:function log(){console.log(arguments)},debug:function debug(e,t){return e&&(!0===e.debug||"string"==typeof e.debug&&-1<e.debug.indexOf(t))},isEmptyObject:function isEmptyObject(e){for(var t in e){return!1}return!0},isValueInArray:function isValueInArray(e,t){var r,s=t&&t.length||0;for(r=0;r<s;r++){if(t[r][0]===e){return r}}return-1},formatFloat:function formatFloat(e,s){if("string"!=typeof e||""===e){return e}var a,o=s&&s.config?!1!==s.config.usNumberFormat:"undefined"!=typeof s?s:!0;if(o){e=e.replace(r.regex.comma,"")}else{e=e.replace(r.regex.digitNonUS,"").replace(r.regex.comma,".")}if(r.regex.digitNegativeTest.test(e)){e=e.replace(r.regex.digitNegativeReplace,"-$1")}a=parseFloat(e);return isNaN(a)?t.trim(e):a},isDigit:function isDigit(e){return isNaN(e)?r.regex.digitTest.test(e.toString().replace(r.regex.digitReplace,"")):""!==e},computeColumnIndex:function computeColumnIndex(e,s){var a,o,n,d,c,g,p,u,m,h,b=s&&s.columns||0,x=[],f=Array(b);for(a=0;a<e.length;a++){g=e[a].cells;for(o=0;o<g.length;o++){c=g[o];p=a;u=c.rowSpan||1;m=c.colSpan||1;if("undefined"==typeof x[p]){x[p]=[]}for(n=0;n<x[p].length+1;n++){if("undefined"==typeof x[p][n]){h=n;break}}if(b&&c.cellIndex===h){}else if(c.setAttribute){c.setAttribute("data-column",h)}else{t(c).attr("data-column",h)}for(n=p;n<p+u;n++){if("undefined"==typeof x[n]){x[n]=[]}f=x[n];for(d=h;d<h+m;d++){f[d]="x"}}}}r.checkColumnCount(e,x,f.length);return f.length},checkColumnCount:function checkColumnCount(e,t,r){var s,a,o=!0,n=[];for(s=0;s<t.length;s++){if(t[s]){a=t[s].length;if(t[s].length!==r){o=!1;break}}}if(!o){e.each(function(e,t){var r=t.parentElement.nodeName;if(0>n.indexOf(r)){n.push(r)}});console.error("Invalid or incorrect number of columns in the "+n.join(" or ")+"; expected "+r+", but found "+a+" columns")}},fixColumnWidth:function fixColumnWidth(e){e=t(e)[0];var s,a,o,n,d,i=e.config,l=i.$table.children("colgroup");if(l.length&&l.hasClass(r.css.colgroup)){l.remove()}if(i.widthFixed&&0===i.$table.children("colgroup").length){l=t("<colgroup class=\""+r.css.colgroup+"\">");s=i.$table.width();o=i.$tbodies.find("tr:first").children(":visible");n=o.length;for(d=0;d<n;d++){a=parseInt(1e3*(o.eq(d).width()/s),10)/10+"%";l.append(t("<col>").css("width",a))}i.$table.prepend(l)}},getData:function getData(e,r,s){var a,o,n="",d=t(e);if(!d.length){return""}a=t.metadata?d.metadata():!1;o=" "+(d.attr("class")||"");if("undefined"!=typeof d.data(s)||"undefined"!=typeof d.data(s.toLowerCase())){n+=d.data(s)||d.data(s.toLowerCase())}else if(a&&"undefined"!=typeof a[s]){n+=a[s]}else if(r&&"undefined"!=typeof r[s]){n+=r[s]}else if(" "!==o&&o.match(" "+s+"-")){n=o.match(new RegExp("\\s"+s+"-([\\w-]+)"))[1]||""}return t.trim(n)},getColumnData:function getColumnData(e,r,s,a,o){if("object"!==_typeof(r)||null===r){return r}e=t(e)[0];var n,d,i=e.config,l=o||i.$headers,c=i.$headerIndexed&&i.$headerIndexed[s]||l.find("[data-column=\""+s+"\"]:last");if("undefined"!=typeof r[s]){return a?r[s]:r[l.index(c)]}for(d in r){if("string"==typeof d){n=c.filter(d).add(c.find(d));if(n.length){return r[d]}}}},isProcessing:function isProcessing(e,s,a){e=t(e);var o=e[0].config,n=a||e.find("."+r.css.header);if(s){if("undefined"!=typeof a&&0<o.sortList.length){n=n.filter(function(){return this.sortDisabled?!1:0<=r.isValueInArray(parseFloat(t(this).attr("data-column")),o.sortList)})}e.add(n).addClass(r.css.processing+" "+o.cssProcessing)}else{e.add(n).removeClass(r.css.processing+" "+o.cssProcessing)}},processTbody:function processTbody(e,r,s){e=t(e)[0];if(s){e.isProcessing=!0;r.before("<colgroup class=\"tablesorter-savemyplace\"/>");return t.fn.detach?r.detach():r.remove()}var a=t(e).find("colgroup.tablesorter-savemyplace");r.insertAfter(a);a.remove();e.isProcessing=!1},clearTableBody:function clearTableBody(e){t(e)[0].config.$tbodies.children().detach()},characterEquivalents:{a:"\xE1\xE0\xE2\xE3\xE4\u0105\xE5",A:"\xC1\xC0\xC2\xC3\xC4\u0104\xC5",c:"\xE7\u0107\u010D",C:"\xC7\u0106\u010C",e:"\xE9\xE8\xEA\xEB\u011B\u0119",E:"\xC9\xC8\xCA\xCB\u011A\u0118",i:"\xED\xEC\u0130\xEE\xEF\u0131",I:"\xCD\xCC\u0130\xCE\xCF",o:"\xF3\xF2\xF4\xF5\xF6\u014D",O:"\xD3\xD2\xD4\xD5\xD6\u014C",ss:"\xDF",SS:"\u1E9E",u:"\xFA\xF9\xFB\xFC\u016F",U:"\xDA\xD9\xDB\xDC\u016E"},replaceAccents:function replaceAccents(e){var t,s="[",a=r.characterEquivalents;if(!r.characterRegex){r.characterRegexArray={};for(t in a){if("string"==typeof t){s+=a[t];r.characterRegexArray[t]=new RegExp("["+a[t]+"]","g")}}r.characterRegex=new RegExp(s+"]")}if(r.characterRegex.test(e)){for(t in a){if("string"==typeof t){e=e.replace(r.characterRegexArray[t],t)}}}return e},validateOptions:function validateOptions(e){var s,a,o,n,d=["headers","sortForce","sortList","sortAppend","widgets"],i=e.originalSettings;if(i){if(r.debug(e,"core")){n=new Date}for(s in i){o=_typeof(r.defaults[s]);if("undefined"===o){console.warn("Tablesorter Warning! \"table.config."+s+"\" option not recognized")}else if("object"===o){for(a in i[s]){o=r.defaults[s]&&_typeof(r.defaults[s][a]);if(0>t.inArray(s,d)&&"undefined"===o){console.warn("Tablesorter Warning! \"table.config."+s+"."+a+"\" option not recognized")}}}}if(r.debug(e,"core")){console.log("validate options time:"+r.benchmark(n))}}},restoreHeaders:function restoreHeaders(e){var s,a,o=t(e)[0].config,n=o.$table.find(o.selectorHeaders),d=n.length;for(s=0;s<d;s++){a=n.eq(s);if(a.find("."+r.css.headerIn).length){a.html(o.headerContent[s])}}},destroy:function destroy(e,s,a){e=t(e)[0];if(!e.hasInitialized){return}r.removeWidget(e,!0,!1);var o,n=t(e),d=e.config,i=n.find("thead:first"),l=i.find("tr."+r.css.headerRow).removeClass(r.css.headerRow+" "+d.cssHeaderRow),c=n.find("tfoot:first > tr").children("th, td");if(!1===s&&0<=t.inArray("uitheme",d.widgets)){n.triggerHandler("applyWidgetId",["uitheme"]);n.triggerHandler("applyWidgetId",["zebra"])}i.find("tr").not(l).remove();o="sortReset update updateRows updateAll updateHeaders updateCell addRows updateComplete sorton appendCache updateCache applyWidgetId applyWidgets refreshWidgets removeWidget destroy mouseup mouseleave "+["keypress","sortBegin","sortEnd","resetToLoadState",""].join(d.namespace+" ");n.removeData("tablesorter").unbind(o.replace(r.regex.spaces," "));d.$headers.add(c).removeClass([r.css.header,d.cssHeader,d.cssAsc,d.cssDesc,r.css.sortAsc,r.css.sortDesc,r.css.sortNone].join(" ")).removeAttr("data-column").removeAttr("aria-label").attr("aria-disabled","true");l.find(d.selectorSort).unbind(["mousedown","mouseup","keypress",""].join(d.namespace+" ").replace(r.regex.spaces," "));r.restoreHeaders(e);n.toggleClass(r.css.table+" "+d.tableClass+" tablesorter-"+d.theme,!1===s);n.removeClass(d.namespace.slice(1));e.hasInitialized=!1;delete e.config.cache;if("function"==typeof a){a(e)}if(r.debug(d,"core")){console.log("tablesorter has been removed")}}};t.fn.tablesorter=function(e){return this.each(function(){var s=this,a=t.extend(!0,{},r.defaults,e,r.instanceMethods);a.originalSettings=e;if(!s.hasInitialized&&r.buildTable&&"TABLE"!==this.nodeName){r.buildTable(s,a)}else{r.setup(s,a)}})};if(!(window.console&&window.console.log)){r.logs=[];console={};console.log=console.warn=console.error=console.table=function(){var e=1<arguments.length?arguments:arguments[0];r.logs[r.logs.length]={date:Date.now(),log:e}}}r.addParser({id:"no-parser",is:function is(){return!1},format:function format(){return""},type:"text"});r.addParser({id:"text",is:function is(){return!0},format:function format(e,s){var a=s.config;if(e){e=t.trim(a.ignoreCase?e.toLocaleLowerCase():e);e=a.sortLocaleCompare?r.replaceAccents(e):e}return e},type:"text"});r.regex.nondigit=/[^\w,. \-()]/g;r.addParser({id:"digit",is:function is(e){return r.isDigit(e)},format:function format(e,s){var a=r.formatFloat((e||"").replace(r.regex.nondigit,""),s);return e&&"number"==typeof a?a:e?t.trim(e&&s.config.ignoreCase?e.toLocaleLowerCase():e):e},type:"numeric"});r.regex.currencyReplace=/[+\-,. ]/g;r.regex.currencyTest=/^\(?\d+[\u00a3$\u20ac\u00a4\u00a5\u00a2?.]|[\u00a3$\u20ac\u00a4\u00a5\u00a2?.]\d+\)?$/;r.addParser({id:"currency",is:function is(e){e=(e||"").replace(r.regex.currencyReplace,"");return r.regex.currencyTest.test(e)},format:function format(e,s){var a=r.formatFloat((e||"").replace(r.regex.nondigit,""),s);return e&&"number"==typeof a?a:e?t.trim(e&&s.config.ignoreCase?e.toLocaleLowerCase():e):e},type:"numeric"});r.regex.urlProtocolTest=/^(https?|ftp|file):\/\//;r.regex.urlProtocolReplace=/(https?|ftp|file):\/\/(www\.)?/;r.addParser({id:"url",is:function is(e){return r.regex.urlProtocolTest.test(e)},format:function format(e){return e?t.trim(e.replace(r.regex.urlProtocolReplace,"")):e},type:"text"});r.regex.dash=/-/g;r.regex.isoDate=/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}/;r.addParser({id:"isoDate",is:function is(e){return r.regex.isoDate.test(e)},format:function format(e){var t=e?new Date(e.replace(r.regex.dash,"/")):e;return t instanceof Date&&isFinite(t)?t.getTime():e},type:"numeric"});r.regex.percent=/%/g;r.regex.percentTest=/(\d\s*?%|%\s*?\d)/;r.addParser({id:"percent",is:function is(e){return r.regex.percentTest.test(e)&&15>e.length},format:function format(e,t){return e?r.formatFloat(e.replace(r.regex.percent,""),t):e},type:"numeric"});r.addParser({id:"image",is:function is(e,t,r,s){return 0<s.find("img").length},format:function format(e,r,s){return t(s).find("img").attr(r.config.imgAttr||"alt")||e},parsed:!0,type:"text"});r.regex.dateReplace=/(\S)([AP]M)$/i;r.regex.usLongDateTest1=/^[A-Z]{3,10}\.?\s+\d{1,2},?\s+(\d{4})(\s+\d{1,2}:\d{2}(:\d{2})?(\s+[AP]M)?)?$/i;r.regex.usLongDateTest2=/^\d{1,2}\s+[A-Z]{3,10}\s+\d{4}/i;r.addParser({id:"usLongDate",is:function is(e){return r.regex.usLongDateTest1.test(e)||r.regex.usLongDateTest2.test(e)},format:function format(e){var t=e?new Date(e.replace(r.regex.dateReplace,"$1 $2")):e;return t instanceof Date&&isFinite(t)?t.getTime():e},type:"numeric"});r.regex.shortDateTest=/(^\d{1,2}[\/\s]\d{1,2}[\/\s]\d{4})|(^\d{4}[\/\s]\d{1,2}[\/\s]\d{1,2})/;r.regex.shortDateReplace=/[\-.,]/g;r.regex.shortDateXXY=/(\d{1,2})[\/\s](\d{1,2})[\/\s](\d{4})/;r.regex.shortDateYMD=/(\d{4})[\/\s](\d{1,2})[\/\s](\d{1,2})/;r.convertFormat=function(e,t){e=(e||"").replace(r.regex.spaces," ").replace(r.regex.shortDateReplace,"/");if("mmddyyyy"===t){e=e.replace(r.regex.shortDateXXY,"$3/$1/$2")}else if("ddmmyyyy"===t){e=e.replace(r.regex.shortDateXXY,"$3/$2/$1")}else if("yyyymmdd"===t){e=e.replace(r.regex.shortDateYMD,"$1/$2/$3")}var s=new Date(e);return s instanceof Date&&isFinite(s)?s.getTime():""};r.addParser({id:"shortDate",is:function is(e){e=(e||"").replace(r.regex.spaces," ").replace(r.regex.shortDateReplace,"/");return r.regex.shortDateTest.test(e)},format:function(e,t,s,a){if(e){var o=t.config,n=o.$headerIndexed[a],d=n.length&&n.data("dateFormat")||r.getData(n,r.getColumnData(t,o.headers,a),"dateFormat")||o.dateFormat;if(n.length){n.data("dateFormat",d)}return r.convertFormat(e,d)||e}return e},type:"numeric"});r.regex.timeTest=/^(0?[1-9]|1[0-2]):([0-5]\d)(\s[AP]M)$|^((?:[01]\d|[2][0-4]):[0-5]\d)$/i;r.regex.timeMatch=/(0?[1-9]|1[0-2]):([0-5]\d)(\s[AP]M)|((?:[01]\d|[2][0-4]):[0-5]\d)/i;r.addParser({id:"time",is:function is(e){return r.regex.timeTest.test(e)},format:function format(e){var t,s=(e||"").match(r.regex.timeMatch),a=new Date(e),o=e&&(null!==s?s[0]:"00:00 AM"),n=o?new Date("2000/01/01 "+o.replace(r.regex.dateReplace,"$1 $2")):o;if(n instanceof Date&&isFinite(n)){t=a instanceof Date&&isFinite(a)?a.getTime():0;return t?parseFloat(n.getTime()+"."+a.getTime()):n.getTime()}return e},type:"numeric"});r.addParser({id:"metadata",is:function is(){return!1},format:function format(e,r,s){var a=r.config,o=!a.parserMetadataName?"sortValue":a.parserMetadataName;return t(s).metadata()[o]},type:"numeric"});r.addWidget({id:"zebra",priority:90,format:function format(e,r,s){var a,o,n,d,i,l,c,g=new RegExp(r.cssChildRow,"i"),p=r.$tbodies.add(t(r.namespace+"_extra_table").children("tbody:not(."+r.cssInfoBlock+")"));for(i=0;i<p.length;i++){n=0;a=p.eq(i).children("tr:visible").not(r.selectorRemove);c=a.length;for(l=0;l<c;l++){o=a.eq(l);if(!g.test(o[0].className)){n++}d=0==n%2;o.removeClass(s.zebra[d?1:0]).addClass(s.zebra[d?0:1])}}},remove:function remove(e,t,s,a){if(a){return}var o,n,d=t.$tbodies,i=(s.zebra||["even","odd"]).join(" ");for(o=0;o<d.length;o++){n=r.processTbody(e,d.eq(o),!0);n.children().removeClass(i);r.processTbody(e,n,!1)}}})})(e);return e.tablesorter});
define ("block_configurable_reports/main",["jquery","block_configurable_reports/jquery.tablesorter","block_configurable_reports/jquery.dataTables","block_configurable_reports/codemirror","block_configurable_reports/sql"],function(a,b,c,d){return{js_order:function js_order(b){a(b.selector).tablesorter();a(b.selector+" th.header").css({"background-image":"url("+b.background+")","background-position":"right center","background-repeat":"no-repeat",cursor:"pointer"});a(b.selector+" th.headerSortUp").css({"background-image":"url("+b.backgroundasc+")"});a(b.selector+" th.headerSortDown").css({"background-image":"url("+b.backgrounddesc+")"})},add_jsdatatables:function add_jsdatatables(b){a(b.selector).dataTable({bAutoWidth:!1,sPaginationType:"full_numbers",fixedHeader:!0,aaSorting:[],oLanguage:{oAria:{sSortAscending:M.str.block_configurable_reports.datatables_sortascending,sSortDescending:M.str.block_configurable_reports.datatables_sortdescending},oPaginate:{sFirst:M.str.block_configurable_reports.datatables_first,sLast:M.str.block_configurable_reports.datatables_last,sNext:M.str.block_configurable_reports.datatables_next,sPrevious:M.str.block_configurable_reports.datatables_previous},sEmptyTable:M.str.block_configurable_reports.datatables_emptytable,sInfo:M.str.block_configurable_reports.datatables_info,sInfoEmpty:M.str.block_configurable_reports.datatables_infoempty,sInfoFiltered:M.str.block_configurable_reports.datatables_infofiltered,sInfoThousands:M.str.langconfig.thousandssep,sLengthMenu:M.str.block_configurable_reports.datatables_lengthmenu,sLoadingRecords:M.str.block_configurable_reports.datatables_loadingrecords,sProcessing:M.str.block_configurable_reports.datatables_processing,sSearch:M.str.block_configurable_reports.datatables_search,sZeroRecords:M.str.block_configurable_reports.datatables_zerorecords}})},cmirror:function cmirror(){d.fromTextArea(document.getElementById("id_querysql"),{mode:"text/x-mysql",rtlMoveVisually:!0,indentWithTabs:!0,smartIndent:!0,lineNumbers:!0,autofocus:!0});d.fromTextArea(document.getElementById("id_remotequerysql"),{mode:"text/x-mysql",rtlMoveVisually:!0,indentWithTabs:!0,smartIndent:!0,lineNumbers:!0})}}});
function _typeof(a){if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}(function(a){if("object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&"object"==("undefined"==typeof module?"undefined":_typeof(module)))a(require("../../lib/codemirror"));else if("function"==typeof define&&define.amd)define ("block_configurable_reports/sql",["block_configurable_reports/codemirror"],a);else a(CodeMirror)})(function(a){"use strict";a.defineMode("sql",function(b,c){var i=c.client||{},j=c.atoms||{false:!0,true:!0,null:!0},k=c.builtin||{},l=c.keywords||{},m=c.operatorChars||/^[*+\-%<>!=&|~^]/,n=c.support||{},o=c.hooks||{},p=c.dateSQL||{date:!0,time:!0,timestamp:!0},q=!1!==c.backslashStringEscapes,r=c.brackets||/^[\{}\(\)\[\]]/,s=c.punctuation||/^[;.,:]/;function d(a,b){var c=a.next();if(o[c]){var d=o[c](a,b);if(!1!==d)return d}if(n.hexNumber&&("0"==c&&a.match(/^[xX][0-9a-fA-F]+/)||("x"==c||"X"==c)&&a.match(/^'[0-9a-fA-F]+'/))){return"number"}else if(n.binaryNumber&&(("b"==c||"B"==c)&&a.match(/^'[01]+'/)||"0"==c&&a.match(/^b[01]+/))){return"number"}else if(47<c.charCodeAt(0)&&58>c.charCodeAt(0)){a.match(/^[0-9]*(\.[0-9]+)?([eE][-+]?[0-9]+)?/);n.decimallessFloat&&a.match(/^\.(?!\.)/);return"number"}else if("?"==c&&(a.eatSpace()||a.eol()||a.eat(";"))){return"variable-3"}else if("'"==c||"\""==c&&n.doubleQuote){b.tokenize=e(c);return b.tokenize(a,b)}else if((n.nCharCast&&("n"==c||"N"==c)||n.charsetCast&&"_"==c&&a.match(/[a-z][a-z0-9]*/i))&&("'"==a.peek()||"\""==a.peek())){return"keyword"}else if(n.commentSlashSlash&&"/"==c&&a.eat("/")){a.skipToEnd();return"comment"}else if(n.commentHash&&"#"==c||"-"==c&&a.eat("-")&&(!n.commentSpaceRequired||a.eat(" "))){a.skipToEnd();return"comment"}else if("/"==c&&a.eat("*")){b.tokenize=f(1);return b.tokenize(a,b)}else if("."==c){if(n.zerolessFloat&&a.match(/^(?:\d+(?:e[+-]?\d+)?)/i))return"number";if(a.match(/^\.+/))return null;if(n.ODBCdotTable&&a.match(/^[\w\d_]+/))return"variable-2"}else if(m.test(c)){a.eatWhile(m);return"operator"}else if(r.test(c)){return"bracket"}else if(s.test(c)){a.eatWhile(s);return"punctuation"}else if("{"==c&&(a.match(/^( )*(d|D|t|T|ts|TS)( )*'[^']*'( )*}/)||a.match(/^( )*(d|D|t|T|ts|TS)( )*"[^"]*"( )*}/))){return"number"}else{a.eatWhile(/^[_\w\d]/);var g=a.current().toLowerCase();if(p.hasOwnProperty(g)&&(a.match(/^( )+'[^']*'/)||a.match(/^( )+"[^"]*"/)))return"number";if(j.hasOwnProperty(g))return"atom";if(k.hasOwnProperty(g))return"builtin";if(l.hasOwnProperty(g))return"keyword";if(i.hasOwnProperty(g))return"string-2";return null}}function e(a){return function(b,c){var e=!1,f;while(null!=(f=b.next())){if(f==a&&!e){c.tokenize=d;break}e=q&&!e&&"\\"==f}return"string"}}function f(a){return function(b,c){var e=b.match(/^.*?(\/\*|\*\/)/);if(!e)b.skipToEnd();else if("/*"==e[1])c.tokenize=f(a+1);else if(1<a)c.tokenize=f(a-1);else c.tokenize=d;return"comment"}}function g(a,b,c){b.context={prev:b.context,indent:a.indentation(),col:a.column(),type:c}}function h(a){a.indent=a.context.indent;a.context=a.context.prev}return{startState:function startState(){return{tokenize:d,context:null}},token:function token(a,b){if(a.sol()){if(b.context&&null==b.context.align)b.context.align=!1}if(b.tokenize==d&&a.eatSpace())return null;var c=b.tokenize(a,b);if("comment"==c)return c;if(b.context&&null==b.context.align)b.context.align=!0;var e=a.current();if("("==e)g(a,b,")");else if("["==e)g(a,b,"]");else if(b.context&&b.context.type==e)h(b);return c},indent:function indent(c,d){var e=c.context;if(!e)return a.Pass;var f=d.charAt(0)==e.type;if(e.align)return e.col+(f?0:1);else return e.indent+(f?0:b.indentUnit)},blockCommentStart:"/*",blockCommentEnd:"*/",lineComment:n.commentSlashSlash?"//":n.commentHash?"#":"--",closeBrackets:"()[]{}''\"\"``"}});(function(){function b(a){var b;while(null!=(b=a.next())){if("`"==b&&!a.eat("`"))return"variable-2"}a.backUp(a.current().length-1);return a.eatWhile(/\w/)?"variable-2":null}function c(a){if(a.eat("@")){a.match(/^session\./);a.match(/^local\./);a.match(/^global\./)}if(a.eat("'")){a.match(/^.*'/);return"variable-2"}else if(a.eat("\"")){a.match(/^.*"/);return"variable-2"}else if(a.eat("`")){a.match(/^.*`/);return"variable-2"}else if(a.match(/^[0-9a-zA-Z$\.\_]+/)){return"variable-2"}return null}function d(a){if(a.eat("N")){return"atom"}return a.match(/^[a-zA-Z.#!?]/)?"variable-2":null}function e(a){for(var b={},c=a.split(" "),d=0;d<c.length;++d){b[c[d]]=!0}return b}a.defineMIME("text/x-sql",{name:"sql",keywords:e("alter and as asc between by count create delete desc distinct drop from group having in insert into is join like not on or order select set table union update values where limit begin"),builtin:e("bool boolean bit blob enum long longblob longtext medium mediumblob mediumint mediumtext time timestamp tinyblob tinyint tinytext text bigint int int1 int2 int3 int4 int8 integer float float4 float8 double char varbinary varchar varcharacter precision real date datetime year unsigned signed decimal numeric"),atoms:e("false true null unknown"),operatorChars:/^[*+\-%<>!=]/,dateSQL:e("date time timestamp"),support:e("ODBCdotTable doubleQuote binaryNumber hexNumber")});a.defineMIME("text/x-mssql",{name:"sql",client:e("$partition binary_checksum checksum connectionproperty context_info current_request_id error_line error_message error_number error_procedure error_severity error_state formatmessage get_filestream_transaction_context getansinull host_id host_name isnull isnumeric min_active_rowversion newid newsequentialid rowcount_big xact_state object_id"),keywords:e("alter and as asc between by count create delete desc distinct drop from group having in insert into is join like not on or order select set table union update values where limit begin trigger proc view index for add constraint key primary foreign collate clustered nonclustered declare exec go if use index holdlock nolock nowait paglock readcommitted readcommittedlock readpast readuncommitted repeatableread rowlock serializable snapshot tablock tablockx updlock with"),builtin:e("bigint numeric bit smallint decimal smallmoney int tinyint money float real char varchar text nchar nvarchar ntext binary varbinary image cursor timestamp hierarchyid uniqueidentifier sql_variant xml table "),atoms:e("is not null like and or in left right between inner outer join all any some cross unpivot pivot exists"),operatorChars:/^[*+\-%<>!=^\&|\/]/,brackets:/^[\{}\(\)]/,punctuation:/^[;.,:/]/,backslashStringEscapes:!1,dateSQL:e("date datetimeoffset datetime2 smalldatetime datetime time"),hooks:{"@":c}});a.defineMIME("text/x-mysql",{name:"sql",client:e("charset clear connect edit ego exit go help nopager notee nowarning pager print prompt quit rehash source status system tee"),keywords:e("alter and as asc between by count create delete desc distinct drop from group having in insert into is join like not on or order select set table union update values where limit accessible action add after algorithm all analyze asensitive at authors auto_increment autocommit avg avg_row_length before binary binlog both btree cache call cascade cascaded case catalog_name chain change changed character check checkpoint checksum class_origin client_statistics close coalesce code collate collation collations column columns comment commit committed completion concurrent condition connection consistent constraint contains continue contributors convert cross current current_date current_time current_timestamp current_user cursor data database databases day_hour day_microsecond day_minute day_second deallocate dec declare default delay_key_write delayed delimiter des_key_file describe deterministic dev_pop dev_samp deviance diagnostics directory disable discard distinctrow div dual dumpfile each elseif enable enclosed end ends engine engines enum errors escape escaped even event events every execute exists exit explain extended fast fetch field fields first flush for force foreign found_rows full fulltext function general get global grant grants group group_concat handler hash help high_priority hosts hour_microsecond hour_minute hour_second if ignore ignore_server_ids import index index_statistics infile inner innodb inout insensitive insert_method install interval invoker isolation iterate key keys kill language last leading leave left level limit linear lines list load local localtime localtimestamp lock logs low_priority master master_heartbeat_period master_ssl_verify_server_cert masters match max max_rows maxvalue message_text middleint migrate min min_rows minute_microsecond minute_second mod mode modifies modify mutex mysql_errno natural next no no_write_to_binlog offline offset one online open optimize option optionally out outer outfile pack_keys parser partition partitions password phase plugin plugins prepare preserve prev primary privileges procedure processlist profile profiles purge query quick range read read_write reads real rebuild recover references regexp relaylog release remove rename reorganize repair repeatable replace require resignal restrict resume return returns revoke right rlike rollback rollup row row_format rtree savepoint schedule schema schema_name schemas second_microsecond security sensitive separator serializable server session share show signal slave slow smallint snapshot soname spatial specific sql sql_big_result sql_buffer_result sql_cache sql_calc_found_rows sql_no_cache sql_small_result sqlexception sqlstate sqlwarning ssl start starting starts status std stddev stddev_pop stddev_samp storage straight_join subclass_origin sum suspend table_name table_statistics tables tablespace temporary terminated to trailing transaction trigger triggers truncate uncommitted undo uninstall unique unlock upgrade usage use use_frm user user_resources user_statistics using utc_date utc_time utc_timestamp value variables varying view views warnings when while with work write xa xor year_month zerofill begin do then else loop repeat"),builtin:e("bool boolean bit blob decimal double float long longblob longtext medium mediumblob mediumint mediumtext time timestamp tinyblob tinyint tinytext text bigint int int1 int2 int3 int4 int8 integer float float4 float8 double char varbinary varchar varcharacter precision date datetime year unsigned signed numeric"),atoms:e("false true null unknown"),operatorChars:/^[*+\-%<>!=&|^]/,dateSQL:e("date time timestamp"),support:e("ODBCdotTable decimallessFloat zerolessFloat binaryNumber hexNumber doubleQuote nCharCast charsetCast commentHash commentSpaceRequired"),hooks:{"@":c,"`":b,"\\":d}});a.defineMIME("text/x-mariadb",{name:"sql",client:e("charset clear connect edit ego exit go help nopager notee nowarning pager print prompt quit rehash source status system tee"),keywords:e("alter and as asc between by count create delete desc distinct drop from group having in insert into is join like not on or order select set table union update values where limit accessible action add after algorithm all always analyze asensitive at authors auto_increment autocommit avg avg_row_length before binary binlog both btree cache call cascade cascaded case catalog_name chain change changed character check checkpoint checksum class_origin client_statistics close coalesce code collate collation collations column columns comment commit committed completion concurrent condition connection consistent constraint contains continue contributors convert cross current current_date current_time current_timestamp current_user cursor data database databases day_hour day_microsecond day_minute day_second deallocate dec declare default delay_key_write delayed delimiter des_key_file describe deterministic dev_pop dev_samp deviance diagnostics directory disable discard distinctrow div dual dumpfile each elseif enable enclosed end ends engine engines enum errors escape escaped even event events every execute exists exit explain extended fast fetch field fields first flush for force foreign found_rows full fulltext function general generated get global grant grants group groupby_concat handler hard hash help high_priority hosts hour_microsecond hour_minute hour_second if ignore ignore_server_ids import index index_statistics infile inner innodb inout insensitive insert_method install interval invoker isolation iterate key keys kill language last leading leave left level limit linear lines list load local localtime localtimestamp lock logs low_priority master master_heartbeat_period master_ssl_verify_server_cert masters match max max_rows maxvalue message_text middleint migrate min min_rows minute_microsecond minute_second mod mode modifies modify mutex mysql_errno natural next no no_write_to_binlog offline offset one online open optimize option optionally out outer outfile pack_keys parser partition partitions password persistent phase plugin plugins prepare preserve prev primary privileges procedure processlist profile profiles purge query quick range read read_write reads real rebuild recover references regexp relaylog release remove rename reorganize repair repeatable replace require resignal restrict resume return returns revoke right rlike rollback rollup row row_format rtree savepoint schedule schema schema_name schemas second_microsecond security sensitive separator serializable server session share show shutdown signal slave slow smallint snapshot soft soname spatial specific sql sql_big_result sql_buffer_result sql_cache sql_calc_found_rows sql_no_cache sql_small_result sqlexception sqlstate sqlwarning ssl start starting starts status std stddev stddev_pop stddev_samp storage straight_join subclass_origin sum suspend table_name table_statistics tables tablespace temporary terminated to trailing transaction trigger triggers truncate uncommitted undo uninstall unique unlock upgrade usage use use_frm user user_resources user_statistics using utc_date utc_time utc_timestamp value variables varying view views virtual warnings when while with work write xa xor year_month zerofill begin do then else loop repeat"),builtin:e("bool boolean bit blob decimal double float long longblob longtext medium mediumblob mediumint mediumtext time timestamp tinyblob tinyint tinytext text bigint int int1 int2 int3 int4 int8 integer float float4 float8 double char varbinary varchar varcharacter precision date datetime year unsigned signed numeric"),atoms:e("false true null unknown"),operatorChars:/^[*+\-%<>!=&|^]/,dateSQL:e("date time timestamp"),support:e("ODBCdotTable decimallessFloat zerolessFloat binaryNumber hexNumber doubleQuote nCharCast charsetCast commentHash commentSpaceRequired"),hooks:{"@":c,"`":b,"\\":d}});a.defineMIME("text/x-sqlite",{name:"sql",client:e("auth backup bail binary changes check clone databases dbinfo dump echo eqp exit explain fullschema headers help import imposter indexes iotrace limit lint load log mode nullvalue once open output print prompt quit read restore save scanstats schema separator session shell show stats system tables testcase timeout timer trace vfsinfo vfslist vfsname width"),keywords:e("alter and as asc between by count create delete desc distinct drop from group having in insert into is join like not on or order select set table union update values where limit abort action add after all analyze attach autoincrement before begin cascade case cast check collate column commit conflict constraint cross current_date current_time current_timestamp database default deferrable deferred detach each else end escape except exclusive exists explain fail for foreign full glob if ignore immediate index indexed initially inner instead intersect isnull key left limit match natural no notnull null of offset outer plan pragma primary query raise recursive references regexp reindex release rename replace restrict right rollback row savepoint temp temporary then to transaction trigger unique using vacuum view virtual when with without"),builtin:e("bool boolean bit blob decimal double float long longblob longtext medium mediumblob mediumint mediumtext time timestamp tinyblob tinyint tinytext text clob bigint int int2 int8 integer float double char varchar date datetime year unsigned signed numeric real"),atoms:e("null current_date current_time current_timestamp"),operatorChars:/^[*+\-%<>!=&|/~]/,dateSQL:e("date time timestamp datetime"),support:e("decimallessFloat zerolessFloat"),identifierQuote:"\"",hooks:{"@":c,":":c,"?":c,$:c,'"':function(a){var b;while(null!=(b=a.next())){if("\""==b&&!a.eat("\""))return"variable-2"}a.backUp(a.current().length-1);return a.eatWhile(/\w/)?"variable-2":null},"`":b}});a.defineMIME("text/x-cassandra",{name:"sql",client:{},keywords:e("add all allow alter and any apply as asc authorize batch begin by clustering columnfamily compact consistency count create custom delete desc distinct drop each_quorum exists filtering from grant if in index insert into key keyspace keyspaces level limit local_one local_quorum modify nan norecursive nosuperuser not of on one order password permission permissions primary quorum rename revoke schema select set storage superuser table three to token truncate ttl two type unlogged update use user users using values where with writetime"),builtin:e("ascii bigint blob boolean counter decimal double float frozen inet int list map static text timestamp timeuuid tuple uuid varchar varint"),atoms:e("false true infinity NaN"),operatorChars:/^[<>=]/,dateSQL:{},support:e("commentSlashSlash decimallessFloat"),hooks:{}});a.defineMIME("text/x-plsql",{name:"sql",client:e("appinfo arraysize autocommit autoprint autorecovery autotrace blockterminator break btitle cmdsep colsep compatibility compute concat copycommit copytypecheck define describe echo editfile embedded escape exec execute feedback flagger flush heading headsep instance linesize lno loboffset logsource long longchunksize markup native newpage numformat numwidth pagesize pause pno recsep recsepchar release repfooter repheader serveroutput shiftinout show showmode size spool sqlblanklines sqlcase sqlcode sqlcontinue sqlnumber sqlpluscompatibility sqlprefix sqlprompt sqlterminator suffix tab term termout time timing trimout trimspool ttitle underline verify version wrap"),keywords:e("abort accept access add all alter and any array arraylen as asc assert assign at attributes audit authorization avg base_table begin between binary_integer body boolean by case cast char char_base check close cluster clusters colauth column comment commit compress connect connected constant constraint crash create current currval cursor data_base database date dba deallocate debugoff debugon decimal declare default definition delay delete desc digits dispose distinct do drop else elseif elsif enable end entry escape exception exception_init exchange exclusive exists exit external fast fetch file for force form from function generic goto grant group having identified if immediate in increment index indexes indicator initial initrans insert interface intersect into is key level library like limited local lock log logging long loop master maxextents maxtrans member minextents minus mislabel mode modify multiset new next no noaudit nocompress nologging noparallel not nowait number_base object of off offline on online only open option or order out package parallel partition pctfree pctincrease pctused pls_integer positive positiven pragma primary prior private privileges procedure public raise range raw read rebuild record ref references refresh release rename replace resource restrict return returning returns reverse revoke rollback row rowid rowlabel rownum rows run savepoint schema segment select separate session set share snapshot some space split sql start statement storage subtype successful synonym tabauth table tables tablespace task terminate then to trigger truncate type union unique unlimited unrecoverable unusable update use using validate value values variable view views when whenever where while with work"),builtin:e("abs acos add_months ascii asin atan atan2 average bfile bfilename bigserial bit blob ceil character chartorowid chr clob concat convert cos cosh count dec decode deref dual dump dup_val_on_index empty error exp false float floor found glb greatest hextoraw initcap instr instrb int integer isopen last_day least length lengthb ln lower lpad ltrim lub make_ref max min mlslabel mod months_between natural naturaln nchar nclob new_time next_day nextval nls_charset_decl_len nls_charset_id nls_charset_name nls_initcap nls_lower nls_sort nls_upper nlssort no_data_found notfound null number numeric nvarchar2 nvl others power rawtohex real reftohex round rowcount rowidtochar rowtype rpad rtrim serial sign signtype sin sinh smallint soundex sqlcode sqlerrm sqrt stddev string substr substrb sum sysdate tan tanh to_char text to_date to_label to_multi_byte to_number to_single_byte translate true trunc uid unlogged upper user userenv varchar varchar2 variance varying vsize xml"),operatorChars:/^[*+\-%<>!=~]/,dateSQL:e("date time timestamp"),support:e("doubleQuote nCharCast zerolessFloat binaryNumber hexNumber")});a.defineMIME("text/x-hive",{name:"sql",keywords:e("select alter $elem$ $key$ $value$ add after all analyze and archive as asc before between binary both bucket buckets by cascade case cast change cluster clustered clusterstatus collection column columns comment compute concatenate continue create cross cursor data database databases dbproperties deferred delete delimited desc describe directory disable distinct distribute drop else enable end escaped exclusive exists explain export extended external fetch fields fileformat first format formatted from full function functions grant group having hold_ddltime idxproperties if import in index indexes inpath inputdriver inputformat insert intersect into is items join keys lateral left like limit lines load local location lock locks mapjoin materialized minus msck no_drop nocompress not of offline on option or order out outer outputdriver outputformat overwrite partition partitioned partitions percent plus preserve procedure purge range rcfile read readonly reads rebuild recordreader recordwriter recover reduce regexp rename repair replace restrict revoke right rlike row schema schemas semi sequencefile serde serdeproperties set shared show show_database sort sorted ssl statistics stored streamtable table tables tablesample tblproperties temporary terminated textfile then tmp to touch transform trigger unarchive undo union uniquejoin unlock update use using utc utc_tmestamp view when where while with admin authorization char compact compactions conf cube current current_date current_timestamp day decimal defined dependency directories elem_type exchange file following for grouping hour ignore inner interval jar less logical macro minute month more none noscan over owner partialscan preceding pretty principals protection reload rewrite role roles rollup rows second server sets skewed transactions truncate unbounded unset uri user values window year"),builtin:e("bool boolean long timestamp tinyint smallint bigint int float double date datetime unsigned string array struct map uniontype key_type utctimestamp value_type varchar"),atoms:e("false true null unknown"),operatorChars:/^[*+\-%<>!=]/,dateSQL:e("date timestamp"),support:e("ODBCdotTable doubleQuote binaryNumber hexNumber")});a.defineMIME("text/x-pgsql",{name:"sql",client:e("source"),keywords:e("alter and as asc between by count create delete desc distinct drop from group having in insert into is join like not on or order select set table union update values where limit a abort abs absent absolute access according action ada add admin after aggregate all allocate also always analyse analyze any are array array_agg array_max_cardinality asensitive assertion assignment asymmetric at atomic attribute attributes authorization avg backward base64 before begin begin_frame begin_partition bernoulli binary bit_length blob blocked bom both breadth c cache call called cardinality cascade cascaded case cast catalog catalog_name ceil ceiling chain characteristics characters character_length character_set_catalog character_set_name character_set_schema char_length check checkpoint class class_origin clob close cluster coalesce cobol collate collation collation_catalog collation_name collation_schema collect column columns column_name command_function command_function_code comment comments commit committed concurrently condition condition_number configuration conflict connect connection connection_name constraint constraints constraint_catalog constraint_name constraint_schema constructor contains content continue control conversion convert copy corr corresponding cost covar_pop covar_samp cross csv cube cume_dist current current_catalog current_date current_default_transform_group current_path current_role current_row current_schema current_time current_timestamp current_transform_group_for_type current_user cursor cursor_name cycle data database datalink datetime_interval_code datetime_interval_precision day db deallocate dec declare default defaults deferrable deferred defined definer degree delimiter delimiters dense_rank depth deref derived describe descriptor deterministic diagnostics dictionary disable discard disconnect dispatch dlnewcopy dlpreviouscopy dlurlcomplete dlurlcompleteonly dlurlcompletewrite dlurlpath dlurlpathonly dlurlpathwrite dlurlscheme dlurlserver dlvalue do document domain dynamic dynamic_function dynamic_function_code each element else empty enable encoding encrypted end end-exec end_frame end_partition enforced enum equals escape event every except exception exclude excluding exclusive exec execute exists exp explain expression extension external extract false family fetch file filter final first first_value flag float floor following for force foreign fortran forward found frame_row free freeze fs full function functions fusion g general generated get global go goto grant granted greatest grouping groups handler header hex hierarchy hold hour id identity if ignore ilike immediate immediately immutable implementation implicit import including increment indent index indexes indicator inherit inherits initially inline inner inout input insensitive instance instantiable instead integrity intersect intersection invoker isnull isolation k key key_member key_type label lag language large last last_value lateral lc_collate lc_ctype lead leading leakproof least left length level library like_regex link listen ln load local localtime localtimestamp location locator lock locked logged lower m map mapping match matched materialized max maxvalue max_cardinality member merge message_length message_octet_length message_text method min minute minvalue mod mode modifies module month more move multiset mumps name names namespace national natural nchar nclob nesting new next nfc nfd nfkc nfkd nil no none normalize normalized nothing notify notnull nowait nth_value ntile null nullable nullif nulls number object occurrences_regex octets octet_length of off offset oids old only open operator option options ordering ordinality others out outer output over overlaps overlay overriding owned owner p pad parallel parameter parameter_mode parameter_name parameter_ordinal_position parameter_specific_catalog parameter_specific_name parameter_specific_schema parser partial partition pascal passing passthrough password percent percentile_cont percentile_disc percent_rank period permission placing plans pli policy portion position position_regex power precedes preceding prepare prepared preserve primary prior privileges procedural procedure program public quote range rank read reads reassign recheck recovery recursive ref references referencing refresh regr_avgx regr_avgy regr_count regr_intercept regr_r2 regr_slope regr_sxx regr_sxy regr_syy reindex relative release rename repeatable replace replica requiring reset respect restart restore restrict restricted result return returned_cardinality returned_length returned_octet_length returned_sqlstate returning returns revoke right role rollback rollup routine routine_catalog routine_name routine_schema row rows row_count row_number rule savepoint scale schema schema_name scope scope_catalog scope_name scope_schema scroll search second section security selective self sensitive sequence sequences serializable server server_name session session_user setof sets share show similar simple size skip snapshot some source space specific specifictype specific_name sql sqlcode sqlerror sqlexception sqlstate sqlwarning sqrt stable standalone start state statement static statistics stddev_pop stddev_samp stdin stdout storage strict strip structure style subclass_origin submultiset substring substring_regex succeeds sum symmetric sysid system system_time system_user t tables tablesample tablespace table_name temp template temporary then ties timezone_hour timezone_minute to token top_level_count trailing transaction transactions_committed transactions_rolled_back transaction_active transform transforms translate translate_regex translation treat trigger trigger_catalog trigger_name trigger_schema trim trim_array true truncate trusted type types uescape unbounded uncommitted under unencrypted unique unknown unlink unlisten unlogged unnamed unnest until untyped upper uri usage user user_defined_type_catalog user_defined_type_code user_defined_type_name user_defined_type_schema using vacuum valid validate validator value value_of varbinary variadic var_pop var_samp verbose version versioning view views volatile when whenever whitespace width_bucket window within work wrapper write xmlagg xmlattributes xmlbinary xmlcast xmlcomment xmlconcat xmldeclaration xmldocument xmlelement xmlexists xmlforest xmliterate xmlnamespaces xmlparse xmlpi xmlquery xmlroot xmlschema xmlserialize xmltable xmltext xmlvalidate year yes loop repeat attach path depends detach zone"),builtin:e("bigint int8 bigserial serial8 bit varying varbit boolean bool box bytea character char varchar cidr circle date double precision float8 inet integer int int4 interval json jsonb line lseg macaddr macaddr8 money numeric decimal path pg_lsn point polygon real float4 smallint int2 smallserial serial2 serial serial4 text time without zone with timetz timestamp timestamptz tsquery tsvector txid_snapshot uuid xml"),atoms:e("false true null unknown"),operatorChars:/^[*+\-%<>!=&|^\/#@?~]/,dateSQL:e("date time timestamp"),support:e("ODBCdotTable decimallessFloat zerolessFloat binaryNumber hexNumber nCharCast charsetCast")});a.defineMIME("text/x-gql",{name:"sql",keywords:e("ancestor and asc by contains desc descendant distinct from group has in is limit offset on order select superset where"),atoms:e("false true"),builtin:e("blob datetime first key __key__ string integer double boolean null"),operatorChars:/^[*+\-%<>!=]/});a.defineMIME("text/x-gpsql",{name:"sql",client:e("source"),keywords:e("abort absolute access action active add admin after aggregate all also alter always analyse analyze and any array as asc assertion assignment asymmetric at authorization backward before begin between bigint binary bit boolean both by cache called cascade cascaded case cast chain char character characteristics check checkpoint class close cluster coalesce codegen collate column comment commit committed concurrency concurrently configuration connection constraint constraints contains content continue conversion copy cost cpu_rate_limit create createdb createexttable createrole createuser cross csv cube current current_catalog current_date current_role current_schema current_time current_timestamp current_user cursor cycle data database day deallocate dec decimal declare decode default defaults deferrable deferred definer delete delimiter delimiters deny desc dictionary disable discard distinct distributed do document domain double drop dxl each else enable encoding encrypted end enum errors escape every except exchange exclude excluding exclusive execute exists explain extension external extract false family fetch fields filespace fill filter first float following for force foreign format forward freeze from full function global grant granted greatest group group_id grouping handler hash having header hold host hour identity if ignore ilike immediate immutable implicit in including inclusive increment index indexes inherit inherits initially inline inner inout input insensitive insert instead int integer intersect interval into invoker is isnull isolation join key language large last leading least left level like limit list listen load local localtime localtimestamp location lock log login mapping master match maxvalue median merge minute minvalue missing mode modifies modify month move name names national natural nchar new newline next no nocreatedb nocreateexttable nocreaterole nocreateuser noinherit nologin none noovercommit nosuperuser not nothing notify notnull nowait null nullif nulls numeric object of off offset oids old on only operator option options or order ordered others out outer over overcommit overlaps overlay owned owner parser partial partition partitions passing password percent percentile_cont percentile_disc placing plans position preceding precision prepare prepared preserve primary prior privileges procedural procedure protocol queue quote randomly range read readable reads real reassign recheck recursive ref references reindex reject relative release rename repeatable replace replica reset resource restart restrict returning returns revoke right role rollback rollup rootpartition row rows rule savepoint scatter schema scroll search second security segment select sequence serializable session session_user set setof sets share show similar simple smallint some split sql stable standalone start statement statistics stdin stdout storage strict strip subpartition subpartitions substring superuser symmetric sysid system table tablespace temp template temporary text then threshold ties time timestamp to trailing transaction treat trigger trim true truncate trusted type unbounded uncommitted unencrypted union unique unknown unlisten until update user using vacuum valid validation validator value values varchar variadic varying verbose version view volatile web when where whitespace window with within without work writable write xml xmlattributes xmlconcat xmlelement xmlexists xmlforest xmlparse xmlpi xmlroot xmlserialize year yes zone"),builtin:e("bigint int8 bigserial serial8 bit varying varbit boolean bool box bytea character char varchar cidr circle date double precision float float8 inet integer int int4 interval json jsonb line lseg macaddr macaddr8 money numeric decimal path pg_lsn point polygon real float4 smallint int2 smallserial serial2 serial serial4 text time without zone with timetz timestamp timestamptz tsquery tsvector txid_snapshot uuid xml"),atoms:e("false true null unknown"),operatorChars:/^[*+\-%<>!=&|^\/#@?~]/,dateSQL:e("date time timestamp"),support:e("ODBCdotTable decimallessFloat zerolessFloat binaryNumber hexNumber nCharCast charsetCast")});a.defineMIME("text/x-sparksql",{name:"sql",keywords:e("add after all alter analyze and anti archive array as asc at between bucket buckets by cache cascade case cast change clear cluster clustered codegen collection column columns comment commit compact compactions compute concatenate cost create cross cube current current_date current_timestamp database databases datata dbproperties defined delete delimited deny desc describe dfs directories distinct distribute drop else end escaped except exchange exists explain export extended external false fields fileformat first following for format formatted from full function functions global grant group grouping having if ignore import in index indexes inner inpath inputformat insert intersect interval into is items join keys last lateral lazy left like limit lines list load local location lock locks logical macro map minus msck natural no not null nulls of on optimize option options or order out outer outputformat over overwrite partition partitioned partitions percent preceding principals purge range recordreader recordwriter recover reduce refresh regexp rename repair replace reset restrict revoke right rlike role roles rollback rollup row rows schema schemas select semi separated serde serdeproperties set sets show skewed sort sorted start statistics stored stratify struct table tables tablesample tblproperties temp temporary terminated then to touch transaction transactions transform true truncate unarchive unbounded uncache union unlock unset use using values view when where window with"),builtin:e("tinyint smallint int bigint boolean float double string binary timestamp decimal array map struct uniontype delimited serde sequencefile textfile rcfile inputformat outputformat"),atoms:e("false true null"),operatorChars:/^[*+\-%<>!=~&|^]/,dateSQL:e("date time timestamp"),support:e("ODBCdotTable doubleQuote zerolessFloat")});a.defineMIME("text/x-esper",{name:"sql",client:e("source"),keywords:e("alter and as asc between by count create delete desc distinct drop from group having in insert into is join like not on or order select set table union update values where limit after all and as at asc avedev avg between by case cast coalesce count create current_timestamp day days delete define desc distinct else end escape events every exists false first from full group having hour hours in inner insert instanceof into irstream is istream join last lastweekday left limit like max match_recognize matches median measures metadatasql min minute minutes msec millisecond milliseconds not null offset on or order outer output partition pattern prev prior regexp retain-union retain-intersection right rstream sec second seconds select set some snapshot sql stddev sum then true unidirectional until update variable weekday when where window"),builtin:{},atoms:e("false true null"),operatorChars:/^[*+\-%<>!=&|^\/#@?~]/,dateSQL:e("time"),support:e("decimallessFloat zerolessFloat binaryNumber hexNumber")})})()});
/**
 * Javascript to initialise the myoverview block.
 *
 * @package    block_myoverview
 * @copyright  2018 Bas Brands <bas@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_myoverview/main",["jquery","block_myoverview/view","block_myoverview/view_nav"],(function($,View,ViewNav){return{init:function(root){root=$(root),ViewNav.init(root),View.init(root)}}}));
/**
 * Manage the courses view for the overview block.
 *
 * @package    block_myoverview
 * @copyright  2018 Bas Brands <bas@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_myoverview/view",["jquery","block_myoverview/repository","core/paged_content_factory","core/pubsub","core/custom_interaction_events","core/notification","core/templates","core_course/events","block_myoverview/selectors","core/paged_content_events"],(function($,Repository,PagedContentFactory,PubSub,CustomEvents,Notification,Templates,CourseEvents,Selectors,PagedContentEvents){var SELECTORS_ACTION_HIDE_COURSE='[data-action="hide-course"]',SELECTORS_ACTION_SHOW_COURSE='[data-action="show-course"]',SELECTORS_ACTION_ADD_FAVOURITE='[data-action="add-favourite"]',SELECTORS_ACTION_REMOVE_FAVOURITE='[data-action="remove-favourite"]',SELECTORS_FAVOURITE_ICON='[data-region="favourite-icon"]',SELECTORS_ICON_IS_FAVOURITE='[data-region="is-favourite"]',SELECTORS_ICON_NOT_FAVOURITE='[data-region="not-favourite"]',TEMPLATES_COURSES_CARDS="block_myoverview/view-cards",TEMPLATES_COURSES_LIST="block_myoverview/view-list",TEMPLATES_COURSES_SUMMARY="block_myoverview/view-summary",TEMPLATES_NOCOURSES="core_course/no-courses",GROUPINGS_GROUPING_ALLINCLUDINGHIDDEN="allincludinghidden",NUMCOURSES_PERPAGE=[12,24,48,96,0],loadedPages=[],courseOffset=0,lastPage=0,lastLimit=0,namespace=null,getFilterValues=function(root){var courseRegion=root.find(Selectors.courseView.region);return{display:courseRegion.attr("data-display"),grouping:courseRegion.attr("data-grouping"),sort:courseRegion.attr("data-sort"),displaycategories:courseRegion.attr("data-displaycategories"),customfieldname:courseRegion.attr("data-customfieldname"),customfieldvalue:courseRegion.attr("data-customfieldvalue")}},DEFAULT_PAGED_CONTENT_CONFIG={ignoreControlWhileLoading:!0,controlPlacementBottom:!0,persistentLimitKey:"block_myoverview_user_paging_preference"},getFavouriteIconContainer=function(root,courseId){return root.find(SELECTORS_FAVOURITE_ICON+'[data-course-id="'+courseId+'"]')},getPagedContentContainer=function(root,index){return root.find('[data-region="paged-content-page"][data-page="'+index+'"]')},getCourseId=function(root){return root.attr("data-course-id")},getAddFavouriteMenuItem=function(root,courseId){return root.find('[data-action="add-favourite"][data-course-id="'+courseId+'"]')},getRemoveFavouriteMenuItem=function(root,courseId){return root.find('[data-action="remove-favourite"][data-course-id="'+courseId+'"]')},addToFavourites=function(root,courseId){var removeAction=getRemoveFavouriteMenuItem(root,courseId),addAction=getAddFavouriteMenuItem(root,courseId);setCourseFavouriteState(courseId,!0).then((function(success){success?(PubSub.publish(CourseEvents.favourited,courseId),removeAction.removeClass("hidden"),addAction.addClass("hidden"),function(root,courseId){var iconContainer=getFavouriteIconContainer(root,courseId),isFavouriteIcon=iconContainer.find(SELECTORS_ICON_IS_FAVOURITE);isFavouriteIcon.removeClass("hidden"),isFavouriteIcon.attr("aria-hidden",!1);var notFavourteIcon=iconContainer.find(SELECTORS_ICON_NOT_FAVOURITE);notFavourteIcon.addClass("hidden"),notFavourteIcon.attr("aria-hidden",!0)}(root,courseId)):Notification.alert("Starring course failed","Could not change favourite state")})).catch(Notification.exception)},removeFromFavourites=function(root,courseId){var removeAction=getRemoveFavouriteMenuItem(root,courseId),addAction=getAddFavouriteMenuItem(root,courseId);setCourseFavouriteState(courseId,!1).then((function(success){success?(PubSub.publish(CourseEvents.unfavorited,courseId),removeAction.addClass("hidden"),addAction.removeClass("hidden"),function(root,courseId){var iconContainer=getFavouriteIconContainer(root,courseId),isFavouriteIcon=iconContainer.find(SELECTORS_ICON_IS_FAVOURITE);isFavouriteIcon.addClass("hidden"),isFavouriteIcon.attr("aria-hidden",!0);var notFavourteIcon=iconContainer.find(SELECTORS_ICON_NOT_FAVOURITE);notFavourteIcon.removeClass("hidden"),notFavourteIcon.attr("aria-hidden",!1)}(root,courseId)):Notification.alert("Starring course failed","Could not change favourite state")})).catch(Notification.exception)},getHideCourseMenuItem=function(root,courseId){return root.find('[data-action="hide-course"][data-course-id="'+courseId+'"]')},getShowCourseMenuItem=function(root,courseId){return root.find('[data-action="show-course"][data-course-id="'+courseId+'"]')},setCourseHiddenState=function(courseId,status){return!1===status&&(status=null),Repository.updateUserPreferences({preferences:[{type:"block_myoverview_hidden_course_"+courseId,value:status}]})},hideElement=function(root,id){var pagingBar=root.find('[data-region="paging-bar"]'),jumpto=parseInt(pagingBar.attr("data-active-page-number")),reducedCourse=loadedPages[jumpto].courses.reduce((function(accumulator,current){return id!=current.id&&accumulator.push(current),accumulator}),[]);if(null!=loadedPages[jumpto+1]){var newElement=loadedPages[jumpto+1].courses.slice(0,1);loadedPages.forEach((function(courseList,index){if(index>jumpto){var popElement=[];null!=loadedPages[index+1]&&(popElement=loadedPages[index+1].courses.slice(0,1)),loadedPages[index].courses=$.merge(loadedPages[index].courses.slice(1),popElement)}})),reducedCourse=$.merge(reducedCourse,newElement)}if(lastPage==jumpto+1&&0==loadedPages[jumpto+1].courses.length){var pagedContentContainer=root.find('[data-region="paged-content-container"]');PagedContentFactory.resetLastPageNumber($(pagedContentContainer).attr("id"),jumpto)}loadedPages[jumpto].courses=reducedCourse,courseOffset--;var pagedContentPage=getPagedContentContainer(root,jumpto);renderCourses(root,loadedPages[jumpto]).then((function(html,js){return Templates.replaceNodeContents(pagedContentPage,html,js)})).catch(Notification.exception),loadedPages.forEach((function(courseList,index){index>jumpto&&getPagedContentContainer(root,index).remove()}))},setCourseFavouriteState=function(courseId,status){return Repository.setFavouriteCourses({courses:[{id:courseId,favourite:status}]}).then((function(result){return 0==result.warnings.length&&(loadedPages.forEach((function(courseList){courseList.courses.forEach((function(course,index){course.id==courseId&&(courseList.courses[index].isfavourite=status)}))})),!0)})).catch(Notification.exception)},renderCourses=function(root,coursesData){var filters=getFilterValues(root),currentTemplate="";if(currentTemplate="card"==filters.display?TEMPLATES_COURSES_CARDS:"list"==filters.display?TEMPLATES_COURSES_LIST:TEMPLATES_COURSES_SUMMARY,coursesData.courses=coursesData.courses.map((function(course){return course.showcoursecategory="on"==filters.displaycategories,course})),coursesData.courses.length)return Templates.render(currentTemplate,{courses:coursesData.courses});var nocoursesimg=root.find(Selectors.courseView.region).attr("data-nocoursesimg");return Templates.render(TEMPLATES_NOCOURSES,{nocoursesimg:nocoursesimg})},setLimit=function(limit){this.find(Selectors.courseView.region).attr("data-paging",limit)},registerPagedEventHandlers=function(root,namespace){var event=namespace+PagedContentEvents.SET_ITEMS_PER_PAGE_LIMIT;PubSub.subscribe(event,setLimit.bind(root))},initializePagedContent=function(root){namespace="block_myoverview_"+root.attr("id")+"_"+Math.random();var pagingLimit=parseInt(root.find(Selectors.courseView.region).attr("data-paging"),10),itemsPerPage=NUMCOURSES_PERPAGE.map((function(value){var active=!1;return value==pagingLimit&&(active=!0),{value:value,active:active}})),totalCourseCount=parseInt(root.find(Selectors.courseView.region).attr("data-totalcoursecount"),10);itemsPerPage=itemsPerPage.filter((function(pagingOption){return pagingOption.value<totalCourseCount||0===pagingOption.value}));var filters=getFilterValues(root),config=$.extend({},DEFAULT_PAGED_CONTENT_CONFIG);config.eventNamespace=namespace;var pagedContentPromise=PagedContentFactory.createWithLimit(itemsPerPage,(function(pagesData,actions){var promises=[];return pagesData.forEach((function(pageData){var currentPage=pageData.pageNumber,limit=pageData.limit>0?pageData.limit:0;if(lastLimit!=limit&&(loadedPages=[],courseOffset=0,lastPage=0),lastPage==currentPage)return actions.allItemsLoaded(lastPage),void promises.push(renderCourses(root,loadedPages[currentPage]));lastLimit=limit,null==loadedPages[currentPage+1]&&null==loadedPages[currentPage]&&(limit*=2);var pagePromise=function(filters,limit){return Repository.getEnrolledCoursesByTimeline({offset:courseOffset,limit:limit,classification:filters.grouping,sort:filters.sort,customfieldname:filters.customfieldname,customfieldvalue:filters.customfieldvalue})}(filters,limit).then((function(coursesData){var courses=coursesData.courses,nextPageStart=0,pageCourses=[];if(null!=loadedPages[currentPage]){var currentPageLength=(pageCourses=loadedPages[currentPage].courses).length;currentPageLength<pageData.limit&&(nextPageStart=pageData.limit-currentPageLength,pageCourses=$.merge(loadedPages[currentPage].courses,courses.slice(0,nextPageStart)))}else nextPageStart=pageData.limit||!1,pageCourses=pageData.limit>0?courses.slice(0,pageData.limit):courses;loadedPages[currentPage]={courses:pageCourses};var remainingCourses=!1!==nextPageStart?courses.slice(nextPageStart,courses.length):[];return remainingCourses.length&&(loadedPages[currentPage+1]={courses:remainingCourses}),loadedPages[currentPage].courses.length<pageData.limit||!remainingCourses.length?(lastPage=currentPage,actions.allItemsLoaded(currentPage)):null!=loadedPages[currentPage+1]&&loadedPages[currentPage+1].courses.length<pageData.limit&&(lastPage=currentPage+1),courseOffset=coursesData.nextoffset,renderCourses(root,loadedPages[currentPage])})).catch(Notification.exception);promises.push(pagePromise)})),promises}),config);pagedContentPromise.then((function(html,js){return registerPagedEventHandlers(root,namespace),Templates.replaceNodeContents(root.find(Selectors.courseView.region),html,js)})).catch(Notification.exception)},registerEventListeners=function(root){CustomEvents.define(root,[CustomEvents.events.activate]),root.on(CustomEvents.events.activate,SELECTORS_ACTION_ADD_FAVOURITE,(function(e,data){var favourite=$(e.target).closest(SELECTORS_ACTION_ADD_FAVOURITE),courseId=getCourseId(favourite);addToFavourites(root,courseId),data.originalEvent.preventDefault()})),root.on(CustomEvents.events.activate,SELECTORS_ACTION_REMOVE_FAVOURITE,(function(e,data){var favourite=$(e.target).closest(SELECTORS_ACTION_REMOVE_FAVOURITE),courseId=getCourseId(favourite);removeFromFavourites(root,courseId),data.originalEvent.preventDefault()})),root.on(CustomEvents.events.activate,SELECTORS_FAVOURITE_ICON,(function(e,data){data.originalEvent.preventDefault()})),root.on(CustomEvents.events.activate,SELECTORS_ACTION_HIDE_COURSE,(function(e,data){var target=$(e.target).closest(SELECTORS_ACTION_HIDE_COURSE),courseId=getCourseId(target);!function(root,courseId){var hideAction=getHideCourseMenuItem(root,courseId),showAction=getShowCourseMenuItem(root,courseId),filters=getFilterValues(root);setCourseHiddenState(courseId,!0),filters.grouping!=GROUPINGS_GROUPING_ALLINCLUDINGHIDDEN&&hideElement(root,courseId),hideAction.addClass("hidden"),showAction.removeClass("hidden")}(root,courseId),data.originalEvent.preventDefault()})),root.on(CustomEvents.events.activate,SELECTORS_ACTION_SHOW_COURSE,(function(e,data){var target=$(e.target).closest(SELECTORS_ACTION_SHOW_COURSE),courseId=getCourseId(target);!function(root,courseId){var hideAction=getHideCourseMenuItem(root,courseId),showAction=getShowCourseMenuItem(root,courseId),filters=getFilterValues(root);setCourseHiddenState(courseId,null),filters.grouping!=GROUPINGS_GROUPING_ALLINCLUDINGHIDDEN&&hideElement(root,courseId),hideAction.removeClass("hidden"),showAction.addClass("hidden")}(root,courseId),data.originalEvent.preventDefault()}))},init=function(root){root=$(root),loadedPages=[],lastPage=0,courseOffset=0,initializePagedContent(root),root.attr("data-init")||(registerEventListeners(root),root.attr("data-init",!0))};return{init:init,reset:function(root){loadedPages.length>0?loadedPages.forEach((function(courseList,index){var pagedContentPage=getPagedContentContainer(root,index);renderCourses(root,courseList).then((function(html,js){return Templates.replaceNodeContents(pagedContentPage,html,js)})).catch(Notification.exception)})):init(root)}}}));
/**
 * Manage the timeline view navigation for the overview block.
 *
 * @package    block_myoverview
 * @copyright  2018 Bas Brands <bas@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_myoverview/view_nav",["jquery","core/custom_interaction_events","block_myoverview/repository","block_myoverview/view","block_myoverview/selectors"],(function($,CustomEvents,Repository,View,Selectors){var SELECTORS_FILTERS='[data-region="filter"]',SELECTORS_FILTER_OPTION="[data-filter]",SELECTORS_DISPLAY_OPTION="[data-display-option]",updatePreferences=function(filter,value){var type=null;type="display"==filter?"block_myoverview_user_view_preference":"sort"==filter?"block_myoverview_user_sort_preference":"customfieldvalue"==filter?"block_myoverview_user_grouping_customfieldvalue_preference":"block_myoverview_user_grouping_preference",Repository.updateUserPreferences({preferences:[{type:type,value:value}]})};return{init:function(root){!function(root){var Selector=root.find(SELECTORS_FILTERS);CustomEvents.define(Selector,[CustomEvents.events.activate]),Selector.on(CustomEvents.events.activate,SELECTORS_FILTER_OPTION,(function(e,data){var option=$(e.target);if(!option.hasClass("active")){var filter=option.attr("data-filter"),pref=option.attr("data-pref"),customfieldvalue=option.attr("data-customfieldvalue");root.find(Selectors.courseView.region).attr("data-"+filter,option.attr("data-value")),updatePreferences(filter,pref),customfieldvalue&&(root.find(Selectors.courseView.region).attr("data-customfieldvalue",customfieldvalue),updatePreferences("customfieldvalue",customfieldvalue)),View.init(root),data.originalEvent.preventDefault()}})),CustomEvents.define(Selector,[CustomEvents.events.activate]),Selector.on(CustomEvents.events.activate,SELECTORS_DISPLAY_OPTION,(function(e,data){var option=$(e.target);if(!option.hasClass("active")){var filter=option.attr("data-display-option"),pref=option.attr("data-pref");root.find(Selectors.courseView.region).attr("data-display",option.attr("data-value")),updatePreferences(filter,pref),View.reset(root),data.originalEvent.preventDefault()}}))}(root=$(root))}}}));
/**
 * Javascript to initialise the selectors for the myoverview block.
 *
 * @package    block_myoverview
 * @copyright  2018 Peter Dias <peter@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_myoverview/selectors",[],(function(){return{courseView:{region:'[data-region="courses-view"]',regionContent:'[data-region="course-view-content"]'}}}));
/**
 * A javascript module to retrieve enrolled coruses from the server.
 *
 * @package    block_myoverview
 * @copyright  2018 Bas Brands <base@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_myoverview/repository",["core/ajax","core/notification"],(function(Ajax,Notification){return{getEnrolledCoursesByTimeline:function(args){var request={methodname:"core_course_get_enrolled_courses_by_timeline_classification",args:args};return Ajax.call([request])[0]},setFavouriteCourses:function(args){var request={methodname:"core_course_set_favourite_courses",args:args};return Ajax.call([request])[0]},updateUserPreferences:function(args){var request={methodname:"core_user_update_user_preferences",args:args};Ajax.call([request])[0].fail(Notification.exception)}}}));
/**
 * Load the site admin nav tree via ajax and render the response.
 *
 * @module     block_navigation/site_admin_loader
 * @package    core
 * @copyright  2015 John Okely <john@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_navigation/site_admin_loader",["jquery","core/ajax","core/config","block_navigation/ajax_response_renderer"],(function($,ajax,config,renderer){var URL=config.wwwroot+"/lib/ajax/getsiteadminbranch.php";return{load:function(element){element=$(element);var promise=$.Deferred(),settings={type:"POST",dataType:"json",data:{type:71,sesskey:config.sesskey}};return $.ajax(URL,settings).done((function(nodes){renderer.render(element,nodes),promise.resolve()})),promise}}}));
/**
 * Load the navigation tree javascript.
 *
 * @module     block_navigation/navblock
 * @package    core
 * @copyright  2015 John Okely <john@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_navigation/navblock",["jquery","core/tree"],(function($,Tree){return{init:function(instanceid){var navTree=new Tree(".block_navigation .block_tree");navTree.finishExpandingGroup=function(item){Tree.prototype.finishExpandingGroup.call(this,item),Y.use("moodle-core-event",(function(){Y.Global.fire(M.core.globalEvents.BLOCK_CONTENT_UPDATED,{instanceid:instanceid})}))},navTree.collapseGroup=function(item){Tree.prototype.collapseGroup.call(this,item),Y.use("moodle-core-event",(function(){Y.Global.fire(M.core.globalEvents.BLOCK_CONTENT_UPDATED,{instanceid:instanceid})}))}}}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)
/**
 * Parse the response from the navblock ajax page and render the correct DOM
 * structure for the tree from it.
 *
 * @module     block_navigation/ajax_response_renderer
 * @package    core
 * @copyright  2015 John Okely <john@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */}define("block_navigation/ajax_response_renderer",["jquery","core/templates","core/notification","core/url"],(function($,Templates,Notification,Url){var NODETYPE_ACTIVITY=40,NODETYPE_RESOURCE=50;function buildDOM(rootElement,nodes){var ul=$("<ul></ul>");ul.attr("role","group"),ul.attr("aria-hidden",!0),$.each(nodes,(function(index,node){if("object"===_typeof(node)){var li=$("<li></li>"),p=$("<p></p>"),id=node.id||node.key+"_tree_item",icon=null,isBranch=!(!node.expandable&&!node.haschildren);p.addClass("tree_item"),p.attr("id",id),p.attr("role","treeitem"),p.attr("tabindex","-1"),node.requiresajaxloading&&(p.attr("data-requires-ajax",!0),p.attr("data-node-id",node.id),p.attr("data-node-key",node.key),p.attr("data-node-type",node.type)),isBranch&&(li.addClass("collapsed contains_branch"),p.attr("aria-expanded",!1),p.addClass("branch"));var eleToAddIcon=null;if(node.link){var link=$('<a title="'+node.title+'" href="'+node.link+'"></a>');eleToAddIcon=link,link.append('<span class="item-content-wrap">'+node.name+"</span>"),node.hidden&&link.addClass("dimmed"),p.append(link)}else{var span=$("<span></span>");eleToAddIcon=span,span.append('<span class="item-content-wrap">'+node.name+"</span>"),node.hidden&&span.addClass("dimmed"),p.append(span)}!node.icon||isBranch&&node.type!==NODETYPE_ACTIVITY&&node.type!==NODETYPE_RESOURCE||(li.addClass("item_with_icon"),p.addClass("hasicon"),node.type===NODETYPE_ACTIVITY||node.type===NODETYPE_RESOURCE?((icon=$("<img/>")).attr("alt",node.icon.alt),icon.attr("title",node.icon.title),icon.attr("src",Url.imageUrl(node.icon.pix,node.icon.component)),$.each(node.icon.classes,(function(index,className){icon.addClass(className)})),eleToAddIcon.prepend(icon)):("moodle"==node.icon.component&&(node.icon.component="core"),Templates.renderPix(node.icon.pix,node.icon.component,node.icon.title).then((function(html){eleToAddIcon.prepend(html)})).catch(Notification.exception))),li.append(p),ul.append(li),node.children&&node.children.length?buildDOM(p,node.children):isBranch&&!node.requiresajaxloading&&(li.removeClass("contains_branch"),p.addClass("emptybranch"))}})),rootElement.parent().append(ul);var id=rootElement.attr("id")+"_group";ul.attr("id",id),rootElement.attr("aria-owns",id),rootElement.attr("role","treeitem")}return{render:function(element,nodes){if(nodes.children&&nodes.children.length){buildDOM(element,nodes.children);var item=element.children("[role='treeitem']").first(),group=element.find("#"+item.attr("aria-owns"));item.attr("aria-expanded",!0),group.attr("aria-hidden",!1)}else element.parent().hasClass("contains_branch")&&(element.parent().removeClass("contains_branch"),element.addClass("emptybranch"))}}}));
/**
 * Load the nav tree items via ajax and render the response.
 *
 * @module     block_navigation/nav_loader
 * @package    core
 * @copyright  2015 John Okely <john@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_navigation/nav_loader",["jquery","core/ajax","core/config","block_navigation/ajax_response_renderer"],(function($,ajax,config,renderer){var URL=config.wwwroot+"/lib/ajax/getnavbranch.php";function getBlockInstanceId(element){return element.closest("[data-block]").attr("data-instanceid")}return{load:function(element){element=$(element);var promise=$.Deferred(),settings={type:"POST",dataType:"json",data:{elementid:element.attr("data-node-id"),id:element.attr("data-node-key"),type:element.attr("data-node-type"),sesskey:config.sesskey,instance:getBlockInstanceId(element)}};return $.ajax(URL,settings).done((function(nodes){renderer.render(element,nodes),promise.resolve()})),promise}}}));
/**
 * A javascript module that handles the change of the user's visibility in the
 * online users block.
 *
 * @module     block_online_users/change_user_visibility
 * @package    block_online_users
 * @copyright  2018 Mihail Geshoski <mihail@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_online_users/change_user_visibility",["jquery","core/ajax","core/str","core/notification"],(function($,Ajax,Str,Notification){var SELECTORS_CHANGE_VISIBILITY_LINK="#change-user-visibility",SELECTORS_CHANGE_VISIBILITY_ICON="#change-user-visibility .icon",oppositeAction=function(action){return"show"==action?"hide":"show"},changeVisibilityLinkAttr=function(action){getTitle(action).then((function(title){$(SELECTORS_CHANGE_VISIBILITY_LINK).attr({"data-action":action,title:title})})).catch(Notification.exception)},changeVisibilityIconAttr=function(action){var icon=$(SELECTORS_CHANGE_VISIBILITY_ICON);getTitle(action).then((function(title){$(icon).attr({title:title,"aria-label":title}),icon.is("img")?$(icon).attr({src:M.util.image_url("t/"+action),alt:title}):($(icon).addClass(getIconClass(action)),$(icon).removeClass(getIconClass(oppositeAction(action))))})).catch(Notification.exception)},getIconClass=function(action){return"show"==action?"fa-eye-slash":"fa-eye"},getTitle=function(action){return Str.get_string("online_status:"+action,"block_online_users")};return{init:function(){$(SELECTORS_CHANGE_VISIBILITY_LINK).on("click",(function(e){e.preventDefault(),function(action,userid){var request={methodname:"core_user_set_user_preferences",args:{preferences:[{name:"block_online_users_uservisibility",value:"show"==action?1:0,userid:userid}]}};Ajax.call([request])[0].then((function(data){if(data.saved){var newAction=oppositeAction(action);changeVisibilityLinkAttr(newAction),changeVisibilityIconAttr(newAction)}})).catch(Notification.exception)}($(this).attr("data-action"),$(this).attr("data-userid"))}))}}}));
define('block_quickmail/compose', ['jquery'], function($) {
    let addBtn = $('#id_add_recip');
    let removeBtn = $('#id_remove_recip');
    let availablesSelect = $('#id_available_included_entity_ids');
    let selectedsSelect = $('#id_selected_included_entity_ids');
    
    let syncSelected = function() {
        $('[name="included_entity_ids"]').val('');

        let entities = [];
        $('#id_selected_included_entity_ids option').each(function() {
            entities.push($(this).val());
        });

        $('[name="included_entity_ids"]').val(entities);
    }

    return {
        init: function() {
            addBtn.click(function() {
                $('#id_available_included_entity_ids option:selected').remove().appendTo(selectedsSelect);
                $('#id_selected_included_entity_ids option:selected').prop('selected', false);
                syncSelected();
            });

            removeBtn.click(function() {
                $('#id_selected_included_entity_ids option:selected').remove().appendTo(availablesSelect);
                $('#id_available_included_entity_ids option:selected').prop('selected', false);
                syncSelected();
            });
        }
    };
});
/**
 * Javascript to initialise the Recently accessed courses block.
 *
 * @module     block_recentlyaccessedcourses/main.js
 * @package    block_recentlyaccessedcourses
 * @copyright  2018 Victor Deniz <victor@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_recentlyaccessedcourses/main",["jquery","core/custom_interaction_events","core/notification","core/pubsub","core/paged_content_paging_bar","core/templates","core_course/events","core_course/repository"],(function($,CustomEvents,Notification,PubSub,PagedContentPagingBar,Templates,CourseEvents,CoursesRepository){var SELECTORS_BLOCK_CONTAINER='[data-region="recentlyaccessedcourses"]',SELECTORS_CARD_CONTAINER='[data-region="card-deck"]',SELECTORS_COURSE_IS_FAVOURITE='[data-region="is-favourite"]',SELECTORS_CONTENT='[data-region="view-content"]',SELECTORS_EMPTY_MESSAGE='[data-region="empty-message"]',SELECTORS_LOADING_PLACEHOLDER='[data-region="loading-placeholder"]',SELECTORS_PAGING_BAR='[data-region="paging-bar"]',SELECTORS_PAGING_BAR_NEXT='[data-control="next"]',SELECTORS_PAGING_BAR_PREVIOUS='[data-control="previous"]',contentLoaded=!1,allCourses=[],visibleCoursesId=null,cardWidth=null,viewIndex=0,availableVisibleCards=1,loadContent=function(userid){return CoursesRepository.getLastAccessedCourses(userid,10).then((function(courses){return function(courses){var showcoursecategory=$(SELECTORS_BLOCK_CONTAINER).data("displaycoursecategory"),promises=courses.map((function(course){return course.showcoursecategory=showcoursecategory,Templates.render("block_recentlyaccessedcourses/course-card",course)}));return $.when.apply(null,promises).then((function(){var renderedCourses=[];return promises.forEach((function(promise){promise.then((function(html){renderedCourses.push($(html))})).catch(Notification.exception)})),renderedCourses}))}(courses)}))},recalculateVisibleCourses=function(root){var container=root.find(SELECTORS_CONTENT).find(SELECTORS_CARD_CONTAINER),availableWidth=parseFloat(root.css("width")),numberOfCourses=allCourses.length,start=0;(cardWidth||(container.html(allCourses[0]),cardWidth=allCourses[0].outerWidth(!0)),availableVisibleCards=Math.floor(availableWidth/cardWidth),viewIndex+availableVisibleCards<numberOfCourses)?start=viewIndex:start=(start=viewIndex-(viewIndex+availableVisibleCards-numberOfCourses))>=0?start:0;0===availableVisibleCards&&(availableVisibleCards=1);var coursesToShow=allCourses.slice(start,start+availableVisibleCards),newVisibleCoursesId=coursesToShow.reduce((function(carry,course){return carry+course.attr("data-course-id")}),"");if(allCourses.length>coursesToShow.length?(container.addClass("justify-content-center"),container.removeClass("justify-content-start")):(container.removeClass("justify-content-center"),container.addClass("justify-content-start")),visibleCoursesId!=newVisibleCoursesId){var pagingBar=root.find(PagedContentPagingBar.rootSelector);container.html(coursesToShow),visibleCoursesId=newVisibleCoursesId,availableVisibleCards>=allCourses.length?function(root){var pagingBar=root.find(SELECTORS_PAGING_BAR);pagingBar.css("opacity",0),pagingBar.css("visibility","hidden"),pagingBar.attr("aria-hidden","true")}(root):(!function(root){var pagingBar=root.find(SELECTORS_PAGING_BAR);pagingBar.css("opacity",1),pagingBar.css("visibility","visible"),pagingBar.attr("aria-hidden","false")}(root),0===viewIndex?PagedContentPagingBar.disablePreviousControlButtons(pagingBar):PagedContentPagingBar.enablePreviousControlButtons(pagingBar),viewIndex+availableVisibleCards>=allCourses.length?PagedContentPagingBar.disableNextControlButtons(pagingBar):PagedContentPagingBar.enableNextControlButtons(pagingBar))}},registerEventListeners=function(root){var resizeTimeout=null,drawerToggling=!1;PubSub.subscribe(CourseEvents.favourited,(function(courseId){!function(root,courseId){allCourses.forEach((function(course){course.attr("data-course-id")==courseId&&course.find(SELECTORS_COURSE_IS_FAVOURITE).removeClass("hidden")}))}(0,courseId)})),PubSub.subscribe(CourseEvents.unfavorited,(function(courseId){!function(root,courseId){allCourses.forEach((function(course){course.attr("data-course-id")==courseId&&course.find(SELECTORS_COURSE_IS_FAVOURITE).addClass("hidden")}))}(0,courseId)})),PubSub.subscribe("nav-drawer-toggle-start",(function(){if(contentLoaded&&allCourses.length&&!drawerToggling){drawerToggling=!0;var recalculationCount=0;!function doRecalculation(){setTimeout((function(){recalculateVisibleCourses(root),++recalculationCount<5&&drawerToggling&&doRecalculation()}),100)}()}})),PubSub.subscribe("nav-drawer-toggle-end",(function(){drawerToggling=!1})),$(window).on("resize",(function(){contentLoaded&&allCourses.length&&(resizeTimeout||(resizeTimeout=setTimeout((function(){resizeTimeout=null,recalculateVisibleCourses(root)}),66)))})),CustomEvents.define(root,[CustomEvents.events.activate]),root.on(CustomEvents.events.activate,SELECTORS_PAGING_BAR_NEXT,(function(e,data){$(e.target).closest(SELECTORS_PAGING_BAR_NEXT).hasClass("disabled")||(viewIndex+=availableVisibleCards,recalculateVisibleCourses(root)),data.originalEvent.preventDefault()})),root.on(CustomEvents.events.activate,SELECTORS_PAGING_BAR_PREVIOUS,(function(e,data){$(e.target).closest(SELECTORS_PAGING_BAR_PREVIOUS).hasClass("disabled")||(viewIndex=(viewIndex-=availableVisibleCards)<0?0:viewIndex,recalculateVisibleCourses(root)),data.originalEvent.preventDefault()}))};return{init:function(userid,root){root=$(root),registerEventListeners(root),loadContent(userid).then((function(renderedCourses){contentLoaded=!0,(allCourses=renderedCourses).length?(!function(root){root.find(SELECTORS_CONTENT).removeClass("hidden"),root.find(SELECTORS_EMPTY_MESSAGE).addClass("hidden"),root.find(SELECTORS_LOADING_PLACEHOLDER).addClass("hidden")}(root),recalculateVisibleCourses(root)):function(root){root.find(SELECTORS_EMPTY_MESSAGE).removeClass("hidden"),root.find(SELECTORS_LOADING_PLACEHOLDER).addClass("hidden"),root.find(SELECTORS_CONTENT).addClass("hidden")}(root)})).catch(Notification.exception)}}}));
/**
 * Javascript to initialise the Recently accessed items block.
 *
 * @module     block_recentlyaccesseditems/main
 * @package    block_recentlyaccesseditems
 * @copyright  2018 Victor Deniz <victor@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_recentlyaccesseditems/main",["jquery","block_recentlyaccesseditems/repository","core/templates","core/notification"],(function($,Repository,Templates,Notification){var SELECTORS_CARDDECK_CONTAINER='[data-region="recentlyaccesseditems-view"]',SELECTORS_CARDDECK='[data-region="recentlyaccesseditems-view-content"]';return{init:function(root){var limit,itemsContainer=(root=$(root)).find(SELECTORS_CARDDECK_CONTAINER),itemsContent=root.find(SELECTORS_CARDDECK),itemsPromise=(limit=9,Repository.getRecentItems(limit));itemsPromise.then((function(items){var pageContentPromise=function(root,items){if(items.length>0)return Templates.render("block_recentlyaccesseditems/view-cards",{items:items});var noitemsimgurl=root.attr("data-noitemsimgurl");return Templates.render("block_recentlyaccesseditems/no-items",{noitemsimgurl:noitemsimgurl})}(itemsContainer,items);return pageContentPromise.then((function(html,js){return Templates.replaceNodeContents(itemsContent,html,js)})).catch(Notification.exception),itemsPromise})).catch(Notification.exception)}}}));
/**
 * A javascript module to handle user ajax actions.
 *
 * @module     block_recentlyaccesseditems/repository
 * @package    block_recentlyaccesseditems
 * @copyright  2018 Victor Deniz <victor@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_recentlyaccesseditems/repository",["core/ajax"],(function(Ajax){return{getRecentItems:function(limit){var args={};void 0!==limit&&(args.limit=limit);var request={methodname:"block_recentlyaccesseditems_get_recent_items",args:args};return Ajax.call([request])[0]}}}));
/**
 * Load the settings block tree javscript
 *
 * @module     block_settings/settingsblock
 * @package    core
 * @copyright  2015 John Okely <john@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_settings/settingsblock",["jquery","core/tree"],(function($,Tree){return{init:function(instanceid,siteAdminNodeId){var adminTree=new Tree(".block_settings .block_tree");if(siteAdminNodeId){var siteAdminLink=adminTree.treeRoot.find("#"+siteAdminNodeId).children("a").first();siteAdminLink.replaceWith('<span tabindex="0">'+siteAdminLink.html()+"</span>")}adminTree.finishExpandingGroup=function(item){Tree.prototype.finishExpandingGroup.call(this,item),Y.use("moodle-core-event",(function(){Y.Global.fire(M.core.globalEvents.BLOCK_CONTENT_UPDATED,{instanceid:instanceid})}))},adminTree.collapseGroup=function(item){Tree.prototype.collapseGroup.call(this,item),Y.use("moodle-core-event",(function(){Y.Global.fire(M.core.globalEvents.BLOCK_CONTENT_UPDATED,{instanceid:instanceid})}))}}}}));
/**
 * Javascript to initialise the starred courses block.
 *
 * @copyright   2018 Simey Lameze <simey@moodle.com>
 * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_starredcourses/main",["jquery","core/notification","block_starredcourses/repository","core/pubsub","core/templates","core_course/events"],(function($,Notification,Repository,PubSub,Templates,CourseEvents){var SELECTORS_BLOCK_CONTAINER='[data-region="starred-courses"]',SELECTORS_STARRED_COURSES_REGION_VIEW='[data-region="starred-courses-view"]',SELECTORS_STARRED_COURSES_REGION='[data-region="starred-courses-view-content"]',reloadContent=function(root){var content=root.find(SELECTORS_STARRED_COURSES_REGION);return Repository.getStarredCourses({limit:0,offset:0}).then((function(courses){var showcoursecategory=$(SELECTORS_BLOCK_CONTAINER).data("displaycoursecategory");return courses=courses.map((function(course){return course.showcoursecategory=showcoursecategory,course})),function(root,courses){if(courses.length>0)return Templates.render("core_course/view-cards",{courses:courses});var nocoursesimg=root.find(SELECTORS_STARRED_COURSES_REGION_VIEW).attr("data-nocoursesimg");return Templates.render("block_starredcourses/no-courses",{nocoursesimg:nocoursesimg})}(root,courses)})).then((function(html,js){return Templates.replaceNodeContents(content,html,js)})).catch(Notification.exception)};return{init:function(root){(function(root){PubSub.subscribe(CourseEvents.favourited,(function(){reloadContent(root)})),PubSub.subscribe(CourseEvents.unfavorited,(function(){reloadContent(root)}))})(root=$(root)),reloadContent(root)}}}));
/**
 * A javascript module to retrieve user's starred courses.
 *
 * @package    block_starredcourses
 * @copyright  2018 Simey Lameze <simey@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_starredcourses/repository",["jquery","core/ajax","core/notification"],(function($,Ajax,Notification){return{getStarredCourses:function(args){var request={methodname:"block_starredcourses_get_starred_courses",args:args},promise=Ajax.call([request])[0];return promise.fail(Notification.exception),promise}}}));
/**
 * Javascript to load and render the list of calendar events for a
 * given day range.
 *
 * @module     block_timeline/event_list
 * @package    block_timeline
 * @copyright  2016 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_timeline/event_list",["jquery","core/notification","core/templates","core/paged_content_factory","core/str","core/user_date","block_timeline/calendar_events_repository"],(function($,Notification,Templates,PagedContentFactory,Str,UserDate,CalendarEventsRepository){var SELECTORS_EMPTY_MESSAGE='[data-region="empty-message"]',SELECTORS_EVENT_LIST_CONTENT='[data-region="event-list-content"]',SELECTORS_EVENT_LIST_LOADING_PLACEHOLDER='[data-region="event-list-loading-placeholder"]',TEMPLATES_EVENT_LIST_CONTENT="block_timeline/event-list-content",DEFAULT_PAGED_CONTENT_CONFIG={ignoreControlWhileLoading:!0,controlPlacementBottom:!0,ariaLabels:{itemsperpagecomponents:"ariaeventlistpagelimit, block_timeline"}},render=function(calendarEvents,midnight){var templateContext=function(calendarEvents,midnight){var eventsByDay={},templateContext={eventsbyday:[]};return calendarEvents.forEach((function(calendarEvent){var dayTimestamp=UserDate.getUserMidnightForTimestamp(calendarEvent.timesort,midnight);eventsByDay[dayTimestamp]?eventsByDay[dayTimestamp].push(calendarEvent):eventsByDay[dayTimestamp]=[calendarEvent]})),Object.keys(eventsByDay).forEach((function(dayTimestamp){var events=eventsByDay[dayTimestamp];templateContext.eventsbyday.push({past:dayTimestamp<midnight,dayTimestamp:dayTimestamp,events:events})})),templateContext}(calendarEvents,midnight),templateName=TEMPLATES_EVENT_LIST_CONTENT;return Templates.render(templateName,templateContext)},loadEventsFromPageData=function(pageData,actions,midnight,lastIds,preloadedPages,courseId,daysOffset,daysLimit){for(var pageNumber=pageData.pageNumber,limit=pageData.limit,lastPageNumber=pageNumber;!lastIds.hasOwnProperty(lastPageNumber);)lastPageNumber--;var lastId=lastIds[lastPageNumber],eventsPromise=null;return eventsPromise=preloadedPages&&preloadedPages.hasOwnProperty(pageNumber)?preloadedPages[pageNumber]:function(midnight,limit,daysOffset,daysLimit,lastId,courseId){var endTime=null!=daysLimit&&midnight+86400*daysLimit,args={starttime:midnight+86400*daysOffset,limit:limit};return lastId&&(args.aftereventid=lastId),endTime&&(args.endtime=endTime),courseId?(args.courseid=courseId,CalendarEventsRepository.queryByCourse(args)):CalendarEventsRepository.queryByTime(args)}(midnight,limit+1,daysOffset,daysLimit,lastId,courseId),eventsPromise.then((function(result){if(!result.events.length)return actions.allItemsLoaded(pageNumber),[];var calendarEvents=result.events.filter((function(event){return"open"!=event.eventtype&&"opensubmission"!=event.eventtype||UserDate.getUserMidnightForTimestamp(event.timesort,midnight)>midnight}));return calendarEvents.length<=limit?actions.allItemsLoaded(pageNumber):calendarEvents.pop(),calendarEvents}))};return{init:function(root,pageLimit,preloadedPages,paginationAriaLabel,additionalConfig){root=$(root);var firstLoad=$.Deferred(),eventListContent=root.find(SELECTORS_EVENT_LIST_CONTENT),loadingPlaceholder=root.find(SELECTORS_EVENT_LIST_LOADING_PLACEHOLDER),courseId=root.attr("data-course-id"),daysOffset=parseInt(root.attr("data-days-offset"),10),daysLimit=root.attr("data-days-limit"),midnight=parseInt(root.attr("data-midnight"),10);return function(root){root.find(SELECTORS_EVENT_LIST_CONTENT).empty()}(root),function(root){root.find(SELECTORS_EVENT_LIST_CONTENT).removeClass("hidden"),root.find(SELECTORS_EMPTY_MESSAGE).addClass("hidden")}(root),loadingPlaceholder.removeClass("hidden"),null!=daysLimit&&(daysLimit=parseInt(daysLimit,10)),function(pageLimit,preloadedPages,midnight,firstLoad,courseId,daysOffset,daysLimit,paginationAriaLabel,additionalConfig){var lastIds={1:0},hasContent=!1,config=$.extend({},DEFAULT_PAGED_CONTENT_CONFIG,additionalConfig);return Str.get_string("ariaeventlistpagelimit","block_timeline",$.isArray(pageLimit)?pageLimit[0].value:pageLimit).then((function(string){return config.ariaLabels.itemsperpage=string,config.ariaLabels.paginationnav=paginationAriaLabel,string})).then((function(){return PagedContentFactory.createWithLimit(pageLimit,(function(pagesData,actions){var promises=[];return pagesData.forEach((function(pageData){var pageNumber=pageData.pageNumber,pagePromise=loadEventsFromPageData(pageData,actions,midnight,lastIds,preloadedPages,courseId,daysOffset,daysLimit).then((function(calendarEvents){if(calendarEvents.length){hasContent=!0;var lastEventId=calendarEvents[calendarEvents.length-1].id;return lastIds[pageNumber+1]=lastEventId,render(calendarEvents,midnight)}return calendarEvents})).catch(Notification.exception);promises.push(pagePromise)})),$.when.apply($,promises).then((function(){firstLoad.resolve(hasContent)})).catch((function(){firstLoad.resolve(hasContent)})),promises}),config)}))}(pageLimit,preloadedPages,midnight,firstLoad,courseId,daysOffset,daysLimit,paginationAriaLabel,additionalConfig).then((function(html,js){return(html=$(html)).addClass("hidden"),Templates.replaceNodeContents(eventListContent,html,js),firstLoad.then((function(hasContent){return html.removeClass("hidden"),loadingPlaceholder.addClass("hidden"),hasContent||function(root){root.find(SELECTORS_EVENT_LIST_CONTENT).addClass("hidden"),root.find(SELECTORS_EMPTY_MESSAGE).removeClass("hidden")}(root),hasContent})).catch((function(){return!1})),html})).catch(Notification.exception)},rootSelector:'[data-region="event-list-container"]'}}));
/**
 * Javascript to initialise the timeline block.
 *
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_timeline/main",["jquery","block_timeline/view_nav","block_timeline/view"],(function($,ViewNav,View){var SELECTORS_TIMELINE_VIEW='[data-region="timeline-view"]';return{init:function(root){var viewRoot=(root=$(root)).find(SELECTORS_TIMELINE_VIEW);ViewNav.init(root,viewRoot),View.init(viewRoot)}}}));
/**
 * Manage the timeline view for the timeline block.
 *
 * @package    block_timeline
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_timeline/view",["jquery","block_timeline/view_dates","block_timeline/view_courses"],(function($,ViewDates,ViewCourses){var SELECTORS_TIMELINE_DATES_VIEW='[data-region="view-dates"]',SELECTORS_TIMELINE_COURSES_VIEW='[data-region="view-courses"]';return{init:function(root){var datesViewRoot=(root=$(root)).find(SELECTORS_TIMELINE_DATES_VIEW),coursesViewRoot=root.find(SELECTORS_TIMELINE_COURSES_VIEW);ViewDates.init(datesViewRoot),ViewCourses.init(coursesViewRoot)},reset:function(root){var datesViewRoot=root.find(SELECTORS_TIMELINE_DATES_VIEW),coursesViewRoot=root.find(SELECTORS_TIMELINE_COURSES_VIEW);ViewDates.reset(datesViewRoot),ViewCourses.reset(coursesViewRoot)},shown:function(root){var datesViewRoot=root.find(SELECTORS_TIMELINE_DATES_VIEW),coursesViewRoot=root.find(SELECTORS_TIMELINE_COURSES_VIEW);datesViewRoot.hasClass("active")?ViewDates.shown(datesViewRoot):ViewCourses.shown(coursesViewRoot)}}}));
/**
 * A javascript module to retrieve calendar events from the server.
 *
 * @module     block_timeline/calendar_events_repository
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_timeline/calendar_events_repository",["jquery","core/ajax","core/notification"],(function($,Ajax,Notification){return{queryByTime:function(args){args.hasOwnProperty("limit")||(args.limit=20),args.limitnum=args.limit,delete args.limit,args.hasOwnProperty("starttime")&&(args.timesortfrom=args.starttime,delete args.starttime),args.hasOwnProperty("endtime")&&(args.timesortto=args.endtime,delete args.endtime),args.limittononsuspendedevents=!0;var request={methodname:"core_calendar_get_action_events_by_timesort",args:args},promise=Ajax.call([request])[0];return promise.fail(Notification.exception),promise},queryByCourse:function(args){args.hasOwnProperty("limit")||(args.limit=20),args.limitnum=args.limit,delete args.limit,args.hasOwnProperty("starttime")&&(args.timesortfrom=args.starttime,delete args.starttime),args.hasOwnProperty("endtime")&&(args.timesortto=args.endtime,delete args.endtime);var request={methodname:"core_calendar_get_action_events_by_course",args:args},promise=Ajax.call([request])[0];return promise.fail(Notification.exception),promise},queryByCourses:function(args){args.hasOwnProperty("limit")||(args.limit=10),args.limitnum=args.limit,delete args.limit,args.hasOwnProperty("starttime")&&(args.timesortfrom=args.starttime,delete args.starttime),args.hasOwnProperty("endtime")&&(args.timesortto=args.endtime,delete args.endtime);var request={methodname:"core_calendar_get_action_events_by_courses",args:args},promise=Ajax.call([request])[0];return promise.fail(Notification.exception),promise}}}));
/**
 * Manage the timeline view navigation for the timeline block.
 *
 * @package    block_timeline
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_timeline/view_nav",["jquery","core/custom_interaction_events","block_timeline/view","core/ajax","core/notification"],(function($,CustomEvents,View,Ajax,Notification){var SELECTORS_TIMELINE_DAY_FILTER='[data-region="day-filter"]',SELECTORS_TIMELINE_DAY_FILTER_OPTION="[data-from]",SELECTORS_TIMELINE_VIEW_SELECTOR='[data-region="view-selector"]',SELECTORS_DATA_DAYS_OFFSET="[data-days-offset]",updateUserPreferences=function(type,value){var request={methodname:"core_user_update_user_preferences",args:{preferences:[{type:type,value:value}]}};Ajax.call([request])[0].fail(Notification.exception)};return{init:function(root,timelineViewRoot){(function(root,timelineViewRoot){var timelineDaySelectorContainer=root.find(SELECTORS_TIMELINE_DAY_FILTER);CustomEvents.define(timelineDaySelectorContainer,[CustomEvents.events.activate]),timelineDaySelectorContainer.on(CustomEvents.events.activate,SELECTORS_TIMELINE_DAY_FILTER_OPTION,(function(e,data){var filtername=$(e.currentTarget).data("filtername");updateUserPreferences("block_timeline_user_filter_preference",filtername);var option=$(e.target).closest(SELECTORS_TIMELINE_DAY_FILTER_OPTION);if("true"!=option.attr("aria-current")){var daysOffset=option.attr("data-from"),daysLimit=option.attr("data-to"),elementsWithDaysOffset=root.find(SELECTORS_DATA_DAYS_OFFSET);elementsWithDaysOffset.attr("data-days-offset",daysOffset),null!=daysLimit?elementsWithDaysOffset.attr("data-days-limit",daysLimit):elementsWithDaysOffset.removeAttr("data-days-limit"),View.reset(timelineViewRoot),data.originalEvent.preventDefault()}}))})(root=$(root),timelineViewRoot),function(root,timelineViewRoot){var viewSelector=root.find(SELECTORS_TIMELINE_VIEW_SELECTOR);viewSelector.on("shown shown.bs.tab",(function(e){View.shown(timelineViewRoot),$(e.target).removeClass("active")})),CustomEvents.define(viewSelector,[CustomEvents.events.activate]),viewSelector.on(CustomEvents.events.activate,"[data-toggle='tab']",(function(e){var filtername=$(e.currentTarget).data("filtername");updateUserPreferences("block_timeline_user_sort_preference",filtername)}))}(root,timelineViewRoot)}}}));
/**
 * Manage the timeline dates view for the timeline block.
 *
 * @package    block_timeline
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_timeline/view_dates",["jquery","core/str","block_timeline/event_list","core/pubsub","core/paged_content_events"],(function($,Str,EventList,PubSub,PagedContentEvents){var SELECTORS_EVENT_LIST_CONTAINER='[data-region="event-list-container"]',DEFAULT_PAGE_LIMIT=[5,10,25],load=function(root){var eventListContainer=root.find(SELECTORS_EVENT_LIST_CONTAINER),namespace=$(eventListContainer).attr("id")+"user_block_timeline"+Math.random();!function(root,namespace){var event=namespace+PagedContentEvents.SET_ITEMS_PER_PAGE_LIMIT;PubSub.subscribe(event,(function(limit){$(root).data("limit",limit)}))}(root,namespace);var limits=function(root){var limitPref=parseInt(root.data("limit"),10),isDefaultSet=!1,limits=DEFAULT_PAGE_LIMIT.map((function(value){return limitPref==value&&(isDefaultSet=!0),{value:value,active:limitPref==value}}));return isDefaultSet||(limits[0].active=!0),limits}(root),config={persistentLimitKey:"block_timeline_user_limit_preference",eventNamespace:namespace};Str.get_string("ariaeventlistpaginationnavdates","block_timeline").then((function(string){return EventList.init(eventListContainer,limits,{},string,config),string})).catch((function(){EventList.init(eventListContainer,limits,{},"",config)}))};return{init:function(root){(root=$(root)).hasClass("active")&&(load(root),root.data("seen",!0))},reset:function(root){root.removeAttr("data-seen"),root.hasClass("active")&&(load(root),root.data("seen",!0))},shown:function(root){root.data("seen")||(load(root),root.data("seen",!0))}}}));
/**
 * Manage the timeline courses view for the timeline block.
 *
 * @package    block_timeline
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_timeline/view_courses",["jquery","core/notification","core/custom_interaction_events","core/str","core/templates","block_timeline/event_list","core_course/repository","block_timeline/calendar_events_repository"],(function($,Notification,CustomEvents,Str,Templates,EventList,CourseRepository,EventsRepository){var SELECTORS_MORE_COURSES_BUTTON='[data-action="more-courses"]',SELECTORS_MORE_COURSES_BUTTON_CONTAINER='[data-region="more-courses-button-container"]',SELECTORS_NO_COURSES_EMPTY_MESSAGE='[data-region="no-courses-empty-message"]',SELECTORS_COURSES_LIST='[data-region="courses-list"]',SELECTORS_COURSE_ITEMS_LOADING_PLACEHOLDER='[data-region="course-items-loading-placeholder"]',SELECTORS_COURSE_EVENTS_CONTAINER='[data-region="course-events-container"]',SELECTORS_COURSE_NAME='[data-region="course-name"]',SELECTORS_LOADING_ICON=".loading-icon",TEMPLATES_COURSE_ITEMS="block_timeline/course-items",TEMPLATES_LOADING_ICON="core/loading",hideLoadingPlaceholder=function(root){root.find(SELECTORS_COURSE_ITEMS_LOADING_PLACEHOLDER).addClass("hidden")},disableMoreCoursesButtonLoading=function(root){var button=root.find(SELECTORS_MORE_COURSES_BUTTON);button.prop("disabled",!1),button.find(SELECTORS_LOADING_ICON).remove()},hasLoadedCourses=function(root){return root.find(SELECTORS_COURSE_EVENTS_CONTAINER).length>0},getDaysOffset=function(root){return parseInt(root.attr("data-days-offset"),10)},getDaysLimit=function(root){var daysLimit=root.attr("data-days-limit");return null!=daysLimit?parseInt(daysLimit,10):void 0},getMidnight=function(root){return parseInt(root.attr("data-midnight"),10)},getStartTime=function(root){return getMidnight(root)+86400*getDaysOffset(root)},getEndTime=function(root){var midnight=getMidnight(root),daysLimit=getDaysLimit(root);return null!=daysLimit&&midnight+86400*daysLimit},getEventsForCourseIds=function(courseIds,startTime,limit,endTime){var args={courseids:courseIds,starttime:startTime,limit:limit};return endTime&&(args.endtime=endTime),EventsRepository.queryByCourses(args)},setEventReloadTime=function(root,time){root.data("last-event-load-time",time)},hasReloadedEventsSince=function(root,time){return function(root){return root.data("last-event-load-time")}(root)>time},updateDisplayFromCourses=function(courses,root,midnight,daysOffset,daysLimit,noEventsURL){return Templates.render(TEMPLATES_COURSE_ITEMS,{courses:courses,midnight:midnight,hasdaysoffset:!0,hasdayslimit:null!=daysLimit,daysoffset:daysOffset,dayslimit:daysLimit,nodayslimit:null==daysLimit,urls:{noevents:noEventsURL}}).then((function(html){return hideLoadingPlaceholder(root),html?function(root,html){var container=root.find(SELECTORS_COURSES_LIST);Templates.appendNodeContents(container,html,"")}(root,html):hasLoadedCourses(root)||function(root){root.find(SELECTORS_NO_COURSES_EMPTY_MESSAGE).removeClass("hidden")}(root),html})).then((function(html){return courses.length<2?function(root){root.find(SELECTORS_MORE_COURSES_BUTTON_CONTAINER).addClass("hidden")}(root):function(root){root.find(SELECTORS_MORE_COURSES_BUTTON_CONTAINER).removeClass("hidden")}(root),html})).catch((function(){hideLoadingPlaceholder(root)}))},loadMoreCourses=function(root){var offset=function(root){return parseInt(root.attr("data-offset"),10)}(root),limit=function(root){return parseInt(root.attr("data-limit"),10)}(root);return CourseRepository.getEnrolledCoursesByTimelineClassification("inprogress",limit,offset,"fullname asc").then((function(result){var startEventLoadingTime=Date.now(),courses=result.courses,nextOffset=result.nextoffset,daysOffset=getDaysOffset(root),daysLimit=getDaysLimit(root),midnight=getMidnight(root),startTime=getStartTime(root),endTime=getEndTime(root),noEventsURL=root.attr("data-no-events-url");!function(root,offset){root.attr("data-offset",offset)}(root,nextOffset);var eventsPromise=function(courses,startTime,endTime){var courseIds=courses.map((function(course){return course.id}));return getEventsForCourseIds(courseIds,startTime,6,endTime)}(courses,startTime,endTime),renderPromise=updateDisplayFromCourses(courses,root,midnight,daysOffset,daysLimit,noEventsURL);return $.when(eventsPromise,renderPromise).then((function(eventsByCourse){return hasReloadedEventsSince(root,startEventLoadingTime)||courses.forEach((function(course){var courseId=course.id,events=[],containerSelector='[data-region="course-events-container"][data-course-id="'+courseId+'"]',eventListRoot=root.find(containerSelector).find(EventList.rootSelector),courseGroups=eventsByCourse.groupedbycourse.filter((function(group){return group.courseid==courseId}));courseGroups.length&&(events=courseGroups[0].events);var pageOnePreload=$.Deferred().resolve({events:events}).promise();Str.get_string("ariaeventlistpaginationnavcourses","block_timeline",course.fullnamedisplay).then((function(string){return EventList.init(eventListRoot,5,{1:pageOnePreload},string),string})).catch((function(){EventList.init(eventListRoot,5,{1:pageOnePreload})}))})),eventsByCourse}))})).catch(Notification.exception)},registerEventListeners=function(root){CustomEvents.define(root,[CustomEvents.events.activate]),root.on(CustomEvents.events.activate,SELECTORS_MORE_COURSES_BUTTON,(function(e,data){!function(root){var button=root.find(SELECTORS_MORE_COURSES_BUTTON);button.prop("disabled",!0),Templates.render(TEMPLATES_LOADING_ICON,{}).then((function(html){return button.append(html),html})).catch((function(){return!1}))}(root),loadMoreCourses(root).then((function(){disableMoreCoursesButtonLoading(root)})).catch((function(){disableMoreCoursesButtonLoading(root)})),data&&(data.originalEvent.preventDefault(),data.originalEvent.stopPropagation()),e.stopPropagation()}))},shown=function(root){root.attr("data-seen")||(hasLoadedCourses(root)?function(root){var startReloadTime=Date.now(),startTime=getStartTime(root),endTime=getEndTime(root),courseEventsContainers=root.find(SELECTORS_COURSE_EVENTS_CONTAINER),courseIds=courseEventsContainers.map((function(){return $(this).attr("data-course-id")})).get();setEventReloadTime(root,startReloadTime),getEventsForCourseIds(courseIds,startTime,6,endTime).then((function(eventsByCourse){return hasReloadedEventsSince(root,startReloadTime)||courseEventsContainers.each((function(index,container){var courseId=(container=$(container)).attr("data-course-id"),courseName=container.find(SELECTORS_COURSE_NAME).text(),eventListContainer=container.find(EventList.rootSelector),pageDeferred=$.Deferred(),events=[],courseGroups=eventsByCourse.groupedbycourse.filter((function(group){return group.courseid==courseId}));courseGroups.length&&(events=courseGroups[0].events),pageDeferred.resolve({events:events}),Str.get_string("ariaeventlistpaginationnavcourses","block_timeline",courseName).then((function(string){return EventList.init(eventListContainer,5,{1:pageDeferred.promise()},string),string})).catch((function(){EventList.init(eventListContainer,5,{1:pageDeferred.promise()})}))})),eventsByCourse})).catch(Notification.exception)}(root):loadMoreCourses(root),root.attr("data-seen",!0))};return{init:function(root){root=$(root),setEventReloadTime(root,Date.now()),root.hasClass("active")&&(loadMoreCourses(root),root.attr("data-seen",!0)),registerEventListeners(root)},reset:function(root){root.removeAttr("data-seen"),root.hasClass("active")&&shown(root)},shown:shown}}));
/**
 * Video JS loader.
 *
 * This takes care of applying the filter on content which was dynamically loaded.
 *
 * @package    media_videojs
 * @copyright  2016 Frdric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("media_videojs/loader",["jquery","core/event"],(function($,Event){var onload,notifyVideoJS=function(e,nodes){nodes.find(".mediaplugin_videojs").addBack(".mediaplugin_videojs").find("audio, video").each((function(){var id=$(this).attr("id"),config=$(this).data("setup-lazy"),modules=["media_videojs/video-lazy"];config.techOrder&&-1!==config.techOrder.indexOf("youtube")&&modules.push("media_videojs/Youtube-lazy"),config.techOrder&&-1!==config.techOrder.indexOf("flash")&&modules.push("media_videojs/videojs-flash-lazy"),require(modules,(function(videojs){onload&&(onload(videojs),onload=null),videojs(id,config)}))}))};return{setUp:function(executeonload){onload=executeonload,notifyVideoJS(null,$("body")),Event.getLegacyEvents().done((function(events){$(document).on(events.FILTER_CONTENT_UPDATED,notifyVideoJS)}))}}}));
/**
 * AMD module to access the DOM global document object.
 *
 * @package    media_videojs
 * @copyright  2019 Tom Dickman <tomdickman@catalyst-au.net>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("media_videojs/document",[],(function(){return document}));
/**
 * AMD module to access the DOM global window object.
 *
 * @package    media_videojs
 * @copyright  2019 Tom Dickman <tomdickman@catalyst-au.net>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("media_videojs/window",[],(function(){return window}));
/*! lazysizes - v4.0.2 */
!function(a,b){var c=b(a,a.document);a.lazySizes=c,"object"==typeof module&&module.exports&&(module.exports=c)}(window,function(a,b){"use strict";if(b.getElementsByClassName){var c,d,e=b.documentElement,f=a.Date,g=a.HTMLPictureElement,h="addEventListener",i="getAttribute",j=a[h],k=a.setTimeout,l=a.requestAnimationFrame||k,m=a.requestIdleCallback,n=/^picture$/i,o=["load","error","lazyincluded","_lazyloaded"],p={},q=Array.prototype.forEach,r=function(a,b){return p[b]||(p[b]=new RegExp("(\\s|^)"+b+"(\\s|$)")),p[b].test(a[i]("class")||"")&&p[b]},s=function(a,b){r(a,b)||a.setAttribute("class",(a[i]("class")||"").trim()+" "+b)},t=function(a,b){var c;(c=r(a,b))&&a.setAttribute("class",(a[i]("class")||"").replace(c," "))},u=function(a,b,c){var d=c?h:"removeEventListener";c&&u(a,b),o.forEach(function(c){a[d](c,b)})},v=function(a,d,e,f,g){var h=b.createEvent("CustomEvent");return e||(e={}),e.instance=c,h.initCustomEvent(d,!f,!g,e),a.dispatchEvent(h),h},w=function(b,c){var e;!g&&(e=a.picturefill||d.pf)?e({reevaluate:!0,elements:[b]}):c&&c.src&&(b.src=c.src)},x=function(a,b){return(getComputedStyle(a,null)||{})[b]},y=function(a,b,c){for(c=c||a.offsetWidth;c<d.minSize&&b&&!a._lazysizesWidth;)c=b.offsetWidth,b=b.parentNode;return c},z=function(){var a,c,d=[],e=[],f=d,g=function(){var b=f;for(f=d.length?e:d,a=!0,c=!1;b.length;)b.shift()();a=!1},h=function(d,e){a&&!e?d.apply(this,arguments):(f.push(d),c||(c=!0,(b.hidden?k:l)(g)))};return h._lsFlush=g,h}(),A=function(a,b){return b?function(){z(a)}:function(){var b=this,c=arguments;z(function(){a.apply(b,c)})}},B=function(a){var b,c=0,e=d.throttleDelay,g=d.ricTimeout,h=function(){b=!1,c=f.now(),a()},i=m&&g>49?function(){m(h,{timeout:g}),g!==d.ricTimeout&&(g=d.ricTimeout)}:A(function(){k(h)},!0);return function(a){var d;(a=a===!0)&&(g=33),b||(b=!0,d=e-(f.now()-c),0>d&&(d=0),a||9>d?i():k(i,d))}},C=function(a){var b,c,d=99,e=function(){b=null,a()},g=function(){var a=f.now()-c;d>a?k(g,d-a):(m||e)(e)};return function(){c=f.now(),b||(b=k(g,d))}};!function(){var b,c={lazyClass:"lazyload",loadedClass:"lazyloaded",loadingClass:"lazyloading",preloadClass:"lazypreload",errorClass:"lazyerror",autosizesClass:"lazyautosizes",srcAttr:"data-src",srcsetAttr:"data-srcset",sizesAttr:"data-sizes",minSize:40,customMedia:{},init:!0,expFactor:1.5,hFac:.8,loadMode:2,loadHidden:!0,ricTimeout:0,throttleDelay:125};d=a.lazySizesConfig||a.lazysizesConfig||{};for(b in c)b in d||(d[b]=c[b]);a.lazySizesConfig=d,k(function(){d.init&&F()})}();var D=function(){var g,l,m,o,p,y,D,F,G,H,I,J,K,L,M=/^img$/i,N=/^iframe$/i,O="onscroll"in a&&!/glebot/.test(navigator.userAgent),P=0,Q=0,R=0,S=-1,T=function(a){R--,a&&a.target&&u(a.target,T),(!a||0>R||!a.target)&&(R=0)},U=function(a,c){var d,f=a,g="hidden"==x(b.body,"visibility")||"hidden"!=x(a,"visibility");for(F-=c,I+=c,G-=c,H+=c;g&&(f=f.offsetParent)&&f!=b.body&&f!=e;)g=(x(f,"opacity")||1)>0,g&&"visible"!=x(f,"overflow")&&(d=f.getBoundingClientRect(),g=H>d.left&&G<d.right&&I>d.top-1&&F<d.bottom+1);return g},V=function(){var a,f,h,j,k,m,n,p,q,r=c.elements;if((o=d.loadMode)&&8>R&&(a=r.length)){f=0,S++,null==K&&("expand"in d||(d.expand=e.clientHeight>500&&e.clientWidth>500?500:370),J=d.expand,K=J*d.expFactor),K>Q&&1>R&&S>2&&o>2&&!b.hidden?(Q=K,S=0):Q=o>1&&S>1&&6>R?J:P;for(;a>f;f++)if(r[f]&&!r[f]._lazyRace)if(O)if((p=r[f][i]("data-expand"))&&(m=1*p)||(m=Q),q!==m&&(y=innerWidth+m*L,D=innerHeight+m,n=-1*m,q=m),h=r[f].getBoundingClientRect(),(I=h.bottom)>=n&&(F=h.top)<=D&&(H=h.right)>=n*L&&(G=h.left)<=y&&(I||H||G||F)&&(d.loadHidden||"hidden"!=x(r[f],"visibility"))&&(l&&3>R&&!p&&(3>o||4>S)||U(r[f],m))){if(ba(r[f]),k=!0,R>9)break}else!k&&l&&!j&&4>R&&4>S&&o>2&&(g[0]||d.preloadAfterLoad)&&(g[0]||!p&&(I||H||G||F||"auto"!=r[f][i](d.sizesAttr)))&&(j=g[0]||r[f]);else ba(r[f]);j&&!k&&ba(j)}},W=B(V),X=function(a){s(a.target,d.loadedClass),t(a.target,d.loadingClass),u(a.target,Z),v(a.target,"lazyloaded")},Y=A(X),Z=function(a){Y({target:a.target})},$=function(a,b){try{a.contentWindow.location.replace(b)}catch(c){a.src=b}},_=function(a){var b,c=a[i](d.srcsetAttr);(b=d.customMedia[a[i]("data-media")||a[i]("media")])&&a.setAttribute("media",b),c&&a.setAttribute("srcset",c)},aa=A(function(a,b,c,e,f){var g,h,j,l,o,p;(o=v(a,"lazybeforeunveil",b)).defaultPrevented||(e&&(c?s(a,d.autosizesClass):a.setAttribute("sizes",e)),h=a[i](d.srcsetAttr),g=a[i](d.srcAttr),f&&(j=a.parentNode,l=j&&n.test(j.nodeName||"")),p=b.firesLoad||"src"in a&&(h||g||l),o={target:a},p&&(u(a,T,!0),clearTimeout(m),m=k(T,2500),s(a,d.loadingClass),u(a,Z,!0)),l&&q.call(j.getElementsByTagName("source"),_),h?a.setAttribute("srcset",h):g&&!l&&(N.test(a.nodeName)?$(a,g):a.src=g),f&&(h||l)&&w(a,{src:g})),a._lazyRace&&delete a._lazyRace,t(a,d.lazyClass),z(function(){(!p||a.complete&&a.naturalWidth>1)&&(p?T(o):R--,X(o))},!0)}),ba=function(a){var b,c=M.test(a.nodeName),e=c&&(a[i](d.sizesAttr)||a[i]("sizes")),f="auto"==e;(!f&&l||!c||!a[i]("src")&&!a.srcset||a.complete||r(a,d.errorClass)||!r(a,d.lazyClass))&&(b=v(a,"lazyunveilread").detail,f&&E.updateElem(a,!0,a.offsetWidth),a._lazyRace=!0,R++,aa(a,b,f,e,c))},ca=function(){if(!l){if(f.now()-p<999)return void k(ca,999);var a=C(function(){d.loadMode=3,W()});l=!0,d.loadMode=3,W(),j("scroll",function(){3==d.loadMode&&(d.loadMode=2),a()},!0)}};return{_:function(){p=f.now(),c.elements=b.getElementsByClassName(d.lazyClass),g=b.getElementsByClassName(d.lazyClass+" "+d.preloadClass),L=d.hFac,j("scroll",W,!0),j("resize",W,!0),a.MutationObserver?new MutationObserver(W).observe(e,{childList:!0,subtree:!0,attributes:!0}):(e[h]("DOMNodeInserted",W,!0),e[h]("DOMAttrModified",W,!0),setInterval(W,999)),j("hashchange",W,!0),["focus","mouseover","click","load","transitionend","animationend","webkitAnimationEnd"].forEach(function(a){b[h](a,W,!0)}),/d$|^c/.test(b.readyState)?ca():(j("load",ca),b[h]("DOMContentLoaded",W),k(ca,2e4)),c.elements.length?(V(),z._lsFlush()):W()},checkElems:W,unveil:ba}}(),E=function(){var a,c=A(function(a,b,c,d){var e,f,g;if(a._lazysizesWidth=d,d+="px",a.setAttribute("sizes",d),n.test(b.nodeName||""))for(e=b.getElementsByTagName("source"),f=0,g=e.length;g>f;f++)e[f].setAttribute("sizes",d);c.detail.dataAttr||w(a,c.detail)}),e=function(a,b,d){var e,f=a.parentNode;f&&(d=y(a,f,d),e=v(a,"lazybeforesizes",{width:d,dataAttr:!!b}),e.defaultPrevented||(d=e.detail.width,d&&d!==a._lazysizesWidth&&c(a,f,e,d)))},f=function(){var b,c=a.length;if(c)for(b=0;c>b;b++)e(a[b])},g=C(f);return{_:function(){a=b.getElementsByClassName(d.autosizesClass),j("resize",g)},checkElems:g,updateElem:e}}(),F=function(){F.i||(F.i=!0,E._(),D._())};return c={cfg:d,autoSizer:E,loader:D,init:F,uP:w,aC:s,rC:t,hC:r,fire:v,gW:y,rAF:z}}});
define('filter_poodll/msr_helper_whammy', ["jquery","core/log","filter_poodll/utils_amd","filter_poodll/poodll_whammy"],function(a,b,c,d){"use strict";return b.debug("PoodLL Whammy Recorder Helper: initialising"),{requestDataInvoked:!1,isOnStartedDrawingNonBlankFramesInvoked:!1,isStopDrawing:!1,canvas:null,context:null,video:!1,lastTime:!1,whammy:!1,isPaused:!1,width:!1,height:!1,speed:.8,quality:100,mediaStream:null,msr:null,audioctx:null,clone:function(){return a.extend(!0,{},this)},init:function(a,c,d){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.mediaStream=c,this.msr=a,this.audioctx=d,b.debug("initing whammy helper")},record:function(a){b.debug("recordingin whammy helper"),this.width||(this.width=320),this.height||(this.height=240),this.video&&this.video instanceof HTMLVideoElement&&(this.width||(this.width=this.video.videoWidth||this.video.clientWidth||320),this.height||(this.height=this.video.videoHeight||this.video.clientHeight||240)),this.video||(this.video={width:this.width,height:this.height}),this.canvas&&this.canvas.width&&this.canvas.height||(this.canvas={width:this.width,height:this.height}),this.video&&this.video instanceof HTMLVideoElement?this.isHTMLObject=!0:(this.video=document.createElement("video"),this.video.srcObject=this.mediaStream),this.video.muted=!0,this.video.play(),this.lastTime=(new Date).getTime(),this.whammy=d.Video,this.whammy.init(this.speed,this.quality),this.drawFrames(this)},clearOldRecordedFrames:function(){this.whammy.frames=[]},requestData:function(){var a=this;if(!this.isPaused){if(!this.whammy.frames.length)return void(this.requestDataInvoked=!1);this.requestDataInvoked=!0;var d=this.whammy.frames.slice(0);this.whammy.frames=this.dropBlackFrames(d,-1),this.whammy.compile(function(d){a.msr.ondataavailable(d),b.debug("video recorded blob size:"+c.bytesToSize(d.size))}),this.whammy.frames=[],this.requestDataInvoked=!1}},drawFrames:function(a){if(a.isPaused)return a.lastTime=(new Date).getTime(),void setTimeout(function(){a.drawFrames(a)},500);if(!a.isStopDrawing){if(a.requestDataInvoked)return setTimeout(function(){a.drawFrames(a)},100);var b=(new Date).getTime()-a.lastTime;if(!b)return a.drawFrames(a);a.lastTime=(new Date).getTime(),!a.isHTMLObject&&a.video.paused&&a.video.play(),a.context.drawImage(a.video,0,0,a.canvas.width,a.canvas.height),a.isStopDrawing||a.whammy.frames.push({duration:b,image:a.canvas.toDataURL("image/webp")}),a.isOnStartedDrawingNonBlankFramesInvoked||a.isBlankFrame(a.whammy.frames[a.whammy.frames.length-1])||(a.isOnStartedDrawingNonBlankFramesInvoked=!0,a.msr.onStartedDrawingNonBlankFrames()),setTimeout(function(){a.drawFrames(a)},10)}},stop:function(){this.isStopDrawing=!0,this.requestData()},isBlankFrame:function(a,b,c){var d=document.createElement("canvas");d.width=this.canvas.width,d.height=this.canvas.height;var e,f,g,h=d.getContext("2d"),i={r:0,g:0,b:0},j=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),k=b&&b>=0&&b<=1?b:0,l=c&&c>=0&&c<=1?c:0,m=new Image;m.src=a.image,h.drawImage(m,0,0,this.canvas.width,this.canvas.height);var n=h.getImageData(0,0,this.canvas.width,this.canvas.height);e=0,f=n.data.length,g=n.data.length/4;for(var o=0;o<f;o+=4){var p={r:n.data[o],g:n.data[o+1],b:n.data[o+2]},q=Math.sqrt(Math.pow(p.r-i.r,2)+Math.pow(p.g-i.g,2)+Math.pow(p.b-i.b,2));q<=j*k&&e++}return!(g-e<=g*l)},dropBlackFrames:function(a,b,c,d){var e=document.createElement("canvas");e.width=this.canvas.width,e.height=this.canvas.height;for(var f=e.getContext("2d"),g=[],h=b===-1,i=b&&b>0&&b<=a.length?b:a.length,j={r:0,g:0,b:0},k=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),l=c&&c>=0&&c<=1?c:0,m=d&&d>=0&&d<=1?d:0,n=!1,o=0;o<i;o++){var p,q,r;if(!n){var s=new Image;s.src=a[o].image,f.drawImage(s,0,0,this.canvas.width,this.canvas.height);var t=f.getImageData(0,0,this.canvas.width,this.canvas.height);p=0,q=t.data.length,r=t.data.length/4;for(var u=0;u<q;u+=4){var v={r:t.data[u],g:t.data[u+1],b:t.data[u+2]},w=Math.sqrt(Math.pow(v.r-j.r,2)+Math.pow(v.g-j.g,2)+Math.pow(v.b-j.b,2));w<=k*l&&p++}}!n&&r-p<=r*m||(h&&(n=!0),g.push(a[o]))}return g=g.concat(a.slice(i)),g.length<=0&&g.push(a[a.length-1]),g},pause:function(){this.isPaused=!0},resume:function(){this.isPaused=!1}}});
define('filter_poodll/poodll_oncemediaskin', ["jquery","core/log","filter_poodll/utils_amd","filter_poodll/upskin_radial","filter_poodll/anim_hwave_mic","filter_poodll/dlg_devicesettings"],(function($,log,utils,upskin_radial,hwave,settings){return log.debug("PoodLL Once Recorder Skin: initialising"),{instanceprops:null,pmr:null,devsettings:null,therecanim:null,clone:function(){return $.extend(!0,{},this)},init:function(ip,pmr){this.instanceprops=ip,this.pmr=pmr,this.devsettings=settings.clone(),this.devsettings.init(pmr,ip)},fetch_instanceprops:function(){return this.instanceprops},onUploadSuccess:function(controlbarid){$("#"+controlbarid+" > .poodll_save-recording").hide(),$("#"+controlbarid+" > .poodll_savedsuccessfully").show()},onUploadFailure:function(controlbarid){},fetch_status_bar:function(skinname){return'<div class="poodll_status_'+skinname+'" width="320" height="50">00:00:00</div>'},fetch_preview_audio:function(skinname){return'<audio class="poodll_preview_'+skinname+'" style="display: none;" playsinline="playsinline" muted></audio>'},fetch_preview_video:function(skinname){return'<video class="poodll_preview_'+skinname+'" style="display: none;" playsinline="playsinline" muted></video>'},fetch_resource_audio:function(skinname){return'<audio class="poodll_resourceplayer_'+skinname+'" style="display: none;" playsinline="playsinline"></audio>'},fetch_resource_video:function(skinname){return'<video class="poodll_resourceplayer_'+skinname+'" style="display: none;" playsinline="playsinline"></video>'},onMediaError:function(e){console.error("media error",e)},onMediaSuccess_video:function(controlbarid){var ip=this.fetch_instanceprops();ip.uploader.Output(""),ip.timer.reset(),ip.timer.start(),this.update_status(controlbarid),this.set_visual_mode("recordingmode",controlbarid)},onMediaSuccess_audio:function(controlbarid){var ip=this.fetch_instanceprops();ip.controlbar.preview.attr("src",null),ip.uploader.Output(""),this.therecanim.start(),ip.timer.reset(),ip.timer.start(),this.update_status(controlbarid),this.set_visual_mode("recordingmode",controlbarid)},handle_timer_update:function(controlbarid){var ip=this.fetch_instanceprops();this.therecanim.displaytime=ip.timer.fetch_display_time(),this.update_status(controlbarid),0==ip.timer.seconds&&ip.timer.initseconds>0&&ip.controlbar.stopbutton.click()},update_status:function(controlbarid){var ip=this.fetch_instanceprops();ip.controlbar.status.html(ip.timer.fetch_display_time())},fetch_uploader_skin:function(controlbarid,element){var ip=this.fetch_instanceprops(),upskin=upskin_radial.clone();return upskin.init(ip.config,element,ip.controlbar.uploadcanvas,ip.controlbar.uploadmessages),upskin.setDrawParam("lineWidth",2),upskin.setDrawParam("font","14px Arial"),upskin},set_visual_mode:function(mode,controlbarid){var ip=this.fetch_instanceprops();switch(mode){case"readymode":ip.controlbar.status.show(),this.enable_button(ip.controlbar.startbutton),this.disable_button(ip.controlbar.finishedbutton),this.disable_button(ip.controlbar.stopbutton),ip.controlbar.uploadcanvas.hide(),this.therecanim.setDrawParam("wavColor","#CCCCCC"),this.therecanim.clear(),"video"==ip.config.mediatype?(ip.controlbar.playcanvas.hide(),ip.controlbar.preview.show()):(ip.controlbar.playcanvas.show(),ip.controlbar.preview.hide());break;case"recordingmode":this.enable_button(ip.controlbar.stopbutton),this.disable_button(ip.controlbar.startbutton),"video"==ip.config.mediatype?(ip.controlbar.playcanvas.hide(),ip.controlbar.preview.show()):(ip.controlbar.playcanvas.show(),ip.controlbar.preview.hide()),ip.controlbar.uploadcanvas.hide(),this.therecanim.setDrawParam("wavColor","#FF0000"),this.therecanim.clear(),ip.controlbar.status.show();break;case"aftermode":this.disable_button(ip.controlbar.startbutton),this.disable_button(ip.controlbar.stopbutton),this.therecanim.setDrawParam("wavColor","#CCCCCC"),this.therecanim.clear(),ip.controlbar.playcanvas.hide(),"video"==ip.config.mediatype&&ip.controlbar.preview.hide(),ip.controlbar.uploadcanvas.show(),ip.controlbar.status.show()}},insert_controlbar_video:function(element,controlbarid,preview,resource){return this.prepare_controlbar(element,controlbarid,preview,resource,"video")},insert_controlbar_audio:function(element,controlbarid,preview,resource){return this.prepare_controlbar(element,controlbarid,preview,resource,"audio")},prepare_controlbar:function(element,controlbarid,preview,resource,mediatype){var ip=this.fetch_instanceprops(),skin_style=ip.config.media_skin_style,recorder_class="video"==mediatype?"poodll_mediarecorder_video":"poodll_mediarecorder_audio",ss=this.pmr.fetch_strings(),ss_startlabel=ss.recui_record,ss_stoplabel=(ss.recui_testmic,ss.recui_stop),status=this.fetch_status_bar("once"),controls='<div class="poodll_mediarecorderholder_once '+recorder_class+'" id="holder_'+controlbarid+'">';controls+='<div class="poodll_mediarecorderbox_once" id="'+controlbarid+'">',controls+=this.devsettings.fetch_dialogue_box(),controls+=ip.downloaddialog.fetch_dialogue_box(),controls+=ip.errordialog.fetch_dialogue_box(),controls+='<div class="style-holder '+skin_style+'">',controls+=preview,controls+='<div class="settingsicon" id="settingsicon_'+controlbarid+'"><button type="button" class="btn-poodllsettings" data-toggle="modal" data-target="#myModal"><i class="fa fa-cogs" aria-hidden="true"></i></button></div>',controls+='<canvas id="'+controlbarid+'_playcanvas" width="250" height="50" class="poodll_mediarecorder_playcanvas_once"></canvas>',controls+=status,controls+='<button type="button" class="poodll_mediarecorder_button_once poodll_start-recording_once">'+ss_startlabel+"</button>",controls+='<button type="button" class="poodll_mediarecorder_button_once poodll_stop-recording_once">'+ss_stoplabel+"</button>",controls+="audio"==mediatype?'<canvas id="'+controlbarid+'_uploadcanvas" width="250" height="50" class="poodll_mediarecorder_uploadcanvas_once"></canvas>':'<canvas id="'+controlbarid+'_uploadcanvas" width="130" height="210" class="poodll_mediarecorder_uploadcanvas_once"></canvas>',controls+='<div class="poodll_uploadmessages_once"></div>',controls+="</div></div></div>",$(element).prepend(controls);var controlbar={settingsdialog:$("#"+controlbarid+" .poodll_dialogue_box_settings"),downloaddialog:$("#"+controlbarid+" .poodll_dialogue_box_download"),errorsdialog:$("#"+controlbarid+" .poodll_dialogue_box_errors"),settingsicon:$("#"+controlbarid+" .settingsicon"),status:$("#"+controlbarid+" .poodll_status_once"),preview:$("#"+controlbarid+" .poodll_preview_once"),startbutton:$("#"+controlbarid+" .poodll_start-recording_once"),stopbutton:$("#"+controlbarid+" .poodll_stop-recording_once"),playcanvas:$("#"+controlbarid+"_playcanvas"),uploadcanvas:$("#"+controlbarid+"_uploadcanvas"),uploadmessages:$("#"+controlbarid+" .poodll_uploadmessages_once")};return ip.downloaddialog.set_dialogue_box(controlbar.downloaddialog),ip.errordialog.set_dialogue_box(controlbar.errorsdialog),this.devsettings.set_dialogue_box(controlbar.settingsdialog),controlbar},register_controlbar_events_video:function(onMediaSuccess,controlbarid){return this.register_controlbar_events_audio(onMediaSuccess,controlbarid)},register_controlbar_events_audio:function(onMediaSuccess,controlbarid){var self=this,pmr=this.pmr,ip=this.fetch_instanceprops();ip.config.recanim="hwave_mic";var recanim=hwave.clone();self.therecanim=recanim,recanim.init(ip.audioanalyser,ip.controlbar.playcanvas.get(0)),this.set_visual_mode("readymode",controlbarid),ip.controlbar.settingsicon.click((function(){self.uploaded?ip.downloaddialog.open():self.devsettings.open()})),ip.controlbar.startbutton.click((function(){ip.config.hermes.enable(),ip.timer.enable(),pmr.do_start_audio(ip,onMediaSuccess)})),ip.controlbar.stopbutton.click((function(){pmr.do_stop_audio(ip),recanim.clear(),ip.timer.stop(),self.update_status(controlbarid);setTimeout((function doDeferredUpload(){ip.blobs&&ip.blobs.length>0?(pmr.do_save_audio(ip),ip.uploaded=!0,self.disable_button(ip.controlbar.startbutton)):setTimeout(doDeferredUpload,200)}),200),self.set_visual_mode("aftermode",controlbarid)})),window.onbeforeunload=function(){}},enable_button:function(button){$(button).attr("disabled",!1),$(button).removeClass("pmr_disabled")},disable_button:function(button){$(button).attr("disabled",!0),$(button).addClass("pmr_disabled")}}}));
define('filter_poodll/anim_words', ["jquery","core/log","filter_poodll/speech_poodll"],(function($,log,speechrecognition){return log.debug("anim_words: initialising"),{analyser:null,cvs:null,cvsctx:null,speechrec:null,enabled:!1,drawparams:{textColor:"#0",wavColor:"#0",font:"14px Comic Sans MS",textAlign:"center"},clone:function(){return $.extend(!0,{},this)},init:function(analyser,cvs){this.cvs=cvs,this.cvsctx=cvs.getContext("2d"),this.analyser=analyser,this.speechrec=speechrecognition.clone(),this.speechrec.init("en-US")},setDrawParam:function(paramkey,paramvalue){this.drawparams[paramkey]=paramvalue},clear:function(){this.cvsctx.clearRect(0,0,this.cvs.width,this.cvs.height),this.enabled=!1,this.speechrec.stop()},start:function(){this.enabled=!0;var that=this;this.analyser.core.fftSize=2048;var bufferLength=this.analyser.core.fftSize,dataArray=new Uint8Array(bufferLength),cwidth=this.cvs.width,cheight=this.cvs.height;this.cvsctx.clearRect(0,0,cwidth,this.ceight);var words=["..","..","..","..","..","..","..",".."];this.speechrec.oninterimspeechcapture=function(speechtext){var newwords=speechtext.split(" ");words=words.concat(newwords)},this.speechrec.start();!function draw(){if(that.enabled){(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame)(draw);that.analyser.core.getByteTimeDomainData(dataArray),that.cvsctx.clearRect(0,0,cwidth,cheight),that.cvsctx.lineWidth=2,that.cvsctx.strokeStyle=that.drawparams.wavColor,that.cvsctx.beginPath();for(var sliceWidth=1*cwidth/bufferLength,x=0,i=0;i<bufferLength;i++){var y=dataArray[i]/128*cheight/2;0===i?that.cvsctx.moveTo(x,y):that.cvsctx.lineTo(x,y),x+=sliceWidth}that.cvsctx.lineTo(cwidth,cheight/2),that.cvsctx.stroke(),that.cvsctx.font=that.drawparams.font,that.cvsctx.fillStyle=that.drawparams.textColor,that.cvsctx.textAlign=that.drawparams.textAlign;var cellvcenter=cheight/4,cellwidth=cwidth/4,cellhcenter=cwidth/8;for(i=1;i<9;i++)that.cvsctx.fillText(words[words.length-i],cellwidth*(i%4)+cellhcenter,i<5?cellvcenter:3*cellvcenter)}}()}}}));
define('filter_poodll/poodll_uploadmediaskin', ["jquery","core/log","filter_poodll/utils_amd","filter_poodll/upskin_radial","filter_poodll/util_dragdrop"],(function($,log,utils,upskin_radial,dd){return log.debug("PoodLL Upload Media skin: initialising"),{instanceprops:null,pmr:null,clone:function(){return $.extend(!0,{},this)},init:function(ip,pmr){this.instanceprops=ip,this.pmr=pmr},fetch_status_bar:function(skinname){return""},fetch_preview_audio:function(skinname){return""},fetch_preview_video:function(skinname){return""},fetch_resource_audio:function(skinname){return""},fetch_resource_video:function(skinname){return""},fetch_uploader_skin:function(controlbarid,element){var ip=this.fetch_instance_props(),upskin=upskin_radial.clone();return upskin.init(ip.config,element,ip.controlbar.uploadcanvas,ip.controlbar.uploadmessages),upskin.setDrawParam("lineWidth",2),upskin.setDrawParam("font","14px Arial"),upskin},handle_timer_update:function(controlbarid){},onUploadSuccess:function(controlbarid){$("#"+controlbarid+" > .poodll_save-recording").hide(),$("#"+controlbarid+" > .poodll_savedsuccessfully").show()},onUploadFailure:function(controlbarid){},onMediaSuccess_video:function(controlbarid){},onMediaSuccess_audio:function(controlbarid){},insert_controlbar_video:function(element,controlbarid,preview,resource){return this.prepare_controlbar(element,controlbarid,preview,resource,"video")},insert_controlbar_audio:function(element,controlbarid,preview,resource){return this.prepare_controlbar(element,controlbarid,preview,resource,"audio")},register_controlbar_events_video:function(onMediaSuccess,controlbarid){return this.register_events(controlbarid)},register_controlbar_events_audio:function(onMediaSuccess,controlbarid){return this.register_events(controlbarid)},fetch_instance_props:function(){return this.instanceprops},prepare_controlbar:function(element,controlbarid,preview,resource,mediatype){var ip=this.fetch_instance_props(),acceptmedia="";switch(mediatype){case"video":acceptmedia="video/webm,video/ogg,video/mp4,video/x-m4v,video/*";break;case"snapshot":case"image":acceptmedia="image/*";case"audio":acceptmedia=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?"video/*":"audio/*";default:acceptmedia=""}if(utils.is_ios()||utils.is_android())var ss_chooselabel=M.util.get_string("recui_recordorchoose","filter_poodll");else ss_chooselabel=M.util.get_string("recui_choosefile","filter_poodll");var skin_style=ip.config.media_skin_style,controls='<div class="poodll_mediarecorderholder_upload '+("video"==mediatype?"poodll_mediarecorder_video":"poodll_mediarecorder_audio")+'" id="holder_'+controlbarid+'">';if(controls+='<div class="poodll_mediarecorderbox_upload" id="'+controlbarid+'">',controls+=ip.errordialog.fetch_dialogue_box(),controls+='<div class="style-holder '+skin_style+'">',"audio"==mediatype)var canvaswidth=250,canvasheight=50;else canvaswidth=130,canvasheight=210;controls+='<div class="poodll_mediarecorder_uploadcanvas_cont_upload"><canvas id="'+controlbarid+'_uploadcanvas" width="'+canvaswidth+'" height="'+canvasheight+'" class="poodll_mediarecorder_uploadcanvas_upload"></canvas></div>',controls+='<div class="p_btn_wrapper">',controls+='<input type="file" id="'+controlbarid+'_poodllfileselect" name="poodllfileselect[]" accept="'+acceptmedia+'"/>',controls+='<button type="button" id="'+controlbarid+'_p_btn" class="p_btn">'+ss_chooselabel+"</button>",controls+="</div>",controls+='<div class="poodll_uploadmessages_once"></div>',controls+="</div></div></div>",$(element).prepend(controls);var controlbar={errorsdialog:$("#"+controlbarid+" .poodll_dialogue_box_errors"),filebutton:$("#"+controlbarid+"_poodllfileselect"),startbutton:$("#"+controlbarid+"_p_btn"),uploadcanvas:$("#"+controlbarid+"_uploadcanvas"),uploadmessages:$("#"+controlbarid+" .poodll_uploadmessages_once")};return ip.errordialog.set_dialogue_box(controlbar.errorsdialog),controlbar},register_events:function(controlbarid){var self=this,ip=(this.pmr,this.fetch_instance_props());ip.config.hermes.enable(),ip.controlbar.filebutton.on("change",(function(e){var files=e.target.files||e.dataTransfer.files;self.FileSelectHandler(files,ip.uploader),dd.turnoff_dragdrop(),ip.controlbar.filebutton.off("change"),ip.controlbar.filebutton.attr("disabled",!0)})),dd.init(ip.controlbar.uploadcanvas,this.FileSelectHandler,ip)},FileSelectHandler:function(files,uploader){for(var file,i=0;file=files[i];i++)log.debug("filetype:"+file.type),uploader.uploadBlob(file,file.type)}}}));
define('filter_poodll/poodll_mediastreamrecorder', ["jquery","core/log"],function(a,b){"use strict";return b.debug("PoodLL Recorder: initialising"),{init:function(){},start:function(){},stop:function(){},resume:function(){},ondataavailable:function(a){b.debug("ondataavailable:"+a)},onstop:function(a){b.debug(a)}}});
define('filter_poodll/speech_browser', ["jquery","core/log"],(function($,log){return log.debug("speech_browser: initialising"),{recognition:null,recognizing:!1,ignore_onend:!1,final_transcript:"",start_timestamp:0,lang:"en-US",clone:function(){return $.extend(!0,{},this)},will_work_ok:function(opts){return void 0===navigator.brave&&(!(navigator.userAgent.toLowerCase().indexOf("edg/")>-1)&&("webkitSpeechRecognition"in window||"SpeechRecognition"in window))},init:function(opts){var SpeechRecognition=SpeechRecognition||webkitSpeechRecognition;this.recognition=new SpeechRecognition,this.recognition.continuous=!0,this.recognition.interimResults=!0,this.lang=opts.language?opts.language:"en-US",this.register_events()},set_grammar:function(grammar){var SpeechGrammarList=SpeechGrammarList||webkitSpeechGrammarList;if(SpeechGrammarList){var speechRecognitionList=new SpeechGrammarList;speechRecognitionList.addFromString(grammar,1),this.recognition.grammars=speechRecognitionList}},start:function(stream){this.recognizing||(this.recognizing=!0,this.final_transcript="",this.recognition.lang=this.lang,this.recognition.start(),this.ignore_onend=!1,this.start_timestamp=Date.now())},stop:function(){this.recognizing=!1,this.recognition.stop()},register_events:function(){var recognition=this.recognition,that=this;recognition.onstart=function(){that.recognizing=!0},recognition.onerror=function(event){"no-speech"==event.error&&(log.debug("info_no_speech"),that.ignore_onend=!0),"audio-capture"==event.error&&(log.debug("info_no_microphone"),that.ignore_onend=!0),"not-allowed"==event.error&&(event.timeStamp-that.start_timestamp<100?log.debug("info_blocked"):log.debug("info_denied"),that.ignore_onend=!0)},recognition.onend=function(){0!=that.recognizing&&(that.ignore_onend?that.recognizing=!1:recognition.start())},recognition.onresult=function(event){for(var interim_transcript="",i=event.resultIndex;i<event.results.length;++i)event.results[i].isFinal?(that.final_transcript+=event.results[i][0].transcript,that.onfinalspeechcapture(that.final_transcript,JSON.stringify(event.results)),that.final_transcript=""):(interim_transcript+=event.results[i][0].transcript,that.oninterimspeechcapture(interim_transcript))}},onfinalspeechcapture:function(speechtext,speechresults){log.debug(speechtext)},oninterimspeechcapture:function(speechtext){}}}));
define('filter_poodll/poodll_readseedmediaskin', ["jquery","core/log","filter_poodll/utils_amd","filter_poodll/upskin_radial","filter_poodll/upskin_bar","filter_poodll/anim_hwave_mic","filter_poodll/dlg_devicesettings"],(function($,log,utils,upskin_radial,upskin_bar,hwave_mic,settings){return log.debug("PoodLL Read Seed Skin: initialising"),{instanceprops:null,pmr:null,devsettings:null,therecanim:null,buttonmode:null,clone:function(){return $.extend(!0,{},this)},init:function(ip,pmr){this.instanceprops=ip,this.pmr=pmr,this.devsettings=settings.clone(),this.devsettings.init(pmr,ip)},fetch_instanceprops:function(){return this.instanceprops},onUploadSuccess:function(controlbarid){this.set_visual_mode("allfinished",controlbarid)},onUploadFailure:function(controlbarid){},fetch_status_bar:function(skin){return'<div class="poodll_status_'+skin+'" width="320" height="50">00:00:00</div>'},fetch_preview_audio:function(skin){return'<audio class="poodll_preview_'+skin+' hide" playsInline muted></audio>'},fetch_preview_video:function(skin){return this.fetch_preview_audio(skin)},fetch_resource_audio:function(skin){return'<audio class="poodll_resourceplayer_'+skin+' hide" ></audio>'},fetch_resource_video:function(skin){return this.fetch_resource_audio(skin)},onMediaError:function(e){console.error("media error",e)},onMediaSuccess_video:function(controlbarid){this.fetch_instanceprops(controlbarid);this.set_visual_mode("startbuttonrecording",controlbarid)},onMediaSuccess_audio:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.preview.attr("src",null),ip.uploader.Output(""),this.therecanim.start(),ip.timer.reset(),ip.timer.start(),this.update_status(controlbarid),"testbuttonrecording"!=this.buttonmode&&this.set_visual_mode("startbuttonrecording",controlbarid)},handle_timer_update:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.status.html(ip.timer.fetch_display_time()),0==ip.timer.seconds&&ip.timer.initseconds>0&&this.process_recording_stop(controlbarid)},update_status:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.status.html(ip.timer.fetch_display_time())},fetch_uploader_skin:function(controlbarid,element){var ip=this.fetch_instanceprops(controlbarid),upskin=upskin_bar.clone();return upskin.init(ip.config,element,ip.controlbar.playcanvas,ip.controlbar.status),upskin},set_button_style:function(mode){$.each(["testbuttonready","testbuttonrecording","startbuttonready","startbuttoncountdown","startbuttonrecording","uploading","allfinished"],(function(index,modeclass){$(".poodll_mediarecorderbox_readseed").removeClass("poodll_mediarecorder_readseed_"+modeclass),$(".poodll_mediarecorderbox_readseed").removeClass("readseed_canclick")})),$(".poodll_mediarecorderbox_readseed").addClass("poodll_mediarecorder_readseed_"+mode),"testbuttonready"!=mode&&"startbuttonready"!=mode||$(".poodll_mediarecorderbox_readseed").addClass("readseed_canclick")},set_visual_mode:function(mode,controlbarid){var ip=this.fetch_instanceprops(controlbarid);this.buttonmode=mode;var messageObject={type:"recorderstatus"};switch(messageObject.status=mode,ip.config.hermes.postMessage(messageObject),mode){case"testbuttonready":ip.controlbar.status.hide(),ip.controlbar.thecaption.text("SPEAK"),ip.controlbar.thecaption.show(),ip.controlbar.playcanvas.hide(),this.set_button_style(mode);break;case"testbuttonrecording":ip.controlbar.thecaption.hide(),ip.controlbar.playcanvas.show(),this.set_button_style(mode);break;case"startbuttonready":ip.controlbar.thecaption.text("START"),ip.controlbar.thecaption.show(),ip.controlbar.playcanvas.hide(),this.set_button_style(mode);break;case"startbuttoncountdown":ip.controlbar.thecaption.text("----------"),ip.controlbar.thecaption.show(),ip.controlbar.playcanvas.hide(),this.set_button_style(mode);break;case"startbuttonrecording":if(ip.controlbar.playcanvas.show(),"1"==ip.config.allowearlyexit&&ip.timer.enabled){var ss_caption=M.util.get_string("recui_clicktofinish","filter_poodll");ip.controlbar.thecaption.text(ss_caption),ip.controlbar.thecaption.show()}else ip.controlbar.thecaption.hide();this.set_button_style(mode);break;case"uploading":ip.controlbar.thecaption.html('<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i>'),ip.controlbar.thecaption.show(),ip.controlbar.playcanvas.hide(),this.set_button_style(mode),ip.controlbar.status.show();break;case"allfinished":ip.controlbar.thecaption.text("Finished"),ip.controlbar.thecaption.show(),ip.controlbar.playcanvas.hide(),ip.controlbar.status.hide(),this.set_button_style(mode)}},insert_controlbar_video:function(element,controlbarid,preview,resource){return this.prepare_controlbar_audio(element,controlbarid,preview,resource)},insert_controlbar_audio:function(element,controlbarid,preview,resource){return this.prepare_controlbar(element,controlbarid,preview,resource,"audio")},prepare_controlbar:function(element,controlbarid,preview,resource,mediatype){var ip=this.fetch_instanceprops(controlbarid),skin_style=ip.config.media_skin_style,status=(this.pmr.fetch_strings(),M.util.get_string("recui_startactivity","filter_poodll"),M.util.get_string("recui_testmic","filter_poodll"),M.util.get_string("recui_stop","filter_poodll"),this.fetch_status_bar("readseed")),controls='<div class="poodll_mediarecorderholder_readseed poodll_mediarecorder_audio" id="holder_'+controlbarid+'">';controls+='<div class="poodll_mediarecorderbox_readseed" id="'+controlbarid+'">',controls+=this.devsettings.fetch_dialogue_box(),controls+=ip.downloaddialog.fetch_dialogue_box(),controls+=ip.errordialog.fetch_dialogue_box(),controls+='<div class="style-holder '+skin_style+'">',controls+=preview,controls+='<div class="settingsicon" id="settingsicon_'+controlbarid+'"><button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal"><i class="fa fa-cogs" aria-hidden="true"></i></button></div>',controls+='<canvas id="'+controlbarid+'_playcanvas" class="poodll_mediarecorder_playcanvas_readseed" width="180" height="50"></canvas>',controls+='<span id="'+controlbarid+'_caption" class="poodll_mediarecorder_caption_readseed"></span>',controls+='<span id="'+controlbarid+'_bogusstartbutton" class="poodll_mediarecorder_bogusstartbutton_readseed"></span>',controls+='<span id="'+controlbarid+'_bogusstopbutton" class="poodll_mediarecorder_bogusstopbutton_readseed"></span>',controls+=status,controls+="</div></div></div>",$(element).prepend(controls);var controlbar={settingsdialog:$("#"+controlbarid+" .poodll_dialogue_box_settings"),downloaddialog:$("#"+controlbarid+" .poodll_dialogue_box_download"),errorsdialog:$("#"+controlbarid+" .poodll_dialogue_box_errors"),settingsicon:$("#"+controlbarid+" .settingsicon"),status:$("#"+controlbarid+" .poodll_status_readseed"),preview:$("#"+controlbarid+" .poodll_preview_readseed"),bigbutton:$("#"+controlbarid+".poodll_mediarecorderbox_readseed"),playcanvas:$("#"+controlbarid+"_playcanvas"),thecaption:$("#"+controlbarid+"_caption"),stopbutton:$("#"+controlbarid+" .poodll_mediarecorder_bogusstopbutton_readseed"),startbutton:$("#"+controlbarid+" .poodll_mediarecorder_bogusstartbutton_readseed")};return ip.downloaddialog.set_dialogue_box(controlbar.downloaddialog),ip.errordialog.set_dialogue_box(controlbar.errorsdialog),this.devsettings.set_dialogue_box(controlbar.settingsdialog),controlbar},register_controlbar_events_video:function(onMediaSuccess,controlbarid){return this.register_controlbar_events_audio(onMediaSuccess,controlbarid)},register_controlbar_events_audio:function(onMediaSuccess,controlbarid){var self=this,pmr=this.pmr,ip=this.fetch_instanceprops(controlbarid);ip.config.recanim="hwave_mic";var recanim=hwave_mic.clone();self.therecanim=recanim,recanim.init(ip.audioanalyser,ip.controlbar.playcanvas.get(0)),this.set_visual_mode("testbuttonready",controlbarid),ip.controlbar.bigbutton.click((function(e){if(e.target===this||$(e.target).hasClass("poodll_mediarecorder_caption_readseed")||$(e.target).hasClass("poodll_mediarecorder_playcanvas_readseed"))switch(self.buttonmode){case"testbuttonready":var messageObject={type:"recorderstatus",status:"testbuttonrecording"};ip.config.hermes.postMessage(messageObject),ip.config.hermes.disable(),ip.timer.disable();pmr.do_start_audio(ip,onMediaSuccess),setTimeout((function(){if(ip.mediaRecorder&&pmr.do_stop_audio(ip),recanim.clear(),ip.config.hermes.enable(),recanim.sounddetected)self.set_visual_mode("startbuttonready",controlbarid);else{var messageObject={type:"recorderstatus",status:"testrecordingfailed"};ip.config.hermes.postMessage(messageObject),self.set_visual_mode("testbuttonready",controlbarid)}}),4e3),self.set_visual_mode("testbuttonrecording",controlbarid);break;case"startbuttonready":ip.config.hermes.enable(),self.set_visual_mode("startbuttoncountdown",controlbarid);var starttime=(new Date).getTime(),finalcount=3e3,previouscount=-1;setTimeout((function countingdown(){var currentcount=(new Date).getTime()-starttime;if(currentcount>finalcount)ip.timer.enable(),pmr.do_start_audio(ip,onMediaSuccess);else{var newcount=!1;if(previouscount<0&&currentcount>0?newcount=finalcount/1e3:previouscount<1e3&&currentcount>1e3?newcount=finalcount/1e3-1:previouscount<2e3&&currentcount>2e3&&(newcount=finalcount/1e3-2),newcount){var messageObject={type:"countdownstatus"};messageObject.status=newcount,ip.config.hermes.postMessage(messageObject)}previouscount=currentcount,setTimeout(countingdown,100)}}),100);break;case"startbuttonrecording":"1"==ip.config.allowearlyexit&&ip.timer.enabled&&self.process_recording_stop(controlbarid);break;case"stopbutton":self.process_recording_stop()}})),ip.controlbar.settingsicon.click((function(e){log.debug("we no proapagato"),e.stopPropagation(),self.uploaded?ip.downloaddialog.open():self.devsettings.open()})),window.onbeforeunload=function(){}},process_recording_stop:function(controlbarid){var pmr=this.pmr,ip=this.fetch_instanceprops(controlbarid),recanim=this.therecanim;pmr.do_stop_audio(ip),recanim.clear(),ip.timer.stop(),this.update_status(controlbarid);setTimeout((function doDeferredUpload(){ip.blobs&&ip.blobs.length>0?(pmr.do_save_audio(ip),ip.uploaded=!0):setTimeout(doDeferredUpload,200)}),200),this.set_visual_mode("uploading",controlbarid)},enable_button:function(button){$(button).attr("disabled",!1),$(button).removeClass("pmr_disabled")},disable_button:function(button){$(button).attr("disabled",!0),$(button).addClass("pmr_disabled")}}}));
define('filter_poodll/msr_poodll', ["jquery","core/log","filter_poodll/utils_amd","filter_poodll/msr_stereoaudio","filter_poodll/msr_plain"],(function($,log,utils,stereoaudiorecorder,plainrecorder){return log.debug("PoodLL MS Recorder: initialising"),{sampleRate:48e3,mimeType:"audio/wav",audioChannels:1,bufferSize:2048,therecorder:null,audioctx:null,audioanalyser:null,clone:function(){return $.extend(!0,{},this)},init:function(mediaStream,audioctx,audioanalyser,mediaType,encoder){if(this.audioctx=audioctx,this.audioanalyser=audioanalyser,"auto"!=encoder)if("stereoaudio"===encoder)this.therecorder="audio"==mediaType?stereoaudiorecorder:plainrecorder;else this.therecorder=plainrecorder;else utils.has_mediarecorder()?(this.therecorder=plainrecorder,log.debug("using plain recorder")):"audio"==mediaType&&(this.therecorder=stereoaudiorecorder,log.debug("using stereo recorder"));this.therecorder&&this.therecorder.init(this,mediaStream,audioctx,mediaType)},start:function(timeinterval){this.therecorder.start(timeinterval),this.audioanalyser.start()},stop:function(){this.therecorder.stop(),this.audioanalyser.clear()},pause:function(){this.therecorder.pause(),this.audioanalyser.clear()},resume:function(){this.therecorder.resume(),this.audioanalyser.start()},ondataavailable:function(blob){log.debug("ondataavailable:"+blob)},onStartedDrawingNonBlankFrames:function(){log.debug("started drawing non blank frames:")},onstop:function(error){log.debug(error)}}}));
define('filter_poodll/dlg_devicesettings', ["jquery","core/log","filter_poodll/dlg_poodll"],(function($,log,dialog){return log.debug("Device settings dialog: initialising"),{dlg:null,pmr:null,instanceprops:null,dlgbox:null,mediatype:null,init:function(pmr,instanceprops){this.dlg=dialog.clone(),this.dlg.setHeader("settings"),this.pmr=pmr,this.instanceprops=instanceprops,this.mediatype=instanceprops.config.mediatype},clone:function(){return $.extend(!0,{},this)},fetch_dialogue_box:function(){return this.dlg.fetch_dialogue_box("settings")},set_dialogue_box:function(dlgbox){this.dlgbox=dlgbox,this.dlg.set_dialogue_box(dlgbox)},set_media_type:function(mediatype){this.mediatype=mediatype},open:function(){var self=this;this.instanceprops;navigator.mediaDevices.enumerateDevices().then((function(devices){var audiodevices=[],videodevices=[];devices.forEach((function(device){switch(device.kind){case"audioinput":audiodevices.push(device);break;case"videoinput":videodevices.push(device)}}));var audioselect='<div class="devicesettings_select"><span class="devicesettings_select_label">Audio: </span>'+self.makeSelect(audiodevices,"audio")+"</div>",videoselect='<div class="devicesettings_select"><span class="devicesettings_select_label">Video: </span>'+self.makeSelect(videodevices,"video")+"</div>",content='<div class="filter_poodll_mediadevices">';"video"==self.mediatype?content+=audioselect+"<br>"+videoselect:content+=audioselect,content+="</div>",self.dlg.setContent(content),self.registerEvents(),"video"==self.mediatype&&(self.dlg.onclose=function(){self.resetVideoUserInterface()}),self.dlg.open()})).catch((function(e){log.debug(e)}))},registerEvents:function(){var self=this,ip=this.instanceprops,preview=ip.controlbar.preview[0];preview&&preview.pause(),ip.mediaRecorder&&ip.mediaRecorder.stop(),this.dlgbox.find(".select_settings_audio").change((function(){self.instanceprops.useraudiodeviceid=this.value})),this.dlgbox.find(".select_settings_video").change((function(){self.instanceprops.uservideodeviceid=this.value}))},resetVideoUserInterface:function(){var ip=this.instanceprops,pmr=(ip.controlbar.preview[0],this.pmr),constraints=pmr.fetch_video_constraints(ip);pmr.tidy_old_stream(ip.controlbarid),navigator.mediaDevices.getUserMedia(constraints).then((function(stream){pmr.restream_preview_video_player(ip.controlbarid,stream)})).catch((function(err){log.debug("location 4567"),log.debug(err)}))},makeSelect:function(devices,devicetype){if(1==devices.length&&""==devices[0].label)return"<div>No devices available yet.</div>";switch(devicetype){case"audio":var userdeviceid=this.instanceprops.useraudiodeviceid;break;case"video":userdeviceid=this.instanceprops.uservideodeviceid}var dlg_dropdown='<select class="select_settings_'+devicetype+'">';return devices.forEach((function(device){var selected="";userdeviceid==device.deviceId&&(selected="selected"),dlg_dropdown+='<option value="'+device.deviceId+'"  '+selected+">"+device.label+"</option>"})),dlg_dropdown+="</select>"}}}));
define('filter_poodll/poodll_mobilerecorder', ["jquery","core/log","filter_poodll/utils_amd","filter_poodll/uploader","filter_poodll/poodll_uploadrecorder"],(function($,log,utils,uploader,uploadrec){return log.debug("PoodLL Mobile Recorder: initialising"),{instanceprops:[],fetch_instance_props:function(widgetid){return this.instanceprops[widgetid]},init_instance_props:function(widgetid){var props={config:null,uploader:null,linkid:null};this.instanceprops[widgetid]=props},supports_current_browser:function(config){return("audio"==config.mediatype||"video"==config.mediatype)&&utils.is_ios()},embed:function(element,config){this.init_instance_props(config.widgetid);var ip=this.fetch_instance_props(config.widgetid);switch(ip.config=config,ip.uploader=uploader.clone(),ip.uploader.init(element,config),ip.linkid="filter_poodll_mobilerecorder_link_"+config.widgetid,config.mediatype){case"audio":this.insert_upload_button(element,config.widgetid),1==config.showmobile&&this.insert_audio_button(element,config.widgetid);break;case"video":this.insert_upload_button(element,config.widgetid),1==config.showmobile&&this.insert_video_button(element,config.widgetid)}return this.register_events(element,config.widgetid),!0},register_events:function(element,widgetid){var ip=this.fetch_instance_props(widgetid),config=ip.config,mobilerecorder=this;$("#"+ip.linkid).on("mousedown touchstart",(function(e){mobilerecorder.confirm_s3_arrival(widgetid),ip.uploader.Output(M.util.get_string("recui_awaitingconfirmation","filter_poodll"))})),$("#"+ip.linkid+"_uploadafile").on("mousedown touchstart",(function(e){$(element).empty(),uploadrec.embed(element,config)}))},insert_video_button:function(element,widgetid){var ip=this.fetch_instance_props(widgetid),controls='<a class ="filter_poodll_mobilerecorderlink" id="'+ip.linkid+'" href="poodllrecorder://?presignedurl='+encodeURIComponent(ip.config.quicktimesignedurl)+"&type="+ip.config.mediatype+"&quality="+ip.config.mobilequality+"&camera="+ip.config.mobilecamera+"&timelimit="+ip.config.timelimit+'">'+M.util.get_string("recui_openrecorderapp","filter_poodll")+"</a>";$(element).prepend(controls)},insert_audio_button:function(element,widgetid){var ip=this.fetch_instance_props(widgetid),controls='<a class ="filter_poodll_mobilerecorderlink"  id="'+ip.linkid+'" href="poodllrecorder://?presignedurl='+encodeURIComponent(ip.config.posturl)+"&type="+ip.config.mediatype+"&quality="+ip.config.mobilequality+"&camera="+ip.config.mobilecamera+"&timelimit="+ip.config.timelimit+'">'+M.util.get_string("recui_openrecorderapp","filter_poodll")+"</a>";$(element).prepend(controls)},insert_upload_button:function(element,widgetid){var controls='<a class ="filter_poodll_uploadafilelink" id="'+this.fetch_instance_props(widgetid).linkid+'_uploadafile" href="#">'+M.util.get_string("recui_uploadafile","filter_poodll")+"</a>";$(element).prepend(controls)},confirm_s3_arrival:function(widgetid){var ip=this.fetch_instance_props(widgetid),xhr=new XMLHttpRequest,config=ip.config,posturl=config.wwwroot+"/filter/poodll/poodllfilelib.php",params="datatype=confirmarrival";params+="&mediatype="+config.mediatype,params+="&filename="+config.filename,xhr.open("POST",posturl,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.setRequestHeader("Cache-Control","no-cache"),xhr.setRequestHeader("Content-length",params.length),xhr.setRequestHeader("Connection","close"),xhr.addEventListener("load",(function(){xhr.response&&xhr.response.indexOf(config.filename)>0?(ip.uploader.pokeFilename(config.filename,ip.uploader),ip.uploader.postprocess_s3_upload(ip.uploader),ip.uploader.Output(M.util.get_string("recui_uploadsuccess","filter_poodll")),ip.uploader.doCallback(ip.uploader,config.filename)):setTimeout((function(){xhr.open("POST",posturl,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.setRequestHeader("Cache-Control","no-cache"),xhr.setRequestHeader("Content-length",params.length),xhr.setRequestHeader("Connection","close"),xhr.send(params)}),2e3)})),xhr.send(params)}}}));
define('filter_poodll/anim_hwave_mic', ["jquery","core/log"],(function($,log){return log.debug("anim_horizontal_wave_mic: initialising"),{analyser:null,cvs:null,cvsctx:null,sounddetected:!1,imgone:null,imgoneloaded:!1,drawparams:{micColor:"#CCCCCC",wavColor:"#CCCCCC",lineWidth:2},clone:function(){return $.extend(!0,{},this)},setDrawParam:function(paramkey,paramvalue){this.drawparams[paramkey]=paramvalue},init:function(analyser,cvs){this.cvs=cvs,this.cvsctx=cvs.getContext("2d"),this.cvsctx.textAlign="center",this.analyser=analyser;var that=this;this.imgone=new Image,this.imgone.addEventListener("load",(function(){that.imgoneloaded=!0})),this.imgone.src=M.cfg.wwwroot+"/filter/poodll/pix/svg/mic.svg"},clear:function(){if(this.imgoneloaded)this.cvsctx.clearRect(0,0,this.cvs.width,this.cvs.height),this.cvsctx.beginPath(),this.cvsctx.lineWidth=this.drawparams.lineWidth,this.cvsctx.strokeStyle=this.drawparams.wavColor,this.cvsctx.moveTo(0,this.cvs.height/2),this.cvsctx.lineTo(this.cvs.width,this.cvs.height/2),this.cvsctx.stroke(),this.drawMic(this.cvsctx,this.cvs.width,this.cvs.height,this.imgone);else{var that=this;this.imgone.addEventListener("load",(function(){that.imgoneloaded=!0,that.clear()}))}},drawMic:function(ctx,cwidth,cheight,mic){var x=(cwidth-mic.width)/2,y=(cheight-mic.height)/2;ctx.drawImage(mic,x,y)},start:function(){this.analyser.core.fftSize=2048;var bufferLength=this.analyser.core.fftSize,dataArray=new Uint8Array(bufferLength),cwidth=this.cvs.width,cheight=this.cvs.height,canvasCtx=this.cvsctx,analyser=this.analyser,that=this;this.clear();!function draw(){requestAnimationFrame(draw);if(analyser.theinterval){analyser.core.getByteTimeDomainData(dataArray),canvasCtx.clearRect(0,0,cwidth,cheight),canvasCtx.lineWidth=that.drawparams.lineWidth,canvasCtx.strokeStyle=that.drawparams.wavColor,canvasCtx.beginPath();var sliceWidth=2*cwidth/bufferLength,x=0;if(bufferLength>0)128!=dataArray[bufferLength-1]&&(that.sounddetected=!0);for(var i=0;i<bufferLength;i++){var y=dataArray[i]/128*cheight/2;0===i?canvasCtx.moveTo(x,y):canvasCtx.lineTo(x,y),y,x+=sliceWidth}canvasCtx.lineTo(cwidth,cheight/2),canvasCtx.stroke(),that.drawMic(canvasCtx,cwidth,cheight,that.imgone)}}()}}}));
define('filter_poodll/literallycanvas_amd', ["jquery","core/log","filter_poodll/utils_amd","filter_poodll/uploader","filter_poodll/react_amd","filter_poodll/literallycanvas"],(function($,log,utils,uploader,React,LC){return log.debug("Filter PoodLL: literallycanvas.js initialising"),{instanceprops:[],loadliterallycanvas:function(opts){var theid="#amdopts_"+opts.recorderid,optscontrol=$(theid).get(0);optscontrol&&(opts=JSON.parse(optscontrol.value),this.config=opts,$(theid).remove());var element="#"+opts.recorderid+"_literally",lc_element=$(element)[0],zoomMax=4,zoomMin=.2;if(opts.whiteboardnozoom>0&&(zoomMax=1,zoomMin=1),opts.backgroundimage){var backimagebuffer=$("#"+opts.recorderid+"_separate-background-image")[0],backgroundimage=new Image;backgroundimage.src=backimagebuffer.src,backgroundimage.crossOrigin="Anonymous";var backgroundshape=LC.createShape("Image",{x:0,y:0,image:backgroundimage,scale:1}),lc=LC.init(lc_element,{imageURLPrefix:opts.imageurlprefix,backgroundColor:opts.backgroundcolor,backgroundShapes:[backgroundshape],recorderid:opts.recorderid,zoomMax:zoomMax,zoomMin:zoomMin})}else lc=LC.init(lc_element,{imageURLPrefix:opts.imageurlprefix,backgroundColor:opts.backgroundcolor,recorderid:opts.recorderid,zoomMax:zoomMax,zoomMin:zoomMin});opts.lc=lc;var vectordata=opts.vectordata;vectordata&&(0!=vectordata.indexOf('{"shapes"')&&0!=vectordata.indexOf('{"colors"')||lc.loadSnapshot(JSON.parse(vectordata))),opts.uploader=uploader.clone(),opts.uploader.init(element,opts),this.instanceprops[opts.recorderid]=opts,this.registerEvents(opts.recorderid)},registerEvents:function(recid){var opts=this.instanceprops[recid];opts.autosave?opts.lc.on("drawingChange",(function(){var m=$("#"+recid+"_messages")[0],savebutton=$("#"+recid+"_btn_upload_whiteboard")[0];if(m){savebutton&&(savebutton.disabled=!1),m.innerHTML="";var th=utils.timeouthandles[recid];th&&clearTimeout(th),utils.timeouthandles[recid]=setTimeout((function(){utils.WhiteboardUploadHandler(recid,opts.lc,opts,opts.uploader)}),opts.autosave)}})):opts.lc.on("drawingChange",(function(){var m=$("#"+recid+"_messages");m&&(m.innerHTML="File has not been saved.")}));var uploadbutton=$("#"+recid+"_btn_upload_whiteboard");uploadbutton&&(opts.autosave?uploadbutton.click((function(){utils.WhiteboardUploadHandler(recid,opts.lc,opts,opts.uploader)})):uploadbutton.click((function(){var cvs=utils.getCvs(recid,opts.lc,opts);utils.pokeVectorData(recid,opts.lc,opts),opts.uploader.uploadFile(cvs.toDataURL(),"image/png")})))}}}));
define('filter_poodll/anim_hwave_timer', ["jquery","core/log"],(function($,log){return log.debug("anim_horizontal_wave_ra: initialising"),{analyser:null,cvs:null,cvsctx:null,sounddetected:!1,displaytime:"00:00:00",drawparams:{wavColor:"#CCCCCC",textColor:"#000000",lineWidth:2,font:"30px Georgia",textAlign:"center"},clone:function(){return $.extend(!0,{},this)},init:function(analyser,cvs){this.cvs=cvs,this.cvsctx=cvs.getContext("2d"),this.cvsctx.textAlign=this.drawparams.textAlign,this.analyser=analyser},setDrawParam:function(paramkey,paramvalue){this.drawparams[paramkey]=paramvalue},clear:function(){this.cvsctx.clearRect(0,0,this.cvs.width,this.cvs.height),this.cvsctx.lineWidth=2,this.cvsctx.strokeStyle=this.drawparams.textColor,this.cvsctx.beginPath(),this.drawTime(this.cvsctx,this.displaytime,this.cvs.width,this.cvs.height),this.cvsctx.stroke()},drawTime:function(ctx,displaytime,cwidth,cheight){ctx.fillStyle=this.drawparams.textColor,ctx.font=this.drawparams.font,ctx.fillText(displaytime,cwidth/2,cheight/4*3)},start:function(){this.analyser.core.fftSize=2048;var bufferLength=this.analyser.core.fftSize,dataArray=new Uint8Array(bufferLength),cwidth=this.cvs.width,cheight=this.cvs.height,canvasCtx=this.cvsctx,analyser=this.analyser,that=this;this.clear();!function draw(){requestAnimationFrame(draw);if(analyser.theinterval){analyser.core.getByteTimeDomainData(dataArray),canvasCtx.clearRect(0,0,cwidth,cheight),canvasCtx.lineWidth=that.drawparams.lineWidth,canvasCtx.strokeStyle=that.drawparams.wavColor,canvasCtx.beginPath();var lineheight=cheight/4*3,sliceWidth=2*cwidth/bufferLength,x=0;if(bufferLength>0)128!=dataArray[bufferLength-1]&&(that.sounddetected=!0);for(var i=0;i<bufferLength;i++){var y=dataArray[i]/128*lineheight/2;0===i?canvasCtx.moveTo(x,y):canvasCtx.lineTo(x,y),y,x+=sliceWidth}canvasCtx.lineTo(cwidth,lineheight/2),that.drawTime(canvasCtx,that.displaytime,cwidth,cheight),canvasCtx.stroke()}}()}}}));
define('filter_poodll/poodll_bmrmediaskin', ["jquery","core/log","filter_poodll/utils_amd","filter_poodll/dlg_devicesettings","filter_poodll/anim_progress_bar","filter_poodll/upskin_bar"],(function($,log,utils,settings,anim_progress_bar,upskin_bar){return log.debug("PoodLL BMR Skin: initialising"),{instanceprops:null,pmr:null,uploaded:!1,devsettings:null,clone:function(){return $.extend(!0,{},this)},init:function(ip,pmr){this.instanceprops=ip,this.pmr=pmr,this.devsettings=settings.clone(),this.devsettings.init(pmr,ip)},fetch_instanceprops:function(){return this.instanceprops},onUploadSuccess:function(controlbarid){$("#"+controlbarid+" > .poodll_save-recording").hide(),$("#"+controlbarid+" > .poodll_savedsuccessfully").show()},onUploadFailure:function(controlbarid){},fetch_status_bar:function(skin){return'<div class="poodll_status_'+skin+'">00:00:00</div>'},fetch_preview_audio:function(skin){return'<audio class="poodll_preview_'+skin+' hide" controls playsinline="playsinline" muted></audio>'},fetch_preview_video:function(skin){return'<video class="poodll_preview_'+skin+'" playsinline="playsinline" muted></video>'},fetch_resource_audio:function(skin){return""},fetch_resource_video:function(skin){return""},fetch_uploader_skin:function(controlbarid,element){var ip=this.fetch_instanceprops(controlbarid),upskin=upskin_bar.clone();return upskin.init(ip.config,element,ip.controlbar.bmr_progresscanvas,ip.controlbar.status),upskin},onMediaError:function(e){console.error("media error",e)},onMediaSuccess_video:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.uploader.Output(""),this.set_visual_mode("recordmode",controlbarid),ip.timer.reset(),ip.timer.start(),this.update_status(controlbarid)},onMediaSuccess_audio:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.uploader.Output(""),ip.controlbar.preview.attr("src",null),this.set_visual_mode("recordmode",controlbarid),ip.timer.reset(),ip.timer.start(),this.update_status(controlbarid)},handle_timer_update:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.status.html(ip.timer.fetch_display_time()),0==ip.timer.seconds&&ip.timer.initseconds>0&&ip.controlbar.stopbutton.click()},update_status:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.status.html(ip.timer.fetch_display_time())},set_visual_mode:function(mode,controlbarid){var ip=this.fetch_instanceprops(controlbarid);switch(this.visualmode=mode,mode){case"recordmode":this.disable_button(ip.controlbar.startbutton),this.show_element(ip.controlbar.startbutton),this.hide_element(ip.controlbar.bmr_progresscanvas),this.enable_button(ip.controlbar.pausebutton),this.show_element(ip.controlbar.pausebutton),this.disable_button(ip.controlbar.playbutton),this.hide_element(ip.controlbar.resumebutton),this.enable_button(ip.controlbar.stopbutton),this.disable_button(ip.controlbar.savebutton),ip.controlbar.preview.addClass("poodll_recording"),ip.controlbar.status.addClass("poodll_recording"),"audio"==ip.config.mediatype&&this.hide_element(ip.controlbar.preview);break;case"previewmode":this.disable_button(ip.controlbar.stopbutton),this.enable_button(ip.controlbar.playbutton),this.disable_button(ip.controlbar.pausebutton),this.enable_button(ip.controlbar.savebutton),ip.controlbar.status.html(ip.timer.fetch_display_time(ip.timer.finalSeconds)),this.show_element(ip.controlbar.startbutton),this.disable_button(ip.controlbar.resumebutton),this.hide_element(ip.controlbar.resumebutton),this.hide_element(ip.controlbar.bmr_progresscanvas),this.uploaded||(this.enable_button(ip.controlbar.startbutton),this.enable_button(ip.controlbar.savebutton)),this.show_element(ip.controlbar.pausebutton),ip.controlbar.preview.removeClass("poodll_recording"),ip.controlbar.status.removeClass("poodll_recording"),"audio"==ip.config.mediatype&&this.show_element(ip.controlbar.preview),this.enable_button(ip.controlbar.playbutton);break;case"playmode":ip.controlbar.status.html("00:00:00"),this.disable_button(ip.controlbar.playbutton),this.enable_button(ip.controlbar.stopbutton),this.disable_button(ip.controlbar.startbutton),this.disable_button(ip.controlbar.resumebutton),this.disable_button(ip.controlbar.playbutton),this.show_element(ip.controlbar.bmr_progresscanvas),this.show_element(ip.controlbar.startbutton),this.hide_element(ip.controlbar.resumebutton);break;case"pausedmode":this.disable_button(ip.controlbar.pausebutton),this.hide_element(ip.controlbar.startbutton),this.show_element(ip.controlbar.resumebutton),this.enable_button(ip.controlbar.resumebutton),this.enable_button(ip.controlbar.savebutton),ip.controlbar.preview.removeClass("poodll_recording"),ip.controlbar.status.removeClass("poodll_recording");break;case"uploadmode":this.disable_button(ip.controlbar.savebutton),this.disable_button(ip.controlbar.startbutton),this.show_element(ip.controlbar.bmr_progresscanvas)}},insert_controlbar_video:function(element,controlbarid,preview,resource){return this.prepare_controlbar(element,controlbarid,preview,resource,"video")},insert_controlbar_audio:function(element,controlbarid,preview,resource){return this.prepare_controlbar(element,controlbarid,preview,resource,"audio")},prepare_controlbar:function(element,controlbarid,preview,resource,mediatype){var ip=this.fetch_instanceprops(controlbarid),skin_style=ip.config.media_skin_style,size_class="poodll_mediarecorder_size_auto";switch(ip.config.size){case"small":size_class="poodll_mediarecorder_size_small";break;case"big":size_class="poodll_mediarecorder_size_big";break;case"auto":size_class="poodll_mediarecorder_size_auto"}var ss=this.pmr.fetch_strings(),hideshowupload=ip.showupload?"":"hide",record_icon="video"==mediatype?"fa-video-camera":"fa-microphone",controls='<div class="poodll_mediarecorderholder_bmr poodll_videorecorderholder_bmr '+("video"==mediatype?"poodll_mediarecorder_video":"poodll_mediarecorder_audio")+" "+size_class+'" id="holder_'+controlbarid+'">';controls+='<div class="poodll_mediarecorderbox_bmr" id="'+controlbarid+'">',controls+='<audio style="display: none !important;" class="poodll-alert-recording" id="'+controlbarid+'"><source src="https://poodll.com/wp-content/themes/Poodll-Theme/images/ding.mp3" type="audio/mpeg"></audio>',controls+='<div class="style-holder '+skin_style+'">',controls+='<div class="poodll_statusholder_bmr" >',controls+='<canvas class="bmr_range"></canvas>',controls+=this.fetch_status_bar("bmr"),controls+="</div>",controls+=preview,controls+='<div class="settingsicon" id="settingsicon_'+controlbarid+'"><button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal"><i class="fa fa-cogs" aria-hidden="true"></i></button></div>',controls+='<button type="button" class="poodll_mediarecorder_button_bmr poodll_start-recording_bmr"><i class="fa '+record_icon+'" aria-hidden="true"></i></button>',controls+=' <button type="button" class="poodll_mediarecorder_button_bmr poodll_resume-recording_bmr bmr_disabled hide" disabled><i class="fa '+record_icon+'" aria-hidden="true"></i></button>',controls+='<button type="button" class="poodll_mediarecorder_button_bmr poodll_stop-recording_bmr bmr_disabled" disabled><i class="fa fa-stop" aria-hidden="true"></i></button>',controls+='<button type="button" class="poodll_mediarecorder_button_bmr poodll_pause-recording_bmr bmr_disabled" disabled><i class="fa fa-pause" aria-hidden="true"></i></button>',controls+=' <button type="button" class="poodll_mediarecorder_button_bmr poodll_play-recording_bmr bmr_disabled" disabled><i class="fa fa-play" aria-hidden="true"></i></button>',controls+='<button type="button" class="poodll_save-recording_bmr '+hideshowupload+'" disabled>'+ss.recui_save+"</button>",controls+="</div>",controls+=this.devsettings.fetch_dialogue_box(),controls+=ip.downloaddialog.fetch_dialogue_box(),controls+=ip.errordialog.fetch_dialogue_box(),controls+="</div>",controls+="</div>",$(element).prepend(controls);var controlbar={poodll_recording_alert:$("#"+controlbarid+" .poodll-alert-recording"),bmr_progresscanvas:$("#"+controlbarid+" .bmr_range"),settingsdialog:$("#"+controlbarid+" .poodll_dialogue_box_settings"),downloaddialog:$("#"+controlbarid+" .poodll_dialogue_box_download"),errorsdialog:$("#"+controlbarid+" .poodll_dialogue_box_errors"),settingsicon:$("#"+controlbarid+" .settingsicon"),status:$("#"+controlbarid+" .poodll_status_bmr"),preview:$("#"+controlbarid+" .poodll_preview_bmr"),startbutton:$("#"+controlbarid+" .poodll_start-recording_bmr"),stopbutton:$("#"+controlbarid+" .poodll_stop-recording_bmr"),pausebutton:$("#"+controlbarid+" .poodll_pause-recording_bmr"),resumebutton:$("#"+controlbarid+" .poodll_resume-recording_bmr"),playbutton:$("#"+controlbarid+" .poodll_play-recording_bmr"),savebutton:$("#"+controlbarid+" .poodll_save-recording_bmr")};return ip.downloaddialog.set_dialogue_box(controlbar.downloaddialog),ip.errordialog.set_dialogue_box(controlbar.errorsdialog),this.devsettings.set_dialogue_box(controlbar.settingsdialog),controlbar},register_controlbar_events_video:function(onMediaSuccess,controlbarid){return this.register_controlbar_events_audio(onMediaSuccess,controlbarid)},register_controlbar_events_audio:function(onMediaSuccess,controlbarid){var self=this,pmr=this.pmr,ip=this.fetch_instanceprops(controlbarid);ip.controlbar.settingsicon.click((function(){self.uploaded?ip.downloaddialog.open():self.devsettings.open()}));var hprogress=anim_progress_bar.clone();hprogress.init(ip.controlbar.bmr_progresscanvas),ip.controlbar.startbutton.click((function(){pmr.do_start_audio(ip,onMediaSuccess)})),ip.controlbar.stopbutton.click((function(){pmr.do_stop_audio(ip);var preview=ip.controlbar.preview;preview&&preview.get(0)&&preview.get(0).pause(),ip.timer.stop(),self.update_status(controlbarid),self.set_visual_mode("previewmode",controlbarid)})),ip.controlbar.pausebutton.click((function(){pmr.do_pause_audio(ip),ip.timer.pause(),self.update_status(controlbarid),self.set_visual_mode("pausedmode",controlbarid)})),ip.controlbar.resumebutton.click((function(){pmr.do_resume_audio(ip),ip.timer.resume(),self.update_status(controlbarid),self.set_visual_mode("recordmode",controlbarid)})),ip.controlbar.preview.on("timeupdate",(function(){if("playmode"==self.visualmode){var currentTime=this.currentTime;ip.controlbar.status.html(ip.timer.fetch_display_time(currentTime))}})),ip.controlbar.playbutton.click((function(){var preview=ip.controlbar.preview.get(0);pmr.do_play_audio(ip,preview),self.set_visual_mode("playmode",controlbarid),hprogress.clear(),hprogress.fetchCurrent=function(){var ct=ip.controlbar.preview.prop("currentTime"),duration=ip.controlbar.preview.prop("duration");return isFinite(duration)||(duration=ip.timer.finalseconds),ct/duration},hprogress.start()})),ip.controlbar.savebutton.click((function(){return ip.blobs&&ip.blobs.length>0?(self.set_visual_mode("uploadmode",controlbarid),pmr.do_save_audio(ip),self.uploaded=!0):ip.uploader.Output(M.util.get_string("recui_nothingtosaveerror","filter_poodll")),!1})),window.onbeforeunload=function(){self.enable_button(ip.controlbar.startbutton);var preview=ip.controlbar.preview;preview&&preview.get(0)&&(preview.get(0).pause(),preview.get(0).controls=!1)}},show_element:function(element){$(element).removeClass("hide"),$(element).show()},hide_element:function(element){$(element).addClass("hide"),$(element).hide()},enable_button:function(button){$(button).attr("disabled",!1),$(button).removeClass("bmr_disabled")},disable_button:function(button){$(button).attr("disabled",!0),$(button).addClass("bmr_disabled")}}}));
define('filter_poodll/poodll_readaloudmediaskin', ["jquery","core/log","filter_poodll/utils_amd","filter_poodll/upskin_radial","filter_poodll/anim_hwave_mic","filter_poodll/dlg_devicesettings"],(function($,log,utils,upskin_radial,hwave_mic,settings){return log.debug("PoodLL Read Aloud Skin: initialising"),{instanceprops:null,pmr:null,devsettings:null,therecanim:null,clone:function(){return $.extend(!0,{},this)},init:function(ip,pmr){this.instanceprops=ip,this.pmr=pmr,this.devsettings=settings.clone(),this.devsettings.init(pmr,ip)},fetch_instanceprops:function(){return this.instanceprops},onUploadSuccess:function(controlbarid){$("#"+controlbarid+" > .poodll_save-recording").hide(),$("#"+controlbarid+" > .poodll_savedsuccessfully").show()},onUploadFailure:function(controlbarid){},fetch_status_bar:function(skin){return'<div class="poodll_status_'+skin+'" width="320" height="50">00:00:00</div>'},fetch_preview_audio:function(skin){return'<audio class="poodll_preview_'+skin+' hide" playsInline muted></audio>'},fetch_preview_video:function(skin){return this.fetch_preview_audio(skin)},fetch_resource_audio:function(skin){return'<audio class="poodll_resourceplayer_'+skin+' hide" ></audio>'},fetch_resource_video:function(skin){return this.fetch_resource_audio(skin)},onMediaError:function(e){console.error("media error",e)},onMediaSuccess_video:function(controlbarid){this.fetch_instanceprops(controlbarid);this.set_visual_mode("recordingmode",controlbarid)},onMediaSuccess_audio:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.preview.attr("src",null),ip.uploader.Output(""),this.therecanim.start(),ip.timer.reset(),ip.timer.start(),this.update_status(controlbarid),this.set_visual_mode("recordingmode",controlbarid)},handle_timer_update:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.status.html(ip.timer.fetch_display_time()),0==ip.timer.seconds&&ip.timer.initseconds>0&&ip.controlbar.stopbutton.click()},update_status:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.status.html(ip.timer.fetch_display_time())},fetch_uploader_skin:function(controlbarid,element){var ip=this.fetch_instanceprops(controlbarid),upskin=upskin_radial.clone();return upskin.init(ip.config,element,ip.controlbar.playcanvas,ip.controlbar.status),upskin},set_visual_mode:function(mode,controlbarid){var ip=this.fetch_instanceprops(controlbarid);switch(mode){case"startmode":ip.controlbar.status.hide(),this.disable_button(ip.controlbar.startbutton),this.enable_button(ip.controlbar.testbutton),this.disable_button(ip.controlbar.placeholderbutton),this.disable_button(ip.controlbar.stopbutton),this.therecanim.clear();break;case"testingmode":ip.controlbar.status.hide(),this.disable_button(ip.controlbar.startbutton),this.disable_button(ip.controlbar.testbutton),this.enable_button(ip.controlbar.placeholderbutton),this.disable_button(ip.controlbar.stopbutton);break;case"readymode":ip.controlbar.status.hide(),this.enable_button(ip.controlbar.startbutton),this.disable_button(ip.controlbar.testbutton),this.disable_button(ip.controlbar.placeholderbutton),this.disable_button(ip.controlbar.stopbutton),this.therecanim.clear();break;case"recordingmode":"1"==ip.config.allowearlyexit&&ip.timer.enabled?this.enable_button(ip.controlbar.stopbutton):this.enable_button(ip.controlbar.placeholderbutton),this.disable_button(ip.controlbar.startbutton),ip.controlbar.status.hide();break;case"aftermode":this.disable_button(ip.controlbar.startbutton),this.disable_button(ip.controlbar.stopbutton),this.disable_button(ip.controlbar.placeholderbutton),ip.controlbar.status.show()}},insert_controlbar_video:function(element,controlbarid,preview,resource){return this.prepare_controlbar_audio(element,controlbarid,preview,resource)},insert_controlbar_audio:function(element,controlbarid,preview,resource){return this.prepare_controlbar(element,controlbarid,preview,resource,"audio")},prepare_controlbar:function(element,controlbarid,preview,resource,mediatype){var ip=this.fetch_instanceprops(controlbarid),skin_style=ip.config.media_skin_style,ss_startlabel=(this.pmr.fetch_strings(),M.util.get_string("recui_startactivity","filter_poodll")),ss_testlabel=M.util.get_string("recui_testmic","filter_poodll"),ss_stoplabel=M.util.get_string("recui_stop","filter_poodll"),status=this.fetch_status_bar("readaloud"),controls='<div class="poodll_mediarecorderholder_readaloud poodll_mediarecorder_audio" id="holder_'+controlbarid+'">';controls+='<div class="poodll_mediarecorderbox_readaloud" id="'+controlbarid+'">',controls+=this.devsettings.fetch_dialogue_box(),controls+=ip.downloaddialog.fetch_dialogue_box(),controls+=ip.errordialog.fetch_dialogue_box(),controls+='<div class="style-holder '+skin_style+'">',controls+=preview,controls+='<div class="settingsicon" id="settingsicon_'+controlbarid+'"><button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal"><i class="fa fa-cogs" aria-hidden="true"></i></button></div>',controls+='<canvas id="'+controlbarid+'_playcanvas" width="250" height="120"></canvas>',controls+='<button type="button" class="poodll_mediarecorder_button_readaloud poodll_start-recording_readaloud">'+ss_startlabel+"</button>",controls+='<button type="button" class="poodll_mediarecorder_button_readaloud poodll_test-recording_readaloud">'+ss_testlabel+"</button>",controls+='<button type="button" class="poodll_mediarecorder_button_readaloud poodll_testing-placeholder_readaloud" style="background-color: #CCCCCC;">'+ss_testlabel+"</button>",controls+='<button type="button" class="poodll_mediarecorder_button_readaloud poodll_stop-recording_readaloud">'+ss_stoplabel+"</button>",controls+=status,controls+="</div></div></div>",$(element).prepend(controls);var controlbar={settingsdialog:$("#"+controlbarid+" .poodll_dialogue_box_settings"),downloaddialog:$("#"+controlbarid+" .poodll_dialogue_box_download"),errorsdialog:$("#"+controlbarid+" .poodll_dialogue_box_errors"),settingsicon:$("#"+controlbarid+" .settingsicon"),status:$("#"+controlbarid+" .poodll_status_readaloud"),preview:$("#"+controlbarid+" .poodll_preview_readaloud"),startbutton:$("#"+controlbarid+" .poodll_start-recording_readaloud"),testbutton:$("#"+controlbarid+" .poodll_test-recording_readaloud"),placeholderbutton:$("#"+controlbarid+" .poodll_testing-placeholder_readaloud"),stopbutton:$("#"+controlbarid+" .poodll_stop-recording_readaloud"),playcanvas:$("#"+controlbarid+"_playcanvas")};return ip.downloaddialog.set_dialogue_box(controlbar.downloaddialog),ip.errordialog.set_dialogue_box(controlbar.errorsdialog),this.devsettings.set_dialogue_box(controlbar.settingsdialog),controlbar},register_controlbar_events_video:function(onMediaSuccess,controlbarid){return this.register_controlbar_events_audio(onMediaSuccess,controlbarid)},register_controlbar_events_audio:function(onMediaSuccess,controlbarid){var self=this,pmr=this.pmr,ip=this.fetch_instanceprops(controlbarid);ip.config.recanim="hwave_mic";var recanim=hwave_mic.clone();self.therecanim=recanim,recanim.init(ip.audioanalyser,ip.controlbar.playcanvas.get(0)),this.set_visual_mode("startmode",controlbarid),ip.controlbar.testbutton.click((function(){ip.config.hermes.disable(),ip.timer.disable();pmr.do_start_audio(ip,onMediaSuccess),self.set_visual_mode("testingmode",controlbarid),setTimeout((function(){pmr.do_stop_audio(ip),recanim.clear(),recanim.sounddetected&&self.set_visual_mode("readymode",controlbarid)}),4e3)})),ip.controlbar.settingsicon.click((function(){self.uploaded?ip.downloaddialog.open():self.devsettings.open()})),ip.controlbar.startbutton.click((function(){ip.config.hermes.enable(),ip.timer.enable(),pmr.do_start_audio(ip,onMediaSuccess)})),ip.controlbar.stopbutton.click((function(){pmr.do_stop_audio(ip),recanim.clear(),ip.timer.stop(),self.update_status(controlbarid);setTimeout((function doDeferredUpload(){ip.blobs&&ip.blobs.length>0?(pmr.do_save_audio(ip),ip.uploaded=!0,self.disable_button(ip.controlbar.startbutton)):setTimeout(doDeferredUpload,200)}),200),self.set_visual_mode("aftermode",controlbarid)})),window.onbeforeunload=function(){}},enable_button:function(button){$(button).attr("disabled",!1),$(button).removeClass("pmr_disabled")},disable_button:function(button){$(button).attr("disabled",!0),$(button).addClass("pmr_disabled")}}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}!function(e){var t;function a(){var e=Error.apply(this,arguments);e.name=this.name="FlashError",this.stack=e.stack,this.message=e.message}function s(){var e=Error.apply(this,arguments);e.name=this.name="WebcamError",this.stack=e.stack,this.message=e.message}IntermediateInheritor=function(){},IntermediateInheritor.prototype=Error.prototype,a.prototype=new IntermediateInheritor,s.prototype=new IntermediateInheritor;var Webcam={version:"1.0.15",protocol:location.protocol.match(/https/i)?"https":"http",loaded:!1,live:!1,userMedia:!0,params:{width:0,height:0,dest_width:0,dest_height:0,image_format:"jpeg",jpeg_quality:90,enable_flash:!0,force_flash:!1,flip_horiz:!1,fps:30,upload_name:"webcam",constraints:null,swfURL:"",flashNotDetectedText:"ERROR: No Adobe Flash Player detected.  Webcam.js relies on Flash for browsers that do not support getUserMedia (like yours).",noInterfaceFoundText:"No supported webcam interface found.",unfreeze_snap:!0},errors:{FlashError:a,WebcamError:s},hooks:{},init:function(){var t=this;this.mediaDevices=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices:navigator.mozGetUserMedia||navigator.webkitGetUserMedia?{getUserMedia:function(e){return new Promise((function(t,a){(navigator.mozGetUserMedia||navigator.webkitGetUserMedia).call(navigator,e,t,a)}))}}:null,e.URL=e.URL||e.webkitURL||e.mozURL||e.msURL,this.userMedia=this.userMedia&&!!this.mediaDevices&&!!e.URL,navigator.userAgent.match(/Firefox\D+(\d+)/)&&parseInt(RegExp.$1,10)<21&&(this.userMedia=null),this.userMedia&&e.addEventListener("beforeunload",(function(e){t.reset()}))},attach:function(a){if("string"==typeof a&&(a=document.getElementById(a)||document.querySelector(a)),!a)return this.dispatch("error",new s("Could not locate DOM element to attach to."));this.container=a,a.innerHTML="";var i=document.createElement("div");if(a.appendChild(i),this.peg=i,this.params.width||(this.params.width=a.offsetWidth),this.params.height||(this.params.height=a.offsetHeight),!this.params.width||!this.params.height)return this.dispatch("error",new s("No width and/or height for webcam.  Please call set() first, or attach to a visible element."));this.params.dest_width||(this.params.dest_width=this.params.width),this.params.dest_height||(this.params.dest_height=this.params.height),this.userMedia=void 0===t?this.userMedia:t,this.params.force_flash&&(t=this.userMedia,this.userMedia=null),"number"!=typeof this.params.fps&&(this.params.fps=30);var r=this.params.width/this.params.dest_width,o=this.params.height/this.params.dest_height;if(this.userMedia){var n=document.createElement("video");n.setAttribute("autoplay","autoplay"),n.style.width=this.params.dest_width+"px",n.style.height=this.params.dest_height+"px",1==r&&1==o||(a.style.overflow="hidden",n.style.webkitTransformOrigin="0px 0px",n.style.mozTransformOrigin="0px 0px",n.style.msTransformOrigin="0px 0px",n.style.oTransformOrigin="0px 0px",n.style.transformOrigin="0px 0px",n.style.webkitTransform="scaleX("+r+") scaleY("+o+")",n.style.mozTransform="scaleX("+r+") scaleY("+o+")",n.style.msTransform="scaleX("+r+") scaleY("+o+")",n.style.oTransform="scaleX("+r+") scaleY("+o+")",n.style.transform="scaleX("+r+") scaleY("+o+")"),a.appendChild(n),this.video=n;var h=this;this.mediaDevices.getUserMedia({audio:!1,video:this.params.constraints||{mandatory:{minWidth:this.params.dest_width,minHeight:this.params.dest_height}}}).then((function(t){n.onloadedmetadata=function(e){h.stream=t,h.loaded=!0,h.live=!0,h.dispatch("load"),h.dispatch("live"),h.flip()},n.srcObject=t||t})).catch((function(e){h.params.enable_flash&&h.detectFlash()?setTimeout((function(){h.params.force_flash=1,h.attach(a)}),1):h.dispatch("error",e)}))}else if(this.params.enable_flash&&this.detectFlash()){e.Webcam=Webcam;var l=document.createElement("div");l.innerHTML=this.getSWFHTML(),a.appendChild(l)}else this.dispatch("error",new s(this.params.noInterfaceFoundText));if(this.params.crop_width&&this.params.crop_height){var c=Math.floor(this.params.crop_width*r),m=Math.floor(this.params.crop_height*o);a.style.width=c+"px",a.style.height=m+"px",a.style.overflow="hidden",a.scrollLeft=Math.floor(this.params.width/2-c/2),a.scrollTop=Math.floor(this.params.height/2-m/2)}else a.style.width=this.params.width+"px",a.style.height=this.params.height+"px"},reset:function(){if(this.preview_active&&this.unfreeze(),this.unflip(),this.userMedia){if(this.stream)if(this.stream.getVideoTracks){var e=this.stream.getVideoTracks();e&&e[0]&&e[0].stop&&e[0].stop()}else this.stream.stop&&this.stream.stop();delete this.stream,delete this.video}!0!==this.userMedia&&this.getMovie()._releaseCamera(),this.container&&(this.container.innerHTML="",delete this.container),this.loaded=!1,this.live=!1},set:function(){if(1==arguments.length)for(var e in arguments[0])this.params[e]=arguments[0][e];else this.params[arguments[0]]=arguments[1]},on:function(e,t){e=e.replace(/^on/i,"").toLowerCase(),this.hooks[e]||(this.hooks[e]=[]),this.hooks[e].push(t)},off:function(e,t){if(e=e.replace(/^on/i,"").toLowerCase(),this.hooks[e])if(t){var a=this.hooks[e].indexOf(t);a>-1&&this.hooks[e].splice(a,1)}else this.hooks[e]=[]},dispatch:function(){var t=arguments[0].replace(/^on/i,"").toLowerCase(),i=Array.prototype.slice.call(arguments,1);if(this.hooks[t]&&this.hooks[t].length){for(var r=0,o=this.hooks[t].length;r<o;r++){var n=this.hooks[t][r];"function"==typeof n?n.apply(this,i):"object"==_typeof(n)&&2==n.length?n[0][n[1]].apply(n[0],i):e[n]&&e[n].apply(e,i)}return!0}return"error"==t&&(i[0]instanceof a||i[0]instanceof s?message=i[0].message:message="Could not access webcam: "+i[0].name+": "+i[0].message+" "+i[0].toString(),alert("Webcam.js Error: "+message)),!1},setSWFLocation:function(e){this.set("swfURL",e)},detectFlash:function(){var t="Shockwave Flash",s="application/x-shockwave-flash",i=e,r=navigator,o=!1;if(void 0!==r.plugins&&"object"===_typeof(r.plugins[t]))r.plugins[t].description&&void 0!==r.mimeTypes&&r.mimeTypes[s]&&r.mimeTypes[s].enabledPlugin&&(o=!0);else if(void 0!==i.ActiveXObject)try{var h=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(h)h.GetVariable("$version")&&(o=!0)}catch(c){}return o},getSWFHTML:function(){var t="",s=this.params.swfURL;if(location.protocol.match(/file/))return this.dispatch("error",new a("Flash does not work from local disk.  Please run from a web server.")),'<h3 style="color:red">ERROR: the Webcam.js Flash fallback does not work from local disk.  Please run it from a web server.</h3>';if(!this.detectFlash())return this.dispatch("error",new a("Adobe Flash Player not found.  Please install from get.adobe.com/flashplayer and try again.")),'<h3 style="color:red">'+this.params.flashNotDetectedText+"</h3>";if(!s){for(var i="",r=document.getElementsByTagName("script"),o=0,n=r.length;o<n;o++){var h=r[o].getAttribute("src");h&&h.match(/\/webcam(\.min)?\.js/)&&(i=h.replace(/\/webcam(\.min)?\.js.*$/,""),o=n)}s=i?i+"/webcam.swf":"webcam.swf"}e.localStorage&&!localStorage.getItem("visited")&&(this.params.new_user=1,localStorage.setItem("visited",1));var l="";for(var c in this.params)l&&(l+="&"),l+=c+"="+escape(this.params[c]);return t+='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" type="application/x-shockwave-flash" codebase="'+this.protocol+'://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+this.params.width+'" height="'+this.params.height+'" id="webcam_movie_obj" align="middle"><param name="wmode" value="opaque" /><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+s+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+l+'"/><embed id="webcam_movie_embed" src="'+s+'" wmode="opaque" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+this.params.width+'" height="'+this.params.height+'" name="webcam_movie_embed" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+l+'"></embed></object>'},getMovie:function(){if(!this.loaded)return this.dispatch("error",new a("Flash Movie is not loaded yet"));var e=document.getElementById("webcam_movie_obj");return e&&e._snap||(e=document.getElementById("webcam_movie_embed")),e||this.dispatch("error",new a("Cannot locate Flash movie in DOM")),e},freeze:function(){var e=this,t=this.params;this.preview_active&&this.unfreeze();var a=this.params.width/this.params.dest_width,s=this.params.height/this.params.dest_height;this.unflip();var i=t.crop_width||t.dest_width,r=t.crop_height||t.dest_height,o=document.createElement("canvas");o.width=i,o.height=r;var n=o.getContext("2d");this.preview_canvas=o,this.preview_context=n,1==a&&1==s||(o.style.webkitTransformOrigin="0px 0px",o.style.mozTransformOrigin="0px 0px",o.style.msTransformOrigin="0px 0px",o.style.oTransformOrigin="0px 0px",o.style.transformOrigin="0px 0px",o.style.webkitTransform="scaleX("+a+") scaleY("+s+")",o.style.mozTransform="scaleX("+a+") scaleY("+s+")",o.style.msTransform="scaleX("+a+") scaleY("+s+")",o.style.oTransform="scaleX("+a+") scaleY("+s+")",o.style.transform="scaleX("+a+") scaleY("+s+")"),this.snap((function(){o.style.position="relative",o.style.left=e.container.scrollLeft+"px",o.style.top=e.container.scrollTop+"px",e.container.insertBefore(o,e.peg),e.container.style.overflow="hidden",e.preview_active=!0}),o)},unfreeze:function(){this.preview_active&&(this.container.removeChild(this.preview_canvas),delete this.preview_context,delete this.preview_canvas,this.preview_active=!1,this.flip())},flip:function(){if(this.params.flip_horiz){var e=this.container.style;e.webkitTransform="scaleX(-1)",e.mozTransform="scaleX(-1)",e.msTransform="scaleX(-1)",e.oTransform="scaleX(-1)",e.transform="scaleX(-1)",e.filter="FlipH",e.msFilter="FlipH"}},unflip:function(){if(this.params.flip_horiz){var e=this.container.style;e.webkitTransform="scaleX(1)",e.mozTransform="scaleX(1)",e.msTransform="scaleX(1)",e.oTransform="scaleX(1)",e.transform="scaleX(1)",e.filter="",e.msFilter=""}},savePreview:function(e,t){var a=this.params,s=this.preview_canvas,i=this.preview_context;t&&t.getContext("2d").drawImage(s,0,0);e(t?null:s.toDataURL("image/"+a.image_format,a.jpeg_quality/100),s,i),this.params.unfreeze_snap&&this.unfreeze()},snap:function(e,t){var i=this.params;if(!this.loaded)return this.dispatch("error",new s("Webcam is not loaded yet"));if(!e)return this.dispatch("error",new s("Please provide a callback function or canvas to snap()"));if(this.preview_active)return this.savePreview(e,t),null;var r=document.createElement("canvas");r.width=this.params.dest_width,r.height=this.params.dest_height;var o=r.getContext("2d");this.params.flip_horiz&&(o.translate(i.dest_width,0),o.scale(-1,1));var n=function(){if(this.src&&this.width&&this.height&&o.drawImage(this,0,0,i.dest_width,i.dest_height),i.crop_width&&i.crop_height){var a=document.createElement("canvas");a.width=i.crop_width,a.height=i.crop_height;var s=a.getContext("2d");s.drawImage(r,Math.floor(i.dest_width/2-i.crop_width/2),Math.floor(i.dest_height/2-i.crop_height/2),i.crop_width,i.crop_height,0,0,i.crop_width,i.crop_height),o=s,r=a}if(t){var n=t.getContext("2d");n.drawImage(r,0,0)}e(t?null:r.toDataURL("image/"+i.image_format,i.jpeg_quality/100),r,o)};if(this.userMedia)o.drawImage(this.video,0,0,this.params.dest_width,this.params.dest_height),n();else{var h=this.getMovie()._snap(),l=new Image;l.onload=n,l.src="data:image/"+this.params.image_format+";base64,"+h}return null},configure:function(e){e||(e="camera"),this.getMovie()._configure(e)},flashNotify:function(e,t){switch(e){case"flashLoadComplete":this.loaded=!0,this.dispatch("load");break;case"cameraLive":this.live=!0,this.dispatch("live");break;case"error":this.dispatch("error",new a(t))}},b64ToUint6:function(e){return e>64&&e<91?e-65:e>96&&e<123?e-71:e>47&&e<58?e+4:43===e?62:47===e?63:0},base64DecToArr:function(e,t){for(var o,n,a=e.replace(/[^A-Za-z0-9\+\/]/g,""),s=a.length,i=t?Math.ceil((3*s+1>>2)/t)*t:3*s+1>>2,r=new Uint8Array(i),h=0,l=0,c=0;c<s;c++)if(n=3&c,h|=this.b64ToUint6(a.charCodeAt(c))<<18-6*n,3===n||s-c==1){for(o=0;o<3&&l<i;o++,l++)r[l]=h>>>(16>>>o&24)&255;h=0}return r},upload:function(e,t,a){var s=this.params.upload_name||"webcam",i="";if(!e.match(/^data\:image\/(\w+)/))throw"Cannot locate image format in Data URI";i=RegExp.$1;var r=e.replace(/^data\:image\/\w+\;base64\,/,""),o=new XMLHttpRequest;o.open("POST",t,!0),o.upload&&o.upload.addEventListener&&o.upload.addEventListener("progress",(function(e){if(e.lengthComputable){var t=e.loaded/e.total;Webcam.dispatch("uploadProgress",t,e)}}),!1);var n=this;o.onload=function(){a&&a.apply(n,[o.status,o.responseText,o.statusText]),Webcam.dispatch("uploadComplete",o.status,o.responseText,o.statusText)};var h=new Blob([this.base64DecToArr(r)],{type:"image/"+i}),l=new FormData;l.append(s,h,s+"."+i.replace(/e/,"")),o.send(l)}};Webcam.init(),"function"==typeof define&&define.amd?define("filter_poodll/webcam",(function(){return Webcam})):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=Webcam:e.Webcam=Webcam}(window);
define('filter_poodll/anim_hwave', ["jquery","core/log"],(function($,log){return log.debug("anim_horizontal_wave: initialising"),{analyser:null,cvs:null,cvsctx:null,drawparams:{wavColor:"#0",barColor:"#ad2323",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:10,shadowColor:"#fff",font:"18px Arial",textAlign:"center",textBaseline:"middle"},clone:function(){return $.extend(!0,{},this)},init:function(analyser,cvs){this.cvs=cvs,this.cvsctx=cvs.getContext("2d"),this.analyser=analyser,this.clear()},setDrawParam:function(paramkey,paramvalue){this.drawparams[paramkey]=paramvalue},clear:function(){this.cvsctx.clearRect(0,0,this.cvs.width,this.cvs.height),this.cvsctx.lineWidth=2,this.cvsctx.strokeStyle=this.drawparams.wavColor,this.cvsctx.beginPath(),this.cvsctx.moveTo(0,this.cvs.height/2),this.cvsctx.lineTo(this.cvs.width,this.cvs.height/2),this.cvsctx.stroke()},start:function(){this.analyser.core.fftSize=2048;var bufferLength=this.analyser.core.fftSize,dataArray=new Uint8Array(bufferLength),cwidth=this.cvs.width,cheight=this.cvs.height,canvasCtx=this.cvsctx,analyser=this.analyser;this.clear();var that=this;!function draw(){requestAnimationFrame(draw);if(analyser.theinterval){analyser.core.getByteTimeDomainData(dataArray),canvasCtx.clearRect(0,0,cwidth,cheight),canvasCtx.lineWidth=2,canvasCtx.strokeStyle=that.drawparams.wavColor,canvasCtx.beginPath();for(var sliceWidth=1*cwidth/bufferLength,x=0,i=0;i<bufferLength;i++){var y=dataArray[i]/128*cheight/2;0===i?canvasCtx.moveTo(x,y):canvasCtx.lineTo(x,y),x+=sliceWidth}canvasCtx.lineTo(cwidth,cheight/2),canvasCtx.stroke()}}()}}}));
define('filter_poodll/poodll_red5recorder', ["jquery","core/log","filter_poodll/utils_amd","filter_poodll/uploader","filter_poodll/lzloader"],(function($,log,utils,uploader,lz){return log.debug("PoodLL Red5 Recorder: initialising"),{supports_current_browser:function(config){var iOS=utils.is_ios(),isAndroid=utils.is_android();return!(iOS||config.flashonandroid<1&&isAndroid)&&(("audio"==config.mediatype||"video"==config.mediatype)&&(log.debug("PoodLL Red5 Recorder: supports this browser"),!0))},embed:function(element,config){if("video"===config.mediatype)var swfopts=$.parseJSON(config.red5video_widgetjson);else swfopts=$.parseJSON(config.red5audio_widgetjson);lz.embed.swf(swfopts)}}}));
define('filter_poodll/poodll_snapshotrecorder', ["jquery","core/log","filter_poodll/utils_amd","filter_poodll/uploader","filter_poodll/webcam"],(function($,log,utils,uploader,Webcam){return log.debug("PoodLL Snapshot Recorder: initialising"),{instanceprops:[],fetch_instance_props:function(widgetid){return this.instanceprops[widgetid]},init_instance_props:function(widgetid){var props={imagefile:!1,htmlthings:"",config:null,uploader:null};this.instanceprops[widgetid]=props},supports_current_browser:function(config){return!utils.is_ios()&&("snapshot"==config.mediatype&&(log.debug("PoodLL Snapshot Recorder: supports this browser"),!0))},embed:function(element,config){this.init_instance_props(config.widgetid);var ip=this.fetch_instance_props(config.widgetid);ip.config=config,ip.uploader=uploader.clone(),ip.uploader.init(element,config),this.insert_controls(element,config.widgetid),this.register_events(config.widgetid)},insert_controls:function(element,widgetid){var ip=this.fetch_instance_props(widgetid),config=ip.config,htmlthings={camera:config.widgetid+"_poodll_snapshot_camera",preview:config.widgetid+"_poodll_snapshot_preview",snapbutton:config.widgetid+"_poodll_take-snapshot",savebutton:config.widgetid+"_poodll_save-snapshot",cancelbutton:config.widgetid+"_poodll_cancel-snapshot"};ip.htmlthings=htmlthings;var controls='<div id="'+htmlthings.camera+'" style="width:320px; height:240px;"></div>';controls+='<div id="'+htmlthings.preview+'" class="hide" style="width:320px; height:240px;"></div>',controls+='<button type="button" class="poodll_take-snapshot" id="'+htmlthings.snapbutton+'">'+M.util.get_string("recui_takesnapshot","filter_poodll")+"</button>",controls+='<button type="button" class="poodll_cancel-snapshot" id="'+htmlthings.cancelbutton+'">'+M.util.get_string("recui_cancelsnapshot","filter_poodll")+"</button>",controls+='<button type="button" class="poodll_save-recording" id="'+htmlthings.savebutton+'">'+M.util.get_string("recui_save","filter_poodll")+"</button>",$(element).prepend(controls)},register_events:function(widgetid){var ip=this.fetch_instance_props(widgetid);ip.config;Webcam.set("swfURL",M.cfg.wwwroot+"/filter/poodll/3rdparty/webcam/webcam.swf"),Webcam.attach("#"+ip.htmlthings.camera),$("#"+ip.htmlthings.savebutton).on("click",(function(e){if(ip.imagefile){var imageblob=ip.uploader.dataURItoBlob(ip.imagefile,"image/jpeg");ip.uploader.uploadFile(imageblob,"image/jpeg")}else ip.uploader.Output(M.util.get_string("recui_nothingtosaveerror","filter_poodll"))})),$("#"+ip.htmlthings.cancelbutton).on("click",(function(e){ip.imagefile=!1,$("#"+ip.htmlthings.preview).addClass("hide").html(""),$("#"+ip.htmlthings.camera).removeClass("hide")})),$("#"+ip.htmlthings.snapbutton).on("click",(function(e){Webcam.snap((function(data_uri){ip.imagefile=data_uri,$("#"+ip.htmlthings.preview).html('<img src="'+data_uri+'"/>').removeClass("hide"),$("#"+ip.htmlthings.camera).addClass("hide")}))}))}}}));
define('filter_poodll/poodll_mediarecorder', ["jquery","core/log","filter_poodll/utils_amd","filter_poodll/adapter","filter_poodll/uploader","filter_poodll/hermes","filter_poodll/timer","filter_poodll/audioanalyser","filter_poodll/msr_poodll","filter_poodll/dlg_errordisplay","filter_poodll/dlg_download","filter_poodll/speech_poodll","filter_poodll/poodll_mediaskins"],(function($,log,utils,adapter,uploader,hermes,timer,audioanalyser,poodll_msr,errordialog,downloaddialog,speechrecognition,mediaskins){return log.debug("PoodLL Media Recorder: initialising"),{instanceprops:[],skins:[],laststream:[],fetch_instanceprops:function(controlbarid){return this.instanceprops[controlbarid]},fetch_skin:function(controlbarid){return this.skins[controlbarid]},is_ios:function(){return utils.is_ios()},supports_current_browser:function(config){if(!(0==M.cfg.wwwroot.indexOf("https:")||0==M.cfg.wwwroot.indexOf("http://localhost")))return!1;if("audio"!=config.mediatype&&"video"!=config.mediatype)return!1;var ret=utils.can_html5_record(config.mediatype);return ret&&log.debug("PoodLL Media Recorder: supports this browser"),ret},embed:function(element,config){var that=this,controlbarid="filter_poodll_controlbar_"+config.widgetid;this.init_instance_props(controlbarid);var ip=this.fetch_instanceprops(controlbarid);ip.config=config,ip.controlbarid=controlbarid,config.hideupload?ip.showupload=!1:ip.showupload=!0,ip.timeinterval=config.media_timeinterval,ip.audiomimetype=config.media_audiomimetype,ip.videorecordertype=config.media_videorecordertype,ip.videocaptureheight=config.media_videocaptureheight,ip.errordialog=errordialog.clone(),ip.errordialog.init(ip),ip.downloaddialog=downloaddialog.clone(),ip.downloaddialog.init(this,ip),ip.config.hermes=hermes.clone(),ip.config.hermes.init(config.id,config.allowedURL,config.iframeembed);var theskin=this.init_skin(controlbarid,ip.config.media_skin,ip);switch(ip.config.speechevents&&ip.speechrec.will_work_ok(ip.config)?(ip.config.language||(ip.config.language="en-US"),ip.speechrec.init(ip.config),ip.speechrec.onfinalspeechcapture=function(speechtext,speechresults){var messageObject={type:"speech"};messageObject.capturedspeech=speechtext,messageObject.speechresults=speechresults,ip.config.hermes.postMessage(messageObject),theskin.hasOwnProperty("onfinalspeechcapture")&&theskin.onfinalspeechcapture(speechtext,speechresults)}):(log.debug("turning off speech events. not req. or not supported."),ip.config.speechevents=!1),ip.config.onuploadsuccess=function(widgetid){that.onUploadSuccess(widgetid,theskin)},ip.config.onuploadfailure=function(widgetid){that.onUploadFailure(widgetid,theskin)},config.mediatype){case"audio":var preview=theskin.fetch_preview_audio(config.media_skin),resource=theskin.fetch_resource_audio(config.media_skin);ip.controlbar=this.fetch_controlbar_audio(element,controlbarid,preview,resource),ip.uploader=uploader.clone();var upskin=theskin.fetch_uploader_skin(ip.controlbarid,element);if(ip.uploader.init(element,config,upskin),this.register_events_audio(controlbarid),"upload"==ip.config.media_skin||"warning"==ip.config.media_skin)break;navigator.mediaDevices.getUserMedia({audio:!0}).then((function(stream){log.debug("successfully forced permissions and got user media")})).catch((function(err){log.debug("location 9998"),log.debug(err),ip.errordialog.open(err)}));break;case"video":preview=theskin.fetch_preview_video(config.media_skin),resource=theskin.fetch_resource_video(config.media_skin);ip.controlbar=this.fetch_controlbar_video(element,controlbarid,preview,resource),ip.uploader=uploader.clone();upskin=theskin.fetch_uploader_skin(ip.controlbarid,element);if(ip.uploader.init(element,config,upskin),this.register_events_video(controlbarid),"upload"==ip.config.media_skin||"warning"==ip.config.media_skin||"screen"==ip.config.media_skin)break;navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((function(stream){that.restream_preview_video_player(controlbarid,stream)})).catch((function(err){log.debug("location 9999"),log.debug(err)}))}return ip.timer=timer.clone(),ip.timer.init(ip.config.timelimit,(function(){theskin.handle_timer_update(controlbarid)})),theskin.handle_timer_update(controlbarid),theskin},init_instance_props:function(controlbarid){this.instanceprops[controlbarid]={},this.instanceprops[controlbarid].recorded_index=0,this.instanceprops[controlbarid].mediaRecorder=null,this.instanceprops[controlbarid].blobs=[],this.instanceprops[controlbarid].timeinterval=1e3,this.instanceprops[controlbarid].audiomimetype="audio/webm",this.instanceprops[controlbarid].videorecordertype="auto",this.instanceprops[controlbarid].videocapturewidth=320,this.instanceprops[controlbarid].videocaptureheight=240,this.instanceprops[controlbarid].controlbar="",this.instanceprops[controlbarid].previewvolume=1,this.instanceprops[controlbarid].timer={},this.instanceprops[controlbarid].timer={},this.instanceprops[controlbarid].showupload=!0,this.instanceprops[controlbarid].uploader={},this.instanceprops[controlbarid].uploaded=!1,this.instanceprops[controlbarid].useraudiodeviceid=!1,this.instanceprops[controlbarid].uservideodeviceid=!1,this.instanceprops[controlbarid].devices=[];var AudioContext=window.AudioContext||window.webkitAudioContext||!1;if(void 0===window.poodllmediarecorder_actx){var ac=new AudioContext;window.poodllmediarecorder_actx=ac,window.poodllmediarecorder_actx_cnt=1}else if(6==window.poodllmediarecorder_actx_cnt){ac=window.poodllmediarecorder_actx;log.debug("More than 6 contexts, reusing first one. visualizations might go weird")}else{ac=new AudioContext;window.poodllmediarecorder_actx_cnt+=1}this.instanceprops[controlbarid].audioctx=ac;var aa=audioanalyser.clone();aa.init(ac),this.instanceprops[controlbarid].audioanalyser=aa,this.instanceprops[controlbarid].previewstillcold=!0,this.instanceprops[controlbarid].speechrec=speechrecognition.clone()},init_skin:function(controlbarid,skinname,instanceprops){return this.skins[controlbarid]=mediaskins.fetch_skin_clone(skinname),this.skins[controlbarid].init(instanceprops,this),this.skins[controlbarid]},onUploadSuccess:function(widgetid,theskin){log.debug("from poodllmediarecorder: uploadsuccess");var controlbarid="filter_poodll_controlbar_"+widgetid;theskin.onUploadSuccess(controlbarid)},onUploadFailure:function(widgetid,theskin){log.debug("from poodllmediarecorder: uploadfailure");var controlbarid="filter_poodll_controlbar_"+widgetid;theskin.onUploadFailure(controlbarid),theskin.fetch_instanceprops().downloaddialog.open(theskin.pmr,theskin.instanceprops)},onMediaError:function(e,ip){ip.hasOwnProperty("errordialog")&&ip.errordialog.open(e),log.error("media error",e)},captureUserMedia:function(mediaConstraints,successCallback,errorCallback){navigator.mediaDevices.getUserMedia(mediaConstraints).then(successCallback).catch(errorCallback)},warmup_context:function(ip){var ctx=ip.audioctx;"suspended"==ctx.state&&ctx.resume();var buffer=ctx.createBuffer(1,1,22050),source=ctx.createBufferSource();source.buffer=buffer,source.connect(ctx.destination),source.start(0)},warmup_preview:function(ip){var preview=ip.controlbar.preview;if(ip.previewstillcold&&preview&&preview.get(0)){var pPromise=ip.controlbar.preview[0].play();void 0!==pPromise&&pPromise.then((function(){})).catch((function(error){log.debug(error)})),ip.previewstillcold=!1}},do_start_audio:function(ip,onMediaSuccess){var that=this;switch(this.warmup_context(ip),this.warmup_preview(ip),ip.controlbar.preview[0].muted=!0,ip.blobs=[],ip.config.mediatype){case"audio":var mediaConstraints=this.fetch_audio_constraints(ip);break;case"video":mediaConstraints=this.fetch_video_constraints(ip)}this.captureUserMedia(mediaConstraints,onMediaSuccess,(function(e){that.onMediaError(e,ip)}))},do_start_screen:function(ip,onMediaSuccess){var that=this;this.warmup_context(ip),this.warmup_preview(ip),ip.controlbar.preview[0].muted=!0,ip.blobs=[];var mediaConstraints={audio:{echoCancellation:!0},video:{cursor:"motion"}};navigator.mediaDevices.getDisplayMedia(mediaConstraints).then((function(displayStream){if(ip.useraudiodeviceid){var audiodeviceid=ip.useraudiodeviceid.valueOf();mediaConstraints.audio.deviceId=audiodeviceid?{exact:audiodeviceid}:void 0}navigator.mediaDevices.getUserMedia({audio:mediaConstraints.audio,video:!1}).then((function(voiceStream){var tracks=displayStream.getTracks().concat(voiceStream.getAudioTracks()),stream=new MediaStream(tracks);onMediaSuccess(stream)}))})).catch((function(e){that.onMediaError(e,ip)}))},do_start_video:function(ip,onMediaSuccess){},do_stopplay_audio:function(ip,preview){switch(preview.pause(),preview.muted=!1,ip.config.mediatype){case"audio":break;case"video":ip.controlbar.hasOwnProperty("livepreview")&&(ip.controlbar.preview.hide(),ip.controlbar.preview=ip.controlbar.livepreview,ip.controlbar.preview.show())}},do_play_audio:function(ip,preview_unused){ip.blobs&&ip.blobs.length>0&&(log.debug("playing type:"+ip.blobs[0].type),log.debug(ip.blobs),utils.doConcatenateBlobs(ip.blobs,(function(concatenatedBlob){log.debug(concatenatedBlob);var mediaurl=URL.createObjectURL(concatenatedBlob);switch(ip.config.mediatype){case"audio":var preview=ip.controlbar.preview[0];break;case"video":ip.controlbar.livepreview=ip.controlbar.preview,ip.controlbar.preview=ip.controlbar.preview.clone().insertAfter(ip.controlbar.preview);preview=ip.controlbar.preview[0];ip.controlbar.livepreview.hide()}preview.src=mediaurl,preview.controls=!1,preview.volume=ip.previewvolume,preview.muted=!1,$(preview).bind("ended",(function(){ip.controlbar.stopbutton.click()}));var ppromise=preview.play();void 0!==ppromise&&ppromise.then((function(){})).catch((function(error){log.debug("location: do_play_audio"),log.debug(error)}))})))},do_play_video:function(ip){},do_save_audio:function(ip){ip.blobs&&ip.blobs.length>0&&(utils.doConcatenateBlobs(ip.blobs,(function(concatenatedBlob){ip.uploader.uploadBlob(concatenatedBlob,ip.blobs[0].type)})),ip.uploaded=!0,ip.controlbar.startbutton.attr("disabled",!0))},do_save_video:function(ip){},do_stop_audio:function(ip){ip.mediaRecorder.resume(),ip.mediaRecorder.stop(),ip.config.speechevents&&ip.speechrec.stop();var messageObject={type:"recording",action:"stopped"};ip.config.hermes.postMessage(messageObject)},do_stop_video:function(ip){},do_stop_screen:function(ip){},do_pause_audio:function(ip){ip.mediaRecorder.resume(),ip.mediaRecorder.pause()},do_pause_video:function(ip){},do_resume_audio:function(ip){ip.mediaRecorder.resume()},do_resume_video:function(ip){},fetch_video_constraints:function(ip){var mediaConstraints={audio:!utils.is_opera()&&!utils.is_edge(),video:{width:{ideal:640},height:{ideal:480}}};if(ip.uservideodeviceid){var videodeviceid=ip.uservideodeviceid.valueOf(),videoconstraints={deviceId:videodeviceid?{exact:videodeviceid}:void 0,width:{ideal:640},height:{ideal:480}};mediaConstraints.video=videoconstraints}if(ip.useraudiodeviceid){var audiodeviceid=ip.useraudiodeviceid.valueOf(),audioconstraints={deviceId:audiodeviceid?{exact:audiodeviceid}:void 0};mediaConstraints.audio=audioconstraints}return mediaConstraints},fetch_screen_constraints:function(ip){var mediaConstraints={audio:!utils.is_opera()&&!utils.is_edge(),video:!0};if(ip.uservideodeviceid){var videodeviceid=ip.uservideodeviceid.valueOf(),constraints={deviceId:videodeviceid?{exact:videodeviceid}:void 0};mediaConstraints.video=constraints}if(ip.useraudiodeviceid){var audiodeviceid=ip.useraudiodeviceid.valueOf();constraints={deviceId:audiodeviceid?{exact:audiodeviceid}:void 0};mediaConstraints.audio=constraints}return mediaConstraints},fetch_audio_constraints:function(ip){var mediaConstraints={audio:!0};if(utils.is_safari()&&!ip.useraudiodeviceid&&(ip.audiomimetype="audio/wav"),ip.useraudiodeviceid){var constraints={deviceId:ip.useraudiodeviceid};mediaConstraints.audio=constraints}return mediaConstraints},register_events_audio:function(controlbarid){var self=this,ip=this.fetch_instanceprops(controlbarid),skin=this.skins[controlbarid];skin.register_controlbar_events_audio((function(stream){self.laststream[controlbarid]=stream;var encoder="auto";if(ip.config.hasOwnProperty("encoder")&&(encoder=ip.config.encoder),ip.mediaRecorder=poodll_msr,ip.mediaRecorder.init(stream,ip.audioctx,ip.audioanalyser,ip.config.mediatype,encoder),ip.mediaRecorder.mimeType=ip.audiomimetype,ip.mediaRecorder.audioChannels=1,ip.mediaRecorder.start(ip.timeinterval,ip.audioctx),ip.mediaRecorder.ondataavailable=function(blob){ip.blobs.push(blob)},!ip.config.iframeembed&&ip.config.callbackjs&&""!=ip.config.callbackjs){var callbackObject=new Array;callbackObject[0]=ip.config.widgetid,callbackObject[1]="started",callbackObject[2]=ip.config.filename,callbackObject[3]=ip.config.updatecontrol,callbackObject[4]=ip.config.s3filename,"function"==typeof ip.config.callbackjs?ip.config.callbackjs(callbackObject):uploader.executeFunctionByName(ip.config.callbackjs,window,callbackObject)}var messageObject={type:"recording",action:"started"};ip.config.hermes.postMessage(messageObject),ip.config.speechevents&&ip.speechrec.start(stream),skin.onMediaSuccess_audio(controlbarid)}),controlbarid)},register_events_video:function(controlbarid){var self=this,ip=this.fetch_instanceprops(controlbarid),skin=this.skins[controlbarid];skin.register_controlbar_events_video((function(stream){self.restream_preview_video_player(controlbarid,stream);var encoder="auto";if(ip.config.hasOwnProperty("encoder")&&(encoder=ip.config.encoder),ip.mediaRecorder=poodll_msr,ip.mediaRecorder.init(stream,ip.audioctx,ip.audioanalyser,ip.config.mediatype,encoder),"mediarec"===ip.videorecordertype&&(ip.mediaRecorder.recorderType=MediaRecorderWrapper),ip.mediaRecorder.videoWidth=ip.videocapturewidth,ip.mediaRecorder.videoHeight=ip.videocaptureheight,ip.mediaRecorder.start(ip.timeinterval),ip.mediaRecorder.ondataavailable=function(blob){ip.blobs.push(blob)},!ip.config.iframeembed&&ip.config.callbackjs&&""!=ip.config.callbackjs){var callbackObject=new Array;callbackObject[0]=ip.config.widgetid,callbackObject[1]="started",callbackObject[2]=ip.config.filename,callbackObject[3]=ip.config.updatecontrol,callbackObject[4]=ip.config.s3filename,"function"==typeof ip.config.callbackjs?ip.config.callbackjs(callbackObject):uploader.executeFunctionByName(ip.config.callbackjs,window,callbackObject)}var messageObject={type:"recording",action:"started"};ip.config.hermes.postMessage(messageObject),ip.config.speechevents&&ip.speechrec.start(stream),skin.onMediaSuccess_video(controlbarid)}),controlbarid)},tidy_old_stream:function(controlbarid){this.laststream[controlbarid]&&this.laststream[controlbarid].getTracks().forEach((function(track){track.stop()}))},restream_preview_video_player:function(controlbarid,stream){this.laststream[controlbarid]=stream,this.init_video_preview(controlbarid),utils.is_android()&&navigator.mediaDevices.enumerateDevices()},init_video_preview:function(controlbarid){var preview=this.fetch_instanceprops(controlbarid).controlbar.preview[0];preview.srcObject=this.laststream[controlbarid],preview.controls=!1,preview.volume=0;var ppromise=preview.play();void 0!==ppromise&&ppromise.then((function(){})).catch((function(error){log.debug("location: init_video_preview"),log.debug(error)}))},update_status:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.status.html(ip.timer.fetch_display_time())},fetch_controlbar_audio:function(element,controlbarid,preview,resource){this.fetch_instanceprops(controlbarid);return this.fetch_skin(controlbarid).insert_controlbar_audio(element,controlbarid,preview,resource)},fetch_controlbar_video:function(element,controlbarid,preview,resource){this.fetch_instanceprops(controlbarid);return this.fetch_skin(controlbarid).insert_controlbar_video(element,controlbarid,preview,resource)},fetch_strings:function(){var ss=[];return $.each(["record","play","pause","continue","stop","save","restart","testmic","upload","recordagain","readytorecord","downloadfile"],(function(index,key){ss["recui_"+key]=M.util.get_string("recui_"+key,"filter_poodll"),(ss["recui_"+key].indexOf(",filter_poodll]]")>1||""==ss["recui_"+key])&&(ss["recui_"+key]=key)})),ss}}}));
define('filter_poodll/msr_stereoaudio', ["jquery","core/log","filter_poodll/msr_helper_stereoaudio"],(function($,log,helper){return log.debug("PoodLL Recorder: initialising"),{timeout:0,mediaRecorder:null,mediaStream:null,msr:null,mediaType:"audio",clone:function(){return $.extend(!0,{},this)},init:function(msr,mediaStream,audioctx,mediaType){this.msr=msr,this.mediaStream=mediaStream,this.audioctx=audioctx,this.mediaType=mediaType},start:function(timeSlice,audioctx){0!==this.timeout&&this.stop(),timeSlice=timeSlice||1e3;var that=this;this.mediaRecorder=helper.clone(),this.mediaRecorder.init(this.msr,this.mediaStream,this.audioctx),this.mediaRecorder.record(),this.timeout=setInterval((function(){that.mediaRecorder.requestData()}),timeSlice)},stop:function(){this.mediaRecorder&&(this.mediaRecorder.stop(),clearInterval(this.timeout),this.timeout=0)},pause:function(){this.mediaRecorder&&this.mediaRecorder.pause()},resume:function(){this.mediaRecorder&&this.mediaRecorder.resume()},ondataavailable:function(blob){log.debug("ondataavailable:"+blob)},onstop:function(error){log.debug(error)}}}));
define('filter_poodll/drawingboard_amd', ["jquery","core/log","filter_poodll/utils_amd","filter_poodll/uploader","filter_poodll/drawingboard"],(function($,log,utils,uploader,DrawingBoard){return log.debug("Filter PoodLL: drawingboard.js initialising"),{instanceprops:[],loaddrawingboard:function(opts){var theid="#amdopts_"+opts.recorderid,optscontrol=$(theid).get(0);if(optscontrol){if((opts=JSON.parse(optscontrol.value)).bgimage)var erasercolor="transparent";else{erasercolor="background";opts.bgimage="#FFF"}this.config=opts,$(theid).remove()}var element="#"+opts.recorderid+"drawing-board-id",db=new DrawingBoard.Board(opts.recorderid+"_drawing-board-id",{recorderid:opts.recorderid,size:3,background:opts.bgimage,controls:["Color",{Size:{type:"auto"}},{DrawingMode:{filler:!1,eraser:!0,pencil:!0}},"Navigation"],droppable:!0,webStorage:!1,enlargeYourContainer:!0,eraserColor:erasercolor});opts.db=db;var vectordata=opts.vectordata;vectordata&&0!=vectordata.indexOf('{"shapes"')&&0!=vectordata.indexOf('{"colors"')&&(db.history=Y.JSON.parse(vectordata),db.setImg(db.history.values[db.history.position-1])),opts.uploader=uploader.clone(),opts.uploader.init(element,opts),this.instanceprops[opts.recorderid]=opts,this.registerEvents(opts.recorderid)},registerEvents:function(recid){var opts=this.instanceprops[recid];if(opts.autosave){var doStopDrawing=function(){if(document.getElementById(recid+"_messages")){var th=utils.timeouthandles[recid];th&&clearTimeout(th),utils.timeouthandles[recid]=setTimeout((function(){utils.WhiteboardUploadHandler(recid,opts.db,opts,opts.uploader)}),opts.autosave)}};opts.db.ev.bind("board:startDrawing",(function(){var m=document.getElementById(recid+"_messages");if(m){m.innerHTML="File has not been saved.",document.getElementById(recid+"_btn_upload_whiteboard").disabled=!1;var th=utils.timeouthandles[recid];th&&clearTimeout(th),utils.timeouthandles[recid]=setTimeout((function(){utils.WhiteboardUploadHandler(recid,opts.db,opts,opts.uploader)}),opts.autosave)}})),opts.db.ev.bind("board:stopDrawing",doStopDrawing),opts.db.ev.bind("board:reset",doStopDrawing),opts.db.ev.bind("historyNavigation",doStopDrawing)}else{doStopDrawing=function(){var m=document.getElementById(recid+"_messages");m&&(m.innerHTML="File has not been saved.")};opts.db.ev.bind("board:stopDrawing",doStopDrawing)}var uploadbutton=$("#"+recid+"_btn_upload_whiteboard");uploadbutton&&(opts.autosave?uploadbutton.click((function(){utils.WhiteboardUploadHandler(recid,opts.db,opts,opts.uploader)})):uploadbutton.click((function(){var cvs=utils.getCvs(recid,opts.db,opts);utils.pokeVectorData(recid,opts.db,opts),opts.uploader.uploadFile(cvs.toDataURL(),"image/png")})))}}}));
define('filter_poodll/media_refresher', ["jquery","core/log"],(function($,log){return log.debug("Media refresher: initialising"),{placeholderduration:null,mediaduration:null,alertconverted:null,clone:function(){return $.extend(!0,{},this)},init:function(filename,placeholderduration,mediaduration,alertconverted){this.placeholderduration=placeholderduration,this.mediaduration=mediaduration,this.alertconverted=alertconverted,this.check_updates(filename,"firstpass")},should_be_checked:function(filename){return log.debug("mediaduration: "+this.mediaduration),log.debug("placeholderduration: "+this.placeholderduration),log.debug("fixed to one mediaduration: "+parseFloat(this.mediaduration).toFixed(1)),log.debug("fixed to one placeholderduration: "+parseFloat(this.placeholderduration).toFixed(1)),!!$.isNumeric(this.placeholderduration)&&(!!$.isNumeric(this.mediaduration)&&(parseFloat(this.mediaduration).toFixed(1)==parseFloat(this.placeholderduration).toFixed(1)&&""!=filename))},check_updates:function(filename,checktype){if(this.should_be_checked(filename),"firstpass"!=checktype||this.should_be_checked(filename)){var xhr=new XMLHttpRequest,that=this;xhr.onreadystatechange=function(e){if(4===this.readyState)if(200==xhr.status){var payload=xhr.responseText,payloadobject=JSON.parse(payload);if(payloadobject)switch(payloadobject.code){case"mediaready":that.alertconverted();break;case"stillwaiting":setTimeout((function(){that.check_updates(filename,"secondpass")}),15e3);break;case"notask":"secondpass"==checktype&&that.alertconverted()}}else log.debug("Not 200 response:"+xhr.status)};var params="filename="+filename;xhr.open("POST",M.cfg.wwwroot+"/filter/poodll/ajaxmediaquery.php",!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.setRequestHeader("Cache-Control","no-cache"),xhr.send(params)}}}}));
define('filter_poodll/anim_progress_radial', ["jquery","core/log"],(function($,log){return log.debug("Radial Progress: initialising"),{playcanvas:null,context:null,x:null,y:null,currenttime:0,enabled:!1,showpercent:!1,drawparams:{lineWidth:10,barColor:"#ad2323",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:10,shadowColor:"#fff",font:"18px Arial",textAlign:"center",textBaseline:"middle"},clone:function(){return $.extend(!0,{},this)},init:function(playcanvas,barcolor,showpercent){this.playcanvas=playcanvas.get(0),this.x=this.playcanvas.width/2,this.y=this.playcanvas.height/2,this.context=this.playcanvas.getContext("2d"),showpercent&&(this.showpercent=showpercent),showpercent&&this.setDrawParam("barColor",barcolor)},setDrawParam:function(paramkey,paramvalue){this.drawparams[paramkey]=paramvalue},clear:function(){this.context.clearRect(0,0,this.playcanvas.width,this.playcanvas.height)},fetchCurrent:function(){return 0},stop:function(){this.enabled=!1},start:function(){this.clear(),this.enabled=!0;var that=this;this.context.lineWidth=this.drawparams.lineWidth,this.context.strokeStyle=this.drawparams.barColor,this.context.setLineDash([]),this.context.shadowOffsetX=this.drawparams.shadowOffsetX,this.context.shadowOffsetY=this.drawparams.shadowOffsetY,this.context.shadowBlur=this.drawparams.shadowBlur,this.context.shadowColor=this.drawparams.shadowColor,this.context.font=this.drawparams.font,this.context.textAlign=this.drawparams.textAlign,this.context.textBaseline=this.drawparams.textBaseline;!function draw(){if(that.enabled){that.clear();var radius=Math.min(that.x,that.y)-that.context.lineWidth,circ=2*Math.PI,quart=Math.PI/2,current=that.fetchCurrent();that.context.beginPath(),that.context.arc(that.x,that.y,radius,-quart,circ*current-quart,!1),that.showpercent&&that.context.fillText(parseInt(100*current)+"%",that.x,that.y),that.context.stroke(),(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame)(draw)}}()}}}));
define('filter_poodll/msr_plain', ["jquery","core/log","filter_poodll/utils_amd"],(function($,log,utils){return log.debug("PoodLL Plain Recorder: initialising"),{timeout:0,mediaRecorder:null,mediaStream:null,audioctx:null,msr:null,mediaType:null,audioBitsPerSecond:12800,videoBitsPerSecond:25e5,clone:function(){return $.extend(!0,{},this)},init:function(msr,mediaStream,audioctx,mediaType){this.msr=msr,this.mediaStream=mediaStream,this.audioctx=audioctx,this.mediaType=mediaType},start:function(timeSlice,__disableLogs){var stream,that=this;"audio"===this.mediaType&&(this.mediaStream.getVideoTracks().length&&this.mediaStream.getAudioTracks().length&&(log.debug("Somehow we got a video stream, paring it down to just audio. "),navigator.mozGetUserMedia?(stream=new MediaStream).addTrack(this.mediaStream.getAudioTracks()[0]):stream=new MediaStream(this.mediaStream.getAudioTracks()),this.mediaStream=stream));if(this.mimeType=!1,"audio"===this.mediaType){if(MediaRecorder.isTypeSupported){for(var audiotypes=["ogg","webm","quicktime","mp4","m4a","wav"],i=0;i<audiotypes.length;i++){var themimetype="audio/"+audiotypes[i];if(MediaRecorder.isTypeSupported(themimetype)){this.mimeType=themimetype;break}}!1===this.mimeType&&(this.mimeType=utils.is_chrome()?"audio/webm":"audio/ogg")}else this.mimeType="audio/mp4";var rec_options={audioBitsPerSecond:this.audioBitsPerSecond,mimeType:this.mimeType}}else{if(MediaRecorder.isTypeSupported){var videotypes=["webm","ogv","quicktime","mp4","mpeg"];for(i=0;i<videotypes.length;i++){themimetype="video/"+videotypes[i];if(MediaRecorder.isTypeSupported(themimetype)){this.mimeType=themimetype;break}}!1===this.mimeType&&(this.mimeType="video/webm")}else this.mimeType="video/mp4";rec_options={mimeType:this.mimeType}}try{this.mediaRecorder=new MediaRecorder(this.mediaStream,rec_options)}catch(e){this.mediaRecorder=new MediaRecorder(this.mediaStream),log.debug("MediaRecorder API seems unable to record mimeType:"+this.mimeType)}log.debug("msr_plain using mime type:"+this.mimeType),this.mediaRecorder.ignoreMutedMedia=this.ignoreMutedMedia||!1,this.mediaRecorder.ondataavailable=function(e){if(e.data&&e.data.size){var blob=e.data;that.msr.ondataavailable(blob)}},this.mediaRecorder.onerror=function(error){"InvalidState"===error.name?log.debug("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed."):"OutOfMemory"===error.name?log.debug("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute."):"IllegalStreamModification"===error.name?log.debug("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute."):"OtherRecordingError"===error.name?log.debug("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute."):"GenericError"===error.name?log.debug("The UA cannot provide the codec or recording option that has been requested.",error):log.debug("MediaRecorder Error",error),that.mediaRecorder&&"inactive"!==that.mediaRecorder.state&&"stopped"!==that.mediaRecorder.state&&that.mediaRecorder.stop()},this.audioctx.createMediaStreamSource(this.mediaStream).connect(this.msr.audioanalyser.core);try{that.mediaRecorder.start(timeSlice)}catch(e){that.mediaRecorder=null}},stop:function(callback){this.mediaRecorder&&"recording"===this.mediaRecorder.state&&this.mediaRecorder.stop()},pause:function(){this.mediaRecorder&&"recording"===this.mediaRecorder.state&&this.mediaRecorder.pause()},resume:function(){this.mediaRecorder&&"paused"===this.mediaRecorder.state&&this.mediaRecorder.resume()},clearRecordedData:function(){this.mediaRecorder&&(this.pause(),this.stop())},isMediaStreamActive:function(){if("active"in this.mediaStream){if(!this.mediaStream.active)return!1}else if("ended"in this.mediaStream&&this.mediaStream.ended)return!1;return!0},looper:function(){this.mediaRecorder&&(!1!==this.isMediaStreamActive()?setTimeout(this.looper,1e3):this.stop())}}}));
define('filter_poodll/s3multipartupload', ["jquery","core/log"],(function($,log){return log.debug("Filter PoodLL: s3multipartupload initialising"),{PART_SIZE:10485760,SERVER_LOC:"?",completed:!1,file:null,fileInfo:null,sendBackData:null,uploadXHR:[],partURLs:[],byterate:[],lastUploadedSize:[],lastUploadedTime:[],loaded:[],total:[],init:function(file){this.completed=!1,this.file=file,this.fileInfo={name:this.file.name,type:this.file.type,size:this.file.size,lastModifiedDate:this.file.lastModifiedDate},this.sendBackData=null,this.uploadXHR=[],this.byterate=[],this.lastUploadedSize=[],this.lastUploadedTime=[],this.loaded=[],this.total=[]},createMultipartUpload:function(){var xhr=new XMLHttpRequest,that=this;xhr.onreadystatechange=function(e){if(4===this.readyState)if(200==xhr.status){var payload=xhr.responseText,payloadobject=JSON.parse(payload);if(payloadobject){if(payloadobject.returnCode>0){var messageObject={};return messageObject.id=that.config.id,messageObject.type="error",messageObject.code=payloadobject.returnCode,messageObject.message=payloadobject.returnMessage,void that.config.hermes.postMessage(messageObject)}that.partURLs=payloadobject.partURLs,that.config.allowedURL=payloadobject.allowedURL,that.config.posturl=payloadobject.postURL,that.config.filename=payloadobject.filename,that.config.s3filename=payloadobject.s3filename,that.config.s3root=payloadobject.s3root,that.config.cloudfilename=payloadobject.shortfilename,that.config.cloudroot=payloadobject.shortroot,that.sendAll()}else log.debug("error:"+payloadobject.message)}else log.debug("Not 200 response:"+xhr.status)};var parts=this.prepareParts(),xhrparams="wstoken="+this.config.wstoken+"&wsfunction=local_cpapi_fetch_multipartupload_details&moodlewsrestformat="+this.config.moodlewsrestformat+"&mediatype="+this.config.mediatype+"&parts="+parts,serverurl=M.cfg.wwwroot+"/webservice/rest/server.php";xhr.open("POST",serverurl,!0),xhr.setRequestHeader("Cache-Control","no-cache"),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.send(xhrparams)},doMultipartUpload:function(){var xhr=new XMLHttpRequest,that=this;xhr.onreadystatechange=function(e){if(4===this.readyState)if(200==xhr.status){var payload=xhr.responseText,payloadobject=JSON.parse(payload);if(payloadobject){if(payloadobject.returnCode>0){var messageObject={};return messageObject.id=that.config.id,messageObject.type="error",messageObject.code=payloadobject.returnCode,messageObject.message=payloadobject.returnMessage,void that.config.hermes.postMessage(messageObject)}that.partURLs=payloadobject.partURLs,that.config.allowedURL=payloadobject.allowedURL,that.config.posturl=payloadobject.postURL,that.config.filename=payloadobject.filename,that.config.s3filename=payloadobject.s3filename,that.config.s3root=payloadobject.s3root,that.config.cloudfilename=payloadobject.shortfilename,that.config.cloudroot=payloadobject.shortroot,that.sendAll()}else log.debug("error:"+payloadobject.message)}else log.debug("Not 200 response:"+xhr.status)};var parts=this.prepareParts(),xhrparams="wstoken="+this.config.wstoken+"&wsfunction=local_cpapi_fetch_multipartupload_urls&moodlewsrestformat="+this.config.moodlewsrestformat+"&mediatype="+this.config.mediatype+"&parts="+parts,serverurl=M.cfg.wwwroot+"/webservice/rest/server.php";xhr.open("POST",serverurl,!0),xhr.setRequestHeader("Cache-Control","no-cache"),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.send(xhrparams)},start:function(){this.createMultipartUpload()},prepareParts:function(){var blobs=this.blobs=[];this.partURLs=[];for(var end,blob,start=0,parts=[],partNum=0;start<this.file.size;)end=Math.min(start+this.PART_SIZE,this.file.size),filePart=this.file.slice(start,end),filePart.size>0&&blobs.push(filePart),start=this.PART_SIZE*++partNum;for(var i=0;i<blobs.length;i++)blob=blobs[i],parts[i]={},parts[i].partNumber=i+1,parts[i].contentLength=blob.size;return parts},sendAll:function(){for(var blobs=this.blobs,length=blobs.length,i=0;i<length;i++)this.sendToS3(partURLs[i],blobs[i],i)},sendToS3:function(theurl,blob,index){var self=this,size=blob.size,request=self.uploadXHR[index]=new XMLHttpRequest;request.onreadystatechange=function(){if(4===request.readyState){if(200!==request.status)return self.updateProgress(),void self.onS3UploadError(request);self.updateProgress()}},request.upload.onprogress=function(e){if(e.lengthComputable){if(self.total[index]=size,self.loaded[index]=e.loaded,self.lastUploadedTime[index]){var time_diff=((new Date).getTime()-self.lastUploadedTime[index])/1e3;if(time_diff>.005){var byterate=(self.loaded[index]-self.lastUploadedSize[index])/time_diff;self.byterate[index]=byterate,self.lastUploadedTime[index]=(new Date).getTime(),self.lastUploadedSize[index]=self.loaded[index]}}else self.byterate[index]=0,self.lastUploadedTime[index]=(new Date).getTime(),self.lastUploadedSize[index]=self.loaded[index];0!=index&&self.total[0]!=self.loaded[0]||self.updateProgress()}},request.open("PUT",theurl,!0),request.send(blob)},cancel:function(){for(var i=0;i<this.uploadXHR.length;++i)this.uploadXHR[i].abort();$.post(this.SERVER_LOC,{command:"abort",sendBackData:this.sendBackData}).done((function(data){}))},completeMultipartUpload:function(){var self=this;this.completed||(this.completed=!0,$.post(self.SERVER_LOC,{command:"complete",sendBackData:self.sendBackData}).done((function(data){self.onUploadCompleted(data)})).fail((function(jqXHR,textStatus,errorThrown){self.onServerError("complete",jqXHR,textStatus,errorThrown)})))},updateProgress:function(){for(var total=0,loaded=0,byterate=0,complete=1,i=0;i<this.total.length;++i)loaded+=+this.loaded[i]||0,total+=this.total[i],this.loaded[i]!=this.total[i]&&(byterate+=+this.byterate[i]||0,complete=0);complete&&this.completeMultipartUpload(),total=this.fileInfo.size,this.onProgressChanged(loaded,total,byterate)},onServerError:function(command,jqXHR,textStatus,errorThrown){},onS3UploadError:function(xhr){},onProgressChanged:function(uploadedSize,totalSize,bitrate){},onUploadCompleted:function(serverData){},onPrepareCompleted:function(){}}}));
define('filter_poodll/poodll_flashsnapshotrecorder', ["jquery","core/log","filter_poodll/utils_amd","filter_poodll/uploader","filter_poodll/lzloader"],(function($,log,utils,uploader,lz){return log.debug("PoodLL Flash Snapshot Recorder: initialising"),{savebutton:null,snapshotdatacontrol:null,supports_current_browser:function(config){var iOS=utils.is_ios(),isAndroid=utils.is_android();return!(iOS||!config.flashonandroid&&isAndroid)&&("snapshot"==config.mediatype&&(log.debug("PoodLL Flash Snapshot Recorder: supports this browser"),!0))},embed:function(element,config){var swfopts=$.parseJSON(config.flashsnapshot_widgetjson);lz.embed.swf(swfopts)}}}));
define('filter_poodll/lzloader', [],(function(){var $dhtml=!0,$as3=!1,$js1=!0,$swf7=!1,$swf8=!1,$svg=!1,$as2=!1,$swf9=!1,$profile=!1,$runtime="dhtml",$swf10=!1,$debug=!1,$j2me=!1;try{lz}catch(e){lz={}}lz.embed={options:{},swf:function($1,$2){null==$2&&($2=8);var $3=$1.url,$4=this.__getqueryurl($3);$1.accessible&&"false"!=$1.accessible&&($4.flashvars+="&accessible=true"),$1.history&&($4.flashvars+="&history=true"),null!=$1.bgcolor&&($4.flashvars+="&bgcolor="+escape($1.bgcolor)),$4.flashvars+="&width="+escape($1.width),$4.flashvars+="&height="+escape($1.height),$4.flashvars+="&__lzurl="+escape($3),$4.flashvars+="&__lzminimumversion="+escape($2),$4.flashvars+="&id="+escape($1.id);$3=$4.url+"?"+$4.query;var $5=lz.embed._getAppendDiv($1.id,$1.appenddivid),$6={width:"100%",height:"100%",id:$1.id,bgcolor:$1.bgcolor,wmode:$1.wmode,flashvars:$4.flashvars,allowfullscreen:$1.allowfullscreen,flash8:$3,appenddiv:$5};lz.embed[$1.id]&&alert("Warning: an app with the id: "+$1.id+" already exists.");var app=lz.embed[$1.id]=lz.embed.applications[$1.id]={runtime:"swf",_id:$1.id,appenddiv:$5,setCanvasAttribute:lz.embed._setCanvasAttributeSWF,getCanvasAttribute:lz.embed._getCanvasAttributeSWF,callMethod:lz.embed._callMethodSWF,_ready:lz.embed._ready,_onload:[],_getSWFDiv:lz.embed._getSWFDiv,loaded:!1,_sendMouseWheel:lz.embed._sendMouseWheel,_sendAllKeysUp:lz.embed._sendAllKeysUpSWF,_setCanvasAttributeDequeue:lz.embed._setCanvasAttributeDequeue,_sendPercLoad:lz.embed._sendPercLoad};if(0==$1.history&&(lz.embed.history.active=!1),lz.embed.dojo.addLoadedListener(lz.embed._loaded,app),lz.embed.dojo.setSwf($6,$2),$5.style.height=lz.embed.CSSDimension($1.height),$5.style.width=lz.embed.CSSDimension($1.width),1==$1.cancelmousewheel||"Mac"!=lz.embed.browser.OS&&("transparent"!=$6.wmode&&"opaque"!=$6.wmode||"Windows"!=lz.embed.browser.OS||!lz.embed.browser.isOpera&&!lz.embed.browser.isFirefox)||lz.embed.mousewheel&&lz.embed.mousewheel.setCallback(app,"_sendMouseWheel"),("transparent"==$6.wmode||"opaque"==$6.wmode)&&"Windows"==lz.embed.browser.OS&&(lz.embed.browser.isOpera||lz.embed.browser.isFirefox)){var div=$6.appenddiv;div.onmouseout=function($1){div.mouseisoutside=!0},div.onmouseover=function($1){div.mouseisoutside=!1},div._gotmouseup=document.onmouseup=function($1){div.mouseisoutside&&app.callMethod("LzMouseKernel.__mouseUpOutsideHandler()")}}},__swfSetAppAppendDivStyle:function($1,$2,$3){return lz.embed.applications[$1].appenddiv.style[$2]=$3},lfc:function($1,$2){if(""==$2)$2=".";else if(!$2||"string"!=typeof $2)return void alert("WARNING: lz.embed.lfc() requires a valid serverroot to be specified.");if(lz.embed.options.serverroot=$2,lz.embed.browser.isIE){var $3=$2+"lps/includes/excanvas.js";this.__dhtmlLoadScript($3)}this.__dhtmlLoadScript($1)},dhtml:function($1){var $2=this.__getqueryurl($1.url,!0),$3=$2.url+"?lzt=object&"+$2.query,$4=lz.embed._getAppendDiv($1.id,$1.appenddivid);$4.style.height=lz.embed.CSSDimension($1.height),$4.style.width=lz.embed.CSSDimension($1.width),lz.embed.__propcache={bgcolor:$1.bgcolor,width:$1.width,height:$1.height,id:$1.id,appenddiv:lz.embed._getAppendDiv($1.id,$1.appenddivid),url:$3,cancelkeyboardcontrol:$1.cancelkeyboardcontrol,serverroot:$1.serverroot,approot:null!=$1.approot?$1.approot:""},lz.embed[$1.id]&&alert("Warning: an app with the id: "+$1.id+" already exists.");lz.embed[$1.id]=lz.embed.applications[$1.id]={runtime:"dhtml",_id:$1.id,_ready:lz.embed._ready,_onload:[],loaded:!1,setCanvasAttribute:lz.embed._setCanvasAttributeDHTML,getCanvasAttribute:lz.embed._getCanvasAttributeDHTML,_sendAllKeysUp:lz.embed._sendAllKeysUpDHTML};0==$1.history&&(lz.embed.history.active=!1),this.__dhtmlLoadScript($3),"Windows"==lz.embed.browser.OS&&lz.embed.browser.isFirefox&&window.focus()},applications:{},__dhtmlLoadScript:function($1){var $2='<script type="text/javascript" language="JavaScript1.5" src="'+$1+'"><\/script>';return document.writeln($2),$2},__dhtmlLoadLibrary:function($1){var $2=document.createElement("script");return this.__setAttr($2,"type","text/javascript"),this.__setAttr($2,"src",$1),document.getElementsByTagName("head")[0].appendChild($2),$2},__getqueryurl:function($1,$2){var $3=$1.split("?");if($1=$3[0],1==$3.length)return{url:$1,flashvars:"",query:""};var $4=this.__parseQuery($3[1]),$5="",$6="",$7=new RegExp("\\+","g");for(var $8 in $4)if(""!=$8&&null!=$8){var $9=$4[$8];"lzr"!=$8&&"lzt"!=$8&&"debug"!=$8&&"profile"!=$8&&"lzbacktrace"!=$8&&"lzconsoledebug"!=$8&&"lzdebug"!=$8&&"lzkrank"!=$8&&"lzprofile"!=$8&&"lzcopyresources"!=$8&&"fb"!=$8&&"sourcelocators"!=$8&&"_canvas_debug"!=$8&&"lzsourceannotations"!=$8||($5+=$8+"="+$9+"&"),$2&&null==window[$8]&&(window[$8]=unescape($9.replace($7," "))),$6+=$8+"="+$9+"&"}return $5=$5.substr(0,$5.length-1),{url:$1,flashvars:$6=$6.substr(0,$6.length-1),query:$5}},__parseQuery:function($1){if(-1!=$1.indexOf("=")){for(var $2=$1.split("&"),$3={},$4=0;$4<$2.length;$4++){var $5=$2[$4].split("=");if(1!=$5.length){var $6=$5[0],$7=$5[1];$3[$6]=$7}}return $3}},__setAttr:function($1,$2,$3){$1.setAttribute($2,$3)},_setCanvasAttributeSWF:function($1,$2,$3){this.loaded&&lz.embed.dojo.comm[this._id]&&lz.embed.dojo.comm[this._id].callMethod?$3?lz.embed.history._store($1,$2):lz.embed.dojo.comm[this._id].setCanvasAttribute($1,$2+""):null==this._setCanvasAttributeQ?this._setCanvasAttributeQ=[[$1,$2,$3]]:this._setCanvasAttributeQ.push([$1,$2,$3])},_setCanvasAttributeDHTML:function($1,$2,$3){if($3)lz.embed.history._store($1,$2);else if(canvas&&!canvas.__LZdeleted){var $lzsc$1329266606="$lzc$set_"+$1;if(Function.$lzsc$isa?Function.$lzsc$isa(canvas[$lzsc$1329266606]):canvas[$lzsc$1329266606]instanceof Function)canvas[$lzsc$1329266606]($2);else{canvas[$1]=$2;var $lzsc$825273665=canvas["on"+$1];(LzEvent.$lzsc$isa?LzEvent.$lzsc$isa($lzsc$825273665):$lzsc$825273665 instanceof LzEvent)&&$lzsc$825273665.ready&&$lzsc$825273665.sendEvent($2)}}},_loaded:function($1){lz.embed[$1].loaded||(8==lz.embed.dojo.info.commVersion?setTimeout('lz.embed["'+$1+'"]._ready.call(lz.embed["'+$1+'"])',100):lz.embed[$1]._ready.call(lz.embed[$1]))},_setCanvasAttributeDequeue:function(){for(;this._setCanvasAttributeQ.length>0;){var $1=this._setCanvasAttributeQ.pop();this.setCanvasAttribute($1[0],$1[1],$1[2])}},_ready:function($1){if(this.loaded=!0,this._callmethod){for(var $2=0;$2<this._callmethod.length;$2++)this.callMethod(this._callmethod[$2]);this._callmethod=null}this._setCanvasAttributeQ&&this._setCanvasAttributeDequeue(),$1&&(this.canvas=$1);for($2=0;$2<this._onload.length;$2++){var $3=this._onload[$2];"function"==typeof $3&&$3(this)}this.onload&&"function"==typeof this.onload&&this.onload(this)},_getCanvasAttributeSWF:function($1){if(this.loaded)return lz.embed.dojo.comm[this._id].getCanvasAttribute($1);alert("Flash is not ready: getCanvasAttribute"+$1)},_getCanvasAttributeDHTML:function($1){return canvas[$1]},browser:{init:function(){this.initted||(this.browser=this.searchString(this.dataBrowser)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.osversion=this.searchOSVersion(navigator.userAgent)||"an unknown osversion",this.subversion=this.searchSubVersion(navigator.userAgent),this.OS=this.searchString(this.dataOS)||"an unknown OS",this.initted=!0,this.isNetscape=this.isSafari=this.isOpera=this.isFirefox=this.isIE=this.isIphone=!1,"Netscape"==this.browser?this.isNetscape=!0:"Safari"==this.browser?this.isSafari=!0:"Opera"==this.browser?this.isOpera=!0:"Firefox"==this.browser?this.isFirefox=!0:"Explorer"==this.browser?this.isIE=!0:"iPhone"==this.browser&&(this.isSafari=!0,this.isIphone=!0))},searchString:function($1){for(var $2=0;$2<$1.length;$2++){var $3=$1[$2].string,$4=$1[$2].prop;if(this.versionSearchString=$1[$2].versionSearch||$1[$2].identity,this.osversionSearchString=$1[$2].osversionSearch||"",$3){if(-1!=$3.indexOf($1[$2].subString))return $1[$2].identity}else if($4)return $1[$2].identity}},searchVersion:function($1){var $2=$1.indexOf(this.versionSearchString);if(-1!=$2)return parseFloat($1.substring($2+this.versionSearchString.length+1))},searchSubVersion:function($1){var $3=new RegExp(this.versionSearchString+".\\d+\\.\\d+\\.([\\d.]+)").exec($1);if($3&&$3.length>1)return parseFloat($3[1])},searchOSVersion:function($1){var $2=$1.indexOf(this.osversionSearchString);if(-1!=$2)return parseFloat($1.substring($2+this.osversionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"iPhone",identity:"iPhone",versionSearch:"WebKit"},{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"WebKit"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"Iceweasel",versionSearch:"Iceweasel",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE",osversionSearch:"Windows NT"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]},_callMethodSWF:function($1){if(this.loaded)return lz.embed.dojo.comm[this._id].callMethod($1);this._callmethod||(this._callmethod=[]),this._callmethod.push($1)},_broadcastMethod:function($1){var $2=[].slice.call(arguments,1);for(var $3 in lz.embed.applications){var $4=lz.embed.applications[$3];$4[$1]&&$4[$1].apply($4,$2)}},setCanvasAttribute:function($1,$2,$3){lz.embed._broadcastMethod("setCanvasAttribute",$1,$2,$3)},callMethod:function($1){lz.embed._broadcastMethod("callMethod",$1)},_getAppendDiv:function($1,$2){var $3=$2||$1+"Container",$4=document.getElementById($3);return $4||(document.writeln('<div id="'+$3+'"></div>'),$4=document.getElementById($3)),$4},_getSWFDiv:function(){return lz.embed.dojo.obj[this._id].get()},_sendMouseWheel:function($1){null!=$1&&this.callMethod("lz.Keys.__mousewheelEvent("+$1+")")},_gotFocus:function(){lz.embed._broadcastMethod("_sendAllKeysUp")},_sendAllKeysUpSWF:function(){this.callMethod("lz.Keys.__allKeysUp()")},_sendAllKeysUpDHTML:function(){lz.Keys&&lz.Keys.__allKeysUp&&lz.Keys.__allKeysUp()},_sendPercLoad:function($1){this.onloadstatus&&"function"==typeof this.onloadstatus&&this.onloadstatus($1)},attachEventHandler:function($1,$2,callbackscope,callbackname,closure){if(callbackscope&&callbackname&&"function"==typeof callbackscope[callbackname]){var $3=$1+$2+callbackscope+callbackname,$4=this._handlers[$3];if(null!=$4)if($4 instanceof Array){for(var $5=$4.length-1;$5>=0;--$5)if($4[$5].$e===$1&&$4[$5].$c===callbackscope)return}else if($4.$e===$1&&$4.$c===callbackscope)return;var $6=function(){var $1=window.event?[window.event]:[].slice.call(arguments,0);closure&&$1.push(closure),callbackscope[callbackname].apply(callbackscope,$1)};return $6.$e=$1,$6.$c=callbackscope,null!=$4?$4 instanceof Array?$4.push($6):$4=[$4,$6]:$4=$6,this._handlers[$3]=$4,$1.addEventListener?($1.addEventListener($2,$6,!1),!0):$1.attachEvent?$1.attachEvent("on"+$2,$6):void 0}},removeEventHandler:function($1,$2,$3,$4){var $6,$5=$1+$2+$3+$4,$7=this._handlers[$5];if(null!=$7)if($7 instanceof Array)for(var $8=$7.length-1;$8>=0;--$8)$7[$8].$e===$1&&$7[$8].$c===$3&&($6=$7[$8],$7.splice($8,1),0==$7.length&&delete this._handlers[$5]);else $7.$e===$1&&$7.$c===$3&&($6=$7,delete this._handlers[$5]);if($6)return $1.removeEventListener?($1.removeEventListener($2,$6,!1),!0):$1.detachEvent?$1.detachEvent("on"+$2,$6):void 0},_handlers:{},_cleanupHandlers:function(){lz.embed._handlers={}},getAbsolutePosition:function($1){var $4,$2=null,$3={};if((!lz.embed.browser.isFirefox||$1!=document.body)&&$1.getBoundingClientRect){$4=$1.getBoundingClientRect();var $5=document.documentElement.scrollTop||document.body.scrollTop,$6=document.documentElement.scrollLeft||document.body.scrollLeft;return{x:Math.floor($4.left+$6),y:Math.floor($4.top+$5)}}if(document.getBoxObjectFor)$3={x:($4=document.getBoxObjectFor($1)).x,y:$4.y};else{if($3={x:$1.offsetLeft,y:$1.offsetTop},($2=$1.offsetParent)!=$1)for(;$2;)$3.x+=$2.offsetLeft,$3.y+=$2.offsetTop,$2=$2.offsetParent;if(lz.embed.browser.isSafari&&document.defaultView&&document.defaultView.getComputedStyle)var $7=document.defaultView.getComputedStyle($1,"");(lz.embed.browser.isOpera||lz.embed.browser.isSafari&&$7&&"absolute"==$7.position)&&($3.y-=document.body.offsetTop)}if(!$1.parentNode)return $3;for($2=$1.parentNode;$2&&"BODY"!=$2.tagName&&"HTML"!=$2.tagName;){if($3.x-=$2.scrollLeft,$3.y-=$2.scrollTop,!$2.parentNode)return $3;$2=$2.parentNode}return $3},CSSDimension:function($1,$2){var $3=$1;if(isNaN($1)){if($1.indexOf("%")==$1.length-1&&!isNaN($1.substring(0,$1.length-1)))return $1;$3=0}else $1===1/0?$3=-1>>>1:$1===-1/0&&($3=~(-1>>>1));return $3+($2||"px")}},lz.embed.browser.init(),lz.embed.attachEventHandler(window,"beforeunload",lz.embed,"_cleanupHandlers"),lz.embed.attachEventHandler(window,"focus",lz.embed,"_gotFocus"),lz.embed.browser.isIE&&lz.embed.attachEventHandler(window,"activate",lz.embed,"_gotFocus");try{lzOptions&&(lzOptions.dhtmlKeyboardControl&&alert("WARNING: this page uses lzOptions.dhtmlKeyboardControl.  Please use the cancelkeyboardcontrol embed argument for lz.embed.dhtml() instead."),lzOptions.ServerRoot&&alert("WARNING: this page uses lzOptions.ServerRoot.  Please use the second argument of lz.embed.lfc() instead."))}catch(e){}return lz.embed.dojo=function(){},lz.embed.dojo={defaults:{flash8:null,ready:!1,visible:!0,width:500,height:400,bgcolor:"#ffffff",allowfullscreen:!1,wmode:"window",flashvars:"",minimumVersion:8,id:"flashObject",appenddiv:null},obj:{},comm:{},_loadedListeners:[],_loadedListenerScopes:[],_installingListeners:[],_installingListenerScopes:[],setSwf:function($1,$2){if(null!=$1){var $3={};for(var $4 in this.defaults){var $5=$1[$4];$3[$4]=null!=$5?$5:this.defaults[$4]}null!=$2&&(this.minimumVersion=$2),this._initialize($3)}},addLoadedListener:function($1,$2){this._loadedListeners.push($1),this._loadedListenerScopes.push($2)},addInstallingListener:function($1,$2){this._installingListeners.push($1),this._installingListenerScopes.push($2)},loaded:function($1){var $2=lz.embed.dojo;if($2._isinstaller&&(top.location=top.location+""),$2.info.installing=!1,$2.ready=!0,$2._loadedListeners.length>0)for(var $3=0;$3<$2._loadedListeners.length;$3++){var $4=$2._loadedListenerScopes[$3];$1==$4._id&&lz.embed.dojo._loadedListeners[$3].apply($4,[$4._id])}},installing:function(){var $1=lz.embed.dojo;if($1._installingListeners.length>0)for(var $2=0;$2<$1._installingListeners.length;$2++){var $3=$1._installingListenerScopes[$2];$1._installingListeners[$2].apply($3,[$3._id])}},_initialize:function($1){var $2=lz.embed.dojo,$3=new $2.Install($1.id);$2.installer=$3;var $4=new $2.Embed($1);$2.obj[$1.id]=$4,1==$3.needed()?$3.install():($4.write($2.info.commVersion),$2.comm[$1.id]=new $2.Communicator($1.id))}},lz.embed.dojo.Info=function(){lz.embed.browser.isIE&&(document.writeln('<script language="VBScript" type="text/vbscript">'),document.writeln("Function VBGetSwfVer(i)"),document.writeln("  on error resume next"),document.writeln("  Dim swControl, swVersion"),document.writeln("  swVersion = 0"),document.writeln('  set swControl = CreateObject("ShockwaveFlash.ShockwaveFlash." + CStr(i))'),document.writeln("  if (IsObject(swControl)) then"),document.writeln('    swVersion = swControl.GetVariable("$version")'),document.writeln("  end if"),document.writeln("  VBGetSwfVer = swVersion"),document.writeln("End Function"),document.writeln("<\/script>")),this._detectVersion(),this._detectCommunicationVersion()},lz.embed.dojo.Info.prototype={version:-1,versionMajor:-1,versionMinor:-1,versionRevision:-1,capable:!1,commVersion:8,installing:!1,isVersionOrAbove:function($1,$2,$3){return $3=parseFloat("."+$3),this.versionMajor>=$1&&this.versionMinor>=$2&&this.versionRevision>=$3},_detectVersion:function(){for(var $1,$2=lz.embed.browser.isIE,$3=25;$3>0;$3--){if(-1==($1=$2?VBGetSwfVer($3):this._JSFlashInfo($3)))return void(this.capable=!1);if(0!=$1){var $4;if($2)$4=$1.split(" ")[1].split(",");else $4=$1.split(".");this.versionMajor=$4[0],this.versionMinor=$4[1],this.versionRevision=$4[2];var $7=this.versionMajor+"."+this.versionRevision;this.version=parseFloat($7),this.capable=!0;break}}},_JSFlashInfo:function($1){if(null!=navigator.plugins&&navigator.plugins.length>0&&(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"])){var $2=navigator.plugins["Shockwave Flash 2.0"]?" 2.0":"",$4=navigator.plugins["Shockwave Flash"+$2].description.split(" "),$5=$4[2].split("."),$6=$5[0],$7=$5[1];if(""!=$4[3])var $8=$4[3].split("r");else $8=$4[4].split("r");return $6+"."+$7+"."+($8[1]>0?$8[1]:0)}return-1},_detectCommunicationVersion:function(){0!=this.capable||(this.commVersion=null)}},lz.embed.dojo.Embed=function($1){this.properties=$1,this.properties.width||(this.properties.width="100%"),this.properties.height||(this.properties.height="100%"),this.properties.bgcolor||(this.properties.bgcolor="#ffffff"),this.properties.visible||(this.properties.visible=!0)},lz.embed.dojo.Embed.prototype={protocol:function(){return"https:"===window.location.protocol?"https":"http"},__getCSSValue:function($1){return $1&&$1.length&&-1!=$1.indexOf("%")?"100%":$1+"px"},write:function($1,$2){var $4,$5,$3="";$3+="width: "+this.__getCSSValue(this.properties.width)+";",$3+="height: "+this.__getCSSValue(this.properties.height)+";",0==this.properties.visible&&($3+="position: absolute; ",$3+="z-index: 10000; ",$3+="top: -1000px; ",$3+="left: -1000px; ");var $6=lz.embed;$1>$6.dojo.version&&($2=!0),$5=this.properties.flash8;var $7=this.properties.flashvars,$8=this.properties.flashvars;if($2){var $9=escape(window.location);document.title=document.title.slice(0,47)+" - Flash Player Installation",$7+="&MMredirectURL="+$9+"&MMplayerType=ActiveX&MMdoctitle="+escape(document.title),$8+="&MMredirectURL="+$9+"&MMplayerType=PlugIn"}$4=$6.browser.isIE?'<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+this.protocol()+'://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=8,0,0,0" width="'+this.properties.width+'" height="'+this.properties.height+'" id="'+this.properties.id+'" align="middle"> <param name="allowScriptAccess" value="sameDomain" /> <param name="movie" value="'+$5+'" /> <param name="quality" value="high" /> <param name="FlashVars" value="'+$7+'" /> <param name="bgcolor" value="'+this.properties.bgcolor+'" /> <param name="wmode" value="'+this.properties.wmode+'" /> <param name="allowFullScreen" value="'+this.properties.allowfullscreen+'" /> </object>':'<embed src="'+$5+'" quality="high" bgcolor="'+this.properties.bgcolor+'" wmode="'+this.properties.wmode+'" allowFullScreen="'+this.properties.allowfullscreen+'" width="'+this.properties.width+'" height="'+this.properties.height+'" id="'+this.properties.id+'" name="'+this.properties.id+'" FlashVars="'+$8+'" swLiveConnect="true" align="middle" allowScriptAccess="sameDomain" type="application/x-shockwave-flash" pluginspage="'+this.protocol()+'://www.macromedia.com/go/getflashplayer" />';var $11=this.properties.id+"Container",$12=this.properties.appenddiv;$12?($12.innerHTML=$4,$12.setAttribute("style",$3)):($4='<div id="'+$11+'" style="'+$3+'"> '+$4+"</div>",document.writeln($4))},get:function(){try{var $1=document.getElementById(this.properties.id+"")}catch(e){}return $1},setVisible:function($1){var $2=document.getElementById(this.properties.id+"Container");1==$1?$2.style.visibility="visible":($2.style.position="absolute",$2.style.x="-1000px",$2.style.y="-1000px",$2.style.visibility="hidden")},center:function(){this.properties.width,this.properties.height;var $5=document.getElementById(this.properties.id+"Container");$5.style.top="0px",$5.style.left="0px"}},lz.embed.dojo.Communicator=function($1){this._id=$1},lz.embed.dojo.Communicator.prototype={_addExternalInterfaceCallback:function(methodName,id){var dojo=lz.embed.dojo;dojo.comm[id][methodName]=function(){for(var $1=[],$2=0;$2<arguments.length;$2++)$1[$2]=arguments[$2];return $1.length=arguments.length,dojo.comm[id]._execFlash(methodName,$1,id)}},_encodeData:function($1){var $2=RegExp("\\&([^;]*)\\;","g");return $1=($1=($1=($1=($1=($1=($1=($1=($1=($1=$1.replace($2,"&amp;$1;")).replace(RegExp("<","g"),"&lt;")).replace(RegExp(">","g"),"&gt;")).replace("\\","&custom_backslash;&custom_backslash;")).replace(RegExp("\\n","g"),"\\n")).replace(RegExp("\\r","g"),"\\r")).replace(RegExp("\\f","g"),"\\f")).replace(RegExp("\\0","g"),"\\0")).replace(RegExp("\\'","g"),"\\'")).replace(RegExp('\\"',"g"),'\\"')},_decodeData:function _decodeData($1){return null==$1||void 0===$1||($1=$1.replace(RegExp("\\&custom_lt\\;","g"),"<"),$1=$1.replace(RegExp("\\&custom_gt\\;","g"),">"),$1=eval('"'+$1+'"')),$1},_chunkArgumentData:function($1,$2,$3){for(var $4=lz.embed.dojo.obj[$3].get(),$5=Math.ceil($1.length/1024),$6=0;$6<$5;$6++){var $7=1024*$6,$8=1024*$6+1024;$6==$5-1&&($8=1024*$6+$1.length);var $9=$1.substring($7,$8);$9=this._encodeData($9),$4.CallFunction('<invoke name="chunkArgumentData" returntype="javascript"><arguments><string>'+$9+"</string><number>"+$2+"</number></arguments></invoke>")}},_chunkReturnData:function($1){for(var $2=lz.embed.dojo.obj[$1].get(),$3=$2.getReturnLength(),$4=[],$5=0;$5<$3;$5++){var $6=$2.CallFunction('<invoke name="chunkReturnData" returntype="javascript"><arguments><number>'+$5+"</number></arguments></invoke>");$6='""'==$6||"''"==$6?"":$6.substring(1,$6.length-1),$4.push($6)}return $4.join("")},_execFlash:function($1,$2,$3){var $4=lz.embed.dojo.obj[$3].get();$4.startExec(),$4.setNumberArguments($2.length);for(var $5=0;$5<$2.length;$5++)this._chunkArgumentData($2[$5],$5,$3);$4.exec($1);var $6=this._chunkReturnData($3);return $6=this._decodeData($6),$4.endExec(),$6}},lz.embed.dojo.Install=function($1){this._id=$1},lz.embed.dojo.Install.prototype={needed:function(){var $1=lz.embed.dojo;return 0==$1.info.capable||(1==lz.embed.browser.isSafari&&!$1.info.isVersionOrAbove(8,0,0)||($1.minimumVersion>$1.info.versionMajor||!$1.info.isVersionOrAbove(8,0,0)))},install:function(){var $1=lz.embed.dojo;$1.info.installing=!0,$1.installing();var $4,$5,$2=$1.obj[this._id].properties,$3=$2.flash8;(-1!=($4=$3.indexOf("swf7"))&&($1._tempurl=$3,$3=$3.substring(0,$4+3)+"8"+$3.substring($4+4,$3.length),$2.flash8=$3),-1!=($4=$3.indexOf("swf9"))&&($1._tempurl=$3,$3=$3.substring(0,$4+3)+"8"+$3.substring($4+4,$3.length),$2.flash8=$3),$1.ready=!1,0==$1.info.capable)?($1._isinstaller=!0,($5=new $1.Embed($2)).write($1.minimumVersion)):$1.info.isVersionOrAbove(6,0,65)?(($5=new $1.Embed($2)).write($1.minimumVersion,!0),$5.setVisible(!0),$5.center()):(alert("This content requires a more recent version of the Macromedia  Flash Player."),window.location="http://www.macromedia.com/go/getflashplayer")},_onInstallStatus:function($1){"Download.Complete"==$1?lz.embed.browser.isIE&&(top.location=top.location+""):"Download.Cancelled"==$1?(alert("This content requires a more recent version of the Macromedia  Flash Player."),window.location="http://www.macromedia.com/go/getflashplayer"):"Download.Failed"==$1&&(alert("There was an error downloading the Flash Player update. Please try again later, or visit macromedia.com to download the latest version of the Flash plugin."),window.location="http://www.macromedia.com/go/getflashplayer")}},lz.embed.dojo.info=new lz.embed.dojo.Info,lz.embed.iframemanager={__counter:0,__frames:{},__namebyid:{},__loading:{},__callqueue:{},__calljsqueue:{},__sendmouseevents:{},__hidenativecontextmenu:{},__selectionbookmarks:{},create:function($1,$2,$3,$4,$5,$6){var $7="__lz"+lz.embed.iframemanager.__counter++,$8='javascript:""',$9='lz.embed.iframemanager.__gotload("'+$7+'")';if(null!=$2&&"null"!=$2&&""!=$2||($2=$7),lz.embed.iframemanager.__namebyid[$7]=$2,null!=$4&&"undefined"!=$4||($4=document.body),document.all){var $10="<iframe name='"+$2+"' id='"+$7+"' src='"+$8+"' onload='"+$9+"' frameBorder='0'";1!=$3&&($10+=" scrolling='no'"),$10+="></iframe>";var $11=document.createElement("div");lz.embed.__setAttr($11,"id",$7+"Container"),$4.appendChild($11),$11.innerHTML=$10;var $12=document.getElementById($7)}else{$12=document.createElement("iframe");lz.embed.__setAttr($12,"name",$2),lz.embed.__setAttr($12,"src",$8),lz.embed.__setAttr($12,"id",$7),lz.embed.__setAttr($12,"onload",$9),1!=$3&&lz.embed.__setAttr($12,"scrolling","no"),this.appendTo($12,$4)}return $12?this.__finishCreate($7,$1,$2,$3,$4,$5,$6):(this.__callqueue[$7]=[["__finishCreate",$7,$1,$2,$3,$4,$5,$6]],setTimeout('lz.embed.iframemanager.__checkiframe("'+$7+'")',10)),$7+""},__checkiframe:function($1){if(document.getElementById($1)){var $3=lz.embed.iframemanager.__callqueue[$1];delete lz.embed.iframemanager.__callqueue[$1],lz.embed.iframemanager.__playQueue($3)}else setTimeout('lz.embed.iframemanager.__checkiframe("'+$1+'")',10)},__playQueue:function($1){for(var $2=lz.embed.iframemanager,$3=0;$3<$1.length;$3++){var $4=$1[$3];$2[$4.splice(0,1)].apply($2,$4)}},__finishCreate:function($1,$2,$3,$4,$5,$6,$7){var $8=document.getElementById($1);"string"==typeof $2&&($8.appcontainer=lz.embed.applications[$2]._getSWFDiv()),$8.owner=$2,lz.embed.iframemanager.__frames[$1]=$8,this.__namebyid[$1]=$3;var $9=lz.embed.iframemanager.getFrame($1);if($9.__gotload=lz.embed.iframemanager.__gotload,$9._defaultz=$6||99900,this.setZ($1,$9._defaultz),lz.embed.iframemanager.__topiframe=$1,document.getElementById&&!document.all)$9.style.border="0";else if(document.all){lz.embed.__setAttr($9,"allowtransparency","true");var $10=lz.embed[$9.owner];if($10&&"swf"==$10.runtime)$10._getSWFDiv().onfocus=lz.embed.iframemanager.__refresh}$9.style.position="absolute"},appendTo:function($1,$2){$2.__appended!=$2&&($1.__appended?(old=$1.__appended.removeChild($1),$2.appendChild(old)):$2.appendChild($1),$1.__appended=$2)},getFrame:function($1){return lz.embed.iframemanager.__frames[$1]},getFrameWindow:function($1){return this.framesColl||(document.frames?this.framesColl=document.frames:this.framesColl=window.frames),this.framesColl[$1]},setSrc:function($1,$2,$3){if(this.__callqueue[$1])this.__callqueue[$1].push(["setSrc",$1,$2,$3]);else{if(this.__setSendMouseEvents($1,!1),$3){if(!($4=lz.embed.iframemanager.getFrame($1)))return;lz.embed.__setAttr($4,"src",$2)}else{var $4;$1=lz.embed.iframemanager.__namebyid[$1];if(!($4=window[$1]))return;$4.location.replace($2)}this.__loading[$1]=!0}},setPosition:function($1,$2,$3,$4,$5,$6,$7){if(this.__callqueue[$1])this.__callqueue[$1].push(["setPosition",$1,$2,$3,$4,$5,$6,$7]);else{var $8=lz.embed.iframemanager.getFrame($1);if($8){if($8.appcontainer)var $9=lz.embed.getAbsolutePosition($8.appcontainer);else $9={x:0,y:0};null==$2||isNaN($2)||($8.style.left=$2+$9.x+"px"),null==$3||isNaN($3)||($8.style.top=$3+$9.y+"px"),null==$4||isNaN($4)||($8.style.width=$4+"px"),null==$5||isNaN($5)||($8.style.height=$5+"px"),null!=$6&&("string"==typeof $6&&($6="true"==$6),$8.style.display=$6?"block":"none"),null!=$7&&this.setZ($1,$7+$8._defaultz)}}},setVisible:function($1,$2){if(this.__callqueue[$1])this.__callqueue[$1].push(["setVisible",$1,$2]);else{"string"==typeof $2&&($2="true"==$2);var $3=lz.embed.iframemanager.getFrame($1);$3&&($3.style.display=$2?"block":"none")}},bringToFront:function($1){if(this.__callqueue[$1])this.__callqueue[$1].push(["bringToFront",$1]);else{var $2=lz.embed.iframemanager.getFrame($1);$2&&($2._defaultz=1e5,this.setZ($1,$2._defaultz),lz.embed.iframemanager.__topiframe=$1)}},sendToBack:function($1){if(this.__callqueue[$1])this.__callqueue[$1].push(["sendToBack",$1]);else{var $2=lz.embed.iframemanager.getFrame($1);$2&&($2._defaultz=99900,this.setZ($1,$2._defaultz))}},__gotload:function($1){var $2=lz.embed.iframemanager.getFrame($1);$2&&($2.owner&&$2.owner.__gotload?$2.owner.__gotload():lz.embed[$2.owner].callMethod("lz.embed.iframemanager.__gotload('"+$1+"')"),this.__loading[$1]=!1,this.__sendmouseevents[$1]&&this.__setSendMouseEvents($1,!0),this.__calljsqueue[$1]&&(this.__playQueue(this.__calljsqueue[$1]),delete this.__calljsqueue[$1]))},__refresh:function(){if(lz.embed.iframemanager.__topiframe){var $1=lz.embed.iframemanager.getFrame(lz.embed.iframemanager.__topiframe);"block"==$1.style.display&&($1.style.display="none",$1.style.display="block")}},setZ:function($1,$2){if(this.__callqueue[$1])this.__callqueue[$1].push(["setZ",$1,$2]);else{var $3=lz.embed.iframemanager.getFrame($1);$3&&($3.style.zIndex=$2)}},scrollBy:function($1,$2,$3){if(this.__callqueue[$1])this.__callqueue[$1].push(["scrollBy",$1,$2,$3]);else{$1=lz.embed.iframemanager.__namebyid[$1];var $4=window.frames[$1];$4&&$4.scrollBy($2,$3)}},__destroy:function($1){if(this.__callqueue[$1])this.__callqueue[$1].push(["__destroy",$1]);else{var $2=lz.embed.iframemanager.__frames[$1];$2&&(this.__setSendMouseEvents($1,!1),$2.owner=null,$2.appcontainer=null,LzSprite.prototype.__discardElement($2),delete lz.embed.iframemanager.__frames[$1],delete lz.embed.iframemanager.__namebyid[$1])}},callJavascript:function($1,$2,$3,$4){if(this.__callqueue[$1])this.__callqueue[$1].push(["callJavascript",$1,$2,$3,$4]);else{if(this.__loading[$1])return this.__calljsqueue[$1]||(this.__calljsqueue[$1]=[]),void this.__calljsqueue[$1].push(["callJavascript",$1,$2,$3,$4]);var $5=lz.embed.iframemanager.getFrameWindow($1);$4||($4=[]);try{var $6=$5.eval($2);if($6){var $7=$6.apply($5,$4);return $3&&$3.execute($7),$7}}catch(e){}}},__globalMouseover:function($1,$2){var $3=lz.embed.iframemanager.getFrame($2);$3&&($1=window.event,$3.owner&&$3.owner.sprite&&$1.toElement&&"IFRAME"!=$1.toElement.nodeName&&LzMouseKernel.__resetMouse())},__mouseEvent:function($1,$2){var $3=lz.embed,$4=$3.iframemanager.getFrame($2);if($4){$1||($1=window.event);var $5="on"+$1.type;if($4.owner&&$4.owner.sprite&&$4.owner.sprite.__mouseEvent){if("oncontextmenu"==$5){if($3.iframemanager.__hidenativecontextmenu[$2]){var $6=$3.getAbsolutePosition($4);return LzMouseKernel.__sendMouseMove($1,$6.x,$6.y),LzMouseKernel.__showContextMenu($1)}return}$4.owner.sprite.__mouseEvent($1),"onmouseup"==$5&&LzMouseKernel.__lastMouseDown==$4.owner.sprite&&(LzMouseKernel.__lastMouseDown=null)}else{if("onmouseleave"==$5)$5="onmouseout";else if("onmouseenter"==$5)$5="onmouseover";else if("oncontextmenu"==$5)return;$3[$4.owner].callMethod("lz.embed.iframemanager.__gotMouseEvent('"+$2+"','"+$5+"')")}}},setSendMouseEvents:function($1,$2){this.__callqueue[$1]?this.__callqueue[$1].push(["setSendMouseEvents",$1,$2]):this.__sendmouseevents[$1]=$2},__setSendMouseEvents:function(id,$1){var iframe=lz.embed.iframemanager.getFrameWindow(id);if(iframe)if($1){lz.embed.browser.isIE&&lz.embed.attachEventHandler(document,"mouseover",lz.embed.iframemanager,"__globalMouseover",id);try{lz.embed.attachEventHandler(iframe.document,"mousedown",lz.embed.iframemanager,"__mouseEvent",id),lz.embed.attachEventHandler(iframe.document,"mouseup",lz.embed.iframemanager,"__mouseEvent",id),lz.embed.attachEventHandler(iframe.document,"click",lz.embed.iframemanager,"__mouseEvent",id),iframe.document.oncontextmenu=function($1){return $1||($1=iframe.event),lz.embed.iframemanager.__mouseEvent($1,id)},lz.embed.browser.isIE?(lz.embed.attachEventHandler(iframe.document,"mouseenter",lz.embed.iframemanager,"__mouseEvent",id),lz.embed.attachEventHandler(iframe.document,"mouseleave",lz.embed.iframemanager,"__mouseEvent",id)):(lz.embed.attachEventHandler(iframe.document,"mouseover",lz.embed.iframemanager,"__mouseEvent",id),lz.embed.attachEventHandler(iframe.document,"mouseout",lz.embed.iframemanager,"__mouseEvent",id))}catch(e){}}else{lz.embed.browser.isIE&&lz.embed.removeEventHandler(document,"mouseover",lz.embed.iframemanager,"__globalMouseover");try{lz.embed.removeEventHandler(iframe.document,"mousedown",lz.embed.iframemanager,"__mouseEvent"),lz.embed.removeEventHandler(iframe.document,"mouseup",lz.embed.iframemanager,"__mouseEvent"),lz.embed.removeEventHandler(iframe.document,"click",lz.embed.iframemanager,"__mouseEvent"),iframe.document.oncontextmenu=null,lz.embed.browser.isIE?(lz.embed.removeEventHandler(iframe.document,"mouseenter",lz.embed.iframemanager,"__mouseEvent"),lz.embed.removeEventHandler(iframe.document,"mouseleave",lz.embed.iframemanager,"__mouseEvent")):(lz.embed.removeEventHandler(iframe.document,"mouseover",lz.embed.iframemanager,"__mouseEvent"),lz.embed.removeEventHandler(iframe.document,"mouseout",lz.embed.iframemanager,"__mouseEvent"))}catch(e){}}},setShowNativeContextMenu:function($1,$2){this.__hidenativecontextmenu[$1]=!$2},storeSelection:function($1){var $2=lz.embed.iframemanager,$3=$2.getFrameWindow($1);$3&&$3.document&&$3.document.selection&&"Text"==$3.document.selection.type&&($2.__selectionbookmarks[$1]=$3.document.selection.createRange().getBookmark())},restoreSelection:function($1){var $2=lz.embed.iframemanager,$3=$2.getFrameWindow($1);if($2.__selectionbookmarks[$1]&&$3){var $4=$2.__selectionbookmarks[$1],$5=$3.document.body.createTextRange();$5.moveToBookmark($4),$5.select()}}},lz.embed.mousewheel={__mousewheelEvent:function($1){$1||($1=window.event);var $2=0;$1.wheelDelta?($2=$1.wheelDelta/120,lz.embed.browser.isOpera&&($2=-$2)):$1.detail&&($2=-$1.detail/3),$1.preventDefault&&$1.preventDefault(),$1.returnValue=!1;var $3=lz.embed.mousewheel.__callbacks.length;if(null!=$2&&$3>0)for(var $4=0;$4<$3;$4+=2){var $5=lz.embed.mousewheel.__callbacks[$4],$6=lz.embed.mousewheel.__callbacks[$4+1];$5&&$5[$6]&&$5[$6]($2)}},__callbacks:[],setCallback:function($1,$2){var $3=lz&&lz.embed&&lz.embed.options&&1!=lz.embed.options.cancelkeyboardcontrol||!0;0==lz.embed.mousewheel.__callbacks.length&&$3&&(window.addEventListener&&lz.embed.attachEventHandler(window,"DOMMouseScroll",lz.embed.mousewheel,"__mousewheelEvent"),lz.embed.attachEventHandler(document,"mousewheel",lz.embed.mousewheel,"__mousewheelEvent")),lz.embed.mousewheel.__callbacks.push($1,$2)}},lz.embed.history={active:null,_currentstate:null,_apps:[],_intervalID:null,_registeredapps:{},intervaltime:200,init:function(){var $1=lz.embed.history;if(!$1.active&&0!=$1.active){$1.active=!0,$1._title=top.document.title;var $2=$1.get();if(lz.embed.browser.isSafari){$1._historylength=history.length,$1._history=[];for(var $3=1;$3<$1._historylength;$3++)$1._history.push("");$1._history.push($2);var $4=document.createElement("form");$4.method="get",document.body.appendChild($4),$1._form=$4,top.document.location.lzaddr||(top.document.location.lzaddr={}),top.document.location.lzaddr.history&&($1._history=top.document.location.lzaddr.history.split(",")),""!=$2&&$1.set($2)}else if(lz.embed.browser.isIE){($2=top.location.hash)&&($2=$2.substring(1));$3=document.createElement("iframe");lz.embed.__setAttr($3,"id","lzHistory"),lz.embed.__setAttr($3,"frameborder","no"),lz.embed.__setAttr($3,"scrolling","no"),lz.embed.__setAttr($3,"width","0"),lz.embed.__setAttr($3,"height","0"),lz.embed.__setAttr($3,"src",'javascript:""'),document.body.appendChild($3),$3=document.getElementById("lzHistory"),$1._iframe=$3,$3.style.display="none",$3.style.position="absolute",$3.style.left="-999px";var $5=$3.contentDocument||$3.contentWindow.document;$5.open(),$5.close(),""!=$2&&($5.location.hash="#"+$2,$1._parse($2))}else""!=$2&&($1._parse($2),$1._currentstate=$2);null!=$1._intervalID&&clearInterval($1._intervalID),$1.intervaltime>0&&($1._intervalID=setInterval("lz.embed.history._checklocationhash()",$1.intervaltime))}},listen:function($1){if(("string"!=typeof $1||($1=lz.embed.applications[$1])&&$1.runtime)&&$1){var $2=lz.embed.history;$2._registeredapps[$1._id]||($2._registeredapps[$1.id]=!0,$2._apps.push($1),$2.init())}},_checklocationhash:function(){var $1;lz.embed.dojo&&lz.embed.dojo.info&&lz.embed.dojo.info.installing||(lz.embed.browser.isSafari?(""!=($1=this._history[this._historylength-1])&&"#"!=$1||($1="#0"),this._skip||this._historylength==history.length?this._parse($1.substring(1)):(this._historylength=history.length,void 0!==$1&&($1=$1.substring(1),this._currentstate=$1,this._parse($1)))):(""==($1=lz.embed.history.get())&&($1="0"),lz.embed.browser.isIE?($1!=this._currentstate&&(top.location.hash="0"==$1?"":"#"+$1,this._currentstate=$1,this._parse($1)),top.document.title!=this._title&&(top.document.title=this._title)):(this._currentstate=$1,this._parse($1))))},set:function($1){if(0!=lz.embed.history.active&&(null==$1&&($1=""),lz.embed.history._currentstate!=$1)){lz.embed.history._currentstate=$1;var $2="#"+$1;if(lz.embed.browser.isIE){top.location.hash="#0"==$2?"":$2;var $3=lz.embed.history._iframe.contentDocument||lz.embed.history._iframe.contentWindow.document;$3.open(),$3.close(),$3.location.hash=$2,lz.embed.history._parse($1+"")}else if(lz.embed.browser.isSafari)if(lz.embed.history._history[history.length]=$2,lz.embed.history._historylength=history.length+1,lz.embed.browser.version<412)""==top.location.search&&(lz.embed.history._form.action=$2,top.document.location.lzaddr.history=lz.embed.history._history.toString(),lz.embed.history._skip=!0,lz.embed.history._form.submit(),lz.embed.history._skip=!1);else{var $4=document.createEvent("MouseEvents");$4.initEvent("click",!0,!0);var $5=document.createElement("a");$5.href=$2,$5.dispatchEvent($4)}else top.location.hash=$2,lz.embed.history._parse($1+"");return!0}},get:function(){var $1="";lz.embed.browser.isIE?lz.embed.history._iframe&&($1=(lz.embed.history._iframe.contentDocument||lz.embed.history._iframe.contentWindow.document).location.hash):$1=top.location.href;var $3=$1.indexOf("#");return-1!=$3?$1.substring($3+1):""},_parse:function($1){var $2=lz.embed.history;if(0!=$1.length)for(var $3=0,$4=lz.embed.history._apps.length;$3<$4;$3++){var $5=lz.embed.history._apps[$3];if($5.loaded&&$5._lasthash!=$1)if($5._lasthash=$1,-1!=$1.indexOf("_lz"))for(var $6=($1=$1.substring(3)).split(","),$7=0;$7<$6.length;$7++){var $8=$6[$7],$9=$8.indexOf("="),$10=unescape($8.substring(0,$9)),$11=unescape($8.substring($9+1));lz.embed.setCanvasAttribute($10,$11),window.canvas&&canvas.setAttribute($10,$11)}else"swf"==$5.runtime?$2.__setFlash($1,$5._id):window.lz&&lz.History&&lz.History.isReady&&lz.History.receiveHistory&&lz.History.receiveHistory($1)}},_store:function($1,$2){if($1 instanceof Object){var $3="";for(var $4 in $1)""!=$3&&($3+=","),$3+=escape($4)+"="+escape($1[$4])}else $3=escape($1)+"="+escape($2);this.set("_lz"+$3)},__setFlash:function($1,$2){var $3=lz.embed[$2];if($3&&$3.loaded&&"swf"==$3.runtime&&$3._getSWFDiv()){$3.callMethod("lz.History.receiveHistory("+$1+")");$3._lasthash=$1}}},lz.embed.browser.isFirefox&&(window.onunload=function(){}),lz.embed.regex={cache:{},create:function($1,$2,$3){try{var $4=lz.embed.regex;return $4.cache[$1]=new RegExp($4.unmask($2),$4.unmask($3)),!0}catch(e){return e.name+": "+e.message}},test:function($1,$2,$3){var $4=lz.embed.regex,$5=$4.cache[$1];return $5.lastIndex=$3,[$5.test($4.unmask($2)),$5.lastIndex]},exec:function($1,$2,$3){var $4=lz.embed.regex,$5=$4.cache[$1];$5.lastIndex=$3;var $6=$5.exec($4.unmask($2));return $6?(($6=$4.maskArr($6)).push($6.index,$5.lastIndex),$6):null},match:function($1,$2){var $3=lz.embed.regex,$4=$3.unmask($2).match($3.cache[$1]);return $4?$3.maskArr($4):null},replace:function($1,$2,$3){var $4=lz.embed.regex;return $4.mask($4.unmask($2).replace($4.cache[$1],$4.unmask($3)))},search:function($1,$2){var $3=lz.embed.regex;return $3.unmask($2).search($3.cache[$1])},split:function($1,$2,$3){var $4=lz.embed.regex;return $4.maskArr($4.unmask($2).split($4.cache[$1],$3))},remove:function($1){delete lz.embed.regex.cache[$1]},mask:function($1){return null!=$1&&/^\s*$/.test($1)?"__#lznull"+$1.replace(/\s/g,(function($1){switch($1){case" ":return"w";case"\f":return"f";case"\n":return"n";case"\r":return"r";case"\t":return"t";case"":return"s";case"\u2028":return"l";case"\u2029":return"p"}})):$1},unmask:function($1){return"__#lznull"==$1?"":$1},maskArr:function($1){for(var $2=lz.embed.regex,$3=0;$3<$1.length;++$3)$1[$3]=$2.mask($1[$3]);return $1}},lz}));
define('filter_poodll/anim_progress_bar', ["jquery","core/log"],(function($,log){return log.debug("Bar Progress: initialising"),{playcanvas:null,context:null,startx:null,starty:null,barwidth:null,barheight:null,enabled:!1,drawparams:{barColor:"#C2C2C2",textColor:"#0",font:"12px Arial",textAlign:"center"},clone:function(){return $.extend(!0,{},this)},init:function(playcanvas){this.playcanvas=playcanvas.get(0),this.startx=0,this.starty=0,this.barwidth=this.playcanvas.width,this.barheight=this.playcanvas.height,this.context=this.playcanvas.getContext("2d")},setDrawParam:function(paramkey,paramvalue){this.drawparams[paramkey]=paramvalue},clear:function(){this.context.clearRect(this.startx,this.starty,this.barwidth,this.barheight)},fetchCurrent:function(){return 0},stop:function(){this.enabled=!1,this.clear()},stopthere:function(){this.enabled=!1},start:function(){this.clear(),this.enabled=!0;var that=this;this.context.textAlign=this.drawparams.textAlign,this.context.font=this.drawparams.font;this.drawparams.textColor;!function draw(){that.enabled&&(that.clear(),that.context.fillStyle=that.drawparams.barColor,that.context.fillRect(that.startx,that.starty,that.fetchCurrent()*that.barwidth,that.barheight),(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame)(draw))}()}}}));
define('filter_poodll/mediaparser', ["jquery","core/log"],(function($,log){return log.debug("Media Parser: initialising"),{parse:function(containerid,mediatype){var ret={mediaurl:!1,lang:!1,subtitlesurl:!1,sources:!1,imgurl:!1},originalplayer=$("#"+containerid+" "+mediatype).first();if(1===originalplayer.length)ret.lang=$("#"+containerid+" "+mediatype+' track[kind="captions"]').first().attr("srclang"),ret.subtitlesurl=$("#"+containerid+" "+mediatype+' track[kind="captions"]').first().attr("src"),void 0!==originalplayer.attr("src")?ret.mediaurl=originalplayer.attr("src"):ret.mediaurl=$("#"+containerid+" "+mediatype+" source").first().attr("src"),ret.sources=$("#"+containerid+" "+mediatype+" source"),originalplayer.addClass("nomediaplugin"),originalplayer.addClass("nopoodll");else{var originallink=$("#"+containerid+" a").first();if(ret.mediaurl=originallink.attr("href"),ret.lang=originallink.attr("data-lang"),ret.subtitlesurl=originallink.attr("data-subtitles"),ret.imgurl=originallink.attr("data-img"),void 0===ret.subtitlesurl&&ret.mediaurl.split("?").length>0){var urlParams=new URLSearchParams(ret.mediaurl.split("?")[1]);ret.subtitlesurl=urlParams.get("data-subtitles"),ret.lang=urlParams.get("data-language"),ret.mediaurl=mediaurl.split("?")[0]}originallink.addClass("nomediaplugin"),originallink.addClass("nopoodll")}if(!ret.imgurl){var originalimg=$("#"+containerid+" img").first();1===originalimg.length&&(ret.imgurl=originalimg.attr("src"))}return ret}}}));
define('filter_poodll/upskin_plain', ["jquery","core/log"],(function($,log){return log.debug("upskin_plain: initialising"),{element:null,cvs:null,cvsctx:null,clone:function(){return $.extend(!0,{},this)},init:function(config,element,cvs,messagearea){this.config=config,this.element=element,this.cvs=cvs,this.messagearea=messagearea},initControls:function(){var skin_style=this.config.media_skin_style,controls='<div id="'+this.config.widgetid+'_progress" class="p_progress x progress_'+skin_style+'"><p></p></div>';controls+='<div id="'+this.config.widgetid+'_messages" class="p_messages x messages_'+skin_style+'"></div>',$(this.element).append(controls)},initProgressSession:function(xhr){var progress=!1,o_query=$("#"+this.config.widgetid+"_progress");if(o_query.length){var o=o_query.get(0);null===(progress=o.firstChild)&&(progress=o.appendChild(document.createElement("p"))),progress.className="",progress.style.display="block",progress.style.backgroundPosition="100% 0",xhr.upload.addEventListener("progress",(function(e){var pc=parseInt(100-e.loaded/e.total*100);progress.style.backgroundPosition=pc+"% 0"}))}},deactivateProgressSession:function(){},showMessage:function(msg,msgid){$("#"+this.config.widgetid+"_messages").text(msg)}}}));
define('filter_poodll/template_amd', ["jquery","core/log"],(function($,log){return log.debug("Filter Poodll initialising"),{allopts:{},extscripts:{},csslinks:Array(),jslinks:Array(),appendjspath:function(jslink,theprefix){require.config({paths:{theprefix:jslink}})},injectcss:function(csslink){var link=document.createElement("link");link.href=csslink,csslink.toLowerCase().lastIndexOf(".html")==csslink.length-5?link.rel="import":(link.type="text/css",link.rel="stylesheet"),document.getElementsByTagName("head")[0].appendChild(link)},loadtemplate:function(opts){var theid="#filter_poodll_amdopts_"+opts.AUTOID,optscontrol=$(theid).get(0);optscontrol&&(opts=JSON.parse(optscontrol.value),$(theid).remove()),opts.CSSLINK&&this.csslinks.indexOf(opts.CSSLINK)<0&&(this.csslinks.push(opts.CSSLINK),this.injectcss(opts.CSSLINK)),opts.CSSUPLOAD&&this.csslinks.indexOf(opts.CSSUPLOAD)<0&&(this.csslinks.push(opts.CSSUPLOAD),this.injectcss(opts.CSSUPLOAD)),opts.CSSCUSTOM&&this.csslinks.indexOf(opts.CSSCUSTOM)<0&&(this.csslinks.push(opts.CSSCUSTOM),this.injectcss(opts.CSSCUSTOM)),void 0!==opts.TEMPLATEID&&require(["filter_poodll_d"+opts.TEMPLATEID],(function(d){d(opts)}))}}}));
define('filter_poodll/poodll_flashrecorder', ["jquery","core/log","filter_poodll/utils_amd","filter_poodll/uploader","filter_poodll/lzloader"],(function($,log,utils,uploader,lz){return log.debug("PoodLL Flash Recorder: initialising"),{instanceprops:[],fetch_instance_props:function(widgetid){return this.instanceprops[widgetid]},init_instance_props:function(widgetid){var props={savebutton:null,audiodatacontrol:null,config:null,uploader:null};this.instanceprops[widgetid]=props},supports_current_browser:function(config){var iOS=utils.is_ios(),isAndroid=utils.is_android();return!(iOS||!config.flashonandroid&&isAndroid)&&("audio"==config.mediatype&&(log.debug("PoodLL Flash Recorder: supports this browser"),!0))},embed:function(element,config){1==config.flashmp3_cloudbypass&&(config.posturl=config.cloudbypassurl,config.filename=!1,config.s3filename=!1,config.using_s3=!1),this.init_instance_props(config.widgetid);var ip=this.fetch_instance_props(config.widgetid);ip.ie=utils.is_ie(),ip.ie&&(config.flashmp3audio_widgetjson=config.flashmp3audio_widgetjson.replace("sendmethod=post","sendmethod=ajax")),ip.config=config;var swfopts=$.parseJSON(config.flashmp3audio_widgetjson);lz.embed.swf(swfopts);var savebuttonstyle="";ip.ie&&(savebuttonstyle=' style="display: none" ');var savebuttonid=config.widgetid+"_savebutton",savecontrol='<button id="'+savebuttonid+'" type="button" class="poodll_save-recording"'+savebuttonstyle+">"+M.util.get_string("recui_save","filter_poodll")+"</button>";$(element).append(savecontrol);var audiodatacontrolid=config.widgetid+"_adc",audiocontrol='<input type="hidden" name="audiodatacontrol" id="'+audiodatacontrolid+'" value="" />';$(element).prepend(audiocontrol),ip.uploader=uploader.clone(),ip.uploader.init(element,config),lz.embed[config.widgetid].setCanvasAttribute("audiodatacontrol",audiodatacontrolid),ip.savebutton=$("#"+savebuttonid),ip.audiodatacontrol=$("#"+audiodatacontrolid),this.registerevents(config.widgetid)},registerevents:function(widgetid){var ip=this.fetch_instance_props(widgetid);ip.audioblob=!1,ip.savebutton.click((function(){var audiodata=atob(ip.audiodatacontrol.val()),haveaudiodata=audiodata&&audiodata.length>0;if(!haveaudiodata&&!ip.audioblob)return ip.uploader.Output(M.util.get_string("recui_nothingtosaveerror","filter_poodll")),!1;if(!ip.audioblob&&haveaudiodata){for(var audioblobdata=[],i=0;i<audiodata.length;i++)audioblobdata.push(audiodata.charCodeAt(i));ip.audioblob=new Blob([new Uint8Array(audioblobdata)],{type:"audio/mpeg3"})}ip.uploader.uploadBlob(ip.audioblob,"audio/mpeg3");return lz.embed[ip.config.widgetid].callMethod("poodllapi.mp3_disable()"),ip.audiodatacontrol.val(""),!1}))}}}));
define('filter_poodll/poodll_basemediaskin', ["jquery","core/log","filter_poodll/utils_amd","filter_poodll/dlg_devicesettings","filter_poodll/anim_progress_bar","filter_poodll/upskin_bar"],(function($,log,utils,settings,anim_progress_bar,upskin_bar){return log.debug("PoodLL Base Skin: initialising"),{instanceprops:null,pmr:null,uploaded:!1,devsettings:null,clone:function(){return $.extend(!0,{},this)},init:function(ip,pmr){this.instanceprops=ip,this.pmr=pmr,this.devsettings=settings.clone(),this.devsettings.init(pmr,ip)},fetch_instanceprops:function(){return this.instanceprops},onUploadSuccess:function(controlbarid){$("#"+controlbarid+" > .poodll_save-recording").hide(),$("#"+controlbarid+" > .poodll_savedsuccessfully").show()},onUploadFailure:function(controlbarid){},fetch_status_bar:function(skin){return'<div class="poodll_status_'+skin+'" width="100%" height="50">00:00:00</div>'},fetch_preview_audio:function(skin){return'<audio class="poodll_preview_'+skin+'"  playsinline muted style="display: none;" controls></audio>'},fetch_preview_video:function(skin){return'<video class="poodll_preview_'+skin+'" playsinline muted ></video>'},fetch_resource_audio:function(skin){return'<audio class="poodll_resourceplayer_'+skin+'" style="display: none;" ></audio>'},fetch_resource_video:function(skin){return'<video class="poodll_resourceplayer_'+skin+'" style="display: none;" playsinline="playsinline"></video>'},fetch_uploader_skin:function(controlbarid,element){var ip=this.fetch_instanceprops(controlbarid),upskin=upskin_bar.clone();return upskin.init(ip.config,element,ip.controlbar.progresscanvas,ip.controlbar.timer),upskin},onMediaError:function(e){console.error("media error",e)},onMediaSuccess_video:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.uploader.Output(""),this.set_visual_mode("recordmode",controlbarid),ip.controlbar.preview.attr("src",null),ip.timer.reset(),ip.timer.start(),this.update_status(controlbarid)},onMediaSuccess_audio:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.uploader.Output(""),this.set_visual_mode("recordmode",controlbarid),ip.timer.reset(),ip.timer.start(),this.update_status(controlbarid)},handle_timer_update:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.status.html(ip.timer.fetch_display_time()),0==ip.timer.seconds&&ip.timer.initseconds>0&&ip.controlbar.stopbutton.click()},update_status:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.status.html(ip.timer.fetch_display_time())},set_visual_mode:function(mode,controlbarid){var ip=this.fetch_instanceprops(controlbarid);switch(mode){case"recordmode":ip.controlbar.progress.hide(),this.disable_button(ip.controlbar.startbutton),this.disable_button(ip.controlbar.playbutton),ip.controlbar.resumebutton.hide(),this.enable_button(ip.controlbar.stopbutton),this.disable_button(ip.controlbar.savebutton),ip.controlbar.pausebutton.show(),this.enable_button(ip.controlbar.pausebutton),ip.controlbar.preview.addClass("poodll_recording"),ip.controlbar.status.addClass("poodll_recording"),"audio"==ip.config.mediatype&&ip.controlbar.preview.hide(),ip.controlbar.status.show();break;case"playingmode":this.disable_button(ip.controlbar.playbutton),this.enable_button(ip.controlbar.stopbutton),this.disable_button(ip.controlbar.startbutton),this.disable_button(ip.controlbar.savebutton),ip.controlbar.progresscanvas.show();break;case"previewmode":this.enable_button(ip.controlbar.playbutton),this.disable_button(ip.controlbar.pausebutton),this.disable_button(ip.controlbar.stopbutton),this.uploaded||(this.enable_button(ip.controlbar.startbutton),this.enable_button(ip.controlbar.savebutton)),ip.controlbar.resumebutton.hide(),ip.controlbar.pausebutton.show(),ip.controlbar.preview.removeClass("poodll_recording"),ip.controlbar.status.removeClass("poodll_recording"),ip.controlbar.timer.html("00:00:00"),ip.controlbar.progress.show(),ip.controlbar.progresscanvas.hide(),ip.controlbar.status.hide();break;case"pausedmode":this.enable_button(ip.controlbar.resumebutton),this.enable_button(ip.controlbar.savebutton),ip.controlbar.preview.removeClass("poodll_recording"),ip.controlbar.status.removeClass("poodll_recording");break;case"uploadingmode":this.disable_button(ip.controlbar.startbutton),ip.controlbar.progresscanvas.show()}},insert_controlbar_video:function(element,controlbarid,preview,resource){return this.prepare_controlbar(element,controlbarid,preview,resource,"video")},insert_controlbar_audio:function(element,controlbarid,preview,resource){return this.prepare_controlbar(element,controlbarid,preview,resource,"audio")},prepare_controlbar:function(element,controlbarid,preview,resource,mediatype){var ip=this.fetch_instanceprops(controlbarid),skin_style=ip.config.media_skin_style,recorder_class="video"==mediatype?"poodll_mediarecorder_video":"poodll_mediarecorder_audio",size_class="poodll_mediarecorder_size_auto";switch(ip.config.size){case"small":size_class="poodll_mediarecorder_size_small";break;case"big":size_class="poodll_mediarecorder_size_big";break;case"auto":size_class="poodll_mediarecorder_size_auto"}var ss=this.pmr.fetch_strings(),hideshowupload=ip.showupload?"inline-block":"none",controls='<div class="poodll_mediarecorderholder_standard '+recorder_class+" "+size_class+'" id="holder_'+controlbarid+'">';controls+='<div class="poodll_mediarecorderbox_standard" id="'+controlbarid+'">',controls+=this.devsettings.fetch_dialogue_box(),controls+=ip.downloaddialog.fetch_dialogue_box(),controls+=ip.errordialog.fetch_dialogue_box(),controls+='<div class="style-holder '+skin_style+'">',controls+=this.fetch_status_bar("standard"),controls+='<div class="hp_slide" id="slide_'+controlbarid+'">',controls+='<div class="hp_timer"></div>',controls+='<canvas class="hp_range"></canvas>',controls+="</div>",controls+=preview,controls+='<div class="settingsicon" id="settingsicon_'+controlbarid+'"><button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal"><i class="fa fa-cogs" aria-hidden="true"></i></button></div>',controls+='<button type="button" class="poodll_mediarecorder_button_standard poodll_start-recording_standard">'+ss.recui_record+"</button>",controls+='<button type="button" class="poodll_mediarecorder_button_standard poodll_stop-recording_standard pmr_disabled" disabled>'+ss.recui_stop+"</button>",controls+='<button type="button" class="poodll_mediarecorder_button_standard poodll_pause-recording_standard pmr_disabled" disabled>'+ss.recui_pause+"</button>",controls+=' <button type="button" class="poodll_mediarecorder_button_standard poodll_resume-recording_standard pmr_disabled" style="display: none;" disabled>'+ss.recui_continue+"</button>",controls+=' <button type="button" class="poodll_mediarecorder_button_standard poodll_play-recording_standard pmr_disabled" disabled>'+ss.recui_play+"</button>",controls+='<button type="button" class="poodll_save-recording_standard pmr_disabled" style="display: '+hideshowupload+';" disabled>'+ss.recui_save+"</button>",controls+="</div>",controls+="</div>",controls+="</div>",$(element).prepend(controls);var controlbar={settingsdialog:$("#"+controlbarid+" .poodll_dialogue_box_settings"),downloaddialog:$("#"+controlbarid+" .poodll_dialogue_box_download"),errorsdialog:$("#"+controlbarid+" .poodll_dialogue_box_errors"),settingsicon:$("#"+controlbarid+" .settingsicon"),progresscanvas:$("#"+controlbarid+" .hp_range"),progress:$("#"+controlbarid+" .hp_slide"),timer:$("#"+controlbarid+" .hp_timer"),status:$("#"+controlbarid+"  .poodll_status_standard"),preview:$("#"+controlbarid+"  .poodll_preview_standard"),startbutton:$("#"+controlbarid+"  .poodll_start-recording_standard"),stopbutton:$("#"+controlbarid+"  .poodll_stop-recording_standard"),pausebutton:$("#"+controlbarid+"  .poodll_pause-recording_standard"),resumebutton:$("#"+controlbarid+"  .poodll_resume-recording_standard"),playbutton:$("#"+controlbarid+"  .poodll_play-recording_standard"),savebutton:$("#"+controlbarid+"  .poodll_save-recording_standard")};return ip.downloaddialog.set_dialogue_box(controlbar.downloaddialog),ip.errordialog.set_dialogue_box(controlbar.errorsdialog),this.devsettings.set_dialogue_box(controlbar.settingsdialog),controlbar},register_controlbar_events_video:function(onMediaSuccess,controlbarid){return this.register_controlbar_events_audio(onMediaSuccess,controlbarid)},register_controlbar_events_audio:function(onMediaSuccess,controlbarid){var self=this,pmr=this.pmr,ip=this.fetch_instanceprops(controlbarid),hprogress=anim_progress_bar.clone();hprogress.init(ip.controlbar.progresscanvas),ip.controlbar.settingsicon.click((function(){self.uploaded?ip.downloaddialog.open():self.devsettings.open()})),ip.controlbar.startbutton.click((function(){pmr.do_start_audio(ip,onMediaSuccess)})),ip.controlbar.stopbutton.click((function(){var preview=ip.controlbar.preview;preview&&preview.get(0)&&preview.get(0).pause(),pmr.do_stop_audio(ip),ip.timer.stop(),ip.timer.reset(),self.update_status(controlbarid),hprogress.stop(),self.set_visual_mode("previewmode",controlbarid)})),ip.controlbar.pausebutton.click((function(){this.disabled=!0,$(this).hide(),ip.controlbar.resumebutton.show(),pmr.do_pause_audio(ip),ip.timer.pause(),self.update_status(controlbarid),self.set_visual_mode("pausedmode",controlbarid)})),ip.controlbar.resumebutton.click((function(){pmr.do_resume_audio(ip),ip.timer.resume(),self.update_status(controlbarid),self.set_visual_mode("recordmode",controlbarid)})),ip.controlbar.playbutton.click((function(){var preview=ip.controlbar.preview.get(0);pmr.do_play_audio(ip,preview),ip.controlbar.preview.on("timeupdate",(function(){if(!this.paused){var currentTime=this.currentTime;ip.controlbar.timer.html(ip.timer.fetch_display_time(currentTime))}})),self.set_visual_mode("playingmode",controlbarid),hprogress.clear(),hprogress.fetchCurrent=function(){var ct=ip.controlbar.preview.prop("currentTime"),duration=ip.controlbar.preview.prop("duration");return isFinite(duration)||(duration=ip.timer.finalseconds),ct/duration},hprogress.start()})),ip.controlbar.savebutton.click((function(){return self.disable_button(this),ip.blobs&&ip.blobs.length>0?(pmr.do_save_audio(ip),self.uploaded=!0,self.set_visual_mode("uploadingmode",controlbarid)):ip.uploader.Output(M.util.get_string("recui_nothingtosaveerror","filter_poodll")),!1})),window.onbeforeunload=function(){self.enable_button(ip.controlbar.startbutton);var preview=ip.controlbar.preview;preview&&preview.get(0)&&preview.get(0).pause()}},enable_button:function(button){$(button).attr("disabled",!1),$(button).removeClass("pmr_disabled")},disable_button:function(button){$(button).attr("disabled",!0),$(button).addClass("pmr_disabled")}}}));
var factory;factory=function($){var flip=function($dom,callback){$dom.data("flipped",!0);var rotateAxis="rotate"+$dom.data("axis");$dom.find($dom.data("front")).css({transform:rotateAxis+($dom.data("reverse")?"(-180deg)":"(180deg)"),"z-index":"0"}),$dom.find($dom.data("back")).css({transform:rotateAxis+"(0deg)","z-index":"1"}),$dom.one(whichTransitionEvent(),(function(){$(this).trigger("flip:done"),void 0!==callback&&callback.call(this)}))},unflip=function($dom,callback){$dom.data("flipped",!1);var rotateAxis="rotate"+$dom.data("axis");$dom.find($dom.data("front")).css({transform:rotateAxis+"(0deg)","z-index":"1"}),$dom.find($dom.data("back")).css({transform:rotateAxis+($dom.data("reverse")?"(180deg)":"(-180deg)"),"z-index":"0"}),$dom.one(whichTransitionEvent(),(function(){$(this).trigger("flip:done"),void 0!==callback&&callback.call(this)}))},whichTransitionEvent=function(){var t,el=document.createElement("fakeelement"),transitions={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in transitions)if(void 0!==el.style[t])return transitions[t]};$.fn.flip=function(options,callback){return"function"==typeof options&&(callback=options),this.each((function(){var $dom=$(this);if(void 0===options||"boolean"!=typeof options&&"string"!=typeof options)if($dom.data("initiated"))!options||void 0===options.axis&&void 0===options.reverse||changeSettings.call(this,options,(function(){$dom.trigger("flip:change"),void 0!==callback&&callback.call(this)}));else{$dom.data("initiated",!0);var settings=$.extend({axis:"y",reverse:!1,trigger:"click",speed:500,forceHeight:!1,forceWidth:!1,autoSize:!0,front:"auto",back:"auto"},options);"auto"==settings.front?settings.front=$dom.find(".front").length>0?".front":"div:first-child":"autostrict"==settings.front&&(settings.front="div:first-child"),"auto"==settings.back?settings.back=$dom.find(".back").length>0?".back":"div:first-child + div":"autostrict"==settings.back&&(settings.back="div:first-child + div"),$dom.data("reverse",settings.reverse),$dom.data("axis",settings.axis),$dom.data("front",settings.front),$dom.data("back",settings.back);var rotateAxis="rotate"+("x"==settings.axis.toLowerCase()?"x":"y"),perspective=2*$dom["outer"+("rotatex"==rotateAxis?"Height":"Width")]();$dom.find($dom.data("back")).css({transform:rotateAxis+"("+(settings.reverse?"180deg":"-180deg")+")"}),$dom.css({perspective:perspective,position:"relative"});var speedInSec=settings.speed/1e3||.5,faces=$dom.find(settings.front).add(settings.back,$dom);if(settings.forceHeight?faces.outerHeight($dom.height()):settings.autoSize&&faces.css({height:"100%"}),settings.forceWidth?faces.outerWidth($dom.width()):settings.autoSize&&faces.css({width:"100%"}),faces.css({"backface-visibility":"hidden","transform-style":"preserve-3d",position:"absolute","z-index":"1"}),faces.find("*").css({"backface-visibility":"hidden"}),$dom.find($dom.data("back")).css({transform:rotateAxis+"("+(settings.reverse?"180deg":"-180deg")+")","z-index":"0"}),(window.chrome||window.Intl&&Intl.v8BreakIterator)&&"CSS"in window&&$dom.css({"-webkit-transform-style":"preserve-3d"}),setTimeout((function(){faces.css({transition:"all "+speedInSec+"s ease-out"}),void 0!==callback&&callback.call(this)}),20),"click"==settings.trigger.toLowerCase())$dom.on($.fn.tap?"tap.flip":"click.flip",(function(event){event||(event=window.event),$dom.find($(event.target).closest('button, a, input[type="submit"]')).length||($dom.data("flipped")?unflip($dom):flip($dom))}));else if("hover"==settings.trigger.toLowerCase()){var performUnflip=function(){unflip($dom)};$dom.on("mouseenter.flip",(function(){$dom.off("mouseleave.flip"),flip($dom),setTimeout((function(){$dom.on("mouseleave.flip",performUnflip),$dom.is(":hover")||unflip($dom)}),settings.speed+150)})),$dom.on("mouseleave.flip",performUnflip)}}else"toggle"==options&&(options=!$dom.data("flipped")),options?flip($dom,callback):unflip($dom,callback)})),this};var changeSettings=function(options,callback){var changeNeeded=!1;if(void 0!==options.axis&&$(this).data("axis")!=options.axis.toLowerCase()&&($(this).data("axis",options.axis.toLowerCase()),changeNeeded=!0),void 0!==options.reverse&&$(this).data("reverse")!=options.reverse&&($(this).data("reverse",options.reverse),changeNeeded=!0),changeNeeded){var faces=$(this).find($(this).data("front")).add($(this).data("back"),$(this)),savedTrans=faces.css("transition");faces.css({transition:"none"});var rotateAxis="rotate"+$(this).data("axis");$(this).data("flipped")?$(this).find($(this).data("front")).css({transform:rotateAxis+($(this).data("reverse")?"(-180deg)":"(180deg)"),"z-index":"0"}):$(this).find($(this).data("back")).css({transform:rotateAxis+"("+($(this).data("reverse")?"180deg":"-180deg")+")","z-index":"0"}),setTimeout(function(){faces.css({transition:savedTrans}),callback.call(this)}.bind(this),0)}else setTimeout(callback.bind(this),0)}},"function"==typeof define&&define.amd?define("filter_poodll/jquery.flip",["jquery"],factory):factory(jQuery);
function _typeof2(obj){return _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof2(obj)}!function(f){if("object"===("undefined"==typeof exports?"undefined":_typeof2(exports))&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define("filter_poodll/adapter",[],f);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).adapter=f()}}((function(){return function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,(function(r){return o(e[i][1][r]||r)}),p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){var adapter=(0,require("./adapter_factory.js").adapterFactory)({window:"undefined"==typeof window?void 0:window});module.exports=adapter},{"./adapter_factory.js":2}],2:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.adapterFactory=function(){var _ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},window=_ref.window,options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},logging=utils.log,browserDetails=utils.detectBrowser(window),adapter={browserDetails:browserDetails,commonShim:commonShim,extractVersion:utils.extractVersion,disableLog:utils.disableLog,disableWarnings:utils.disableWarnings,sdp:sdp};switch(browserDetails.browser){case"chrome":if(!chromeShim||!chromeShim.shimPeerConnection||!options.shimChrome)return logging("Chrome shim is not included in this adapter release."),adapter;if(null===browserDetails.version)return logging("Chrome shim can not determine version, not shimming."),adapter;logging("adapter.js shimming chrome."),adapter.browserShim=chromeShim,commonShim.shimAddIceCandidateNullOrEmpty(window,browserDetails),commonShim.shimParameterlessSetLocalDescription(window,browserDetails),chromeShim.shimGetUserMedia(window,browserDetails),chromeShim.shimMediaStream(window,browserDetails),chromeShim.shimPeerConnection(window,browserDetails),chromeShim.shimOnTrack(window,browserDetails),chromeShim.shimAddTrackRemoveTrack(window,browserDetails),chromeShim.shimGetSendersWithDtmf(window,browserDetails),chromeShim.shimGetStats(window,browserDetails),chromeShim.shimSenderReceiverGetStats(window,browserDetails),chromeShim.fixNegotiationNeeded(window,browserDetails),commonShim.shimRTCIceCandidate(window,browserDetails),commonShim.shimConnectionState(window,browserDetails),commonShim.shimMaxMessageSize(window,browserDetails),commonShim.shimSendThrowTypeError(window,browserDetails),commonShim.removeExtmapAllowMixed(window,browserDetails);break;case"firefox":if(!firefoxShim||!firefoxShim.shimPeerConnection||!options.shimFirefox)return logging("Firefox shim is not included in this adapter release."),adapter;logging("adapter.js shimming firefox."),adapter.browserShim=firefoxShim,commonShim.shimAddIceCandidateNullOrEmpty(window,browserDetails),commonShim.shimParameterlessSetLocalDescription(window,browserDetails),firefoxShim.shimGetUserMedia(window,browserDetails),firefoxShim.shimPeerConnection(window,browserDetails),firefoxShim.shimOnTrack(window,browserDetails),firefoxShim.shimRemoveStream(window,browserDetails),firefoxShim.shimSenderGetStats(window,browserDetails),firefoxShim.shimReceiverGetStats(window,browserDetails),firefoxShim.shimRTCDataChannel(window,browserDetails),firefoxShim.shimAddTransceiver(window,browserDetails),firefoxShim.shimGetParameters(window,browserDetails),firefoxShim.shimCreateOffer(window,browserDetails),firefoxShim.shimCreateAnswer(window,browserDetails),commonShim.shimRTCIceCandidate(window,browserDetails),commonShim.shimConnectionState(window,browserDetails),commonShim.shimMaxMessageSize(window,browserDetails),commonShim.shimSendThrowTypeError(window,browserDetails);break;case"safari":if(!safariShim||!options.shimSafari)return logging("Safari shim is not included in this adapter release."),adapter;logging("adapter.js shimming safari."),adapter.browserShim=safariShim,commonShim.shimAddIceCandidateNullOrEmpty(window,browserDetails),commonShim.shimParameterlessSetLocalDescription(window,browserDetails),safariShim.shimRTCIceServerUrls(window,browserDetails),safariShim.shimCreateOfferLegacy(window,browserDetails),safariShim.shimCallbacksAPI(window,browserDetails),safariShim.shimLocalStreamsAPI(window,browserDetails),safariShim.shimRemoteStreamsAPI(window,browserDetails),safariShim.shimTrackEventTransceiver(window,browserDetails),safariShim.shimGetUserMedia(window,browserDetails),safariShim.shimAudioContext(window,browserDetails),commonShim.shimRTCIceCandidate(window,browserDetails),commonShim.shimMaxMessageSize(window,browserDetails),commonShim.shimSendThrowTypeError(window,browserDetails),commonShim.removeExtmapAllowMixed(window,browserDetails);break;default:logging("Unsupported browser!")}return adapter};var utils=_interopRequireWildcard(require("./utils")),chromeShim=_interopRequireWildcard(require("./chrome/chrome_shim")),firefoxShim=_interopRequireWildcard(require("./firefox/firefox_shim")),safariShim=_interopRequireWildcard(require("./safari/safari_shim")),commonShim=_interopRequireWildcard(require("./common_shim")),sdp=_interopRequireWildcard(require("sdp"));function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}},{"./chrome/chrome_shim":3,"./common_shim":6,"./firefox/firefox_shim":7,"./safari/safari_shim":10,"./utils":11,sdp:12}],3:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimGetDisplayMedia=exports.shimGetUserMedia=void 0;var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_getusermedia=require("./getusermedia");Object.defineProperty(exports,"shimGetUserMedia",{enumerable:!0,get:function(){return _getusermedia.shimGetUserMedia}});var _getdisplaymedia=require("./getdisplaymedia");Object.defineProperty(exports,"shimGetDisplayMedia",{enumerable:!0,get:function(){return _getdisplaymedia.shimGetDisplayMedia}}),exports.shimMediaStream=function(window){window.MediaStream=window.MediaStream||window.webkitMediaStream},exports.shimOnTrack=function(window){if("object"===(void 0===window?"undefined":_typeof(window))&&window.RTCPeerConnection&&!("ontrack"in window.RTCPeerConnection.prototype)){Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(f){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=f)},enumerable:!0,configurable:!0});var origSetRemoteDescription=window.RTCPeerConnection.prototype.setRemoteDescription;window.RTCPeerConnection.prototype.setRemoteDescription=function(){var _this=this;return this._ontrackpoly||(this._ontrackpoly=function(e){e.stream.addEventListener("addtrack",(function(te){var receiver=void 0;receiver=window.RTCPeerConnection.prototype.getReceivers?_this.getReceivers().find((function(r){return r.track&&r.track.id===te.track.id})):{track:te.track};var event=new Event("track");event.track=te.track,event.receiver=receiver,event.transceiver={receiver:receiver},event.streams=[e.stream],_this.dispatchEvent(event)})),e.stream.getTracks().forEach((function(track){var receiver=void 0;receiver=window.RTCPeerConnection.prototype.getReceivers?_this.getReceivers().find((function(r){return r.track&&r.track.id===track.id})):{track:track};var event=new Event("track");event.track=track,event.receiver=receiver,event.transceiver={receiver:receiver},event.streams=[e.stream],_this.dispatchEvent(event)}))},this.addEventListener("addstream",this._ontrackpoly)),origSetRemoteDescription.apply(this,arguments)}}else utils.wrapPeerConnectionEvent(window,"track",(function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}))},exports.shimGetSendersWithDtmf=function(window){if("object"===(void 0===window?"undefined":_typeof(window))&&window.RTCPeerConnection&&!("getSenders"in window.RTCPeerConnection.prototype)&&"createDTMFSender"in window.RTCPeerConnection.prototype){var shimSenderWithDtmf=function(pc,track){return{track:track,get dtmf(){return void 0===this._dtmf&&("audio"===track.kind?this._dtmf=pc.createDTMFSender(track):this._dtmf=null),this._dtmf},_pc:pc}};if(!window.RTCPeerConnection.prototype.getSenders){window.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var origAddTrack=window.RTCPeerConnection.prototype.addTrack;window.RTCPeerConnection.prototype.addTrack=function(track,stream){var sender=origAddTrack.apply(this,arguments);return sender||(sender=shimSenderWithDtmf(this,track),this._senders.push(sender)),sender};var origRemoveTrack=window.RTCPeerConnection.prototype.removeTrack;window.RTCPeerConnection.prototype.removeTrack=function(sender){origRemoveTrack.apply(this,arguments);var idx=this._senders.indexOf(sender);-1!==idx&&this._senders.splice(idx,1)}}var origAddStream=window.RTCPeerConnection.prototype.addStream;window.RTCPeerConnection.prototype.addStream=function(stream){var _this2=this;this._senders=this._senders||[],origAddStream.apply(this,[stream]),stream.getTracks().forEach((function(track){_this2._senders.push(shimSenderWithDtmf(_this2,track))}))};var origRemoveStream=window.RTCPeerConnection.prototype.removeStream;window.RTCPeerConnection.prototype.removeStream=function(stream){var _this3=this;this._senders=this._senders||[],origRemoveStream.apply(this,[stream]),stream.getTracks().forEach((function(track){var sender=_this3._senders.find((function(s){return s.track===track}));sender&&_this3._senders.splice(_this3._senders.indexOf(sender),1)}))}}else if("object"===(void 0===window?"undefined":_typeof(window))&&window.RTCPeerConnection&&"getSenders"in window.RTCPeerConnection.prototype&&"createDTMFSender"in window.RTCPeerConnection.prototype&&window.RTCRtpSender&&!("dtmf"in window.RTCRtpSender.prototype)){var origGetSenders=window.RTCPeerConnection.prototype.getSenders;window.RTCPeerConnection.prototype.getSenders=function(){var _this4=this,senders=origGetSenders.apply(this,[]);return senders.forEach((function(sender){return sender._pc=_this4})),senders},Object.defineProperty(window.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},exports.shimGetStats=function(window){if(!window.RTCPeerConnection)return;var origGetStats=window.RTCPeerConnection.prototype.getStats;window.RTCPeerConnection.prototype.getStats=function(){var _this5=this,_arguments=Array.prototype.slice.call(arguments),selector=_arguments[0],onSucc=_arguments[1],onErr=_arguments[2];if(arguments.length>0&&"function"==typeof selector)return origGetStats.apply(this,arguments);if(0===origGetStats.length&&(0===arguments.length||"function"!=typeof selector))return origGetStats.apply(this,[]);var fixChromeStats_=function(response){var standardReport={};return response.result().forEach((function(report){var standardStats={id:report.id,timestamp:report.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[report.type]||report.type};report.names().forEach((function(name){standardStats[name]=report.stat(name)})),standardReport[standardStats.id]=standardStats})),standardReport},makeMapStats=function(stats){return new Map(Object.keys(stats).map((function(key){return[key,stats[key]]})))};if(arguments.length>=2){var successCallbackWrapper_=function(response){onSucc(makeMapStats(fixChromeStats_(response)))};return origGetStats.apply(this,[successCallbackWrapper_,selector])}return new Promise((function(resolve,reject){origGetStats.apply(_this5,[function(response){resolve(makeMapStats(fixChromeStats_(response)))},reject])})).then(onSucc,onErr)}},exports.shimSenderReceiverGetStats=function(window){if(!("object"===(void 0===window?"undefined":_typeof(window))&&window.RTCPeerConnection&&window.RTCRtpSender&&window.RTCRtpReceiver))return;if(!("getStats"in window.RTCRtpSender.prototype)){var origGetSenders=window.RTCPeerConnection.prototype.getSenders;origGetSenders&&(window.RTCPeerConnection.prototype.getSenders=function(){var _this6=this,senders=origGetSenders.apply(this,[]);return senders.forEach((function(sender){return sender._pc=_this6})),senders});var origAddTrack=window.RTCPeerConnection.prototype.addTrack;origAddTrack&&(window.RTCPeerConnection.prototype.addTrack=function(){var sender=origAddTrack.apply(this,arguments);return sender._pc=this,sender}),window.RTCRtpSender.prototype.getStats=function(){var sender=this;return this._pc.getStats().then((function(result){return utils.filterStats(result,sender.track,!0)}))}}if(!("getStats"in window.RTCRtpReceiver.prototype)){var origGetReceivers=window.RTCPeerConnection.prototype.getReceivers;origGetReceivers&&(window.RTCPeerConnection.prototype.getReceivers=function(){var _this7=this,receivers=origGetReceivers.apply(this,[]);return receivers.forEach((function(receiver){return receiver._pc=_this7})),receivers}),utils.wrapPeerConnectionEvent(window,"track",(function(e){return e.receiver._pc=e.srcElement,e})),window.RTCRtpReceiver.prototype.getStats=function(){var receiver=this;return this._pc.getStats().then((function(result){return utils.filterStats(result,receiver.track,!1)}))}}if(!("getStats"in window.RTCRtpSender.prototype)||!("getStats"in window.RTCRtpReceiver.prototype))return;var origGetStats=window.RTCPeerConnection.prototype.getStats;window.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof window.MediaStreamTrack){var track=arguments[0],sender=void 0,receiver=void 0,err=void 0;return this.getSenders().forEach((function(s){s.track===track&&(sender?err=!0:sender=s)})),this.getReceivers().forEach((function(r){return r.track===track&&(receiver?err=!0:receiver=r),r.track===track})),err||sender&&receiver?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):sender?sender.getStats():receiver?receiver.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return origGetStats.apply(this,arguments)}},exports.shimAddTrackRemoveTrackWithNative=shimAddTrackRemoveTrackWithNative,exports.shimAddTrackRemoveTrack=function(window,browserDetails){if(!window.RTCPeerConnection)return;if(window.RTCPeerConnection.prototype.addTrack&&browserDetails.version>=65)return shimAddTrackRemoveTrackWithNative(window);var origGetLocalStreams=window.RTCPeerConnection.prototype.getLocalStreams;window.RTCPeerConnection.prototype.getLocalStreams=function(){var _this11=this,nativeStreams=origGetLocalStreams.apply(this);return this._reverseStreams=this._reverseStreams||{},nativeStreams.map((function(stream){return _this11._reverseStreams[stream.id]}))};var origAddStream=window.RTCPeerConnection.prototype.addStream;window.RTCPeerConnection.prototype.addStream=function(stream){var _this12=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},stream.getTracks().forEach((function(track){if(_this12.getSenders().find((function(s){return s.track===track})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[stream.id]){var newStream=new window.MediaStream(stream.getTracks());this._streams[stream.id]=newStream,this._reverseStreams[newStream.id]=stream,stream=newStream}origAddStream.apply(this,[stream])};var origRemoveStream=window.RTCPeerConnection.prototype.removeStream;function replaceInternalStreamId(pc,description){var sdp=description.sdp;return Object.keys(pc._reverseStreams||[]).forEach((function(internalId){var externalStream=pc._reverseStreams[internalId],internalStream=pc._streams[externalStream.id];sdp=sdp.replace(new RegExp(internalStream.id,"g"),externalStream.id)})),new RTCSessionDescription({type:description.type,sdp:sdp})}function replaceExternalStreamId(pc,description){var sdp=description.sdp;return Object.keys(pc._reverseStreams||[]).forEach((function(internalId){var externalStream=pc._reverseStreams[internalId],internalStream=pc._streams[externalStream.id];sdp=sdp.replace(new RegExp(externalStream.id,"g"),internalStream.id)})),new RTCSessionDescription({type:description.type,sdp:sdp})}window.RTCPeerConnection.prototype.removeStream=function(stream){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},origRemoveStream.apply(this,[this._streams[stream.id]||stream]),delete this._reverseStreams[this._streams[stream.id]?this._streams[stream.id].id:stream.id],delete this._streams[stream.id]},window.RTCPeerConnection.prototype.addTrack=function(track,stream){var _this13=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var streams=[].slice.call(arguments,1);if(1!==streams.length||!streams[0].getTracks().find((function(t){return t===track})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var alreadyExists=this.getSenders().find((function(s){return s.track===track}));if(alreadyExists)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var oldStream=this._streams[stream.id];if(oldStream)oldStream.addTrack(track),Promise.resolve().then((function(){_this13.dispatchEvent(new Event("negotiationneeded"))}));else{var newStream=new window.MediaStream([track]);this._streams[stream.id]=newStream,this._reverseStreams[newStream.id]=stream,this.addStream(newStream)}return this.getSenders().find((function(s){return s.track===track}))},["createOffer","createAnswer"].forEach((function(method){var nativeMethod=window.RTCPeerConnection.prototype[method],methodObj=_defineProperty({},method,(function(){var _this14=this,args=arguments,isLegacyCall=arguments.length&&"function"==typeof arguments[0];return isLegacyCall?nativeMethod.apply(this,[function(description){var desc=replaceInternalStreamId(_this14,description);args[0].apply(null,[desc])},function(err){args[1]&&args[1].apply(null,err)},arguments[2]]):nativeMethod.apply(this,arguments).then((function(description){return replaceInternalStreamId(_this14,description)}))}));window.RTCPeerConnection.prototype[method]=methodObj[method]}));var origSetLocalDescription=window.RTCPeerConnection.prototype.setLocalDescription;window.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=replaceExternalStreamId(this,arguments[0]),origSetLocalDescription.apply(this,arguments)):origSetLocalDescription.apply(this,arguments)};var origLocalDescription=Object.getOwnPropertyDescriptor(window.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(window.RTCPeerConnection.prototype,"localDescription",{get:function(){var description=origLocalDescription.get.apply(this);return""===description.type?description:replaceInternalStreamId(this,description)}}),window.RTCPeerConnection.prototype.removeTrack=function(sender){var _this15=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!sender._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(sender._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var stream=void 0;Object.keys(this._streams).forEach((function(streamid){_this15._streams[streamid].getTracks().find((function(track){return sender.track===track}))&&(stream=_this15._streams[streamid])})),stream&&(1===stream.getTracks().length?this.removeStream(this._reverseStreams[stream.id]):stream.removeTrack(sender.track),this.dispatchEvent(new Event("negotiationneeded")))}},exports.shimPeerConnection=function(window,browserDetails){!window.RTCPeerConnection&&window.webkitRTCPeerConnection&&(window.RTCPeerConnection=window.webkitRTCPeerConnection);if(!window.RTCPeerConnection)return;browserDetails.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(method){var nativeMethod=window.RTCPeerConnection.prototype[method],methodObj=_defineProperty({},method,(function(){return arguments[0]=new("addIceCandidate"===method?window.RTCIceCandidate:window.RTCSessionDescription)(arguments[0]),nativeMethod.apply(this,arguments)}));window.RTCPeerConnection.prototype[method]=methodObj[method]}))},exports.fixNegotiationNeeded=function(window,browserDetails){utils.wrapPeerConnectionEvent(window,"negotiationneeded",(function(e){var pc=e.target;if(!(browserDetails.version<72||pc.getConfiguration&&"plan-b"===pc.getConfiguration().sdpSemantics)||"stable"===pc.signalingState)return e}))};var utils=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../utils.js"));function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function shimAddTrackRemoveTrackWithNative(window){window.RTCPeerConnection.prototype.getLocalStreams=function(){var _this8=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(streamId){return _this8._shimmedLocalStreams[streamId][0]}))};var origAddTrack=window.RTCPeerConnection.prototype.addTrack;window.RTCPeerConnection.prototype.addTrack=function(track,stream){if(!stream)return origAddTrack.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var sender=origAddTrack.apply(this,arguments);return this._shimmedLocalStreams[stream.id]?-1===this._shimmedLocalStreams[stream.id].indexOf(sender)&&this._shimmedLocalStreams[stream.id].push(sender):this._shimmedLocalStreams[stream.id]=[stream,sender],sender};var origAddStream=window.RTCPeerConnection.prototype.addStream;window.RTCPeerConnection.prototype.addStream=function(stream){var _this9=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},stream.getTracks().forEach((function(track){if(_this9.getSenders().find((function(s){return s.track===track})))throw new DOMException("Track already exists.","InvalidAccessError")}));var existingSenders=this.getSenders();origAddStream.apply(this,arguments);var newSenders=this.getSenders().filter((function(newSender){return-1===existingSenders.indexOf(newSender)}));this._shimmedLocalStreams[stream.id]=[stream].concat(newSenders)};var origRemoveStream=window.RTCPeerConnection.prototype.removeStream;window.RTCPeerConnection.prototype.removeStream=function(stream){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[stream.id],origRemoveStream.apply(this,arguments)};var origRemoveTrack=window.RTCPeerConnection.prototype.removeTrack;window.RTCPeerConnection.prototype.removeTrack=function(sender){var _this10=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},sender&&Object.keys(this._shimmedLocalStreams).forEach((function(streamId){var idx=_this10._shimmedLocalStreams[streamId].indexOf(sender);-1!==idx&&_this10._shimmedLocalStreams[streamId].splice(idx,1),1===_this10._shimmedLocalStreams[streamId].length&&delete _this10._shimmedLocalStreams[streamId]})),origRemoveTrack.apply(this,arguments)}}},{"../utils.js":11,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimGetDisplayMedia=function(window,getSourceId){if(window.navigator.mediaDevices&&"getDisplayMedia"in window.navigator.mediaDevices)return;if(!window.navigator.mediaDevices)return;if("function"!=typeof getSourceId)return void console.error("shimGetDisplayMedia: getSourceId argument is not a function");window.navigator.mediaDevices.getDisplayMedia=function(constraints){return getSourceId(constraints).then((function(sourceId){var widthSpecified=constraints.video&&constraints.video.width,heightSpecified=constraints.video&&constraints.video.height,frameRateSpecified=constraints.video&&constraints.video.frameRate;return constraints.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:sourceId,maxFrameRate:frameRateSpecified||3}},widthSpecified&&(constraints.video.mandatory.maxWidth=widthSpecified),heightSpecified&&(constraints.video.mandatory.maxHeight=heightSpecified),window.navigator.mediaDevices.getUserMedia(constraints)}))}}},{}],5:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)};exports.shimGetUserMedia=function(window,browserDetails){var navigator=window&&window.navigator;if(!navigator.mediaDevices)return;var constraintsToChrome_=function(c){if("object"!==(void 0===c?"undefined":_typeof(c))||c.mandatory||c.optional)return c;var cc={};return Object.keys(c).forEach((function(key){if("require"!==key&&"advanced"!==key&&"mediaSource"!==key){var r="object"===_typeof(c[key])?c[key]:{ideal:c[key]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var oldname_=function(prefix,name){return prefix?prefix+name.charAt(0).toUpperCase()+name.slice(1):"deviceId"===name?"sourceId":name};if(void 0!==r.ideal){cc.optional=cc.optional||[];var oc={};"number"==typeof r.ideal?(oc[oldname_("min",key)]=r.ideal,cc.optional.push(oc),(oc={})[oldname_("max",key)]=r.ideal,cc.optional.push(oc)):(oc[oldname_("",key)]=r.ideal,cc.optional.push(oc))}void 0!==r.exact&&"number"!=typeof r.exact?(cc.mandatory=cc.mandatory||{},cc.mandatory[oldname_("",key)]=r.exact):["min","max"].forEach((function(mix){void 0!==r[mix]&&(cc.mandatory=cc.mandatory||{},cc.mandatory[oldname_(mix,key)]=r[mix])}))}})),c.advanced&&(cc.optional=(cc.optional||[]).concat(c.advanced)),cc},shimConstraints_=function(constraints,func){if(browserDetails.version>=61)return func(constraints);if((constraints=JSON.parse(JSON.stringify(constraints)))&&"object"===_typeof(constraints.audio)){var remap=function(obj,a,b){a in obj&&!(b in obj)&&(obj[b]=obj[a],delete obj[a])};remap((constraints=JSON.parse(JSON.stringify(constraints))).audio,"autoGainControl","googAutoGainControl"),remap(constraints.audio,"noiseSuppression","googNoiseSuppression"),constraints.audio=constraintsToChrome_(constraints.audio)}if(constraints&&"object"===_typeof(constraints.video)){var face=constraints.video.facingMode;face=face&&("object"===(void 0===face?"undefined":_typeof(face))?face:{ideal:face});var getSupportedFacingModeLies=browserDetails.version<66;if(face&&("user"===face.exact||"environment"===face.exact||"user"===face.ideal||"environment"===face.ideal)&&(!navigator.mediaDevices.getSupportedConstraints||!navigator.mediaDevices.getSupportedConstraints().facingMode||getSupportedFacingModeLies)){delete constraints.video.facingMode;var matches=void 0;if("environment"===face.exact||"environment"===face.ideal?matches=["back","rear"]:"user"!==face.exact&&"user"!==face.ideal||(matches=["front"]),matches)return navigator.mediaDevices.enumerateDevices().then((function(devices){var dev=(devices=devices.filter((function(d){return"videoinput"===d.kind}))).find((function(d){return matches.some((function(match){return d.label.toLowerCase().includes(match)}))}));return!dev&&devices.length&&matches.includes("back")&&(dev=devices[devices.length-1]),dev&&(constraints.video.deviceId=face.exact?{exact:dev.deviceId}:{ideal:dev.deviceId}),constraints.video=constraintsToChrome_(constraints.video),logging("chrome: "+JSON.stringify(constraints)),func(constraints)}))}constraints.video=constraintsToChrome_(constraints.video)}return logging("chrome: "+JSON.stringify(constraints)),func(constraints)},shimError_=function(e){return browserDetails.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(navigator.getUserMedia=function(constraints,onSuccess,onError){shimConstraints_(constraints,(function(c){navigator.webkitGetUserMedia(c,onSuccess,(function(e){onError&&onError(shimError_(e))}))}))}.bind(navigator),navigator.mediaDevices.getUserMedia){var origGetUserMedia=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(cs){return shimConstraints_(cs,(function(c){return origGetUserMedia(c).then((function(stream){if(c.audio&&!stream.getAudioTracks().length||c.video&&!stream.getVideoTracks().length)throw stream.getTracks().forEach((function(track){track.stop()})),new DOMException("","NotFoundError");return stream}),(function(e){return Promise.reject(shimError_(e))}))}))}}};var logging=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../utils.js")).log},{"../utils.js":11}],6:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)};exports.shimRTCIceCandidate=function(window){if(!window.RTCIceCandidate||window.RTCIceCandidate&&"foundation"in window.RTCIceCandidate.prototype)return;var NativeRTCIceCandidate=window.RTCIceCandidate;window.RTCIceCandidate=function(args){if("object"===(void 0===args?"undefined":_typeof(args))&&args.candidate&&0===args.candidate.indexOf("a=")&&((args=JSON.parse(JSON.stringify(args))).candidate=args.candidate.substr(2)),args.candidate&&args.candidate.length){var nativeCandidate=new NativeRTCIceCandidate(args),parsedCandidate=_sdp2.default.parseCandidate(args.candidate),augmentedCandidate=Object.assign(nativeCandidate,parsedCandidate);return augmentedCandidate.toJSON=function(){return{candidate:augmentedCandidate.candidate,sdpMid:augmentedCandidate.sdpMid,sdpMLineIndex:augmentedCandidate.sdpMLineIndex,usernameFragment:augmentedCandidate.usernameFragment}},augmentedCandidate}return new NativeRTCIceCandidate(args)},window.RTCIceCandidate.prototype=NativeRTCIceCandidate.prototype,utils.wrapPeerConnectionEvent(window,"icecandidate",(function(e){return e.candidate&&Object.defineProperty(e,"candidate",{value:new window.RTCIceCandidate(e.candidate),writable:"false"}),e}))},exports.shimMaxMessageSize=function(window,browserDetails){if(!window.RTCPeerConnection)return;"sctp"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var sctpInDescription=function(description){if(!description||!description.sdp)return!1;var sections=_sdp2.default.splitSections(description.sdp);return sections.shift(),sections.some((function(mediaSection){var mLine=_sdp2.default.parseMLine(mediaSection);return mLine&&"application"===mLine.kind&&-1!==mLine.protocol.indexOf("SCTP")}))},getRemoteFirefoxVersion=function(description){var match=description.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===match||match.length<2)return-1;var version=parseInt(match[1],10);return version!=version?-1:version},getCanSendMaxMessageSize=function(remoteIsFirefox){var canSendMaxMessageSize=65536;return"firefox"===browserDetails.browser&&(canSendMaxMessageSize=browserDetails.version<57?-1===remoteIsFirefox?16384:2147483637:browserDetails.version<60?57===browserDetails.version?65535:65536:2147483637),canSendMaxMessageSize},getMaxMessageSize=function(description,remoteIsFirefox){var maxMessageSize=65536;"firefox"===browserDetails.browser&&57===browserDetails.version&&(maxMessageSize=65535);var match=_sdp2.default.matchPrefix(description.sdp,"a=max-message-size:");return match.length>0?maxMessageSize=parseInt(match[0].substr(19),10):"firefox"===browserDetails.browser&&-1!==remoteIsFirefox&&(maxMessageSize=2147483637),maxMessageSize},origSetRemoteDescription=window.RTCPeerConnection.prototype.setRemoteDescription;window.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===browserDetails.browser&&browserDetails.version>=76){var _getConfiguration=this.getConfiguration(),sdpSemantics=_getConfiguration.sdpSemantics;"plan-b"===sdpSemantics&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(sctpInDescription(arguments[0])){var isFirefox=getRemoteFirefoxVersion(arguments[0]),canSendMMS=getCanSendMaxMessageSize(isFirefox),remoteMMS=getMaxMessageSize(arguments[0],isFirefox),maxMessageSize=void 0;maxMessageSize=0===canSendMMS&&0===remoteMMS?Number.POSITIVE_INFINITY:0===canSendMMS||0===remoteMMS?Math.max(canSendMMS,remoteMMS):Math.min(canSendMMS,remoteMMS);var sctp={};Object.defineProperty(sctp,"maxMessageSize",{get:function(){return maxMessageSize}}),this._sctp=sctp}return origSetRemoteDescription.apply(this,arguments)}},exports.shimSendThrowTypeError=function(window){if(!window.RTCPeerConnection||!("createDataChannel"in window.RTCPeerConnection.prototype))return;function wrapDcSend(dc,pc){var origDataChannelSend=dc.send;dc.send=function(){var data=arguments[0],length=data.length||data.size||data.byteLength;if("open"===dc.readyState&&pc.sctp&&length>pc.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+pc.sctp.maxMessageSize+" bytes)");return origDataChannelSend.apply(dc,arguments)}}var origCreateDataChannel=window.RTCPeerConnection.prototype.createDataChannel;window.RTCPeerConnection.prototype.createDataChannel=function(){var dataChannel=origCreateDataChannel.apply(this,arguments);return wrapDcSend(dataChannel,this),dataChannel},utils.wrapPeerConnectionEvent(window,"datachannel",(function(e){return wrapDcSend(e.channel,e.target),e}))},exports.shimConnectionState=function(window){if(!window.RTCPeerConnection||"connectionState"in window.RTCPeerConnection.prototype)return;var proto=window.RTCPeerConnection.prototype;Object.defineProperty(proto,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(proto,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(cb){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),cb&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=cb)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(method){var origMethod=proto[method];proto[method]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var pc=e.target;if(pc._lastConnectionState!==pc.connectionState){pc._lastConnectionState=pc.connectionState;var newEvent=new Event("connectionstatechange",e);pc.dispatchEvent(newEvent)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),origMethod.apply(this,arguments)}}))},exports.removeExtmapAllowMixed=function(window,browserDetails){if(!window.RTCPeerConnection)return;if("chrome"===browserDetails.browser&&browserDetails.version>=71)return;if("safari"===browserDetails.browser&&browserDetails.version>=605)return;var nativeSRD=window.RTCPeerConnection.prototype.setRemoteDescription;window.RTCPeerConnection.prototype.setRemoteDescription=function(desc){if(desc&&desc.sdp&&-1!==desc.sdp.indexOf("\na=extmap-allow-mixed")){var sdp=desc.sdp.split("\n").filter((function(line){return"a=extmap-allow-mixed"!==line.trim()})).join("\n");window.RTCSessionDescription&&desc instanceof window.RTCSessionDescription?arguments[0]=new window.RTCSessionDescription({type:desc.type,sdp:sdp}):desc.sdp=sdp}return nativeSRD.apply(this,arguments)}},exports.shimAddIceCandidateNullOrEmpty=function(window,browserDetails){if(!window.RTCPeerConnection||!window.RTCPeerConnection.prototype)return;var nativeAddIceCandidate=window.RTCPeerConnection.prototype.addIceCandidate;if(!nativeAddIceCandidate||0===nativeAddIceCandidate.length)return;window.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===browserDetails.browser&&browserDetails.version<78||"firefox"===browserDetails.browser&&browserDetails.version<68||"safari"===browserDetails.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():nativeAddIceCandidate.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}},exports.shimParameterlessSetLocalDescription=function(window,browserDetails){if(!window.RTCPeerConnection||!window.RTCPeerConnection.prototype)return;var nativeSetLocalDescription=window.RTCPeerConnection.prototype.setLocalDescription;if(!nativeSetLocalDescription||0===nativeSetLocalDescription.length)return;window.RTCPeerConnection.prototype.setLocalDescription=function(){var _this=this,desc=arguments[0]||{};if("object"!==(void 0===desc?"undefined":_typeof(desc))||desc.type&&desc.sdp)return nativeSetLocalDescription.apply(this,arguments);if(!(desc={type:desc.type,sdp:desc.sdp}).type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":desc.type="offer";break;default:desc.type="answer"}if(desc.sdp||"offer"!==desc.type&&"answer"!==desc.type)return nativeSetLocalDescription.apply(this,[desc]);var func="offer"===desc.type?this.createOffer:this.createAnswer;return func.apply(this).then((function(d){return nativeSetLocalDescription.apply(_this,[d])}))}};var obj,_sdp=require("sdp"),_sdp2=(obj=_sdp)&&obj.__esModule?obj:{default:obj},utils=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("./utils"))},{"./utils":11,sdp:12}],7:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimGetDisplayMedia=exports.shimGetUserMedia=void 0;var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_getusermedia=require("./getusermedia");Object.defineProperty(exports,"shimGetUserMedia",{enumerable:!0,get:function(){return _getusermedia.shimGetUserMedia}});var _getdisplaymedia=require("./getdisplaymedia");Object.defineProperty(exports,"shimGetDisplayMedia",{enumerable:!0,get:function(){return _getdisplaymedia.shimGetDisplayMedia}}),exports.shimOnTrack=function(window){"object"===(void 0===window?"undefined":_typeof(window))&&window.RTCTrackEvent&&"receiver"in window.RTCTrackEvent.prototype&&!("transceiver"in window.RTCTrackEvent.prototype)&&Object.defineProperty(window.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},exports.shimPeerConnection=function(window,browserDetails){if("object"!==(void 0===window?"undefined":_typeof(window))||!window.RTCPeerConnection&&!window.mozRTCPeerConnection)return;!window.RTCPeerConnection&&window.mozRTCPeerConnection&&(window.RTCPeerConnection=window.mozRTCPeerConnection);browserDetails.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(method){var nativeMethod=window.RTCPeerConnection.prototype[method],methodObj=function(obj,key,value){key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value;return obj}({},method,(function(){return arguments[0]=new("addIceCandidate"===method?window.RTCIceCandidate:window.RTCSessionDescription)(arguments[0]),nativeMethod.apply(this,arguments)}));window.RTCPeerConnection.prototype[method]=methodObj[method]}));var modernStatsTypes={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},nativeGetStats=window.RTCPeerConnection.prototype.getStats;window.RTCPeerConnection.prototype.getStats=function(){var _arguments=Array.prototype.slice.call(arguments),selector=_arguments[0],onSucc=_arguments[1],onErr=_arguments[2];return nativeGetStats.apply(this,[selector||null]).then((function(stats){if(browserDetails.version<53&&!onSucc)try{stats.forEach((function(stat){stat.type=modernStatsTypes[stat.type]||stat.type}))}catch(e){if("TypeError"!==e.name)throw e;stats.forEach((function(stat,i){stats.set(i,Object.assign({},stat,{type:modernStatsTypes[stat.type]||stat.type}))}))}return stats})).then(onSucc,onErr)}},exports.shimSenderGetStats=function(window){if("object"!==(void 0===window?"undefined":_typeof(window))||!window.RTCPeerConnection||!window.RTCRtpSender)return;if(window.RTCRtpSender&&"getStats"in window.RTCRtpSender.prototype)return;var origGetSenders=window.RTCPeerConnection.prototype.getSenders;origGetSenders&&(window.RTCPeerConnection.prototype.getSenders=function(){var _this=this,senders=origGetSenders.apply(this,[]);return senders.forEach((function(sender){return sender._pc=_this})),senders});var origAddTrack=window.RTCPeerConnection.prototype.addTrack;origAddTrack&&(window.RTCPeerConnection.prototype.addTrack=function(){var sender=origAddTrack.apply(this,arguments);return sender._pc=this,sender});window.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}},exports.shimReceiverGetStats=function(window){if("object"!==(void 0===window?"undefined":_typeof(window))||!window.RTCPeerConnection||!window.RTCRtpSender)return;if(window.RTCRtpSender&&"getStats"in window.RTCRtpReceiver.prototype)return;var origGetReceivers=window.RTCPeerConnection.prototype.getReceivers;origGetReceivers&&(window.RTCPeerConnection.prototype.getReceivers=function(){var _this2=this,receivers=origGetReceivers.apply(this,[]);return receivers.forEach((function(receiver){return receiver._pc=_this2})),receivers});utils.wrapPeerConnectionEvent(window,"track",(function(e){return e.receiver._pc=e.srcElement,e})),window.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}},exports.shimRemoveStream=function(window){if(!window.RTCPeerConnection||"removeStream"in window.RTCPeerConnection.prototype)return;window.RTCPeerConnection.prototype.removeStream=function(stream){var _this3=this;utils.deprecated("removeStream","removeTrack"),this.getSenders().forEach((function(sender){sender.track&&stream.getTracks().includes(sender.track)&&_this3.removeTrack(sender)}))}},exports.shimRTCDataChannel=function(window){window.DataChannel&&!window.RTCDataChannel&&(window.RTCDataChannel=window.DataChannel)},exports.shimAddTransceiver=function(window){if("object"!==(void 0===window?"undefined":_typeof(window))||!window.RTCPeerConnection)return;var origAddTransceiver=window.RTCPeerConnection.prototype.addTransceiver;origAddTransceiver&&(window.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var initParameters=arguments[1],shouldPerformCheck=initParameters&&"sendEncodings"in initParameters;shouldPerformCheck&&initParameters.sendEncodings.forEach((function(encodingParam){if("rid"in encodingParam){if(!/^[a-z0-9]{0,16}$/i.test(encodingParam.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in encodingParam&&!(parseFloat(encodingParam.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in encodingParam&&!(parseFloat(encodingParam.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));var transceiver=origAddTransceiver.apply(this,arguments);if(shouldPerformCheck){var sender=transceiver.sender,params=sender.getParameters();(!("encodings"in params)||1===params.encodings.length&&0===Object.keys(params.encodings[0]).length)&&(params.encodings=initParameters.sendEncodings,sender.sendEncodings=initParameters.sendEncodings,this.setParametersPromises.push(sender.setParameters(params).then((function(){delete sender.sendEncodings})).catch((function(){delete sender.sendEncodings}))))}return transceiver})},exports.shimGetParameters=function(window){if("object"!==(void 0===window?"undefined":_typeof(window))||!window.RTCRtpSender)return;var origGetParameters=window.RTCRtpSender.prototype.getParameters;origGetParameters&&(window.RTCRtpSender.prototype.getParameters=function(){var params=origGetParameters.apply(this,arguments);return"encodings"in params||(params.encodings=[].concat(this.sendEncodings||[{}])),params})},exports.shimCreateOffer=function(window){if("object"!==(void 0===window?"undefined":_typeof(window))||!window.RTCPeerConnection)return;var origCreateOffer=window.RTCPeerConnection.prototype.createOffer;window.RTCPeerConnection.prototype.createOffer=function(){var _this4=this,_arguments2=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return origCreateOffer.apply(_this4,_arguments2)})).finally((function(){_this4.setParametersPromises=[]})):origCreateOffer.apply(this,arguments)}},exports.shimCreateAnswer=function(window){if("object"!==(void 0===window?"undefined":_typeof(window))||!window.RTCPeerConnection)return;var origCreateAnswer=window.RTCPeerConnection.prototype.createAnswer;window.RTCPeerConnection.prototype.createAnswer=function(){var _this5=this,_arguments3=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return origCreateAnswer.apply(_this5,_arguments3)})).finally((function(){_this5.setParametersPromises=[]})):origCreateAnswer.apply(this,arguments)}};var utils=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../utils"))},{"../utils":11,"./getdisplaymedia":8,"./getusermedia":9}],8:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimGetDisplayMedia=function(window,preferredMediaSource){if(window.navigator.mediaDevices&&"getDisplayMedia"in window.navigator.mediaDevices)return;if(!window.navigator.mediaDevices)return;window.navigator.mediaDevices.getDisplayMedia=function(constraints){if(!constraints||!constraints.video){var err=new DOMException("getDisplayMedia without video constraints is undefined");return err.name="NotFoundError",err.code=8,Promise.reject(err)}return!0===constraints.video?constraints.video={mediaSource:preferredMediaSource}:constraints.video.mediaSource=preferredMediaSource,window.navigator.mediaDevices.getUserMedia(constraints)}}},{}],9:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)};exports.shimGetUserMedia=function(window,browserDetails){var navigator=window&&window.navigator,MediaStreamTrack=window&&window.MediaStreamTrack;if(navigator.getUserMedia=function(constraints,onSuccess,onError){utils.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),navigator.mediaDevices.getUserMedia(constraints).then(onSuccess,onError)},!(browserDetails.version>55&&"autoGainControl"in navigator.mediaDevices.getSupportedConstraints())){var remap=function(obj,a,b){a in obj&&!(b in obj)&&(obj[b]=obj[a],delete obj[a])},nativeGetUserMedia=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);if(navigator.mediaDevices.getUserMedia=function(c){return"object"===(void 0===c?"undefined":_typeof(c))&&"object"===_typeof(c.audio)&&(c=JSON.parse(JSON.stringify(c)),remap(c.audio,"autoGainControl","mozAutoGainControl"),remap(c.audio,"noiseSuppression","mozNoiseSuppression")),nativeGetUserMedia(c)},MediaStreamTrack&&MediaStreamTrack.prototype.getSettings){var nativeGetSettings=MediaStreamTrack.prototype.getSettings;MediaStreamTrack.prototype.getSettings=function(){var obj=nativeGetSettings.apply(this,arguments);return remap(obj,"mozAutoGainControl","autoGainControl"),remap(obj,"mozNoiseSuppression","noiseSuppression"),obj}}if(MediaStreamTrack&&MediaStreamTrack.prototype.applyConstraints){var nativeApplyConstraints=MediaStreamTrack.prototype.applyConstraints;MediaStreamTrack.prototype.applyConstraints=function(c){return"audio"===this.kind&&"object"===(void 0===c?"undefined":_typeof(c))&&(c=JSON.parse(JSON.stringify(c)),remap(c,"autoGainControl","mozAutoGainControl"),remap(c,"noiseSuppression","mozNoiseSuppression")),nativeApplyConstraints.apply(this,[c])}}}};var utils=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../utils"))},{"../utils":11}],10:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)};exports.shimLocalStreamsAPI=function(window){if("object"!==(void 0===window?"undefined":_typeof(window))||!window.RTCPeerConnection)return;"getLocalStreams"in window.RTCPeerConnection.prototype||(window.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams});if(!("addStream"in window.RTCPeerConnection.prototype)){var _addTrack=window.RTCPeerConnection.prototype.addTrack;window.RTCPeerConnection.prototype.addStream=function(stream){var _this=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(stream)||this._localStreams.push(stream),stream.getAudioTracks().forEach((function(track){return _addTrack.call(_this,track,stream)})),stream.getVideoTracks().forEach((function(track){return _addTrack.call(_this,track,stream)}))},window.RTCPeerConnection.prototype.addTrack=function(track){for(var _this2=this,_len=arguments.length,streams=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)streams[_key-1]=arguments[_key];return streams&&streams.forEach((function(stream){_this2._localStreams?_this2._localStreams.includes(stream)||_this2._localStreams.push(stream):_this2._localStreams=[stream]})),_addTrack.apply(this,arguments)}}"removeStream"in window.RTCPeerConnection.prototype||(window.RTCPeerConnection.prototype.removeStream=function(stream){var _this3=this;this._localStreams||(this._localStreams=[]);var index=this._localStreams.indexOf(stream);if(-1!==index){this._localStreams.splice(index,1);var tracks=stream.getTracks();this.getSenders().forEach((function(sender){tracks.includes(sender.track)&&_this3.removeTrack(sender)}))}})},exports.shimRemoteStreamsAPI=function(window){if("object"!==(void 0===window?"undefined":_typeof(window))||!window.RTCPeerConnection)return;"getRemoteStreams"in window.RTCPeerConnection.prototype||(window.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]});if(!("onaddstream"in window.RTCPeerConnection.prototype)){Object.defineProperty(window.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(f){var _this4=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=f),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(stream){if(_this4._remoteStreams||(_this4._remoteStreams=[]),!_this4._remoteStreams.includes(stream)){_this4._remoteStreams.push(stream);var event=new Event("addstream");event.stream=stream,_this4.dispatchEvent(event)}}))})}});var origSetRemoteDescription=window.RTCPeerConnection.prototype.setRemoteDescription;window.RTCPeerConnection.prototype.setRemoteDescription=function(){var pc=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(stream){if(pc._remoteStreams||(pc._remoteStreams=[]),!(pc._remoteStreams.indexOf(stream)>=0)){pc._remoteStreams.push(stream);var event=new Event("addstream");event.stream=stream,pc.dispatchEvent(event)}}))}),origSetRemoteDescription.apply(pc,arguments)}}},exports.shimCallbacksAPI=function(window){if("object"!==(void 0===window?"undefined":_typeof(window))||!window.RTCPeerConnection)return;var prototype=window.RTCPeerConnection.prototype,origCreateOffer=prototype.createOffer,origCreateAnswer=prototype.createAnswer,setLocalDescription=prototype.setLocalDescription,setRemoteDescription=prototype.setRemoteDescription,addIceCandidate=prototype.addIceCandidate;prototype.createOffer=function(successCallback,failureCallback){var options=arguments.length>=2?arguments[2]:arguments[0],promise=origCreateOffer.apply(this,[options]);return failureCallback?(promise.then(successCallback,failureCallback),Promise.resolve()):promise},prototype.createAnswer=function(successCallback,failureCallback){var options=arguments.length>=2?arguments[2]:arguments[0],promise=origCreateAnswer.apply(this,[options]);return failureCallback?(promise.then(successCallback,failureCallback),Promise.resolve()):promise};var withCallback=function(description,successCallback,failureCallback){var promise=setLocalDescription.apply(this,[description]);return failureCallback?(promise.then(successCallback,failureCallback),Promise.resolve()):promise};prototype.setLocalDescription=withCallback,withCallback=function(description,successCallback,failureCallback){var promise=setRemoteDescription.apply(this,[description]);return failureCallback?(promise.then(successCallback,failureCallback),Promise.resolve()):promise},prototype.setRemoteDescription=withCallback,withCallback=function(candidate,successCallback,failureCallback){var promise=addIceCandidate.apply(this,[candidate]);return failureCallback?(promise.then(successCallback,failureCallback),Promise.resolve()):promise},prototype.addIceCandidate=withCallback},exports.shimGetUserMedia=function(window){var navigator=window&&window.navigator;if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){var mediaDevices=navigator.mediaDevices,_getUserMedia=mediaDevices.getUserMedia.bind(mediaDevices);navigator.mediaDevices.getUserMedia=function(constraints){return _getUserMedia(shimConstraints(constraints))}}!navigator.getUserMedia&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&(navigator.getUserMedia=function(constraints,cb,errcb){navigator.mediaDevices.getUserMedia(constraints).then(cb,errcb)}.bind(navigator))},exports.shimConstraints=shimConstraints,exports.shimRTCIceServerUrls=function(window){if(!window.RTCPeerConnection)return;var OrigPeerConnection=window.RTCPeerConnection;window.RTCPeerConnection=function(pcConfig,pcConstraints){if(pcConfig&&pcConfig.iceServers){for(var newIceServers=[],i=0;i<pcConfig.iceServers.length;i++){var server=pcConfig.iceServers[i];!server.hasOwnProperty("urls")&&server.hasOwnProperty("url")?(utils.deprecated("RTCIceServer.url","RTCIceServer.urls"),(server=JSON.parse(JSON.stringify(server))).urls=server.url,delete server.url,newIceServers.push(server)):newIceServers.push(pcConfig.iceServers[i])}pcConfig.iceServers=newIceServers}return new OrigPeerConnection(pcConfig,pcConstraints)},window.RTCPeerConnection.prototype=OrigPeerConnection.prototype,"generateCertificate"in OrigPeerConnection&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return OrigPeerConnection.generateCertificate}})},exports.shimTrackEventTransceiver=function(window){"object"===(void 0===window?"undefined":_typeof(window))&&window.RTCTrackEvent&&"receiver"in window.RTCTrackEvent.prototype&&!("transceiver"in window.RTCTrackEvent.prototype)&&Object.defineProperty(window.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},exports.shimCreateOfferLegacy=function(window){var origCreateOffer=window.RTCPeerConnection.prototype.createOffer;window.RTCPeerConnection.prototype.createOffer=function(offerOptions){if(offerOptions){void 0!==offerOptions.offerToReceiveAudio&&(offerOptions.offerToReceiveAudio=!!offerOptions.offerToReceiveAudio);var audioTransceiver=this.getTransceivers().find((function(transceiver){return"audio"===transceiver.receiver.track.kind}));!1===offerOptions.offerToReceiveAudio&&audioTransceiver?"sendrecv"===audioTransceiver.direction?audioTransceiver.setDirection?audioTransceiver.setDirection("sendonly"):audioTransceiver.direction="sendonly":"recvonly"===audioTransceiver.direction&&(audioTransceiver.setDirection?audioTransceiver.setDirection("inactive"):audioTransceiver.direction="inactive"):!0!==offerOptions.offerToReceiveAudio||audioTransceiver||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==offerOptions.offerToReceiveVideo&&(offerOptions.offerToReceiveVideo=!!offerOptions.offerToReceiveVideo);var videoTransceiver=this.getTransceivers().find((function(transceiver){return"video"===transceiver.receiver.track.kind}));!1===offerOptions.offerToReceiveVideo&&videoTransceiver?"sendrecv"===videoTransceiver.direction?videoTransceiver.setDirection?videoTransceiver.setDirection("sendonly"):videoTransceiver.direction="sendonly":"recvonly"===videoTransceiver.direction&&(videoTransceiver.setDirection?videoTransceiver.setDirection("inactive"):videoTransceiver.direction="inactive"):!0!==offerOptions.offerToReceiveVideo||videoTransceiver||this.addTransceiver("video",{direction:"recvonly"})}return origCreateOffer.apply(this,arguments)}},exports.shimAudioContext=function(window){if("object"!==(void 0===window?"undefined":_typeof(window))||window.AudioContext)return;window.AudioContext=window.webkitAudioContext};var utils=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../utils"));function shimConstraints(constraints){return constraints&&void 0!==constraints.video?Object.assign({},constraints,{video:utils.compactObject(constraints.video)}):constraints}},{"../utils":11}],11:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)};exports.extractVersion=extractVersion,exports.wrapPeerConnectionEvent=function(window,eventNameToWrap,wrapper){if(!window.RTCPeerConnection)return;var proto=window.RTCPeerConnection.prototype,nativeAddEventListener=proto.addEventListener;proto.addEventListener=function(nativeEventName,cb){if(nativeEventName!==eventNameToWrap)return nativeAddEventListener.apply(this,arguments);var wrappedCallback=function(e){var modifiedEvent=wrapper(e);modifiedEvent&&(cb.handleEvent?cb.handleEvent(modifiedEvent):cb(modifiedEvent))};return this._eventMap=this._eventMap||{},this._eventMap[eventNameToWrap]||(this._eventMap[eventNameToWrap]=new Map),this._eventMap[eventNameToWrap].set(cb,wrappedCallback),nativeAddEventListener.apply(this,[nativeEventName,wrappedCallback])};var nativeRemoveEventListener=proto.removeEventListener;proto.removeEventListener=function(nativeEventName,cb){if(nativeEventName!==eventNameToWrap||!this._eventMap||!this._eventMap[eventNameToWrap])return nativeRemoveEventListener.apply(this,arguments);if(!this._eventMap[eventNameToWrap].has(cb))return nativeRemoveEventListener.apply(this,arguments);var unwrappedCb=this._eventMap[eventNameToWrap].get(cb);return this._eventMap[eventNameToWrap].delete(cb),0===this._eventMap[eventNameToWrap].size&&delete this._eventMap[eventNameToWrap],0===Object.keys(this._eventMap).length&&delete this._eventMap,nativeRemoveEventListener.apply(this,[nativeEventName,unwrappedCb])},Object.defineProperty(proto,"on"+eventNameToWrap,{get:function(){return this["_on"+eventNameToWrap]},set:function(cb){this["_on"+eventNameToWrap]&&(this.removeEventListener(eventNameToWrap,this["_on"+eventNameToWrap]),delete this["_on"+eventNameToWrap]),cb&&this.addEventListener(eventNameToWrap,this["_on"+eventNameToWrap]=cb)},enumerable:!0,configurable:!0})},exports.disableLog=function(bool){if("boolean"!=typeof bool)return new Error("Argument type: "+(void 0===bool?"undefined":_typeof(bool))+". Please use a boolean.");return logDisabled_=bool,bool?"adapter.js logging disabled":"adapter.js logging enabled"},exports.disableWarnings=function(bool){if("boolean"!=typeof bool)return new Error("Argument type: "+(void 0===bool?"undefined":_typeof(bool))+". Please use a boolean.");return deprecationWarnings_=!bool,"adapter.js deprecation warnings "+(bool?"disabled":"enabled")},exports.log=function(){if("object"===("undefined"==typeof window?"undefined":_typeof(window))){if(logDisabled_)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},exports.deprecated=function(oldMethod,newMethod){if(!deprecationWarnings_)return;console.warn(oldMethod+" is deprecated, please use "+newMethod+" instead.")},exports.detectBrowser=function(window){var result={browser:null,version:null};if(void 0===window||!window.navigator)return result.browser="Not a browser.",result;var navigator=window.navigator;if(navigator.mozGetUserMedia)result.browser="firefox",result.version=extractVersion(navigator.userAgent,/Firefox\/(\d+)\./,1);else if(navigator.webkitGetUserMedia||!1===window.isSecureContext&&window.webkitRTCPeerConnection&&!window.RTCIceGatherer)result.browser="chrome",result.version=extractVersion(navigator.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!window.RTCPeerConnection||!navigator.userAgent.match(/AppleWebKit\/(\d+)\./))return result.browser="Not a supported browser.",result;result.browser="safari",result.version=extractVersion(navigator.userAgent,/AppleWebKit\/(\d+)\./,1),result.supportsUnifiedPlan=window.RTCRtpTransceiver&&"currentDirection"in window.RTCRtpTransceiver.prototype}return result},exports.compactObject=function compactObject(data){if(!isObject(data))return data;return Object.keys(data).reduce((function(accumulator,key){var isObj=isObject(data[key]),value=isObj?compactObject(data[key]):data[key],isEmptyObject=isObj&&!Object.keys(value).length;return void 0===value||isEmptyObject?accumulator:Object.assign(accumulator,function(obj,key,value){key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value;return obj}({},key,value))}),{})},exports.walkStats=walkStats,exports.filterStats=function(result,track,outbound){var streamStatsType=outbound?"outbound-rtp":"inbound-rtp",filteredResult=new Map;if(null===track)return filteredResult;var trackStats=[];return result.forEach((function(value){"track"===value.type&&value.trackIdentifier===track.id&&trackStats.push(value)})),trackStats.forEach((function(trackStat){result.forEach((function(stats){stats.type===streamStatsType&&stats.trackId===trackStat.id&&walkStats(result,stats,filteredResult)}))})),filteredResult};var logDisabled_=!0,deprecationWarnings_=!0;function extractVersion(uastring,expr,pos){var match=uastring.match(expr);return match&&match.length>=pos&&parseInt(match[pos],10)}function isObject(val){return"[object Object]"===Object.prototype.toString.call(val)}function walkStats(stats,base,resultSet){base&&!resultSet.has(base.id)&&(resultSet.set(base.id,base),Object.keys(base).forEach((function(name){name.endsWith("Id")?walkStats(stats,stats.get(base[name]),resultSet):name.endsWith("Ids")&&base[name].forEach((function(id){walkStats(stats,stats.get(id),resultSet)}))})))}},{}],12:[function(require,module,exports){var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},SDPUtils={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};SDPUtils.localCName=SDPUtils.generateIdentifier(),SDPUtils.splitLines=function(blob){return blob.trim().split("\n").map((function(line){return line.trim()}))},SDPUtils.splitSections=function(blob){return blob.split("\nm=").map((function(part,index){return(index>0?"m="+part:part).trim()+"\r\n"}))},SDPUtils.getDescription=function(blob){var sections=SDPUtils.splitSections(blob);return sections&&sections[0]},SDPUtils.getMediaSections=function(blob){var sections=SDPUtils.splitSections(blob);return sections.shift(),sections},SDPUtils.matchPrefix=function(blob,prefix){return SDPUtils.splitLines(blob).filter((function(line){return 0===line.indexOf(prefix)}))},SDPUtils.parseCandidate=function(line){for(var parts=void 0,candidate={foundation:(parts=0===line.indexOf("a=candidate:")?line.substring(12).split(" "):line.substring(10).split(" "))[0],component:{1:"rtp",2:"rtcp"}[parts[1]]||parts[1],protocol:parts[2].toLowerCase(),priority:parseInt(parts[3],10),ip:parts[4],address:parts[4],port:parseInt(parts[5],10),type:parts[7]},i=8;i<parts.length;i+=2)switch(parts[i]){case"raddr":candidate.relatedAddress=parts[i+1];break;case"rport":candidate.relatedPort=parseInt(parts[i+1],10);break;case"tcptype":candidate.tcpType=parts[i+1];break;case"ufrag":candidate.ufrag=parts[i+1],candidate.usernameFragment=parts[i+1];break;default:void 0===candidate[parts[i]]&&(candidate[parts[i]]=parts[i+1])}return candidate},SDPUtils.writeCandidate=function(candidate){var sdp=[];sdp.push(candidate.foundation);var component=candidate.component;"rtp"===component?sdp.push(1):"rtcp"===component?sdp.push(2):sdp.push(component),sdp.push(candidate.protocol.toUpperCase()),sdp.push(candidate.priority),sdp.push(candidate.address||candidate.ip),sdp.push(candidate.port);var type=candidate.type;return sdp.push("typ"),sdp.push(type),"host"!==type&&candidate.relatedAddress&&candidate.relatedPort&&(sdp.push("raddr"),sdp.push(candidate.relatedAddress),sdp.push("rport"),sdp.push(candidate.relatedPort)),candidate.tcpType&&"tcp"===candidate.protocol.toLowerCase()&&(sdp.push("tcptype"),sdp.push(candidate.tcpType)),(candidate.usernameFragment||candidate.ufrag)&&(sdp.push("ufrag"),sdp.push(candidate.usernameFragment||candidate.ufrag)),"candidate:"+sdp.join(" ")},SDPUtils.parseIceOptions=function(line){return line.substr(14).split(" ")},SDPUtils.parseRtpMap=function(line){var parts=line.substr(9).split(" "),parsed={payloadType:parseInt(parts.shift(),10)};return parts=parts[0].split("/"),parsed.name=parts[0],parsed.clockRate=parseInt(parts[1],10),parsed.channels=3===parts.length?parseInt(parts[2],10):1,parsed.numChannels=parsed.channels,parsed},SDPUtils.writeRtpMap=function(codec){var pt=codec.payloadType;void 0!==codec.preferredPayloadType&&(pt=codec.preferredPayloadType);var channels=codec.channels||codec.numChannels||1;return"a=rtpmap:"+pt+" "+codec.name+"/"+codec.clockRate+(1!==channels?"/"+channels:"")+"\r\n"},SDPUtils.parseExtmap=function(line){var parts=line.substr(9).split(" ");return{id:parseInt(parts[0],10),direction:parts[0].indexOf("/")>0?parts[0].split("/")[1]:"sendrecv",uri:parts[1]}},SDPUtils.writeExtmap=function(headerExtension){return"a=extmap:"+(headerExtension.id||headerExtension.preferredId)+(headerExtension.direction&&"sendrecv"!==headerExtension.direction?"/"+headerExtension.direction:"")+" "+headerExtension.uri+"\r\n"},SDPUtils.parseFmtp=function(line){for(var parsed={},kv=void 0,parts=line.substr(line.indexOf(" ")+1).split(";"),j=0;j<parts.length;j++)parsed[(kv=parts[j].trim().split("="))[0].trim()]=kv[1];return parsed},SDPUtils.writeFmtp=function(codec){var line="",pt=codec.payloadType;if(void 0!==codec.preferredPayloadType&&(pt=codec.preferredPayloadType),codec.parameters&&Object.keys(codec.parameters).length){var params=[];Object.keys(codec.parameters).forEach((function(param){void 0!==codec.parameters[param]?params.push(param+"="+codec.parameters[param]):params.push(param)})),line+="a=fmtp:"+pt+" "+params.join(";")+"\r\n"}return line},SDPUtils.parseRtcpFb=function(line){var parts=line.substr(line.indexOf(" ")+1).split(" ");return{type:parts.shift(),parameter:parts.join(" ")}},SDPUtils.writeRtcpFb=function(codec){var lines="",pt=codec.payloadType;return void 0!==codec.preferredPayloadType&&(pt=codec.preferredPayloadType),codec.rtcpFeedback&&codec.rtcpFeedback.length&&codec.rtcpFeedback.forEach((function(fb){lines+="a=rtcp-fb:"+pt+" "+fb.type+(fb.parameter&&fb.parameter.length?" "+fb.parameter:"")+"\r\n"})),lines},SDPUtils.parseSsrcMedia=function(line){var sp=line.indexOf(" "),parts={ssrc:parseInt(line.substr(7,sp-7),10)},colon=line.indexOf(":",sp);return colon>-1?(parts.attribute=line.substr(sp+1,colon-sp-1),parts.value=line.substr(colon+1)):parts.attribute=line.substr(sp+1),parts},SDPUtils.parseSsrcGroup=function(line){var parts=line.substr(13).split(" ");return{semantics:parts.shift(),ssrcs:parts.map((function(ssrc){return parseInt(ssrc,10)}))}},SDPUtils.getMid=function(mediaSection){var mid=SDPUtils.matchPrefix(mediaSection,"a=mid:")[0];if(mid)return mid.substr(6)},SDPUtils.parseFingerprint=function(line){var parts=line.substr(14).split(" ");return{algorithm:parts[0].toLowerCase(),value:parts[1].toUpperCase()}},SDPUtils.getDtlsParameters=function(mediaSection,sessionpart){return{role:"auto",fingerprints:SDPUtils.matchPrefix(mediaSection+sessionpart,"a=fingerprint:").map(SDPUtils.parseFingerprint)}},SDPUtils.writeDtlsParameters=function(params,setupType){var sdp="a=setup:"+setupType+"\r\n";return params.fingerprints.forEach((function(fp){sdp+="a=fingerprint:"+fp.algorithm+" "+fp.value+"\r\n"})),sdp},SDPUtils.parseCryptoLine=function(line){var parts=line.substr(9).split(" ");return{tag:parseInt(parts[0],10),cryptoSuite:parts[1],keyParams:parts[2],sessionParams:parts.slice(3)}},SDPUtils.writeCryptoLine=function(parameters){return"a=crypto:"+parameters.tag+" "+parameters.cryptoSuite+" "+("object"===_typeof(parameters.keyParams)?SDPUtils.writeCryptoKeyParams(parameters.keyParams):parameters.keyParams)+(parameters.sessionParams?" "+parameters.sessionParams.join(" "):"")+"\r\n"},SDPUtils.parseCryptoKeyParams=function(keyParams){if(0!==keyParams.indexOf("inline:"))return null;var parts=keyParams.substr(7).split("|");return{keyMethod:"inline",keySalt:parts[0],lifeTime:parts[1],mkiValue:parts[2]?parts[2].split(":")[0]:void 0,mkiLength:parts[2]?parts[2].split(":")[1]:void 0}},SDPUtils.writeCryptoKeyParams=function(keyParams){return keyParams.keyMethod+":"+keyParams.keySalt+(keyParams.lifeTime?"|"+keyParams.lifeTime:"")+(keyParams.mkiValue&&keyParams.mkiLength?"|"+keyParams.mkiValue+":"+keyParams.mkiLength:"")},SDPUtils.getCryptoParameters=function(mediaSection,sessionpart){return SDPUtils.matchPrefix(mediaSection+sessionpart,"a=crypto:").map(SDPUtils.parseCryptoLine)},SDPUtils.getIceParameters=function(mediaSection,sessionpart){var ufrag=SDPUtils.matchPrefix(mediaSection+sessionpart,"a=ice-ufrag:")[0],pwd=SDPUtils.matchPrefix(mediaSection+sessionpart,"a=ice-pwd:")[0];return ufrag&&pwd?{usernameFragment:ufrag.substr(12),password:pwd.substr(10)}:null},SDPUtils.writeIceParameters=function(params){var sdp="a=ice-ufrag:"+params.usernameFragment+"\r\na=ice-pwd:"+params.password+"\r\n";return params.iceLite&&(sdp+="a=ice-lite\r\n"),sdp},SDPUtils.parseRtpParameters=function(mediaSection){for(var description={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},mline=SDPUtils.splitLines(mediaSection)[0].split(" "),i=3;i<mline.length;i++){var pt=mline[i],rtpmapline=SDPUtils.matchPrefix(mediaSection,"a=rtpmap:"+pt+" ")[0];if(rtpmapline){var codec=SDPUtils.parseRtpMap(rtpmapline),fmtps=SDPUtils.matchPrefix(mediaSection,"a=fmtp:"+pt+" ");switch(codec.parameters=fmtps.length?SDPUtils.parseFmtp(fmtps[0]):{},codec.rtcpFeedback=SDPUtils.matchPrefix(mediaSection,"a=rtcp-fb:"+pt+" ").map(SDPUtils.parseRtcpFb),description.codecs.push(codec),codec.name.toUpperCase()){case"RED":case"ULPFEC":description.fecMechanisms.push(codec.name.toUpperCase())}}}return SDPUtils.matchPrefix(mediaSection,"a=extmap:").forEach((function(line){description.headerExtensions.push(SDPUtils.parseExtmap(line))})),description},SDPUtils.writeRtpDescription=function(kind,caps){var sdp="";sdp+="m="+kind+" ",sdp+=caps.codecs.length>0?"9":"0",sdp+=" UDP/TLS/RTP/SAVPF ",sdp+=caps.codecs.map((function(codec){return void 0!==codec.preferredPayloadType?codec.preferredPayloadType:codec.payloadType})).join(" ")+"\r\n",sdp+="c=IN IP4 0.0.0.0\r\n",sdp+="a=rtcp:9 IN IP4 0.0.0.0\r\n",caps.codecs.forEach((function(codec){sdp+=SDPUtils.writeRtpMap(codec),sdp+=SDPUtils.writeFmtp(codec),sdp+=SDPUtils.writeRtcpFb(codec)}));var maxptime=0;return caps.codecs.forEach((function(codec){codec.maxptime>maxptime&&(maxptime=codec.maxptime)})),maxptime>0&&(sdp+="a=maxptime:"+maxptime+"\r\n"),caps.headerExtensions&&caps.headerExtensions.forEach((function(extension){sdp+=SDPUtils.writeExtmap(extension)})),sdp},SDPUtils.parseRtpEncodingParameters=function(mediaSection){var encodingParameters=[],description=SDPUtils.parseRtpParameters(mediaSection),hasRed=-1!==description.fecMechanisms.indexOf("RED"),hasUlpfec=-1!==description.fecMechanisms.indexOf("ULPFEC"),ssrcs=SDPUtils.matchPrefix(mediaSection,"a=ssrc:").map((function(line){return SDPUtils.parseSsrcMedia(line)})).filter((function(parts){return"cname"===parts.attribute})),primarySsrc=ssrcs.length>0&&ssrcs[0].ssrc,secondarySsrc=void 0,flows=SDPUtils.matchPrefix(mediaSection,"a=ssrc-group:FID").map((function(line){return line.substr(17).split(" ").map((function(part){return parseInt(part,10)}))}));flows.length>0&&flows[0].length>1&&flows[0][0]===primarySsrc&&(secondarySsrc=flows[0][1]),description.codecs.forEach((function(codec){if("RTX"===codec.name.toUpperCase()&&codec.parameters.apt){var encParam={ssrc:primarySsrc,codecPayloadType:parseInt(codec.parameters.apt,10)};primarySsrc&&secondarySsrc&&(encParam.rtx={ssrc:secondarySsrc}),encodingParameters.push(encParam),hasRed&&((encParam=JSON.parse(JSON.stringify(encParam))).fec={ssrc:primarySsrc,mechanism:hasUlpfec?"red+ulpfec":"red"},encodingParameters.push(encParam))}})),0===encodingParameters.length&&primarySsrc&&encodingParameters.push({ssrc:primarySsrc});var bandwidth=SDPUtils.matchPrefix(mediaSection,"b=");return bandwidth.length&&(bandwidth=0===bandwidth[0].indexOf("b=TIAS:")?parseInt(bandwidth[0].substr(7),10):0===bandwidth[0].indexOf("b=AS:")?1e3*parseInt(bandwidth[0].substr(5),10)*.95-16e3:void 0,encodingParameters.forEach((function(params){params.maxBitrate=bandwidth}))),encodingParameters},SDPUtils.parseRtcpParameters=function(mediaSection){var rtcpParameters={},remoteSsrc=SDPUtils.matchPrefix(mediaSection,"a=ssrc:").map((function(line){return SDPUtils.parseSsrcMedia(line)})).filter((function(obj){return"cname"===obj.attribute}))[0];remoteSsrc&&(rtcpParameters.cname=remoteSsrc.value,rtcpParameters.ssrc=remoteSsrc.ssrc);var rsize=SDPUtils.matchPrefix(mediaSection,"a=rtcp-rsize");rtcpParameters.reducedSize=rsize.length>0,rtcpParameters.compound=0===rsize.length;var mux=SDPUtils.matchPrefix(mediaSection,"a=rtcp-mux");return rtcpParameters.mux=mux.length>0,rtcpParameters},SDPUtils.writeRtcpParameters=function(rtcpParameters){var sdp="";return rtcpParameters.reducedSize&&(sdp+="a=rtcp-rsize\r\n"),rtcpParameters.mux&&(sdp+="a=rtcp-mux\r\n"),void 0!==rtcpParameters.ssrc&&rtcpParameters.cname&&(sdp+="a=ssrc:"+rtcpParameters.ssrc+" cname:"+rtcpParameters.cname+"\r\n"),sdp},SDPUtils.parseMsid=function(mediaSection){var parts=void 0,spec=SDPUtils.matchPrefix(mediaSection,"a=msid:");if(1===spec.length)return{stream:(parts=spec[0].substr(7).split(" "))[0],track:parts[1]};var planB=SDPUtils.matchPrefix(mediaSection,"a=ssrc:").map((function(line){return SDPUtils.parseSsrcMedia(line)})).filter((function(msidParts){return"msid"===msidParts.attribute}));return planB.length>0?{stream:(parts=planB[0].value.split(" "))[0],track:parts[1]}:void 0},SDPUtils.parseSctpDescription=function(mediaSection){var mline=SDPUtils.parseMLine(mediaSection),maxSizeLine=SDPUtils.matchPrefix(mediaSection,"a=max-message-size:"),maxMessageSize=void 0;maxSizeLine.length>0&&(maxMessageSize=parseInt(maxSizeLine[0].substr(19),10)),isNaN(maxMessageSize)&&(maxMessageSize=65536);var sctpPort=SDPUtils.matchPrefix(mediaSection,"a=sctp-port:");if(sctpPort.length>0)return{port:parseInt(sctpPort[0].substr(12),10),protocol:mline.fmt,maxMessageSize:maxMessageSize};var sctpMapLines=SDPUtils.matchPrefix(mediaSection,"a=sctpmap:");if(sctpMapLines.length>0){var parts=sctpMapLines[0].substr(10).split(" ");return{port:parseInt(parts[0],10),protocol:parts[1],maxMessageSize:maxMessageSize}}},SDPUtils.writeSctpDescription=function(media,sctp){var output=[];return output="DTLS/SCTP"!==media.protocol?["m="+media.kind+" 9 "+media.protocol+" "+sctp.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+sctp.port+"\r\n"]:["m="+media.kind+" 9 "+media.protocol+" "+sctp.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+sctp.port+" "+sctp.protocol+" 65535\r\n"],void 0!==sctp.maxMessageSize&&output.push("a=max-message-size:"+sctp.maxMessageSize+"\r\n"),output.join("")},SDPUtils.generateSessionId=function(){return Math.random().toString().substr(2,21)},SDPUtils.writeSessionBoilerplate=function(sessId,sessVer,sessUser){var version=void 0!==sessVer?sessVer:2;return"v=0\r\no="+(sessUser||"thisisadapterortc")+" "+(sessId||SDPUtils.generateSessionId())+" "+version+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},SDPUtils.getDirection=function(mediaSection,sessionpart){for(var lines=SDPUtils.splitLines(mediaSection),i=0;i<lines.length;i++)switch(lines[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return lines[i].substr(2)}return sessionpart?SDPUtils.getDirection(sessionpart):"sendrecv"},SDPUtils.getKind=function(mediaSection){return SDPUtils.splitLines(mediaSection)[0].split(" ")[0].substr(2)},SDPUtils.isRejected=function(mediaSection){return"0"===mediaSection.split(" ",2)[1]},SDPUtils.parseMLine=function(mediaSection){var parts=SDPUtils.splitLines(mediaSection)[0].substr(2).split(" ");return{kind:parts[0],port:parseInt(parts[1],10),protocol:parts[2],fmt:parts.slice(3).join(" ")}},SDPUtils.parseOLine=function(mediaSection){var parts=SDPUtils.matchPrefix(mediaSection,"o=")[0].substr(2).split(" ");return{username:parts[0],sessionId:parts[1],sessionVersion:parseInt(parts[2],10),netType:parts[3],addressType:parts[4],address:parts[5]}},SDPUtils.isValidSDP=function(blob){if("string"!=typeof blob||0===blob.length)return!1;for(var lines=SDPUtils.splitLines(blob),i=0;i<lines.length;i++)if(lines[i].length<2||"="!==lines[i].charAt(1))return!1;return!0},"object"===(void 0===module?"undefined":_typeof(module))&&(module.exports=SDPUtils)},{}]},{},[1])(1)}));
define('filter_poodll/audioanalyser', ["jquery","core/log"],(function($,log){return log.debug("audioanalyser: initialising"),{acontext:null,core:null,freq_data:null,wav_data:null,theinterval:null,clone:function(){return $.extend(!0,{},this)},clear:function(){clearInterval(this.theinterval),this.theinterval=null},init:function(acontext){this.theinterval&&this.clear(),this.acontext=acontext,this.core=this.acontext.createAnalyser()},start:function(){this.theinterval&&this.clear();var bufferLength=this.core.frequencyBinCount;this.freq_data=new Uint8Array(bufferLength),this.wav_data=new Uint8Array(bufferLength);var thisthing=this;this.theinterval=setInterval((function(){thisthing.process_recent_data(thisthing)}),2e3)},process_recent_data:function(that){that.core.getByteTimeDomainData(that.wav_data),that.wav_event(that.wav_data),that.core.getByteFrequencyData(that.freq_data),that.freq_event(that.freq_data)},wav_event:function(data){},freq_event:function(data){}}}));
define('filter_poodll/poodll_mediaskins', ["jquery","core/log","filter_poodll/poodll_basemediaskin","filter_poodll/poodll_onetwothreemediaskin","filter_poodll/poodll_goldmediaskin","filter_poodll/poodll_bmrmediaskin","filter_poodll/poodll_shadowmediaskin","filter_poodll/poodll_splitmediaskin","filter_poodll/poodll_fbmediaskin","filter_poodll/poodll_pushmediaskin","filter_poodll/poodll_readaloudmediaskin","filter_poodll/poodll_readseedmediaskin","filter_poodll/poodll_oncemediaskin","filter_poodll/poodll_freshmediaskin","filter_poodll/poodll_uploadmediaskin","filter_poodll/poodll_screenmediaskin","filter_poodll/poodll_warningmediaskin"],(function($,log,baseskin,onetwothreeskin,goldskin,bmrskin,shadowskin,splitskin,fluencybuilderskin,pushskin,readaloudskin,readseedskin,onceskin,freshskin,uploadskin,screenskin,warningskin){return log.debug("PoodLL Media Skins: initialising"),{fetch_skin_clone:function(skinname){var the_skin="";switch(skinname){case"onetwothree":the_skin=onetwothreeskin.clone();break;case"gold":the_skin=goldskin.clone();break;case"burntrose":case"bmr":the_skin=bmrskin.clone();break;case"fluencybuilder":the_skin=fluencybuilderskin.clone();break;case"push":the_skin=pushskin.clone();break;case"readaloud":the_skin=readaloudskin.clone();break;case"readseed":the_skin=readseedskin.clone();break;case"shadow":the_skin=shadowskin.clone();break;case"split":the_skin=splitskin.clone();break;case"once":the_skin=onceskin.clone();break;case"fresh":the_skin=freshskin.clone();break;case"upload":the_skin=uploadskin.clone();break;case"screen":the_skin=screenskin.clone();break;case"warning":the_skin=warningskin.clone();break;default:the_skin=baseskin.clone()}return the_skin}}}));
define('filter_poodll/timer', ["jquery","core/log"],(function($,log){return log.debug("Timer: initialising"),{increment:1,initseconds:0,seconds:0,finalseconds:0,intervalhandle:null,callback:null,enabled:!1,clone:function(){return $.extend(!0,{},this)},init:function(initseconds,callback){this.initseconds=parseInt(initseconds),this.seconds=parseInt(initseconds),this.callback=callback,this.enabled=!0},start:function(){if(this.enabled){var self=this;this.finalseconds=0,this.initseconds>0?this.increment=-1:this.increment=1,this.intervalhandle=this.customSetInterval((function(){self.seconds=self.seconds+self.increment,self.finalseconds=self.finalseconds+1,self.callback()}),1e3)}},customSetInterval:function(func,time){var lastTime=Date.now(),lastDelay=time,outp={};return outp.id=setTimeout((function tick(){var now=Date.now(),dTime=now-lastTime;lastTime=now,lastDelay=time+lastDelay-dTime,outp.id=setTimeout(tick,lastDelay),func()}),time),outp},disable:function(){this.enabled=!1},enable:function(){this.enabled=!0},fetch_display_time:function(someseconds){someseconds||(someseconds=this.seconds);var theHours="00"+parseInt(someseconds/3600);theHours=theHours.substr(theHours.length-2,2);var theMinutes="00"+parseInt(someseconds/60);theMinutes=theMinutes.substr(theMinutes.length-2,2);var theSeconds="00"+parseInt(someseconds%60);return theHours+":"+theMinutes+":"+(theSeconds=theSeconds.substr(theSeconds.length-2,2))},stop:function(){clearTimeout(this.intervalhandle.id)},reset:function(){this.seconds=this.initseconds},pause:function(){this.increment=0},resume:function(){this.initseconds>0?this.increment=-1:this.increment=1}}}));
define('filter_poodll/speech_awstranscriber', ["jquery","core/log"],(function($,log){return log.debug("aws_instant: initialising"),{final_transcript:"",start_timestamp:0,transcriber:null,clone:function(){return $.extend(!0,{},this)},will_work_ok:function(opts){var ret=!1;switch(opts.language){case"en-AU":case"en-GB":case"en-US":case"es-US":case"fr-FR":case"fr-CA":ret=!0;break;default:ret=!1}if(ret)switch(opts.region){case"useast1":case"useast2":case"uswest2":case"sydney":case"dublin":case"ottawa":ret=!0;break;default:ret=!1}return ret},init:function(opts){var that=this;require(["https://cdn.jsdelivr.net/gh/justinhunt/cloudpoodll@latest/amd/build/awstranscriber.min.js"],(function(transcriber){that.transcriber=transcriber,opts.expiretime=300,opts.token=opts.wstoken,opts.wsserver=M.cfg.wwwroot,that.transcriber.init(opts),that.register_events()}))},set_grammar:function(grammar){},start:function(stream){this.transcriber.active||(this.final_transcript="",this.transcriber.start(stream,this.transcriber),this.ignore_onend=!1,this.start_timestamp=Date.now())},stop:function(){this.transcriber.active&&this.transcriber.stop(this.transcriber)},register_events:function(){var that=this;this.transcriber.onFinalResult=function(speechtext,speechresults){that.onfinalspeechcapture(speechtext,speechresults)}},onfinalspeechcapture:function(speechtext,speechresults){log.debug(speechtext)},oninterimspeechcapture:function(speechtext){}}}));
define('filter_poodll/speech_poodll', ["jquery","core/log","filter_poodll/speech_browser","filter_poodll/speech_awstranscriber"],(function($,log,browserrecognition,awstranscriber){return log.debug("speech_poodll: initialising"),{recognizer:null,clone:function(){return $.extend(!0,{},this)},will_work_ok:function(opts){if("streamingtranscriber"in opts)switch(opts.streamingtranscriber){case"aws":return awstranscriber.will_work_ok(opts);case"browser":return browserrecognition.will_work_ok(opts)}return browserrecognition.will_work_ok(opts)||awstranscriber.will_work_ok(opts)},init:function(opts){if("streamingtranscriber"in opts)switch(opts.streamingtranscriber){case"aws":this.recognizer=awstranscriber.clone(),this.recognizer.init(opts);break;case"browser":this.recognizer=browserrecognition.clone(),this.recognizer.init(opts)}if(!this.recognizer)if(browserrecognition.will_work_ok(opts))this.recognizer=browserrecognition.clone(),this.recognizer.init(opts);else{if(!awstranscriber.will_work_ok(opts))return log.debug("no usable speech recognizer found"),!1;this.recognizer=awstranscriber.clone(),this.recognizer.init(opts)}},set_grammar:function(grammar){this.recognizer.set_grammar(grammar)},start:function(stream){this.recognizer&&(this.recognizer.onfinalspeechcapture=this.onfinalspeechcapture,this.recognizer.oninterimspeechcapture=this.oninterimspeechcapture,this.recognizer&&this.recognizer.start(stream))},stop:function(){this.recognizer&&this.recognizer&&this.recognizer.stop()},onfinalspeechcapture:function(speechtext,speechresults){this.recognizer&&log.debug("final:"+speechtext)},oninterimspeechcapture:function(speechtext){this.recognizer&&log.debug("interim:"+speechtext)}}}));
define('filter_poodll/msr_helper_stereoaudio', ["jquery","core/log"],(function($,log){return log.debug("PoodLL Stereo Audio Recorder Helper: initialising"),{scriptprocessornode:null,requestDataInvoked:!1,recordingLength:0,isPaused:!1,deviceSampleRate:48e3,leftchannel:[],rightchannel:[],recording:!1,volume:null,audioInput:null,context:null,sampleRate:0,mimeType:0,isPCM:!1,numChannels:1,msr:null,audioctx:null,mediaStream:null,volumeGainNode:null,clone:function(){return $.extend(!0,{},this)},init:function(msr,mediaStream,audioctx){this.msr=msr,this.audioctx=audioctx,this.mediaStream=mediaStream,this.deviceSampleRate=audioctx.sampleRate,this.sampleRate=this.deviceSampleRate,this.mimeType=msr.mimeType||"audio/wav",this.isPCM=this.mimeType.indexOf("audio/pcm")>-1,this.numChannels=msr.audioChannels||1,log.debug("stereohelper mimetype: "+this.mimeType),this.misc()},misc:function(){var that=this,context=this.audioctx;this.volumeGainNode=context.createGain();var volume=this.volumeGainNode;this.audioInput=context.createMediaStreamSource(this.mediaStream),this.audioInput.connect(volume);var bufferSize=this.msr.bufferSize||2048;0===this.msr.bufferSize&&(bufferSize=0);var scriptprocessornode=null;if(context.createJavaScriptNode)scriptprocessornode=context.createJavaScriptNode(bufferSize,this.numChannels,this.numChannels);else{if(!context.createScriptProcessor)throw"WebAudio API has no support on this browser.";scriptprocessornode=context.createScriptProcessor(bufferSize,this.numChannels,this.numChannels)}this.bufferSize=scriptprocessornode.bufferSize,this.requestDataInvoked=!1,this.scriptprocessornode=scriptprocessornode,1===this.numChannels&&log.debug("All right-channels are skipped."),this.isPaused=!1,scriptprocessornode.onaudioprocess=function(e){if(that.recording&&!that.requestDataInvoked&&!that.isPaused){var left=e.inputBuffer.getChannelData(0);if(that.leftchannel.push(new Float32Array(left)),2===that.numChannels){var right=e.inputBuffer.getChannelData(1);that.rightchannel.push(new Float32Array(right))}that.recordingLength+=that.bufferSize}},volume.connect(this.msr.audioanalyser.core),this.msr.audioanalyser.core.connect(scriptprocessornode),scriptprocessornode.connect(context.destination)},record:function(){this.recording=!0,this.leftchannel.length=this.rightchannel.length=0,this.recordingLength=0},encodeWAV:function(samples){var buffer=new ArrayBuffer(44+2*samples.length),view=new DataView(buffer);return this.writeString(view,0,"RIFF"),view.setUint32(4,36+2*samples.length,!0),this.writeString(view,8,"WAVE"),this.writeString(view,12,"fmt "),view.setUint32(16,16,!0),view.setUint16(20,1,!0),view.setUint16(22,this.numChannels,!0),view.setUint32(24,this.sampleRate,!0),view.setUint32(28,4*this.sampleRate,!0),view.setUint16(32,2*this.numChannels,!0),view.setUint16(34,16,!0),this.writeString(view,36,"data"),view.setUint32(40,2*samples.length,!0),this.floatTo16BitPCM(view,44,samples),log.debug(2*samples.length),view},floatTo16BitPCM:function(output,offset,input){for(var i=0;i<input.length;i++,offset+=2){var s=Math.max(-1,Math.min(1,input[i]));output.setInt16(offset,s<0?32768*s:32767*s,!0)}},writeString:function(view,offset,string){for(var i=0;i<string.length;i++)view.setUint8(offset+i,string.charCodeAt(i))},requestData:function(){if(!this.isPaused)if(0!==this.recordingLength){this.requestDataInvoked=!0;var internalLeftChannel=this.leftchannel.slice(0),internalRightChannel=this.rightchannel.slice(0),internalRecordingLength=this.recordingLength;this.leftchannel.length=this.rightchannel.length=[],this.recordingLength=0,this.requestDataInvoked=!1;var leftBuffer=this.mergeBuffers(internalLeftChannel,internalRecordingLength),interleaved=leftBuffer;if(2===this.numChannels){var rightBuffer=this.mergeBuffers(internalRightChannel,internalRecordingLength);interleaved=this.interleave(leftBuffer,rightBuffer)}var dataview=this.encodeWAV(interleaved),audioBlob=new Blob([dataview],{type:"audio/wav"});this.msr.ondataavailable(audioBlob)}else this.requestDataInvoked=!1},xrequestData:function(){if(!this.isPaused)if(0!==this.recordingLength){this.requestDataInvoked=!0;var internalLeftChannel=this.leftchannel.slice(0),internalRightChannel=this.rightchannel.slice(0),internalRecordingLength=this.recordingLength;this.leftchannel.length=this.rightchannel.length=[],this.recordingLength=0,this.requestDataInvoked=!1;var leftBuffer=this.mergeBuffers(internalLeftChannel,internalRecordingLength),interleaved=leftBuffer;if(2===this.numChannels){var rightBuffer=this.mergeBuffers(internalRightChannel,internalRecordingLength);this.interleaved=this.interleave(leftBuffer,rightBuffer)}if(this.isPCM){var blob=new Blob([this.convertoFloat32ToInt16(interleaved)],{type:"audio/pcm"});this.msr.ondataavailable(blob)}else{var buffer=new ArrayBuffer(44+2*interleaved.length),view=new DataView(buffer);this.writeUTFBytes(view,0,"RIFF"),view.setUint32(4,44+2*interleaved.length-8,!0),this.writeUTFBytes(view,8,"WAVE"),this.writeUTFBytes(view,12,"fmt "),view.setUint32(16,16,!0),view.setUint16(20,1,!0),view.setUint16(22,this.numChannels,!0),view.setUint32(24,this.sampleRate,!0),view.setUint32(28,this.sampleRate*this.numChannels*2,!0),view.setUint16(32,2*this.numChannels,!0),view.setUint16(34,16,!0),this.writeUTFBytes(view,36,"data"),view.setUint32(40,2*interleaved.length,!0);for(var lng=interleaved.length,index=44,i=0;i<lng;i++)view.setInt16(index,32767*interleaved[i],!0),index+=2;blob=new Blob([view],{type:"audio/wav"});this.msr.ondataavailable(blob)}}else this.requestDataInvoked=!1},stop:function(){this.recording=!1,this.requestData(),this.audioInput.disconnect()},interleave:function(leftChannel,rightChannel){for(var length=leftChannel.length+rightChannel.length,result=new Float32Array(length),inputIndex=0,index=0;index<length;)result[index++]=leftChannel[inputIndex],result[index++]=rightChannel[inputIndex],inputIndex++;return result},mergeBuffers:function(channelBuffer,recordingLength){for(var result=new Float32Array(recordingLength),offset=0,lng=channelBuffer.length,i=0;i<lng;i++){var buffer=channelBuffer[i];result.set(buffer,offset),offset+=buffer.length}return result},writeUTFBytes:function(view,offset,string){for(var lng=string.length,i=0;i<lng;i++)view.setUint8(offset+i,string.charCodeAt(i))},convertoFloat32ToInt16:function(buffer){for(var l=buffer.length,buf=new Int16Array(l);l--;)buf[l]=65535*buffer[l];return buf.buffer},pause:function(){this.isPaused=!0},resume:function(){this.isPaused=!1}}}));
define('filter_poodll/poodll_warningmediaskin', ["jquery","core/log","filter_poodll/utils_amd"],(function($,log,utils){return log.debug("PoodLL Warning Media skin: initialising"),{instanceprops:null,pmr:null,clone:function(){return $.extend(!0,{},this)},init:function(ip,pmr){this.instanceprops=ip,this.pmr=pmr},fetch_status_bar:function(skinname){return""},fetch_preview_audio:function(skinname){return""},fetch_preview_video:function(skinname){return""},fetch_resource_audio:function(skinname){return""},fetch_resource_video:function(skinname){return""},fetch_uploader_skin:function(controlbarid,element){return!1},handle_timer_update:function(controlbarid){},onUploadSuccess:function(controlbarid){},onUploadFailure:function(controlbarid){},onMediaSuccess_video:function(controlbarid){},onMediaSuccess_audio:function(controlbarid){},insert_controlbar_video:function(element,controlbarid,preview,resource){return this.prepare_controlbar(element,controlbarid,preview,resource,"video")},insert_controlbar_audio:function(element,controlbarid,preview,resource){return this.prepare_controlbar(element,controlbarid,preview,resource,"audio")},register_controlbar_events_video:function(onMediaSuccess,controlbarid){return this.register_events(controlbarid)},register_controlbar_events_audio:function(onMediaSuccess,controlbarid){return this.register_events(controlbarid)},fetch_instance_props:function(){return this.instanceprops},prepare_controlbar:function(element,controlbarid,preview,resource,mediatype){var ip=this.fetch_instance_props(),message=M.util.get_string("recui_unsupportedbrowser","filter_poodll"),skin_style=ip.config.media_skin_style,controls='<div class="poodll_mediarecorderholder_warning '+("video"==mediatype?"poodll_mediarecorder_video":"poodll_mediarecorder_audio")+'" id="holder_'+controlbarid+'">';controls+='<div class="poodll_mediarecorderbox_warning" id="'+controlbarid+'">',controls+='<div class="style-holder '+skin_style+'">',controls+='<div class="poodll_mediarecorderbox_warning_message '+skin_style+'">'+message+"</div>",controls+="</div></div></div>",$(element).prepend(controls);return{}},register_events:function(controlbarid){}}}));
define('filter_poodll/poodll_shadowmediaskin', ["jquery","core/log","filter_poodll/utils_amd"],(function($,log,utils){return log.debug("PoodLL Shadow Skin: initialising"),{instanceprops:null,pmr:null,uploaded:!1,recorded:!1,mustResetResourcePlayer:!1,clone:function(){return $.extend(!0,{},this)},init:function(ip,pmr){this.instanceprops=ip,this.pmr=pmr},fetch_instanceprops:function(){return this.instanceprops},onUploadSuccess:function(controlbarid){$("#"+controlbarid+" > .poodll_save-recording").hide(),$("#"+controlbarid+" > .poodll_savedsuccessfully").show()},onUploadFailure:function(controlbarid){},fetch_status_bar:function(skin){return'<div class="poodll_status_'+skin+'"></div>'},fetch_preview_audio:function(skin){return'<audio class="poodll_checkplayer_'+skin+' " style="display: none;" controls playsinline="playsinline" muted></audio>'},fetch_preview_video:function(skin){return'<video class="poodll_checkplayer_'+skin+'" width="320" height="240" playsinline="playsinline" muted></video>'},fetch_resource_audio:function(skin){return'<audio class="poodll_resourceplayer_'+skin+'" style="display: none;" src="@@RESOURCEURL@@" playsinline="playsinline" controls></audio>'},fetch_resource_video:function(skin){return'<video class="poodll_resourceplayer_'+skin+'" style="display: none;" src="@@RESOURCEURL@@" playsinline="playsinline"></video>'},fetch_uploader_skin:function(controlbarid,element){return!1},onMediaError:function(e){console.error("media error",e)},onMediaSuccess_video:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);this.recorded=!0,this.do_play_resource(ip),ip.controlbar.resourceplayer.bind("ended",(function(){ip.controlbar.stopbutton.click()})),this.set_visual_mode("recordingmode",ip)},onMediaSuccess_audio:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.preview.attr("src",null),this.recorded=!0,this.do_play_resource(ip),ip.controlbar.resourceplayer.bind("ended",(function(){ip.controlbar.stopbutton.click()})),this.set_visual_mode("recordingmode",ip)},handle_timer_update:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);this.update_status(controlbarid),0==ip.timer.seconds&&ip.timer.initseconds>0&&ip.controlbar.stopbutton.click()},update_status:function(controlbarid){},set_visual_mode:function(mode,ip){switch(mode){case"recordingmode":this.disable_button(ip.controlbar.startbutton),ip.controlbar.startbutton.hide(),this.disable_button(ip.controlbar.stopplaybackbutton),ip.controlbar.stopplaybackbutton.hide(),this.disable_button(ip.controlbar.resourcestopbutton),ip.controlbar.resourcestopbutton.hide(),this.enable_button(ip.controlbar.stopbutton),ip.controlbar.stopbutton.show(),this.disable_button(ip.controlbar.playbackbutton),ip.controlbar.playbackbutton.show(),this.disable_button(ip.controlbar.resourceplaybutton),ip.controlbar.resourceplaybutton.show();break;case"resourceplayingmode":this.disable_button(ip.controlbar.stopbutton),ip.controlbar.stopbutton.hide(),this.disable_button(ip.controlbar.playbackbutton),ip.controlbar.playbackbutton.hide(),this.disable_button(ip.controlbar.resourceplaybutton),ip.controlbar.resourceplaybutton.hide(),this.disable_button(ip.controlbar.startbutton),ip.controlbar.startbutton.show(),this.disable_button(ip.controlbar.stopplaybackbutton),ip.controlbar.stopplaybackbutton.show(),this.enable_button(ip.controlbar.resourcestopbutton),ip.controlbar.resourcestopbutton.show();break;case"playingbackmode":this.disable_button(ip.controlbar.stopbutton),ip.controlbar.stopbutton.hide(),this.disable_button(ip.controlbar.playbackbutton),ip.controlbar.playbackbutton.hide(),this.disable_button(ip.controlbar.resourcestopbutton),ip.controlbar.resourcestopbutton.hide(),this.disable_button(ip.controlbar.startbutton),ip.controlbar.startbutton.show(),this.enable_button(ip.controlbar.stopplaybackbutton),ip.controlbar.stopplaybackbutton.show(),this.disable_button(ip.controlbar.resourceplaybutton),ip.controlbar.resourceplaybutton.show();break;case"neverrecordedmode":this.disable_button(ip.controlbar.stopbutton),ip.controlbar.stopbutton.hide(),this.disable_button(ip.controlbar.stopplaybackbutton),ip.controlbar.stopplaybackbutton.hide(),this.disable_button(ip.controlbar.resourcestopbutton),ip.controlbar.resourcestopbutton.hide(),this.enable_button(ip.controlbar.startbutton),ip.controlbar.startbutton.show(),this.disable_button(ip.controlbar.playbackbutton),ip.controlbar.playbackbutton.show(),this.enable_button(ip.controlbar.resourceplaybutton),ip.controlbar.resourceplaybutton.show();break;case"allstoppedmode":this.disable_button(ip.controlbar.stopbutton),ip.controlbar.stopbutton.hide(),this.disable_button(ip.controlbar.stopplaybackbutton),ip.controlbar.stopplaybackbutton.hide(),this.disable_button(ip.controlbar.resourcestopbutton),ip.controlbar.resourcestopbutton.hide(),this.enable_button(ip.controlbar.startbutton),ip.controlbar.startbutton.show(),this.enable_button(ip.controlbar.playbackbutton),ip.controlbar.playbackbutton.show(),this.enable_button(ip.controlbar.resourceplaybutton),ip.controlbar.resourceplaybutton.show()}},insert_controlbar_video:function(element,controlbarid,preview,resourceplayer){return this.prepare_controlbar(element,controlbarid,preview,resourceplayer,"video")},insert_controlbar_audio:function(element,controlbarid,preview,resourceplayer){return this.prepare_controlbar(element,controlbarid,preview,resourceplayer,"audio")},prepare_controlbar:function(element,controlbarid,preview,resourceplayer,mediatype){var ip=this.fetch_instanceprops(controlbarid),skin_style=ip.config.media_skin_style,recorder_class="video"==mediatype?"poodll_mediarecorder_video":"poodll_mediarecorder_audio";resourceplayer=resourceplayer.replace("@@RESOURCEURL@@",ip.config.resource);var size_class="poodll_mediarecorder_size_auto";switch(ip.config.size){case"small":size_class="poodll_mediarecorder_size_small";break;case"big":size_class="poodll_mediarecorder_size_big";break;case"auto":size_class="poodll_mediarecorder_size_auto"}this.pmr.fetch_strings();var controls='<div class="poodll_mediarecorderholder_shadow '+recorder_class+" "+size_class+'" id="holder_'+controlbarid+'">';return controls+='<div class="poodll_mediarecorderbox_shadow" id="'+controlbarid+'">',controls+='<div class="style-holder '+skin_style+'">',controls+=this.fetch_status_bar("shadow"),controls+=preview,controls+=resourceplayer,controls+='<button type="button" class="poodll_mediarecorder_button_shadow poodll_play-resource_shadow"><span class="fa fa-play-circle fa-4x"></span></button>',controls+='<button type="button" class="poodll_mediarecorder_button_shadow poodll_stop-resource_shadow" style="display: none;"><span class="fa fa-stop-circle fa-4x"></span></button>',controls+='<button type="button" class="poodll_mediarecorder_button_shadow poodll_start-recording_shadow"><span class="fa fa-play-circle fa-4x"></span><hr style="color: white"><span class="fa fa-microphone fa-4x"></span></button>',controls+='<button type="button" class="poodll_mediarecorder_button_shadow poodll_stop-recording_shadow pmr_disabled" style="display: none;" disabled><span class="fa fa-stop-circle fa-4x"></span></button>',controls+=' <button type="button" class="poodll_mediarecorder_button_shadow poodll_playback-recording_shadow pmr_disabled" disabled><span class="fa fa-play-circle fa-4x"></span></button>',controls+=' <button type="button" class="poodll_mediarecorder_button_shadow poodll_stopplayback-recording_shadow" style="display: none;"><span class="fa fa-stop-circle fa-4x"></span></button>',controls+='<div class="marker" style="display: none;"><i class="fa fa-check" aria-hidden="true"></i></div>',controls+="</div></div></div>",$(element).prepend(controls),{marker:$("#"+controlbarid+"  .marker"),status:$("#"+controlbarid+"  .poodll_status_shadow"),resourceplayer:$("#"+controlbarid+"  .poodll_resourceplayer_shadow"),preview:$("#"+controlbarid+"  .poodll_checkplayer_shadow"),resourceplaybutton:$("#"+controlbarid+"  .poodll_play-resource_shadow"),resourcestopbutton:$("#"+controlbarid+"  .poodll_stop-resource_shadow"),startbutton:$("#"+controlbarid+"  .poodll_start-recording_shadow"),stopbutton:$("#"+controlbarid+"  .poodll_stop-recording_shadow"),playbackbutton:$("#"+controlbarid+"  .poodll_playback-recording_shadow"),stopplaybackbutton:$("#"+controlbarid+"  .poodll_stopplayback-recording_shadow"),savebutton:$("#"+controlbarid+"  .poodll_save-recording_shadow")}},register_controlbar_events_video:function(onMediaSuccess,controlbarid){return this.register_controlbar_events_audio(onMediaSuccess,controlbarid)},register_controlbar_events_audio:function(onMediaSuccess,controlbarid){var self=this,pmr=this.pmr,ip=this.fetch_instanceprops(controlbarid);ip.controlbar.startbutton.click((function(){pmr.do_start_audio(ip,onMediaSuccess)})),ip.controlbar.stopbutton.click((function(){pmr.do_stop_audio(ip),self.disable_button(this);var resourceplayer=ip.controlbar.resourceplayer;resourceplayer&&resourceplayer.get(0)&&resourceplayer.get(0).pause(),self.set_visual_mode("allstoppedmode",ip),self.do_stop_resource(ip)})),ip.controlbar.playbackbutton.click((function(){self.disable_button(this),ip.controlbar.marker.show();var resourceplayer=ip.controlbar.resourceplayer.get(0);pmr.do_play_audio(ip,resourceplayer),ip.mustResetResourcePlayer=!0,ip.controlbar.resourceplayer.bind("ended",(function(){self.set_visual_mode("allstoppedmode",ip)})),self.set_visual_mode("playingbackmode",ip),self.set_completion(!0,ip)})),ip.controlbar.stopplaybackbutton.click((function(){self.do_stop_resource(ip),self.set_visual_mode("allstoppedmode",ip)})),ip.controlbar.resourceplaybutton.click((function(){self.do_play_resource(ip),ip.controlbar.resourceplayer.bind("ended",(function(){self.recorded?self.set_visual_mode("allstoppedmode",ip):self.set_visual_mode("neverrecordedmode",ip)})),self.set_visual_mode("resourceplayingmode",ip)})),ip.controlbar.resourcestopbutton.click((function(){self.do_stop_resource(ip),self.recorded?self.set_visual_mode("allstoppedmode",ip):self.set_visual_mode("neverrecordedmode",ip)})),ip.controlbar.savebutton.click((function(){return self.disable_button(this),ip.blobs&&ip.blobs.length>0?(pmr.do_save_audio(ip),self.uploaded=!0,self.disable_button(ip.controlbar.startbutton)):ip.uploader.Output(M.util.get_string("recui_nothingtosaveerror","filter_poodll")),!1})),window.onbeforeunload=function(){self.enable_button(ip.controlbar.startbutton);var preview=ip.controlbar.preview;preview&&preview.get(0)&&preview.get(0).pause()}},set_completion:function(completed,ip){},do_stop_resource:function(ip){console.log("stopped the resource");var resourceplayer=ip.controlbar.resourceplayer.get(0);if(resourceplayer.pause(),resourceplayer.currentTime=0,ip.mustResetResourcePlayer){ip.mustResetResourcePlayer=!1,resourceplayer.src=ip.config.resource;resourceplayer.load()}},do_play_resource:function(ip){var resourceplayer=ip.controlbar.resourceplayer.get(0);resourceplayer.play(),resourceplayer.currentTime=0},enable_button:function(button){$(button).attr("disabled",!1),$(button).removeClass("pmr_disabled")},disable_button:function(button){$(button).attr("disabled",!0),$(button).addClass("pmr_disabled")}}}));
define('filter_poodll/poodll_uploadrecorder', ["jquery","core/log","filter_poodll/uploader"],(function($,log,uploader){return log.debug("PoodLL Upload Recorder: initialising"),{config:null,instanceprops:[],fetch_instance_props:function(widgetid){return this.instanceprops[widgetid]},init_instance_props:function(widgetid){var props={config:null,uploader:null};this.instanceprops[widgetid]=props},supports_current_browser:function(config){return!0},embed:function(element,config){this.init_instance_props(config.widgetid);var ip=this.fetch_instance_props(config.widgetid);ip.config=config,ip.uploader=uploader.clone(),ip.uploader.init(element,config),this.insert_controls(element,config.widgetid),this.register_events(config.widgetid)},insert_controls:function(element,widgetid){var acceptmedia="",config=this.fetch_instance_props(widgetid).config;switch(config.mediatype){case"video":acceptmedia="video/*";break;case"snapshot":case"image":acceptmedia="image/*";case"audio":acceptmedia=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?"video/*":"audio/*";default:acceptmedia=""}var controls='<div class="p_btn_wrapper">';controls+='<input type="file" id="'+config.widgetid+'_poodllfileselect" name="poodllfileselect[]" accept="'+acceptmedia+'"/>',controls+='<button type="button" class="p_btn">'+M.util.get_string("recui_recordorchoose","filter_poodll")+"</button>",controls+="</div>",$(element).prepend(controls)},register_events:function(widgetid){var self=this;$("#"+widgetid+"_poodllfileselect").on("change",(function(e){self.FileSelectHandler(e,widgetid)}))},FileSelectHandler:function(e,widgetid){for(var file,ip=this.fetch_instance_props(widgetid),files=e.target.files||e.dataTransfer.files,i=0;file=files[i];i++)log.debug("filetype:"+file.type),ip.uploader.uploadBlob(file,file.type)},ParseFile:function(file,widgetid){var ip=this.fetch_instance_props(widgetid),filedata="",reader=new FileReader;reader.onloadend=function(e){filedata=e.target.result,ip.uploader.uploadFile(filedata,file.type)},log.debug("filetype:"+file.type),reader.readAsDataURL(file)}}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("filter_poodll/drawingboard",[],(function(){var pattern,DrawingBoard={};return DrawingBoard.Board=function(id,opts){if(this.opts=$.extend({},DrawingBoard.Board.defaultOpts,opts),this.ev=new DrawingBoard.Utils.MicroEvent,this.id=id,this.$el=$(document.getElementById(id)),!this.$el.length)return!1;var tpl='<div class="drawing-board-canvas-wrapper"></canvas><canvas class="drawing-board-canvas"></canvas><div class="drawing-board-cursor drawing-board-utils-hidden"></div></div>';if(this.opts.controlsPosition.indexOf("bottom")>-1?tpl+='<div class="drawing-board-controls"></div>':tpl='<div class="drawing-board-controls"></div>'+tpl,this.$el.addClass("drawing-board").append(tpl),this.dom={$canvasWrapper:this.$el.find(".drawing-board-canvas-wrapper"),$canvas:this.$el.find(".drawing-board-canvas"),$cursor:this.$el.find(".drawing-board-cursor"),$controls:this.$el.find(".drawing-board-controls")},$.each(["left","right","center"],$.proxy((function(n,val){if(this.opts.controlsPosition.indexOf(val)>-1)return this.dom.$controls.attr("data-align",val),!1}),this)),this.canvas=this.dom.$canvas.get(0),this.ctx=this.canvas&&this.canvas.getContext&&this.canvas.getContext("2d")?this.canvas.getContext("2d"):null,this.color=this.opts.color,!this.ctx)return this.opts.errorMessage&&this.$el.html(this.opts.errorMessage),!1;this.storage=this._getStorage(),this.initHistory(),this.reset({webStorage:!1,history:!1,background:!1}),this.initControls(),this.resize(),this.reset({webStorage:!1,history:!0,background:!0}),this.restoreWebStorage(),this.initDropEvents(),this.initDrawEvents()},DrawingBoard.Board.defaultOpts={controls:["Color","DrawingMode","Size","Navigation"],controlsPosition:"top left",color:"#000000",size:1,background:"#fff",eraserColor:"background",webStorage:"session",droppable:!1,enlargeYourContainer:!1,errorMessage:'<p>It seems you use an obsolete browser. <a href="http://browsehappy.com/" target="_blank">Update it</a> to start drawing.</p>'},DrawingBoard.Board.prototype={reset:function(opts){opts=$.extend({color:this.opts.color,size:this.opts.size,webStorage:!0,history:!0,background:!1},opts),this.setMode("pencil"),opts.background&&this.resetBackground(this.opts.background,!1),opts.color&&this.setColor(opts.color),opts.size&&(this.ctx.lineWidth=opts.size),this.ctx.lineCap="round",this.ctx.lineJoin="round",opts.webStorage&&this.saveWebStorage(),opts.history&&this.saveHistory(),this.blankCanvas=this.getImg(),this.ev.trigger("board:reset",opts)},resetBackground:function(background,historize){background=background||this.opts.background,historize=void 0===historize||historize;var bgIsColor=DrawingBoard.Utils.isColor(background),prevMode=this.getMode();this.setMode("pencil"),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.width),bgIsColor?(this.ctx.fillStyle=background,this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)):background&&this.setImg(background),this.setMode(prevMode),historize&&this.saveHistory()},resize:function(){var canvasWidth,canvasHeight;this.dom.$controls.toggleClass("drawing-board-controls-hidden",!this.controls||!this.controls.length);var widths=[this.$el.width(),DrawingBoard.Utils.boxBorderWidth(this.$el),DrawingBoard.Utils.boxBorderWidth(this.dom.$canvasWrapper,!0,!0)],heights=[this.$el.height(),DrawingBoard.Utils.boxBorderHeight(this.$el),this.dom.$controls.height(),DrawingBoard.Utils.boxBorderHeight(this.dom.$controls,!1,!0),DrawingBoard.Utils.boxBorderHeight(this.dom.$canvasWrapper,!0,!0)],sum=function(values,multiplier){multiplier=multiplier||1;for(var res=values[0],i=1;i<values.length;i++)res+=values[i]*multiplier;return res},sub=function(values){return sum(values,-1)};this.opts.enlargeYourContainer?(canvasWidth=this.$el.width(),canvasHeight=this.$el.height(),this.$el.width(sum(widths)),this.$el.height(sum(heights))):(canvasWidth=sub(widths),canvasHeight=sub(heights)),this.dom.$canvasWrapper.css("width",canvasWidth+"px"),this.dom.$canvasWrapper.css("height",canvasHeight+"px"),this.dom.$canvas.css("width",canvasWidth+"px"),this.dom.$canvas.css("height",canvasHeight+"px"),this.canvas.width=canvasWidth,this.canvas.height=canvasHeight},initControls:function(){if(this.controls=[],!this.opts.controls.length||!DrawingBoard.Control)return!1;for(var i=0;i<this.opts.controls.length;i++){var c=null;if("string"==typeof this.opts.controls[i])c=new window.DrawingBoard.Control[this.opts.controls[i]](this);else if("object"==_typeof(this.opts.controls[i])){for(var controlName in this.opts.controls[i])break;c=new window.DrawingBoard.Control[controlName](this,this.opts.controls[i][controlName])}c&&this.addControl(c)}},addControl:function(control,optsOrPos,pos){if("string"!=typeof control&&("object"!==_typeof(control)||!control instanceof DrawingBoard.Control))return!1;var opts="object"==_typeof(optsOrPos)?optsOrPos:{};pos=pos?1*pos:"number"==typeof optsOrPos?optsOrPos:null,"string"==typeof control&&(control=new window.DrawingBoard.Control[control](this,opts)),pos?this.dom.$controls.children().eq(pos).before(control.$el):this.dom.$controls.append(control.$el),this.controls||(this.controls=[]),this.controls.push(control),this.dom.$controls.removeClass("drawing-board-controls-hidden")},initHistory:function(){this.history={values:[],position:0}},saveHistory:function(){for(;this.history.values.length>30;)this.history.values.shift(),this.history.position--;0!==this.history.position&&this.history.position<this.history.values.length?(this.history.values=this.history.values.slice(0,this.history.position),this.history.position++):this.history.position=this.history.values.length+1,this.history.values.push(this.getImg()),this.ev.trigger("historyNavigation",this.history.position)},_goThroughHistory:function(goForth){if(!(goForth&&this.history.position==this.history.values.length||!goForth&&1==this.history.position)){var pos=goForth?this.history.position+1:this.history.position-1;this.history.values.length&&void 0!==this.history.values[pos-1]&&(this.history.position=pos,this.setImg(this.history.values[pos-1])),this.ev.trigger("historyNavigation",pos),this.saveWebStorage()}},goBackInHistory:function(){this._goThroughHistory(!1)},goForthInHistory:function(){this._goThroughHistory(!0)},setImg:function(src){var ctx=this.ctx,img=new Image,oldGCO=ctx.globalCompositeOperation;img.onload=function(){ctx.globalCompositeOperation="source-over",ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.width),ctx.drawImage(img,0,0),ctx.globalCompositeOperation=oldGCO},img.src=src},getImg:function(){return this.canvas.toDataURL("image/png")},downloadImg:function(){var img=this.getImg();img=img.replace("image/png","image/octet-stream"),window.location.href=img},saveWebStorage:function(){window[this.storage]&&(window[this.storage].setItem("drawing-board-"+this.id,this.getImg()),this.ev.trigger("board:save"+this.storage.charAt(0).toUpperCase()+this.storage.slice(1),this.getImg()))},restoreWebStorage:function(){window[this.storage]&&null!==window[this.storage].getItem("drawing-board-"+this.id)&&(this.setImg(window[this.storage].getItem("drawing-board-"+this.id)),this.ev.trigger("board:restore"+this.storage.charAt(0).toUpperCase()+this.storage.slice(1),window[this.storage].getItem("drawing-board-"+this.id)))},clearWebStorage:function(){window[this.storage]&&null!==window[this.storage].getItem("drawing-board-"+this.id)&&(window[this.storage].removeItem("drawing-board-"+this.id),this.ev.trigger("board:clear"+this.storage.charAt(0).toUpperCase()+this.storage.slice(1)))},_getStorage:function(){return!(!this.opts.webStorage||"session"!==this.opts.webStorage&&"local"!==this.opts.webStorage)&&this.opts.webStorage+"Storage"},initDropEvents:function(){if(!this.opts.droppable)return!1;this.dom.$canvas.on("dragover dragenter drop",(function(e){e.stopPropagation(),e.preventDefault()})),this.dom.$canvas.on("drop",$.proxy(this._onCanvasDrop,this))},_onCanvasDrop:function(e){var files=(e=e.originalEvent?e.originalEvent:e).dataTransfer.files;if(!files||!files.length||-1==files[0].type.indexOf("image")||!window.FileReader)return!1;var fr=new FileReader;fr.readAsDataURL(files[0]),fr.onload=$.proxy((function(ev){this.setImg(ev.target.result),this.ev.trigger("board:imageDropped",ev.target.result),this.ev.trigger("board:userAction"),this.saveHistory()}),this)},setMode:function(newMode,silent){silent=silent||!1,newMode=newMode||"pencil",this.ev.unbind("board:startDrawing",$.proxy(this.fill,this)),"transparent"===this.opts.eraserColor?this.ctx.globalCompositeOperation="eraser"===newMode?"destination-out":"source-over":("eraser"===newMode?"background"===this.opts.eraserColor&&DrawingBoard.Utils.isColor(this.opts.background)?this.ctx.strokeStyle=this.opts.background:DrawingBoard.Utils.isColor(this.opts.eraserColor)&&(this.ctx.strokeStyle=this.opts.eraserColor):this.mode&&"eraser"!==this.mode||(this.ctx.strokeStyle=this.color),"filler"===newMode&&this.ev.bind("board:startDrawing",$.proxy(this.fill,this))),this.mode=newMode,silent||this.ev.trigger("board:mode",this.mode)},getMode:function(){return this.mode||"pencil"},setColor:function(color){var that=this;if(color=color||this.color,!DrawingBoard.Utils.isColor(color))return!1;if(this.color=color,"transparent"!==this.opts.eraserColor&&"eraser"===this.mode){this.ev.bind("board:mode",(function setStrokeStyle(mode){"eraser"!==mode&&(that.strokeStyle=that.color),that.ev.unbind("board:mode",setStrokeStyle)}))}else this.ctx.strokeStyle=this.color},fill:function(e){if(this.getImg()===this.blankCanvas)return this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.width),this.ctx.fillStyle=this.color,void this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height);var img=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height),stroke=this.ctx.strokeStyle,r=parseInt(stroke.substr(1,2),16),g=parseInt(stroke.substr(3,2),16),b=parseInt(stroke.substr(5,2),16),start=DrawingBoard.Utils.pixelAt(img,parseInt(e.coords.x,10),parseInt(e.coords.y,10));if(start[3]!==DrawingBoard.Utils.RGBToInt(r,g,b)){for(var pixel,queue=[start],maxX=img.width-1,maxY=img.height-1;pixel=queue.pop();)pixel[3]===start[3]&&(img.data[pixel[0]]=r,img.data[pixel[0]+1]=g,img.data[pixel[0]+2]=b,pixel[1]>0&&queue.push(DrawingBoard.Utils.pixelAt(img,pixel[1]-1,pixel[2])),pixel[1]<maxX&&queue.push(DrawingBoard.Utils.pixelAt(img,pixel[1]+1,pixel[2])),pixel[2]>0&&queue.push(DrawingBoard.Utils.pixelAt(img,pixel[1],pixel[2]-1)),pixel[2]<maxY&&queue.push(DrawingBoard.Utils.pixelAt(img,pixel[1],pixel[2]+1)));this.ctx.putImageData(img,0,0)}},initDrawEvents:function(){this.isDrawing=!1,this.isMouseHovering=!1,this.coords={},this.coords.old=this.coords.current=this.coords.oldMid={x:0,y:0},this.dom.$canvas.on("mousedown touchstart",$.proxy((function(e){this._onInputStart(e,this._getInputCoords(e))}),this)),this.dom.$canvas.on("mousemove touchmove",$.proxy((function(e){this._onInputMove(e,this._getInputCoords(e))}),this)),this.dom.$canvas.on("mousemove",$.proxy((function(e){}),this)),this.dom.$canvas.on("mouseup touchend",$.proxy((function(e){this._onInputStop(e,this._getInputCoords(e))}),this)),this.dom.$canvas.on("mouseover",$.proxy((function(e){this._onMouseOver(e,this._getInputCoords(e))}),this)),this.dom.$canvas.on("mouseout",$.proxy((function(e){this._onMouseOut(e,this._getInputCoords(e))}),this)),$("body").on("mouseup touchend",$.proxy((function(e){this.isDrawing=!1}),this)),window.requestAnimationFrame&&requestAnimationFrame($.proxy(this.draw,this))},draw:function(){if(window.requestAnimationFrame&&this.ctx.lineWidth>10&&this.isMouseHovering){this.dom.$cursor.css({width:this.ctx.lineWidth+"px",height:this.ctx.lineWidth+"px"});var transform=DrawingBoard.Utils.tpl("translateX({{x}}px) translateY({{y}}px)",{x:this.coords.current.x-this.ctx.lineWidth/2,y:this.coords.current.y-this.ctx.lineWidth/2});this.dom.$cursor.css({transform:transform,"-webkit-transform":transform,"-ms-transform":transform}),this.dom.$cursor.removeClass("drawing-board-utils-hidden")}else this.dom.$cursor.addClass("drawing-board-utils-hidden");if(this.isDrawing){var currentMid=this._getMidInputCoords(this.coords.current);this.ctx.beginPath(),this.ctx.moveTo(currentMid.x,currentMid.y),this.ctx.quadraticCurveTo(this.coords.old.x,this.coords.old.y,this.coords.oldMid.x,this.coords.oldMid.y),this.ctx.stroke(),this.coords.old=this.coords.current,this.coords.oldMid=currentMid}window.requestAnimationFrame&&requestAnimationFrame($.proxy((function(){this.draw()}),this))},_onInputStart:function(e,coords){this.coords.current=this.coords.old=coords,this.coords.oldMid=this._getMidInputCoords(coords),this.isDrawing=!0,window.requestAnimationFrame||this.draw(),this.ev.trigger("board:startDrawing",{e:e,coords:coords}),e.preventDefault()},_onInputMove:function(e,coords){this.coords.current=coords,this.ev.trigger("board:drawing",{e:e,coords:coords}),window.requestAnimationFrame||this.draw(),e.preventDefault()},_onInputStop:function(e,coords){!this.isDrawing||e.touches&&0!==e.touches.length||(this.isDrawing=!1,this.saveWebStorage(),this.saveHistory(),this.ev.trigger("board:stopDrawing",{e:e,coords:coords}),this.ev.trigger("board:userAction"),e.preventDefault())},_onMouseOver:function(e,coords){this.isMouseHovering=!0,this.coords.old=this._getInputCoords(e),this.coords.oldMid=this._getMidInputCoords(this.coords.old),this.ev.trigger("board:mouseOver",{e:e,coords:coords})},_onMouseOut:function(e,coords){this.isMouseHovering=!1,this.ev.trigger("board:mouseOut",{e:e,coords:coords})},_getInputCoords:function(e){var x,y;return(e=e.originalEvent?e.originalEvent:e).touches&&1==e.touches.length?(x=e.touches[0].pageX,y=e.touches[0].pageY):(x=e.pageX,y=e.pageY),{x:x-this.dom.$canvas.offset().left,y:y-this.dom.$canvas.offset().top}},_getMidInputCoords:function(coords){return{x:this.coords.old.x+coords.x>>1,y:this.coords.old.y+coords.y>>1}}},DrawingBoard.Control=function(drawingBoard,opts){return this.board=drawingBoard,this.opts=$.extend({},this.defaults,opts),this.$el=$(document.createElement("div")).addClass("drawing-board-control"),this.name&&this.$el.addClass("drawing-board-control-"+this.name),this.board.ev.bind("board:reset",$.proxy(this.onBoardReset,this)),this.initialize.apply(this,arguments),this},DrawingBoard.Control.prototype={name:"",defaults:{},initialize:function(){},addToBoard:function(){this.board.addControl(this)},onBoardReset:function(opts){}},DrawingBoard.Control.extend=function(protoProps,staticProps){var child,parent=this;child=protoProps&&protoProps.hasOwnProperty("constructor")?protoProps.constructor:function(){return parent.apply(this,arguments)},$.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child};return Surrogate.prototype=parent.prototype,child.prototype=new Surrogate,protoProps&&$.extend(child.prototype,protoProps),child.__super__=parent.prototype,child},DrawingBoard.Control.Color=DrawingBoard.Control.extend({name:"colors",initialize:function(){this.initTemplate();var that=this;this.$el.on("click",".drawing-board-control-colors-picker",(function(e){var color=$(this).attr("data-color");that.board.setColor(color),that.$el.find(".drawing-board-control-colors-current").css("background-color",color).attr("data-color",color),that.board.ev.trigger("color:changed",color),that.$el.find(".drawing-board-control-colors-rainbows").addClass("drawing-board-utils-hidden"),e.preventDefault()})),this.$el.on("click",".drawing-board-control-colors-current",(function(e){that.$el.find(".drawing-board-control-colors-rainbows").toggleClass("drawing-board-utils-hidden"),e.preventDefault()})),$("body").on("click",(function(e){var $target=$(e.target),$relatedButton=$target.hasClass("drawing-board-control-colors-current")?$target:$target.closest(".drawing-board-control-colors-current"),$myButton=that.$el.find(".drawing-board-control-colors-current"),$popup=that.$el.find(".drawing-board-control-colors-rainbows");$relatedButton.length&&$relatedButton.get(0)===$myButton.get(0)||$popup.hasClass("drawing-board-utils-hidden")||$popup.addClass("drawing-board-utils-hidden")}))},initTemplate:function(){var oneColorTpl='<div class="drawing-board-control-colors-picker" data-color="{{color}}" style="background-color: {{color}}"></div>',rainbows="";$.each([.75,.5,.25],$.proxy((function(key,val){var i=0,additionalColor=null;for(rainbows+='<div class="drawing-board-control-colors-rainbow">',.25==val&&(additionalColor=this._rgba(0,0,0,1)),.5==val&&(additionalColor=this._rgba(150,150,150,1)),.75==val&&(additionalColor=this._rgba(255,255,255,1)),rainbows+=DrawingBoard.Utils.tpl(oneColorTpl,{color:additionalColor.toString()});i<=330;)rainbows+=DrawingBoard.Utils.tpl(oneColorTpl,{color:this._hsl2Rgba(this._hsl(i-60,1,val)).toString()}),i+=30;rainbows+="</div>"}),this)),this.$el.append($(DrawingBoard.Utils.tpl('<div class="drawing-board-control-inner"><div class="drawing-board-control-colors-current" style="background-color: {{color}}" data-color="{{color}}"></div><div class="drawing-board-control-colors-rainbows">{{rainbows}}</div></div>',{color:this.board.color,rainbows:rainbows}))),this.$el.find(".drawing-board-control-colors-rainbows").addClass("drawing-board-utils-hidden")},onBoardReset:function(opts){this.board.setColor(this.$el.find(".drawing-board-control-colors-current").attr("data-color"))},_rgba:function(r,g,b,a){return{r:r,g:g,b:b,a:a,toString:function(){return"rgba("+r+", "+g+", "+b+", "+a+")"}}},_hsl:function(h,s,l){return{h:h,s:s,l:l,toString:function(){return"hsl("+h+", "+100*s+"%, "+100*l+"%)"}}},_hex2Rgba:function(hex){var num=parseInt(hex.substring(1),16);return this._rgba(num>>16,num>>8&255,255&num,1)},_hsl2Rgba:function(hsl){var r,g,b,h=hsl.h/360,s=hsl.s,l=hsl.l;function hue2rgb(p,q,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?p+6*(q-p)*t:t<.5?q:t<2/3?p+(q-p)*(2/3-t)*6:p}if(0===s)r=g=b=l;else{var q=l<.5?l*(1+s):l+s-l*s,p=2*l-q;r=Math.floor(255*hue2rgb(p,q,h+1/3)),g=Math.floor(255*hue2rgb(p,q,h)),b=Math.floor(255*hue2rgb(p,q,h-1/3))}return this._rgba(r,g,b,1)}}),DrawingBoard.Control.DrawingMode=DrawingBoard.Control.extend({name:"drawingmode",defaults:{pencil:!0,eraser:!0,filler:!0},initialize:function(){this.prevMode=this.board.getMode(),$.each(["pencil","eraser","filler"],$.proxy((function(k,value){this.opts[value]&&this.$el.append('<button class="drawing-board-control-drawingmode-'+value+'-button" data-mode="'+value+'"></button>')}),this)),this.$el.on("click","button[data-mode]",$.proxy((function(e){var value=$(e.currentTarget).attr("data-mode"),mode=this.board.getMode();mode!==value&&(this.prevMode=mode);var newMode=mode===value?this.prevMode:value;this.board.setMode(newMode),e.preventDefault()}),this)),this.board.ev.bind("board:mode",$.proxy((function(mode){this.toggleButtons(mode)}),this)),this.toggleButtons(this.board.getMode())},toggleButtons:function(mode){this.$el.find("button[data-mode]").each((function(k,item){var $item=$(item);$item.toggleClass("active",mode===$item.attr("data-mode"))}))}}),DrawingBoard.Control.Navigation=DrawingBoard.Control.extend({name:"navigation",defaults:{back:!0,forward:!0,reset:!0},initialize:function(){var el="";if(this.opts.back&&(el+='<button class="drawing-board-control-navigation-back">&larr;</button>'),this.opts.forward&&(el+='<button class="drawing-board-control-navigation-forward">&rarr;</button>'),this.opts.reset&&(el+='<button class="drawing-board-control-navigation-reset">&times;</button>'),this.$el.append(el),this.opts.back){var $back=this.$el.find(".drawing-board-control-navigation-back");this.board.ev.bind("historyNavigation",$.proxy((function(pos){1===pos?$back.attr("disabled","disabled"):$back.removeAttr("disabled")}),this)),this.$el.on("click",".drawing-board-control-navigation-back",$.proxy((function(e){this.board.goBackInHistory(),e.preventDefault()}),this))}if(this.opts.forward){var $forward=this.$el.find(".drawing-board-control-navigation-forward");this.board.ev.bind("historyNavigation",$.proxy((function(pos){pos===this.board.history.values.length?$forward.attr("disabled","disabled"):$forward.removeAttr("disabled")}),this)),this.$el.on("click",".drawing-board-control-navigation-forward",$.proxy((function(e){this.board.goForthInHistory(),e.preventDefault()}),this))}this.opts.reset&&this.$el.on("click",".drawing-board-control-navigation-reset",$.proxy((function(e){this.board.reset({background:!0}),e.preventDefault()}),this))}}),DrawingBoard.Control.Size=DrawingBoard.Control.extend({name:"size",defaults:{type:"auto",dropdownValues:[1,3,6,10,20,30,40,50]},types:["dropdown","range"],initialize:function(){"auto"==this.opts.type&&(this.opts.type=this._iHasRangeInput()?"range":"dropdown");var tpl=$.inArray(this.opts.type,this.types)>-1&&this["_"+this.opts.type+"Template"]();if(!tpl)return!1;this.val=this.board.opts.size,this.$el.append($(tpl)),this.$el.attr("data-drawing-board-type",this.opts.type),this.updateView();var that=this;"range"==this.opts.type&&this.$el.on("change",".drawing-board-control-size-range-input",(function(e){that.val=$(this).val(),that.updateView(),that.board.ev.trigger("size:changed",that.val),e.preventDefault()})),"dropdown"==this.opts.type&&(this.$el.on("click",".drawing-board-control-size-dropdown-current",$.proxy((function(e){this.$el.find(".drawing-board-control-size-dropdown").toggleClass("drawing-board-utils-hidden")}),this)),this.$el.on("click","[data-size]",(function(e){that.val=parseInt($(this).attr("data-size"),0),that.updateView(),that.board.ev.trigger("size:changed",that.val),e.preventDefault()})))},_rangeTemplate:function(){return DrawingBoard.Utils.tpl('<div class="drawing-board-control-inner" title="{{size}}"><input type="range" min="1" max="50" value="{{size}}" step="1" class="drawing-board-control-size-range-input"><span class="drawing-board-control-size-range-current"></span></div>',{size:this.board.opts.size})},_dropdownTemplate:function(){var tpl='<div class="drawing-board-control-inner" title="{{size}}"><div class="drawing-board-control-size-dropdown-current"><span></span></div><ul class="drawing-board-control-size-dropdown">';return $.each(this.opts.dropdownValues,(function(i,size){tpl+=DrawingBoard.Utils.tpl('<li data-size="{{size}}"><span style="width: {{size}}px; height: {{size}}px; border-radius: {{size}}px;"></span></li>',{size:size})})),tpl+="</ul></div>"},onBoardReset:function(opts){this.updateView()},updateView:function(){var val=this.val;if(this.board.ctx.lineWidth=val,this.$el.find(".drawing-board-control-size-range-current, .drawing-board-control-size-dropdown-current span").css({width:val+"px",height:val+"px",borderRadius:val+"px",marginLeft:-1*val/2+"px",marginTop:-1*val/2+"px"}),this.$el.find(".drawing-board-control-inner").attr("title",val),"dropdown"==this.opts.type){var closest=null;$.each(this.opts.dropdownValues,(function(i,size){(null===closest||Math.abs(size-val)<Math.abs(closest-val))&&(closest=size)})),this.$el.find(".drawing-board-control-size-dropdown").addClass("drawing-board-utils-hidden")}},_iHasRangeInput:function(){var available,inputElem=document.createElement("input"),docElement=document.documentElement;return inputElem.setAttribute("type","range"),available="text"!==inputElem.type,inputElem.value=":)",inputElem.style.cssText="position:absolute;visibility:hidden;",/^range$/.test("range")&&void 0!==inputElem.style.WebkitAppearance&&(docElement.appendChild(inputElem),defaultView=document.defaultView,available=defaultView.getComputedStyle&&"textfield"!==defaultView.getComputedStyle(inputElem,null).WebkitAppearance&&0!==inputElem.offsetHeight,docElement.removeChild(inputElem)),!!available}}),DrawingBoard.Control.Download=DrawingBoard.Control.extend({name:"download",initialize:function(){this.$el.append('<button class="drawing-board-control-download-button"></button>'),this.$el.on("click",".drawing-board-control-download-button",$.proxy((function(e){this.board.downloadImg(),e.preventDefault()}),this))}}),DrawingBoard.Utils={},DrawingBoard.Utils.tpl=(pattern=new RegExp("{{\\s*([a-z0-9_][\\.a-z0-9_]*)\\s*}}","gi"),function(template,data){return template.replace(pattern,(function(tag,token){for(var path=token.split("."),len=path.length,lookup=data,i=0;i<len;i++){if(void 0===(lookup=lookup[path[i]]))throw"tim: '"+path[i]+"' not found in "+tag;if(i===len-1)return lookup}}))}),DrawingBoard.Utils.MicroEvent=function(){},DrawingBoard.Utils.MicroEvent.prototype={bind:function(event,fct){this._events=this._events||{},this._events[event]=this._events[event]||[],this._events[event].push(fct)},unbind:function(event,fct){this._events=this._events||{},event in this._events!=!1&&this._events[event].splice(this._events[event].indexOf(fct),1)},trigger:function(event){if(this._events=this._events||{},event in this._events!=!1)for(var i=0;i<this._events[event].length;i++)this._events[event][i].apply(this,Array.prototype.slice.call(arguments,1))}},DrawingBoard.Utils._boxBorderSize=function($el,withPadding,withMargin,direction){withPadding=!!withPadding||!0,withMargin=!!withMargin||!1;var props,width=0;"width"==direction?(props=["border-left-width","border-right-width"],withPadding&&props.push("padding-left","padding-right"),withMargin&&props.push("margin-left","margin-right")):(props=["border-top-width","border-bottom-width"],withPadding&&props.push("padding-top","padding-bottom"),withMargin&&props.push("margin-top","margin-bottom"));for(var i=props.length-1;i>=0;i--)width+=parseInt($el.css(props[i]).replace("px",""),10);return width},DrawingBoard.Utils.boxBorderWidth=function($el,withPadding,withMargin){return DrawingBoard.Utils._boxBorderSize($el,withPadding,withMargin,"width")},DrawingBoard.Utils.boxBorderHeight=function($el,withPadding,withMargin){return DrawingBoard.Utils._boxBorderSize($el,withPadding,withMargin,"height")},DrawingBoard.Utils.isColor=function(string){return!(!string||!string.length)&&(/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(string)||-1!==$.inArray(string.substring(0,3),["rgb","hsl"]))},DrawingBoard.Utils.RGBToInt=function(r,g,b){var c=0;return c|=(255&r)<<16,c|=(255&g)<<8,c|=255&b},DrawingBoard.Utils.pixelAt=function(image,x,y){var i=4*(y*image.width+x);return[i,x,y,DrawingBoard.Utils.RGBToInt(image.data[i],image.data[i+1],image.data[i+2])]},function(){for(var vendors=["ms","moz","webkit","o"],x=0;x<vendors.length&&!window.requestAnimationFrame;++x)window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"]}(),("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).DrawingBoard=DrawingBoard,DrawingBoard}));
define('filter_poodll/anim_progress_bar_fresh', ["jquery","core/log"],(function($,log){return log.debug("Bar Progress: initialising"),{waveroot:null,playcanvas:null,context:null,startx:null,starty:null,barwidth:null,barheight:null,enabled:!1,drawparams:{barColor:"#6DDC6F",textColor:"#fff",font:"12px Arial",textAlign:"center"},clone:function(){return $.extend(!0,{},this)},init:function(playcanvas){this.playcanvas=playcanvas.get(0),this.startx=0,this.starty=0,this.barwidth=this.playcanvas.width,this.barheight=this.playcanvas.height,this.context=this.playcanvas.getContext("2d")},test:function(analyser){var testAnalyser=analyser,bufferLength=testAnalyser.core.fftSize;new Uint8Array(bufferLength);console.log(testAnalyser)},readyBars:function(){var $waveRoot=$(".poodll_fresh_wave"),$waveProgress=$('<div class="poodll_fresh_progress_bar"><span></span></div>'),stickCount=$waveRoot.width()/4;stickCount.toFixed(),$waveRoot.empty();for(var i=0;i<stickCount;i++){var point=$('<div class="poodll_fresh_point"><div class="poodll_fresh_stick" style="height: 8px"></div></div>');$waveRoot.append(point)}$waveRoot.append($waveProgress)},playBars:function(currentTime,duration){var that=this,$waveRoot=$(".poodll_fresh_wave"),$waveProgress=$(".poodll_fresh_progress_bar"),stickCount=$waveRoot.width()/4;$waveRoot.attr("data-ct",currentTime).attr("data-duration",duration),stickCount.toFixed();var pointsCollection=$(".poodll_fresh_point");$.each(pointsCollection,(function(thepoint){pointsCollection[thepoint].children[0]&&(pointsCollection[thepoint].children[0].style.height="4px")}));!function draw(){var waveData=[];$.each(pointsCollection,(function(thepoint){var sampleData=Math.floor(50*Math.random()+4);waveData.push(sampleData);var pointHeight=waveData[i]||4;pointsCollection[thepoint].children[0].style.height=pointHeight+"px"})),$waveProgress.css("left",100*that.fetchCurrent()+"%");var requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;that.fetchCurrent()<1&&(console.log(that.fetchCurrent()),requestAnimationFrame(draw))}()},pauseBars:function(){},setDrawParam:function(paramkey,paramvalue){this.drawparams[paramkey]=paramvalue},clear:function(){this.context.clearRect(this.startx,this.starty,this.barwidth,this.barheight)},fetchCurrent:function(){return 0},stop:function(){this.enabled=!1,this.clear()},stopthere:function(){this.enabled=!1},start:function(){this.clear(),this.enabled=!0;var that=this;this.context.textAlign=this.drawparams.textAlign,this.context.font=this.drawparams.font;this.drawparams.textColor;!function draw(){that.enabled&&(that.clear(),that.context.fillStyle=that.drawparams.barColor,that.context.fillRect(that.startx,that.starty,that.fetchCurrent()*that.barwidth,that.barheight),(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame)(draw))}()}}}));
define('filter_poodll/hermes', ["jquery","core/log"],(function($,log){return log.debug("Hermes (the messenger) initialising"),{allowedURL:"",id:"",iframeembed:!1,enabled:!1,eventListeners:!1,clone:function(){return $.extend(!0,{},this)},init:function(id,allowedURL,iframeembed){this.allowedURL=allowedURL,this.id=id,this.iframeembed=iframeembed,this.enabled=!0,this.eventListeners=new Array,this.registerEvents()},disable:function(){this.enabled=!1},enable:function(){this.enabled=!0},on:function(type,handler){var listener=new Object;listener.type=type,listener.handler=handler,this.eventListeners.push(listener)},sendEvent:function(event){for(var i=0;i<this.eventListeners.length;i++)event.type==this.eventListeners[i].type&&this.eventListeners[i].handler(event)},postMessage:function(messageObject){this.enabled&&(messageObject.hasOwnProperty("type")?this.iframeembed&&(messageObject.id=this.id,window.parent.postMessage(messageObject,this.allowedURL)):log.debug('All message objects must have at least the "type" property'))},registerEvents:function(){var that=this;window.addEventListener("message",(function(e){if(null!=that.allowedURL&&0===that.allowedURL.indexOf(e.origin)){var data=e.data;data&&data.hasOwnProperty("id")&&data.id==that.id&&data.hasOwnProperty("type")&&that.sendEvent(e.data)}}))}}}));
define('filter_poodll/poodll_goldmediaskin', ["jquery","core/log","filter_poodll/utils_amd","filter_poodll/anim_progress_radial","filter_poodll/anim_hwave","filter_poodll/anim_fbars","filter_poodll/anim_ripple","filter_poodll/anim_words","filter_poodll/speech_poodll","filter_poodll/dlg_devicesettings"],(function($,log,utils,radialprogress,hwave,fbars,ripple,words,speechrecognition,settings){return log.debug("PoodLL Gold Skin: initialising"),{instanceprops:null,pmr:null,devsettings:null,therecanim:null,clone:function(){return $.extend(!0,{},this)},init:function(ip,pmr){this.instanceprops=ip,this.pmr=pmr,this.devsettings=settings.clone(),this.devsettings.init(pmr,ip)},fetch_instanceprops:function(){return this.instanceprops},onUploadSuccess:function(controlbarid){$("#"+controlbarid+" > .poodll_save-recording").hide(),$("#"+controlbarid+" > .poodll_savedsuccessfully").show()},onUploadFailure:function(controlbarid){},fetch_status_bar:function(skin){return'<div class="poodll_status_'+skin+'" width="320" height="50">00:00:00</div>'},fetch_preview_audio:function(skin){return'<audio class="poodll_preview_'+skin+' hide" playsinline="playsinline" muted></audio>'},fetch_preview_video:function(skin){return'<video class="poodll_preview_'+skin+'" width="320" height="240" playsinline="playsinline" muted></video>'},fetch_resource_audio:function(skin){return'<audio class="poodll_resourceplayer_'+skin+' hide" playsinline="playsinline"></audio>'},fetch_resource_video:function(skin){return'<video class="poodll_resourceplayer_'+skin+' hide" playsinline="playsinline"></video>'},fetch_uploader_skin:function(controlbarid,element){return!1},onMediaError:function(e){console.error("media error",e)},onMediaSuccess_video:function(controlbarid){this.fetch_instanceprops(controlbarid);this.set_visual_mode("recordingmode",controlbarid)},onMediaSuccess_audio:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.preview.attr("src",null),ip.uploader.Output(""),this.therecanim.start(),ip.timer.reset(),ip.timer.start(),this.update_status(controlbarid),this.set_visual_mode("recordingmode",controlbarid)},handle_timer_update:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.status.html(ip.timer.fetch_display_time()),0==ip.timer.seconds&&ip.timer.initseconds>0&&ip.controlbar.stopbutton.click()},update_status:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.status.html(ip.timer.fetch_display_time())},set_visual_mode:function(mode,controlbarid){var ip=this.fetch_instanceprops(controlbarid);switch(mode){case"startmode":this.enable_button(ip.controlbar.startbutton),this.disable_button(ip.controlbar.playbutton),this.disable_button(ip.controlbar.stopbutton),ip.showupload?this.disable_button(ip.controlbar.savebutton):ip.controlbar.savebutton.hide(),this.disable_button(ip.controlbar.restartbutton);break;case"recordingmode":this.enable_button(ip.controlbar.stopbutton),this.disable_button(ip.controlbar.startbutton),this.disable_button(ip.controlbar.playbutton),ip.showupload?this.disable_button(ip.controlbar.savebutton):ip.controlbar.savebutton.hide(),this.disable_button(ip.controlbar.restartbutton),"video"==ip.config.mediatype&&ip.controlbar.preview.removeClass("hide");break;case"previewmode":ip.showupload?(ip.controlbar.savebutton.removeClass("hide"),ip.controlbar.savebutton.removeClass("pmr_disabled"),ip.controlbar.savebutton.attr("disabled",!1)):(ip.controlbar.savebutton.hide(),"video"==ip.config.mediatype&&ip.controlbar.preview.addClass("hide")),ip.uploaded||(this.enable_button(ip.controlbar.startbutton),this.enable_button(ip.controlbar.restartbutton)),this.enable_button(ip.controlbar.stopbutton),this.enable_button(ip.controlbar.playbutton);break;case"playingmode":this.enable_button(ip.controlbar.stopbutton),"video"==ip.config.mediatype&&(this.enable_button(ip.controlbar.preview),ip.controlbar.preview.removeClass("hide")),this.disable_button(ip.controlbar.startbutton),this.disable_button(ip.controlbar.playbutton),this.disable_button(ip.controlbar.restartbutton)}},insert_controlbar_video:function(element,controlbarid,preview,resource){return this.prepare_controlbar(element,controlbarid,preview,resource,"video")},insert_controlbar_audio:function(element,controlbarid,preview,resource){return this.prepare_controlbar(element,controlbarid,preview,resource,"audio")},prepare_controlbar:function(element,controlbarid,preview,resource,mediatype){var ip=this.fetch_instanceprops(controlbarid),skin_style=ip.config.media_skin_style,recorder_class="video"==mediatype?"poodll_mediarecorder_video":"poodll_mediarecorder_audio";switch(ip.config.size){case"small":"poodll_mediarecorder_size_small";break;case"big":"poodll_mediarecorder_size_big";break;case"auto":"poodll_mediarecorder_size_auto"}var ss=this.pmr.fetch_strings(),controls='<div class="poodll_mediarecorderholder_gold '+recorder_class+'" id="holder_'+controlbarid+'">';controls+='<div class="poodll_mediarecorderbox_gold" id="'+controlbarid+'">',controls+=this.devsettings.fetch_dialogue_box(),controls+=ip.downloaddialog.fetch_dialogue_box(),controls+=ip.errordialog.fetch_dialogue_box(),controls+='<div class="style-holder '+skin_style+'">',controls+=this.fetch_status_bar("gold"),controls+=preview,controls+='<div class="settingsicon" id="settingsicon_'+controlbarid+'"><button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal"><i class="fa fa-cogs" aria-hidden="true"></i></button></div>',controls+='<canvas id="'+controlbarid+'_playcanvas"> width="250" height="250"></canvas>',controls+='<button type="button" class="poodll_mediarecorder_button_gold poodll_start-recording_gold"><i class="fa fa-microphone" aria-hidden="true"></i></button>',controls+='<button type="button" class="poodll_mediarecorder_button_gold poodll_stop-recording_gold"><i class="fa fa-stop" aria-hidden="true"></i></button>',controls+='<div class="gold-save-button-wrapper"><a class="btn btn-primary poodll_save-recording_gold">Upload</a></div>',controls+=' <button type="button" class="poodll_mediarecorder_button_gold poodll_play-recording_gold"><i class="fa fa-play" aria-hidden="true"></i></button>',controls+='<div class="gold-restart-button-wrapper"><a class="btn btn-success poodll_restart_gold " >'+ss.recui_restart+"</a></div>",controls+="</div></div></div>",$(element).prepend(controls);var controlbar={settingsdialog:$("#"+controlbarid+" .poodll_dialogue_box_settings"),downloaddialog:$("#"+controlbarid+" .poodll_dialogue_box_download"),errorsdialog:$("#"+controlbarid+" .poodll_dialogue_box_errors"),settingsicon:$("#"+controlbarid+" .settingsicon"),status:$("#"+controlbarid+" .poodll_status_gold"),preview:$("#"+controlbarid+" .poodll_preview_gold"),startbutton:$("#"+controlbarid+" .poodll_start-recording_gold"),stopbutton:$("#"+controlbarid+" .poodll_stop-recording_gold"),stopplayingbutton:$("#"+controlbarid+" .poodll_stop-playing_gold"),playbutton:$("#"+controlbarid+" .poodll_play-recording_gold"),savebutton:$("#"+controlbarid+" .poodll_save-recording_gold"),restartbutton:$("#"+controlbarid+" .poodll_restart_gold"),playcanvas:$("#"+controlbarid+"_playcanvas")};return ip.downloaddialog.set_dialogue_box(controlbar.downloaddialog),ip.errordialog.set_dialogue_box(controlbar.errorsdialog),this.devsettings.set_dialogue_box(controlbar.settingsdialog),controlbar},register_controlbar_events_video:function(onMediaSuccess,controlbarid){return this.register_controlbar_events_audio(onMediaSuccess,controlbarid)},register_controlbar_events_audio:function(onMediaSuccess,controlbarid){var self=this,pmr=this.pmr,ip=this.fetch_instanceprops(controlbarid);this.set_visual_mode("startmode",controlbarid);var rprogress=radialprogress.clone();rprogress.init(ip.controlbar.playcanvas);var recanim=null;switch(ip.config.recanim){case"hwave":recanim=hwave.clone();break;case"fbars":recanim=fbars.clone();break;case"ripple":recanim=ripple.clone();break;case"words":recanim=words.clone();break;default:ip.config.recanim="ripple";recanim=ripple.clone()}recanim.init(ip.audioanalyser,ip.controlbar.playcanvas.get(0)),ip.controlbar.settingsicon.click((function(){self.uploaded?ip.downloaddialog.open():self.devsettings.open()})),"video"==ip.config.mediatype&&ip.controlbar.preview.addClass("hide"),ip.controlbar.preview.click((function(){console.log("clicked preview"),$(this).addClass("hide"),$(ip.controlbar.stopbutton).trigger("click"),$(this).hasClass("recorded")?$(this).removeClass("recorded"):$(this).addClass("recorded")})),ip.controlbar.startbutton.click((function(){self.therecanim=recanim,pmr.do_start_audio(ip,onMediaSuccess)})),ip.controlbar.restartbutton.click((function(){self.set_visual_mode("startmode",controlbarid)})),ip.controlbar.stopbutton.click((function(){pmr.do_stop_audio(ip),ip.controlbar.preview.get(0).pause(),recanim.clear(),rprogress.stop(),ip.timer.stop(),self.update_status(controlbarid),self.set_visual_mode("previewmode",controlbarid)})),ip.controlbar.playbutton.click((function(){"video"==ip.config.mediatype&&$(ip.controlbar.preview).hasClass("recorder")&&($(ip.controlbar.preview).removeClass("recorder"),$(ip.controlbar.preview).removeClass("hide"));var preview=ip.controlbar.preview.get(0);pmr.do_play_audio(ip,preview),rprogress.clear(),rprogress.fetchCurrent=function(){var ct=ip.controlbar.preview.prop("currentTime"),duration=ip.controlbar.preview.prop("duration");return isFinite(duration)||(duration=ip.timer.finalseconds),ct/duration},rprogress.start(),self.set_visual_mode("playingmode",controlbarid)})),ip.controlbar.savebutton.click((function(){return ip.blobs&&ip.blobs.length>0?(pmr.do_save_audio(ip),ip.uploaded=!0,self.disable_button(ip.controlbar.startbutton)):ip.uploader.Output(M.util.get_string("recui_nothingtosaveerror","filter_poodll")),self.set_visual_mode("previewmode",controlbarid),!1})),window.onbeforeunload=function(){self.enable_button(ip.controlbar.startbutton);var preview=ip.controlbar.preview;preview&&preview.get(0)&&preview.get(0).pause()}},enable_button:function(button){$(button).attr("disabled",!1),$(button).removeClass("pmr_disabled")},disable_button:function(button){$(button).attr("disabled",!0),$(button).addClass("pmr_disabled")}}}));
define('filter_poodll/msr_whammy', ["jquery","core/log","filter_poodll/msr_helper_whammy"],function(a,b,c){"use strict";return b.debug("PoodLL MSR Whammy: initialising"),{timeout:0,mediaRecorder:null,mediaStream:null,msr:null,audioctx:null,mediaType:"video",clone:function(){return a.extend(!0,{},this)},init:function(a,b,c,d){this.msr=a,this.mediaStream=b,this.audioctx=c,this.mediaType=d},start:function(a,b){a=a||1e3;var d=this;this.mediaRecorder=c.clone(),this.mediaRecorder.init(this.msr,this.mediaStream,this.audioctx),this.mediaRecorder.record(),this.timeout=setInterval(function(){d.mediaRecorder.requestData()},a)},stop:function(){this.mediaRecorder&&(this.mediaRecorder.stop(),clearTimeout(this.timeout))},clearOldRecordedFrames:function(){this.mediaRecorder&&this.mediaRecorder.clearOldRecordedFrames()},pause:function(){this.mediaRecorder&&this.mediaRecorder.pause()},resume:function(){this.mediaRecorder&&this.mediaRecorder.resume()},ondataavailable:function(a){b.debug("ondataavailable:"+a)},onstop:function(a){b.debug(a)}}});
define('filter_poodll/poodll_whammy', ["jquery","core/log"],function(a,b){"use strict";function c(a){var b=URL.createObjectURL(new Blob([a.toString(),"this.onmessage =  function (e) {"+a.name+"(e.data);}"],{type:"application/javascript"})),c=new Worker(b);return URL.revokeObjectURL(b),c}function d(a){function b(a){var b=d(a);if(!b)return[];for(var e=3e4,f=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:m(b.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:b.width,id:176},{data:b.height,id:186}]}]}]}]}],g=0,i=0;g<a.length;){var j=[],k=0;do j.push(a[g]),k+=a[g].duration,g++;while(g<a.length&&k<e);var l=0,n={id:524531317,data:c(i,l,j)};f[1].data.push(n),i+=k}return h(f)}function c(a,b,c){return[{data:a,id:231}].concat(c.map(function(a){var c=i({discardable:0,frame:a.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(b)});return b+=a.duration,{data:c,id:163}}))}function d(a){if(!a[0])return void postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."});for(var b=a[0].width,c=a[0].height,d=a[0].duration,e=1;e<a.length;e++)d+=a[e].duration;return{duration:d,width:b,height:c}}function e(a){for(var b=[];a>0;)b.push(255&a),a>>=8;return new Uint8Array(b.reverse())}function f(a){return new Uint8Array(a.split("").map(function(a){return a.charCodeAt(0)}))}function g(a){var b=[],c=a.length%8?new Array(9-a.length%8).join("0"):"";a=c+a;for(var d=0;d<a.length;d+=8)b.push(parseInt(a.substr(d,8),2));return new Uint8Array(b)}function h(a){for(var b=[],c=0;c<a.length;c++){var d=a[c].data;"object"==typeof d&&(d=h(d)),"number"==typeof d&&(d=g(d.toString(2))),"string"==typeof d&&(d=f(d));var i=d.size||d.byteLength||d.length,j=Math.ceil(Math.ceil(Math.log(i)/Math.log(2))/8),k=i.toString(2),l=new Array(7*j+7+1-k.length).join("0")+k,m=new Array(j).join("0")+"1"+l;b.push(e(a[c].id)),b.push(g(m)),b.push(d)}return new Blob(b,{type:"video/webm"})}function i(a){var b=0;if(a.keyframe&&(b|=128),a.invisible&&(b|=8),a.lacing&&(b|=a.lacing<<1),a.discardable&&(b|=1),a.trackNum>127)throw"TrackNumber > 127 not supported";var c=[128|a.trackNum,a.timecode>>8,255&a.timecode,b].map(function(a){return String.fromCharCode(a)}).join("")+a.frame;return c}function j(a){for(var b=a.RIFF[0].WEBP[0],c=b.indexOf("*"),d=0,e=[];d<4;d++)e[d]=b.charCodeAt(c+3+d);var f,g,h;return h=e[1]<<8|e[0],f=16383&h,h=e[3]<<8|e[2],g=16383&h,{width:f,height:g,data:b,riff:a}}function k(a,b){return parseInt(a.substr(b+4,4).split("").map(function(a){var b=a.charCodeAt(0).toString(2);return new Array(8-b.length+1).join("0")+b}).join(""),2)}function l(a){for(var b=0,c={};b<a.length;){var d=a.substr(b,4),e=k(a,b),f=a.substr(b+4+4,e);b+=8+e,c[d]=c[d]||[],"RIFF"===d||"LIST"===d?c[d].push(l(f)):c[d].push(f)}return c}function m(a){return[].slice.call(new Uint8Array(new Float64Array([a]).buffer),0).map(function(a){return String.fromCharCode(a)}).reverse().join("")}var n=new b(a.map(function(a){var b=j(l(atob(a.image.slice(23))));return b.duration=a.duration,b}));postMessage(n)}b.debug("PoodLL Whammy: initialising");var e={};return e.init=function(a,b){this.frames=[],a||(a=1),this.duration=1e3/a,this.quality=b||.8},e.add=function(a,b){if("canvas"in a&&(a=a.canvas),"toDataURL"in a&&(a=a.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/gi.test(a))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:a,duration:b||this.duration})},e.compile=function(a){var b=c(d);b.onmessage=function(b){return b.data.error?void console.error(b.data.error):void a(b.data)},b.postMessage(this.frames)},{Video:e}});
var root,factory;root=window,factory=function(){var _SCAN_OFFSETS=[[124,186,248,310,372,434,496,558,620,682,744,806,868,930,992,1054,1116,1178,1240,1302,1364,1426,1488,0],[-100,-75,-50,-25,25,50,75,100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-20,-15,-10,-5,5,10,15,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-4,-3,-2,-1,1,2,3,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];function extend(a,b){for(var i in b){var g=b.__lookupGetter__(i),s=b.__lookupSetter__(i);g||s?(g&&a.__defineGetter__(i,g),s&&a.__defineSetter__(i,s)):a[i]=b[i]}return a}function testFloatEqual(a,b){return(a>b?a-b:b-a)>1e-10}function AbstractFifoSamplePipe(createBuffers){createBuffers?(this.inputBuffer=new FifoSampleBuffer,this.outputBuffer=new FifoSampleBuffer):this.inputBuffer=this.outputBuffer=null}function RateTransposer(createBuffers){AbstractFifoSamplePipe.call(this,createBuffers),this._reset(),this.rate=1}function FifoSampleBuffer(){this._vector=new Float32Array,this._position=0,this._frameCount=0}function SimpleFilter(sourceSound,pipe){this._pipe=pipe,this.sourceSound=sourceSound,this.historyBufferSize=22050,this._sourcePosition=0,this.outputBufferPosition=0,this._position=0}function Stretch(createBuffers,sampleRate){AbstractFifoSamplePipe.call(this,createBuffers),this.bQuickSeek=!0,this.bMidBufferDirty=!1,this.pMidBuffer=null,this.overlapLength=0,this.bAutoSeqSetting=!0,this.bAutoSeekSetting=!0,this._tempo=1,this.setParameters(sampleRate,0,0,8)}function SoundTouch(sampleRate){this.rateTransposer=new RateTransposer(!1),this.tdStretch=new Stretch(!1,sampleRate),this._inputBuffer=new FifoSampleBuffer,this._intermediateBuffer=new FifoSampleBuffer,this._outputBuffer=new FifoSampleBuffer,this._rate=0,this._tempo=0,this.virtualPitch=1,this.virtualRate=1,this.virtualTempo=1,this._calculateEffectiveRateAndTempo()}function WebAudioBufferSource(buffer){this.buffer=buffer}return AbstractFifoSamplePipe.prototype={get inputBuffer(){return this._inputBuffer},set inputBuffer(inputBuffer){this._inputBuffer=inputBuffer},get outputBuffer(){return this._outputBuffer},set outputBuffer(outputBuffer){this._outputBuffer=outputBuffer},clear:function(){this._inputBuffer.clear(),this._outputBuffer.clear()}},extend(RateTransposer.prototype,AbstractFifoSamplePipe.prototype),extend(RateTransposer.prototype,{set rate(rate){this._rate=rate},_reset:function(){this.slopeCount=0,this.prevSampleL=0,this.prevSampleR=0},process:function(){var numFrames=this._inputBuffer.frameCount;this._outputBuffer.ensureAdditionalCapacity(numFrames/this._rate+1);var numFramesOutput=this._transpose(numFrames);this._inputBuffer.receive(),this._outputBuffer.put(numFramesOutput)},_transpose:function(numFrames){if(0===numFrames)return 0;for(var src=this._inputBuffer.vector,srcOffset=this._inputBuffer.startIndex,dest=this._outputBuffer.vector,destOffset=this._outputBuffer.endIndex,used=0,i=0;this.slopeCount<1;)dest[destOffset+2*i]=(1-this.slopeCount)*this.prevSampleL+this.slopeCount*src[srcOffset],dest[destOffset+2*i+1]=(1-this.slopeCount)*this.prevSampleR+this.slopeCount*src[srcOffset+1],i++,this.slopeCount+=this._rate;if(this.slopeCount-=1,1!=numFrames)out:for(;;){for(;this.slopeCount>1;)if(this.slopeCount-=1,++used>=numFrames-1)break out;var srcIndex=srcOffset+2*used;dest[destOffset+2*i]=(1-this.slopeCount)*src[srcIndex]+this.slopeCount*src[srcIndex+2],dest[destOffset+2*i+1]=(1-this.slopeCount)*src[srcIndex+1]+this.slopeCount*src[srcIndex+3],i++,this.slopeCount+=this._rate}return this.prevSampleL=src[srcOffset+2*numFrames-2],this.prevSampleR=src[srcOffset+2*numFrames-1],i}}),FifoSampleBuffer.prototype={get vector(){return this._vector},get position(){return this._position},get startIndex(){return 2*this._position},get frameCount(){return this._frameCount},get endIndex(){return 2*(this._position+this._frameCount)},clear:function(frameCount){this.receive(frameCount),this.rewind()},put:function(numFrames){this._frameCount+=numFrames},putSamples:function(samples,position,numFrames){var sourceOffset=2*(position=position||0);numFrames>=0||(numFrames=(samples.length-sourceOffset)/2);var numSamples=2*numFrames;this.ensureCapacity(numFrames+this._frameCount);var destOffset=this.endIndex;this._vector.set(samples.subarray(sourceOffset,sourceOffset+numSamples),destOffset),this._frameCount+=numFrames},putBuffer:function(buffer,position,numFrames){position=position||0,numFrames>=0||(numFrames=buffer.frameCount-position),this.putSamples(buffer.vector,buffer.position+position,numFrames)},receive:function(numFrames){numFrames>=0&&!(numFrames>this._frameCount)||(numFrames=this._frameCount),this._frameCount-=numFrames,this._position+=numFrames},receiveSamples:function(output,numFrames){var numSamples=2*numFrames,sourceOffset=this.startIndex;output.set(this._vector.subarray(sourceOffset,sourceOffset+numSamples)),this.receive(numFrames)},extract:function(output,position,numFrames){var sourceOffset=this.startIndex+2*position,numSamples=2*numFrames;output.set(this._vector.subarray(sourceOffset,sourceOffset+numSamples))},ensureCapacity:function(numFrames){var minLength=2*numFrames;if(this._vector.length<minLength){var newVector=new Float32Array(minLength);newVector.set(this._vector.subarray(this.startIndex,this.endIndex)),this._vector=newVector,this._position=0}else this.rewind()},ensureAdditionalCapacity:function(numFrames){this.ensureCapacity(this.frameCount+numFrames)},rewind:function(){this._position>0&&(this._vector.set(this._vector.subarray(this.startIndex,this.endIndex)),this._position=0)}},SimpleFilter.prototype={get pipe(){return this._pipe},get position(){return this._position},set position(position){if(position>this._position)throw new RangeError("New position may not be greater than current position");var newOutputBufferPosition=this.outputBufferPosition-(this._position-position);if(newOutputBufferPosition<0)throw new RangeError("New position falls outside of history buffer");this.outputBufferPosition=newOutputBufferPosition,this._position=position},get sourcePosition(){return this._sourcePosition},set sourcePosition(sourcePosition){this.clear(),this._sourcePosition=sourcePosition},get inputBuffer(){return this._pipe.inputBuffer},get outputBuffer(){return this._pipe.outputBuffer},fillInputBuffer:function(numFrames){var samples=new Float32Array(2*numFrames),numFramesExtracted=this.sourceSound.extract(samples,numFrames,this._sourcePosition);this._sourcePosition+=numFramesExtracted,this.inputBuffer.putSamples(samples,0,numFramesExtracted)},fillOutputBuffer:function(numFrames){for(;this.outputBuffer.frameCount<numFrames;){var numInputFrames=16384-this.inputBuffer.frameCount;if(this.fillInputBuffer(numInputFrames),this.inputBuffer.frameCount<16384)break;this._pipe.process()}},extract:function(target,numFrames){this.fillOutputBuffer(this.outputBufferPosition+numFrames);var numFramesExtracted=Math.min(numFrames,this.outputBuffer.frameCount-this.outputBufferPosition);this.outputBuffer.extract(target,this.outputBufferPosition,numFramesExtracted);var currentFrames=this.outputBufferPosition+numFramesExtracted;return this.outputBufferPosition=Math.min(this.historyBufferSize,currentFrames),this.outputBuffer.receive(Math.max(currentFrames-this.historyBufferSize,0)),this._position+=numFramesExtracted,numFramesExtracted},handleSampleData:function(e){this.extract(e.data,4096)},clear:function(){this._pipe.clear(),this.outputBufferPosition=0}},extend(Stretch.prototype,AbstractFifoSamplePipe.prototype),extend(Stretch.prototype,{clear:function(){AbstractFifoSamplePipe.prototype.clear.call(this),this._clearMidBuffer()},_clearMidBuffer:function(){this.bMidBufferDirty&&(this.bMidBufferDirty=!1,this.pMidBuffer=null)},setParameters:function(aSampleRate,aSequenceMS,aSeekWindowMS,aOverlapMS){aSampleRate>0&&(this.sampleRate=aSampleRate),aOverlapMS>0&&(this.overlapMs=aOverlapMS),aSequenceMS>0?(this.sequenceMs=aSequenceMS,this.bAutoSeqSetting=!1):this.bAutoSeqSetting=!0,aSeekWindowMS>0?(this.seekWindowMs=aSeekWindowMS,this.bAutoSeekSetting=!1):this.bAutoSeekSetting=!0,this.calcSeqParameters(),this.calculateOverlapLength(this.overlapMs),this.tempo=this._tempo},set tempo(newTempo){var intskip;this._tempo=newTempo,this.calcSeqParameters(),this.nominalSkip=this._tempo*(this.seekWindowLength-this.overlapLength),this.skipFract=0,intskip=Math.floor(this.nominalSkip+.5),this.sampleReq=Math.max(intskip+this.overlapLength,this.seekWindowLength)+this.seekLength},get inputChunkSize(){return this.sampleReq},get outputChunkSize(){return this.overlapLength+Math.max(0,this.seekWindowLength-2*this.overlapLength)},calculateOverlapLength:function(overlapInMsec){var newOvl;(newOvl=this.sampleRate*overlapInMsec/1e3)<16&&(newOvl=16),newOvl-=newOvl%8,this.overlapLength=newOvl,this.pRefMidBuffer=new Float32Array(2*this.overlapLength),this.pMidBuffer=new Float32Array(2*this.overlapLength)},checkLimits:function(x,mi,ma){return x<mi?mi:x>ma?ma:x},calcSeqParameters:function(){var seq,seek;this.bAutoSeqSetting&&(seq=150+-50*this._tempo,seq=this.checkLimits(seq,50,125),this.sequenceMs=Math.floor(seq+.5)),this.bAutoSeekSetting&&(seek=28.333333333333332+-6.666666666666667*this._tempo,seek=this.checkLimits(seek,15,25),this.seekWindowMs=Math.floor(seek+.5)),this.seekWindowLength=Math.floor(this.sampleRate*this.sequenceMs/1e3),this.seekLength=Math.floor(this.sampleRate*this.seekWindowMs/1e3)},set quickSeek(enable){this.bQuickSeek=enable},seekBestOverlapPosition:function(){return this.bQuickSeek?this.seekBestOverlapPositionStereoQuick():this.seekBestOverlapPositionStereo()},seekBestOverlapPositionStereo:function(){var bestOffs,bestCorr,corr,i;for(this.precalcCorrReferenceStereo(),bestCorr=Number.MIN_VALUE,bestOffs=0,i=0;i<this.seekLength;i++)(corr=this.calcCrossCorrStereo(2*i,this.pRefMidBuffer))>bestCorr&&(bestCorr=corr,bestOffs=i);return bestOffs},seekBestOverlapPositionStereoQuick:function(){var j,bestOffs,bestCorr,corr,scanCount,corrOffset,tempOffset;for(this.precalcCorrReferenceStereo(),bestCorr=Number.MIN_VALUE,bestOffs=0,corrOffset=0,tempOffset=0,scanCount=0;scanCount<4;scanCount++){for(j=0;_SCAN_OFFSETS[scanCount][j]&&!((tempOffset=corrOffset+_SCAN_OFFSETS[scanCount][j])>=this.seekLength);)(corr=this.calcCrossCorrStereo(2*tempOffset,this.pRefMidBuffer))>bestCorr&&(bestCorr=corr,bestOffs=tempOffset),j++;corrOffset=bestOffs}return bestOffs},precalcCorrReferenceStereo:function(){var i,cnt2,temp;for(i=0;i<this.overlapLength;i++)temp=i*(this.overlapLength-i),cnt2=2*i,this.pRefMidBuffer[cnt2]=this.pMidBuffer[cnt2]*temp,this.pRefMidBuffer[cnt2+1]=this.pMidBuffer[cnt2+1]*temp},calcCrossCorrStereo:function(mixingPos,compare){var corr,i,mixingOffset,mixing=this._inputBuffer.vector;for(mixingPos+=this._inputBuffer.startIndex,corr=0,i=2;i<2*this.overlapLength;i+=2)corr+=mixing[mixingOffset=i+mixingPos]*compare[i]+mixing[mixingOffset+1]*compare[i+1];return corr},overlap:function(ovlPos){this.overlapStereo(2*ovlPos)},overlapStereo:function(pInputPos){var pInput=this._inputBuffer.vector;pInputPos+=this._inputBuffer.startIndex;var i,cnt2,fTemp,fScale,fi,pInputOffset,pOutputOffset,pOutput=this._outputBuffer.vector,pOutputPos=this._outputBuffer.endIndex;for(fScale=1/this.overlapLength,i=0;i<this.overlapLength;i++)fTemp=(this.overlapLength-i)*fScale,fi=i*fScale,pInputOffset=(cnt2=2*i)+pInputPos,pOutput[(pOutputOffset=cnt2+pOutputPos)+0]=pInput[pInputOffset+0]*fi+this.pMidBuffer[cnt2+0]*fTemp,pOutput[pOutputOffset+1]=pInput[pInputOffset+1]*fi+this.pMidBuffer[cnt2+1]*fTemp},process:function(){var ovlSkip,offset,temp;if(null===this.pMidBuffer){if(this._inputBuffer.frameCount<this.overlapLength)return;this.pMidBuffer=new Float32Array(2*this.overlapLength),this._inputBuffer.receiveSamples(this.pMidBuffer,this.overlapLength)}for(;this._inputBuffer.frameCount>=this.sampleReq;){offset=this.seekBestOverlapPosition(),this._outputBuffer.ensureAdditionalCapacity(this.overlapLength),this.overlap(Math.floor(offset)),this._outputBuffer.put(this.overlapLength),(temp=this.seekWindowLength-2*this.overlapLength)>0&&this._outputBuffer.putBuffer(this._inputBuffer,offset+this.overlapLength,temp);var start=this.inputBuffer.startIndex+2*(offset+this.seekWindowLength-this.overlapLength);this.pMidBuffer.set(this._inputBuffer.vector.subarray(start,start+2*this.overlapLength)),this.skipFract+=this.nominalSkip,ovlSkip=Math.floor(this.skipFract),this.skipFract-=ovlSkip,this._inputBuffer.receive(ovlSkip)}}}),extend(Stretch.prototype,{get tempo(){return this._tempo}}),SoundTouch.prototype={clear:function(){this.rateTransposer.clear(),this.tdStretch.clear()},get rate(){return this._rate},set rate(rate){this.virtualRate=rate,this._calculateEffectiveRateAndTempo()},set rateChange(rateChange){this.rate=1+.01*rateChange},get tempo(){return this._tempo},set tempo(tempo){this.virtualTempo=tempo,this._calculateEffectiveRateAndTempo()},set tempoChange(tempoChange){this.tempo=1+.01*tempoChange},set pitch(pitch){this.virtualPitch=pitch,this._calculateEffectiveRateAndTempo()},set pitchOctaves(pitchOctaves){this.pitch=Math.exp(.69314718056*pitchOctaves),this._calculateEffectiveRateAndTempo()},set pitchSemitones(pitchSemitones){this.pitchOctaves=pitchSemitones/12},get inputBuffer(){return this._inputBuffer},get outputBuffer(){return this._outputBuffer},_calculateEffectiveRateAndTempo:function(){var previousTempo=this._tempo,previousRate=this._rate;this._tempo=this.virtualTempo/this.virtualPitch,this._rate=this.virtualRate*this.virtualPitch,testFloatEqual(this._tempo,previousTempo)&&(this.tdStretch.tempo=this._tempo),testFloatEqual(this._rate,previousRate)&&(this.rateTransposer.rate=this._rate),this._rate>1?this._outputBuffer!=this.rateTransposer.outputBuffer&&(this.tdStretch.inputBuffer=this._inputBuffer,this.tdStretch.outputBuffer=this._intermediateBuffer,this.rateTransposer.inputBuffer=this._intermediateBuffer,this.rateTransposer.outputBuffer=this._outputBuffer):this._outputBuffer!=this.tdStretch.outputBuffer&&(this.rateTransposer.inputBuffer=this._inputBuffer,this.rateTransposer.outputBuffer=this._intermediateBuffer,this.tdStretch.inputBuffer=this._intermediateBuffer,this.tdStretch.outputBuffer=this._outputBuffer)},process:function(){this._rate>1?(this.tdStretch.process(),this.rateTransposer.process()):(this.rateTransposer.process(),this.tdStretch.process())}},WebAudioBufferSource.prototype={extract:function(target,numFrames,position){for(var l=this.buffer.getChannelData(0),r=this.buffer.getChannelData(1),i=0;i<numFrames;i++)target[2*i]=l[i+position],target[2*i+1]=r[i+position];return Math.min(numFrames,l.length-position)}},soundtouch={RateTransposer:RateTransposer,Stretch:Stretch,SimpleFilter:SimpleFilter,SoundTouch:SoundTouch,WebAudioBufferSource:WebAudioBufferSource,getWebAudioNode:function(context,filter){var node=context.createScriptProcessor(4096,2,2),samples=new Float32Array(8192);return node.onaudioprocess=function(e){var l=e.outputBuffer.getChannelData(0),r=e.outputBuffer.getChannelData(1),framesExtracted=filter.extract(samples,4096);0===framesExtracted&&node.disconnect();for(var i=0;i<framesExtracted;i++)l[i]=samples[2*i],r[i]=samples[2*i+1]},node}}},"function"==typeof define&&define.amd?define("filter_poodll/soundtouch",[],(function(){return factory()})):root.CloudPoodll=factory();
define('filter_poodll/uploader', ["jquery","core/log","filter_poodll/upskin_plain"],(function($,log,upskin_plain){return log.debug("Universal Uploader: initialising"),{config:null,clone:function(){return $.extend(!0,{},this)},init:function(element,config,upskin){this.config=config,upskin?this.upskin=upskin:(this.upskin=upskin_plain.clone(),this.upskin.init(config,element,!1,!1)),this.upskin.initControls(),this.registerEvents()},registerEvents:function(){var that=this;this.config.hermes&&this.config.hermes.on("fetch_upload_url",(function(e){that.fetchNewUploadDetails()}))},fetchNewUploadDetails:function(){var xhr=new XMLHttpRequest,that=this;xhr.onreadystatechange=function(e){if(4===this.readyState)if(200==xhr.status){var payload=xhr.responseText,payloadobject=JSON.parse(payload);if(payloadobject){if(payloadobject.returnCode>0){var messageObject={};return messageObject.id=that.config.id,messageObject.type="error",messageObject.code=payloadobject.returnCode,messageObject.message=payloadobject.returnMessage,void that.config.hermes.postMessage(messageObject)}that.config.allowedURL=payloadobject.allowedURL,that.config.posturl=payloadobject.postURL,that.config.filename=payloadobject.filename,that.config.s3filename=payloadobject.s3filename,that.config.s3root=payloadobject.s3root,that.config.cloudfilename=payloadobject.shortfilename,that.config.cloudroot=payloadobject.shortroot}else log.debug("error:"+payloadobject.message)}else log.debug("Not 200 response:"+xhr.status)};var xhrparams="wstoken="+this.config.wstoken+"&wsfunction=local_cpapi_fetch_upload_details&moodlewsrestformat="+this.config.moodlewsrestformat+"&mediatype="+this.config.mediatype+"&parent="+this.config.parent+"&appid="+this.config.appid+"&owner="+this.config.owner+"&region="+this.config.region+"&expiredays="+this.config.expiredays+"&transcode="+this.config.transcode+"&transcoder="+this.config.transcoder+"&transcribe="+this.config.transcribe+"&subtitle="+this.config.subtitle+"&transcribelanguage="+this.config.language+"&transcribevocab="+this.config.transcribevocab+"&notificationurl="+this.config.notificationurl+"&sourcemimetype="+this.config.sourcemimetype,serverurl=M.cfg.wwwroot+"/webservice/rest/server.php";xhr.open("POST",serverurl,!0),xhr.setRequestHeader("Cache-Control","no-cache"),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.send(xhrparams)},uploadBlob:function(blob,filetype){this.uploadFile(blob,filetype)},extractFilename:function(returntext){var start=returntext.indexOf("success<filename>");if(start<1)return!1;var end=returntext.indexOf("</filename>");return returntext.substring(start+"success<filename>".length,end)},fetchFileExtension:function(filetype){var ext="";switch(filetype.indexOf(";")>0&&(filetype=filetype.split(";")[0]),filetype){case"image/jpeg":ext="jpg";break;case"image/png":ext="png";break;case"audio/wav":ext="wav";break;case"audio/ogg":case"video/ogg":ext="ogg";break;case"audio/mpeg3":case"audio/mp3":case"audio/x-mpeg-3":ext="mp3";break;case"audio/webm":case"video/x-matroska":case"video/webm":ext="webm";break;case"audio/wma":ext="wma";break;case"audio/mp4":case"audio/m4a":case"audio/x-m4a":ext="m4a";break;case"audio/3gpp":case"video/mpeg3":ext="3gpp";break;case"video/m4v":ext="m4v";break;case"video/mp4":ext="mp4";break;case"video/mov":case"video/quicktime":ext="mov";break;case"video/wmv":ext="wmv"}return""===ext&&(ext=filetype.indexOf("video")>-1?"mp4":"mp3"),ext},pokeFilename:function(filename,uploader){var upc="";return void 0!==uploader.config.updatecontrol&&""!==uploader.config.updatecontrol&&(upc=$('[id="'+uploader.config.updatecontrol+'"]')),upc.length<1&&(upc=$('[id="'+uploader.config.updatecontrol+'"]',window.parent.document)),upc.length>0?(upc.get(0).value=filename,upc.trigger("change"),!0):(log.debug("upload failed #2"),uploader.upskin.showMessage(M.util.get_string("recui_uploaderror","filter_poodll"),"recui_uploaderror"),!1)},alertRecorderSuccess:function(widgetid){this.config.hasOwnProperty("onuploadsuccess")&&this.config.onuploadsuccess(widgetid)},alertRecorderFailure:function(widgetid){this.config.hasOwnProperty("onuploadfailure")&&this.config.onuploadfailure(widgetid)},completeAfterProcessing:function(uploader,filename,waitms){this.upskin.showMessage(M.util.get_string("recui_awaitingconversion","filter_poodll"),"recui_awaitingconversion"),uploader.config.iframeembed&&(filename=uploader.config.s3root+uploader.config.s3filename);var messageObject={type:"awaitingprocessing"};messageObject.mediaurl=filename,messageObject.mediafilename=uploader.config.s3filename,messageObject.sourcefilename=uploader.config.sourcefilename,messageObject.sourcemimetype=uploader.config.sourcemimetype,messageObject.s3root=uploader.config.s3root,messageObject.id=uploader.config.id,messageObject.updatecontrol=uploader.config.updatecontrol,uploader.config.transcribe&&(messageObject.transcripturl=filename+".txt",messageObject.transcriptfilename=uploader.config.s3filename+".txt"),uploader.config.hermes.postMessage(messageObject);var that=this;$.ajax({url:uploader.config.s3root+uploader.config.s3filename,method:"HEAD",cache:!1,error:function(){log.debug("403 errors are normal here, till the file arrives back from conversion"),setTimeout((function(){that.completeAfterProcessing(uploader,filename,waitms+500)}),waitms)},success:function(data,textStatus,xhr){if(200===xhr.status)that.doUploadCompleteCallback(uploader,filename);else setTimeout((function(){that.completeAfterProcessing(uploader,filename,waitms+500)}),waitms)}})},doUploadCompleteCallback:function(uploader,filename){uploader.config.iframeembed&&(filename=uploader.config.s3root+uploader.config.s3filename);var callbackObject=new Array;if(callbackObject[0]=uploader.config.widgetid,callbackObject[1]="filesubmitted",callbackObject[2]=filename,callbackObject[3]=uploader.config.updatecontrol,callbackObject[4]=uploader.config.s3filename,this.upskin.showMessage(M.util.get_string("recui_uploadsuccess","filter_poodll"),"recui_uploadsuccess"),uploader.config.iframeembed){var messageObject={type:"filesubmitted"};messageObject.mediaurl=uploader.config.s3root+uploader.config.s3filename,messageObject.mediafilename=uploader.config.s3filename,messageObject.sourcefilename=uploader.config.sourcefilename,messageObject.sourcemimetype=uploader.config.sourcemimetype,messageObject.s3root=uploader.config.s3root,messageObject.id=uploader.config.id,messageObject.updatecontrol=uploader.config.updatecontrol,uploader.config.transcribe&&(messageObject.transcripturl=uploader.config.s3root+uploader.config.s3filename+".txt",messageObject.transcriptfilename=uploader.config.s3filename+".txt"),uploader.config.hermes.postMessage(messageObject)}else uploader.config.callbackjs&&""!=uploader.config.callbackjs?"function"==typeof uploader.config.callbackjs?uploader.config.callbackjs(callbackObject):this.executeFunctionByName(uploader.config.callbackjs,window,callbackObject):uploader.pokeFilename(filename,uploader)},postProcessUpload:function(e,uploader){var xhr=e.currentTarget;if(4==xhr.readyState)if(uploader.upskin.deactivateProgressSession(),$(window).off("beforeunload",this.preventPrematureLeaving),200==xhr.status){var filename=uploader.config.filename;if(filename||(filename=uploader.extractFilename(xhr.responseText)),!filename)return log.debug("upload failed #1"),void log.debug(xhr);uploader.config.iframeembed?this.completeAfterProcessing(uploader,filename,1e3):this.doUploadCompleteCallback(uploader,filename),this.alertRecorderSuccess(uploader.config.widgetid)}else log.debug("upload failed #3"),log.debug(xhr),uploader.upskin.showMessage(M.util.get_string("recui_uploaderror","filter_poodll"),"recui_uploaderror"),this.alertRecorderFailure(uploader.config.widgetid)},preventPrematureLeaving:function(){return M.util.get_string("recui_waitwaitstilluploading","filter_poodll")},uploadFile:function(filedata,sourcemimetype){var xhr=new XMLHttpRequest,config=this.config,uploader=this,sourceext=this.fetchFileExtension(sourcemimetype);void 0===config.iframeembed&&(config.iframeembed=!1);var using_s3=config.using_s3;if(this.upskin.initProgressSession(xhr),$(window).on("beforeunload",this.preventPrematureLeaving),this.upskin.showMessage(M.util.get_string("recui_uploading","filter_poodll"),"recui_uploading"),uploader.config.sourcemimetype=sourcemimetype,uploader.config.sourcefilename=uploader.config.s3filename,xhr.onreadystatechange=function(e){using_s3&&4===this.readyState&&(config.iframeembed?uploader.update_filenames(uploader,sourceext):uploader.postprocess_s3_upload(uploader)),uploader.postProcessUpload(e,uploader)},using_s3)xhr.open("put",config.posturl,!0),xhr.setRequestHeader("Content-Type","application/octet-stream"),xhr.send(filedata);else if(filedata instanceof Blob){log.debug("filedata is blob");var reader=new window.FileReader;reader.readAsDataURL(filedata),reader.onloadend=function(){var base64filedata=reader.result,params="datatype=uploadfile";params+="&paramone="+encodeURIComponent(base64filedata),params+="&paramtwo="+sourceext,params+="&paramthree="+config.mediatype,params+="&requestid="+config.widgetid,params+="&contextid="+config.p2,params+="&component="+config.p3,params+="&filearea="+config.p4,params+="&itemid="+config.p5,xhr.open("POST",config.posturl,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.setRequestHeader("Cache-Control","no-cache"),xhr.send(params)}}else{log.debug("filedata is not blob");var params="datatype=uploadfile";params+="&paramone="+encodeURIComponent(filedata),params+="&paramtwo="+sourceext,params+="&paramthree="+config.mediatype,params+="&requestid="+config.widgetid,params+="&contextid="+config.p2,params+="&component="+config.p3,params+="&filearea="+config.p4,params+="&itemid="+config.p5,xhr.open("POST",config.posturl,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.setRequestHeader("Cache-Control","no-cache"),xhr.send(params)}},uploadMultiPartFile:function(filedata,sourcemimetype){var xhr=new XMLHttpRequest,config=this.config,uploader=this,sourceext=this.fetchFileExtension(sourcemimetype);void 0===config.iframeembed&&(config.iframeembed=!1);var using_s3=config.using_s3;this.upskin.initProgressSession(xhr),$(window).on("beforeunload",this.preventPrematureLeaving),this.upskin.showMessage(M.util.get_string("recui_uploading","filter_poodll"),"recui_uploading"),uploader.config.sourcemimetype=sourcemimetype,uploader.config.sourcefilename=uploader.config.s3filename,xhr.onreadystatechange=function(e){using_s3&&4===this.readyState&&(config.iframeembed?uploader.update_filenames(uploader,sourceext):uploader.postprocess_s3_upload(uploader)),uploader.postProcessUpload(e,uploader)},using_s3&&(xhr.open("put",config.posturl,!0),xhr.setRequestHeader("Content-Type","application/octet-stream"),xhr.send(filedata))},update_filenames:function(uploader,sourceext){var config=uploader.config;switch(config.mediatype){case"audio":uploader.config.sourcefilename=config.s3filename.replace(".mp3","."+sourceext),config.transcode||(uploader.config.s3filename=uploader.config.sourcefilename,uploader.config.cloudfilename=uploader.config.s3filename);break;case"video":uploader.config.sourcefilename=config.s3filename.replace(".mp4","."+sourceext),config.transcode||(uploader.config.s3filename=uploader.config.sourcefilename)}},postprocess_s3_upload:function(uploader){var config=uploader.config,formData=new FormData;formData.append("datatype","handles3upload"),formData.append("contextid",config.p2),formData.append("component",config.p3),formData.append("filearea",config.p4),formData.append("itemid",config.p5),formData.append("filename",config.filename),formData.append("mediatype",config.mediatype),navigator.sendBeacon||(navigator.sendBeacon=function(url,thedata){window.fetch(url,{method:"POST",body:thedata,credentials:"include"})}),navigator.sendBeacon(M.cfg.wwwroot+"/filter/poodll/poodllfilelib.php",formData)},executeFunctionByName:function(functionName,context,args){for(var namespaces=functionName.split("."),func=namespaces.pop(),i=0;i<namespaces.length;i++)context=context[namespaces[i]];return context[func].call(this,args)},dataURItoBlob:function(dataURI,mimetype){for(var byteString=atob(dataURI.split(",")[1]),ab=new ArrayBuffer(byteString.length),ia=new Uint8Array(ab),i=0;i<byteString.length;i++)ia[i]=byteString.charCodeAt(i);return new Blob([ab],{type:mimetype})},Output:function(msg){this.upskin.showMessage(msg,"recorderskinmsg")}}}));
define('filter_poodll/anim_ripple', ["jquery","core/log"],(function($,log){return log.debug("anim_ripple: initialising"),{analyser:null,cvs:null,cvsctx:null,drawparams:{rippleColor:"#0",lineWidth:2},clone:function(){return $.extend(!0,{},this)},init:function(analyser,cvs){this.cvs=cvs,this.cvsctx=cvs.getContext("2d"),this.analyser=analyser},setDrawParam:function(paramkey,paramvalue){this.drawparams[paramkey]=paramvalue},clear:function(){this.cvsctx.clearRect(0,0,this.cvs.width,this.cvs.height)},start:function(){this.analyser.core.fftSize=2048;var bufferLength=this.analyser.core.fftSize,dataArray=new Uint8Array(bufferLength),cwidth=this.cvs.width,cheight=this.cvs.height,canvasCtx=this.cvsctx,analyser=this.analyser;this.clear();var that=this;!function draw(){requestAnimationFrame(draw);if(analyser.theinterval){analyser.core.getByteTimeDomainData(dataArray),canvasCtx.clearRect(0,0,cwidth,cheight),canvasCtx.lineWidth=that.drawparams.lineWidth,canvasCtx.setLineDash([15,5]),canvasCtx.strokeStyle=that.drawparams.rippleColor,canvasCtx.beginPath();if(bufferLength>0)var stepsize=1+bufferLength/5;for(var i=0;i<bufferLength;i+=stepsize){var radius=50+dataArray[i]/128*(cheight-100)/4;canvasCtx.arc(cwidth/2,cheight/2,radius,0,2*Math.PI)}canvasCtx.stroke()}}()}}}));
define('filter_poodll/react_amd', ["jquery","core/log","filter_poodll/react-with-addons"],(function($,log,React){return log.debug("Filter PoodLL: revealjs initialising"),window.React=React,{}}));
define('filter_poodll/dlg_poodll', ["jquery","core/log"],(function($,log){return log.debug("Poodll Dialog: initialising"),{dlgbox:null,headertext:"",init:function(){},clone:function(){return $.extend(!0,{},this)},setHeader:function(headertext){this.headertext=headertext},setContent:function(content){this.clear(),this.dlgbox.append(content)},clear:function(){this.dlgbox.children().last().remove()},open:function(){this.dlgbox.slideDown(400)},close:function(){this.dlgbox.slideUp(400)},onclose:function(){},test:function(){log.debug("hio")},fetch_dialogue_box:function(dialogtype){var ret='<div class="poodll_dialogue_box poodll_dialogue_box_'+dialogtype+' hide"><div class="poodll_close_modal">';return ret+='<i class="fa fa-window-close" aria-hidden="true"></div></i>',ret+='<div class="poodll_dialogue_content"><strong>'+this.headertext+"</strong></div>",ret+='<div class="will_be_cleared"></div></div>'},set_dialogue_box:function(dlgbox){this.dlgbox=dlgbox;var that=this;dlgbox.find(".poodll_close_modal").click((function(){that.close()}))}}}));
define('filter_poodll/poodllrecorder', ["jquery","core/log","filter_poodll/poodll_flashrecorder","filter_poodll/poodll_mediarecorder","filter_poodll/poodll_uploadrecorder","filter_poodll/poodll_mobilerecorder","filter_poodll/poodll_flashsnapshotrecorder","filter_poodll/poodll_snapshotrecorder","filter_poodll/poodll_red5recorder"],(function($,log,flashrec,mediarec,uploadrec,mobilerec,flashsnapshot,snapshot,red5){return log.debug("PoodLL Recorder: initialising"),{init:function(config){var theid="#amdopts_"+config.widgetid,configcontrol=$(theid).get(0);if(configcontrol){this.config=JSON.parse(configcontrol.value),$(theid).remove(),this.config.wwwroot=M.cfg.wwwroot,this.config.sesskey=M.cfg.sesskey;var element=this.config.selector;if(element){for(var use_rec=!1,i=0;i<this.config.rec_order.length;i++){switch(this.config.rec_order[i]){case"red5":use_rec=red5;break;case"flashaudio":use_rec=flashrec;break;case"media":use_rec=mediarec;break;case"upload":use_rec=uploadrec;break;case"mobile":use_rec=mobilerec;break;case"flashsnapshot":use_rec=flashsnapshot;break;case"snapshot":use_rec=snapshot}if(use_rec.supports_current_browser(this.config))return void use_rec.embed(element,this.config)}log.debug("none of available recorders works on this browser")}else log.debug("unable to fetch element with selector:"+this.config.selector)}else log.debug("PoodLL Recorder: No config found on page. Giving up.")}}}));
define('filter_poodll/util_dragdrop', ["jquery","core/log"],(function($,log){return log.debug("Poodll util drag drop: initialising"),{theelement:!1,uploadfunction:!1,uploader:!1,started:!1,filebutton:!1,init:function(element,uploadfunction,ip){this.theelement=element,this.uploadfunction=uploadfunction,this.uploader=ip.uploader,this.filebutton=ip.controlbar.filebutton,this.supports_dragdrop(element)?(log.debug("registering drag drop"),this.register_dragdrop(),this.do_visuals()):log.debug("drag drop not supported")},clone:function(){return $.extend(!0,{},this)},supports_dragdrop:function(element){return"draggable"in element||"ondragstart"in element&&"ondrop"in element},do_visuals:function(){this.theelement.addClass("poodll-can-do-drag-drop")},turnoff_dragdrop:function(){this.theelement&&(this.theelement.removeClass("poodll-can-do-drag-drop"),this.theelement.removeClass("is-poodll-drag-over"),this.theelement.off("drag dragstart dragend dragover dragenter dragleave drop"),this.theelement.on("drag dragstart dragend dragover dragenter dragleave drop",(function(e){e.preventDefault(),e.stopPropagation()})))},register_dragdrop:function(){var that=this;this.theelement.on("drag dragstart dragend dragover dragenter dragleave drop",(function(e){e.preventDefault(),e.stopPropagation(),that.started})).on("dragover dragenter",(function(){that.theelement.addClass("is-poodll-drag-over")})).on("dragleave dragend drop",(function(){that.theelement.removeClass("is-poodll-drag-over")})).on("drop",(function(e){if(!that.started){var files=e.originalEvent.dataTransfer.files;that.uploadfunction(files,that.uploader),that.turnoff_dragdrop(),that.filebutton.off("change"),that.filebutton.attr("disabled",!0),that.started=!0}}))}}}));
define('filter_poodll/modal_dialogue', ["jquery","core/log","filter_poodll/dlg_devicesettings"],(function($,log,dlg_setting){return log.debug("Modal Progress: initialising"),{init:function(){},fetch_icon:function(controlbarid){return'<div class="setting" id="setting_'+controlbarid+'"><button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal"><i class="fa fa-cogs" aria-hidden="true"></i></button></div>'},test:function(){console.log(dlg_setting.init())},fetch_dialogue_box:function(visibility){return'<div class="poodll_dialogue_box '+visibility+'"><div class="poodll_close_modal"><i class="fa fa-window-close" aria-hidden="true"></div></i><div class="poodll_dialogue_content"><p>Poodll Dialogue box</p></div></div>'}}}));
/**
 * JavaScript library for the pairwork module.
 *
 * @package    filter
 * @subpackage poodll
 * @copyright  2017 Justin Hunt http://www.poodll.com
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define('filter_poodll/poodll_qrscanner', ["jquery","core/log"],(function($,log){log.debug("poodll_qrscanner is now loaded");var GridSampler={};function ECB(count,dataCodewords){this.count=count,this.dataCodewords=dataCodewords,this.__defineGetter__("Count",(function(){return this.count})),this.__defineGetter__("DataCodewords",(function(){return this.dataCodewords}))}function ECBlocks(ecCodewordsPerBlock,ecBlocks1,ecBlocks2){this.ecCodewordsPerBlock=ecCodewordsPerBlock,this.ecBlocks=ecBlocks2?new Array(ecBlocks1,ecBlocks2):new Array(ecBlocks1),this.__defineGetter__("ECCodewordsPerBlock",(function(){return this.ecCodewordsPerBlock})),this.__defineGetter__("TotalECCodewords",(function(){return this.ecCodewordsPerBlock*this.NumBlocks})),this.__defineGetter__("NumBlocks",(function(){for(var total=0,i=0;i<this.ecBlocks.length;i++)total+=this.ecBlocks[i].length;return total})),this.getECBlocks=function(){return this.ecBlocks}}function Version(versionNumber,alignmentPatternCenters,ecBlocks1,ecBlocks2,ecBlocks3,ecBlocks4){this.versionNumber=versionNumber,this.alignmentPatternCenters=alignmentPatternCenters,this.ecBlocks=new Array(ecBlocks1,ecBlocks2,ecBlocks3,ecBlocks4);for(var total=0,ecCodewords=ecBlocks1.ECCodewordsPerBlock,ecbArray=ecBlocks1.getECBlocks(),i=0;i<ecbArray.length;i++){var ecBlock=ecbArray[i];total+=ecBlock.Count*(ecBlock.DataCodewords+ecCodewords)}this.totalCodewords=total,this.__defineGetter__("VersionNumber",(function(){return this.versionNumber})),this.__defineGetter__("AlignmentPatternCenters",(function(){return this.alignmentPatternCenters})),this.__defineGetter__("TotalCodewords",(function(){return this.totalCodewords})),this.__defineGetter__("DimensionForVersion",(function(){return 17+4*this.versionNumber})),this.buildFunctionPattern=function(){var dimension=this.DimensionForVersion,bitMatrix=new BitMatrix(dimension);bitMatrix.setRegion(0,0,9,9),bitMatrix.setRegion(dimension-8,0,8,9),bitMatrix.setRegion(0,dimension-8,9,8);for(var max=this.alignmentPatternCenters.length,x=0;x<max;x++)for(var i=this.alignmentPatternCenters[x]-2,y=0;y<max;y++)0==x&&(0==y||y==max-1)||x==max-1&&0==y||bitMatrix.setRegion(this.alignmentPatternCenters[y]-2,i,5,5);return bitMatrix.setRegion(6,9,1,dimension-17),bitMatrix.setRegion(9,6,dimension-17,1),this.versionNumber>6&&(bitMatrix.setRegion(dimension-11,0,3,6),bitMatrix.setRegion(0,dimension-11,6,3)),bitMatrix},this.getECBlocksForLevel=function(ecLevel){return this.ecBlocks[ecLevel.ordinal()]}}function PerspectiveTransform(a11,a21,a31,a12,a22,a32,a13,a23,a33){this.a11=a11,this.a12=a12,this.a13=a13,this.a21=a21,this.a22=a22,this.a23=a23,this.a31=a31,this.a32=a32,this.a33=a33,this.transformPoints1=function(points){for(var max=points.length,a11=this.a11,a12=this.a12,a13=this.a13,a21=this.a21,a22=this.a22,a23=this.a23,a31=this.a31,a32=this.a32,a33=this.a33,i=0;i<max;i+=2){var x=points[i],y=points[i+1],denominator=a13*x+a23*y+a33;points[i]=(a11*x+a21*y+a31)/denominator,points[i+1]=(a12*x+a22*y+a32)/denominator}},this.transformPoints2=function(xValues,yValues){for(var n=xValues.length,i=0;i<n;i++){var x=xValues[i],y=yValues[i],denominator=this.a13*x+this.a23*y+this.a33;xValues[i]=(this.a11*x+this.a21*y+this.a31)/denominator,yValues[i]=(this.a12*x+this.a22*y+this.a32)/denominator}},this.buildAdjoint=function(){return new PerspectiveTransform(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)},this.times=function(other){return new PerspectiveTransform(this.a11*other.a11+this.a21*other.a12+this.a31*other.a13,this.a11*other.a21+this.a21*other.a22+this.a31*other.a23,this.a11*other.a31+this.a21*other.a32+this.a31*other.a33,this.a12*other.a11+this.a22*other.a12+this.a32*other.a13,this.a12*other.a21+this.a22*other.a22+this.a32*other.a23,this.a12*other.a31+this.a22*other.a32+this.a32*other.a33,this.a13*other.a11+this.a23*other.a12+this.a33*other.a13,this.a13*other.a21+this.a23*other.a22+this.a33*other.a23,this.a13*other.a31+this.a23*other.a32+this.a33*other.a33)}}function DetectorResult(bits,points){this.bits=bits,this.points=points}function Detector(image){this.image=image,this.resultPointCallback=null,this.sizeOfBlackWhiteBlackRun=function(fromX,fromY,toX,toY){var steep=Math.abs(toY-fromY)>Math.abs(toX-fromX);if(steep){var temp=fromX;fromX=fromY,fromY=temp,temp=toX,toX=toY,toY=temp}for(var dx=Math.abs(toX-fromX),dy=Math.abs(toY-fromY),error=-dx>>1,ystep=fromY<toY?1:-1,xstep=fromX<toX?1:-1,state=0,x=fromX,y=fromY;x!=toX;x+=xstep){var realX=steep?y:x,realY=steep?x:y;if(1==state?this.image[realX+realY*qrcode.width]&&state++:this.image[realX+realY*qrcode.width]||state++,3==state){var diffX=x-fromX,diffY=y-fromY;return Math.sqrt(diffX*diffX+diffY*diffY)}if((error+=dy)>0){if(y==toY)break;y+=ystep,error-=dx}}var diffX2=toX-fromX,diffY2=toY-fromY;return Math.sqrt(diffX2*diffX2+diffY2*diffY2)},this.sizeOfBlackWhiteBlackRunBothWays=function(fromX,fromY,toX,toY){var result=this.sizeOfBlackWhiteBlackRun(fromX,fromY,toX,toY),scale=1,otherToX=fromX-(toX-fromX);otherToX<0?(scale=fromX/(fromX-otherToX),otherToX=0):otherToX>=qrcode.width&&(scale=(qrcode.width-1-fromX)/(otherToX-fromX),otherToX=qrcode.width-1);var otherToY=Math.floor(fromY-(toY-fromY)*scale);return scale=1,otherToY<0?(scale=fromY/(fromY-otherToY),otherToY=0):otherToY>=qrcode.height&&(scale=(qrcode.height-1-fromY)/(otherToY-fromY),otherToY=qrcode.height-1),otherToX=Math.floor(fromX+(otherToX-fromX)*scale),(result+=this.sizeOfBlackWhiteBlackRun(fromX,fromY,otherToX,otherToY))-1},this.calculateModuleSizeOneWay=function(pattern,otherPattern){var moduleSizeEst1=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(pattern.X),Math.floor(pattern.Y),Math.floor(otherPattern.X),Math.floor(otherPattern.Y)),moduleSizeEst2=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(otherPattern.X),Math.floor(otherPattern.Y),Math.floor(pattern.X),Math.floor(pattern.Y));return isNaN(moduleSizeEst1)?moduleSizeEst2/7:isNaN(moduleSizeEst2)?moduleSizeEst1/7:(moduleSizeEst1+moduleSizeEst2)/14},this.calculateModuleSize=function(topLeft,topRight,bottomLeft){return(this.calculateModuleSizeOneWay(topLeft,topRight)+this.calculateModuleSizeOneWay(topLeft,bottomLeft))/2},this.distance=function(pattern1,pattern2){var xDiff=pattern1.X-pattern2.X,yDiff=pattern1.Y-pattern2.Y;return Math.sqrt(xDiff*xDiff+yDiff*yDiff)},this.computeDimension=function(topLeft,topRight,bottomLeft,moduleSize){var dimension=7+(Math.round(this.distance(topLeft,topRight)/moduleSize)+Math.round(this.distance(topLeft,bottomLeft)/moduleSize)>>1);switch(3&dimension){case 0:dimension++;break;case 2:dimension--;break;case 3:throw"Error"}return dimension},this.findAlignmentInRegion=function(overallEstModuleSize,estAlignmentX,estAlignmentY,allowanceFactor){var allowance=Math.floor(allowanceFactor*overallEstModuleSize),alignmentAreaLeftX=Math.max(0,estAlignmentX-allowance),alignmentAreaRightX=Math.min(qrcode.width-1,estAlignmentX+allowance);if(alignmentAreaRightX-alignmentAreaLeftX<3*overallEstModuleSize)throw"Error";var alignmentAreaTopY=Math.max(0,estAlignmentY-allowance),alignmentAreaBottomY=Math.min(qrcode.height-1,estAlignmentY+allowance);return new AlignmentPatternFinder(this.image,alignmentAreaLeftX,alignmentAreaTopY,alignmentAreaRightX-alignmentAreaLeftX,alignmentAreaBottomY-alignmentAreaTopY,overallEstModuleSize,this.resultPointCallback).find()},this.createTransform=function(topLeft,topRight,bottomLeft,alignmentPattern,dimension){var bottomRightX,bottomRightY,sourceBottomRightX,sourceBottomRightY,dimMinusThree=dimension-3.5;return null!=alignmentPattern?(bottomRightX=alignmentPattern.X,bottomRightY=alignmentPattern.Y,sourceBottomRightX=sourceBottomRightY=dimMinusThree-3):(bottomRightX=topRight.X-topLeft.X+bottomLeft.X,bottomRightY=topRight.Y-topLeft.Y+bottomLeft.Y,sourceBottomRightX=sourceBottomRightY=dimMinusThree),PerspectiveTransform.quadrilateralToQuadrilateral(3.5,3.5,dimMinusThree,3.5,sourceBottomRightX,sourceBottomRightY,3.5,dimMinusThree,topLeft.X,topLeft.Y,topRight.X,topRight.Y,bottomRightX,bottomRightY,bottomLeft.X,bottomLeft.Y)},this.sampleGrid=function(image,transform,dimension){return GridSampler.sampleGrid3(image,dimension,transform)},this.processFinderPatternInfo=function(info){var topLeft=info.TopLeft,topRight=info.TopRight,bottomLeft=info.BottomLeft,moduleSize=this.calculateModuleSize(topLeft,topRight,bottomLeft);if(moduleSize<1)throw"Error";var dimension=this.computeDimension(topLeft,topRight,bottomLeft,moduleSize),provisionalVersion=Version.getProvisionalVersionForDimension(dimension),modulesBetweenFPCenters=provisionalVersion.DimensionForVersion-7,alignmentPattern=null;if(provisionalVersion.AlignmentPatternCenters.length>0)for(var bottomRightX=topRight.X-topLeft.X+bottomLeft.X,bottomRightY=topRight.Y-topLeft.Y+bottomLeft.Y,correctionToTopLeft=1-3/modulesBetweenFPCenters,estAlignmentX=Math.floor(topLeft.X+correctionToTopLeft*(bottomRightX-topLeft.X)),estAlignmentY=Math.floor(topLeft.Y+correctionToTopLeft*(bottomRightY-topLeft.Y)),i=4;i<=16;i<<=1){alignmentPattern=this.findAlignmentInRegion(moduleSize,estAlignmentX,estAlignmentY,i);break}var transform=this.createTransform(topLeft,topRight,bottomLeft,alignmentPattern,dimension);return new DetectorResult(this.sampleGrid(this.image,transform,dimension),null==alignmentPattern?new Array(bottomLeft,topLeft,topRight):new Array(bottomLeft,topLeft,topRight,alignmentPattern))},this.detect=function(){var info=(new FinderPatternFinder).findFinderPattern(this.image);return this.processFinderPatternInfo(info)}}GridSampler.checkAndNudgePoints=function(image,points){for(var width=qrcode.width,height=qrcode.height,nudged=!0,offset=0;offset<points.length&&nudged;offset+=2){var x=Math.floor(points[offset]),y=Math.floor(points[offset+1]);if(x<-1||x>width||y<-1||y>height)throw"Error.checkAndNudgePoints ";nudged=!1,-1==x?(points[offset]=0,nudged=!0):x==width&&(points[offset]=width-1,nudged=!0),-1==y?(points[offset+1]=0,nudged=!0):y==height&&(points[offset+1]=height-1,nudged=!0)}nudged=!0;for(offset=points.length-2;offset>=0&&nudged;offset-=2){x=Math.floor(points[offset]),y=Math.floor(points[offset+1]);if(x<-1||x>width||y<-1||y>height)throw"Error.checkAndNudgePoints ";nudged=!1,-1==x?(points[offset]=0,nudged=!0):x==width&&(points[offset]=width-1,nudged=!0),-1==y?(points[offset+1]=0,nudged=!0):y==height&&(points[offset+1]=height-1,nudged=!0)}},GridSampler.sampleGrid3=function(image,dimension,transform){for(var bits=new BitMatrix(dimension),points=new Array(dimension<<1),y=0;y<dimension;y++){for(var max=points.length,iValue=y+.5,x=0;x<max;x+=2)points[x]=.5+(x>>1),points[x+1]=iValue;transform.transformPoints1(points),GridSampler.checkAndNudgePoints(image,points);try{for(x=0;x<max;x+=2){image[Math.floor(points[x])+qrcode.width*Math.floor(points[x+1])]&&bits.set_Renamed(x>>1,y)}}catch(aioobe){throw"Error.checkAndNudgePoints"}}return bits},GridSampler.sampleGridx=function(image,dimension,p1ToX,p1ToY,p2ToX,p2ToY,p3ToX,p3ToY,p4ToX,p4ToY,p1FromX,p1FromY,p2FromX,p2FromY,p3FromX,p3FromY,p4FromX,p4FromY){var transform=PerspectiveTransform.quadrilateralToQuadrilateral(p1ToX,p1ToY,p2ToX,p2ToY,p3ToX,p3ToY,p4ToX,p4ToY,p1FromX,p1FromY,p2FromX,p2FromY,p3FromX,p3FromY,p4FromX,p4FromY);return GridSampler.sampleGrid3(image,dimension,transform)},Version.VERSION_DECODE_INFO=new Array(31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017),Version.VERSIONS=new Array(new Version(1,new Array,new ECBlocks(7,new ECB(1,19)),new ECBlocks(10,new ECB(1,16)),new ECBlocks(13,new ECB(1,13)),new ECBlocks(17,new ECB(1,9))),new Version(2,new Array(6,18),new ECBlocks(10,new ECB(1,34)),new ECBlocks(16,new ECB(1,28)),new ECBlocks(22,new ECB(1,22)),new ECBlocks(28,new ECB(1,16))),new Version(3,new Array(6,22),new ECBlocks(15,new ECB(1,55)),new ECBlocks(26,new ECB(1,44)),new ECBlocks(18,new ECB(2,17)),new ECBlocks(22,new ECB(2,13))),new Version(4,new Array(6,26),new ECBlocks(20,new ECB(1,80)),new ECBlocks(18,new ECB(2,32)),new ECBlocks(26,new ECB(2,24)),new ECBlocks(16,new ECB(4,9))),new Version(5,new Array(6,30),new ECBlocks(26,new ECB(1,108)),new ECBlocks(24,new ECB(2,43)),new ECBlocks(18,new ECB(2,15),new ECB(2,16)),new ECBlocks(22,new ECB(2,11),new ECB(2,12))),new Version(6,new Array(6,34),new ECBlocks(18,new ECB(2,68)),new ECBlocks(16,new ECB(4,27)),new ECBlocks(24,new ECB(4,19)),new ECBlocks(28,new ECB(4,15))),new Version(7,new Array(6,22,38),new ECBlocks(20,new ECB(2,78)),new ECBlocks(18,new ECB(4,31)),new ECBlocks(18,new ECB(2,14),new ECB(4,15)),new ECBlocks(26,new ECB(4,13),new ECB(1,14))),new Version(8,new Array(6,24,42),new ECBlocks(24,new ECB(2,97)),new ECBlocks(22,new ECB(2,38),new ECB(2,39)),new ECBlocks(22,new ECB(4,18),new ECB(2,19)),new ECBlocks(26,new ECB(4,14),new ECB(2,15))),new Version(9,new Array(6,26,46),new ECBlocks(30,new ECB(2,116)),new ECBlocks(22,new ECB(3,36),new ECB(2,37)),new ECBlocks(20,new ECB(4,16),new ECB(4,17)),new ECBlocks(24,new ECB(4,12),new ECB(4,13))),new Version(10,new Array(6,28,50),new ECBlocks(18,new ECB(2,68),new ECB(2,69)),new ECBlocks(26,new ECB(4,43),new ECB(1,44)),new ECBlocks(24,new ECB(6,19),new ECB(2,20)),new ECBlocks(28,new ECB(6,15),new ECB(2,16))),new Version(11,new Array(6,30,54),new ECBlocks(20,new ECB(4,81)),new ECBlocks(30,new ECB(1,50),new ECB(4,51)),new ECBlocks(28,new ECB(4,22),new ECB(4,23)),new ECBlocks(24,new ECB(3,12),new ECB(8,13))),new Version(12,new Array(6,32,58),new ECBlocks(24,new ECB(2,92),new ECB(2,93)),new ECBlocks(22,new ECB(6,36),new ECB(2,37)),new ECBlocks(26,new ECB(4,20),new ECB(6,21)),new ECBlocks(28,new ECB(7,14),new ECB(4,15))),new Version(13,new Array(6,34,62),new ECBlocks(26,new ECB(4,107)),new ECBlocks(22,new ECB(8,37),new ECB(1,38)),new ECBlocks(24,new ECB(8,20),new ECB(4,21)),new ECBlocks(22,new ECB(12,11),new ECB(4,12))),new Version(14,new Array(6,26,46,66),new ECBlocks(30,new ECB(3,115),new ECB(1,116)),new ECBlocks(24,new ECB(4,40),new ECB(5,41)),new ECBlocks(20,new ECB(11,16),new ECB(5,17)),new ECBlocks(24,new ECB(11,12),new ECB(5,13))),new Version(15,new Array(6,26,48,70),new ECBlocks(22,new ECB(5,87),new ECB(1,88)),new ECBlocks(24,new ECB(5,41),new ECB(5,42)),new ECBlocks(30,new ECB(5,24),new ECB(7,25)),new ECBlocks(24,new ECB(11,12),new ECB(7,13))),new Version(16,new Array(6,26,50,74),new ECBlocks(24,new ECB(5,98),new ECB(1,99)),new ECBlocks(28,new ECB(7,45),new ECB(3,46)),new ECBlocks(24,new ECB(15,19),new ECB(2,20)),new ECBlocks(30,new ECB(3,15),new ECB(13,16))),new Version(17,new Array(6,30,54,78),new ECBlocks(28,new ECB(1,107),new ECB(5,108)),new ECBlocks(28,new ECB(10,46),new ECB(1,47)),new ECBlocks(28,new ECB(1,22),new ECB(15,23)),new ECBlocks(28,new ECB(2,14),new ECB(17,15))),new Version(18,new Array(6,30,56,82),new ECBlocks(30,new ECB(5,120),new ECB(1,121)),new ECBlocks(26,new ECB(9,43),new ECB(4,44)),new ECBlocks(28,new ECB(17,22),new ECB(1,23)),new ECBlocks(28,new ECB(2,14),new ECB(19,15))),new Version(19,new Array(6,30,58,86),new ECBlocks(28,new ECB(3,113),new ECB(4,114)),new ECBlocks(26,new ECB(3,44),new ECB(11,45)),new ECBlocks(26,new ECB(17,21),new ECB(4,22)),new ECBlocks(26,new ECB(9,13),new ECB(16,14))),new Version(20,new Array(6,34,62,90),new ECBlocks(28,new ECB(3,107),new ECB(5,108)),new ECBlocks(26,new ECB(3,41),new ECB(13,42)),new ECBlocks(30,new ECB(15,24),new ECB(5,25)),new ECBlocks(28,new ECB(15,15),new ECB(10,16))),new Version(21,new Array(6,28,50,72,94),new ECBlocks(28,new ECB(4,116),new ECB(4,117)),new ECBlocks(26,new ECB(17,42)),new ECBlocks(28,new ECB(17,22),new ECB(6,23)),new ECBlocks(30,new ECB(19,16),new ECB(6,17))),new Version(22,new Array(6,26,50,74,98),new ECBlocks(28,new ECB(2,111),new ECB(7,112)),new ECBlocks(28,new ECB(17,46)),new ECBlocks(30,new ECB(7,24),new ECB(16,25)),new ECBlocks(24,new ECB(34,13))),new Version(23,new Array(6,30,54,74,102),new ECBlocks(30,new ECB(4,121),new ECB(5,122)),new ECBlocks(28,new ECB(4,47),new ECB(14,48)),new ECBlocks(30,new ECB(11,24),new ECB(14,25)),new ECBlocks(30,new ECB(16,15),new ECB(14,16))),new Version(24,new Array(6,28,54,80,106),new ECBlocks(30,new ECB(6,117),new ECB(4,118)),new ECBlocks(28,new ECB(6,45),new ECB(14,46)),new ECBlocks(30,new ECB(11,24),new ECB(16,25)),new ECBlocks(30,new ECB(30,16),new ECB(2,17))),new Version(25,new Array(6,32,58,84,110),new ECBlocks(26,new ECB(8,106),new ECB(4,107)),new ECBlocks(28,new ECB(8,47),new ECB(13,48)),new ECBlocks(30,new ECB(7,24),new ECB(22,25)),new ECBlocks(30,new ECB(22,15),new ECB(13,16))),new Version(26,new Array(6,30,58,86,114),new ECBlocks(28,new ECB(10,114),new ECB(2,115)),new ECBlocks(28,new ECB(19,46),new ECB(4,47)),new ECBlocks(28,new ECB(28,22),new ECB(6,23)),new ECBlocks(30,new ECB(33,16),new ECB(4,17))),new Version(27,new Array(6,34,62,90,118),new ECBlocks(30,new ECB(8,122),new ECB(4,123)),new ECBlocks(28,new ECB(22,45),new ECB(3,46)),new ECBlocks(30,new ECB(8,23),new ECB(26,24)),new ECBlocks(30,new ECB(12,15),new ECB(28,16))),new Version(28,new Array(6,26,50,74,98,122),new ECBlocks(30,new ECB(3,117),new ECB(10,118)),new ECBlocks(28,new ECB(3,45),new ECB(23,46)),new ECBlocks(30,new ECB(4,24),new ECB(31,25)),new ECBlocks(30,new ECB(11,15),new ECB(31,16))),new Version(29,new Array(6,30,54,78,102,126),new ECBlocks(30,new ECB(7,116),new ECB(7,117)),new ECBlocks(28,new ECB(21,45),new ECB(7,46)),new ECBlocks(30,new ECB(1,23),new ECB(37,24)),new ECBlocks(30,new ECB(19,15),new ECB(26,16))),new Version(30,new Array(6,26,52,78,104,130),new ECBlocks(30,new ECB(5,115),new ECB(10,116)),new ECBlocks(28,new ECB(19,47),new ECB(10,48)),new ECBlocks(30,new ECB(15,24),new ECB(25,25)),new ECBlocks(30,new ECB(23,15),new ECB(25,16))),new Version(31,new Array(6,30,56,82,108,134),new ECBlocks(30,new ECB(13,115),new ECB(3,116)),new ECBlocks(28,new ECB(2,46),new ECB(29,47)),new ECBlocks(30,new ECB(42,24),new ECB(1,25)),new ECBlocks(30,new ECB(23,15),new ECB(28,16))),new Version(32,new Array(6,34,60,86,112,138),new ECBlocks(30,new ECB(17,115)),new ECBlocks(28,new ECB(10,46),new ECB(23,47)),new ECBlocks(30,new ECB(10,24),new ECB(35,25)),new ECBlocks(30,new ECB(19,15),new ECB(35,16))),new Version(33,new Array(6,30,58,86,114,142),new ECBlocks(30,new ECB(17,115),new ECB(1,116)),new ECBlocks(28,new ECB(14,46),new ECB(21,47)),new ECBlocks(30,new ECB(29,24),new ECB(19,25)),new ECBlocks(30,new ECB(11,15),new ECB(46,16))),new Version(34,new Array(6,34,62,90,118,146),new ECBlocks(30,new ECB(13,115),new ECB(6,116)),new ECBlocks(28,new ECB(14,46),new ECB(23,47)),new ECBlocks(30,new ECB(44,24),new ECB(7,25)),new ECBlocks(30,new ECB(59,16),new ECB(1,17))),new Version(35,new Array(6,30,54,78,102,126,150),new ECBlocks(30,new ECB(12,121),new ECB(7,122)),new ECBlocks(28,new ECB(12,47),new ECB(26,48)),new ECBlocks(30,new ECB(39,24),new ECB(14,25)),new ECBlocks(30,new ECB(22,15),new ECB(41,16))),new Version(36,new Array(6,24,50,76,102,128,154),new ECBlocks(30,new ECB(6,121),new ECB(14,122)),new ECBlocks(28,new ECB(6,47),new ECB(34,48)),new ECBlocks(30,new ECB(46,24),new ECB(10,25)),new ECBlocks(30,new ECB(2,15),new ECB(64,16))),new Version(37,new Array(6,28,54,80,106,132,158),new ECBlocks(30,new ECB(17,122),new ECB(4,123)),new ECBlocks(28,new ECB(29,46),new ECB(14,47)),new ECBlocks(30,new ECB(49,24),new ECB(10,25)),new ECBlocks(30,new ECB(24,15),new ECB(46,16))),new Version(38,new Array(6,32,58,84,110,136,162),new ECBlocks(30,new ECB(4,122),new ECB(18,123)),new ECBlocks(28,new ECB(13,46),new ECB(32,47)),new ECBlocks(30,new ECB(48,24),new ECB(14,25)),new ECBlocks(30,new ECB(42,15),new ECB(32,16))),new Version(39,new Array(6,26,54,82,110,138,166),new ECBlocks(30,new ECB(20,117),new ECB(4,118)),new ECBlocks(28,new ECB(40,47),new ECB(7,48)),new ECBlocks(30,new ECB(43,24),new ECB(22,25)),new ECBlocks(30,new ECB(10,15),new ECB(67,16))),new Version(40,new Array(6,30,58,86,114,142,170),new ECBlocks(30,new ECB(19,118),new ECB(6,119)),new ECBlocks(28,new ECB(18,47),new ECB(31,48)),new ECBlocks(30,new ECB(34,24),new ECB(34,25)),new ECBlocks(30,new ECB(20,15),new ECB(61,16)))),Version.getVersionForNumber=function(versionNumber){if(versionNumber<1||versionNumber>40)throw"ArgumentException";return Version.VERSIONS[versionNumber-1]},Version.getProvisionalVersionForDimension=function(dimension){if(dimension%4!=1)throw"Error getProvisionalVersionForDimension";try{return Version.getVersionForNumber(dimension-17>>2)}catch(iae){throw"Error getVersionForNumber"}},Version.decodeVersionInformation=function(versionBits){for(var bestDifference=4294967295,bestVersion=0,i=0;i<Version.VERSION_DECODE_INFO.length;i++){var targetVersion=Version.VERSION_DECODE_INFO[i];if(targetVersion==versionBits)return this.getVersionForNumber(i+7);var bitsDifference=FormatInformation.numBitsDiffering(versionBits,targetVersion);bitsDifference<bestDifference&&(bestVersion=i+7,bestDifference=bitsDifference)}return bestDifference<=3?this.getVersionForNumber(bestVersion):null},PerspectiveTransform.quadrilateralToQuadrilateral=function(x0,y0,x1,y1,x2,y2,x3,y3,x0p,y0p,x1p,y1p,x2p,y2p,x3p,y3p){var qToS=this.quadrilateralToSquare(x0,y0,x1,y1,x2,y2,x3,y3);return this.squareToQuadrilateral(x0p,y0p,x1p,y1p,x2p,y2p,x3p,y3p).times(qToS)},PerspectiveTransform.squareToQuadrilateral=function(x0,y0,x1,y1,x2,y2,x3,y3){var dy2=y3-y2,dy3=y0-y1+y2-y3;if(0==dy2&&0==dy3)return new PerspectiveTransform(x1-x0,x2-x1,x0,y1-y0,y2-y1,y0,0,0,1);var dx1=x1-x2,dx2=x3-x2,dx3=x0-x1+x2-x3,dy1=y1-y2,denominator=dx1*dy2-dx2*dy1,a13=(dx3*dy2-dx2*dy3)/denominator,a23=(dx1*dy3-dx3*dy1)/denominator;return new PerspectiveTransform(x1-x0+a13*x1,x3-x0+a23*x3,x0,y1-y0+a13*y1,y3-y0+a23*y3,y0,a13,a23,1)},PerspectiveTransform.quadrilateralToSquare=function(x0,y0,x1,y1,x2,y2,x3,y3){return this.squareToQuadrilateral(x0,y0,x1,y1,x2,y2,x3,y3).buildAdjoint()};var FORMAT_INFO_DECODE_LOOKUP=new Array(new Array(21522,0),new Array(20773,1),new Array(24188,2),new Array(23371,3),new Array(17913,4),new Array(16590,5),new Array(20375,6),new Array(19104,7),new Array(30660,8),new Array(29427,9),new Array(32170,10),new Array(30877,11),new Array(26159,12),new Array(25368,13),new Array(27713,14),new Array(26998,15),new Array(5769,16),new Array(5054,17),new Array(7399,18),new Array(6608,19),new Array(1890,20),new Array(597,21),new Array(3340,22),new Array(2107,23),new Array(13663,24),new Array(12392,25),new Array(16177,26),new Array(14854,27),new Array(9396,28),new Array(8579,29),new Array(11994,30),new Array(11245,31)),BITS_SET_IN_HALF_BYTE=new Array(0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,4);function FormatInformation(formatInfo){this.errorCorrectionLevel=ErrorCorrectionLevel.forBits(formatInfo>>3&3),this.dataMask=7&formatInfo,this.__defineGetter__("ErrorCorrectionLevel",(function(){return this.errorCorrectionLevel})),this.__defineGetter__("DataMask",(function(){return this.dataMask})),this.GetHashCode=function(){return this.errorCorrectionLevel.ordinal()<<3|this.dataMask},this.Equals=function(o){var other=o;return this.errorCorrectionLevel==other.errorCorrectionLevel&&this.dataMask==other.dataMask}}function ErrorCorrectionLevel(ordinal,bits,name){this.ordinal_Renamed_Field=ordinal,this.bits=bits,this.name=name,this.__defineGetter__("Bits",(function(){return this.bits})),this.__defineGetter__("Name",(function(){return this.name})),this.ordinal=function(){return this.ordinal_Renamed_Field}}FormatInformation.numBitsDiffering=function(a,b){return BITS_SET_IN_HALF_BYTE[15&(a^=b)]+BITS_SET_IN_HALF_BYTE[15&URShift(a,4)]+BITS_SET_IN_HALF_BYTE[15&URShift(a,8)]+BITS_SET_IN_HALF_BYTE[15&URShift(a,12)]+BITS_SET_IN_HALF_BYTE[15&URShift(a,16)]+BITS_SET_IN_HALF_BYTE[15&URShift(a,20)]+BITS_SET_IN_HALF_BYTE[15&URShift(a,24)]+BITS_SET_IN_HALF_BYTE[15&URShift(a,28)]},FormatInformation.decodeFormatInformation=function(maskedFormatInfo){var formatInfo=FormatInformation.doDecodeFormatInformation(maskedFormatInfo);return null!=formatInfo?formatInfo:FormatInformation.doDecodeFormatInformation(21522^maskedFormatInfo)},FormatInformation.doDecodeFormatInformation=function(maskedFormatInfo){for(var bestDifference=4294967295,bestFormatInfo=0,i=0;i<FORMAT_INFO_DECODE_LOOKUP.length;i++){var decodeInfo=FORMAT_INFO_DECODE_LOOKUP[i],targetInfo=decodeInfo[0];if(targetInfo==maskedFormatInfo)return new FormatInformation(decodeInfo[1]);var bitsDifference=this.numBitsDiffering(maskedFormatInfo,targetInfo);bitsDifference<bestDifference&&(bestFormatInfo=decodeInfo[1],bestDifference=bitsDifference)}return bestDifference<=3?new FormatInformation(bestFormatInfo):null},ErrorCorrectionLevel.forBits=function(bits){if(bits<0||bits>=FOR_BITS.length)throw"ArgumentException";return FOR_BITS[bits]};var L=new ErrorCorrectionLevel(0,1,"L"),M=new ErrorCorrectionLevel(1,0,"M"),Q=new ErrorCorrectionLevel(2,3,"Q"),H=new ErrorCorrectionLevel(3,2,"H"),FOR_BITS=new Array(M,L,H,Q);function BitMatrix(width,height){if(height||(height=width),width<1||height<1)throw"Both dimensions must be greater than 0";this.width=width,this.height=height;var rowSize=width>>5;0!=(31&width)&&rowSize++,this.rowSize=rowSize,this.bits=new Array(rowSize*height);for(var i=0;i<this.bits.length;i++)this.bits[i]=0;this.__defineGetter__("Width",(function(){return this.width})),this.__defineGetter__("Height",(function(){return this.height})),this.__defineGetter__("Dimension",(function(){if(this.width!=this.height)throw"Can't call getDimension() on a non-square matrix";return this.width})),this.get_Renamed=function(x,y){var offset=y*this.rowSize+(x>>5);return 0!=(1&URShift(this.bits[offset],31&x))},this.set_Renamed=function(x,y){var offset=y*this.rowSize+(x>>5);this.bits[offset]|=1<<(31&x)},this.flip=function(x,y){var offset=y*this.rowSize+(x>>5);this.bits[offset]^=1<<(31&x)},this.clear=function(){for(var max=this.bits.length,i=0;i<max;i++)this.bits[i]=0},this.setRegion=function(left,top,width,height){if(top<0||left<0)throw"Left and top must be nonnegative";if(height<1||width<1)throw"Height and width must be at least 1";var right=left+width,bottom=top+height;if(bottom>this.height||right>this.width)throw"The region must fit inside the matrix";for(var y=top;y<bottom;y++)for(var offset=y*this.rowSize,x=left;x<right;x++)this.bits[offset+(x>>5)]|=1<<(31&x)}}function DataBlock(numDataCodewords,codewords){this.numDataCodewords=numDataCodewords,this.codewords=codewords,this.__defineGetter__("NumDataCodewords",(function(){return this.numDataCodewords})),this.__defineGetter__("Codewords",(function(){return this.codewords}))}function BitMatrixParser(bitMatrix){var dimension=bitMatrix.Dimension;if(dimension<21||1!=(3&dimension))throw"Error BitMatrixParser";this.bitMatrix=bitMatrix,this.parsedVersion=null,this.parsedFormatInfo=null,this.copyBit=function(i,j,versionBits){return this.bitMatrix.get_Renamed(i,j)?versionBits<<1|1:versionBits<<1},this.readFormatInformation=function(){if(null!=this.parsedFormatInfo)return this.parsedFormatInfo;for(var formatInfoBits=0,i=0;i<6;i++)formatInfoBits=this.copyBit(i,8,formatInfoBits);formatInfoBits=this.copyBit(7,8,formatInfoBits),formatInfoBits=this.copyBit(8,8,formatInfoBits),formatInfoBits=this.copyBit(8,7,formatInfoBits);for(var j=5;j>=0;j--)formatInfoBits=this.copyBit(8,j,formatInfoBits);if(this.parsedFormatInfo=FormatInformation.decodeFormatInformation(formatInfoBits),null!=this.parsedFormatInfo)return this.parsedFormatInfo;var dimension=this.bitMatrix.Dimension;formatInfoBits=0;var iMin=dimension-8;for(i=dimension-1;i>=iMin;i--)formatInfoBits=this.copyBit(i,8,formatInfoBits);for(j=dimension-7;j<dimension;j++)formatInfoBits=this.copyBit(8,j,formatInfoBits);if(this.parsedFormatInfo=FormatInformation.decodeFormatInformation(formatInfoBits),null!=this.parsedFormatInfo)return this.parsedFormatInfo;throw"Error readFormatInformation"},this.readVersion=function(){if(null!=this.parsedVersion)return this.parsedVersion;var dimension=this.bitMatrix.Dimension,provisionalVersion=dimension-17>>2;if(provisionalVersion<=6)return Version.getVersionForNumber(provisionalVersion);for(var versionBits=0,ijMin=dimension-11,j=5;j>=0;j--)for(var i=dimension-9;i>=ijMin;i--)versionBits=this.copyBit(i,j,versionBits);if(this.parsedVersion=Version.decodeVersionInformation(versionBits),null!=this.parsedVersion&&this.parsedVersion.DimensionForVersion==dimension)return this.parsedVersion;versionBits=0;for(i=5;i>=0;i--)for(j=dimension-9;j>=ijMin;j--)versionBits=this.copyBit(i,j,versionBits);if(this.parsedVersion=Version.decodeVersionInformation(versionBits),null!=this.parsedVersion&&this.parsedVersion.DimensionForVersion==dimension)return this.parsedVersion;throw"Error readVersion"},this.readCodewords=function(){var formatInfo=this.readFormatInformation(),version=this.readVersion(),dataMask=DataMask.forReference(formatInfo.DataMask),dimension=this.bitMatrix.Dimension;dataMask.unmaskBitMatrix(this.bitMatrix,dimension);for(var functionPattern=version.buildFunctionPattern(),readingUp=!0,result=new Array(version.TotalCodewords),resultOffset=0,currentByte=0,bitsRead=0,j=dimension-1;j>0;j-=2){6==j&&j--;for(var count=0;count<dimension;count++)for(var i=readingUp?dimension-1-count:count,col=0;col<2;col++)functionPattern.get_Renamed(j-col,i)||(bitsRead++,currentByte<<=1,this.bitMatrix.get_Renamed(j-col,i)&&(currentByte|=1),8==bitsRead&&(result[resultOffset++]=currentByte,bitsRead=0,currentByte=0));readingUp^=!0}if(resultOffset!=version.TotalCodewords)throw"Error readCodewords";return result}}DataBlock.getDataBlocks=function(rawCodewords,version,ecLevel){if(rawCodewords.length!=version.TotalCodewords)throw"ArgumentException";for(var ecBlocks=version.getECBlocksForLevel(ecLevel),totalBlocks=0,ecBlockArray=ecBlocks.getECBlocks(),i=0;i<ecBlockArray.length;i++)totalBlocks+=ecBlockArray[i].Count;for(var result=new Array(totalBlocks),numResultBlocks=0,j=0;j<ecBlockArray.length;j++){var ecBlock=ecBlockArray[j];for(i=0;i<ecBlock.Count;i++){var numDataCodewords=ecBlock.DataCodewords,numBlockCodewords=ecBlocks.ECCodewordsPerBlock+numDataCodewords;result[numResultBlocks++]=new DataBlock(numDataCodewords,new Array(numBlockCodewords))}}for(var shorterBlocksTotalCodewords=result[0].codewords.length,longerBlocksStartAt=result.length-1;longerBlocksStartAt>=0;){if(result[longerBlocksStartAt].codewords.length==shorterBlocksTotalCodewords)break;longerBlocksStartAt--}longerBlocksStartAt++;var shorterBlocksNumDataCodewords=shorterBlocksTotalCodewords-ecBlocks.ECCodewordsPerBlock,rawCodewordsOffset=0;for(i=0;i<shorterBlocksNumDataCodewords;i++)for(j=0;j<numResultBlocks;j++)result[j].codewords[i]=rawCodewords[rawCodewordsOffset++];for(j=longerBlocksStartAt;j<numResultBlocks;j++)result[j].codewords[shorterBlocksNumDataCodewords]=rawCodewords[rawCodewordsOffset++];var max=result[0].codewords.length;for(i=shorterBlocksNumDataCodewords;i<max;i++)for(j=0;j<numResultBlocks;j++){var iOffset=j<longerBlocksStartAt?i:i+1;result[j].codewords[iOffset]=rawCodewords[rawCodewordsOffset++]}return result};var DataMask={};function GF256Poly(field,coefficients){if(null==coefficients||0==coefficients.length)throw"System.ArgumentException";this.field=field;var coefficientsLength=coefficients.length;if(coefficientsLength>1&&0==coefficients[0]){for(var firstNonZero=1;firstNonZero<coefficientsLength&&0==coefficients[firstNonZero];)firstNonZero++;if(firstNonZero==coefficientsLength)this.coefficients=field.Zero.coefficients;else{this.coefficients=new Array(coefficientsLength-firstNonZero);for(var i=0;i<this.coefficients.length;i++)this.coefficients[i]=0;for(var ci=0;ci<this.coefficients.length;ci++)this.coefficients[ci]=coefficients[firstNonZero+ci]}}else this.coefficients=coefficients;this.__defineGetter__("Zero",(function(){return 0==this.coefficients[0]})),this.__defineGetter__("Degree",(function(){return this.coefficients.length-1})),this.__defineGetter__("Coefficients",(function(){return this.coefficients})),this.getCoefficient=function(degree){return this.coefficients[this.coefficients.length-1-degree]},this.evaluateAt=function(a){if(0==a)return this.getCoefficient(0);var size=this.coefficients.length;if(1==a){for(var result=0,i=0;i<size;i++)result=GF256.addOrSubtract(result,this.coefficients[i]);return result}var result2=this.coefficients[0];for(i=1;i<size;i++)result2=GF256.addOrSubtract(this.field.multiply(a,result2),this.coefficients[i]);return result2},this.addOrSubtract=function(other){if(this.field!=other.field)throw"GF256Polys do not have same GF256 field";if(this.Zero)return other;if(other.Zero)return this;var smallerCoefficients=this.coefficients,largerCoefficients=other.coefficients;if(smallerCoefficients.length>largerCoefficients.length){var temp=smallerCoefficients;smallerCoefficients=largerCoefficients,largerCoefficients=temp}for(var sumDiff=new Array(largerCoefficients.length),lengthDiff=largerCoefficients.length-smallerCoefficients.length,ci=0;ci<lengthDiff;ci++)sumDiff[ci]=largerCoefficients[ci];for(var i=lengthDiff;i<largerCoefficients.length;i++)sumDiff[i]=GF256.addOrSubtract(smallerCoefficients[i-lengthDiff],largerCoefficients[i]);return new GF256Poly(field,sumDiff)},this.multiply1=function(other){if(this.field!=other.field)throw"GF256Polys do not have same GF256 field";if(this.Zero||other.Zero)return this.field.Zero;for(var aCoefficients=this.coefficients,aLength=aCoefficients.length,bCoefficients=other.coefficients,bLength=bCoefficients.length,product=new Array(aLength+bLength-1),i=0;i<aLength;i++)for(var aCoeff=aCoefficients[i],j=0;j<bLength;j++)product[i+j]=GF256.addOrSubtract(product[i+j],this.field.multiply(aCoeff,bCoefficients[j]));return new GF256Poly(this.field,product)},this.multiply2=function(scalar){if(0==scalar)return this.field.Zero;if(1==scalar)return this;for(var size=this.coefficients.length,product=new Array(size),i=0;i<size;i++)product[i]=this.field.multiply(this.coefficients[i],scalar);return new GF256Poly(this.field,product)},this.multiplyByMonomial=function(degree,coefficient){if(degree<0)throw"System.ArgumentException";if(0==coefficient)return this.field.Zero;for(var size=this.coefficients.length,product=new Array(size+degree),i=0;i<product.length;i++)product[i]=0;for(i=0;i<size;i++)product[i]=this.field.multiply(this.coefficients[i],coefficient);return new GF256Poly(this.field,product)},this.divide=function(other){if(this.field!=other.field)throw"GF256Polys do not have same GF256 field";if(other.Zero)throw"Divide by 0";for(var quotient=this.field.Zero,remainder=this,denominatorLeadingTerm=other.getCoefficient(other.Degree),inverseDenominatorLeadingTerm=this.field.inverse(denominatorLeadingTerm);remainder.Degree>=other.Degree&&!remainder.Zero;){var degreeDifference=remainder.Degree-other.Degree,scale=this.field.multiply(remainder.getCoefficient(remainder.Degree),inverseDenominatorLeadingTerm),term=other.multiplyByMonomial(degreeDifference,scale),iterationQuotient=this.field.buildMonomial(degreeDifference,scale);quotient=quotient.addOrSubtract(iterationQuotient),remainder=remainder.addOrSubtract(term)}return new Array(quotient,remainder)}}function GF256(primitive){this.expTable=new Array(256),this.logTable=new Array(256);for(var x=1,i=0;i<256;i++)this.expTable[i]=x,(x<<=1)>=256&&(x^=primitive);for(i=0;i<255;i++)this.logTable[this.expTable[i]]=i;var at0=new Array(1);at0[0]=0,this.zero=new GF256Poly(this,new Array(at0));var at1=new Array(1);at1[0]=1,this.one=new GF256Poly(this,new Array(at1)),this.__defineGetter__("Zero",(function(){return this.zero})),this.__defineGetter__("One",(function(){return this.one})),this.buildMonomial=function(degree,coefficient){if(degree<0)throw"System.ArgumentException";if(0==coefficient)return this.zero;for(var coefficients=new Array(degree+1),i=0;i<coefficients.length;i++)coefficients[i]=0;return coefficients[0]=coefficient,new GF256Poly(this,coefficients)},this.exp=function(a){return this.expTable[a]},this.log=function(a){if(0==a)throw"System.ArgumentException";return this.logTable[a]},this.inverse=function(a){if(0==a)throw"System.ArithmeticException";return this.expTable[255-this.logTable[a]]},this.multiply=function(a,b){return 0==a||0==b?0:1==a?b:1==b?a:this.expTable[(this.logTable[a]+this.logTable[b])%255]}}DataMask.forReference=function(reference){if(reference<0||reference>7)throw"System.ArgumentException";return DataMask.DATA_MASKS[reference]},DataMask.DATA_MASKS=new Array(new function(){this.unmaskBitMatrix=function(bits,dimension){for(var i=0;i<dimension;i++)for(var j=0;j<dimension;j++)this.isMasked(i,j)&&bits.flip(j,i)},this.isMasked=function(i,j){return 0==(i+j&1)}},new function(){this.unmaskBitMatrix=function(bits,dimension){for(var i=0;i<dimension;i++)for(var j=0;j<dimension;j++)this.isMasked(i,j)&&bits.flip(j,i)},this.isMasked=function(i,j){return 0==(1&i)}},new function(){this.unmaskBitMatrix=function(bits,dimension){for(var i=0;i<dimension;i++)for(var j=0;j<dimension;j++)this.isMasked(i,j)&&bits.flip(j,i)},this.isMasked=function(i,j){return j%3==0}},new function(){this.unmaskBitMatrix=function(bits,dimension){for(var i=0;i<dimension;i++)for(var j=0;j<dimension;j++)this.isMasked(i,j)&&bits.flip(j,i)},this.isMasked=function(i,j){return(i+j)%3==0}},new function(){this.unmaskBitMatrix=function(bits,dimension){for(var i=0;i<dimension;i++)for(var j=0;j<dimension;j++)this.isMasked(i,j)&&bits.flip(j,i)},this.isMasked=function(i,j){return 0==(URShift(i,1)+j/3&1)}},new function(){this.unmaskBitMatrix=function(bits,dimension){for(var i=0;i<dimension;i++)for(var j=0;j<dimension;j++)this.isMasked(i,j)&&bits.flip(j,i)},this.isMasked=function(i,j){var temp=i*j;return(1&temp)+temp%3==0}},new function(){this.unmaskBitMatrix=function(bits,dimension){for(var i=0;i<dimension;i++)for(var j=0;j<dimension;j++)this.isMasked(i,j)&&bits.flip(j,i)},this.isMasked=function(i,j){var temp=i*j;return 0==((1&temp)+temp%3&1)}},new function(){this.unmaskBitMatrix=function(bits,dimension){for(var i=0;i<dimension;i++)for(var j=0;j<dimension;j++)this.isMasked(i,j)&&bits.flip(j,i)},this.isMasked=function(i,j){return 0==((i+j&1)+i*j%3&1)}}),GF256.QR_CODE_FIELD=new GF256(285),GF256.DATA_MATRIX_FIELD=new GF256(301),GF256.addOrSubtract=function(a,b){return a^b};var Decoder={};Decoder.rsDecoder=new function(field){this.field=field,this.decode=function(received,twoS){for(var poly=new GF256Poly(this.field,received),syndromeCoefficients=new Array(twoS),i=0;i<syndromeCoefficients.length;i++)syndromeCoefficients[i]=0;var noError=!0;for(i=0;i<twoS;i++){var evalu=poly.evaluateAt(this.field.exp(i));syndromeCoefficients[syndromeCoefficients.length-1-i]=evalu,0!=evalu&&(noError=!1)}if(!noError){var syndrome=new GF256Poly(this.field,syndromeCoefficients),sigmaOmega=this.runEuclideanAlgorithm(this.field.buildMonomial(twoS,1),syndrome,twoS),sigma=sigmaOmega[0],omega=sigmaOmega[1],errorLocations=this.findErrorLocations(sigma),errorMagnitudes=this.findErrorMagnitudes(omega,errorLocations,false);for(i=0;i<errorLocations.length;i++){var position=received.length-1-this.field.log(errorLocations[i]);if(position<0)throw"ReedSolomonException Bad error location";received[position]=GF256.addOrSubtract(received[position],errorMagnitudes[i])}}},this.runEuclideanAlgorithm=function(a,b,R){if(a.Degree<b.Degree){var temp=a;a=b,b=temp}for(var rLast=a,r=b,sLast=this.field.One,s=this.field.Zero,tLast=this.field.Zero,t=this.field.One;r.Degree>=Math.floor(R/2);){var rLastLast=rLast,sLastLast=sLast,tLastLast=tLast;if(sLast=s,tLast=t,(rLast=r).Zero)throw"r_{i-1} was zero";r=rLastLast;for(var q=this.field.Zero,denominatorLeadingTerm=rLast.getCoefficient(rLast.Degree),dltInverse=this.field.inverse(denominatorLeadingTerm);r.Degree>=rLast.Degree&&!r.Zero;){var degreeDiff=r.Degree-rLast.Degree,scale=this.field.multiply(r.getCoefficient(r.Degree),dltInverse);q=q.addOrSubtract(this.field.buildMonomial(degreeDiff,scale)),r=r.addOrSubtract(rLast.multiplyByMonomial(degreeDiff,scale))}s=q.multiply1(sLast).addOrSubtract(sLastLast),t=q.multiply1(tLast).addOrSubtract(tLastLast)}var sigmaTildeAtZero=t.getCoefficient(0);if(0==sigmaTildeAtZero)throw"ReedSolomonException sigmaTilde(0) was zero";var inverse=this.field.inverse(sigmaTildeAtZero),sigma=t.multiply2(inverse),omega=r.multiply2(inverse);return new Array(sigma,omega)},this.findErrorLocations=function(errorLocator){var numErrors=errorLocator.Degree;if(1==numErrors)return new Array(errorLocator.getCoefficient(1));for(var result=new Array(numErrors),e=0,i=1;i<256&&e<numErrors;i++)0==errorLocator.evaluateAt(i)&&(result[e]=this.field.inverse(i),e++);if(e!=numErrors)throw"Error locator degree does not match number of roots";return result},this.findErrorMagnitudes=function(errorEvaluator,errorLocations,dataMatrix){for(var s=errorLocations.length,result=new Array(s),i=0;i<s;i++){for(var xiInverse=this.field.inverse(errorLocations[i]),denominator=1,j=0;j<s;j++)i!=j&&(denominator=this.field.multiply(denominator,GF256.addOrSubtract(1,this.field.multiply(errorLocations[j],xiInverse))));result[i]=this.field.multiply(errorEvaluator.evaluateAt(xiInverse),this.field.inverse(denominator)),dataMatrix&&(result[i]=this.field.multiply(result[i],xiInverse))}return result}}(GF256.QR_CODE_FIELD),Decoder.correctErrors=function(codewordBytes,numDataCodewords){for(var numCodewords=codewordBytes.length,codewordsInts=new Array(numCodewords),i=0;i<numCodewords;i++)codewordsInts[i]=255&codewordBytes[i];var numECCodewords=codewordBytes.length-numDataCodewords;try{Decoder.rsDecoder.decode(codewordsInts,numECCodewords)}catch(rse){throw rse}for(i=0;i<numDataCodewords;i++)codewordBytes[i]=codewordsInts[i]},Decoder.decode=function(bits){for(var parser=new BitMatrixParser(bits),version=parser.readVersion(),ecLevel=parser.readFormatInformation().ErrorCorrectionLevel,codewords=parser.readCodewords(),dataBlocks=DataBlock.getDataBlocks(codewords,version,ecLevel),totalBytes=0,i=0;i<dataBlocks.length;i++)totalBytes+=dataBlocks[i].NumDataCodewords;for(var resultBytes=new Array(totalBytes),resultOffset=0,j=0;j<dataBlocks.length;j++){var dataBlock=dataBlocks[j],codewordBytes=dataBlock.Codewords,numDataCodewords=dataBlock.NumDataCodewords;Decoder.correctErrors(codewordBytes,numDataCodewords);for(i=0;i<numDataCodewords;i++)resultBytes[resultOffset++]=codewordBytes[i]}return new QRCodeDataBlockReader(resultBytes,version.VersionNumber,ecLevel.Bits)};var qrcode={};function URShift(number,bits){return number>=0?number>>bits:(number>>bits)+(2<<~bits)}qrcode.imagedata=null,qrcode.video=!1,qrcode.width=0,qrcode.height=0,qrcode.qrCodeSymbol=null,qrcode.debug=!1,qrcode.maxImgSize=1048576,qrcode.interval=500,qrcode.sizeOfDataLengthInfo=[[10,9,8,8],[12,11,16,10],[14,13,16,12]],qrcode.callback=null,qrcode.startWebCam=function(videoId){qrcode.videoId=videoId,qrcode.video=document.getElementById(qrcode.videoId);var pPromise=qrcode.video.play();void 0!==pPromise&&pPromise.then((function(){})).catch((function(error){}));navigator.getUserMedia&&navigator.getUserMedia({audio:!1,video:{facingMode:"environment"}},qrcode.webCamSuccess,qrcode.webCamError)},qrcode.stopWebCam=function(){qrcode.video.pause()},qrcode.webCamSuccess=function(stream){qrcode.localstream=stream,qrcode.video.srcObject=stream,qrcode.video.controls=!1,qrcode.video.volume=0},qrcode.webCamError=function(error){qrcode.stopScan()},qrcode.startScan=function(videoId){qrcode.canvasid="qr-canvas"+videoId;var thevideo=document.getElementById(videoId);qrcode.canvas_qr2=document.createElement("canvas"),qrcode.canvas_qr2.id=qrcode.canvasid,qrcode.qrcontext2=qrcode.canvas_qr2.getContext("2d"),qrcode.canvas_qr2.width=qrcode.video.videoWidth,qrcode.canvas_qr2.height=qrcode.video.videoHeight,qrcode.gUM=!0;!function doScan(){if(qrcode.gUM)try{if(0==thevideo.videoWidth)return void setTimeout(doScan,qrcode.interval);qrcode.canvas_qr2.width=thevideo.videoWidth,qrcode.canvas_qr2.height=thevideo.videoHeight,qrcode.qrcontext2.drawImage(thevideo,0,0);try{qrcode.decode()}catch(e){log.debug(e),setTimeout(doScan,qrcode.interval)}}catch(e){log.debug(e),setTimeout(doScan,qrcode.interval)}}()},qrcode.stopScan=function(){qrcode.gUM=!1},qrcode.decode=function(thecanvas){if(thecanvas)var canvas_qr=thecanvas,context=qrcode.canvas_qr2.getContext("2d");else canvas_qr=qrcode.canvas_qr2,context=qrcode.qrcontext2;return qrcode.width=canvas_qr.width,qrcode.height=canvas_qr.height,qrcode.imagedata=context.getImageData(0,0,qrcode.width,qrcode.height),qrcode.result=qrcode.process(context),null!=qrcode.callback&&qrcode.callback(qrcode.result),qrcode.result},qrcode.isUrl=function(s){return/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(s)},qrcode.decode_url=function(s){var escaped="";try{escaped=escape(s)}catch(e){log.debug(e),escaped=s}var ret="";try{ret=decodeURIComponent(escaped)}catch(e){log.debug(e),ret=escaped}return ret},qrcode.decode_utf8=function(s){return qrcode.isUrl(s)?qrcode.decode_url(s):s},qrcode.process=function(ctx){var start=(new Date).getTime(),image=qrcode.grayScaleToBitmap(qrcode.grayscale());if(qrcode.debug){for(var y=0;y<qrcode.height;y++)for(var x=0;x<qrcode.width;x++){var point=4*x+y*qrcode.width*4;qrcode.imagedata.data[point]=(image[x+y*qrcode.width],0),qrcode.imagedata.data[point+1]=(image[x+y*qrcode.width],0),qrcode.imagedata.data[point+2]=image[x+y*qrcode.width]?255:0}ctx.putImageData(qrcode.imagedata,0,0)}var qRCodeMatrix=new Detector(image).detect();if(qrcode.debug){for(y=0;y<qRCodeMatrix.bits.Height;y++)for(x=0;x<qRCodeMatrix.bits.Width;x++){point=4*x*2+2*y*qrcode.width*4;qrcode.imagedata.data[point]=(qRCodeMatrix.bits.get_Renamed(x,y),0),qrcode.imagedata.data[point+1]=(qRCodeMatrix.bits.get_Renamed(x,y),0),qrcode.imagedata.data[point+2]=qRCodeMatrix.bits.get_Renamed(x,y)?255:0}ctx.putImageData(qrcode.imagedata,0,0)}for(var data=Decoder.decode(qRCodeMatrix.bits).DataByte,str="",i=0;i<data.length;i++)for(var j=0;j<data[i].length;j++)str+=String.fromCharCode(data[i][j]);var time=(new Date).getTime()-start;return log.debug(time),qrcode.decode_utf8(str)},qrcode.getPixel=function(x,y){if(qrcode.width<x)throw"point error";if(qrcode.height<y)throw"point error";var point=4*x+y*qrcode.width*4;return(33*qrcode.imagedata.data[point]+34*qrcode.imagedata.data[point+1]+33*qrcode.imagedata.data[point+2])/100},qrcode.binarize=function(th){for(var ret=new Array(qrcode.width*qrcode.height),y=0;y<qrcode.height;y++)for(var x=0;x<qrcode.width;x++){var gray=qrcode.getPixel(x,y);ret[x+y*qrcode.width]=gray<=th}return ret},qrcode.getMiddleBrightnessPerArea=function(image){for(var areaWidth=Math.floor(qrcode.width/4),areaHeight=Math.floor(qrcode.height/4),minmax=new Array(4),i=0;i<4;i++){minmax[i]=new Array(4);for(var i2=0;i2<4;i2++)minmax[i][i2]=new Array(0,0)}for(var ay=0;ay<4;ay++)for(var ax=0;ax<4;ax++){minmax[ax][ay][0]=255;for(var dy=0;dy<areaHeight;dy++)for(var dx=0;dx<areaWidth;dx++){var target=image[areaWidth*ax+dx+(areaHeight*ay+dy)*qrcode.width];target<minmax[ax][ay][0]&&(minmax[ax][ay][0]=target),target>minmax[ax][ay][1]&&(minmax[ax][ay][1]=target)}}for(var middle=new Array(4),i3=0;i3<4;i3++)middle[i3]=new Array(4);for(ay=0;ay<4;ay++)for(ax=0;ax<4;ax++)middle[ax][ay]=Math.floor((minmax[ax][ay][0]+minmax[ax][ay][1])/2);return middle},qrcode.grayScaleToBitmap=function(grayScale){for(var middle=qrcode.getMiddleBrightnessPerArea(grayScale),sqrtNumArea=middle.length,areaWidth=Math.floor(qrcode.width/sqrtNumArea),areaHeight=Math.floor(qrcode.height/sqrtNumArea),buff=new ArrayBuffer(qrcode.width*qrcode.height),bitmap=new Uint8Array(buff),ay=0;ay<sqrtNumArea;ay++)for(var ax=0;ax<sqrtNumArea;ax++)for(var dy=0;dy<areaHeight;dy++)for(var dx=0;dx<areaWidth;dx++)bitmap[areaWidth*ax+dx+(areaHeight*ay+dy)*qrcode.width]=grayScale[areaWidth*ax+dx+(areaHeight*ay+dy)*qrcode.width]<middle[ax][ay];return bitmap},qrcode.grayscale=function(){for(var buff=new ArrayBuffer(qrcode.width*qrcode.height),ret=new Uint8Array(buff),y=0;y<qrcode.height;y++)for(var x=0;x<qrcode.width;x++){var gray=qrcode.getPixel(x,y);ret[x+y*qrcode.width]=gray}return ret};function FinderPattern(posX,posY,estimatedModuleSize){this.x=posX,this.y=posY,this.count=1,this.estimatedModuleSize=estimatedModuleSize,this.__defineGetter__("EstimatedModuleSize",(function(){return this.estimatedModuleSize})),this.__defineGetter__("Count",(function(){return this.count})),this.__defineGetter__("X",(function(){return this.x})),this.__defineGetter__("Y",(function(){return this.y})),this.incrementCount=function(){this.count++},this.aboutEquals=function(moduleSize,i,j){if(Math.abs(i-this.y)<=moduleSize&&Math.abs(j-this.x)<=moduleSize){var moduleSizeDiff=Math.abs(moduleSize-this.estimatedModuleSize);return moduleSizeDiff<=1||moduleSizeDiff/this.estimatedModuleSize<=1}return!1}}function FinderPatternInfo(patternCenters){this.bottomLeft=patternCenters[0],this.topLeft=patternCenters[1],this.topRight=patternCenters[2],this.__defineGetter__("BottomLeft",(function(){return this.bottomLeft})),this.__defineGetter__("TopLeft",(function(){return this.topLeft})),this.__defineGetter__("TopRight",(function(){return this.topRight}))}function FinderPatternFinder(){this.image=null,this.possibleCenters=[],this.hasSkipped=!1,this.crossCheckStateCount=new Array(0,0,0,0,0),this.resultPointCallback=null,this.__defineGetter__("CrossCheckStateCount",(function(){return this.crossCheckStateCount[0]=0,this.crossCheckStateCount[1]=0,this.crossCheckStateCount[2]=0,this.crossCheckStateCount[3]=0,this.crossCheckStateCount[4]=0,this.crossCheckStateCount})),this.foundPatternCross=function(stateCount){for(var totalModuleSize=0,i=0;i<5;i++){var count=stateCount[i];if(0==count)return!1;totalModuleSize+=count}if(totalModuleSize<7)return!1;var moduleSize=Math.floor((totalModuleSize<<8)/7),maxVariance=Math.floor(moduleSize/2);return Math.abs(moduleSize-(stateCount[0]<<8))<maxVariance&&Math.abs(moduleSize-(stateCount[1]<<8))<maxVariance&&Math.abs(3*moduleSize-(stateCount[2]<<8))<3*maxVariance&&Math.abs(moduleSize-(stateCount[3]<<8))<maxVariance&&Math.abs(moduleSize-(stateCount[4]<<8))<maxVariance},this.centerFromEnd=function(stateCount,end){return end-stateCount[4]-stateCount[3]-stateCount[2]/2},this.crossCheckVertical=function(startI,centerJ,maxCount,originalStateCountTotal){for(var image=this.image,maxI=qrcode.height,stateCount=this.CrossCheckStateCount,i=startI;i>=0&&image[centerJ+i*qrcode.width];)stateCount[2]++,i--;if(i<0)return NaN;for(;i>=0&&!image[centerJ+i*qrcode.width]&&stateCount[1]<=maxCount;)stateCount[1]++,i--;if(i<0||stateCount[1]>maxCount)return NaN;for(;i>=0&&image[centerJ+i*qrcode.width]&&stateCount[0]<=maxCount;)stateCount[0]++,i--;if(stateCount[0]>maxCount)return NaN;for(i=startI+1;i<maxI&&image[centerJ+i*qrcode.width];)stateCount[2]++,i++;if(i==maxI)return NaN;for(;i<maxI&&!image[centerJ+i*qrcode.width]&&stateCount[3]<maxCount;)stateCount[3]++,i++;if(i==maxI||stateCount[3]>=maxCount)return NaN;for(;i<maxI&&image[centerJ+i*qrcode.width]&&stateCount[4]<maxCount;)stateCount[4]++,i++;if(stateCount[4]>=maxCount)return NaN;var stateCountTotal=stateCount[0]+stateCount[1]+stateCount[2]+stateCount[3]+stateCount[4];return 5*Math.abs(stateCountTotal-originalStateCountTotal)>=2*originalStateCountTotal?NaN:this.foundPatternCross(stateCount)?this.centerFromEnd(stateCount,i):NaN},this.crossCheckHorizontal=function(startJ,centerI,maxCount,originalStateCountTotal){for(var image=this.image,maxJ=qrcode.width,stateCount=this.CrossCheckStateCount,j=startJ;j>=0&&image[j+centerI*qrcode.width];)stateCount[2]++,j--;if(j<0)return NaN;for(;j>=0&&!image[j+centerI*qrcode.width]&&stateCount[1]<=maxCount;)stateCount[1]++,j--;if(j<0||stateCount[1]>maxCount)return NaN;for(;j>=0&&image[j+centerI*qrcode.width]&&stateCount[0]<=maxCount;)stateCount[0]++,j--;if(stateCount[0]>maxCount)return NaN;for(j=startJ+1;j<maxJ&&image[j+centerI*qrcode.width];)stateCount[2]++,j++;if(j==maxJ)return NaN;for(;j<maxJ&&!image[j+centerI*qrcode.width]&&stateCount[3]<maxCount;)stateCount[3]++,j++;if(j==maxJ||stateCount[3]>=maxCount)return NaN;for(;j<maxJ&&image[j+centerI*qrcode.width]&&stateCount[4]<maxCount;)stateCount[4]++,j++;if(stateCount[4]>=maxCount)return NaN;var stateCountTotal=stateCount[0]+stateCount[1]+stateCount[2]+stateCount[3]+stateCount[4];return 5*Math.abs(stateCountTotal-originalStateCountTotal)>=originalStateCountTotal?NaN:this.foundPatternCross(stateCount)?this.centerFromEnd(stateCount,j):NaN},this.handlePossibleCenter=function(stateCount,i,j){var stateCountTotal=stateCount[0]+stateCount[1]+stateCount[2]+stateCount[3]+stateCount[4],centerJ=this.centerFromEnd(stateCount,j),centerI=this.crossCheckVertical(i,Math.floor(centerJ),stateCount[2],stateCountTotal);if(!isNaN(centerI)&&(centerJ=this.crossCheckHorizontal(Math.floor(centerJ),Math.floor(centerI),stateCount[2],stateCountTotal),!isNaN(centerJ))){for(var estimatedModuleSize=stateCountTotal/7,found=!1,max=this.possibleCenters.length,index=0;index<max;index++){var center=this.possibleCenters[index];if(center.aboutEquals(estimatedModuleSize,centerI,centerJ)){center.incrementCount(),found=!0;break}}if(!found){var point=new FinderPattern(centerJ,centerI,estimatedModuleSize);this.possibleCenters.push(point),null!=this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(point)}return!0}return!1},this.selectBestPatterns=function(){var startSize=this.possibleCenters.length;if(startSize<3)throw"Couldn't find enough finder patterns (found "+startSize+")";if(startSize>3){for(var totalModuleSize=0,square=0,i=0;i<startSize;i++){var centerValue=this.possibleCenters[i].EstimatedModuleSize;totalModuleSize+=centerValue,square+=centerValue*centerValue}var average=totalModuleSize/startSize;this.possibleCenters.sort((function(center1,center2){var dA=Math.abs(center2.EstimatedModuleSize-average),dB=Math.abs(center1.EstimatedModuleSize-average);return dA<dB?-1:dA==dB?0:1}));var stdDev=Math.sqrt(square/startSize-average*average),limit=Math.max(.2*average,stdDev);for(i=this.possibleCenters.length-1;i>=0;i--){var pattern=this.possibleCenters[i];Math.abs(pattern.EstimatedModuleSize-average)>limit&&this.possibleCenters.splice(i,1)}}return this.possibleCenters.length>3&&this.possibleCenters.sort((function(a,b){return a.count>b.count?-1:a.count<b.count?1:0})),new Array(this.possibleCenters[0],this.possibleCenters[1],this.possibleCenters[2])},this.findRowSkip=function(){var max=this.possibleCenters.length;if(max<=1)return 0;for(var firstConfirmedCenter=null,i=0;i<max;i++){var center=this.possibleCenters[i];if(center.Count>=2){if(null!=firstConfirmedCenter)return this.hasSkipped=!0,Math.floor((Math.abs(firstConfirmedCenter.X-center.X)-Math.abs(firstConfirmedCenter.Y-center.Y))/2);firstConfirmedCenter=center}}return 0},this.haveMultiplyConfirmedCenters=function(){for(var confirmedCount=0,totalModuleSize=0,max=this.possibleCenters.length,i=0;i<max;i++){var pattern=this.possibleCenters[i];pattern.Count>=2&&(confirmedCount++,totalModuleSize+=pattern.EstimatedModuleSize)}if(confirmedCount<3)return!1;var average=totalModuleSize/max,totalDeviation=0;for(i=0;i<max;i++)pattern=this.possibleCenters[i],totalDeviation+=Math.abs(pattern.EstimatedModuleSize-average);return totalDeviation<=.05*totalModuleSize},this.findFinderPattern=function(image){this.image=image;var maxI=qrcode.height,maxJ=qrcode.width,iSkip=Math.floor(3*maxI/228);iSkip<3&&(iSkip=3);for(var done=!1,stateCount=new Array(5),i=iSkip-1;i<maxI&&!done;i+=iSkip){stateCount[0]=0,stateCount[1]=0,stateCount[2]=0,stateCount[3]=0,stateCount[4]=0;for(var currentState=0,j=0;j<maxJ;j++)if(image[j+i*qrcode.width])1==(1&currentState)&&currentState++,stateCount[currentState]++;else if(0==(1&currentState))if(4==currentState)if(this.foundPatternCross(stateCount)){if(this.handlePossibleCenter(stateCount,i,j))if(iSkip=2,this.hasSkipped)done=this.haveMultiplyConfirmedCenters();else{var rowSkip=this.findRowSkip();rowSkip>stateCount[2]&&(i+=rowSkip-stateCount[2]-iSkip,j=maxJ-1)}else{do{j++}while(j<maxJ&&!image[j+i*qrcode.width]);j--}currentState=0,stateCount[0]=0,stateCount[1]=0,stateCount[2]=0,stateCount[3]=0,stateCount[4]=0}else stateCount[0]=stateCount[2],stateCount[1]=stateCount[3],stateCount[2]=stateCount[4],stateCount[3]=1,stateCount[4]=0,currentState=3;else stateCount[++currentState]++;else stateCount[currentState]++;if(this.foundPatternCross(stateCount))this.handlePossibleCenter(stateCount,i,maxJ)&&(iSkip=stateCount[0],this.hasSkipped&&(done=this.haveMultiplyConfirmedCenters()))}var patternInfo=this.selectBestPatterns();return qrcode.orderBestPatterns(patternInfo),new FinderPatternInfo(patternInfo)}}function AlignmentPattern(posX,posY,estimatedModuleSize){this.x=posX,this.y=posY,this.count=1,this.estimatedModuleSize=estimatedModuleSize,this.__defineGetter__("EstimatedModuleSize",(function(){return this.estimatedModuleSize})),this.__defineGetter__("Count",(function(){return this.count})),this.__defineGetter__("X",(function(){return Math.floor(this.x)})),this.__defineGetter__("Y",(function(){return Math.floor(this.y)})),this.incrementCount=function(){this.count++},this.aboutEquals=function(moduleSize,i,j){if(Math.abs(i-this.y)<=moduleSize&&Math.abs(j-this.x)<=moduleSize){var moduleSizeDiff=Math.abs(moduleSize-this.estimatedModuleSize);return moduleSizeDiff<=1||moduleSizeDiff/this.estimatedModuleSize<=1}return!1}}function AlignmentPatternFinder(image,startX,startY,width,height,moduleSize,resultPointCallback){this.image=image,this.possibleCenters=new Array,this.startX=startX,this.startY=startY,this.width=width,this.height=height,this.moduleSize=moduleSize,this.crossCheckStateCount=new Array(0,0,0),this.resultPointCallback=resultPointCallback,this.centerFromEnd=function(stateCount,end){return end-stateCount[2]-stateCount[1]/2},this.foundPatternCross=function(stateCount){for(var moduleSize=this.moduleSize,maxVariance=moduleSize/2,i=0;i<3;i++)if(Math.abs(moduleSize-stateCount[i])>=maxVariance)return!1;return!0},this.crossCheckVertical=function(startI,centerJ,maxCount,originalStateCountTotal){var image=this.image,maxI=qrcode.height,stateCount=this.crossCheckStateCount;stateCount[0]=0,stateCount[1]=0,stateCount[2]=0;for(var i=startI;i>=0&&image[centerJ+i*qrcode.width]&&stateCount[1]<=maxCount;)stateCount[1]++,i--;if(i<0||stateCount[1]>maxCount)return NaN;for(;i>=0&&!image[centerJ+i*qrcode.width]&&stateCount[0]<=maxCount;)stateCount[0]++,i--;if(stateCount[0]>maxCount)return NaN;for(i=startI+1;i<maxI&&image[centerJ+i*qrcode.width]&&stateCount[1]<=maxCount;)stateCount[1]++,i++;if(i==maxI||stateCount[1]>maxCount)return NaN;for(;i<maxI&&!image[centerJ+i*qrcode.width]&&stateCount[2]<=maxCount;)stateCount[2]++,i++;if(stateCount[2]>maxCount)return NaN;var stateCountTotal=stateCount[0]+stateCount[1]+stateCount[2];return 5*Math.abs(stateCountTotal-originalStateCountTotal)>=2*originalStateCountTotal?NaN:this.foundPatternCross(stateCount)?this.centerFromEnd(stateCount,i):NaN},this.handlePossibleCenter=function(stateCount,i,j){var stateCountTotal=stateCount[0]+stateCount[1]+stateCount[2],centerJ=this.centerFromEnd(stateCount,j),centerI=this.crossCheckVertical(i,Math.floor(centerJ),2*stateCount[1],stateCountTotal);if(!isNaN(centerI)){for(var estimatedModuleSize=(stateCount[0]+stateCount[1]+stateCount[2])/3,max=this.possibleCenters.length,index=0;index<max;index++){if(this.possibleCenters[index].aboutEquals(estimatedModuleSize,centerI,centerJ))return new AlignmentPattern(centerJ,centerI,estimatedModuleSize)}var point=new AlignmentPattern(centerJ,centerI,estimatedModuleSize);this.possibleCenters.push(point),null!=this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(point)}return null},this.find=function(){for(var startX=this.startX,height=this.height,maxJ=startX+width,middleI=startY+(height>>1),stateCount=new Array(0,0,0),iGen=0;iGen<height;iGen++){var i=middleI+(0==(1&iGen)?iGen+1>>1:-(iGen+1>>1));stateCount[0]=0,stateCount[1]=0,stateCount[2]=0;for(var j=startX;j<maxJ&&!image[j+qrcode.width*i];)j++;for(var currentState=0;j<maxJ;){if(image[j+i*qrcode.width])if(1==currentState)stateCount[currentState]++;else if(2==currentState){var confirmed;if(this.foundPatternCross(stateCount))if(null!=(confirmed=this.handlePossibleCenter(stateCount,i,j)))return confirmed;stateCount[0]=stateCount[2],stateCount[1]=1,stateCount[2]=0,currentState=1}else stateCount[++currentState]++;else 1==currentState&&currentState++,stateCount[currentState]++;j++}if(this.foundPatternCross(stateCount))if(null!=(confirmed=this.handlePossibleCenter(stateCount,i,maxJ)))return confirmed}if(0!=this.possibleCenters.length)return this.possibleCenters[0];throw"Couldn't find enough alignment patterns"}}function QRCodeDataBlockReader(blocks,version,numErrorCorrectionCode){this.blockPointer=0,this.bitPointer=7,this.dataLength=0,this.blocks=blocks,this.numErrorCorrectionCode=numErrorCorrectionCode,version<=9?this.dataLengthMode=0:version>=10&&version<=26?this.dataLengthMode=1:version>=27&&version<=40&&(this.dataLengthMode=2),this.getNextBits=function(numBits){var bits=0;if(numBits<this.bitPointer+1){for(var mask=0,i=0;i<numBits;i++)mask+=1<<i;return mask<<=this.bitPointer-numBits+1,bits=(this.blocks[this.blockPointer]&mask)>>this.bitPointer-numBits+1,this.bitPointer-=numBits,bits}if(numBits<this.bitPointer+1+8){var mask1=0;for(i=0;i<this.bitPointer+1;i++)mask1+=1<<i;return bits=(this.blocks[this.blockPointer]&mask1)<<numBits-(this.bitPointer+1),this.blockPointer++,bits+=this.blocks[this.blockPointer]>>8-(numBits-(this.bitPointer+1)),this.bitPointer=this.bitPointer-numBits%8,this.bitPointer<0&&(this.bitPointer=8+this.bitPointer),bits}if(numBits<this.bitPointer+1+16){mask1=0;var mask3=0;for(i=0;i<this.bitPointer+1;i++)mask1+=1<<i;var bitsFirstBlock=(this.blocks[this.blockPointer]&mask1)<<numBits-(this.bitPointer+1);this.blockPointer++;var bitsSecondBlock=this.blocks[this.blockPointer]<<numBits-(this.bitPointer+1+8);this.blockPointer++;for(i=0;i<numBits-(this.bitPointer+1+8);i++)mask3+=1<<i;return mask3<<=8-(numBits-(this.bitPointer+1+8)),bits=bitsFirstBlock+bitsSecondBlock+((this.blocks[this.blockPointer]&mask3)>>8-(numBits-(this.bitPointer+1+8))),this.bitPointer=this.bitPointer-(numBits-8)%8,this.bitPointer<0&&(this.bitPointer=8+this.bitPointer),bits}return 0},this.NextMode=function(){return this.blockPointer>this.blocks.length-this.numErrorCorrectionCode-2?0:this.getNextBits(4)},this.getDataLength=function(modeIndicator){for(var index=0;modeIndicator>>index!=1;)index++;return this.getNextBits(qrcode.sizeOfDataLengthInfo[this.dataLengthMode][index])},this.getRomanAndFigureString=function(dataLength){var length=dataLength,intData=0,strData="",tableRomanAndFigure=new Array("0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":");do{if(length>1){var secondLetter=(intData=this.getNextBits(11))%45;strData+=tableRomanAndFigure[Math.floor(intData/45)],strData+=tableRomanAndFigure[secondLetter],length-=2}else 1==length&&(strData+=tableRomanAndFigure[intData=this.getNextBits(6)],length-=1)}while(length>0);return strData},this.getFigureString=function(dataLength){var length=dataLength,intData=0,strData="";do{length>=3?((intData=this.getNextBits(10))<100&&(strData+="0"),intData<10&&(strData+="0"),length-=3):2==length?((intData=this.getNextBits(7))<10&&(strData+="0"),length-=2):1==length&&(intData=this.getNextBits(4),length-=1),strData+=intData}while(length>0);return strData},this.get8bitByteArray=function(dataLength){var length=dataLength,intData=0,output=new Array;do{intData=this.getNextBits(8),output.push(intData),length--}while(length>0);return output},this.getKanjiString=function(dataLength){var length=dataLength,intData=0,unicodeString="";do{var tempWord=((intData=this.getNextBits(13))/192<<8)+intData%192,shiftjisWord=0;shiftjisWord=tempWord+33088<=40956?tempWord+33088:tempWord+49472,unicodeString+=String.fromCharCode(shiftjisWord),length--}while(length>0);return unicodeString},this.parseECIValue=function(){var intData=0,firstByte=this.getNextBits(8);(0==(128&firstByte)&&(intData=127&firstByte),128==(192&firstByte))&&(intData=(63&firstByte)<<8|this.getNextBits(8));192==(224&firstByte)&&(intData=(31&firstByte)<<16|this.getNextBits(8));return intData},this.__defineGetter__("DataByte",(function(){for(var output=new Array;;){var mode=this.NextMode();if(0==mode){if(output.length>0)break;throw"Empty data block"}if(1!=mode&&2!=mode&&4!=mode&&8!=mode&&7!=mode)throw"Invalid mode: "+mode+" in (block:"+this.blockPointer+" bit:"+this.bitPointer+")";if(7==mode)var temp_sbyteArray3=this.parseECIValue();else{var dataLength=this.getDataLength(mode);if(dataLength<1)throw"Invalid data length: "+dataLength;switch(mode){case 1:for(var temp_str=this.getFigureString(dataLength),ta=new Array(temp_str.length),j=0;j<temp_str.length;j++)ta[j]=temp_str.charCodeAt(j);output.push(ta);break;case 2:for(temp_str=this.getRomanAndFigureString(dataLength),ta=new Array(temp_str.length),j=0;j<temp_str.length;j++)ta[j]=temp_str.charCodeAt(j);output.push(ta);break;case 4:temp_sbyteArray3=this.get8bitByteArray(dataLength);output.push(temp_sbyteArray3);break;case 8:temp_str=this.getKanjiString(dataLength);output.push(temp_str)}}}return output}))}return qrcode.orderBestPatterns=function(patterns){function distance(pattern1,pattern2){var xDiff=pattern1.X-pattern2.X,yDiff=pattern1.Y-pattern2.Y;return Math.sqrt(xDiff*xDiff+yDiff*yDiff)}var pointA,pointB,pointC,zeroOneDistance=distance(patterns[0],patterns[1]),oneTwoDistance=distance(patterns[1],patterns[2]),zeroTwoDistance=distance(patterns[0],patterns[2]);if(oneTwoDistance>=zeroOneDistance&&oneTwoDistance>=zeroTwoDistance?(pointB=patterns[0],pointA=patterns[1],pointC=patterns[2]):zeroTwoDistance>=oneTwoDistance&&zeroTwoDistance>=zeroOneDistance?(pointB=patterns[1],pointA=patterns[0],pointC=patterns[2]):(pointB=patterns[2],pointA=patterns[0],pointC=patterns[1]),function(pointA,pointB,pointC){var bX=pointB.x,bY=pointB.y;return(pointC.x-bX)*(pointA.y-bY)-(pointC.y-bY)*(pointA.x-bX)}(pointA,pointB,pointC)<0){var temp=pointA;pointA=pointC,pointC=temp}patterns[0]=pointA,patterns[1]=pointB,patterns[2]=pointC},{startWebCam:function(videoid){qrcode.startWebCam(videoid)},stopWebCam:function(videoid){qrcode.stopWebCam()},startScan:function(videoid){qrcode.startScan(videoid)},stopScan:function(videoid){qrcode.stopScan()},setCallback:function(callback){qrcode.callback=callback},decode:function(canvas){qrcode.decode(canvas)}}}));
define('filter_poodll/anim_hwave_fresh', ["jquery","core/log"],(function($,log){return log.debug("anim_horizontal_wave: initialising"),{analyser:null,cvs:null,cvsctx:null,drawparams:{wavColor:"#6DDC6F",barColor:"#ad2323",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:10,shadowColor:"#fff",font:"18px Arial",textAlign:"center",textBaseline:"middle"},clone:function(){return $.extend(!0,{},this)},init:function(analyser,cvs){this.cvs=cvs,this.cvsctx=cvs.getContext("2d"),this.analyser=analyser,this.clear()},setDrawParam:function(paramkey,paramvalue){this.drawparams[paramkey]=paramvalue},clear:function(){this.cvsctx.clearRect(0,0,this.cvs.width,this.cvs.height),this.cvsctx.lineWidth=2,this.cvsctx.strokeStyle=this.drawparams.wavColor,this.cvsctx.beginPath(),this.cvsctx.moveTo(0,this.cvs.height/2),this.cvsctx.lineTo(this.cvs.width,this.cvs.height/2),this.cvsctx.stroke()},start:function(){this.analyser.core.fftSize=2048;var bufferLength=this.analyser.core.fftSize,dataArray=new Uint8Array(bufferLength),cwidth=this.cvs.width,cheight=this.cvs.height,canvasCtx=this.cvsctx,analyser=this.analyser;this.clear();var that=this;!function draw(){requestAnimationFrame(draw);if(analyser.theinterval){analyser.core.getByteTimeDomainData(dataArray),canvasCtx.clearRect(0,0,cwidth,cheight),canvasCtx.lineWidth=2,canvasCtx.strokeStyle=that.drawparams.wavColor,canvasCtx.beginPath();for(var sliceWidth=1*cwidth/bufferLength,x=0,i=0;i<bufferLength;i++){var y=dataArray[i]/128*cheight/2;0===i?canvasCtx.moveTo(x,y):canvasCtx.lineTo(x,y),x+=sliceWidth}canvasCtx.lineTo(cwidth,cheight/2),canvasCtx.stroke()}}()}}}));
define('filter_poodll/poodll_freshmediaskin', ["jquery","core/log","filter_poodll/utils_amd","filter_poodll/dlg_devicesettings","filter_poodll/anim_progress_bar_fresh","filter_poodll/anim_hwave_fresh","filter_poodll/anim_hwave_timer","filter_poodll/upskin_text"],(function($,log,utils,settings,anim_progress_bar,hwave,hwave_timer,upskin){return log.debug("PoodLL BMR Skin: initialising"),{instanceprops:null,pmr:null,uploaded:!1,devsettings:null,therecanim:null,canpause:!0,clone:function(){return $.extend(!0,{},this)},init:function(ip,pmr){this.instanceprops=ip,this.pmr=pmr,this.devsettings=settings.clone(),this.devsettings.init(pmr,ip)},fetch_instanceprops:function(){return this.instanceprops},onUploadSuccess:function(controlbarid){$("#"+controlbarid+" > .poodll_save-recording").hide(),$("#"+controlbarid+" > .poodll_savedsuccessfully").show()},onUploadFailure:function(controlbarid){},fetch_status_bar:function(skin){return'<div class="poodll_status_'+skin+'">00:00:00</div>'},fetch_preview_audio:function(skin){return'<audio class="poodll_preview_'+skin+'" style="display: none;" controls playsinline="playsinline" muted></audio>'},fetch_preview_video:function(skin){return'<video class="poodll_preview_'+skin+'" playsinline="playsinline" muted></video>'},fetch_resource_audio:function(skin){return""},fetch_resource_video:function(skin){return""},fetch_uploader_skin:function(controlbarid,element){var ip=this.fetch_instanceprops(),theupskin=upskin.clone();return theupskin.init(ip.config,element,ip.controlbar.bmr_progresscanvas,ip.controlbar.status),theupskin},onMediaError:function(e){console.error("media error",e)},onMediaSuccess_video:function(controlbarid){var ip=this.fetch_instanceprops();ip.uploader.Output(""),this.set_visual_mode("recordmode",controlbarid),ip.timer.reset(),ip.timer.start(),this.update_status(controlbarid)},onMediaSuccess_audio:function(controlbarid){var ip=this.fetch_instanceprops();ip.uploader.Output(""),ip.controlbar.preview.attr("src",null),this.set_visual_mode("recordmode",controlbarid),this.therecanim.start(),ip.timer.reset(),ip.timer.start(),this.update_status(controlbarid)},handle_timer_update:function(controlbarid){var ip=this.fetch_instanceprops();ip.controlbar.status.html(ip.timer.fetch_display_time()),0==ip.timer.seconds&&ip.timer.initseconds>0&&ip.controlbar.startbutton.hasClass("poodll_in_progress")&&ip.controlbar.startbutton.click()},update_status:function(controlbarid){var ip=this.fetch_instanceprops();ip.controlbar.status.html(ip.timer.fetch_display_time())},set_visual_mode:function(mode,controlbarid){var ip=this.fetch_instanceprops();switch(this.visualmode=mode,mode){case"initmode":ip.controlbar.statusText.text("Ready to record"),ip.controlbar.status.html("00:00:00"),ip.controlbar.stoprecbutton.attr("class","poodll_stop-recording_fresh poodll_fresh_stop_btn bmr_disabled"),ip.controlbar.startbutton.attr("class","poodll_start-recording_fresh poodll_fresh_main_btn"),ip.controlbar.playbutton.attr("class","poodll_play-recording_fresh poodll_fresh_play_btn bmr_disabled"),this.disable_button(ip.controlbar.savebutton),this.disable_button(ip.controlbar.recordAgain);break;case"recordmode":ip.controlbar.statusText.text("Recording.."),this.enable_button(ip.controlbar.startbutton),this.show_element(ip.controlbar.startbutton),this.hide_element(ip.controlbar.bmr_progresscanvas),this.enable_button(ip.controlbar.pausebutton),this.show_element(ip.controlbar.pausebutton),this.disable_button(ip.controlbar.playbutton),this.hide_element(ip.controlbar.resumebutton),this.enable_button(ip.controlbar.stoprecbutton),this.disable_button(ip.controlbar.savebutton),this.disable_button(ip.controlbar.recordAgain),ip.controlbar.preview.addClass("poodll_recording"),ip.controlbar.status.addClass("poodll_recording"),ip.controlbar.preview.removeClass("poodll_playing"),ip.controlbar.status.removeClass("poodll_playing"),ip.controlbar.startbutton.addClass("poodll_in_progress").removeClass("poodll_resume_button"),ip.controlbar.playbutton.removeClass("poodll_play_special poodll_play_green"),"audio"==ip.config.mediatype&&this.hide_element(ip.controlbar.preview),ip.controlbar.root.removeClass("poodll_controllbar_playmode");break;case"previewmode":ip.controlbar.statusText.text("Ready to Play"),this.disable_button(ip.controlbar.stoprecbutton),this.disable_button(ip.controlbar.startbutton),this.enable_button(ip.controlbar.playbutton),this.disable_button(ip.controlbar.pausebutton),ip.controlbar.status.html(ip.timer.fetch_display_time(ip.timer.finalSeconds)),this.show_element(ip.controlbar.startbutton),this.disable_button(ip.controlbar.resumebutton),this.hide_element(ip.controlbar.resumebutton),this.hide_element(ip.controlbar.bmr_progresscanvas),this.uploaded?(this.disable_button(ip.controlbar.savebutton),this.disable_button(ip.controlbar.recordAgain)):(this.enable_button(ip.controlbar.savebutton),this.enable_button(ip.controlbar.recordAgain)),this.show_element(ip.controlbar.pausebutton),ip.controlbar.preview.removeClass("poodll_recording"),ip.controlbar.status.removeClass("poodll_recording"),ip.controlbar.preview.removeClass("poodll_playing"),ip.controlbar.status.removeClass("poodll_playing"),ip.controlbar.startbutton.removeClass("poodll_in_progress"),ip.controlbar.playbutton.addClass("poodll_play_green").removeClass("poodll_play_special").removeClass("poodll_play_pause").removeClass("poodll_stop_green"),"audio"==ip.config.mediatype&&this.show_element(ip.controlbar.preview),this.enable_button(ip.controlbar.playbutton),ip.controlbar.root.removeClass("poodll_controllbar_playmode poodll_controllbar_pausemode");break;case"playmode":ip.controlbar.statusText.text("Playing"),ip.controlbar.status.html("00:00:00"),this.enable_button(ip.controlbar.stoprecbutton),this.enable_button(ip.controlbar.pausebutton),this.disable_button(ip.controlbar.startbutton),this.disable_button(ip.controlbar.resumebutton),this.disable_button(ip.controlbar.savebutton),this.disable_button(ip.controlbar.recordAgain),this.show_element(ip.controlbar.bmr_progresscanvas),ip.controlbar.playbutton.removeClass("poodll_play_green").removeClass("poodll_play_special").addClass("poodll_stop_green"),ip.controlbar.preview.addClass("poodll_playing"),ip.controlbar.status.addClass("poodll_playing"),this.show_element(ip.controlbar.startbutton),this.hide_element(ip.controlbar.resumebutton),ip.controlbar.root.addClass("poodll_controllbar_playmode").removeClass("poodll_controllbar_pausemode");break;case"pausedmode":ip.controlbar.statusText.text("Paused"),this.show_element(ip.controlbar.resumebutton),this.enable_button(ip.controlbar.resumebutton),this.enable_button(ip.controlbar.savebutton),ip.controlbar.preview.removeClass("poodll_recording"),ip.controlbar.status.removeClass("poodll_recording"),ip.controlbar.startbutton.removeClass("poodll_in_progress").addClass("poodll_resume_button"),ip.controlbar.playbutton.removeClass("poodll_play_green").removeClass("poodll_play_pause"),ip.controlbar.root.addClass("poodll_controllbar_pausemode");break;case"uploadmode":ip.controlbar.statusText.text("Uploading"),this.disable_button(ip.controlbar.savebutton),this.disable_button(ip.controlbar.recordAgain),this.disable_button(ip.controlbar.startbutton),this.show_element(ip.controlbar.bmr_progresscanvas),ip.controlbar.root.removeClass("poodll_controllbar_playmode poodll_controllbar_pausemode")}},insert_controlbar_video:function(element,controlbarid,preview,resource){return this.prepare_controlbar(element,controlbarid,preview,resource,"video")},insert_controlbar_audio:function(element,controlbarid,preview,resource){return this.prepare_controlbar(element,controlbarid,preview,resource,"audio")},prepare_controlbar:function(element,controlbarid,preview,resource,mediatype){var ip=this.fetch_instanceprops(),skin_style=ip.config.media_skin_style,size_class="poodll_mediarecorder_size_auto";switch(ip.config.size){case"small":size_class="poodll_mediarecorder_size_small";break;case"big":size_class="poodll_mediarecorder_size_big";break;case"auto":size_class="poodll_mediarecorder_size_auto"}var ss=this.pmr.fetch_strings(),controls='<div class="poodll_mediarecorderholder_fresh poodll_videorecorderholder_fresh '+("video"==mediatype?"poodll_mediarecorder_video":"poodll_mediarecorder_audio")+" "+size_class+'" id="holder_'+controlbarid+'">';controls+='<div class="poodll_mediarecorderbox_fresh" id="'+controlbarid+'">',controls+='<audio style="display: none !important;" class="poodll-alert-recording" id="'+controlbarid+'"><source src="#" type="audio/mpeg"></audio>',controls+='<div class="style-holder '+skin_style+'">',controls+='<div class="poodll_statusholder_fresh" >',controls+=this.fetch_status_bar("fresh"),controls+="</div>",controls+='<div class="poodll_fresh_musik_line"><canvas class="fresh_range"></canvas><canvas id="'+controlbarid+'_playcanvas" class="poodll_fresh_playcanvas" width="300" height="50"></canvas><div class="poodll_fresh_wave"></div></div><div class="poodll_fresh_control"><div class="poodll_fresh_txt_control">'+ss.recui_readytorecord+'</div><div class="poodll_fresh_settings_btn settingsicon" data-toggle="modal" data-target="#myModal id="settingsicon_'+controlbarid+'"></div><div class="poodll_start-recording_fresh poodll_fresh_main_btn"></div><div class="poodll_stop-playing-recording_fresh" style="display: none;"></div><div class="poodll_pause-recording_fresh poodll_fresh_pause_btn bmr_disabled"></div><div class="poodll_play-recording_fresh poodll_fresh_play_btn bmr_disabled"></div></div><div class="poodll_fresh_bottom_btns"><a class="poodll_save-recording_fresh poodll_fresh_upload_btn bmr_disabled" href="#">'+ss.recui_upload+'</a><a class="poodll_fresh_record_btn bmr_disabled" href="#">'+ss.recui_recordagain+"</a></div>",controls+=preview,controls+="</div>",controls+=this.devsettings.fetch_dialogue_box(),controls+=ip.downloaddialog.fetch_dialogue_box(),controls+=ip.errordialog.fetch_dialogue_box(),controls+="</div>",controls+="</div>",$(element).prepend(controls);var controlbar={poodll_recording_alert:$("#"+controlbarid+" .poodll-alert-recording"),bmr_progresscanvas:$("#"+controlbarid+" .fresh_range"),settingsdialog:$("#"+controlbarid+" .poodll_dialogue_box_settings"),downloaddialog:$("#"+controlbarid+" .poodll_dialogue_box_download"),errorsdialog:$("#"+controlbarid+" .poodll_dialogue_box_errors"),settingsicon:$("#"+controlbarid+" .settingsicon"),status:$("#"+controlbarid+" .poodll_status_fresh"),statusText:$("#"+controlbarid+" .poodll_fresh_txt_control"),preview:$("#"+controlbarid+" .poodll_preview_fresh"),startbutton:$("#"+controlbarid+" .poodll_start-recording_fresh"),stoprecbutton:$("#"+controlbarid+" .poodll_stop-recording_fresh"),pausebutton:$("#"+controlbarid+" .poodll_pause-recording_fresh"),resumebutton:$("#"+controlbarid+" .poodll_resume-recording_fresh"),playbutton:$("#"+controlbarid+" .poodll_play-recording_fresh"),stopbutton:$("#"+controlbarid+" .poodll_stop-playing-recording_fresh"),savebutton:$("#"+controlbarid+" .poodll_save-recording_fresh"),recordAgain:$("#"+controlbarid+" .poodll_fresh_record_btn"),playcanvas:$("#"+controlbarid+"_playcanvas"),root:$("#"+controlbarid)};return ip.downloaddialog.set_dialogue_box(controlbar.downloaddialog),ip.errordialog.set_dialogue_box(controlbar.errorsdialog),this.devsettings.set_dialogue_box(controlbar.settingsdialog),controlbar},register_controlbar_events_video:function(onMediaSuccess,controlbarid){return this.register_controlbar_events_audio(onMediaSuccess,controlbarid)},register_controlbar_events_audio:function(onMediaSuccess,controlbarid){var self=this,pmr=this.pmr,ip=this.fetch_instanceprops();ip.controlbar.settingsicon.click((function(){self.uploaded?ip.downloaddialog.open():self.devsettings.open()}));var hprogress=anim_progress_bar.clone();hprogress.init(ip.controlbar.bmr_progresscanvas),hprogress.readyBars();var recanim=hwave.clone();recanim.init(ip.audioanalyser,ip.controlbar.playcanvas.get(0)),ip.controlbar.startbutton.click((function(){if($(this).hasClass("poodll_in_progress")){pmr.do_stop_audio(ip);var preview=ip.controlbar.preview;preview&&preview.get(0)&&preview.get(0).pause(),recanim.clear(),ip.timer.stop(),self.update_status(controlbarid),self.set_visual_mode("previewmode",controlbarid)}else $(this).hasClass("poodll_resume_button")?(pmr.do_resume_audio(ip),ip.timer.resume(),self.update_status(controlbarid),self.set_visual_mode("recordmode",controlbarid)):(self.therecanim=recanim,pmr.do_start_audio(ip,onMediaSuccess))})),ip.controlbar.recordAgain.click((function(){pmr.do_stop_audio(ip),self.update_status(controlbarid),self.set_visual_mode("initmode",controlbarid)})),ip.controlbar.stoprecbutton.click((function(){pmr.do_stop_audio(ip);var preview=ip.controlbar.preview;preview&&preview.get(0)&&preview.get(0).pause(),recanim.clear(),ip.timer.stop(),self.update_status(controlbarid),self.set_visual_mode("previewmode",controlbarid)})),ip.controlbar.pausebutton.click((function(){pmr.do_pause_audio(ip);var preview=ip.controlbar.preview;preview&&preview.get(0)&&(preview.get(0).pause(),preview.get(0).controls=!1),console.log("PAUSE"),ip.timer.pause(),self.update_status(controlbarid),self.set_visual_mode("pausedmode",controlbarid)})),ip.controlbar.resumebutton.click((function(){pmr.do_resume_audio(ip),ip.timer.resume(),self.update_status(controlbarid),self.set_visual_mode("recordmode",controlbarid)})),ip.controlbar.preview.on("timeupdate",(function(){if("playmode"==self.visualmode){var currentTime=this.currentTime;ip.controlbar.status.html(ip.timer.fetch_display_time(currentTime))}})),ip.controlbar.stopbutton.click((function(){pmr.do_stop_audio(ip);var preview=ip.controlbar.preview;preview&&preview.get(0)&&preview.get(0).pause(),recanim.clear(),ip.timer.stop(),self.update_status(controlbarid),self.set_visual_mode("previewmode",controlbarid)})),ip.controlbar.playbutton.click((function(){if($(this).hasClass("poodll_play_pause")){var preview=ip.controlbar.preview.get(0);pmr.do_stopplay_audio(ip,preview),pmr.do_stop_audio(ip),ip.timer.pause(),self.update_status(controlbarid),self.set_visual_mode("pausedmode",controlbarid)}else if($(this).hasClass("poodll_stop_green")){pmr.do_stop_audio(ip),(preview=ip.controlbar.preview)&&preview.get(0)&&preview.get(0).pause(),recanim.clear(),ip.timer.stop(),self.update_status(controlbarid),self.set_visual_mode("previewmode",controlbarid)}else{preview=ip.controlbar.preview.get(0);pmr.do_play_audio(ip,preview),self.set_visual_mode("playmode",controlbarid),hprogress.clear(),hprogress.fetchCurrent=function(){var ct=ip.controlbar.preview.prop("currentTime"),duration=ip.controlbar.preview.prop("duration");return isFinite(duration)||(duration=ip.timer.finalseconds),ct/duration},hprogress.start();var ct=ip.controlbar.preview.prop("currentTime"),duration=ip.controlbar.preview.prop("duration");hprogress.playBars(ct,duration)}})),ip.controlbar.savebutton.click((function(){return ip.blobs&&ip.blobs.length>0?(self.set_visual_mode("uploadmode",controlbarid),pmr.do_save_audio(ip),self.uploaded=!0):ip.uploader.Output(M.util.get_string("recui_nothingtosaveerror","filter_poodll")),!1})),window.onbeforeunload=function(){self.enable_button(ip.controlbar.startbutton);var preview=ip.controlbar.preview;preview&&preview.get(0)&&(preview.get(0).pause(),preview.get(0).controls=!1)}},show_element:function(element){$(element).show()},hide_element:function(element){$(element).hide()},enable_button:function(button){$(button).attr("disabled",!1),$(button).removeClass("bmr_disabled")},disable_button:function(button){$(button).attr("disabled",!0),$(button).addClass("bmr_disabled")}}}));
define('filter_poodll/dlg_errordisplay', ["jquery","core/log","filter_poodll/dlg_poodll"],(function($,log,dialog){return log.debug("Error display dialog: initialising"),{dlg:null,instanceprops:null,dlgbox:null,init:function(instanceprops){this.dlg=dialog.clone(),this.dlg.setHeader("Error"),this.instanceprops=instanceprops},clone:function(){return $.extend(!0,{},this)},fetch_dialogue_box:function(){return this.dlg.fetch_dialogue_box("errors")},set_dialogue_box:function(dlgbox){this.dlgbox=dlgbox,this.dlg.set_dialogue_box(dlgbox)},open:function(message){this.instanceprops;var content='<div class="filter_poodll_errordisplay">',displaytext=message;message.name&&(displaytext=M.util.get_string("recui_media"+message.name.toLowerCase(),"filter_poodll")),content+="<span>"+displaytext+"</span>",content+="</div>",this.dlg.setContent(content),this.registerEvents(),this.dlg.open()},registerEvents:function(){}}}));
define('filter_poodll/poodll_fbmediaskin', ["jquery","core/log","filter_poodll/utils_amd"],(function($,log,utils){return log.debug("PoodLL Fluencybuilder Skin: initialising"),{instanceprops:null,pmr:null,uploaded:!1,clone:function(){return $.extend(!0,{},this)},init:function(ip,pmr){this.instanceprops=ip,this.instanceprops.warmedup=!1,this.pmr=pmr},fetch_instanceprops:function(){return this.instanceprops},onUploadSuccess:function(controlbarid){$("#"+controlbarid+" > .poodll_save-recording").hide(),$("#"+controlbarid+" > .poodll_savedsuccessfully").show()},onUploadFailure:function(controlbarid){},fetch_status_bar:function(skin){return'<div class="poodll_status_'+skin+' hide"></div>'},fetch_preview_audio:function(skin){return'<audio class="poodll_checkplayer_'+skin+' hide" playsinline="playsinline" muted></audio>'},fetch_model_audio:function(){return'<audio class="poodll_modelplayer_fluencybuilder hide" src="'+M.cfg.wwwroot+'/filter/poodll/ding.mp3" playsinline="playsinline"></audio>'},fetch_preview_video:function(skin){return'<video class="poodll_checkplayer_'+skin+'" width="320" height="240" playsinline="playsinline" muted></video>'},fetch_resource_audio:function(skin){return'<audio class="poodll_resourceplayer_'+skin+' hide" src="'+M.cfg.wwwroot+'/filter/poodll/ding.mp3" playsinline="playsinline"></audio>'},fetch_resource_video:function(skin){return'<video class="poodll_resourceplayer_'+skin+' hide" src="@@RESOURCEURLx@@" playsinline="playsinline"></video>'},fetch_uploader_skin:function(controlbarid,element){return!1},fetch_ding_player:function(){return'<audio class="poodll_dingplayer_fluencybuilder hide"  src="'+M.cfg.wwwroot+'/filter/poodll/ding.mp3" ></audio>'},onMediaError:function(e){console.error("media error",e)},onMediaSuccess_video:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);this.highlight_button("bwrapper_start-recording",controlbarid),ip.uploader.Output(""),ip.timer.reset(),ip.timer.start(),this.update_status(controlbarid),ip.controlbar.stopbutton.attr("disabled",!1),ip.controlbar.savebutton.attr("disabled",!1)},onMediaSuccess_audio:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.checkplayer.attr("src",null),this.pmr.do_pause_audio(ip)},handle_timer_update:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);this.update_status(controlbarid),0==ip.timer.seconds&&ip.timer.initseconds>0&&ip.controlbar.stoprecbutton.click()},update_status:function(controlbarid){},insert_controlbar_video:function(element,controlbarid,checkplayer,resourceplayer){return this.prepare_controlbar(element,controlbarid,checkplayer,resourceplayer,"video")},insert_controlbar_audio:function(element,controlbarid,checkplayer,resourceplayer){return this.prepare_controlbar(element,controlbarid,checkplayer,resourceplayer,"audio")},prepare_controlbar:function(element,controlbarid,checkplayer,resourceplayer,mediatype){var ip=this.fetch_instanceprops(controlbarid),skin_style=ip.config.media_skin_style,recorder_class="video"==mediatype?"poodll_mediarecorder_video":"poodll_mediarecorder_audio",modelplayer=(resourceplayer=resourceplayer.replace("@@RESOURCEURL@@",ip.config.resource),this.fetch_model_audio());modelplayer=modelplayer.replace("@@MODELURL@@",ip.config.resource2);var dingplayer=this.fetch_ding_player(),status=this.fetch_status_bar("fluencybuilder"),size_class="poodll_mediarecorder_size_auto";switch(ip.config.size){case"small":size_class="poodll_mediarecorder_size_small";break;case"big":size_class="poodll_mediarecorder_size_big";break;case"auto":size_class="poodll_mediarecorder_size_auto"}var controls='<div class="poodll_mediarecorderholder_fluencybuilder '+recorder_class+" "+size_class+'" id="holder_'+controlbarid+'">';return controls+='<div class="poodll_mediarecorderbox_fluencybuilder" id="'+controlbarid+'">',controls+='<div class="style-holder '+skin_style+'">',controls+=status,controls+=dingplayer,controls+=modelplayer,controls+=checkplayer,controls+=resourceplayer,controls+='<div class="fb_bwrapper bwrapper_play-resource mod_fluencybuilder_autobutton_inactive"><button type="button" class="poodll_mediarecorder_button_fluencybuilder poodll_play-resource_fluencybuilder"><i class="fa fa-assistive-listening-systems" aria-hidden="true"></i></button></div>',controls+='<div class="fb_bwrapper bwrapper_start-recording mod_fluencybuilder_autobutton_inactive"><button type="button" class="poodll_mediarecorder_button_fluencybuilder poodll_start-recording_fluencybuilder" disabled><i class="fa fa-microphone" aria-hidden="true"></i></button></div>',controls+='<div class="fb_bwrapper bwrapper_play-model mod_fluencybuilder_autobutton_inactive"> <button type="button" class="poodll_mediarecorder_button_fluencybuilder poodll_play-model_fluencybuilder" disabled><i class="fa fa-play-circle" aria-hidden="true"></i></button></div>',controls+='<button type="button" class="poodll_mediarecorder_button_fluencybuilder poodll_play-recording_fluencybuilder hide">'+M.util.get_string("recui_play","filter_poodll")+"</button>",controls+='<button type="button" class="poodll_mediarecorder_button_fluencybuilder poodll_stop-playing_fluencybuilder hide">stopplay</button>',controls+='<button type="button" class="poodll_mediarecorder_button_fluencybuilder poodll_stop-recording_fluencybuilder hide">'+M.util.get_string("recui_stop","filter_poodll")+"</button>",controls+='<button type="button" class="poodll_save-recording_fluencybuilder pmr_disabled hide">'+M.util.get_string("recui_save","filter_poodll")+"</button>",controls+="</div></div></div>",$(element).prepend(controls),{status:$("#"+controlbarid+"  .poodll_status_fluencybuilder"),dingplayer:$("#"+controlbarid+"  .poodll_dingplayer_fluencybuilder"),modelplayer:$("#"+controlbarid+"  .poodll_modelplayer_fluencybuilder"),resourceplayer:$("#"+controlbarid+"  .poodll_resourceplayer_fluencybuilder"),checkplayer:$("#"+controlbarid+"  .poodll_checkplayer_fluencybuilder"),resourcebutton:$("#"+controlbarid+"  .poodll_play-resource_fluencybuilder"),startbutton:$("#"+controlbarid+"  .poodll_start-recording_fluencybuilder"),stoprecbutton:$("#"+controlbarid+"  .poodll_stop-recording_fluencybuilder"),stopbutton:$("#"+controlbarid+"  .poodll_stop-playing_fluencybuilder"),playbutton:$("#"+controlbarid+"  .poodll_play-recording_fluencybuilder"),playmodelbutton:$("#"+controlbarid+"  .poodll_play-model_fluencybuilder"),savebutton:$("#"+controlbarid+"  .poodll_save-recording_fluencybuilder"),resourcewrapper:$("#"+controlbarid+"  .bwrapper_play-resource"),startrecwrapper:$("#"+controlbarid+"  .bwrapper_start-recording"),playmodelwrapper:$("#"+controlbarid+"  .bwrapper_play-model")}},register_controlbar_events_video:function(onMediaSuccess,controlbarid){return this.register_controlbar_events_audio(onMediaSuccess,controlbarid)},play_ding:function(action,controlbarid){var ip=this.fetch_instanceprops(controlbarid);switch(ip.controlbar.dingplayer[0].play(),action){case"click_start":ip.controlbar.startbutton.click();break;case"click_play":ip.controlbar.playmodelbutton.click();break;case"show_dialog":alert("dialog");break;default:ip.controlbar.dingplayer[0].onended=null}},highlight_button:function(highlightwrapper,controlbarid){var wrappers=$("#"+controlbarid+"  .fb_bwrapper");$(wrappers).each((function(index){$(this).hasClass(highlightwrapper)?($(this).removeClass("mod_fluencybuilder_autobutton_inactive"),$(this).addClass("mod_fluencybuilder_autobutton_active")):($(this).removeClass("mod_fluencybuilder_autobutton_active"),$(this).addClass("mod_fluencybuilder_autobutton_inactive"))}))},warmup_recorder:function(controlbarid,onMediaSuccess){var ip=this.fetch_instanceprops(controlbarid);this.pmr.warmup_context(ip),this.pmr.warmup_preview(ip),this.pmr.do_start_audio(ip,onMediaSuccess);var model=ip.controlbar.modelplayer.get(0),ding=ip.controlbar.dingplayer.get(0),resource=ip.controlbar.resourceplayer.get(0);if(!ip.warmedup)try{resource.play(),ding.play(),model.play(),resource.pause(),ding.pause(),model.pause()}catch(e){}var dingurl=M.cfg.wwwroot+"/filter/poodll/ding.mp3";$(model).attr("src",ip.config.resource2),$(ding).attr("src",dingurl),$(resource).attr("src",ip.config.resource),ip.warmedup=!0},register_controlbar_events_audio:function(onMediaSuccess,controlbarid){var self=this,pmr=this.pmr,ip=this.fetch_instanceprops(controlbarid);ip.controlbar.resourceplayer.on("ended",(function(){ip.warmedup&&self.play_ding("click_start",controlbarid)})),ip.controlbar.modelplayer.on("ended",(function(){self.highlight_button("",controlbarid)})),ip.controlbar.startbutton.click((function(){pmr.do_resume_audio(ip),self.highlight_button("bwrapper_start-recording",controlbarid),ip.uploader.Output(""),ip.timer.reset(),ip.timer.start(),self.update_status(controlbarid),ip.controlbar.stopbutton.attr("disabled",!1),ip.controlbar.savebutton.attr("disabled",!1)})),ip.controlbar.stoprecbutton.click((function(){pmr.do_stop_audio(ip),self.play_ding("click_play",controlbarid),ip.timer.stop(),self.update_status(controlbarid)})),ip.controlbar.stopbutton.click((function(){self.highlight_button("none",controlbarid),ip.timer.stop(),self.update_status(controlbarid)})),ip.controlbar.playmodelbutton.click((function(){ip.controlbar.modelplayer.get(0).play(),self.highlight_button("bwrapper_play-model",controlbarid)})),ip.controlbar.playbutton.click((function(){var checkplayer=ip.controlbar.checkplayer.get(0);pmr.do_play_audio(ip,checkplayer)})),ip.controlbar.resourcebutton.click((function(){self.warmup_recorder(controlbarid,onMediaSuccess),self.disable_button(this),ip.controlbar.resourceplayer.get(0).play(),self.highlight_button("bwrapper_play-resource",controlbarid)})),ip.controlbar.savebutton.click((function(){return self.disable_button(this),ip.blobs&&ip.blobs.length>0?(pmr.do_save_audio(ip),self.uploaded=!0,self.disable_button(ip.controlbar.startbutton)):ip.uploader.Output(M.util.get_string("recui_nothingtosaveerror","filter_poodll")),!1})),window.onbeforeunload=function(){self.enable_button(ip.controlbar.startbutton);var checkplayer=ip.controlbar.checkplayer;checkplayer&&checkplayer.get(0)&&checkplayer.get(0).pause()}},enable_button:function(button){$(button).prop("disabled",!1)},disable_button:function(button){$(button).prop("disabled",!0)},show_button:function(button){button.show()},hide_button:function(button){button.hide()}}}));
define('filter_poodll/upskin_radial', ["jquery","core/log","filter_poodll/anim_progress_radial"],(function($,log,radial){return log.debug("upskin_bar: initialising"),{element:null,cvs:null,percent:0,progressradial:null,messagearea:null,clone:function(){return $.extend(!0,{},this)},init:function(config,element,cvs,messagearea){this.config=config,this.element=element,this.cvs=cvs,this.progressradial=radial.clone(),this.messagearea=messagearea},setDrawParam:function(paramkey,paramvalue){this.progressradial.setDrawParam(paramkey,paramvalue)},initControls:function(){var self=this;this.progressradial.init(this.cvs,"#93c47d",!0),this.progressradial.fetchCurrent=function(){return self.percent}},initProgressSession:function(xhr){var self=this;self.percent=0;var uploadingmessage=M.util.get_string("recui_uploading","filter_poodll");xhr.upload.addEventListener("progress",(function(e){e.lengthComputable&&(self.percent=e.loaded/e.total,self.showMessage(uploadingmessage+"("+Math.floor(100*self.percent)+"%)"))})),this.progressradial.start()},deactivateProgressSession:function(){this.progressradial.stop(),log.debug("deactivating session")},showMessage:function(msg,msgid){if("recui_awaitingconversion"===msgid);else this.messagearea.html(msg)}}}));
define('filter_poodll/upskin_bar', ["jquery","core/log","filter_poodll/anim_progress_bar"],(function($,log,bar){return log.debug("upskin_bar: initialising"),{element:null,cvs:null,percent:0,progressbar:null,messagearea:null,clone:function(){return $.extend(!0,{},this)},init:function(config,element,cvs,messagearea){this.config=config,this.element=element,this.cvs=cvs,this.progressbar=bar.clone(),this.messagearea=messagearea},initControls:function(){var self=this;this.progressbar.init(this.cvs,"#BCCCCC"),this.progressbar.fetchCurrent=function(){return self.percent}},initProgressSession:function(xhr){var self=this;self.percent=0;var uploadingmessage=M.util.get_string("recui_uploading","filter_poodll");xhr.upload.addEventListener("progress",(function(e){e.lengthComputable&&(self.percent=e.loaded/e.total,self.showMessage(uploadingmessage+"("+Math.floor(100*self.percent)+"%)"))})),this.progressbar.start()},deactivateProgressSession:function(){this.progressbar.stopthere(),log.debug("deactivating session")},showMessage:function(msg,msgid){this.messagearea.html(msg)}}}));
define('filter_poodll/dlg_download', ["jquery","core/log","filter_poodll/dlg_poodll","filter_poodll/utils_amd"],(function($,log,dialog,utils){return log.debug("download dialog: initialising"),{dlg:null,instanceprops:null,pmr:null,dlgbox:null,init:function(pmr,instanceprops){this.dlg=dialog.clone(),this.dlg.setHeader("Download"),this.instanceprops=instanceprops,this.pmr=pmr},clone:function(){return $.extend(!0,{},this)},fetch_blob_url:function(){var concatenatedBlob=utils.simpleConcatenateBlobs(this.instanceprops.blobs,this.instanceprops.blobs[0].type);return URL.createObjectURL(concatenatedBlob)},fetch_dialogue_box:function(){return this.dlg.fetch_dialogue_box("download")},set_dialogue_box:function(dlgbox){this.dlgbox=dlgbox,this.dlg.set_dialogue_box(dlgbox)},open:function(){var self=this,ip=this.instanceprops,ext="",nowdatetime=(new Date).toISOString().replace(/[^0-9]/g,""),filename=ip.config.mediatype+"_"+nowdatetime;utils.doConcatenateBlobs(this.instanceprops.blobs,(function(concatenatedBlob){switch(concatenatedBlob.type){case"audio/wav":case"audio/pcm":ext=".wav";break;case"audio/ogg":ext=".ogg";break;case"audio/webm":case"video/webm":ext=".webm";break;default:var bits=concatenatedBlob.type.split("/");bits.length>1&&(ext="."+bits[1])}filename+=ext;var theurl=URL.createObjectURL(concatenatedBlob),displaytext=M.util.get_string("recui_downloadfile","filter_poodll"),content='<div class="filter_poodll_dlgdownload_content">';content+='<a href="'+theurl+'" download="'+filename+'" class="btn btn-secondary">'+displaytext+"</a>",content+="</div>",self.dlg.setContent(content),self.registerEvents(),self.dlg.open()}))},registerEvents:function(){}}}));
function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}!function(t){if("object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define("filter_poodll/literallycanvas",[],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).LC=t()}}((function(){return function t(e,n,i){function r(s,a){if(!n[s]){if(!e[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[s]={exports:{}};e[s][0].call(c.exports,(function(t){var n=e[s][1][t];return r(n||t)}),c,c.exports,t,e,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(t,e,n){var r=Object.prototype.hasOwnProperty;e.exports=function(t,e){if(t===e)return!0;if("object"!=_typeof(t)||null===t||"object"!=_typeof(e)||null===e)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(var o=r.bind(e),s=0;s<n.length;s++)if(!o(n[s])||t[n[s]]!==e[n[s]])return!1;return!0}},{}],2:[function(t,e,n){e.exports=t("react/lib/ReactComponentWithPureRenderMixin")},{"react/lib/ReactComponentWithPureRenderMixin":3}],3:[function(t,e,n){var i=t("./shallowCompare"),r={shouldComponentUpdate:function(t,e){return i(this,t,e)}};e.exports=r},{"./shallowCompare":4}],4:[function(t,e,n){var r=t("fbjs/lib/shallowEqual");e.exports=function(t,e,n){return!r(t.props,e)||!r(t.state,n)}},{"fbjs/lib/shallowEqual":1}],5:[function(t,e,n){var i,r,a,h,c,u,p,f,g,m,y,v=[].slice,x=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};a=t("./actions"),h=t("./bindEvents"),c=t("./math"),(u=t("./shapes")).createShape,m=u.shapeToJSON,r=u.JSONToShape,p=t("./canvasRenderer").renderShapeToContext,t("./svgRenderer").renderShapeToSVG,f=t("./renderSnapshotToImage"),g=t("./renderSnapshotToSVG"),t("../tools/Pencil"),y=t("./util"),i="infinite",e.exports=function(){function t(t,e){var n,r;this.setImageSize=function(t,e){return function(){return t.apply(e,arguments)}}(this.setImageSize,this),r=null,n=null,t instanceof HTMLElement?(n=t,r=e):r=t,this.opts=r||{},this.config={zoomMin:r.zoomMin||.2,zoomMax:r.zoomMax||4,zoomStep:r.zoomStep||.2},this.colors={primary:r.primaryColor||"#000",secondary:r.secondaryColor||"#fff",background:r.backgroundColor||"transparent"},this.watermarkImage=r.watermarkImage,this.watermarkScale=r.watermarkScale||1,this.backgroundCanvas=document.createElement("canvas"),this.backgroundCtx=this.backgroundCanvas.getContext("2d"),this.canvas=document.createElement("canvas"),this.canvas.style["background-color"]="transparent",this.buffer=document.createElement("canvas"),this.buffer.style["background-color"]="transparent",this.ctx=this.canvas.getContext("2d"),this.bufferCtx=this.buffer.getContext("2d"),this.backingScale=y.getBackingScale(this.ctx),this.backgroundShapes=r.backgroundShapes||[],this._shapesInProgress=[],this.shapes=[],this.undoStack=[],this.redoStack=[],this.isDragging=!1,this.position={x:0,y:0},this.scale=1,this.setTool(new this.opts.tools[0](this)),this.width=r.imageSize.width||i,this.height=r.imageSize.height||i,this.setZoom(this.scale),r.snapshot&&this.loadSnapshot(r.snapshot),this.isBound=!1,n&&this.bindToElement(n),this.respondToSizeChange=function(){}}return t.prototype.bindToElement=function(t){var e,n;return this.containerEl?void console.warn("Trying to bind Literally Canvas to a DOM element more than once is unsupported."):(this.containerEl=t,this._unsubscribeEvents=h(this,this.containerEl,this.opts.keyboardShortcuts),this.containerEl.style["background-color"]=this.colors.background,this.containerEl.appendChild(this.backgroundCanvas),this.containerEl.appendChild(this.canvas),this.isBound=!0,n=function(t){return function(){return t.keepPanInImageBounds(),t.repaintAllLayers()}}(this),this.respondToSizeChange=y.matchElementSize(this.containerEl,[this.backgroundCanvas,this.canvas],this.backingScale,n),this.watermarkImage&&(this.watermarkImage.onload=function(t){return function(){return t.repaintLayer("background")}}(this)),null!=(e=this.tool)&&e.didBecomeActive(this),n())},t.prototype._teardown=function(){var t;return null!=(t=this.tool)&&t.willBecomeInactive(this),"function"==typeof this._unsubscribeEvents&&this._unsubscribeEvents(),this.tool=null,this.containerEl=null,this.isBound=!1},t.prototype.trigger=function(t,e){return this.canvas.dispatchEvent(new CustomEvent(t,{detail:e})),null},t.prototype.on=function(t,e){var n;return n=function(t){return e(t.detail)},this.canvas.addEventListener(t,n),function(e){return function(){return e.canvas.removeEventListener(t,n)}}(this)},t.prototype.getRenderScale=function(){return this.scale*this.backingScale},t.prototype.clientCoordsToDrawingCoords=function(t,e){return{x:(t*this.backingScale-this.position.x)/this.getRenderScale(),y:(e*this.backingScale-this.position.y)/this.getRenderScale()}},t.prototype.drawingCoordsToClientCoords=function(t,e){return{x:t*this.getRenderScale()+this.position.x,y:e*this.getRenderScale()+this.position.y}},t.prototype.setImageSize=function(t,e){return this.width=t||i,this.height=e||i,this.keepPanInImageBounds(),this.repaintAllLayers(),this.trigger("imageSizeChange",{width:this.width,height:this.height})},t.prototype.setTool=function(t){var e;return this.isBound&&null!=(e=this.tool)&&e.willBecomeInactive(this),this.tool=t,this.trigger("toolChange",{tool:t}),this.isBound?this.tool.didBecomeActive(this):void 0},t.prototype.setShapesInProgress=function(t){return this._shapesInProgress=t},t.prototype.pointerDown=function(t,e){var n;return n=this.clientCoordsToDrawingCoords(t,e),this.tool.usesSimpleAPI?(this.tool.begin(n.x,n.y,this),this.isDragging=!0,this.trigger("drawStart",{tool:this.tool})):(this.isDragging=!0,this.trigger("lc-pointerdown",{tool:this.tool,x:n.x,y:n.y,rawX:t,rawY:e}))},t.prototype.pointerMove=function(t,e){return y.requestAnimationFrame(function(n){return function(){var i,r;return i=n.clientCoordsToDrawingCoords(t,e),null!=(r=n.tool)&&r.usesSimpleAPI?n.isDragging?(n.tool.continue(i.x,i.y,n),n.trigger("drawContinue",{tool:n.tool})):void 0:n.isDragging?n.trigger("lc-pointerdrag",{tool:n.tool,x:i.x,y:i.y,rawX:t,rawY:e}):n.trigger("lc-pointermove",{tool:n.tool,x:i.x,y:i.y,rawX:t,rawY:e})}}(this))},t.prototype.pointerUp=function(t,e){var n;return n=this.clientCoordsToDrawingCoords(t,e),this.tool.usesSimpleAPI?this.isDragging?(this.tool.end(n.x,n.y,this),this.isDragging=!1,this.trigger("drawEnd",{tool:this.tool})):void 0:(this.isDragging=!1,this.trigger("lc-pointerup",{tool:this.tool,x:n.x,y:n.y,rawX:t,rawY:e}))},t.prototype.setColor=function(t,e){if(this.colors[t]=e,this.isBound){switch(t){case"background":this.containerEl.style.backgroundColor=this.colors.background,this.repaintLayer("background");break;case"primary":case"secondary":this.repaintLayer("main")}return this.trigger(t+"ColorChange",this.colors[t]),"background"===t?this.trigger("drawingChange"):void 0}},t.prototype.getColor=function(t){return this.colors[t]},t.prototype.saveShape=function(t,e,n){return null==e&&(e=!0),null==n&&(n=null),n||(n=this.shapes.length?this.shapes[this.shapes.length-1].id:null),this.execute(new a.AddShapeAction(this,t,n)),e&&this.trigger("shapeSave",{shape:t,previousShapeId:n}),this.trigger("drawingChange")},t.prototype.pan=function(t,e){return this.setPan(this.position.x-t,this.position.y-e)},t.prototype.keepPanInImageBounds=function(){var t,e,n,r;return e=this.getRenderScale(),n=(t=this.position).x,r=t.y,this.width!==i&&(n=this.canvas.width>this.width*e?(this.canvas.width-this.width*e)/2:Math.max(Math.min(0,n),this.canvas.width-this.width*e)),this.height!==i&&(r=this.canvas.height>this.height*e?(this.canvas.height-this.height*e)/2:Math.max(Math.min(0,r),this.canvas.height-this.height*e)),this.position={x:n,y:r}},t.prototype.setPan=function(t,e){return this.position={x:t,y:e},this.keepPanInImageBounds(),this.repaintAllLayers(),this.trigger("pan",{x:this.position.x,y:this.position.y})},t.prototype.zoom=function(t){var e;return e=this.scale+t,e=Math.max(e,this.config.zoomMin),e=Math.min(e,this.config.zoomMax),e=Math.round(100*e)/100,this.setZoom(e)},t.prototype.setZoom=function(t){var e;return e=this.scale,this.scale=t,this.position.x=c.scalePositionScalar(this.position.x,this.canvas.width,e,this.scale),this.position.y=c.scalePositionScalar(this.position.y,this.canvas.height,e,this.scale),this.keepPanInImageBounds(),this.repaintAllLayers(),this.trigger("zoom",{oldScale:e,newScale:this.scale})},t.prototype.setWatermarkImage=function(t){return this.watermarkImage=t,y.addImageOnload(t,function(t){return function(){return t.repaintLayer("background")}}(this)),t.width?this.repaintLayer("background"):void 0},t.prototype.repaintAllLayers=function(){var t,e,n,i;for(t=0,n=(i=["background","main"]).length;n>t;t++)e=i[t],this.repaintLayer(e);return null},t.prototype.repaintLayer=function(t,e){var n;if(null==e&&(e="main"===t),this.isBound){switch(t){case"background":this.backgroundCtx.clearRect(0,0,this.backgroundCanvas.width,this.backgroundCanvas.height),n=function(t){return function(){return t.repaintLayer("background")}}(this),this.watermarkImage&&this._renderWatermark(this.backgroundCtx,!0,n),this.draw(this.backgroundShapes,this.backgroundCtx,n);break;case"main":n=function(t){return function(){return t.repaintLayer("main",!0)}}(this),e&&(this.buffer.width=this.canvas.width,this.buffer.height=this.canvas.height,this.bufferCtx.clearRect(0,0,this.buffer.width,this.buffer.height),this.draw(this.shapes,this.bufferCtx,n)),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.width>0&&this.canvas.height>0&&(this.ctx.fillStyle="#ccc",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.clipped(function(t){return function(){return t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height),t.ctx.drawImage(t.buffer,0,0)}}(this),this.ctx),this.clipped(function(t){return function(){return t.transformed((function(){var e,n,i,r,o;for(r=[],e=0,n=(i=t._shapesInProgress).length;n>e;e++)o=i[e],r.push(p(t.ctx,o,{bufferCtx:t.bufferCtx,shouldOnlyDrawLatest:!0}));return r}),t.ctx,t.bufferCtx)}}(this),this.ctx,this.bufferCtx))}return this.trigger("repaint",{layerKey:t})}},t.prototype._renderWatermark=function(t,e,n){return null==e&&(e=!0),this.watermarkImage.width?(t.save(),t.translate(t.canvas.width/2,t.canvas.height/2),t.scale(this.watermarkScale,this.watermarkScale),e&&t.scale(this.backingScale,this.backingScale),t.drawImage(this.watermarkImage,-this.watermarkImage.width/2,-this.watermarkImage.height/2),t.restore()):void(this.watermarkImage.onload=n)},t.prototype.drawShapeInProgress=function(t){return this.repaintLayer("main",!1),this.clipped(function(e){return function(){return e.transformed((function(){return p(e.ctx,t,{bufferCtx:e.bufferCtx,shouldOnlyDrawLatest:!0})}),e.ctx,e.bufferCtx)}}(this),this.ctx,this.bufferCtx)},t.prototype.draw=function(t,e,n){var i;if(t.length)return i=function(){var i,r,o,s;for(o=[],i=0,r=t.length;r>i;i++)s=t[i],o.push(p(e,s,{retryCallback:n}));return o},this.clipped(function(t){return function(){return t.transformed(i,e)}}(this),e)},t.prototype.clipped=function(){var t,e,n,r,o,s,a,h,l,c,u,p;for(n=arguments[0],t=2<=arguments.length?v.call(arguments,1):[],u=this.width===i?0:this.position.x,p=this.height===i?0:this.position.y,c=function(){return this.width===i?this.canvas.width:this.width*this.getRenderScale()}.call(this),r=function(){return this.height===i?this.canvas.height:this.height*this.getRenderScale()}.call(this),o=0,a=t.length;a>o;o++)(e=t[o]).save(),e.beginPath(),e.rect(u,p,c,r),e.clip();for(n(),l=[],s=0,h=t.length;h>s;s++)e=t[s],l.push(e.restore());return l},t.prototype.transformed=function(){var t,e,n,i,r,o,s,a,h;for(n=arguments[0],i=0,o=(t=2<=arguments.length?v.call(arguments,1):[]).length;o>i;i++)(e=t[i]).save(),e.translate(Math.floor(this.position.x),Math.floor(this.position.y)),h=this.getRenderScale(),e.scale(h,h);for(n(),a=[],r=0,s=t.length;s>r;r++)e=t[r],a.push(e.restore());return a},t.prototype.clear=function(t){var e,n;return null==t&&(t=!0),n=this.shapes,e=[],this.setShapesInProgress([]),this.execute(new a.ClearAction(this,n,e)),this.repaintLayer("main"),t&&this.trigger("clear",null),this.trigger("drawingChange",{})},t.prototype.execute=function(t){return this.undoStack.push(t),t.do(),this.redoStack=[]},t.prototype.undo=function(){var t;if(this.undoStack.length)return(t=this.undoStack.pop()).undo(),this.redoStack.push(t),this.trigger("undo",{action:t}),this.trigger("drawingChange",{})},t.prototype.redo=function(){var t;if(this.redoStack.length)return t=this.redoStack.pop(),this.undoStack.push(t),t.do(),this.trigger("redo",{action:t}),this.trigger("drawingChange",{})},t.prototype.canUndo=function(){return!!this.undoStack.length},t.prototype.canRedo=function(){return!!this.redoStack.length},t.prototype.getPixel=function(t,e){var n,i;return n=this.drawingCoordsToClientCoords(t,e),(i=this.ctx.getImageData(n.x,n.y,1,1).data)[3]?"rgb("+i[0]+", "+i[1]+", "+i[2]+")":null},t.prototype.getContentBounds=function(){return y.getBoundingRect(this.shapes.concat(this.backgroundShapes).map((function(t){return t.getBoundingRect()})),this.width===i?0:this.width,this.height===i?0:this.height)},t.prototype.getDefaultImageRect=function(t,e){var n;return null==t&&(t={width:0,height:0}),null==e&&(e={top:0,right:0,bottom:0,left:0}),y.getDefaultImageRect(function(){var t,e,i,r;for(r=[],t=0,e=(i=this.shapes.concat(this.backgroundShapes)).length;e>t;t++)n=i[t],r.push(n.getBoundingRect(this.ctx));return r}.call(this),t,e)},t.prototype.getImage=function(t){return null==t&&(t={}),null==t.includeWatermark&&(t.includeWatermark=!0),null==t.scaleDownRetina&&(t.scaleDownRetina=!0),null==t.scale&&(t.scale=1),t.scaleDownRetina||(t.scale*=this.backingScale),t.includeWatermark&&(t.watermarkImage=this.watermarkImage,t.watermarkScale=this.watermarkScale,t.scaleDownRetina||(t.watermarkScale*=this.backingScale)),f(this.getSnapshot(),t)},t.prototype.canvasForExport=function(){return this.repaintAllLayers(),y.combineCanvases(this.backgroundCanvas,this.canvas)},t.prototype.canvasWithBackground=function(t){return y.combineCanvases(t,this.canvasForExport())},t.prototype.getSnapshot=function(t){var e,n,i,r,o,s;for(null==t&&(t=null),null==t&&(t=["shapes","imageSize","colors","position","scale","backgroundShapes"]),s={},e=0,i=(r=["colors","position","scale"]).length;i>e;e++)n=r[e],x.call(t,n)>=0&&(s[n]=this[n]);return x.call(t,"shapes")>=0&&(s.shapes=function(){var t,e,n,i;for(i=[],t=0,e=(n=this.shapes).length;e>t;t++)o=n[t],i.push(m(o));return i}.call(this)),x.call(t,"backgroundShapes")>=0&&(s.backgroundShapes=function(){var t,e,n,i;for(i=[],t=0,e=(n=this.backgroundShapes).length;e>t;t++)o=n[t],i.push(m(o));return i}.call(this)),x.call(t,"imageSize")>=0&&(s.imageSize={width:this.width,height:this.height}),s},t.prototype.getSnapshotJSON=function(){return console.warn("lc.getSnapshotJSON() is deprecated. use JSON.stringify(lc.getSnapshot()) instead."),JSON.stringify(this.getSnapshot())},t.prototype.getSVGString=function(t){return null==t&&(t={}),g(this.getSnapshot(),t)},t.prototype.loadSnapshot=function(t){var e,n,i,o,s,h,l,c,u,p;if(t){if(t.colors)for(e=0,o=(h=["primary","secondary","background"]).length;o>e;e++)i=h[e],this.setColor(i,t.colors[i]);if(t.shapes)for(this.shapes=[],n=0,s=(l=t.shapes).length;s>n;n++)p=l[n],(u=r(p))&&this.execute(new a.AddShapeAction(this,u));return t.backgroundShapes&&(this.backgroundShapes=function(){var e,n,i,o;for(o=[],e=0,n=(i=t.backgroundShapes).length;n>e;e++)c=i[e],o.push(r(c));return o}()),t.imageSize&&(this.width=t.imageSize.width,this.height=t.imageSize.height),t.position&&(this.position=t.position),t.scale&&(this.scale=t.scale),this.repaintAllLayers(),this.trigger("snapshotLoad"),this.trigger("drawingChange",{})}},t.prototype.loadSnapshotJSON=function(t){return console.warn("lc.loadSnapshotJSON() is deprecated. use lc.loadSnapshot(JSON.parse(snapshot)) instead."),this.loadSnapshot(JSON.parse(t))},t}()},{"../tools/Pencil":48,"./actions":7,"./bindEvents":8,"./canvasRenderer":9,"./math":14,"./renderSnapshotToImage":15,"./renderSnapshotToSVG":16,"./shapes":17,"./svgRenderer":18,"./util":19}],6:[function(t,e,n){var i,r,o,s;t("./fontmetrics.js"),s=function(t){var n,i,r,o,s,a;for(i=0,o=0,s=(n=t.split(" ")).length;s>o;o++)r=n[o],a=parseInt(r.replace("px",""),10),isNaN(a)||(i=a);if(!i)throw"Font size not found";return{fontSize:i,fontFamily:t.substring(n[0].length+1).replace("bold ","").replace("italic ","").replace("underline ","")}},o=function(t,e,n){var i,r,o,s,a,h,l,c,u,p;if(!e.length)return["",""];for(r=0,h=0,l=0,p=!1;;)if(o=(r+=1)>=e.length,s=(a=!o&&e[r].match(/\s/))||o,u=e.substring(0,r),(i=!n||t.measureTextWidth(u).width<=n)&&(l=r),s&&p&&(p=!1,i&&(h=r)),p=!a,o||!i){if(i)return[e,""];if(h>0){for(c=h+1;c<e.length&&e[c].match("/s/");)c+=1;return[e.substring(0,h),e.substring(c)]}return[e.substring(0,l),e.substring(l)]}},r=function(t,e,n){var i,r,s,a,h,l,c,u,p;for(s=[],i=0,r=(p=e.split(/\r\n|\r|\n/g)).length;r>i;i++)if(u=p[i],a=(h=o(t,u,n))[0],c=h[1],a)for(;a;)s.push(a),a=(l=o(t,c,n))[0],c=l[1];else s.push(u);return s},i=function(){function t(t,e,n,i,o){var a,h,l;this.text=e,this.font=n,this.forcedWidth=i,this.forcedHeight=o,a=(l=s(this.font)).fontFamily,h=l.fontSize,t.font=this.font,t.textBaseline="baseline",this.emDashWidth=t.measureTextWidth("",h,a).width,this.caratWidth=t.measureTextWidth("|",h,a).width,this.lines=r(t,this.text,this.forcedWidth),this.metricses=this.lines.map(function(e){return function(n){return t.measureText2(n||"X",h,e.font)}}(this)),this.metrics={ascent:Math.max.apply(Math,this.metricses.map((function(t){return t.ascent}))),descent:Math.max.apply(Math,this.metricses.map((function(t){return t.descent}))),fontsize:Math.max.apply(Math,this.metricses.map((function(t){return t.fontsize}))),leading:Math.max.apply(Math,this.metricses.map((function(t){return t.leading}))),width:Math.max.apply(Math,this.metricses.map((function(t){return t.width}))),height:Math.max.apply(Math,this.metricses.map((function(t){return t.height}))),bounds:{minx:Math.min.apply(Math,this.metricses.map((function(t){return t.bounds.minx}))),miny:Math.min.apply(Math,this.metricses.map((function(t){return t.bounds.miny}))),maxx:Math.max.apply(Math,this.metricses.map((function(t){return t.bounds.maxx}))),maxy:Math.max.apply(Math,this.metricses.map((function(t){return t.bounds.maxy})))}},this.boundingBoxWidth=Math.ceil(this.metrics.width)}return t.prototype.draw=function(t,e,n){var i,r,o,s,a,h;for(t.textBaseline="top",t.font=this.font,i=0,h=[],r=0,o=(a=this.lines).length;o>r;r++)s=a[r],t.fillText(s,e,n+i*this.metrics.leading),h.push(i+=1);return h},t.prototype.getWidth=function(t){return null==t&&(t=!1),this.forcedWidth?this.forcedWidth:t?this.metrics.bounds.maxx+this.caratWidth:this.metrics.bounds.maxx},t.prototype.getHeight=function(){return this.forcedHeight||this.metrics.leading*this.lines.length},t}(),e.exports=i},{"./fontmetrics.js":11}],7:[function(t,e,n){var i,r;r=function(){function t(t,e,n){this.lc=t,this.oldShapes=e,this.newShapes=n}return t.prototype.do=function(){return this.lc.shapes=this.newShapes,this.lc.repaintLayer("main")},t.prototype.undo=function(){return this.lc.shapes=this.oldShapes,this.lc.repaintLayer("main")},t}(),i=function(){function t(t,e,n){this.lc=t,this.shape=e,this.previousShapeId=null!=n?n:null}return t.prototype.do=function(){var t,e,n,i,r,o;if(this.lc.shapes.length&&this.lc.shapes[this.lc.shapes.length-1].id!==this.previousShapeId&&null!==this.previousShapeId){for(i=[],t=!1,e=0,n=(r=this.lc.shapes).length;n>e;e++)o=r[e],i.push(o),o.id===this.previousShapeId&&(i.push(this.shape),t=!0);t||i.push(this.shape),this.lc.shapes=i}else this.lc.shapes.push(this.shape);return this.lc.repaintLayer("main")},t.prototype.undo=function(){var t,e,n,i,r;if(this.lc.shapes[this.lc.shapes.length-1].id===this.shape.id)this.lc.shapes.pop();else{for(n=[],t=0,e=(i=this.lc.shapes).length;e>t;t++)(r=i[t]).id!==this.shape.id&&n.push(r);lc.shapes=n}return this.lc.repaintLayer("main")},t}(),e.exports={ClearAction:r,AddShapeAction:i}},{}],8:[function(t,e,n){var o,s;o=function(t,e){var n,i,r;return i=e.changedTouches[0].clientX,r=e.changedTouches[0].clientY,[i-(n=t.getBoundingClientRect()).left,r-n.top]},s=function(t,e){var n;return n=t.getBoundingClientRect(),{left:e.clientX-n.left,top:e.clientY-n.top}},e.exports=function(t,e,n){var i,r,a,_h,l,c;return null==n&&(n=!1),c=[],r=function(n){var i;return n.preventDefault(),i=s(e,n),t.pointerMove(i.left,i.top)},a=function(n){var i;return n.preventDefault(),e.onselectstart=function(){return!0},i=s(e,n),t.pointerUp(i.left,i.top),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",a),e.addEventListener("mousemove",r)},e.addEventListener("mousedown",(function(n){var o;if("canvas"===n.target.tagName.toLowerCase())return n.preventDefault(),e.onselectstart=function(){return!1},o=s(e,n),t.pointerDown(o.left,o.top),e.removeEventListener("mousemove",r),document.addEventListener("mousemove",r),document.addEventListener("mouseup",a)})),l=function(n){return n.preventDefault(),t.pointerMove.apply(t,o(e,n))},_h=function(n){return n.preventDefault(),t.pointerUp.apply(t,o(e,n)),document.removeEventListener("touchmove",l),document.removeEventListener("touchend",_h),document.removeEventListener("touchcancel",_h)},e.addEventListener("touchstart",(function(n){return"canvas"===n.target.tagName.toLowerCase()?(n.preventDefault(),1===n.touches.length?(t.pointerDown.apply(t,o(e,n)),document.addEventListener("touchmove",l),document.addEventListener("touchend",_h),document.addEventListener("touchcancel",_h)):t.pointerMove.apply(t,o(e,n))):void 0})),n&&(console.warn("Keyboard panning is deprecated."),i=function(e){switch(e.keyCode){case 37:t.pan(-10,0);break;case 38:t.pan(0,-10);break;case 39:t.pan(10,0);break;case 40:t.pan(0,10)}return t.repaintAllLayers()},document.addEventListener("keydown",i),c.push((function(){return document.removeEventListener(i)}))),function(){var t,e,n,i;for(i=[],e=0,n=c.length;n>e;e++)t=c[e],i.push(t());return i}}},{}],9:[function(t,e,n){var i,r,o,s,a,h,l,c,u,p,d;l=t("./lineEndCapShapes"),d={},r=function(t,e,n){return d[t]={drawFunc:e,drawLatestFunc:n}},c=function(){},p=function(t,e,n){var i;if(null==n&&(n={}),null==n.shouldIgnoreUnsupportedShapes&&(n.shouldIgnoreUnsupportedShapes=!1),null==n.retryCallback&&(n.retryCallback=c),null==n.shouldOnlyDrawLatest&&(n.shouldOnlyDrawLatest=!1),null==n.bufferCtx&&(n.bufferCtx=null),i=n.bufferCtx,d[e.className])return n.shouldOnlyDrawLatest&&d[e.className].drawLatestFunc?d[e.className].drawLatestFunc(t,i,e,n.retryCallback):d[e.className].drawFunc(t,e,n.retryCallback);if(n.shouldIgnoreUnsupportedShapes)return console.warn("Can't render shape of type "+e.className+" to canvas");throw"Can't render shape of type "+e.className+" to canvas"},u=function(t,e,n){return p(t.getContext("2d"),e,n)},r("Rectangle",(function(t,e){var n,i;return n=e.x,i=e.y,e.strokeWidth%2!=0&&(n+=.5,i+=.5),t.fillStyle=e.fillColor,t.fillRect(n,i,e.width,e.height),t.lineWidth=e.strokeWidth,t.strokeStyle=e.strokeColor,t.strokeRect(n,i,e.width,e.height)})),r("Ellipse",(function(t,e){var n,i,r,o;return t.save(),o=Math.floor(e.width/2),r=Math.floor(e.height/2),n=e.x+o,i=e.y+r,t.translate(n,i),t.scale(1,Math.abs(e.height/e.width)),t.beginPath(),t.arc(0,0,Math.abs(o),0,2*Math.PI),t.closePath(),t.restore(),t.fillStyle=e.fillColor,t.fill(),t.lineWidth=e.strokeWidth,t.strokeStyle=e.strokeColor,t.stroke()})),r("SelectionBox",function(){var t;return t=function(_t,e,n){var i,r;return i=e.x,r=e.y,0!==n?(_t.fillStyle="#fff",_t.fillRect(i,r,n,n),_t.strokeStyle="#000",_t.strokeRect(i,r,n,n)):void 0},function(e,n){return t(e,n.getTopLeftHandleRect(),n.handleSize),t(e,n.getTopRightHandleRect(),n.handleSize),t(e,n.getBottomLeftHandleRect(),n.handleSize),t(e,n.getBottomRightHandleRect(),n.handleSize),n.backgroundColor&&(e.fillStyle=n.backgroundColor,e.fillRect(n._br.x-n.margin,n._br.y-n.margin,n._br.width+2*n.margin,n._br.height+2*n.margin)),e.lineWidth=1,e.strokeStyle="#000",e.setLineDash([2,4]),e.strokeRect(n._br.x-n.margin,n._br.y-n.margin,n._br.width+2*n.margin,n._br.height+2*n.margin),e.setLineDash([])}}()),r("Image",(function(t,e,n){return e.image.width?1===e.scale?t.drawImage(e.image,e.x,e.y):t.drawImage(e.image,e.x,e.y,e.image.width*e.scale,e.image.height*e.scale):n?e.image.onload=n:void 0})),r("Line",(function(t,e){var n,i,r,o,s;if(e.x1!==e.x2||e.y1!==e.y2)return i=e.x1,r=e.x2,o=e.y1,s=e.y2,e.strokeWidth%2!=0&&(i+=.5,r+=.5,o+=.5,s+=.5),t.lineWidth=e.strokeWidth,t.strokeStyle=e.color,t.lineCap=e.capStyle,e.dash&&t.setLineDash(e.dash),t.beginPath(),t.moveTo(i,o),t.lineTo(r,s),t.stroke(),e.dash&&t.setLineDash([]),n=Math.max(2.2*e.strokeWidth,5),e.endCapShapes[0]&&l[e.endCapShapes[0]].drawToCanvas(t,i,o,Math.atan2(o-s,i-r),n,e.color),e.endCapShapes[1]?l[e.endCapShapes[1]].drawToCanvas(t,r,s,Math.atan2(s-o,r-i),n,e.color):void 0})),i=function(t,e,n,_i){var r,o,s,a;if(null==n&&(n=!1),null==_i&&(_i="round"),e.length){for(t.lineCap=_i,t.strokeStyle=e[0].color,t.lineWidth=e[0].size,t.beginPath(),e[0].size%2==0?t.moveTo(e[0].x,e[0].y):t.moveTo(e[0].x+.5,e[0].y+.5),r=0,o=(a=e.slice(1)).length;o>r;r++)s=a[r],e[0].size%2==0?t.lineTo(s.x,s.y):t.lineTo(s.x+.5,s.y+.5);return n?t.closePath():void 0}},a=function(t,e){return i(t,e.smoothedPoints),t.stroke()},h=function(t,e,n){var r,o,s;return n.tail?(o=(s=n.smoothedPoints.length-n.segmentSize*n.tailSize)<2*n.segmentSize?0:s,r=s+n.segmentSize+1,i(e,n.smoothedPoints.slice(o,r)),e.stroke()):(i(e,n.smoothedPoints),e.stroke())},r("LinePath",a,h),o=function(t,e){return t.save(),t.globalCompositeOperation="destination-out",a(t,e),t.restore()},s=function(t,e,n){return t.save(),t.globalCompositeOperation="destination-out",e.save(),e.globalCompositeOperation="destination-out",h(0,e,n),t.restore(),e.restore()},r("ErasedLinePath",o,s),r("Text",(function(t,e){return e.renderer||e._makeRenderer(t),t.fillStyle=e.color,e.renderer.draw(t,e.x,e.y)})),r("Polygon",(function(t,e){return t.fillStyle=e.fillColor,i(t,e.points,e.isClosed,"butt"),t.fill(),t.stroke()})),e.exports={defineCanvasRenderer:r,renderShapeToCanvas:u,renderShapeToContext:p}},{"./lineEndCapShapes":12}],10:[function(t,e,n){e.exports={imageURLPrefix:"lib/img",primaryColor:"hsla(0, 0%, 0%, 1)",secondaryColor:"hsla(0, 0%, 100%, 1)",backgroundColor:"transparent",strokeWidths:[1,2,5,10,20,30],defaultStrokeWidth:5,toolbarPosition:"top",keyboardShortcuts:!1,imageSize:{width:"infinite",height:"infinite"},backgroundShapes:[],watermarkImage:null,watermarkScale:1,zoomMin:.2,zoomMax:4,zoomStep:.2,snapshot:null,onInit:function(){},tools:[t("../tools/Pencil"),t("../tools/Eraser"),t("../tools/Line"),t("../tools/Rectangle"),t("../tools/Ellipse"),t("../tools/Text"),t("../tools/Polygon"),t("../tools/Pan"),t("../tools/Eyedropper")]}},{"../tools/Ellipse":43,"../tools/Eraser":44,"../tools/Eyedropper":45,"../tools/Line":46,"../tools/Pan":47,"../tools/Pencil":48,"../tools/Polygon":49,"../tools/Rectangle":50,"../tools/Text":52}],11:[function(t,e,n){!function(){if(!document.defaultView.getComputedStyle)throw"ERROR: 'document.defaultView.getComputedStyle' not found. This library only works in browsers that can report computed CSS values.";CanvasRenderingContext2D.prototype.measureTextWidth=CanvasRenderingContext2D.prototype.measureText;CanvasRenderingContext2D.prototype.measureText2=function(e,n,i){var r=this.measureTextWidth(e),o=!/\S/.test(e);r.fontsize=n;var s=document.createElement("div");s.style.position="absolute",s.style.opacity=0,s.style.font=i,s.innerHTML=e+"<br/>"+e,document.body.appendChild(s),r.leading=1.2*n;var a=function(_t2,e){return document.defaultView.getComputedStyle(_t2,null).getPropertyValue(e)}(s,"height");if((a=a.replace("px",""))>=2*n&&(r.leading=a/2|0),document.body.removeChild(s),o)r.ascent=0,r.descent=0,r.bounds={minx:0,maxx:r.width,miny:0,maxy:0},r.height=0;else{var h=document.createElement("canvas"),l=100;h.width=r.width+l,h.height=3*n,h.style.opacity=1,h.style.font=i;var c=h.getContext("2d");c.font=i;var u=h.width,p=h.height,d=p/2;c.fillStyle="white",c.fillRect(-1,-1,u+2,p+2),c.fillStyle="black",c.fillText(e,50,d);for(var f=c.getImageData(0,0,u,p).data,g=0,m=4*u,y=f.length;++g<y&&255===f[g];);var S=g/m|0;for(g=y-1;--g>0&&255===f[g];);var v=g/m|0;for(g=0;y>g&&255===f[g];)(g+=m)>=y&&(g=g-y+4);var x=g%m/4|0,w=1;for(g=y-3;g>=0&&255===f[g];)0>(g-=m)&&(g=y-3-4*w++);var k=g%m/4+1|0;r.ascent=d-S,r.descent=v-d,r.bounds={minx:x-50,maxx:k-50,miny:0,maxy:v-S},r.height=v-S+1}return r}}()},{}],12:[function(t,e,n){e.exports={arrow:function(){var t;return t=function(_t3,e,n,i,r){return[{x:_t3+Math.cos(n+Math.PI/2)*i/2,y:e+Math.sin(n+Math.PI/2)*i/2},{x:_t3+Math.cos(n)*r,y:e+Math.sin(n)*r},{x:_t3+Math.cos(n-Math.PI/2)*i/2,y:e+Math.sin(n-Math.PI/2)*i/2}]},{drawToCanvas:function(e,n,i,r,o,s,a){var h;return null==a&&(a=0),a=a||o,e.fillStyle=s,e.lineWidth=0,e.strokeStyle="transparent",e.beginPath(),h=t(n,i,r,o,a),e.moveTo(h[0].x,h[0].y),e.lineTo(h[1].x,h[1].y),e.lineTo(h[2].x,h[2].y),e.fill()},svg:function(e,n,i,r,o,s){return null==s&&(s=0),"<polygon fill='"+o+"' stroke='none' points='"+t(e,n,i,r,s=s||r).map((function(t){return t.x+","+t.y}))+"' />"}}}()}},{}],13:[function(t,e,n){var i,r,o;o={},r=function(t){return o=t},i=function(t){return o[t]||t},e.exports={localize:r,_:i}},{}],14:[function(t,e,n){var _r,o,s,a;t("./shapes").Point,t("./util"),(o={}).toPoly=function(t){var e,n,i,o,a,h,l;for(h=[],l=[],n=0,e=0,i=t.length;i>e;e++)a=t[e],o=s(a,_r(t,n)),h=h.concat([o[0]]),l=[o[1]].concat(l),n+=1;return h.concat(l)},_r=function(t,e){return t.length<3&&{x:0,y:0},0===e?_r(t,e+1):e===t.length-1?_r(t,e-1):o.diff(t[e-1],t[e+1])},o.diff=function(t,e){return{x:e.x-t.x,y:e.y-t.y}},a=function(t){var e;return e=o.len(t),{x:t.x/e,y:t.y/e}},s=function(t,e){return(e=a(e)).x=e.x*t.size/2,e.y=e.y*t.size/2,[{x:t.x-e.y,y:t.y+e.x,color:t.color},{x:t.x+e.y,y:t.y-e.x,color:t.color}]},o.len=function(t){return Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2))},o.scalePositionScalar=function(t,e,n,i){return t+(e*n-e*i)/2},e.exports=o},{"./shapes":17,"./util":19}],15:[function(t,e,n){var i,r,o,s;s=t("./util"),r=t("./shapes").JSONToShape,i="infinite",o=function(t,e,n){return e.width?(t.save(),t.translate(t.canvas.width/2,t.canvas.height/2),t.scale(n,n),t.drawImage(e,-e.width/2,-e.height/2),t.restore()):void 0},e.exports=function(t,e){var n,a,h,l,c,u,p,d;return null==e&&(e={}),null==e.scale&&(e.scale=1),u=function(){var e,n,i,o;for(o=[],e=0,n=(i=t.shapes).length;n>e;e++)c=i[e],o.push(r(c));return o}(),a=[],t.backgroundShapes&&(a=function(){var e,n,i,o;for(o=[],e=0,n=(i=t.backgroundShapes).length;n>e;e++)c=i[e],o.push(r(c));return o}()),null==e.margin&&(e.margin={top:0,right:0,bottom:0,left:0}),l=t.imageSize||{width:i,height:i},h=t.colors||{background:"transparent"},n=u.concat(a),p=document.createElement("canvas"),d=p.getContext("2d"),e.rect?(e.rect.x-=e.margin.left,e.rect.y-=e.margin.top,e.rect.width+=e.margin.left+e.margin.right,e.rect.height+=e.margin.top+e.margin.bottom):e.rect=s.getDefaultImageRect(function(){var t,e,i;for(i=[],t=0,e=n.length;e>t;t++)c=n[t],i.push(c.getBoundingRect(d));return i}(),l,e.margin),p.width=e.rect.width*e.scale,p.height=e.rect.height*e.scale,d.fillStyle=h.background,d.fillRect(0,0,p.width,p.height),e.rect.width&&e.rect.height?(e.watermarkImage&&o(d,e.watermarkImage,e.watermarkScale),s.combineCanvases(p,s.renderShapes(a,e.rect,e.scale),s.renderShapes(u,e.rect,e.scale))):null}},{"./shapes":17,"./util":19}],16:[function(t,e,n){var i,r,o;o=t("./util"),r=t("./shapes").JSONToShape,i="infinite",e.exports=function(t,e){var n,s,a,h,l,c,u,p;return null==e&&(e={}),p=function(){var e,n,i,o;for(o=[],e=0,n=(i=t.shapes).length;n>e;e++)u=i[e],o.push(r(u));return o}(),s=[],t.backgroundShapes&&(s=function(){var e,n,i,o;for(o=[],e=0,n=(i=t.backgroundShapes).length;n>e;e++)u=i[e],o.push(r(u));return o}()),null==e.margin&&(e.margin={top:0,right:0,bottom:0,left:0}),c=t.imageSize||{width:i,height:i},a=t.colors||{background:"transparent"},n=p.concat(s),l=document.createElement("canvas"),h=l.getContext("2d"),e.rect?(e.rect.x-=e.margin.left,e.rect.y-=e.margin.top,e.rect.width+=e.margin.left+e.margin.right,e.rect.height+=e.margin.top+e.margin.bottom):e.rect=o.getDefaultImageRect(function(){var t,e,i;for(i=[],t=0,e=n.length;e>t;t++)u=n[t],i.push(u.getBoundingRect(h));return i}(),c,e.margin),LC.renderShapesToSVG(s.concat(p),e.rect,a.background)}},{"./shapes":17,"./util":19}],17:[function(t,e,n){var i,o,s,a,h,l,c,_u,p,d,f,g,y,S,v,x,w,k,b,C;C=t("./util"),o=t("./TextRenderer"),t("./lineEndCapShapes"),S=t("./canvasRenderer"),d=S.defineCanvasRenderer,x=S.renderShapeToContext,v=t("./svgRenderer"),f=v.defineSVGRenderer,w=v.renderShapeToSVG,b={},g=function(t,e){var n,i,r,o,s,a,h,l;for(o in n=function(t,_n,i,r,o,s,a,h,l,c,u,p,d,f,g,m){return e.constructor.call(this,t,_n,i,r,o,s,a,h,l,c,u,p,d,f,g,m),this},n.prototype.className=t,n.fromJSON=e.fromJSON,e.draw&&(s=e.draw,a=e.draw||function(t,e,n){return this.draw(t,e,n)},i=function(t,e,n){return s.call(e,t,n)},r=function(t,e,n,i){return a.call(n,t,e,i)},delete e.draw,e.drawLatest&&delete e.drawLatest,d(t,i,r)),e.toSVG&&(h=e.toSVG,l=function(t){return h.call(t)},delete e.toSVG,f(t,l)),n.prototype.draw=function(t,e){return x(t,this,{retryCallback:e})},n.prototype.drawLatest=function(t,e,n){return x(t,this,{retryCallback:n,bufferCtx:e,shouldOnlyDrawLatest:!0})},n.prototype.toSVG=function(){return w(this)},e)"fromJSON"!==o&&(n.prototype[o]=e[o]);return b[t]=n,n},p=function(t,e,n,i,r,o,s,a,h,l,c,u,_p,d,f,g,m){var y;return(y=new b[t](e,n,i,r,o,s,a,h,l,c,u,_p,d,f,g,m)).id=C.getGUID(),y},i=function(t){var e,n,i,r;return e=t.className,n=t.data,i=t.id,e in b?(r=b[e].fromJSON(n))?(i&&(r.id=i),r):(console.log("Unreadable shape:",e,n),null):(console.log("Unknown shape:",e,n),null)},k=function(t){return{className:t.className,data:t.toJSON(),id:t.id}},_u=function(t,e){return e?_u(h(h(c(t))),e-1):t},c=function(t){var e,n,i,r,o;for(o=[],e=0,r=0,n=(t=[t[0]].concat(t).concat(C.last(t))).length;n>r;r++)i=t[r],o[2*e]=i,t[e+1]&&(o[2*e+1]=l(i,t[e+1])),e+=1;return o},h=function(t){var e,n,i,r,o;for(e=[],n=0,o=0,i=t.length;i>o;o++)r=t[o],t[n+1]&&(e[n]=l(r,t[n+1])),n+=1;return e},l=function(t,e){return p("Point",{x:t.x+(e.x-t.x)/2,y:t.y+(e.y-t.y)/2,size:t.size+(e.size-t.size)/2,color:t.color})},g("Image",{constructor:function(t){return null==t&&(t={}),this.x=t.x||0,this.y=t.y||0,this.scale=t.scale||1,this.image=t.image||null},getBoundingRect:function(){return{x:this.x,y:this.y,width:this.image.width*this.scale,height:this.image.height*this.scale}},toJSON:function(){return{x:this.x,y:this.y,imageSrc:this.image.src,imageObject:this.image,scale:this.scale}},fromJSON:function(t){var e,n;return e=null,(null!=(n=t.imageObject)?n.width:void 0)?e=t.imageObject:(e=new Image).src=t.imageSrc,p("Image",{x:t.x,y:t.y,image:e,scale:t.scale})},move:function(t){return null==t&&(t={}),this.x=this.x-t.xDiff,this.y=this.y-t.yDiff},setUpperLeft:function(t){return null==t&&(t={}),this.x=t.x,this.y=t.y}}),g("Rectangle",{constructor:function(t){return null==t&&(t={}),this.x=t.x||0,this.y=t.y||0,this.width=t.width||0,this.height=t.height||0,this.strokeWidth=t.strokeWidth||1,this.strokeColor=t.strokeColor||"black",this.fillColor=t.fillColor||"transparent"},getBoundingRect:function(){return{x:this.x-this.strokeWidth/2,y:this.y-this.strokeWidth/2,width:this.width+this.strokeWidth,height:this.height+this.strokeWidth}},toJSON:function(){return{x:this.x,y:this.y,width:this.width,height:this.height,strokeWidth:this.strokeWidth,strokeColor:this.strokeColor,fillColor:this.fillColor}},fromJSON:function(t){return p("Rectangle",t)},move:function(t){return null==t&&(t={}),this.x=this.x-t.xDiff,this.y=this.y-t.yDiff},setUpperLeft:function(t){return null==t&&(t={}),this.x=t.x,this.y=t.y}}),g("Ellipse",{constructor:function(t){return null==t&&(t={}),this.x=t.x||0,this.y=t.y||0,this.width=t.width||0,this.height=t.height||0,this.strokeWidth=t.strokeWidth||1,this.strokeColor=t.strokeColor||"black",this.fillColor=t.fillColor||"transparent"},getBoundingRect:function(){return{x:this.x-this.strokeWidth/2,y:this.y-this.strokeWidth/2,width:this.width+this.strokeWidth,height:this.height+this.strokeWidth}},toJSON:function(){return{x:this.x,y:this.y,width:this.width,height:this.height,strokeWidth:this.strokeWidth,strokeColor:this.strokeColor,fillColor:this.fillColor}},fromJSON:function(t){return p("Ellipse",t)},move:function(t){return null==t&&(t={}),this.x=this.x-t.xDiff,this.y=this.y-t.yDiff},setUpperLeft:function(t){return null==t&&(t={}),this.x=t.x,this.y=t.y}}),g("Line",{constructor:function(t){return null==t&&(t={}),this.x1=t.x1||0,this.y1=t.y1||0,this.x2=t.x2||0,this.y2=t.y2||0,this.strokeWidth=t.strokeWidth||1,this.color=t.color||"black",this.capStyle=t.capStyle||"round",this.endCapShapes=t.endCapShapes||[null,null],this.dash=t.dash||null},getBoundingRect:function(){return{x:Math.min(this.x1,this.x2)-this.strokeWidth/2,y:Math.min(this.y1,this.y2)-this.strokeWidth/2,width:Math.abs(this.x2-this.x1)+this.strokeWidth/2,height:Math.abs(this.y2-this.y1)+this.strokeWidth/2}},toJSON:function(){return{x1:this.x1,y1:this.y1,x2:this.x2,y2:this.y2,strokeWidth:this.strokeWidth,color:this.color,capStyle:this.capStyle,dash:this.dash,endCapShapes:this.endCapShapes}},fromJSON:function(t){return p("Line",t)},move:function(t){return null==t&&(t={}),this.x1=this.x1-t.xDiff,this.y1=this.y1-t.yDiff,this.x2=this.x2-t.xDiff,this.y2=this.y2-t.yDiff},setUpperLeft:function(t){var e,n,i;return null==t&&(t={}),n=(e=this.getBoundingRect()).x-t.x,i=e.y-t.y,this.move({xDiff:n,yDiff:i})}}),a=function(t){var e,n,i,r,o;if(!t.length)return!1;for(o=t[0].size,e=t[0].color,r=0,n=t.length;n>r;r++)if((i=t[r]).size===o&&i.color===e||console.log(o,e,i.size,i.color),i.size!==o||i.color!==e)return!1;return!0},s=function(t,e){var n,r,o,s,a;return r=null,e.points?r=function(){var t,r,o,s;for(s=[],r=0,t=(o=e.points).length;t>r;r++)n=o[r],s.push(i(n));return s}():e.pointCoordinatePairs&&(r=function(){var t,n,r,o,h;for(h=[],n=0,t=(r=e.pointCoordinatePairs).length;t>n;n++)o=r[n],s=o[0],a=o[1],h.push(i({className:"Point",data:{x:s,y:a,size:e.pointSize,color:e.pointColor,smooth:e.smooth}}));return h}()),o=null,e.smoothedPointCoordinatePairs&&(o=function(){var t,n,r,o,h;for(h=[],n=0,t=(r=e.smoothedPointCoordinatePairs).length;t>n;n++)o=r[n],s=o[0],a=o[1],h.push(i({className:"Point",data:{x:s,y:a,size:e.pointSize,color:e.pointColor,smooth:e.smooth}}));return h}()),r[0]?p(t,{points:r,smoothedPoints:o,order:e.order,tailSize:e.tailSize,smooth:e.smooth}):null},y={constructor:function(t){var e,n,i,r,o;if(null==t&&(t={}),i=t.points||[],this.order=t.order||3,this.tailSize=t.tailSize||3,this.smooth=!("smooth"in t)||t.smooth,this.segmentSize=Math.pow(2,this.order),this.sampleSize=this.tailSize+1,t.smoothedPoints)return this.points=t.points,this.smoothedPoints=t.smoothedPoints;for(this.points=[],o=[],r=0,e=i.length;e>r;r++)n=i[r],o.push(this.addPoint(n));return o},getBoundingRect:function(){return C.getBoundingRect(this.points.map((function(t){return{x:t.x-t.size/2,y:t.y-t.size/2,width:t.size,height:t.size}})))},toJSON:function(){var t,e;return a(this.points)?{order:this.order,tailSize:this.tailSize,smooth:this.smooth,pointCoordinatePairs:function(){var t,n,i,r;for(r=[],n=0,t=(i=this.points).length;t>n;n++)e=i[n],r.push([e.x,e.y]);return r}.call(this),smoothedPointCoordinatePairs:function(){var t,n,i,r;for(r=[],n=0,t=(i=this.smoothedPoints).length;t>n;n++)e=i[n],r.push([e.x,e.y]);return r}.call(this),pointSize:this.points[0].size,pointColor:this.points[0].color}:{order:this.order,tailSize:this.tailSize,smooth:this.smooth,points:function(){var e,n,i,r;for(r=[],n=0,e=(i=this.points).length;e>n;n++)t=i[n],r.push(k(t));return r}.call(this)}},fromJSON:function(t){return s("LinePath",t)},addPoint:function(t){return this.points.push(t),this.smooth?!this.smoothedPoints||this.points.length<this.sampleSize?this.smoothedPoints=_u(this.points,this.order):(this.tail=C.last(_u(C.last(this.points,this.sampleSize),this.order),this.segmentSize*this.tailSize),this.smoothedPoints=this.smoothedPoints.slice(0,this.smoothedPoints.length-this.segmentSize*(this.tailSize-1)).concat(this.tail)):void(this.smoothedPoints=this.points)},move:function(t){var e,i,r;for(null==t&&(t={}),r=0,e=(i=this.smooth?this.smoothedPoints:this.points).length;e>r;r++)i[r].move(t);return this.points=this.smoothedPoints},setUpperLeft:function(t){var e,n,i;return null==t&&(t={}),n=(e=this.getBoundingRect()).x-t.x,i=e.y-t.y,this.move({xDiff:n,yDiff:i})}},g("LinePath",y),g("ErasedLinePath",{constructor:y.constructor,toJSON:y.toJSON,addPoint:y.addPoint,getBoundingRect:y.getBoundingRect,fromJSON:function(t){return s("ErasedLinePath",t)}}),g("Point",{constructor:function(t){return null==t&&(t={}),this.x=t.x||0,this.y=t.y||0,this.size=t.size||0,this.color=t.color||""},getBoundingRect:function(){return{x:this.x-this.size/2,y:this.y-this.size/2,width:this.size,height:this.size}},toJSON:function(){return{x:this.x,y:this.y,size:this.size,color:this.color}},fromJSON:function(t){return p("Point",t)},move:function(t){return null==t&&(t={}),this.x=this.x-t.xDiff,this.y=this.y-t.yDiff},setUpperLeft:function(t){return null==t&&(t={}),this.x=t.x,this.y=t.y}}),g("Polygon",{constructor:function(t){var e,n,i,r,o;for(null==t&&(t={}),this.points=t.points,this.fillColor=t.fillColor||"white",this.strokeColor=t.strokeColor||"black",this.strokeWidth=t.strokeWidth,this.dash=t.dash||null,null==t.isClosed&&(t.isClosed=!0),this.isClosed=t.isClosed,o=[],i=0,e=(r=this.points).length;e>i;i++)(n=r[i]).color=this.strokeColor,o.push(n.size=this.strokeWidth);return o},addPoint:function(t,e){return this.points.push(LC.createShape("Point",{x:t,y:e}))},getBoundingRect:function(){return C.getBoundingRect(this.points.map((function(t){return t.getBoundingRect()})))},toJSON:function(){return{strokeWidth:this.strokeWidth,fillColor:this.fillColor,strokeColor:this.strokeColor,dash:this.dash,isClosed:this.isClosed,pointCoordinatePairs:this.points.map((function(t){return[t.x,t.y]}))}},fromJSON:function(t){return t.points=t.pointCoordinatePairs.map((function(e){var n,i;return n=e[0],i=e[1],p("Point",{x:n,y:i,size:t.strokeWidth,color:t.strokeColor})})),p("Polygon",t)},move:function(t){var e,n,i,r,o;for(null==t&&(t={}),o=[],i=0,e=(r=this.points).length;e>i;i++)n=r[i],o.push(n.move(t));return o},setUpperLeft:function(t){var e,n,i;return null==t&&(t={}),n=(e=this.getBoundingRect()).x-t.x,i=e.y-t.y,this.move({xDiff:n,yDiff:i})}}),g("Text",{constructor:function(t){return null==t&&(t={}),this.x=t.x||0,this.y=t.y||0,this.v=t.v||0,this.text=t.text||"",this.color=t.color||"black",this.font=t.font||"18px sans-serif",this.forcedWidth=t.forcedWidth||null,this.forcedHeight=t.forcedHeight||null},_makeRenderer:function(t){return t.lineHeight=1.2,this.renderer=new o(t,this.text,this.font,this.forcedWidth,this.forcedHeight),this.v<1?(console.log("repairing baseline"),this.v=1,this.x-=this.renderer.metrics.bounds.minx,this.y-=this.renderer.metrics.leading-this.renderer.metrics.descent):void 0},setText:function(t){return this.text=t,this.renderer=null},setFont:function(t){return this.font=t,this.renderer=null},setPosition:function(t,e){return this.x=t,this.y=e},setSize:function(t,e){return this.forcedWidth=Math.max(t,0),this.forcedHeight=Math.max(e,0),this.renderer=null},enforceMaxBoundingRect:function(t){var e,n,i;return e=this.getBoundingRect(t.ctx),i={x:-t.position.x/t.scale,y:-t.position.y/t.scale,width:t.canvas.width/t.scale,height:t.canvas.height/t.scale},e.x+e.width>i.x+i.width?(n=e.x-i.x,this.forcedWidth=i.width-n-10,this.renderer=null):void 0},getBoundingRect:function(t,e){if(null==e&&(e=!1),!this.renderer){if(!t)throw"Must pass ctx if text hasn't been rendered yet";this._makeRenderer(t)}return{x:Math.floor(this.x),y:Math.floor(this.y),width:Math.ceil(this.renderer.getWidth(!0)),height:Math.ceil(this.renderer.getHeight())}},toJSON:function(){return{x:this.x,y:this.y,text:this.text,color:this.color,font:this.font,forcedWidth:this.forcedWidth,forcedHeight:this.forcedHeight,v:this.v}},fromJSON:function(t){return p("Text",t)},move:function(t){return null==t&&(t={}),this.x=this.x-t.xDiff,this.y=this.y-t.yDiff},setUpperLeft:function(t){return null==t&&(t={}),this.x=t.x,this.y=t.y}}),g("SelectionBox",{constructor:function(t){return null==t&&(t={}),this.shape=t.shape,null!=t.handleSize?this.handleSize=t.handleSize:this.handleSize=10,this.margin=4,this.backgroundColor=t.backgroundColor||null,this._br=this.shape.getBoundingRect(t.ctx)},toJSON:function(){return{shape:k(this.shape),backgroundColor:this.backgroundColor}},fromJSON:function(t){var e,o;return o=t.shape,t.handleSize,t.margin,e=t.backgroundColor,p("SelectionBox",{shape:i(o),backgroundColor:e})},getTopLeftHandleRect:function(){return{x:this._br.x-this.handleSize-this.margin,y:this._br.y-this.handleSize-this.margin,width:this.handleSize,height:this.handleSize}},getBottomLeftHandleRect:function(){return{x:this._br.x-this.handleSize-this.margin,y:this._br.y+this._br.height+this.margin,width:this.handleSize,height:this.handleSize}},getTopRightHandleRect:function(){return{x:this._br.x+this._br.width+this.margin,y:this._br.y-this.handleSize-this.margin,width:this.handleSize,height:this.handleSize}},getBottomRightHandleRect:function(){return{x:this._br.x+this._br.width+this.margin,y:this._br.y+this._br.height+this.margin,width:this.handleSize,height:this.handleSize}},getBoundingRect:function(){return{x:this._br.x-this.margin,y:this._br.y-this.margin,width:this._br.width+2*this.margin,height:this._br.height+2*this.margin}}}),e.exports={defineShape:g,createShape:p,JSONToShape:i,shapeToJSON:k}},{"./TextRenderer":6,"./canvasRenderer":9,"./lineEndCapShapes":12,"./svgRenderer":18,"./util":19}],18:[function(t,e,n){var i,r,o,s;r=t("./lineEndCapShapes"),s={},i=function(t,e){return s[t]=e},o=function(t,e){if(null==e&&(e={}),null==e.shouldIgnoreUnsupportedShapes&&(e.shouldIgnoreUnsupportedShapes=!1),s[t.className])return s[t.className](t);if(e.shouldIgnoreUnsupportedShapes)return console.warn("Can't render shape of type "+t.className+" to SVG"),"";throw"Can't render shape of type "+t.className+" to SVG"},i("Rectangle",(function(t){var e,n,i,r,o,s,a,h;return r=t.x,a=t.y,o=t.x+t.width,h=t.y+t.height,i=Math.min(r,o),s=Math.min(a,h),n=Math.max(r,o)-i,e=Math.max(a,h)-s,t.strokeWidth%2!=0&&(i+=.5,s+=.5),"<rect x='"+i+"' y='"+s+"' width='"+n+"' height='"+e+"' stroke='"+t.strokeColor+"' fill='"+t.fillColor+"' stroke-width='"+t.strokeWidth+"' />"})),i("SelectionBox",(function(t){return""})),i("Ellipse",(function(t){var i,r;return r=Math.floor(t.width/2),i=Math.floor(t.height/2),"<ellipse cx='"+(t.x+r)+"' cy='"+(t.y+i)+"' rx='"+Math.abs(r)+"' ry='"+Math.abs(i)+"' stroke='"+t.strokeColor+"' fill='"+t.fillColor+"' stroke-width='"+t.strokeWidth+"' />"})),i("Image",(function(t){return"<image x='"+t.x+"' y='"+t.y+"' width='"+t.image.naturalWidth*t.scale+"' height='"+t.image.naturalHeight*t.scale+"' xlink:href='"+t.image.src+"' />"})),i("Line",(function(t){var e,n,i,o,s,a,h;return i=t.dash?"stroke-dasharray='"+t.dash.join(", ")+"'":"",n="",e=Math.max(2.2*t.strokeWidth,5),o=t.x1,s=t.x2,a=t.y1,h=t.y2,t.strokeWidth%2!=0&&(o+=.5,s+=.5,a+=.5,h+=.5),t.endCapShapes[0]&&(n+=r[t.endCapShapes[0]].svg(o,a,Math.atan2(a-h,o-s),e,t.color)),t.endCapShapes[1]&&(n+=r[t.endCapShapes[1]].svg(s,h,Math.atan2(h-a,s-o),e,t.color)),"<g> <line x1='"+o+"' y1='"+a+"' x2='"+s+"' y2='"+h+"' "+i+" stroke-linecap='"+t.capStyle+"' stroke='"+t.color+" 'stroke-width='"+t.strokeWidth+"' /> "+n+" </g>"})),i("LinePath",(function(t){return"<polyline fill='none' points='"+t.smoothedPoints.map((function(t){var e;return e=t.strokeWidth%2==0?0:.5,t.x+e+","+(t.y+e)})).join(" ")+"' stroke='"+t.points[0].color+"' stroke-linecap='round' stroke-width='"+t.points[0].size+"' />"})),i("ErasedLinePath",(function(t){return""})),i("Polygon",(function(t){return t.isClosed?"<polygon fill='"+t.fillColor+"' points='"+t.points.map((function(t){var e;return e=t.strokeWidth%2==0?0:.5,t.x+e+","+(t.y+e)})).join(" ")+"' stroke='"+t.strokeColor+"' stroke-width='"+t.strokeWidth+"' />":"<polyline fill='"+t.fillColor+"' points='"+t.points.map((function(t){var e;return e=t.strokeWidth%2==0?0:.5,t.x+e+","+(t.y+e)})).join(" ")+"' stroke='none' /> <polyline fill='none' points='"+t.points.map((function(t){var e;return e=t.strokeWidth%2==0?0:.5,t.x+e+","+(t.y+e)})).join(" ")+"' stroke='"+t.strokeColor+"' stroke-width='"+t.strokeWidth+"' />"})),i("Text",(function(t){var e,n,i;return i=t.forcedWidth?"width='"+t.forcedWidth+"px'":"",e=t.forcedHeight?"height='"+t.forcedHeight+"px'":"",n=t.text.split(/\r\n|\r|\n/g),t.renderer&&(n=t.renderer.lines),"<text x='"+t.x+"' y='"+t.y+"' "+i+" "+e+" fill='"+t.color+"' style='font: "+t.font+";'> "+n.map((function(e,n){var i;return i=0===n?0:"1.2em","<tspan x='"+t.x+"' dy='"+i+"' alignment-baseline='text-before-edge'> "+e+" </tspan>"})).join("")+" </text>"})),e.exports={defineSVGRenderer:i,renderShapeToSVG:o}},{"./lineEndCapShapes":12}],19:[function(t,e,n){var _s,i,r,o,s,a=[].slice;o=Array.prototype.slice,i=t("./canvasRenderer").renderShapeToContext,r=t("./svgRenderer").renderShapeToSVG,_s={addImageOnload:function(t,e){var n;return n=t.onload,t.onload=function(){return"function"==typeof n&&n(),e()},t},last:function(t,e){return null==e&&(e=null),e?o.call(t,Math.max(t.length-e,0)):t[t.length-1]},classSet:function(t){var e,n;for(n in e=[],t)t[n]&&e.push(n);return e.join(" ")},matchElementSize:function(t,e,n,i){var r;return null==i&&(i=function(){}),r=function(){var r,o,s;for(o=0,s=e.length;s>o;o++)(r=e[o]).style.width=t.offsetWidth+"px",r.style.height=t.offsetHeight+"px",null!=r.width&&(r.setAttribute("width",r.offsetWidth*n),r.setAttribute("height",r.offsetHeight*n));return i()},t.addEventListener("resize",r),window.addEventListener("resize",r),window.addEventListener("orientationchange",r),r(),r},combineCanvases:function(){var t,e,n,i,r,o,s,h;for(n=1<=arguments.length?a.call(arguments,0):[],(t=document.createElement("canvas")).width=n[0].width,t.height=n[0].height,r=0,s=n.length;s>r;r++)e=n[r],t.width=Math.max(e.width,t.width),t.height=Math.max(e.height,t.height);for(i=t.getContext("2d"),o=0,h=n.length;h>o;o++)e=n[o],i.drawImage(e,0,0);return t},renderShapes:function(t,e,n,r){var o,s,a,h;for(null==n&&(n=1),null==r&&(r=null),(r=r||document.createElement("canvas")).width=e.width*n,r.height=e.height*n,(o=r.getContext("2d")).translate(-e.x*n,-e.y*n),o.scale(n,n),s=0,a=t.length;a>s;s++)h=t[s],i(o,h);return r},renderShapesToSVG:function(t,e,n){var i,o,s,a;return s=e.x,a=e.y,("<svg xmlns='http://www.w3.org/2000/svg' width='"+(o=e.width)+"' height='"+(i=e.height)+"' viewBox='0 0 "+o+" "+i+"'> <rect width='"+o+"' height='"+i+"' x='0' y='0' fill='"+n+"' /> <g transform='translate("+-s+", "+-a+")'> "+t.map(r).join("")+" </g> </svg>").replace(/(\r\n|\n|\r)/gm,"")},getBoundingRect:function(t,e,n){var i,r,o,s,a,h,l;if(!t.length)return{x:0,y:0,width:e,height:n};for(a=t[0].x,h=t[0].y,o=t[0].x+t[0].width,s=t[0].y+t[0].height,i=0,r=t.length;r>i;i++)l=t[i],a=Math.floor(Math.min(l.x,a)),h=Math.floor(Math.min(l.y,h)),o=Math.ceil(Math.max(o,l.x+l.width)),s=Math.ceil(Math.max(s,l.y+l.height));return{x:a=e?0:a,y:h=n?0:h,width:(o=e||o)-a,height:(s=n||s)-h}},getDefaultImageRect:function(t,e,n){var i,r,o;return null==e&&(e={width:0,height:0}),null==n&&(n={top:0,right:0,bottom:0,left:0}),o=e.width,i=e.height,(r=s.getBoundingRect(t,"infinite"===o?0:o,"infinite"===i?0:i)).x-=n.left,r.y-=n.top,r.width+=n.left+n.right,r.height+=n.top+n.bottom,r},getBackingScale:function(t){return null==window.devicePixelRatio?1:window.devicePixelRatio>1?window.devicePixelRatio:1},requestAnimationFrame:(window.requestAnimationFrame||window.setTimeout).bind(window),getGUID:function(){var t;return t=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},function(){return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}}()},_defineProperty(_s,"requestAnimationFrame",(function(t){return window.requestAnimationFrame?window.requestAnimationFrame(t):window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame(t):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(t):setTimeout(t,0)})),_defineProperty(_s,"cancelAnimationFrame",(function(t){return window.cancelAnimationFrame?window.cancelAnimationFrame(t):window.webkitCancelRequestAnimationFrame?window.webkitCancelRequestAnimationFrame(t):window.webkitCancelAnimationFrame?window.webkitCancelAnimationFrame(t):window.mozCancelAnimationFrame?window.mozCancelAnimationFrame(t):clearTimeout(t)})),s=_s,e.exports=s},{"./canvasRenderer":9,"./svgRenderer":18}],20:[function(t,e,n){!function(){function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n}t.prototype=window.CustomEvent.prototype,window.CustomEvent=t}()},{}],21:[function(t,e,n){var i=!1;CanvasRenderingContext2D.prototype.setLineDash||(CanvasRenderingContext2D.prototype.setLineDash=function(){i||(console.warn("context2D.setLineDash is a no-op in this browser."),i=!0)}),e.exports=null},{}],22:[function(t,e,n){var i,r,o,s,a,l,c,u,p,g,m,y,S,v,x,w,k,b;t("./ie_customevent"),t("./ie_setLineDash"),i=t("./core/LiterallyCanvas"),l=t("./core/defaultOptions"),s=t("./core/canvasRenderer"),w=t("./core/svgRenderer"),x=t("./core/shapes"),b=t("./core/util"),y=t("./core/renderSnapshotToImage"),S=t("./core/renderSnapshotToSVG"),g=t("./core/localization").localize,r=t("./reactGUI/LiterallyCanvas"),t("./reactGUI/initDOM"),t("./optionsStyles/font"),t("./optionsStyles/stroke-width"),t("./optionsStyles/line-options-and-stroke-width"),t("./optionsStyles/polygon-and-stroke-width"),t("./optionsStyles/stroke-or-fill"),t("./optionsStyles/null"),u=t("./optionsStyles/optionsStyles").defineOptionsStyle,a={snapshotToShapes:function(t){var e,n,i,r,o;for(r=[],e=0,n=(i=t.shapes).length;n>e;e++)o=i[e],r.push(x.JSONToShape(o));return r},snapshotJSONToShapes:function(t){return a.snapshotToShapes(JSON.parse(t))}},o=t("./tools/base"),k={Pencil:t("./tools/Pencil"),Eraser:t("./tools/Eraser"),Line:t("./tools/Line"),Rectangle:t("./tools/Rectangle"),Ellipse:t("./tools/Ellipse"),Text:t("./tools/Text"),Polygon:t("./tools/Polygon"),Pan:t("./tools/Pan"),Eyedropper:t("./tools/Eyedropper"),SelectShape:t("./tools/SelectShape"),Tool:o.Tool,ToolWithStroke:o.ToolWithStroke},c=l.tools,l.imageURLPrefix,v=function(t){return t,l.imageURLPrefix=t},p=function(e,n){var i,r,o,s,a;for(s in null==n&&(n={}),l)s in n||(n[s]=l[s]);for(r=0,o=(a=e.children).length;o>r;r++)i=a[r],e.removeChild(i);return t("./reactGUI/initDOM")(e,n)},m=function(t){return t.fn.literallycanvas=function(t){return null==t&&(t={}),this.each((function(e,n){return n.literallycanvas=p(n,t)})),this}},"undefined"!=typeof window&&(window.LC={init:p},window.$&&m(window.$)),e.exports={init:p,registerJQueryPlugin:m,util:b,tools:k,setDefaultImageURLPrefix:v,defaultTools:c,defineOptionsStyle:u,LiterallyCanvasReactComponent:r,defineShape:x.defineShape,createShape:x.createShape,JSONToShape:x.JSONToShape,shapeToJSON:x.shapeToJSON,defineCanvasRenderer:s.defineCanvasRenderer,renderShapeToContext:s.renderShapeToContext,renderShapeToCanvas:s.renderShapeToCanvas,renderShapesToCanvas:b.renderShapes,defineSVGRenderer:w.defineSVGRenderer,renderShapeToSVG:w.renderShapeToSVG,renderShapesToSVG:b.renderShapesToSVG,snapshotToShapes:a.snapshotToShapes,snapshotJSONToShapes:a.snapshotJSONToShapes,renderSnapshotToImage:y,renderSnapshotToSVG:S,localize:g}},{"./core/LiterallyCanvas":5,"./core/canvasRenderer":9,"./core/defaultOptions":10,"./core/localization":13,"./core/renderSnapshotToImage":15,"./core/renderSnapshotToSVG":16,"./core/shapes":17,"./core/svgRenderer":18,"./core/util":19,"./ie_customevent":20,"./ie_setLineDash":21,"./optionsStyles/font":23,"./optionsStyles/line-options-and-stroke-width":24,"./optionsStyles/null":25,"./optionsStyles/optionsStyles":26,"./optionsStyles/polygon-and-stroke-width":27,"./optionsStyles/stroke-or-fill":28,"./optionsStyles/stroke-width":29,"./reactGUI/LiterallyCanvas":32,"./reactGUI/initDOM":42,"./tools/Ellipse":43,"./tools/Eraser":44,"./tools/Eyedropper":45,"./tools/Line":46,"./tools/Pan":47,"./tools/Pencil":48,"./tools/Polygon":49,"./tools/Rectangle":50,"./tools/SelectShape":51,"./tools/Text":52,"./tools/base":53}],23:[function(t,e,n){var i,r,o,s,a,h,l,c,u,p,d,f,g,m,y,S,v,x,w,k,b,C,P;for(a=t("../reactGUI/React-shim"),u=t("./optionsStyles").defineOptionsStyle,c=t("../core/localization")._,h=[["Arial",'Arial,"Helvetica Neue",Helvetica,sans-serif'],["Arial Black",'"Arial Black","Arial Bold",Gadget,sans-serif'],["Arial Narrow",'"Arial Narrow",Arial,sans-serif'],["Gill Sans",'"Gill Sans","Gill Sans MT",Calibri,sans-serif'],["Helvetica",'"Helvetica Neue",Helvetica,Arial,sans-serif'],["Impact",'Impact,Haettenschweiler,"Franklin Gothic Bold",Charcoal,"Helvetica Inserat","Bitstream Vera Sans Bold","Arial Black",sans-serif'],["Tahoma","Tahoma,Verdana,Segoe,sans-serif"],["Trebuchet MS",'"Trebuchet MS","Lucida Grande","Lucida Sans Unicode","Lucida Sans",Tahoma,sans-serif'],["Verdana","Verdana,Geneva,sans-serif"]].map((function(t){var e,n;return e=t[0],n=t[1],{name:c(e),value:n}})),l=[["Baskerville",'Baskerville,"Baskerville Old Face","Hoefler Text",Garamond,"Times New Roman",serif'],["Garamond",'Garamond,Baskerville,"Baskerville Old Face","Hoefler Text","Times New Roman",serif'],["Georgia",'Georgia,Times,"Times New Roman",serif'],["Hoefler Text",'"Hoefler Text","Baskerville Old Face",Garamond,"Times New Roman",serif'],["Lucida Bright",'"Lucida Bright",Georgia,serif'],["Palatino",'Palatino,"Palatino Linotype","Palatino LT STD","Book Antiqua",Georgia,serif'],["Times New Roman",'TimesNewRoman,"Times New Roman",Times,Baskerville,Georgia,serif']].map((function(t){var e,n;return e=t[0],n=t[1],{name:c(e),value:n}})),o=[["Consolas/Monaco",'Consolas,monaco,"Lucida Console",monospace'],["Courier New",'"Courier New",Courier,"Lucida Sans Typewriter","Lucida Typewriter",monospace'],["Lucida Sans Typewriter",'"Lucida Sans Typewriter","Lucida Console",monaco,"Bitstream Vera Sans Mono",monospace']].map((function(t){var e,n;return e=t[0],n=t[1],{name:c(e),value:n}})),s=[["Copperplate",'Copperplate,"Copperplate Gothic Light",fantasy'],["Papyrus","Papyrus,fantasy"],["Script",'"Brush Script MT",cursive']].map((function(t){var e,n;return e=t[0],n=t[1],{name:c(e),value:n}})),i=[[c("Sans Serif"),h],[c("Serif"),l],[c("Monospace"),o],[c("Other"),s]],r={},p=0,g=h.length;g>p;p++)x=(w=h[p]).name,P=w.value,r[x]=P;for(d=0,m=l.length;m>d;d++)x=(k=l[d]).name,P=k.value,r[x]=P;for(f=0,y=o.length;y>f;f++)x=(b=o[f]).name,P=b.value,r[x]=P;for(v=0,S=s.length;S>v;v++)x=(C=s[v]).name,P=C.value,r[x]=P;u("font",a.createClass({displayName:"FontOptions",getInitialState:function(){return{isItalic:!1,isBold:!1,fontName:"Helvetica",fontSizeIndex:4}},getFontSizes:function(){return[9,10,12,14,18,24,36,48,64,72,96,144,288]},updateTool:function(t){var e,n,i;for(i in null==t&&(t={}),this.state)i in t||(t[i]=this.state[i]);return e=this.getFontSizes()[t.fontSizeIndex],n=[],t.isItalic&&n.push("italic"),t.isBold&&n.push("bold"),n.push(e+"px"),n.push(r[t.fontName]),this.props.lc.tool.font=n.join(" "),this.props.lc.trigger("setFont",n.join(" "))},handleFontSize:function(t){var e;return e={fontSizeIndex:t.target.value},this.setState(e),this.updateTool(e)},handleFontFamily:function(t){var e;return e={fontName:t.target.selectedOptions[0].innerHTML},this.setState(e),this.updateTool(e)},handleItalic:function(t){var e;return e={isItalic:!this.state.isItalic},this.setState(e),this.updateTool(e)},handleBold:function(t){var e;return e={isBold:!this.state.isBold},this.setState(e),this.updateTool(e)},componentDidMount:function(){return this.updateTool()},render:function(){var e,n,r,s,h,l,u,p;return this.props.lc,e=(l=a.DOM).div,n=l.input,u=l.select,h=l.option,l.br,r=l.label,p=l.span,s=l.optgroup,e({className:"lc-font-settings"},u({value:this.state.fontSizeIndex,onChange:this.handleFontSize},this.getFontSizes().map((function(t,e){return h({value:e,key:e},t+"px")}))),u({value:this.state.fontName,onChange:this.handleFontFamily},i.map((function(t){var e,n;return n=t[0],e=t[1],s({key:n,label:n},e.map((function(t,e){return h({value:t.name,key:e},t.name)})))}))),p({},r({htmlFor:"italic"},c("italic")),n({type:"checkbox",id:"italic",checked:this.state.isItalic,onChange:this.handleItalic})),p({},r({htmlFor:"bold"},c("bold")),n({type:"checkbox",id:"bold",checked:this.state.isBold,onChange:this.handleBold})))}})),e.exports={}},{"../core/localization":13,"../reactGUI/React-shim":35,"./optionsStyles":26}],24:[function(t,e,n){var i,r,o,s,a;i=t("../reactGUI/React-shim"),a=t("./optionsStyles").defineOptionsStyle,r=i.createFactory(t("../reactGUI/StrokeWidthPicker")),s=t("../reactGUI/createSetStateOnEventMixin"),o=t("../core/util").classSet,a("line-options-and-stroke-width",i.createClass({displayName:"LineOptionsAndStrokeWidth",getState:function(){return{strokeWidth:this.props.tool.strokeWidth,isDashed:this.props.tool.isDashed,hasEndArrow:this.props.tool.hasEndArrow}},getInitialState:function(){return this.getState()},mixins:[s("toolChange")],render:function(){var t,e,n,s,h,l,c,u;return n=(h=i.DOM).div,h.ul,h.li,s=h.img,c=function(t){return function(){return t.props.tool.isDashed=!t.props.tool.isDashed,t.setState(t.getState())}}(this),u=function(t){return function(){return t.props.tool.hasEndArrow=!t.props.tool.hasEndArrow,t.setState(t.getState())}}(this),e=o({"square-toolbar-button":!0,selected:this.state.isDashed}),t=o({"square-toolbar-button":!0,selected:this.state.hasEndArrow}),n({},n({className:e,onClick:c,style:l={float:"left",margin:1}},s({src:this.props.imageURLPrefix+"/dashed-line.png"})),n({className:t,onClick:u,style:l},s({src:this.props.imageURLPrefix+"/line-with-arrow.png"})),r({tool:this.props.tool,lc:this.props.lc}))}})),e.exports={}},{"../core/util":19,"../reactGUI/React-shim":35,"../reactGUI/StrokeWidthPicker":37,"../reactGUI/createSetStateOnEventMixin":40,"./optionsStyles":26}],25:[function(t,e,n){var i;i=t("../reactGUI/React-shim"),(0,t("./optionsStyles").defineOptionsStyle)("null",i.createClass({displayName:"NoOptions",render:function(){return i.DOM.div()}})),e.exports={}},{"../reactGUI/React-shim":35,"./optionsStyles":26}],26:[function(t,e,n){var i,r,o;i=t("../reactGUI/React-shim"),o={},r=function(t,e){return o[t]=i.createFactory(e)},e.exports={optionsStyles:o,defineOptionsStyle:r}},{"../reactGUI/React-shim":35}],27:[function(t,e,n){var i,r,o,s;i=t("../reactGUI/React-shim"),s=t("./optionsStyles").defineOptionsStyle,r=i.createFactory(t("../reactGUI/StrokeWidthPicker")),o=t("../reactGUI/createSetStateOnEventMixin"),s("polygon-and-stroke-width",i.createClass({displayName:"PolygonAndStrokeWidth",getState:function(){return{strokeWidth:this.props.tool.strokeWidth,inProgress:!1}},getInitialState:function(){return this.getState()},mixins:[o("toolChange")],componentDidMount:function(){var t,e,n;return n=[],this.unsubscribe=function(){var t,e,i,r;for(r=[],e=0,i=n.length;i>e;e++)t=n[e],r.push(t());return r},e=function(t){return function(){return t.state.inProgress?void 0:t.setState({inProgress:!0})}}(this),t=function(t){return function(){return t.setState({inProgress:!1})}}(this),n.push(this.props.lc.on("lc-polygon-started",e)),n.push(this.props.lc.on("lc-polygon-stopped",t))},componentWillUnmount:function(){return this.unsubscribe()},render:function(){var t,e,n,o,s,a,h,l;return n=this.props.lc,t=(l=i.DOM).div,e=l.img,a=function(){return n.trigger("lc-polygon-finishopen")},s=function(){return n.trigger("lc-polygon-finishclosed")},o=function(){return n.trigger("lc-polygon-cancel")},h={},this.state.inProgress||(h={display:"none"}),t({},t({className:"polygon-toolbar horz-toolbar",style:h},t({className:"square-toolbar-button",onClick:a},e({src:this.props.imageURLPrefix+"/polygon-open.png"})),t({className:"square-toolbar-button",onClick:s},e({src:this.props.imageURLPrefix+"/polygon-closed.png"})),t({className:"square-toolbar-button",onClick:o},e({src:this.props.imageURLPrefix+"/polygon-cancel.png"}))),t({},r({tool:this.props.tool,lc:this.props.lc})))}})),e.exports={}},{"../reactGUI/React-shim":35,"../reactGUI/StrokeWidthPicker":37,"../reactGUI/createSetStateOnEventMixin":40,"./optionsStyles":26}],28:[function(t,e,n){var i=t("../reactGUI/React-shim"),o=t("./optionsStyles").defineOptionsStyle,s=t("../reactGUI/createSetStateOnEventMixin"),a=t("../core/localization")._;o("stroke-or-fill",i.createClass({displayName:"StrokeOrFillPicker",getState:function(){return{strokeOrFill:"stroke"}},getInitialState:function(){return this.getState()},mixins:[s("toolChange")],onChange:function(t){"stroke-or-fill-stroke"==t.target.id?this.props.lc.tool.strokeOrFill="stroke":this.props.lc.tool.strokeOrFill="fill",this.setState(this.getState())},render:function(){var t=this.props.lc;return i.createElement("form",null,i.createElement("span",null," ",a("Color to change:")," "),i.createElement("span",null,i.createElement("input",{type:"radio",name:"stroke-or-fill",value:"stroke",id:"stroke-or-fill-stroke",onChange:this.onChange,checked:"stroke"==t.tool.strokeOrFill}),i.createElement("label",{htmlFor:"stroke-or-fill-stroke",className:"label"}," ",a("stroke"))),i.createElement("span",null,i.createElement("input",{type:"radio",name:"stroke-or-fill",value:"fill",id:"stroke-or-fill-fill",onChange:this.onChange,checked:"fill"==t.tool.strokeOrFill}),i.createElement("label",{htmlFor:"stroke-or-fill-fill",className:"label"}," ",a("fill"))))}})),e.exports={}},{"../core/localization":13,"../reactGUI/React-shim":35,"../reactGUI/createSetStateOnEventMixin":40,"./optionsStyles":26}],29:[function(t,e,n){(0,t("./optionsStyles").defineOptionsStyle)("stroke-width",t("../reactGUI/StrokeWidthPicker")),e.exports={}},{"../reactGUI/StrokeWidthPicker":37,"./optionsStyles":26}],30:[function(t,e,n){var i,r,o,s,a;r=t("./React-shim"),a=t("./createSetStateOnEventMixin"),o=t("../core/localization")._,s=t("../core/util").classSet,i=r.createClass({displayName:"ClearButton",getState:function(){return{isEnabled:this.props.lc.canUndo()}},getInitialState:function(){return this.getState()},mixins:[a("drawingChange")],render:function(){var e,n;return e=r.DOM.div,n=this.props.lc,e({className:s({"lc-clear":!0,"toolbar-button":!0,"fat-button":!0,disabled:!this.state.isEnabled}),onClick:n.canUndo()?function(){return n.clear()}:function(){}},o("Clear"))}}),e.exports=i},{"../core/localization":13,"../core/util":19,"./React-shim":35,"./createSetStateOnEventMixin":40}],31:[function(t,e,n){var i,r,o,s,a,l,c,p,d;s=t("./React-shim"),o=t("react-addons-pure-render-mixin"),d=t("../core/util"),l=d.classSet,d.requestAnimationFrame,d.cancelAnimationFrame,a=t("../core/localization")._,p=function(t){var e,n,i,r;return"transparent"===t?{hue:0,sat:0,light:0,alpha:0}:"hsla"!==(null!=t?t.substring(0,4):void 0)?null:(n=t.indexOf("("),r=t.indexOf(")"),i=t.substring(n+1,r-n+4),e=function(){var e,n,r,o;for(o=[],e=0,n=(r=i.split(",")).length;n>e;e++)t=r[e],o.push(t.trim());return o}(),{hue:parseInt(e[0],10),sat:parseInt(e[1].substring(0,e[1].length-1),10),light:parseInt(e[2].substring(0,e[2].length-1),10),alpha:parseFloat(e[3])})},c=function(t){return"hsla("+t.hue+", "+t.sat+"%, "+t.light+"%, "+t.alpha+")"},i=s.createFactory(s.createClass({displayName:"ColorGrid",mixins:[o],render:function(){var t;return(t=s.DOM.div)({},this.props.rows.map(function(e){return function(n,i){return t({className:"color-row",key:i,style:{width:20*n.length}},n.map((function(n,i){var o,s,a,h,u,p,d;return h=n.hue,p=n.sat,u=n.light,n.alpha,s=c(n),a="hsl("+h+", "+p+"%, "+u+"%)",o=l({"color-cell":!0,selected:e.props.selectedColor===s}),d=function(t){return e.props.onChange(n,s),t.stopPropagation(),t.preventDefault()},t({className:o,onTouchStart:d,onTouchMove:d,onClick:d,style:{backgroundColor:a},key:i})})))}}(this)))}})),r=s.createClass({displayName:"ColorWell",mixins:[o],getInitialState:function(){var t,e;return t=this.props.lc.colors[this.props.colorName],null==(e=p(t))&&(e={}),null==e.alpha&&(e.alpha=1),null==e.sat&&(e.sat=100),null==e.hue&&(e.hue=0),null==e.light&&(e.light=50),{colorString:t,alpha:e.alpha,sat:0===e.sat?100:e.sat,isPickerVisible:!1,hsla:e}},componentDidMount:function(){return this.unsubscribe=this.props.lc.on(this.props.colorName+"ColorChange",function(t){return function(){var e;return e=t.props.lc.colors[t.props.colorName],t.setState({colorString:e}),t.setHSLAFromColorString(e)}}(this))},componentWillUnmount:function(){return this.unsubscribe()},setHSLAFromColorString:function(t){var e;return(e=p(t))?this.setState({hsla:e,alpha:e.alpha,sat:e.sat}):this.setState({hsla:null,alpha:1,sat:100})},closePicker:function(){return this.setState({isPickerVisible:!1})},togglePicker:function(){var t,e;return e=(t=!this.state.isPickerVisible)&&0===this.state.sat,this.setHSLAFromColorString(this.state.colorString),this.setState({isPickerVisible:t,sat:e?100:this.state.sat})},setColor:function(t){return this.setState({colorString:t}),this.setHSLAFromColorString(t),this.props.lc.setColor(this.props.colorName,t)},setAlpha:function(t){var e;return this.setState({alpha:t}),this.state.hsla?((e=this.state.hsla).alpha=t,this.setState({hsla:e}),this.setColor(c(e))):void 0},setSat:function(t){var e;if(this.setState({sat:t}),isNaN(t))throw"SAT";return this.state.hsla?((e=this.state.hsla).sat=t,this.setState({hsla:e}),this.setColor(c(e))):void 0},render:function(){var t,e,n,i;return e=(i=s.DOM).div,n=i.label,t=i.br,e({className:l({"color-well":!0,open:this.state.isPickerVisible}),onMouseLeave:this.closePicker,style:{float:"left",textAlign:"center"}},n({float:"left"},this.props.label),t({}),e({className:l({"color-well-color-container":!0,selected:this.state.isPickerVisible}),style:{backgroundColor:"white"},onClick:this.togglePicker},e({className:"color-well-checker color-well-checker-top-left"}),e({className:"color-well-checker color-well-checker-bottom-right",style:{left:"50%",top:"50%"}}),e({className:"color-well-color",style:{backgroundColor:this.state.colorString}}," ")),this.renderPicker())},renderPicker:function(){var _r2,t,e,n,r,o,l,c,u,p,d,f,g;if(u=s.DOM,t=u.div,u.label,r=u.input,!this.state.isPickerVisible)return null;for(f=function(e){return t({className:"color-row label",key:e,style:{lineHeight:"20px",height:16}},e)},d=function(e){return function(){var n;return n=e.props.lc.opts.imageURLPrefix+"/checkerboard-8x8.png",t({className:"color-row",key:"color",style:{position:"relative",backgroundImage:"url("+n+")",backgroundRepeat:"repeat",height:24}},t({style:{position:"absolute",top:0,right:0,bottom:0,left:0,backgroundColor:e.state.colorString}}))}}(this),(g=[]).push(function(){var t,e;for(e=[],n=t=0;100>=t;n=t+=10)e.push({hue:0,sat:0,light:n,alpha:this.state.alpha});return e}.call(this)),o=0,l=(p=[0,30,60,90,120,150,180,210,240,270,300,330]).length;l>o;o++)e=p[o],g.push(function(){var t,i;for(i=[],n=t=10;90>=t;n=t+=8)i.push({hue:e,sat:this.state.sat,light:n,alpha:this.state.alpha});return i}.call(this));return c=function(t){return function(e,n){return t.setColor(n)}}(this),t({className:"color-picker-popup"},d(),f(a("alpha")),r({type:"range",min:0,max:1,step:.01,value:this.state.alpha,onChange:function(t){return function(e){return t.setAlpha(parseFloat(e.target.value))}}(this)}),f(a("saturation")),r((_defineProperty(_r2={type:"range",min:0,max:100,value:this.state.sat},"max",100),_defineProperty(_r2,"onChange",function(t){return function(e){return t.setSat(parseInt(e.target.value,10))}}(this)),_r2)),i({rows:g,selectedColor:this.state.colorString,onChange:c}))}}),e.exports=r},{"../core/localization":13,"../core/util":19,"./React-shim":35,"react-addons-pure-render-mixin":2}],32:[function(t,e,n){var i=t("../reactGUI/React-shim"),o=t("../reactGUI/ReactDOM-shim").findDOMNode,a=t("../core/util").classSet,h=t("./Picker"),l=t("./Options"),c=t("./createToolButton"),u=t("../core/LiterallyCanvas"),p=t("../core/defaultOptions");t("../optionsStyles/font"),t("../optionsStyles/stroke-width"),t("../optionsStyles/line-options-and-stroke-width"),t("../optionsStyles/polygon-and-stroke-width"),t("../optionsStyles/null");var d=i.createClass({displayName:"CanvasContainer",shouldComponentUpdate:function(){return!1},render:function(){return i.createElement("div",{key:"literallycanvas",className:"lc-drawing with-gui"})}}),f=i.createClass({displayName:"LiterallyCanvas",getDefaultProps:function(){return p},bindToModel:function(){var t=o(this.canvas);this.props,this.lc.bindToElement(t),"function"==typeof this.lc.opts.onInit&&this.lc.opts.onInit(this.lc)},componentWillMount:function(){var t=this;this.lc||(this.props.lc?this.lc=this.props.lc:this.lc=new u(this.props),this.toolButtonComponents=this.lc.opts.tools.map((function(e){return c(new e(t.lc))})))},componentDidMount:function(){this.lc.isBound||this.bindToModel()},componentWillUnmount:function(){this.lc&&this.lc._teardown()},render:function(){var t=this,e=this.lc,n=this.toolButtonComponents,r=(this.props,this.lc.opts),o=r.imageURLPrefix,s=r.toolbarPosition,c={lc:e,toolButtonComponents:n,imageURLPrefix:o},u=a({"toolbar-at-top":"top"===s,"toolbar-at-bottom":"bottom"===s,"toolbar-hidden":"hidden"===s});return i.createElement("div",{className:"literally "+u},i.createElement(d,{ref:function(e){return t.canvas=e}}),i.createElement(h,c),i.createElement(l,{lc:e,imageURLPrefix:o}))}});e.exports=f},{"../core/LiterallyCanvas":5,"../core/defaultOptions":10,"../core/util":19,"../optionsStyles/font":23,"../optionsStyles/line-options-and-stroke-width":24,"../optionsStyles/null":25,"../optionsStyles/polygon-and-stroke-width":27,"../optionsStyles/stroke-width":29,"../reactGUI/React-shim":35,"../reactGUI/ReactDOM-shim":36,"./Options":33,"./Picker":34,"./createToolButton":41}],33:[function(t,e,n){var i,r,o,s;r=t("./React-shim"),o=t("./createSetStateOnEventMixin"),s=t("../optionsStyles/optionsStyles").optionsStyles,i=r.createClass({displayName:"Options",getState:function(){var t;return{style:null!=(t=this.props.lc.tool)?t.optionsStyle:void 0,tool:this.props.lc.tool}},getInitialState:function(){return this.getState()},mixins:[o("toolChange")],renderBody:function(){var t;return t=""+this.state.style,s[t]&&s[t]({lc:this.props.lc,tool:this.state.tool,imageURLPrefix:this.props.imageURLPrefix})},render:function(){return(0,r.DOM.div)({className:"lc-options horz-toolbar"},this.renderBody())}}),e.exports=i},{"../optionsStyles/optionsStyles":26,"./React-shim":35,"./createSetStateOnEventMixin":40}],34:[function(t,e,n){var i,r,o,s,a,h,l,c;a=t("./React-shim"),i=a.createFactory(t("./ClearButton")),h=a.createFactory(t("./UndoRedoButtons")),l=a.createFactory(t("./ZoomButtons")),c=t("../core/localization")._,o=a.createFactory(t("./ColorWell")),r=a.createFactory(a.createClass({displayName:"ColorPickers",render:function(){var e;return e=this.props.lc,(0,a.DOM.div)({className:"lc-color-pickers"},o({lc:e,colorName:"primary",label:c("stroke")}),o({lc:e,colorName:"secondary",label:c("fill")}),o({lc:e,colorName:"background",label:c("bg")}))}})),s=a.createClass({displayName:"Picker",getInitialState:function(){return{selectedToolIndex:0}},renderBody:function(){var t,e,n,o,s;return t=a.DOM.div,s=(o=this.props).toolButtonComponents,n=o.lc,e=o.imageURLPrefix,t({className:"lc-picker-contents"},s.map(function(t){return function(i,r){return i({lc:n,imageURLPrefix:e,key:r,isSelected:r===t.state.selectedToolIndex,onSelect:function(e){return n.setTool(e),t.setState({selectedToolIndex:r})}})}}(this)),s.length%2!=0?t({className:"toolbar-button thin-button disabled"}):void 0,t({style:{position:"absolute",bottom:0,left:0,right:0}},r({lc:this.props.lc}),h({lc:n,imageURLPrefix:e}),l({lc:n,imageURLPrefix:e}),i({lc:n})))},render:function(){return(0,a.DOM.div)({className:"lc-picker"},this.renderBody())}}),e.exports=s},{"../core/localization":13,"./ClearButton":30,"./ColorWell":31,"./React-shim":35,"./UndoRedoButtons":38,"./ZoomButtons":39}],35:[function(t,e,n){var i;try{i=t("react")}catch(r){i=window.React}if(null==i)throw"Can't find React";e.exports=i},{react:"react"}],36:[function(t,e,n){var i;try{i=t("react-dom")}catch(r){i=window.ReactDOM}if(null==i)try{i=t("react")}catch(o){i=window.React}if(null==i)throw"Can't find ReactDOM";e.exports=i},{react:"react","react-dom":"react-dom"}],37:[function(t,e,n){var i,r,o;i=t("./React-shim"),o=t("../reactGUI/createSetStateOnEventMixin"),r=t("../core/util").classSet,e.exports=i.createClass({displayName:"StrokeWidthPicker",getState:function(t){return null==t&&(t=this.props.tool),{strokeWidth:t.strokeWidth}},getInitialState:function(){return this.getState()},mixins:[o("toolDidUpdateOptions")],componentWillReceiveProps:function(t){return this.setState(this.getState(t.tool))},render:function(){var t,e,o,s,a;return(o=i.DOM).ul,o.li,a=o.svg,t=o.circle,e=o.div,s=this.props.lc.opts.strokeWidths,e({},s.map(function(n){return function(i,o){var s;return s=r({"square-toolbar-button":!0,selected:i===n.state.strokeWidth}),28,e({key:i},e({className:s,onClick:function(){return n.props.lc.trigger("setStrokeWidth",i)}},a({width:26,height:26,viewPort:"0 0 "+i+" "+i,version:"1.1",xmlns:"http://www.w3.org/2000/svg"},t({cx:Math.ceil(13),cy:Math.ceil(13),r:i/2}))))}}(this)))}})},{"../core/util":19,"../reactGUI/createSetStateOnEventMixin":40,"./React-shim":35}],38:[function(t,e,n){var i,r,o,s,a,h,l;i=t("./React-shim"),h=t("./createSetStateOnEventMixin"),a=t("../core/util").classSet,l=function(t){return i.createClass({displayName:"undo"===t?"UndoButton":"RedoButton",getState:function(){return{isEnabled:function(){switch(!1){case"undo"!==t:return this.props.lc.canUndo();case"redo"!==t:return this.props.lc.canRedo()}}.call(this)}},getInitialState:function(){return this.getState()},mixins:[h("drawingChange")],render:function(){var n,r,s,l,c,d;return n=(l=i.DOM).div,l.img,c=this.props,s=c.lc,r=c.imageURLPrefix,d="undo"===t?"Undo":"Redo",n({className:"lc-"+t+" "+a({"toolbar-button":!0,"thin-button":!0,disabled:!this.state.isEnabled}),onClick:function(){switch(!1){case!!this.state.isEnabled:return function(){};case"undo"!==t:return function(){return s.undo()};case"redo"!==t:return function(){return s.redo()}}}.call(this),title:d,style:{backgroundImage:"url("+(r+"/"+t+".png")+")"}})}})},o=i.createFactory(l("undo")),r=i.createFactory(l("redo")),s=i.createClass({displayName:"UndoRedoButtons",render:function(){return(0,i.DOM.div)({className:"lc-undo-redo"},o(this.props),r(this.props))}}),e.exports=s},{"../core/util":19,"./React-shim":35,"./createSetStateOnEventMixin":40}],39:[function(t,e,n){var i,r,o,s,a,h,l;i=t("./React-shim"),h=t("./createSetStateOnEventMixin"),a=t("../core/util").classSet,l=function(t){return i.createClass({displayName:"in"===t?"ZoomInButton":"ZoomOutButton",getState:function(){return{isEnabled:function(){switch(!1){case"in"!==t:return this.props.lc.scale<this.props.lc.config.zoomMax;case"out"!==t:return this.props.lc.scale>this.props.lc.config.zoomMin}}.call(this)}},getInitialState:function(){return this.getState()},mixins:[h("zoom")],render:function(){var n,r,s,l,c,d;return n=(l=i.DOM).div,l.img,c=this.props,s=c.lc,r=c.imageURLPrefix,d="in"===t?"Zoom in":"Zoom out",n({className:"lc-zoom-"+t+" "+a({"toolbar-button":!0,"thin-button":!0,disabled:!this.state.isEnabled}),onClick:function(){switch(!1){case!!this.state.isEnabled:return function(){};case"in"!==t:return function(){return s.zoom(s.config.zoomStep)};case"out"!==t:return function(){return s.zoom(-s.config.zoomStep)}}}.call(this),title:d,style:{backgroundImage:"url("+(r+"/zoom-"+t+".png")+")"}})}})},s=i.createFactory(l("out")),o=i.createFactory(l("in")),r=i.createClass({displayName:"ZoomButtons",render:function(){return(0,i.DOM.div)({className:"lc-zoom"},s(this.props),o(this.props))}}),e.exports=r},{"../core/util":19,"./React-shim":35,"./createSetStateOnEventMixin":40}],40:[function(t,e,n){t("./React-shim"),e.exports=function(t){return{componentDidMount:function(){return this.unsubscribe=this.props.lc.on(t,function(t){return function(){return t.setState(t.getState())}}(this))},componentWillUnmount:function(){return this.unsubscribe()}}}},{"./React-shim":35}],41:[function(t,e,n){var i,r,o,s;i=t("./React-shim"),o=t("../core/util").classSet,r=t("../core/localization")._,s=function(t){var e,n;return e=t.name,n=t.iconName,i.createFactory(i.createClass({displayName:e,getDefaultProps:function(){return{isSelected:!1,lc:null}},componentWillMount:function(){return this.props.isSelected?this.props.lc.setTool(t):void 0},render:function(){var a,h,c,u,p,d;return a=(p=i.DOM).div,p.img,h=(d=this.props).imageURLPrefix,c=d.isSelected,u=d.onSelect,a({className:o({"lc-pick-tool":!0,"toolbar-button":!0,"thin-button":!0,selected:c}),style:{backgroundImage:"url("+(h+"/"+n+".png")+")"},onClick:function(){return u(t)},title:r(e)})}}))},e.exports=s},{"../core/localization":13,"../core/util":19,"./React-shim":35}],42:[function(t,e,n){var r=t("./React-shim"),o=t("./ReactDOM-shim"),s=t("../core/LiterallyCanvas"),a=t("./LiterallyCanvas");e.exports=function(t,e){var n=t.className,i=new s(e);return o.render(r.createElement(a,{lc:i}),t),i.teardown=function(){i._teardown();for(var e=0;e<t.children.length;e++)t.removeChild(t.children[e]);t.className=n},i}},{"../core/LiterallyCanvas":5,"./LiterallyCanvas":32,"./React-shim":35,"./ReactDOM-shim":36}],43:[function(t,e,n){var r,o,a={}.hasOwnProperty;r=t("./base").ToolWithStroke,o=t("../core/shapes").createShape,e.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){function n(){this.constructor=t}for(var i in e)a.call(e,i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,t),e.prototype.name="Ellipse",e.prototype.iconName="ellipse",e.prototype.begin=function(t,e,n){return this.currentShape=o("Ellipse",{x:t,y:e,strokeWidth:this.strokeWidth,strokeColor:n.getColor("primary"),fillColor:n.getColor("secondary")})},e.prototype.continue=function(t,e,n){return this.currentShape.width=t-this.currentShape.x,this.currentShape.height=e-this.currentShape.y,n.drawShapeInProgress(this.currentShape)},e.prototype.end=function(t,e,n){return n.saveShape(this.currentShape)},e}(r)},{"../core/shapes":17,"./base":53}],44:[function(t,e,n){var r,o,a={}.hasOwnProperty;r=t("./Pencil"),o=t("../core/shapes").createShape,e.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){function n(){this.constructor=t}for(var i in e)a.call(e,i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,t),e.prototype.name="Eraser",e.prototype.iconName="eraser",e.prototype.makePoint=function(t,e,n){return o("Point",{x:t,y:e,size:this.strokeWidth,color:"#000"})},e.prototype.makeShape=function(){return o("ErasedLinePath")},e}(r)},{"../core/shapes":17,"./Pencil":48}],45:[function(t,e,n){var r,o,a={}.hasOwnProperty;r=t("./base").Tool,o=function(t,e){var n,i,r;return i=e.x,r=e.y,(n=t.getImageData(i,r,1,1).data)[3]?"rgb("+n[0]+", "+n[1]+", "+n[2]+")":null},e.exports=function(t){function e(t){e.__super__.constructor.call(this,t),this.strokeOrFill="stroke"}return function(t,e){function n(){this.constructor=t}for(var i in e)a.call(e,i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,t),e.prototype.name="Eyedropper",e.prototype.iconName="eyedropper",e.prototype.optionsStyle="stroke-or-fill",e.prototype.readColor=function(t,e,n){var i,s,a;return a=n.getDefaultImageRect(),i=n.getImage(),(s=o(i.getContext("2d"),{x:t-a.x,y:e-a.y}))||n.getColor("background"),"stroke"===this.strokeOrFill?n.setColor("primary",s):n.setColor("secondary",s)},e.prototype.begin=function(t,e,n){return this.readColor(t,e,n)},e.prototype.continue=function(t,e,n){return this.readColor(t,e,n)},e}(r)},{"./base":53}],46:[function(t,e,n){var r,o,a={}.hasOwnProperty;r=t("./base").ToolWithStroke,o=t("../core/shapes").createShape,e.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){function n(){this.constructor=t}for(var i in e)a.call(e,i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,t),e.prototype.name="Line",e.prototype.iconName="line",e.prototype.optionsStyle="line-options-and-stroke-width",e.prototype.begin=function(t,e,n){return this.currentShape=o("Line",{x1:t,y1:e,x2:t,y2:e,strokeWidth:this.strokeWidth,dash:function(){return!1==!this.isDashed?[2*this.strokeWidth,4*this.strokeWidth]:null}.call(this),endCapShapes:this.hasEndArrow?[null,"arrow"]:null,color:n.getColor("primary")})},e.prototype.continue=function(t,e,n){return this.currentShape.x2=t,this.currentShape.y2=e,n.drawShapeInProgress(this.currentShape)},e.prototype.end=function(t,e,n){return n.saveShape(this.currentShape)},e}(r)},{"../core/shapes":17,"./base":53}],47:[function(t,e,n){var r,a={}.hasOwnProperty;r=t("./base").Tool,t("../core/shapes").createShape,e.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){function n(){this.constructor=t}for(var i in e)a.call(e,i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,t),e.prototype.name="Pan",e.prototype.iconName="pan",e.prototype.usesSimpleAPI=!1,e.prototype.didBecomeActive=function(t){var e;return e=[],this.unsubscribe=function(){var t,n,i,r;for(r=[],n=0,i=e.length;i>n;n++)t=e[n],r.push(t());return r},e.push(t.on("lc-pointerdown",function(e){return function(n){var i,r;return i=n.rawX,r=n.rawY,e.oldPosition=t.position,e.pointerStart={x:i,y:r}}}(this))),e.push(t.on("lc-pointerdrag",function(e){return function(n){var i,r,o;return r=n.rawX,o=n.rawY,i={x:(r-e.pointerStart.x)*t.backingScale,y:(o-e.pointerStart.y)*t.backingScale},t.setPan(e.oldPosition.x+i.x,e.oldPosition.y+i.y)}}(this)))},e.prototype.willBecomeInactive=function(t){return this.unsubscribe()},e}(r)},{"../core/shapes":17,"./base":53}],48:[function(t,e,n){var r,o,a={}.hasOwnProperty;r=t("./base").ToolWithStroke,o=t("../core/shapes").createShape,e.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){function n(){this.constructor=t}for(var i in e)a.call(e,i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,t),e.prototype.name="Pencil",e.prototype.iconName="pencil",e.prototype.eventTimeThreshold=10,e.prototype.begin=function(t,e,n){return this.color=n.getColor("primary"),this.currentShape=this.makeShape(),this.currentShape.addPoint(this.makePoint(t,e,n)),this.lastEventTime=Date.now()},e.prototype.continue=function(t,e,n){var i;return(i=Date.now()-this.lastEventTime)>this.eventTimeThreshold?(this.lastEventTime+=i,this.currentShape.addPoint(this.makePoint(t,e,n)),n.drawShapeInProgress(this.currentShape)):void 0},e.prototype.end=function(t,e,n){return n.saveShape(this.currentShape),this.currentShape=void 0},e.prototype.makePoint=function(t,e,n){return o("Point",{x:t,y:e,size:this.strokeWidth,color:this.color})},e.prototype.makeShape=function(){return o("LinePath")},e}(r)},{"../core/shapes":17,"./base":53}],49:[function(t,e,n){var r,o,a={}.hasOwnProperty;r=t("./base").ToolWithStroke,o=t("../core/shapes").createShape,e.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){function n(){this.constructor=t}for(var i in e)a.call(e,i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,t),e.prototype.name="Polygon",e.prototype.iconName="polygon",e.prototype.usesSimpleAPI=!1,e.prototype.didBecomeActive=function(t){var n,i,r,o,s,a,h;return e.__super__.didBecomeActive.call(this,t),h=[],this.polygonUnsubscribe=function(){var t,e,n,i;for(i=[],e=0,n=h.length;n>e;e++)t=h[e],i.push(t());return i},this.points=null,this.maybePoint=null,r=function(e){return function(){return e._getWillFinish()?e._close(t):(t.trigger("lc-polygon-started"),e.points?e.points.push(e.maybePoint):e.points=[e.maybePoint],e.maybePoint={x:e.maybePoint.x,y:e.maybePoint.y},t.setShapesInProgress(e._getShapes(t)),t.repaintLayer("main"))}}(this),i=function(e){return function(n){var i,r;return i=n.x,r=n.y,e.maybePoint?(e.maybePoint.x=i,e.maybePoint.y=r,t.setShapesInProgress(e._getShapes(t)),t.repaintLayer("main")):void 0}}(this),n=function(e){return function(n){var i,r;return i=n.x,r=n.y,e.maybePoint={x:i,y:r},t.setShapesInProgress(e._getShapes(t)),t.repaintLayer("main")}}(this),a=function(e){return function(){return e.maybePoint={x:1/0,y:1/0},e._close(t)}}(this),s=function(e){return function(){return e.maybePoint=e.points[0],e._close(t)}}(this),o=function(e){return function(){return e._cancel(t)}}(this),h.push(t.on("drawingChange",function(e){return function(){return e._cancel(t)}}(this))),h.push(t.on("lc-pointerdown",n)),h.push(t.on("lc-pointerdrag",i)),h.push(t.on("lc-pointermove",i)),h.push(t.on("lc-pointerup",r)),h.push(t.on("lc-polygon-finishopen",a)),h.push(t.on("lc-polygon-finishclosed",s)),h.push(t.on("lc-polygon-cancel",o))},e.prototype.willBecomeInactive=function(t){return e.__super__.willBecomeInactive.call(this,t),(this.points||this.maybePoint)&&this._cancel(t),this.polygonUnsubscribe()},e.prototype._getArePointsClose=function(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)<10},e.prototype._getWillClose=function(){return!!(this.points&&this.points.length>1&&this.maybePoint)&&this._getArePointsClose(this.points[0],this.maybePoint)},e.prototype._getWillFinish=function(){return!!(this.points&&this.points.length>1&&this.maybePoint)&&(this._getArePointsClose(this.points[0],this.maybePoint)||this._getArePointsClose(this.points[this.points.length-1],this.maybePoint))},e.prototype._cancel=function(t){return t.trigger("lc-polygon-stopped"),this.maybePoint=null,this.points=null,t.setShapesInProgress([]),t.repaintLayer("main")},e.prototype._close=function(t){return t.trigger("lc-polygon-stopped"),t.setShapesInProgress([]),this.points.length>2&&t.saveShape(this._getShape(t,!1)),this.maybePoint=null,this.points=null},e.prototype._getShapes=function(t,e){var n;return null==e&&(e=!0),(n=this._getShape(t,e))?[n]:[]},e.prototype._getShape=function(t,e){var n;return null==e&&(e=!0),n=[],this.points&&(n=n.concat(this.points)),!e&&n.length<3?null:(e&&this.maybePoint&&n.push(this.maybePoint),n.length>1?o("Polygon",{isClosed:this._getWillClose(),strokeColor:t.getColor("primary"),fillColor:t.getColor("secondary"),strokeWidth:this.strokeWidth,points:n.map((function(t){return o("Point",t)}))}):null)},e.prototype.optionsStyle="polygon-and-stroke-width",e}(r)},{"../core/shapes":17,"./base":53}],50:[function(t,e,n){var r,o,a={}.hasOwnProperty;r=t("./base").ToolWithStroke,o=t("../core/shapes").createShape,e.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){function n(){this.constructor=t}for(var i in e)a.call(e,i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,t),e.prototype.name="Rectangle",e.prototype.iconName="rectangle",e.prototype.begin=function(t,e,n){return this.currentShape=o("Rectangle",{x:t,y:e,strokeWidth:this.strokeWidth,strokeColor:n.getColor("primary"),fillColor:n.getColor("secondary")})},e.prototype.continue=function(t,e,n){return this.currentShape.width=t-this.currentShape.x,this.currentShape.height=e-this.currentShape.y,n.drawShapeInProgress(this.currentShape)},e.prototype.end=function(t,e,n){return n.saveShape(this.currentShape)},e}(r)},{"../core/shapes":17,"./base":53}],51:[function(t,e,n){var r,o,a={}.hasOwnProperty;r=t("./base").Tool,o=t("../core/shapes").createShape,e.exports=function(t){function e(t){this.selectCanvas=document.createElement("canvas"),this.selectCanvas.style["background-color"]="transparent",this.selectCtx=this.selectCanvas.getContext("2d")}return function(t,e){function n(){this.constructor=t}for(var i in e)a.call(e,i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,t),e.prototype.name="SelectShape",e.prototype.usesSimpleAPI=!1,e.prototype.didBecomeActive=function(t){var e,n,i,r;return r=[],this._selectShapeUnsubscribe=function(){var t,e,n,i;for(i=[],e=0,n=r.length;n>e;e++)t=r[e],i.push(t());return i},e=function(e){return function(n){var i,r,s,a;return s=n.x,a=n.y,e.didDrag=!1,r=e._getPixel(s,a,t,e.selectCtx),e.selectedShape=t.shapes[r],null!=e.selectedShape?(t.trigger("shapeSelected",{selectedShape:e.selectedShape}),t.setShapesInProgress([e.selectedShape,o("SelectionBox",{shape:e.selectedShape,handleSize:0})]),t.repaintLayer("main"),i=e.selectedShape.getBoundingRect(),e.dragOffset={x:s-i.x,y:a-i.y}):void 0}}(this),n=function(e){return function(n){var i,r;return i=n.x,r=n.y,null!=e.selectedShape?(e.didDrag=!0,e.selectedShape.setUpperLeft({x:i-e.dragOffset.x,y:r-e.dragOffset.y}),t.setShapesInProgress([e.selectedShape,o("SelectionBox",{shape:e.selectedShape,handleSize:0})]),t.repaintLayer("main")):void 0}}(this),i=function(e){return function(n){return n.x,n.y,e.didDrag?(e.didDrag=!1,t.trigger("shapeMoved",{shape:e.selectedShape}),t.trigger("drawingChange",{}),t.repaintLayer("main"),e._drawSelectCanvas(t)):void 0}}(this),r.push(t.on("lc-pointerdown",e)),r.push(t.on("lc-pointerdrag",n)),r.push(t.on("lc-pointerup",i)),this._drawSelectCanvas(t)},e.prototype.willBecomeInactive=function(t){return this._selectShapeUnsubscribe(),t.setShapesInProgress([])},e.prototype._drawSelectCanvas=function(t){var e;return this.selectCanvas.width=t.canvas.width,this.selectCanvas.height=t.canvas.height,this.selectCtx.clearRect(0,0,this.selectCanvas.width,this.selectCanvas.height),e=t.shapes.map(function(t){return function(e,n){return o("SelectionBox",{shape:e,handleSize:0,backgroundColor:"#"+t._intToHex(n)})}}(this)),t.draw(e,this.selectCtx)},e.prototype._intToHex=function(t){return("000000"+t.toString(16)).slice(-6)},e.prototype._getPixel=function(t,e,n,i){var r,o;return r=n.drawingCoordsToClientCoords(t,e),(o=i.getImageData(r.x,r.y,1,1).data)[3]?parseInt(this._rgbToHex(o[0],o[1],o[2]),16):null},e.prototype._componentToHex=function(t){return("0"+t.toString(16)).slice(-2)},e.prototype._rgbToHex=function(t,e,n){return""+this._componentToHex(t)+this._componentToHex(e)+this._componentToHex(n)},e}(r)},{"../core/shapes":17,"./base":53}],52:[function(t,e,n){var r,o,s,h={}.hasOwnProperty;r=t("./base").Tool,o=t("../core/shapes").createShape,s=function(t,e){return!(t.x<e.x)&&(!(t.y<e.y)&&(!(t.x>e.x+e.width)&&!(t.y>e.y+e.height)))},e.exports=function(t){function e(){this.text="",this.font="bold 18px sans-serif",this.currentShape=null,this.currentShapeState=null,this.initialShapeBoundingRect=null,this.dragAction=null,this.didDrag=!1}return function(t,e){function n(){this.constructor=t}for(var i in e)h.call(e,i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,t),e.prototype.name="Text",e.prototype.iconName="text",e.prototype.didBecomeActive=function(t){var e,n,i;return n=[],this.unsubscribe=function(){var t,e,i,r;for(r=[],e=0,i=n.length;i>e;e++)t=n[e],r.push(t());return r},e=function(e){return function(){return e._ensureNotEditing(t),e._clearCurrentShape(t),t.repaintLayer("main")}}(this),i=function(e){return function(){return e._updateInputEl(t)}}(this),n.push(t.on("drawingChange",e)),n.push(t.on("zoom",i)),n.push(t.on("imageSizeChange",i)),n.push(t.on("snapshotLoad",function(e){return function(){return e._clearCurrentShape(t),t.repaintLayer("main")}}(this))),n.push(t.on("primaryColorChange",function(e){return function(n){return e.currentShape?(e.currentShape.color=n,e._updateInputEl(t),t.repaintLayer("main")):void 0}}(this))),n.push(t.on("setFont",function(e){return function(n){return e.currentShape?(e.font=n,e.currentShape.setFont(n),e._setShapesInProgress(t),e._updateInputEl(t),t.repaintLayer("main")):void 0}}(this)))},e.prototype.willBecomeInactive=function(t){return this.currentShape&&(this._ensureNotEditing(t),this.commit(t)),this.unsubscribe()},e.prototype.setText=function(t){return this.text=t},e.prototype._ensureNotEditing=function(t){return"editing"===this.currentShapeState?this._exitEditingState(t):void 0},e.prototype._clearCurrentShape=function(t){return this.currentShape=null,this.initialShapeBoundingRect=null,this.currentShapeState=null,t.setShapesInProgress([])},e.prototype.commit=function(t){return this.currentShape.text&&t.saveShape(this.currentShape),this._clearCurrentShape(t),t.repaintLayer("main")},e.prototype._getSelectionShape=function(t,e){return null==e&&(e=null),o("SelectionBox",{shape:this.currentShape,ctx:t,backgroundColor:e})},e.prototype._setShapesInProgress=function(t){switch(this.currentShapeState){case"selected":return t.setShapesInProgress([this._getSelectionShape(t.ctx),this.currentShape]);case"editing":return t.setShapesInProgress([this._getSelectionShape(t.ctx,"#fff")]);default:return t.setShapesInProgress([this.currentShape])}},e.prototype.begin=function(t,e,n){var i,r,h;return this.dragAction="none",this.didDrag=!1,"selected"===this.currentShapeState||"editing"===this.currentShapeState?(i=this.currentShape.getBoundingRect(n.ctx),(h=this._getSelectionShape(n.ctx)).getBoundingRect(),s(r={x:t,y:e},i)&&(this.dragAction="move"),s(r,h.getBottomRightHandleRect())&&(this.dragAction="resizeBottomRight"),s(r,h.getTopLeftHandleRect())&&(this.dragAction="resizeTopLeft"),s(r,h.getBottomLeftHandleRect())&&(this.dragAction="resizeBottomLeft"),s(r,h.getTopRightHandleRect())&&(this.dragAction="resizeTopRight"),"none"===this.dragAction&&"editing"===this.currentShapeState&&(this.dragAction="stop-editing",this._exitEditingState(n))):(this.color=n.getColor("primary"),this.currentShape=o("Text",{x:t,y:e,text:this.text,color:this.color,font:this.font,v:1}),this.dragAction="place",this.currentShapeState="selected"),"none"===this.dragAction?void this.commit(n):(this.initialShapeBoundingRect=this.currentShape.getBoundingRect(n.ctx),this.dragOffset={x:t-this.initialShapeBoundingRect.x,y:e-this.initialShapeBoundingRect.y},this._setShapesInProgress(n),n.repaintLayer("main"))},e.prototype.continue=function(t,e,n){var i,r,o;if("none"!==this.dragAction){switch(o=(i=this.initialShapeBoundingRect).x+i.width,r=i.y+i.height,this.dragAction){case"place":this.currentShape.x=t,this.currentShape.y=e,this.didDrag=!0;break;case"move":this.currentShape.x=t-this.dragOffset.x,this.currentShape.y=e-this.dragOffset.y,this.didDrag=!0;break;case"resizeBottomRight":this.currentShape.setSize(t-(this.dragOffset.x-this.initialShapeBoundingRect.width)-i.x,e-(this.dragOffset.y-this.initialShapeBoundingRect.height)-i.y);break;case"resizeTopLeft":this.currentShape.setSize(o-t+this.dragOffset.x,r-e+this.dragOffset.y),this.currentShape.setPosition(t-this.dragOffset.x,e-this.dragOffset.y);break;case"resizeBottomLeft":this.currentShape.setSize(o-t+this.dragOffset.x,e-(this.dragOffset.y-this.initialShapeBoundingRect.height)-i.y),this.currentShape.setPosition(t-this.dragOffset.x,this.currentShape.y);break;case"resizeTopRight":this.currentShape.setSize(t-(this.dragOffset.x-this.initialShapeBoundingRect.width)-i.x,r-e+this.dragOffset.y),this.currentShape.setPosition(this.currentShape.x,e-this.dragOffset.y)}return this._setShapesInProgress(n),n.repaintLayer("main"),this._updateInputEl(n)}},e.prototype.end=function(t,e,n){return this.currentShape?(this.currentShape.setSize(this.currentShape.forcedWidth,0),"selected"===this.currentShapeState&&("place"===this.dragAction||"move"===this.dragAction&&!this.didDrag)&&this._enterEditingState(n),this._setShapesInProgress(n),n.repaintLayer("main"),this._updateInputEl(n)):void 0},e.prototype._enterEditingState=function(t){var e;if(this.currentShapeState="editing",this.inputEl)throw"State error";return this.inputEl=document.createElement("textarea"),this.inputEl.className="text-tool-input",this.inputEl.style.position="absolute",this.inputEl.style.transformOrigin="0px 0px",this.inputEl.style.backgroundColor="transparent",this.inputEl.style.border="none",this.inputEl.style.outline="none",this.inputEl.style.margin="0",this.inputEl.style.padding="4px",this.inputEl.style.zIndex="1000",this.inputEl.style.overflow="hidden",this.inputEl.style.resize="none",this.inputEl.value=this.currentShape.text,this.inputEl.addEventListener("mousedown",(function(t){return t.stopPropagation()})),this.inputEl.addEventListener("touchstart",(function(t){return t.stopPropagation()})),e=function(e){return function(n){return e.currentShape.setText(n.target.value),e.currentShape.enforceMaxBoundingRect(t),e._setShapesInProgress(t),t.repaintLayer("main"),e._updateInputEl(t),n.stopPropagation()}}(this),this.inputEl.addEventListener("keydown",function(e){return function(){return e._updateInputEl(t,!0)}}(this)),this.inputEl.addEventListener("keyup",e),this.inputEl.addEventListener("change",e),this._updateInputEl(t),t.containerEl.appendChild(this.inputEl),this.inputEl.focus(),this._setShapesInProgress(t)},e.prototype._exitEditingState=function(t){return this.currentShapeState="selected",t.containerEl.removeChild(this.inputEl),this.inputEl=null,this._setShapesInProgress(t),t.repaintLayer("main")},e.prototype._updateInputEl=function(t,e){var n,i;return null==e&&(e=!1),this.inputEl?(n=this.currentShape.getBoundingRect(t.ctx,!0),this.inputEl.style.font=this.currentShape.font,this.inputEl.style.color=this.currentShape.color,this.inputEl.style.left=t.position.x/t.backingScale+n.x*t.scale-4+"px",this.inputEl.style.top=t.position.y/t.backingScale+n.y*t.scale-4+"px",e&&!this.currentShape.forcedWidth?this.inputEl.style.width=n.width+10+this.currentShape.renderer.emDashWidth+"px":this.inputEl.style.width=n.width+12+"px",this.inputEl.style.height=e?n.height+10+this.currentShape.renderer.metrics.leading+"px":n.height+10+"px",i="scale("+t.scale+")",this.inputEl.style.transform=i,this.inputEl.style.webkitTransform=i,this.inputEl.style.MozTransform=i,this.inputEl.style.msTransform=i,this.inputEl.style.OTransform=i):void 0},e.prototype.optionsStyle="font",e}(r)},{"../core/shapes":17,"./base":53}],53:[function(t,e,n){var i,o,a={}.hasOwnProperty;(o={}).Tool=i=function(){function t(){}return t.prototype.name=null,t.prototype.iconName=null,t.prototype.usesSimpleAPI=!0,t.prototype.begin=function(t,e,n){},t.prototype.continue=function(t,e,n){},t.prototype.end=function(t,e,n){},t.prototype.optionsStyle=null,t.prototype.didBecomeActive=function(t){},t.prototype.willBecomeInactive=function(t){},t}(),o.ToolWithStroke=function(t){function e(t){this.strokeWidth=t.opts.defaultStrokeWidth}return function(t,e){function n(){this.constructor=t}for(var i in e)a.call(e,i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,t),e.prototype.optionsStyle="stroke-width",e.prototype.didBecomeActive=function(t){var e;return e=[],this.unsubscribe=function(){var t,n,i,r;for(r=[],n=0,i=e.length;i>n;n++)t=e[n],r.push(t());return r},e.push(t.on("setStrokeWidth",function(e){return function(n){return e.strokeWidth=n,t.trigger("toolDidUpdateOptions")}}(this)))},e.prototype.willBecomeInactive=function(t){return this.unsubscribe()},e}(i),e.exports=o},{}]},{},[22])(22)}));
define('filter_poodll/poodll_screenmediaskin', ["jquery","core/log","filter_poodll/utils_amd","filter_poodll/anim_progress_bar","filter_poodll/speech_poodll","filter_poodll/dlg_devicesettings","filter_poodll/upskin_bar"],(function($,log,utils,anim_progress_bar,browserrecognition,settings,upskin_bar){return log.debug("PoodLL ScreenRecorder Skin: initialising"),{instanceprops:null,pmr:null,stage:"none",uploaded:!1,devsettings:null,clone:function(){return $.extend(!0,{},this)},init:function(ip,pmr){this.instanceprops=ip,this.pmr=pmr,this.devsettings=settings.clone(),this.devsettings.init(pmr,ip),this.devsettings.set_media_type("audio")},fetch_instanceprops:function(){return this.instanceprops},onUploadSuccess:function(controlbarid){$("#"+controlbarid+" > .poodll_save-recording").hide(),$("#"+controlbarid+" > .poodll_savedsuccessfully").show()},onUploadFailure:function(controlbarid){},fetch_status_bar:function(skin){return'<div class="poodll_status_'+skin+'" height="50">00:00:00</div>'},fetch_preview_audio:function(skin){return'<audio class="audio_preview_screen poodll_preview_'+skin+'" style="display: none;" width="100%" height="100%" controls playsinline="playsinline" muted></audio>'},fetch_preview_video:function(skin){return'<video class="video_preview_screen poodll_preview_'+skin+'" width="100%" height="300px" playsinline="playsinline" muted></video>'},fetch_resource_audio:function(skin){return'<audio class="poodll_resourceplayer_'+skin+'" style="display: none;" playsinline="playsinline"></audio>'},fetch_resource_video:function(skin){return'<video class="poodll_resourceplayer_'+skin+'" style="display: none;" playsinline="playsinline"></video>'},fetch_uploader_skin:function(controlbarid,element){var ip=this.fetch_instanceprops(controlbarid),upskin=upskin_bar.clone();return upskin.init(ip.config,element,ip.controlbar.progresscanvas,ip.controlbar.timer),upskin},onMediaError:function(e){console.error("media error",e)},onMediaSuccess_video:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.uploader.Output(""),this.set_visual_mode("recordmode",controlbarid),ip.timer.reset(),ip.timer.start(),this.update_status(controlbarid),this.stage="recorded"},handle_timer_update:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.status.html(ip.timer.fetch_display_time()),0==ip.timer.seconds&&ip.timer.initseconds>0&&ip.controlbar.stoprecbutton.click()},update_status:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.status.html(ip.timer.fetch_display_time())},set_visual_mode:function(mode,controlbarid){var ip=this.fetch_instanceprops(controlbarid);switch(mode){case"recordmode":ip.controlbar.progress.hide(),ip.controlbar.preview.addClass("poodll_recording"),ip.controlbar.status.addClass("poodll_recording"),ip.controlbar.status.removeClass("hide"),this.disable_button(this),this.disable_button(ip.controlbar.playbutton),ip.controlbar.playbutton.show(),this.disable_button(ip.controlbar.stopbutton),ip.controlbar.stopbutton.hide(),this.disable_button(ip.controlbar.savebutton),ip.controlbar.savebutton.show(),this.enable_button(ip.controlbar.stoprecbutton),ip.controlbar.stoprecbutton.show(),ip.controlbar.startbutton.hide();break;case"previewmode":ip.controlbar.playbutton.hide(),this.enable_button(ip.controlbar.stopbutton),ip.controlbar.stopbutton.show(),this.disable_button(ip.controlbar.startbutton),ip.controlbar.startbutton.show(),this.disable_button(ip.controlbar.resumebutton),ip.controlbar.resumebutton.hide(),this.disable_button(ip.controlbar.playbutton),ip.controlbar.preview.removeClass("poodll_recording"),ip.controlbar.status.removeClass("poodll_recording"),ip.controlbar.status.removeClass("hide"),ip.controlbar.status.addClass("hide"),ip.controlbar.progresscanvas.hasClass("hide")&&(ip.controlbar.progresscanvas.removeClass("hide"),ip.controlbar.progresscanvas.show()),$(this).hasClass("played")||($(this).addClass("played"),ip.controlbar.steptwo.empty(),ip.controlbar.steptwo.append('<i class="fa fa-check" aria-hidden="true"></i>').hide().fadeIn(1e3));break;case"pausedmode":this.enable_button(ip.controlbar.startbutton),ip.controlbar.startbutton.show(),this.enable_button(ip.controlbar.playbutton),ip.controlbar.playbutton.show(),this.disable_button(ip.controlbar.savebutton),ip.controlbar.savebutton.show(),ip.controlbar.preview.removeClass("poodll_recording"),ip.controlbar.status.removeClass("poodll_recording"),ip.controlbar.stoprecbutton.hide(),ip.controlbar.timer.html("00:00:00"),ip.controlbar.status.addClass("hide"),ip.controlbar.progress.show(),ip.controlbar.stepone.empty(),ip.controlbar.stepone.append('<i class="fa fa-check" aria-hidden="true"></i>').hide().fadeIn(1e3),this.disable_button(ip.controlbar.stoprecbutton);break;case"stopplayingmode":this.uploaded||(this.enable_button(ip.controlbar.savebutton),this.enable_button(ip.controlbar.startbutton)),ip.controlbar.progresscanvas.hasClass("hide")||(ip.controlbar.timer.html("00:00:00"),ip.controlbar.progresscanvas.addClass("hide"),ip.controlbar.progresscanvas.hide()),ip.controlbar.stopbutton.hide(),ip.controlbar.playbutton.show(),ip.controlbar.startbutton.show(),this.enable_button(ip.controlbar.playbutton),this.disable_button(ip.controlbar.stopbutton);break;case"uploadmode":this.disable_button(ip.controlbar.startbutton),ip.controlbar.progresscanvas.removeClass("hide"),ip.controlbar.progresscanvas.show();break;case"savemode":this.disable_button(ip.controlbar.savebutton),ip.controlbar.stepthree.empty(),ip.controlbar.stepthree.append('<i class="fa fa-check" aria-hidden="true"></i>').hide().fadeIn(1e3)}},insert_controlbar_video:function(element,controlbarid,preview,resource){return this.prepare_controlbar(element,controlbarid,preview,resource,"video")},prepare_controlbar:function(element,controlbarid,preview,resource,mediatype){var ip=this.fetch_instanceprops(controlbarid),skin_style=ip.config.media_skin_style,size_class="poodll_mediarecorder_size_auto";switch(ip.config.size){case"small":size_class="poodll_mediarecorder_size_small";break;case"big":size_class="poodll_mediarecorder_size_big";break;case"auto":size_class="poodll_mediarecorder_size_auto"}var ss=this.pmr.fetch_strings(),controls='<div class="screen-main-wrapper poodll_mediarecorderholder_screen poodll_mediarecorder_video '+size_class+'" id="holder_'+controlbarid+'">';controls+='<div class="modal-box poodll_mediarecorderbox_screen screen-wrap" id="'+controlbarid+'">',controls+='<div class="style-holder '+skin_style+'">',controls+=this.fetch_status_bar("screen"),controls+='<div class="hp_slide" id="slide_'+controlbarid+'">',controls+='<div class="hp_timer"></div><canvas class="hp_range"></canvas></div>',controls+=preview,controls+='<div class="settingsicon" id="settingsicon_'+controlbarid+'"><button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal"><i class="fa fa-cogs" aria-hidden="true"></i></button></div>',controls+='<button type="button" class="poodll_mediarecorder_button_screen poodll_start-recording_screen"><i class="fa fa-desktop" aria-hidden="true"></i></button> ',controls+='<button type="button" class="poodll_mediarecorder_button_screen poodll_stop-recording_screen pmr_disabled" style="display: none;" disabled><i class="fa fa-stop" aria-hidden="true"></i></button>',controls+='<button type="button" class="poodll_mediarecorder_button_screen poodll_pause-recording_screen pmr_disabled" style="display: none;" disabled><i class="fa fa-pause" aria-hidden="true"></i></button>',controls+=' <button type="button" class="poodll_mediarecorder_button_screen poodll_resume-recording_screen pmr_disabled" style="display: none;" disabled><i class="fa fa-microphone" aria-hidden="true"></i></button>',controls+='<button type="button" class="poodll_mediarecorder_button_screen poodll_play-recording_screen pmr_disabled" disabled><i class="fa fa-play" aria-hidden="true"></i></button> ',controls+='<button type="button" class="poodll_mediarecorder_button_screen poodll_stop-playing_screen pmr_disabled" style="display: none;" disabled><i class="fa fa-stop" aria-hidden="true"></i></button>',controls+='<button type="button" class="poodll_mediarecorder_button_screen poodll_save-recording_screen pmr_disabled" disabled><i class="fa fa-upload" aria-hidden="true"></i></button>',controls+='<div style="clear:both;">',controls+='<div class="task-helper">',controls+='<p class="step-1">'+ss.recui_record+"</p>",controls+='<p class="step-2">'+ss.recui_play+"</p>",controls+='<p class="step-3">'+ss.recui_save+"</p>",controls+="</div>",controls+="</div>",controls+="</div>",controls+=this.devsettings.fetch_dialogue_box(),controls+=ip.downloaddialog.fetch_dialogue_box(),controls+=ip.errordialog.fetch_dialogue_box(),controls+="</div>",$(element).prepend(controls);var controlbar={settingsdialog:$("#"+controlbarid+" .poodll_dialogue_box_settings"),downloaddialog:$("#"+controlbarid+" .poodll_dialogue_box_download"),errorsdialog:$("#"+controlbarid+" .poodll_dialogue_box_errors"),settingsicon:$("#"+controlbarid+" .settingsicon"),stepone:$("#"+controlbarid+" .step-1"),steptwo:$("#"+controlbarid+" .step-2"),stepthree:$("#"+controlbarid+" .step-3"),progresscanvas:$("#"+controlbarid+" .hp_range"),progress:$("#"+controlbarid+" .hp_slide"),timer:$("#"+controlbarid+" .hp_timer"),status:$("#"+controlbarid+" .poodll_status_screen"),preview:$("#"+controlbarid+" .poodll_preview_screen"),startbutton:$("#"+controlbarid+" .poodll_start-recording_screen"),stoprecbutton:$("#"+controlbarid+" .poodll_stop-recording_screen"),stopbutton:$("#"+controlbarid+" .poodll_stop-playing_screen"),pausebutton:$("#"+controlbarid+" .poodll_pause-recording_screen"),resumebutton:$("#"+controlbarid+" .poodll_resume-recording_screen"),playbutton:$("#"+controlbarid+" .poodll_play-recording_screen"),savebutton:$("#"+controlbarid+" .poodll_save-recording_screen")};return ip.downloaddialog.set_dialogue_box(controlbar.downloaddialog),ip.errordialog.set_dialogue_box(controlbar.errorsdialog),this.devsettings.set_dialogue_box(controlbar.settingsdialog),controlbar},register_controlbar_events_video:function(onMediaSuccess,controlbarid){var self=this,pmr=this.pmr,ip=(this.stage,this.fetch_instanceprops(controlbarid)),hprogress=anim_progress_bar.clone();hprogress.init(ip.controlbar.progresscanvas),ip.controlbar.settingsicon.click((function(){self.uploaded?ip.downloaddialog.open():self.devsettings.open()})),ip.controlbar.startbutton.click((function(){pmr.do_start_screen(ip,onMediaSuccess)})),ip.controlbar.stoprecbutton.click((function(){pmr.do_stop_audio(ip),self.set_visual_mode("pausedmode",controlbarid),ip.timer.stop(),ip.timer.reset(),self.update_status(controlbarid)})),ip.controlbar.stopbutton.click((function(){self.set_visual_mode("stopplayingmode",controlbarid);var preview=ip.controlbar.preview.get(0);pmr.do_stopplay_audio(ip,preview),hprogress.stop()})),ip.controlbar.playbutton.click((function(){var preview=ip.controlbar.preview.get(0);pmr.do_play_audio(ip,preview),ip.controlbar.preview.on("timeupdate",(function(){var currentTime=this.currentTime;ip.controlbar.timer.html(ip.timer.fetch_display_time(currentTime))})),self.set_visual_mode("previewmode",controlbarid),"played",hprogress.clear(),hprogress.fetchCurrent=function(){var ct=ip.controlbar.preview.prop("currentTime"),duration=ip.controlbar.preview.prop("duration");return isFinite(duration)||(duration=ip.timer.finalseconds),ct/duration},hprogress.start()})),ip.controlbar.savebutton.click((function(){return self.set_visual_mode("savemode",controlbarid),log.debug("save"),ip.blobs&&ip.blobs.length>0?(pmr.do_save_audio(ip),self.uploaded=!0,self.set_visual_mode("uploadmode",controlbarid),"saved"):ip.uploader.Output(M.util.get_string("recui_nothingtosaveerror","filter_poodll")),!1})),window.onbeforeunload=function(){self.enable_button(ip.controlbar.startbutton);var preview=ip.controlbar.preview;preview&&preview.get(0)&&preview.get(0).pause()}},enable_button:function(button){$(button).attr("disabled",!1),$(button).removeClass("pmr_disabled")},disable_button:function(button){$(button).attr("disabled",!0),$(button).addClass("pmr_disabled")}}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}!function(e){if("object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("filter_poodll/react-with-addons",[],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).React=e()}}((function(){return function e(t,n,r){function o(i,u){if(!n[i]){if(!t[i]){var s="function"==typeof require&&require;if(!u&&s)return s(i,!0);if(a)return a(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[i]={exports:{}};t[i][0].call(c.exports,(function(e){var n=t[i][1][e];return o(n||e)}),c,c.exports,e,t,n,r)}return n[i].exports}for(var a="function"==typeof require&&require,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(e,t,n){var r=e(22),o=e(26),a=e(37),i=e(29),u=e(62),s=e(91),l=e(93),c=e(115),p=e(137),d=e(140);e(168),o.addons={CSSTransitionGroup:i,LinkedStateMixin:r,PureRenderMixin:a,TransitionGroup:s,batchedUpdates:function(){return l.batchedUpdates.apply(this,arguments)},cloneWithProps:c,createFragment:u.create,shallowCompare:p,update:d},t.exports=o},{115:115,137:137,140:140,168:168,22:22,26:26,29:29,37:37,62:62,91:91,93:93}],2:[function(e,t,n){var r=e(70),o=e(119),a=e(152),u={Mixin:{componentDidMount:function(){this.props.autoFocus&&a(o(this))}},focusDOMComponent:function(){a(r.getNode(this._rootNodeID))}};t.exports=u},{119:119,152:152,70:70}],3:[function(e,t,n){function u(e,t){switch(e){case N.topKeyUp:return-1!==b.indexOf(t.keyCode);case N.topKeyDown:return t.keyCode!==E;case N.topKeyPress:case N.topMouseDown:case N.topBlur:return!0;default:return!1}}function s(e){var t=e.detail;return"object"==_typeof(t)&&"data"in t?t.data:null}function l(e,t,n,r,o){var l,c;if(_?l=function(e){switch(e){case N.topCompositionStart:return w.compositionStart;case N.topCompositionEnd:return w.compositionEnd;case N.topCompositionUpdate:return w.compositionUpdate}}(e):R?u(e,r)&&(l=w.compositionEnd):function(e,t){return e===N.topKeyDown&&t.keyCode===E}(e,r)&&(l=w.compositionStart),!l)return null;P&&(R||l!==w.compositionStart?l===w.compositionEnd&&R&&(c=R.getData()):R=m.getPooled(t));var p=g.getPooled(l,n,r,o);if(c)p.data=c;else{var d=s(r);null!==d&&(p.data=d)}return h.accumulateTwoPhaseDispatches(p),p}function p(e,t){if(R){if(e===N.topCompositionEnd||u(e,t)){var n=R.getData();return m.release(R),R=null,n}return null}switch(e){case N.topPaste:return null;case N.topKeyPress:return t.which&&!function(e){return(e.ctrlKey||e.altKey||e.metaKey)&&!(e.ctrlKey&&e.altKey)}(t)?String.fromCharCode(t.which):null;case N.topCompositionEnd:return P?null:t.data;default:return null}}function d(e,t,n,r,o){var a;if(a=D?function(e,t){switch(e){case N.topCompositionEnd:return s(t);case N.topKeyPress:return t.which!==T?null:(S=!0,M);case N.topTextInput:var r=t.data;return r===M&&S?null:r;default:return null}}(e,r):p(e,r),!a)return null;var i=y.getPooled(w.beforeInput,n,r,o);return i.data=a,h.accumulateTwoPhaseDispatches(i),i}var f=e(15),h=e(19),v=e(144),m=e(20),g=e(100),y=e(104),C=e(163),b=[9,13,27,32],E=229,_=v.canUseDOM&&"CompositionEvent"in window,x=null;v.canUseDOM&&"documentMode"in document&&(x=document.documentMode);var D=v.canUseDOM&&"TextEvent"in window&&!x&&!function(){var e=window.opera;return"object"==_typeof(e)&&"function"==typeof e.version&&parseInt(e.version(),10)<=12}(),P=v.canUseDOM&&(!_||x&&x>8&&11>=x),T=32,M=String.fromCharCode(T),N=f.topLevelTypes,w={beforeInput:{phasedRegistrationNames:{bubbled:C({onBeforeInput:null}),captured:C({onBeforeInputCapture:null})},dependencies:[N.topCompositionEnd,N.topKeyPress,N.topTextInput,N.topPaste]},compositionEnd:{phasedRegistrationNames:{bubbled:C({onCompositionEnd:null}),captured:C({onCompositionEndCapture:null})},dependencies:[N.topBlur,N.topCompositionEnd,N.topKeyDown,N.topKeyPress,N.topKeyUp,N.topMouseDown]},compositionStart:{phasedRegistrationNames:{bubbled:C({onCompositionStart:null}),captured:C({onCompositionStartCapture:null})},dependencies:[N.topBlur,N.topCompositionStart,N.topKeyDown,N.topKeyPress,N.topKeyUp,N.topMouseDown]},compositionUpdate:{phasedRegistrationNames:{bubbled:C({onCompositionUpdate:null}),captured:C({onCompositionUpdateCapture:null})},dependencies:[N.topBlur,N.topCompositionUpdate,N.topKeyDown,N.topKeyPress,N.topKeyUp,N.topMouseDown]}},S=!1,R=null,I={eventTypes:w,extractEvents:function(e,t,n,r,o){return[l(e,t,n,r,o),d(e,0,n,r,o)]}};t.exports=I},{100:100,104:104,144:144,15:15,163:163,19:19,20:20}],4:[function(e,t,n){var o={animationIterationCount:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,stopOpacity:!0,strokeDashoffset:!0,strokeOpacity:!0,strokeWidth:!0},a=["Webkit","ms","Moz","O"];Object.keys(o).forEach((function(e){a.forEach((function(t){o[function(e,t){return e+t.charAt(0).toUpperCase()+t.substring(1)}(t,e)]=o[e]}))}));var u={isUnitlessNumber:o,shorthandPropertyExpansions:{background:{backgroundAttachment:!0,backgroundColor:!0,backgroundImage:!0,backgroundPositionX:!0,backgroundPositionY:!0,backgroundRepeat:!0},backgroundPosition:{backgroundPositionX:!0,backgroundPositionY:!0},border:{borderWidth:!0,borderStyle:!0,borderColor:!0},borderBottom:{borderBottomWidth:!0,borderBottomStyle:!0,borderBottomColor:!0},borderLeft:{borderLeftWidth:!0,borderLeftStyle:!0,borderLeftColor:!0},borderRight:{borderRightWidth:!0,borderRightStyle:!0,borderRightColor:!0},borderTop:{borderTopWidth:!0,borderTopStyle:!0,borderTopColor:!0},font:{fontStyle:!0,fontVariant:!0,fontWeight:!0,fontSize:!0,lineHeight:!0,fontFamily:!0},outline:{outlineWidth:!0,outlineStyle:!0,outlineColor:!0}}};t.exports=u},{}],5:[function(e,t,n){var r=e(4),o=e(144),a=e(76),i=(e(146),e(116)),u=e(157),s=e(165),l=(e(168),s((function(e){return u(e)}))),c=!1,p="cssFloat";if(o.canUseDOM){var d=document.createElement("div").style;try{d.font=""}catch(f){c=!0}void 0===document.documentElement.style.cssFloat&&(p="styleFloat")}var h={createMarkupForStyles:function(e){var t="";for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];null!=r&&(t+=l(n)+":",t+=i(n,r)+";")}return t||null},setValueForStyles:function(e,t){var n=e.style;for(var o in t)if(t.hasOwnProperty(o)){var a=i(o,t[o]);if("float"===o&&(o=p),a)n[o]=a;else{var u=c&&r.shorthandPropertyExpansions[o];if(u)for(var s in u)n[s]="";else n[o]=""}}}};a.measureMethods(h,"CSSPropertyOperations",{setValueForStyles:"setValueForStyles"}),t.exports=h},{116:116,144:144,146:146,157:157,165:165,168:168,4:4,76:76}],6:[function(e,t,n){function r(){this._callbacks=null,this._contexts=null}var o=e(25),a=e(24),i=e(158);a(r.prototype,{enqueue:function(e,t){this._callbacks=this._callbacks||[],this._contexts=this._contexts||[],this._callbacks.push(e),this._contexts.push(t)},notifyAll:function(){var e=this._callbacks,t=this._contexts;if(e){e.length!==t.length&&i(!1),this._callbacks=null,this._contexts=null;for(var n=0;n<e.length;n++)e[n].call(t[n]);e.length=0,t.length=0}},reset:function(){this._callbacks=null,this._contexts=null},destructor:function(){this.reset()}}),o.addPoolingTo(r),t.exports=r},{158:158,24:24,25:25}],7:[function(e,t,n){function o(e){var t=x.getPooled(w.change,R,e,D(e));b.accumulateTwoPhaseDispatches(t),_.batchedUpdates(a,t)}function a(e){C.enqueueEvents(e),C.processEventQueue(!1)}function u(){S&&(S.detachEvent("onchange",o),S=null,R=null)}function s(e,t,n){return e===N.topChange?n:void 0}function l(e,t,n){e===N.topFocus?(u(),function(e,t){R=t,(S=e).attachEvent("onchange",o)}(t,n)):e===N.topBlur&&u()}function p(){S&&(delete S.value,S.detachEvent("onpropertychange",d),S=null,R=null,I=null,k=null)}function d(e){if("value"===e.propertyName){var t=e.srcElement.value;t!==I&&(I=t,o(e))}}function f(e,t,n){return e===N.topInput?n:void 0}function h(e,t,n){e===N.topFocus?(p(),function(e,t){S=e,R=t,I=e.value,k=Object.getOwnPropertyDescriptor(e.constructor.prototype,"value"),Object.defineProperty(S,"value",L),S.attachEvent("onpropertychange",d)}(t,n)):e===N.topBlur&&p()}function v(e,t,n){return e!==N.topSelectionChange&&e!==N.topKeyUp&&e!==N.topKeyDown||!S||S.value===I?void 0:(I=S.value,R)}function g(e,t,n){return e===N.topClick?n:void 0}var y=e(15),C=e(16),b=e(19),E=e(144),_=e(93),x=e(102),D=e(125),P=e(130),T=e(131),M=e(163),N=y.topLevelTypes,w={change:{phasedRegistrationNames:{bubbled:M({onChange:null}),captured:M({onChangeCapture:null})},dependencies:[N.topBlur,N.topChange,N.topClick,N.topFocus,N.topInput,N.topKeyDown,N.topKeyUp,N.topSelectionChange]}},S=null,R=null,I=null,k=null,O=!1;E.canUseDOM&&(O=P("change")&&(!("documentMode"in document)||document.documentMode>8));var A=!1;E.canUseDOM&&(A=P("input")&&(!("documentMode"in document)||document.documentMode>9));var L={get:function(){return k.get.call(this)},set:function(e){I=""+e,k.set.call(this,e)}},U={eventTypes:w,extractEvents:function(e,t,n,o,a){var i,u;if(function(e){var t=e.nodeName&&e.nodeName.toLowerCase();return"select"===t||"input"===t&&"file"===e.type}(t)?O?i=s:u=l:T(t)?A?i=f:(i=v,u=h):function(e){return e.nodeName&&"input"===e.nodeName.toLowerCase()&&("checkbox"===e.type||"radio"===e.type)}(t)&&(i=g),i){var c=i(e,t,n);if(c){var p=x.getPooled(w.change,c,o,a);return p.type="change",b.accumulateTwoPhaseDispatches(p),p}}u&&u(e,t,n)}};t.exports=U},{102:102,125:125,130:130,131:131,144:144,15:15,16:16,163:163,19:19,93:93}],8:[function(e,t,n){var r=0,o={createReactRootIndex:function(){return r++}};t.exports=o},{}],9:[function(e,t,n){function r(e,t,n){var r=n>=e.childNodes.length?null:e.childNodes.item(n);e.insertBefore(t,r)}var o=e(12),a=e(72),i=e(76),u=e(135),s=e(136),l=e(158),c={dangerouslyReplaceNodeWithMarkup:o.dangerouslyReplaceNodeWithMarkup,updateTextContent:s,processUpdates:function(e,t){for(var n,i=null,c=null,p=0;p<e.length;p++)if((n=e[p]).type===a.MOVE_EXISTING||n.type===a.REMOVE_NODE){var d=n.fromIndex,f=n.parentNode.childNodes[d],h=n.parentID;f||l(!1),(i=i||{})[h]=i[h]||[],i[h][d]=f,(c=c||[]).push(f)}var v;if(v=t.length&&"string"==typeof t[0]?o.dangerouslyRenderMarkup(t):t,c)for(var m=0;m<c.length;m++)c[m].parentNode.removeChild(c[m]);for(var g=0;g<e.length;g++)switch((n=e[g]).type){case a.INSERT_MARKUP:r(n.parentNode,v[n.markupIndex],n.toIndex);break;case a.MOVE_EXISTING:r(n.parentNode,i[n.parentID][n.fromIndex],n.toIndex);break;case a.SET_MARKUP:u(n.parentNode,n.content);break;case a.TEXT_CONTENT:s(n.parentNode,n.content);case a.REMOVE_NODE:}}};i.measureMethods(c,"DOMChildrenOperations",{updateTextContent:"updateTextContent"}),t.exports=c},{12:12,135:135,136:136,158:158,72:72,76:76}],10:[function(e,t,n){function r(e,t){return(e&t)===t}var o=e(158),a={MUST_USE_ATTRIBUTE:1,MUST_USE_PROPERTY:2,HAS_SIDE_EFFECTS:4,HAS_BOOLEAN_VALUE:8,HAS_NUMERIC_VALUE:16,HAS_POSITIVE_NUMERIC_VALUE:48,HAS_OVERLOADED_BOOLEAN_VALUE:64,injectDOMPropertyConfig:function(e){var t=a,n=e.Properties||{},i=e.DOMAttributeNamespaces||{},s=e.DOMAttributeNames||{},l=e.DOMPropertyNames||{},c=e.DOMMutationMethods||{};for(var p in e.isCustomAttribute&&u._isCustomAttributeFunctions.push(e.isCustomAttribute),n){u.properties.hasOwnProperty(p)&&o(!1);var d=p.toLowerCase(),f=n[p],h={attributeName:d,attributeNamespace:null,propertyName:p,mutationMethod:null,mustUseAttribute:r(f,t.MUST_USE_ATTRIBUTE),mustUseProperty:r(f,t.MUST_USE_PROPERTY),hasSideEffects:r(f,t.HAS_SIDE_EFFECTS),hasBooleanValue:r(f,t.HAS_BOOLEAN_VALUE),hasNumericValue:r(f,t.HAS_NUMERIC_VALUE),hasPositiveNumericValue:r(f,t.HAS_POSITIVE_NUMERIC_VALUE),hasOverloadedBooleanValue:r(f,t.HAS_OVERLOADED_BOOLEAN_VALUE)};if(h.mustUseAttribute&&h.mustUseProperty&&o(!1),!h.mustUseProperty&&h.hasSideEffects&&o(!1),h.hasBooleanValue+h.hasNumericValue+h.hasOverloadedBooleanValue<=1||o(!1),s.hasOwnProperty(p)){var v=s[p];h.attributeName=v}i.hasOwnProperty(p)&&(h.attributeNamespace=i[p]),l.hasOwnProperty(p)&&(h.propertyName=l[p]),c.hasOwnProperty(p)&&(h.mutationMethod=c[p]),u.properties[p]=h}}},i={},u={ID_ATTRIBUTE_NAME:"data-reactid",properties:{},getPossibleStandardName:null,_isCustomAttributeFunctions:[],isCustomAttribute:function(e){for(var t=0;t<u._isCustomAttributeFunctions.length;t++){if((0,u._isCustomAttributeFunctions[t])(e))return!0}return!1},getDefaultValueForProperty:function(e,t){var n,r=i[e];return r||(i[e]=r={}),t in r||(n=document.createElement(e),r[t]=n[t]),r[t]},injection:a};t.exports=u},{158:158}],11:[function(e,t,n){function r(e){return!!c.hasOwnProperty(e)||!l.hasOwnProperty(e)&&(s.test(e)?(c[e]=!0,!0):(l[e]=!0,!1))}function o(e,t){return null==t||e.hasBooleanValue&&!t||e.hasNumericValue&&isNaN(t)||e.hasPositiveNumericValue&&1>t||e.hasOverloadedBooleanValue&&!1===t}var a=e(10),i=e(76),u=e(133),s=(e(168),/^[a-zA-Z_][\w\.\-]*$/),l={},c={},p={createMarkupForID:function(e){return a.ID_ATTRIBUTE_NAME+"="+u(e)},setAttributeForID:function(e,t){e.setAttribute(a.ID_ATTRIBUTE_NAME,t)},createMarkupForProperty:function(e,t){var n=a.properties.hasOwnProperty(e)?a.properties[e]:null;if(n){if(o(n,t))return"";var r=n.attributeName;return n.hasBooleanValue||n.hasOverloadedBooleanValue&&!0===t?r+'=""':r+"="+u(t)}return a.isCustomAttribute(e)?null==t?"":e+"="+u(t):null},createMarkupForCustomAttribute:function(e,t){return r(e)&&null!=t?e+"="+u(t):""},setValueForProperty:function(e,t,n){var r=a.properties.hasOwnProperty(t)?a.properties[t]:null;if(r){var i=r.mutationMethod;if(i)i(e,n);else if(o(r,n))this.deleteValueForProperty(e,t);else if(r.mustUseAttribute){var u=r.attributeName,s=r.attributeNamespace;s?e.setAttributeNS(s,u,""+n):r.hasBooleanValue||r.hasOverloadedBooleanValue&&!0===n?e.setAttribute(u,""):e.setAttribute(u,""+n)}else{var l=r.propertyName;r.hasSideEffects&&""+e[l]==""+n||(e[l]=n)}}else a.isCustomAttribute(t)&&p.setValueForAttribute(e,t,n)},setValueForAttribute:function(e,t,n){r(t)&&(null==n?e.removeAttribute(t):e.setAttribute(t,""+n))},deleteValueForProperty:function(e,t){var n=a.properties.hasOwnProperty(t)?a.properties[t]:null;if(n){var r=n.mutationMethod;if(r)r(e,void 0);else if(n.mustUseAttribute)e.removeAttribute(n.attributeName);else{var o=n.propertyName,i=a.getDefaultValueForProperty(e.nodeName,o);n.hasSideEffects&&""+e[o]===i||(e[o]=i)}}else a.isCustomAttribute(t)&&e.removeAttribute(t)}};i.measureMethods(p,"DOMPropertyOperations",{setValueForProperty:"setValueForProperty",setValueForAttribute:"setValueForAttribute",deleteValueForProperty:"deleteValueForProperty"}),t.exports=p},{10:10,133:133,168:168,76:76}],12:[function(e,t,n){function r(e){return e.substring(1,e.indexOf(" "))}var o=e(144),a=e(149),i=e(150),u=e(154),s=e(158),l=/^(<[^ \/>]+)/,c="data-danger-index",p={dangerouslyRenderMarkup:function(e){o.canUseDOM||s(!1);for(var t,n={},p=0;p<e.length;p++)e[p]||s(!1),t=r(e[p]),n[t=u(t)?t:"*"]=n[t]||[],n[t][p]=e[p];var d=[],f=0;for(t in n)if(n.hasOwnProperty(t)){var h,v=n[t];for(h in v)if(v.hasOwnProperty(h)){var m=v[h];v[h]=m.replace(l,"$1 "+c+'="'+h+'" ')}for(var g=a(v.join(""),i),y=0;y<g.length;++y){var C=g[y];C.hasAttribute&&C.hasAttribute(c)&&(h=+C.getAttribute(c),C.removeAttribute(c),d.hasOwnProperty(h)&&s(!1),d[h]=C,f+=1)}}return f!==d.length&&s(!1),d.length!==e.length&&s(!1),d},dangerouslyReplaceNodeWithMarkup:function(e,t){var n;o.canUseDOM||s(!1),t||s(!1),"html"===e.tagName.toLowerCase()&&s(!1),n="string"==typeof t?a(t,i)[0]:t,e.parentNode.replaceChild(n,e)}};t.exports=p},{144:144,149:149,150:150,154:154,158:158}],13:[function(e,t,n){var r=e(163),o=[r({ResponderEventPlugin:null}),r({SimpleEventPlugin:null}),r({TapEventPlugin:null}),r({EnterLeaveEventPlugin:null}),r({ChangeEventPlugin:null}),r({SelectEventPlugin:null}),r({BeforeInputEventPlugin:null})];t.exports=o},{163:163}],14:[function(e,t,n){var r=e(15),o=e(19),a=e(106),i=e(70),u=e(163),s=r.topLevelTypes,l=i.getFirstReactDOM,c={mouseEnter:{registrationName:u({onMouseEnter:null}),dependencies:[s.topMouseOut,s.topMouseOver]},mouseLeave:{registrationName:u({onMouseLeave:null}),dependencies:[s.topMouseOut,s.topMouseOver]}},p=[null,null],d={eventTypes:c,extractEvents:function(e,t,n,r,u){if(e===s.topMouseOver&&(r.relatedTarget||r.fromElement))return null;if(e!==s.topMouseOut&&e!==s.topMouseOver)return null;var d;if(t.window===t)d=t;else{var f=t.ownerDocument;d=f?f.defaultView||f.parentWindow:window}var h,v,m="",g="";if(e===s.topMouseOut?(h=t,m=n,(v=l(r.relatedTarget||r.toElement))?g=i.getID(v):v=d,v=v||d):(h=d,v=t,g=n),h===v)return null;var y=a.getPooled(c.mouseLeave,m,r,u);y.type="mouseleave",y.target=h,y.relatedTarget=v;var C=a.getPooled(c.mouseEnter,g,r,u);return C.type="mouseenter",C.target=v,C.relatedTarget=h,o.accumulateEnterLeaveDispatches(y,C,m,g),p[0]=y,p[1]=C,p}};t.exports=d},{106:106,15:15,163:163,19:19,70:70}],15:[function(e,t,n){var r=e(162),o=r({bubbled:null,captured:null}),i={topLevelTypes:r({topAbort:null,topBlur:null,topCanPlay:null,topCanPlayThrough:null,topChange:null,topClick:null,topCompositionEnd:null,topCompositionStart:null,topCompositionUpdate:null,topContextMenu:null,topCopy:null,topCut:null,topDoubleClick:null,topDrag:null,topDragEnd:null,topDragEnter:null,topDragExit:null,topDragLeave:null,topDragOver:null,topDragStart:null,topDrop:null,topDurationChange:null,topEmptied:null,topEncrypted:null,topEnded:null,topError:null,topFocus:null,topInput:null,topKeyDown:null,topKeyPress:null,topKeyUp:null,topLoad:null,topLoadedData:null,topLoadedMetadata:null,topLoadStart:null,topMouseDown:null,topMouseMove:null,topMouseOut:null,topMouseOver:null,topMouseUp:null,topPaste:null,topPause:null,topPlay:null,topPlaying:null,topProgress:null,topRateChange:null,topReset:null,topScroll:null,topSeeked:null,topSeeking:null,topSelectionChange:null,topStalled:null,topSubmit:null,topSuspend:null,topTextInput:null,topTimeUpdate:null,topTouchCancel:null,topTouchEnd:null,topTouchMove:null,topTouchStart:null,topVolumeChange:null,topWaiting:null,topWheel:null}),PropagationPhases:o};t.exports=i},{162:162}],16:[function(e,t,n){var r=e(17),o=e(18),a=e(59),i=e(112),u=e(121),s=e(158),l=(e(168),{}),c=null,p=function(e,t){e&&(o.executeDispatchesInOrder(e,t),e.isPersistent()||e.constructor.release(e))},d=function(e){return p(e,!0)},f=function(e){return p(e,!1)},h=null,v={injection:{injectMount:o.injection.injectMount,injectInstanceHandle:function(e){h=e},getInstanceHandle:function(){return h},injectEventPluginOrder:r.injectEventPluginOrder,injectEventPluginsByName:r.injectEventPluginsByName},eventNameDispatchConfigs:r.eventNameDispatchConfigs,registrationNameModules:r.registrationNameModules,putListener:function(e,t,n){"function"!=typeof n&&s(!1),(l[t]||(l[t]={}))[e]=n;var a=r.registrationNameModules[t];a&&a.didPutListener&&a.didPutListener(e,t,n)},getListener:function(e,t){var n=l[t];return n&&n[e]},deleteListener:function(e,t){var n=r.registrationNameModules[t];n&&n.willDeleteListener&&n.willDeleteListener(e,t);var o=l[t];o&&delete o[e]},deleteAllListeners:function(e){for(var t in l)if(l[t][e]){var n=r.registrationNameModules[t];n&&n.willDeleteListener&&n.willDeleteListener(e,t),delete l[t][e]}},extractEvents:function(e,t,n,o,a){for(var u,s=r.plugins,l=0;l<s.length;l++){var c=s[l];if(c){var p=c.extractEvents(e,t,n,o,a);p&&(u=i(u,p))}}return u},enqueueEvents:function(e){e&&(c=i(c,e))},processEventQueue:function(e){var t=c;c=null,u(t,e?d:f),c&&s(!1),a.rethrowCaughtError()},__purge:function(){l={}},__getListenerBank:function(){return l}};t.exports=v},{112:112,121:121,158:158,168:168,17:17,18:18,59:59}],17:[function(e,t,n){function r(){if(u)for(var e in s){var t=s[e],n=u.indexOf(e);if(n>-1||i(!1),!l.plugins[n]){t.extractEvents||i(!1),l.plugins[n]=t;var r=t.eventTypes;for(var a in r)o(r[a],t,a)||i(!1)}}}function o(e,t,n){l.eventNameDispatchConfigs.hasOwnProperty(n)&&i(!1),l.eventNameDispatchConfigs[n]=e;var r=e.phasedRegistrationNames;if(r){for(var o in r){if(r.hasOwnProperty(o))a(r[o],t,n)}return!0}return!!e.registrationName&&(a(e.registrationName,t,n),!0)}function a(e,t,n){l.registrationNameModules[e]&&i(!1),l.registrationNameModules[e]=t,l.registrationNameDependencies[e]=t.eventTypes[n].dependencies}var i=e(158),u=null,s={},l={plugins:[],eventNameDispatchConfigs:{},registrationNameModules:{},registrationNameDependencies:{},injectEventPluginOrder:function(e){u&&i(!1),u=Array.prototype.slice.call(e),r()},injectEventPluginsByName:function(e){var t=!1;for(var n in e)if(e.hasOwnProperty(n)){var o=e[n];s.hasOwnProperty(n)&&s[n]===o||(s[n]&&i(!1),s[n]=o,t=!0)}t&&r()},getPluginModuleForEvent:function(e){var t=e.dispatchConfig;if(t.registrationName)return l.registrationNameModules[t.registrationName]||null;for(var n in t.phasedRegistrationNames)if(t.phasedRegistrationNames.hasOwnProperty(n)){var r=l.registrationNameModules[t.phasedRegistrationNames[n]];if(r)return r}return null},_resetEventPlugins:function(){for(var e in u=null,s)s.hasOwnProperty(e)&&delete s[e];l.plugins.length=0;var t=l.eventNameDispatchConfigs;for(var n in t)t.hasOwnProperty(n)&&delete t[n];var r=l.registrationNameModules;for(var o in r)r.hasOwnProperty(o)&&delete r[o]}};t.exports=l},{158:158}],18:[function(e,t,n){function i(e,t,n,r){var o=e.type||"unknown-event";e.currentTarget=v.Mount.getNode(r),t?f.invokeGuardedCallbackWithCatch(o,n,e,r):f.invokeGuardedCallback(o,n,e,r),e.currentTarget=null}var d=e(15),f=e(59),h=e(158),v=(e(168),{Mount:null,injectMount:function(e){v.Mount=e}}),m=d.topLevelTypes,g={isEndish:function(e){return e===m.topMouseUp||e===m.topTouchEnd||e===m.topTouchCancel},isMoveish:function(e){return e===m.topMouseMove||e===m.topTouchMove},isStartish:function(e){return e===m.topMouseDown||e===m.topTouchStart},executeDirectDispatch:function(e){var t=e._dispatchListeners,n=e._dispatchIDs;Array.isArray(t)&&h(!1);var r=t?t(e,n):null;return e._dispatchListeners=null,e._dispatchIDs=null,r},executeDispatchesInOrder:function(e,t){var n=e._dispatchListeners,r=e._dispatchIDs;if(Array.isArray(n))for(var o=0;o<n.length&&!e.isPropagationStopped();o++)i(e,t,n[o],r[o]);else n&&i(e,t,n,r);e._dispatchListeners=null,e._dispatchIDs=null},executeDispatchesInOrderStopAtTrue:function(e){var t=function(e){var t=e._dispatchListeners,n=e._dispatchIDs;if(Array.isArray(t)){for(var r=0;r<t.length&&!e.isPropagationStopped();r++)if(t[r](e,n[r]))return n[r]}else if(t&&t(e,n))return n;return null}(e);return e._dispatchIDs=null,e._dispatchListeners=null,t},hasDispatches:function(e){return!!e._dispatchListeners},getNode:function(e){return v.Mount.getNode(e)},getID:function(e){return v.Mount.getID(e)},injection:v};t.exports=g},{15:15,158:158,168:168,59:59}],19:[function(e,t,n){function o(e,t,n){var a=function(e,t,n){var r=t.dispatchConfig.phasedRegistrationNames[n];return y(e,r)}(e,n,t?g.bubbled:g.captured);a&&(n._dispatchListeners=v(n._dispatchListeners,a),n._dispatchIDs=v(n._dispatchIDs,e))}function a(e){e&&e.dispatchConfig.phasedRegistrationNames&&h.injection.getInstanceHandle().traverseTwoPhase(e.dispatchMarker,o,e)}function i(e){e&&e.dispatchConfig.phasedRegistrationNames&&h.injection.getInstanceHandle().traverseTwoPhaseSkipTarget(e.dispatchMarker,o,e)}function u(e,t,n){if(n&&n.dispatchConfig.registrationName){var r=n.dispatchConfig.registrationName,o=y(e,r);o&&(n._dispatchListeners=v(n._dispatchListeners,o),n._dispatchIDs=v(n._dispatchIDs,e))}}function s(e){e&&e.dispatchConfig.registrationName&&u(e.dispatchMarker,0,e)}var f=e(15),h=e(16),v=(e(168),e(112)),m=e(121),g=f.PropagationPhases,y=h.getListener,C={accumulateTwoPhaseDispatches:function(e){m(e,a)},accumulateTwoPhaseDispatchesSkipTarget:function(e){m(e,i)},accumulateDirectDispatches:function(e){m(e,s)},accumulateEnterLeaveDispatches:function(e,t,n,r){h.injection.getInstanceHandle().traverseEnterLeave(n,r,u,e,t)}};t.exports=C},{112:112,121:121,15:15,16:16,168:168}],20:[function(e,t,n){function r(e){this._root=e,this._startText=this.getText(),this._fallbackText=null}var o=e(25),a=e(24),i=e(128);a(r.prototype,{destructor:function(){this._root=null,this._startText=null,this._fallbackText=null},getText:function(){return"value"in this._root?this._root.value:this._root[i()]},getData:function(){if(this._fallbackText)return this._fallbackText;var e,t,n=this._startText,r=n.length,o=this.getText(),a=o.length;for(e=0;r>e&&n[e]===o[e];e++);var i=r-e;for(t=1;i>=t&&n[r-t]===o[a-t];t++);var u=t>1?1-t:void 0;return this._fallbackText=o.slice(e,u),this._fallbackText}}),o.addPoolingTo(r),t.exports=r},{128:128,24:24,25:25}],21:[function(e,t,n){var r,o=e(10),a=e(144),i=o.injection.MUST_USE_ATTRIBUTE,u=o.injection.MUST_USE_PROPERTY,s=o.injection.HAS_BOOLEAN_VALUE,l=o.injection.HAS_SIDE_EFFECTS,c=o.injection.HAS_NUMERIC_VALUE,p=o.injection.HAS_POSITIVE_NUMERIC_VALUE,d=o.injection.HAS_OVERLOADED_BOOLEAN_VALUE;if(a.canUseDOM){var f=document.implementation;r=f&&f.hasFeature&&f.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")}var h={isCustomAttribute:RegExp.prototype.test.bind(/^(data|aria)-[a-z_][a-z\d_.\-]*$/),Properties:{accept:null,acceptCharset:null,accessKey:null,action:null,allowFullScreen:i|s,allowTransparency:i,alt:null,async:s,autoComplete:null,autoPlay:s,capture:i|s,cellPadding:null,cellSpacing:null,charSet:i,challenge:i,checked:u|s,classID:i,className:r?i:u,cols:i|p,colSpan:null,content:null,contentEditable:null,contextMenu:i,controls:u|s,coords:null,crossOrigin:null,data:null,dateTime:i,default:s,defer:s,dir:null,disabled:i|s,download:d,draggable:null,encType:null,form:i,formAction:i,formEncType:i,formMethod:i,formNoValidate:s,formTarget:i,frameBorder:i,headers:null,height:i,hidden:i|s,high:null,href:null,hrefLang:null,htmlFor:null,httpEquiv:null,icon:null,id:u,inputMode:i,integrity:null,is:i,keyParams:i,keyType:i,kind:null,label:null,lang:null,list:i,loop:u|s,low:null,manifest:i,marginHeight:null,marginWidth:null,max:null,maxLength:i,media:i,mediaGroup:null,method:null,min:null,minLength:i,multiple:u|s,muted:u|s,name:null,nonce:i,noValidate:s,open:s,optimum:null,pattern:null,placeholder:null,poster:null,preload:null,radioGroup:null,readOnly:u|s,rel:null,required:s,reversed:s,role:i,rows:i|p,rowSpan:null,sandbox:null,scope:null,scoped:s,scrolling:null,seamless:i|s,selected:u|s,shape:null,size:i|p,sizes:i,span:p,spellCheck:null,src:null,srcDoc:u,srcLang:null,srcSet:i,start:c,step:null,style:null,summary:null,tabIndex:null,target:null,title:null,type:null,useMap:null,value:u|l,width:i,wmode:i,wrap:null,about:i,datatype:i,inlist:i,prefix:i,property:i,resource:i,typeof:i,vocab:i,autoCapitalize:null,autoCorrect:null,autoSave:null,color:null,itemProp:i,itemScope:i|s,itemType:i,itemID:i,itemRef:i,results:null,security:i,unselectable:i},DOMAttributeNames:{acceptCharset:"accept-charset",className:"class",htmlFor:"for",httpEquiv:"http-equiv"},DOMPropertyNames:{autoCapitalize:"autocapitalize",autoComplete:"autocomplete",autoCorrect:"autocorrect",autoFocus:"autofocus",autoPlay:"autoplay",autoSave:"autosave",encType:"encoding",hrefLang:"hreflang",radioGroup:"radiogroup",spellCheck:"spellcheck",srcDoc:"srcdoc",srcSet:"srcset"}};t.exports=h},{10:10,144:144}],22:[function(e,t,n){var r=e(68),o=e(88),a={linkState:function(e){return new r(this.state[e],o.createStateKeySetter(this,e))}};t.exports=a},{68:68,88:88}],23:[function(e,t,n){function r(e){null!=e.checkedLink&&null!=e.valueLink&&l(!1)}function o(e){r(e),(null!=e.value||null!=e.onChange)&&l(!1)}function a(e){r(e),(null!=e.checked||null!=e.onChange)&&l(!1)}function i(e){if(e){var t=e.getName();if(t)return" Check the render method of `"+t+"`."}return""}var u=e(80),s=e(79),l=e(158),c=(e(168),{button:!0,checkbox:!0,image:!0,hidden:!0,radio:!0,reset:!0,submit:!0}),p={value:function(e,t,n){return!e[t]||c[e.type]||e.onChange||e.readOnly||e.disabled?null:new Error("You provided a `value` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultValue`. Otherwise, set either `onChange` or `readOnly`.")},checked:function(e,t,n){return!e[t]||e.onChange||e.readOnly||e.disabled?null:new Error("You provided a `checked` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultChecked`. Otherwise, set either `onChange` or `readOnly`.")},onChange:u.func},d={},f={checkPropTypes:function(e,t,n){for(var r in p){if(p.hasOwnProperty(r))var o=p[r](t,r,e,s.prop);o instanceof Error&&!(o.message in d)&&(d[o.message]=!0,i(n))}},getValue:function(e){return e.valueLink?(o(e),e.valueLink.value):e.value},getChecked:function(e){return e.checkedLink?(a(e),e.checkedLink.value):e.checked},executeOnChange:function(e,t){return e.valueLink?(o(e),e.valueLink.requestChange(t.target.value)):e.checkedLink?(a(e),e.checkedLink.requestChange(t.target.checked)):e.onChange?e.onChange.call(void 0,t):void 0}};t.exports=f},{158:158,168:168,79:79,80:80}],24:[function(e,t,n){t.exports=function(e,t){if(null==e)throw new TypeError("Object.assign target cannot be null or undefined");for(var n=Object(e),r=Object.prototype.hasOwnProperty,o=1;o<arguments.length;o++){var a=arguments[o];if(null!=a){var i=Object(a);for(var u in i)r.call(i,u)&&(n[u]=i[u])}}return n}},{}],25:[function(e,t,n){var r=e(158),o=function(e){var t=this;if(t.instancePool.length){var n=t.instancePool.pop();return t.call(n,e),n}return new t(e)},l=function(e){var t=this;e instanceof t||r(!1),e.destructor(),t.instancePool.length<t.poolSize&&t.instancePool.push(e)},p=o,f={addPoolingTo:function(e,t){var n=e;return n.instancePool=[],n.getPooled=t||p,n.poolSize||(n.poolSize=10),n.release=l,n},oneArgumentPooler:o,twoArgumentPooler:function(e,t){var n=this;if(n.instancePool.length){var r=n.instancePool.pop();return n.call(r,e,t),r}return new n(e,t)},threeArgumentPooler:function(e,t,n){var r=this;if(r.instancePool.length){var o=r.instancePool.pop();return r.call(o,e,t,n),o}return new r(e,t,n)},fourArgumentPooler:function(e,t,n,r){var o=this;if(o.instancePool.length){var a=o.instancePool.pop();return o.call(a,e,t,n,r),a}return new o(e,t,n,r)},fiveArgumentPooler:function(e,t,n,r,o){var a=this;if(a.instancePool.length){var i=a.instancePool.pop();return a.call(i,e,t,n,r,o),i}return new a(e,t,n,r,o)}};t.exports=f},{158:158}],26:[function(e,t,n){var r=e(40),o=e(50),a=e(67),i=e(24),u=e(117),s={};i(s,a),i(s,{findDOMNode:u("findDOMNode","ReactDOM","react-dom",r,r.findDOMNode),render:u("render","ReactDOM","react-dom",r,r.render),unmountComponentAtNode:u("unmountComponentAtNode","ReactDOM","react-dom",r,r.unmountComponentAtNode),renderToString:u("renderToString","ReactDOMServer","react-dom/server",o,o.renderToString),renderToStaticMarkup:u("renderToStaticMarkup","ReactDOMServer","react-dom/server",o,o.renderToStaticMarkup)}),s.__SECRET_DOM_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=r,s.__SECRET_DOM_SERVER_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=o,t.exports=s},{117:117,24:24,40:40,50:50,67:67}],27:[function(e,t,n){var r=(e(66),e(119)),o=(e(168),"_getDOMNodeDidWarn"),a={getDOMNode:function(){return this.constructor[o]=!0,r(this)}};t.exports=a},{119:119,168:168,66:66}],28:[function(e,t,n){var o=e(15),a=e(16),i=e(17),u=e(60),s=e(76),l=e(111),c=e(24),p=e(130),d={},f=!1,h=0,v={topAbort:"abort",topBlur:"blur",topCanPlay:"canplay",topCanPlayThrough:"canplaythrough",topChange:"change",topClick:"click",topCompositionEnd:"compositionend",topCompositionStart:"compositionstart",topCompositionUpdate:"compositionupdate",topContextMenu:"contextmenu",topCopy:"copy",topCut:"cut",topDoubleClick:"dblclick",topDrag:"drag",topDragEnd:"dragend",topDragEnter:"dragenter",topDragExit:"dragexit",topDragLeave:"dragleave",topDragOver:"dragover",topDragStart:"dragstart",topDrop:"drop",topDurationChange:"durationchange",topEmptied:"emptied",topEncrypted:"encrypted",topEnded:"ended",topError:"error",topFocus:"focus",topInput:"input",topKeyDown:"keydown",topKeyPress:"keypress",topKeyUp:"keyup",topLoadedData:"loadeddata",topLoadedMetadata:"loadedmetadata",topLoadStart:"loadstart",topMouseDown:"mousedown",topMouseMove:"mousemove",topMouseOut:"mouseout",topMouseOver:"mouseover",topMouseUp:"mouseup",topPaste:"paste",topPause:"pause",topPlay:"play",topPlaying:"playing",topProgress:"progress",topRateChange:"ratechange",topScroll:"scroll",topSeeked:"seeked",topSeeking:"seeking",topSelectionChange:"selectionchange",topStalled:"stalled",topSuspend:"suspend",topTextInput:"textInput",topTimeUpdate:"timeupdate",topTouchCancel:"touchcancel",topTouchEnd:"touchend",topTouchMove:"touchmove",topTouchStart:"touchstart",topVolumeChange:"volumechange",topWaiting:"waiting",topWheel:"wheel"},m="_reactListenersID"+String(Math.random()).slice(2),g=c({},u,{ReactEventListener:null,injection:{injectReactEventListener:function(e){e.setHandleTopLevel(g.handleTopLevel),g.ReactEventListener=e}},setEnabled:function(e){g.ReactEventListener&&g.ReactEventListener.setEnabled(e)},isEnabled:function(){return!(!g.ReactEventListener||!g.ReactEventListener.isEnabled())},listenTo:function(e,t){for(var n=t,a=function(e){return Object.prototype.hasOwnProperty.call(e,m)||(e[m]=h++,d[e[m]]={}),d[e[m]]}(n),u=i.registrationNameDependencies[e],s=o.topLevelTypes,l=0;l<u.length;l++){var c=u[l];a.hasOwnProperty(c)&&a[c]||(c===s.topWheel?p("wheel")?g.ReactEventListener.trapBubbledEvent(s.topWheel,"wheel",n):p("mousewheel")?g.ReactEventListener.trapBubbledEvent(s.topWheel,"mousewheel",n):g.ReactEventListener.trapBubbledEvent(s.topWheel,"DOMMouseScroll",n):c===s.topScroll?p("scroll",!0)?g.ReactEventListener.trapCapturedEvent(s.topScroll,"scroll",n):g.ReactEventListener.trapBubbledEvent(s.topScroll,"scroll",g.ReactEventListener.WINDOW_HANDLE):c===s.topFocus||c===s.topBlur?(p("focus",!0)?(g.ReactEventListener.trapCapturedEvent(s.topFocus,"focus",n),g.ReactEventListener.trapCapturedEvent(s.topBlur,"blur",n)):p("focusin")&&(g.ReactEventListener.trapBubbledEvent(s.topFocus,"focusin",n),g.ReactEventListener.trapBubbledEvent(s.topBlur,"focusout",n)),a[s.topBlur]=!0,a[s.topFocus]=!0):v.hasOwnProperty(c)&&g.ReactEventListener.trapBubbledEvent(c,v[c],n),a[c]=!0)}},trapBubbledEvent:function(e,t,n){return g.ReactEventListener.trapBubbledEvent(e,t,n)},trapCapturedEvent:function(e,t,n){return g.ReactEventListener.trapCapturedEvent(e,t,n)},ensureScrollValueMonitoring:function(){if(!f){var e=l.refreshScrollValues;g.ReactEventListener.monitorScrollValue(e),f=!0}},eventNameDispatchConfigs:a.eventNameDispatchConfigs,registrationNameModules:a.registrationNameModules,putListener:a.putListener,getListener:a.getListener,deleteListener:a.deleteListener,deleteAllListeners:a.deleteAllListeners});s.measureMethods(g,"ReactBrowserEventEmitter",{putListener:"putListener",deleteListener:"deleteListener"}),t.exports=g},{111:111,130:130,15:15,16:16,17:17,24:24,60:60,76:76}],29:[function(e,t,n){function r(e){var t="transition"+e+"Timeout",n="transition"+e;return function(e){if(e[n]){if(null==e[t])return new Error(t+" wasn't supplied to ReactCSSTransitionGroup: this can cause unreliable animations and won't be supported in a future version of React. See https://fb.me/react-animation-transition-group-timeout for more information.");if("number"!=typeof e[t])return new Error(t+" must be a number (in milliseconds)")}}}var o=e(26),a=e(24),i=e(91),u=e(30),s=o.createClass({displayName:"ReactCSSTransitionGroup",propTypes:{transitionName:u.propTypes.name,transitionAppear:o.PropTypes.bool,transitionEnter:o.PropTypes.bool,transitionLeave:o.PropTypes.bool,transitionAppearTimeout:r("Appear"),transitionEnterTimeout:r("Enter"),transitionLeaveTimeout:r("Leave")},getDefaultProps:function(){return{transitionAppear:!1,transitionEnter:!0,transitionLeave:!0}},_wrapChild:function(e){return o.createElement(u,{name:this.props.transitionName,appear:this.props.transitionAppear,enter:this.props.transitionEnter,leave:this.props.transitionLeave,appearTimeout:this.props.transitionAppearTimeout,enterTimeout:this.props.transitionEnterTimeout,leaveTimeout:this.props.transitionLeaveTimeout},e)},render:function(){return o.createElement(i,a({},this.props,{childFactory:this._wrapChild}))}});t.exports=s},{24:24,26:26,30:30,91:91}],30:[function(e,t,n){var r=e(26),o=e(40),a=e(142),i=e(90),u=e(132),l=r.createClass({displayName:"ReactCSSTransitionGroupChild",propTypes:{name:r.PropTypes.oneOfType([r.PropTypes.string,r.PropTypes.shape({enter:r.PropTypes.string,leave:r.PropTypes.string,active:r.PropTypes.string}),r.PropTypes.shape({enter:r.PropTypes.string,enterActive:r.PropTypes.string,leave:r.PropTypes.string,leaveActive:r.PropTypes.string,appear:r.PropTypes.string,appearActive:r.PropTypes.string})]).isRequired,appear:r.PropTypes.bool,enter:r.PropTypes.bool,leave:r.PropTypes.bool,appearTimeout:r.PropTypes.number,enterTimeout:r.PropTypes.number,leaveTimeout:r.PropTypes.number},transition:function(e,t,n){var r=o.findDOMNode(this);if(r){var u=this.props.name[e]||this.props.name+"-"+e,s=this.props.name[e+"Active"]||u+"-active",l=null,c=function c(e){e&&e.target!==r||(clearTimeout(l),a.removeClass(r,u),a.removeClass(r,s),i.removeEndEventListener(r,c),t&&t())};a.addClass(r,u),this.queueClass(s),n?(l=setTimeout(c,n),this.transitionTimeouts.push(l)):i.addEndEventListener(r,c)}else t&&t()},queueClass:function(e){this.classNameQueue.push(e),this.timeout||(this.timeout=setTimeout(this.flushClassNameQueue,17))},flushClassNameQueue:function(){this.isMounted()&&this.classNameQueue.forEach(a.addClass.bind(a,o.findDOMNode(this))),this.classNameQueue.length=0,this.timeout=null},componentWillMount:function(){this.classNameQueue=[],this.transitionTimeouts=[]},componentWillUnmount:function(){this.timeout&&clearTimeout(this.timeout),this.transitionTimeouts.forEach((function(e){clearTimeout(e)}))},componentWillAppear:function(e){this.props.appear?this.transition("appear",e,this.props.appearTimeout):e()},componentWillEnter:function(e){this.props.enter?this.transition("enter",e,this.props.enterTimeout):e()},componentWillLeave:function(e){this.props.leave?this.transition("leave",e,this.props.leaveTimeout):e()},render:function(){return u(this.props.children)}});t.exports=l},{132:132,142:142,26:26,40:40,90:90}],31:[function(e,t,n){function r(e,t,n){var r=void 0===e[n];null!=t&&r&&(e[n]=a(t,null))}var o=e(82),a=e(129),i=e(138),u=e(139),s=(e(168),{instantiateChildren:function(e,t,n){if(null==e)return null;var o={};return u(e,r,o),o},updateChildren:function(e,t,n,r){if(!t&&!e)return null;var u;for(u in t)if(t.hasOwnProperty(u)){var s=e&&e[u],l=s&&s._currentElement,c=t[u];if(null!=s&&i(l,c))o.receiveComponent(s,c,n,r),t[u]=s;else{s&&o.unmountComponent(s,u);var p=a(c,null);t[u]=p}}for(u in e)!e.hasOwnProperty(u)||t&&t.hasOwnProperty(u)||o.unmountComponent(e[u]);return t},unmountChildren:function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];o.unmountComponent(n)}}});t.exports=s},{129:129,138:138,139:139,168:168,82:82}],32:[function(e,t,n){function r(e){return(""+e).replace(b,"//")}function o(e,t){this.func=e,this.context=t,this.count=0}function a(e,t,n){var r=e.func,o=e.context;r.call(o,t,e.count++)}function u(e,t,n,r){this.result=e,this.keyPrefix=t,this.func=n,this.context=r,this.count=0}function s(e,t,n){var o=e.result,a=e.keyPrefix,i=e.func,u=e.context,s=i.call(u,t,e.count++);Array.isArray(s)?l(s,o,n,m.thatReturnsArgument):null!=s&&(v.isValidElement(s)&&(s=v.cloneAndReplaceKey(s,a+(s!==t?r(s.key||"")+"/":"")+n)),o.push(s))}function l(e,t,n,o,a){var i="";null!=n&&(i=r(n)+"/");var l=u.getPooled(t,i,o,a);g(e,s,l),u.release(l)}function p(e,t,n){return null}var h=e(25),v=e(55),m=e(150),g=e(139),y=h.twoArgumentPooler,C=h.fourArgumentPooler,b=/\/(?!\/)/g;o.prototype.destructor=function(){this.func=null,this.context=null,this.count=0},h.addPoolingTo(o,y),u.prototype.destructor=function(){this.result=null,this.keyPrefix=null,this.func=null,this.context=null,this.count=0},h.addPoolingTo(u,C);var E={forEach:function(e,t,n){if(null==e)return e;var r=o.getPooled(t,n);g(e,a,r),o.release(r)},map:function(e,t,n){if(null==e)return e;var r=[];return l(e,r,null,t,n),r},mapIntoWithKeyPrefixInternal:l,count:function(e,t){return g(e,p,null)},toArray:function(e){var t=[];return l(e,t,null,m.thatReturnsArgument),t}};t.exports=E},{139:139,150:150,25:25,55:55}],33:[function(e,t,n){function r(e,t){var n=_.hasOwnProperty(t)?_[t]:null;D.hasOwnProperty(t)&&n!==b.OVERRIDE_BASE&&m(!1),e.hasOwnProperty(t)&&n!==b.DEFINE_MANY&&n!==b.DEFINE_MANY_MERGED&&m(!1)}function o(e,t){if(t){"function"==typeof t&&m(!1),d.isValidElement(t)&&m(!1);var n=e.prototype;for(var o in t.hasOwnProperty(C)&&x.mixins(e,t.mixins),t)if(t.hasOwnProperty(o)&&o!==C){var a=t[o];if(r(n,o),x.hasOwnProperty(o))x[o](e,a);else{var i=_.hasOwnProperty(o),l=n.hasOwnProperty(o);if("function"==typeof a&&!i&&!l&&!1!==t.autobind)n.__reactAutoBindMap||(n.__reactAutoBindMap={}),n.__reactAutoBindMap[o]=a,n[o]=a;else if(l){var f=_[o];(!i||f!==b.DEFINE_MANY_MERGED&&f!==b.DEFINE_MANY)&&m(!1),f===b.DEFINE_MANY_MERGED?n[o]=u(n[o],a):f===b.DEFINE_MANY&&(n[o]=s(n[o],a))}else n[o]=a}}}}function i(e,t){for(var n in e&&t&&"object"==_typeof(e)&&"object"==_typeof(t)||m(!1),t)t.hasOwnProperty(n)&&(void 0!==e[n]&&m(!1),e[n]=t[n]);return e}function u(e,t){return function(){var n=e.apply(this,arguments),r=t.apply(this,arguments);if(null==n)return r;if(null==r)return n;var o={};return i(o,n),i(o,r),o}}function s(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function l(e,t){return t.bind(e)}var p=e(34),d=e(55),f=(e(79),e(78),e(74)),h=e(24),v=e(151),m=e(158),g=e(162),y=e(163),C=(e(168),y({mixins:null})),b=g({DEFINE_ONCE:null,DEFINE_MANY:null,OVERRIDE_BASE:null,DEFINE_MANY_MERGED:null}),E=[],_={mixins:b.DEFINE_MANY,statics:b.DEFINE_MANY,propTypes:b.DEFINE_MANY,contextTypes:b.DEFINE_MANY,childContextTypes:b.DEFINE_MANY,getDefaultProps:b.DEFINE_MANY_MERGED,getInitialState:b.DEFINE_MANY_MERGED,getChildContext:b.DEFINE_MANY_MERGED,render:b.DEFINE_ONCE,componentWillMount:b.DEFINE_MANY,componentDidMount:b.DEFINE_MANY,componentWillReceiveProps:b.DEFINE_MANY,shouldComponentUpdate:b.DEFINE_ONCE,componentWillUpdate:b.DEFINE_MANY,componentDidUpdate:b.DEFINE_MANY,componentWillUnmount:b.DEFINE_MANY,updateComponent:b.OVERRIDE_BASE},x={displayName:function(e,t){e.displayName=t},mixins:function(e,t){if(t)for(var n=0;n<t.length;n++)o(e,t[n])},childContextTypes:function(e,t){e.childContextTypes=h({},e.childContextTypes,t)},contextTypes:function(e,t){e.contextTypes=h({},e.contextTypes,t)},getDefaultProps:function(e,t){e.getDefaultProps?e.getDefaultProps=u(e.getDefaultProps,t):e.getDefaultProps=t},propTypes:function(e,t){e.propTypes=h({},e.propTypes,t)},statics:function(e,t){!function(e,t){if(t)for(var n in t){var r=t[n];t.hasOwnProperty(n)&&(n in x&&m(!1),n in e&&m(!1),e[n]=r)}}(e,t)},autobind:function(){}},D={replaceState:function(e,t){this.updater.enqueueReplaceState(this,e),t&&this.updater.enqueueCallback(this,t)},isMounted:function(){return this.updater.isMounted(this)},setProps:function(e,t){this.updater.enqueueSetProps(this,e),t&&this.updater.enqueueCallback(this,t)},replaceProps:function(e,t){this.updater.enqueueReplaceProps(this,e),t&&this.updater.enqueueCallback(this,t)}},P=function(){};h(P.prototype,p.prototype,D);var T={createClass:function(e){var t=function(e,_t,n){this.__reactAutoBindMap&&function(e){for(var t in e.__reactAutoBindMap)if(e.__reactAutoBindMap.hasOwnProperty(t)){var n=e.__reactAutoBindMap[t];e[t]=l(e,n)}}(this),this.props=e,this.context=_t,this.refs=v,this.updater=n||f,this.state=null;var r=this.getInitialState?this.getInitialState():null;("object"!=_typeof(r)||Array.isArray(r))&&m(!1),this.state=r};for(var n in(t.prototype=new P).constructor=t,E.forEach(o.bind(null,t)),o(t,e),t.getDefaultProps&&(t.defaultProps=t.getDefaultProps()),t.prototype.render||m(!1),_)t.prototype[n]||(t.prototype[n]=null);return t},injection:{injectMixin:function(e){E.push(e)}}};t.exports=T},{151:151,158:158,162:162,163:163,168:168,24:24,34:34,55:55,74:74,78:78,79:79}],34:[function(e,t,n){function r(e,t,n){this.props=e,this.context=t,this.refs=a,this.updater=n||o}var o=e(74),a=(e(114),e(151)),i=e(158);e(168),r.prototype.isReactComponent={},r.prototype.setState=function(e,t){"object"!=_typeof(e)&&"function"!=typeof e&&null!=e&&i(!1),this.updater.enqueueSetState(this,e),t&&this.updater.enqueueCallback(this,t)},r.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this),e&&this.updater.enqueueCallback(this,e)},t.exports=r},{114:114,151:151,158:158,168:168,74:74}],35:[function(e,t,n){var r=e(45),o=e(70),a={processChildrenUpdates:r.dangerouslyProcessChildrenUpdates,replaceNodeWithMarkupByID:r.dangerouslyReplaceNodeWithMarkupByID,unmountIDFromEnvironment:function(e){o.purgeID(e)}};t.exports=a},{45:45,70:70}],36:[function(e,t,n){var r=e(158),o=!1,a={unmountIDFromEnvironment:null,replaceNodeWithMarkupByID:null,processChildrenUpdates:null,injection:{injectEnvironment:function(e){o&&r(!1),a.unmountIDFromEnvironment=e.unmountIDFromEnvironment,a.replaceNodeWithMarkupByID=e.replaceNodeWithMarkupByID,a.processChildrenUpdates=e.processChildrenUpdates,o=!0}}};t.exports=a},{158:158}],37:[function(e,t,n){var r=e(137),o={shouldComponentUpdate:function(e,t){return r(this,e,t)}};t.exports=o},{137:137}],38:[function(e,t,n){function r(e){var t=e._currentElement._owner||null;if(t){var n=t.getName();if(n)return" Check the render method of `"+n+"`."}return""}function o(e){}var a=e(36),i=e(39),u=e(55),s=e(66),l=e(76),c=e(79),p=(e(78),e(82)),d=e(92),f=e(24),h=e(151),v=e(158),m=e(138);e(168),o.prototype.render=function(){return(0,s.get(this)._currentElement.type)(this.props,this.context,this.updater)};var g=1,y={construct:function(e){this._currentElement=e,this._rootNodeID=null,this._instance=null,this._pendingElement=null,this._pendingStateQueue=null,this._pendingReplaceState=!1,this._pendingForceUpdate=!1,this._renderedComponent=null,this._context=null,this._mountOrder=0,this._topLevelWrapper=null,this._pendingCallbacks=null},mountComponent:function(e,t,n){this._context=n,this._mountOrder=g++,this._rootNodeID=e;var r,a,i=this._processProps(this._currentElement.props),l=this._processContext(n),c=this._currentElement.type,f="prototype"in c;f&&(r=new c(i,l,d)),(!f||null===r||!1===r||u.isValidElement(r))&&(a=r,r=new o(c)),r.props=i,r.context=l,r.refs=h,r.updater=d,this._instance=r,s.set(r,this);var m=r.state;void 0===m&&(r.state=m=null),("object"!=_typeof(m)||Array.isArray(m))&&v(!1),this._pendingStateQueue=null,this._pendingReplaceState=!1,this._pendingForceUpdate=!1,r.componentWillMount&&(r.componentWillMount(),this._pendingStateQueue&&(r.state=this._processPendingState(r.props,r.context))),void 0===a&&(a=this._renderValidatedComponent()),this._renderedComponent=this._instantiateReactComponent(a);var y=p.mountComponent(this._renderedComponent,e,t,this._processChildContext(n));return r.componentDidMount&&t.getReactMountReady().enqueue(r.componentDidMount,r),y},unmountComponent:function(){var e=this._instance;e.componentWillUnmount&&e.componentWillUnmount(),p.unmountComponent(this._renderedComponent),this._renderedComponent=null,this._instance=null,this._pendingStateQueue=null,this._pendingReplaceState=!1,this._pendingForceUpdate=!1,this._pendingCallbacks=null,this._pendingElement=null,this._context=null,this._rootNodeID=null,this._topLevelWrapper=null,s.remove(e)},_maskContext:function(e){var t=null,r=this._currentElement.type.contextTypes;if(!r)return h;for(var o in t={},r)t[o]=e[o];return t},_processContext:function(e){return this._maskContext(e)},_processChildContext:function(e){var t=this._currentElement.type,n=this._instance,r=n.getChildContext&&n.getChildContext();if(r){for(var o in"object"!=_typeof(t.childContextTypes)&&v(!1),r)o in t.childContextTypes||v(!1);return f({},e,r)}return e},_processProps:function(e){return e},_checkPropTypes:function(e,t,n){var o=this.getName();for(var a in e)if(e.hasOwnProperty(a)){var i;try{"function"!=typeof e[a]&&v(!1),i=e[a](t,a,o,n)}catch(u){i=u}i instanceof Error&&(r(this),c.prop)}},receiveComponent:function(e,t,n){var r=this._currentElement,o=this._context;this._pendingElement=null,this.updateComponent(t,r,e,o,n)},performUpdateIfNecessary:function(e){null!=this._pendingElement&&p.receiveComponent(this,this._pendingElement||this._currentElement,e,this._context),(null!==this._pendingStateQueue||this._pendingForceUpdate)&&this.updateComponent(e,this._currentElement,this._currentElement,this._context,this._context)},updateComponent:function(e,t,n,r,o){var a,i=this._instance,u=this._context===o?i.context:this._processContext(o);t===n?a=n.props:(a=this._processProps(n.props),i.componentWillReceiveProps&&i.componentWillReceiveProps(a,u));var s=this._processPendingState(a,u);this._pendingForceUpdate||!i.shouldComponentUpdate||i.shouldComponentUpdate(a,s,u)?(this._pendingForceUpdate=!1,this._performComponentUpdate(n,a,s,u,e,o)):(this._currentElement=n,this._context=o,i.props=a,i.state=s,i.context=u)},_processPendingState:function(e,t){var n=this._instance,r=this._pendingStateQueue,o=this._pendingReplaceState;if(this._pendingReplaceState=!1,this._pendingStateQueue=null,!r)return n.state;if(o&&1===r.length)return r[0];for(var a=f({},o?r[0]:n.state),i=o?1:0;i<r.length;i++){var u=r[i];f(a,"function"==typeof u?u.call(n,a,e,t):u)}return a},_performComponentUpdate:function(e,t,n,r,o,a){var i,u,s,l=this._instance,c=Boolean(l.componentDidUpdate);c&&(i=l.props,u=l.state,s=l.context),l.componentWillUpdate&&l.componentWillUpdate(t,n,r),this._currentElement=e,this._context=a,l.props=t,l.state=n,l.context=r,this._updateRenderedComponent(o,a),c&&o.getReactMountReady().enqueue(l.componentDidUpdate.bind(l,i,u,s),l)},_updateRenderedComponent:function(e,t){var n=this._renderedComponent,r=n._currentElement,o=this._renderValidatedComponent();if(m(r,o))p.receiveComponent(n,o,e,this._processChildContext(t));else{var a=this._rootNodeID,i=n._rootNodeID;p.unmountComponent(n),this._renderedComponent=this._instantiateReactComponent(o);var u=p.mountComponent(this._renderedComponent,a,e,this._processChildContext(t));this._replaceNodeWithMarkupByID(i,u)}},_replaceNodeWithMarkupByID:function(e,t){a.replaceNodeWithMarkupByID(e,t)},_renderValidatedComponentWithoutOwnerOrContext:function(){return this._instance.render()},_renderValidatedComponent:function(){var e;i.current=this;try{e=this._renderValidatedComponentWithoutOwnerOrContext()}finally{i.current=null}return null===e||!1===e||u.isValidElement(e)||v(!1),e},attachRef:function(e,t){var n=this.getPublicInstance();null==n&&v(!1);var r=t.getPublicInstance();(n.refs===h?n.refs={}:n.refs)[e]=r},detachRef:function(e){delete this.getPublicInstance().refs[e]},getName:function(){var e=this._currentElement.type,t=this._instance&&this._instance.constructor;return e.displayName||t&&t.displayName||e.name||t&&t.name||null},getPublicInstance:function(){var e=this._instance;return e instanceof o?null:e},_instantiateReactComponent:null};l.measureMethods(y,"ReactCompositeComponent",{mountComponent:"mountComponent",updateComponent:"updateComponent",_renderValidatedComponent:"_renderValidatedComponent"});var C={Mixin:y};t.exports=C},{138:138,151:151,158:158,168:168,24:24,36:36,39:39,55:55,66:66,76:76,78:78,79:79,82:82,92:92}],39:[function(e,t,n){t.exports={current:null}},{}],40:[function(e,t,n){var r=e(39),o=e(51),a=e(54),i=e(65),u=e(70),s=e(76),l=e(82),c=e(93),p=e(94),d=e(119),f=e(134);e(168),a.inject();var v={findDOMNode:d,render:s.measure("React","render",u.render),unmountComponentAtNode:u.unmountComponentAtNode,version:p,unstable_batchedUpdates:c.batchedUpdates,unstable_renderSubtreeIntoContainer:f};"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.inject&&__REACT_DEVTOOLS_GLOBAL_HOOK__.inject({CurrentOwner:r,InstanceHandles:i,Mount:u,Reconciler:l,TextComponent:o}),t.exports=v},{119:119,134:134,168:168,39:39,51:51,54:54,65:65,70:70,76:76,82:82,93:93,94:94}],41:[function(e,t,n){var r={onClick:!0,onDoubleClick:!0,onMouseDown:!0,onMouseMove:!0,onMouseUp:!0,onClickCapture:!0,onDoubleClickCapture:!0,onMouseDownCapture:!0,onMouseMoveCapture:!0,onMouseUpCapture:!0},o={getNativeProps:function(e,t,n){if(!t.disabled)return t;var o={};for(var a in t)t.hasOwnProperty(a)&&!r[a]&&(o[a]=t[a]);return o}};t.exports=o},{}],42:[function(e,t,n){function r(){return this}function o(){return!!this._reactInternalComponent}function a(){}function i(e,t){var n=this._reactInternalComponent;n&&(I.enqueueSetPropsInternal(n,e),t&&I.enqueueCallbackInternal(n,t))}function u(e,t){var n=this._reactInternalComponent;n&&(I.enqueueReplacePropsInternal(n,e),t&&I.enqueueCallbackInternal(n,t))}function s(e,t){t&&(null!=t.dangerouslySetInnerHTML&&(null!=t.children&&L(!1),"object"==_typeof(t.dangerouslySetInnerHTML)&&z in t.dangerouslySetInnerHTML||L(!1)),null!=t.style&&"object"!=_typeof(t.style)&&L(!1))}function l(e,t,n,r){var o=w.findReactContainerForID(e);if(o){var a=o.nodeType===Y?o.ownerDocument:o;j(t,a)}r.getReactMountReady().enqueue(c,{id:e,registrationName:t,listener:n})}function c(){var e=this;_.putListener(e.id,e.registrationName,e.listener)}function p(){var e=this;e._rootNodeID||L(!1);var t=w.getNode(e._rootNodeID);switch(t||L(!1),e._tag){case"iframe":e._wrapperState.listeners=[_.trapBubbledEvent(E.topLevelTypes.topLoad,"load",t)];break;case"video":case"audio":for(var n in e._wrapperState.listeners=[],G)G.hasOwnProperty(n)&&e._wrapperState.listeners.push(_.trapBubbledEvent(E.topLevelTypes[n],G[n],t));break;case"img":e._wrapperState.listeners=[_.trapBubbledEvent(E.topLevelTypes.topError,"error",t),_.trapBubbledEvent(E.topLevelTypes.topLoad,"load",t)];break;case"form":e._wrapperState.listeners=[_.trapBubbledEvent(E.topLevelTypes.topReset,"reset",t),_.trapBubbledEvent(E.topLevelTypes.topSubmit,"submit",t)]}}function d(){P.mountReadyWrapper(this)}function f(){M.postUpdateWrapper(this)}function v(e,t){return e.indexOf("-")>=0||null!=t.is}function m(e){(function(e){J.call(Z,e)||($.test(e)||L(!1),Z[e]=!0)})(e),this._tag=e.toLowerCase(),this._renderedChildren=null,this._previousStyle=null,this._previousStyleCopy=null,this._rootNodeID=null,this._wrapperState=null,this._topLevelWrapper=null,this._nodeWithLegacyProperties=null}var g=e(2),y=e(5),C=e(10),b=e(11),E=e(15),_=e(28),x=e(35),D=e(41),P=e(46),T=e(47),M=e(48),N=e(52),w=e(70),S=e(71),R=e(76),I=e(92),k=e(24),O=e(114),A=e(118),L=e(158),U=(e(130),e(163)),F=e(135),B=e(136),V=(e(166),e(141),e(168),_.deleteListener),j=_.listenTo,W=_.registrationNameModules,K={string:!0,number:!0},q=U({children:null}),H=U({style:null}),z=U({__html:null}),Y=1,G={topAbort:"abort",topCanPlay:"canplay",topCanPlayThrough:"canplaythrough",topDurationChange:"durationchange",topEmptied:"emptied",topEncrypted:"encrypted",topEnded:"ended",topError:"error",topLoadedData:"loadeddata",topLoadedMetadata:"loadedmetadata",topLoadStart:"loadstart",topPause:"pause",topPlay:"play",topPlaying:"playing",topProgress:"progress",topRateChange:"ratechange",topSeeked:"seeked",topSeeking:"seeking",topStalled:"stalled",topSuspend:"suspend",topTimeUpdate:"timeupdate",topVolumeChange:"volumechange",topWaiting:"waiting"},Q={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},X={listing:!0,pre:!0,textarea:!0},$=(k({menuitem:!0},Q),/^[a-zA-Z][a-zA-Z:_\.\-\d]*$/),Z={},J={}.hasOwnProperty;m.displayName="ReactDOMComponent",m.Mixin={construct:function(e){this._currentElement=e},mountComponent:function(e,t,n){this._rootNodeID=e;var o,r=this._currentElement.props;switch(this._tag){case"iframe":case"img":case"form":case"video":case"audio":this._wrapperState={listeners:null},t.getReactMountReady().enqueue(p,this);break;case"button":r=D.getNativeProps(this,r,n);break;case"input":P.mountWrapper(this,r,n),r=P.getNativeProps(this,r,n);break;case"option":T.mountWrapper(this,r,n),r=T.getNativeProps(this,r,n);break;case"select":M.mountWrapper(this,r,n),r=M.getNativeProps(this,r,n),n=M.processChildContext(this,r,n);break;case"textarea":N.mountWrapper(this,r,n),r=N.getNativeProps(this,r,n)}if(s(0,r),t.useCreateElement){var i=n[w.ownerDocumentContextKey].createElement(this._currentElement.type);b.setAttributeForID(i,this._rootNodeID),w.getID(i),this._updateDOMProperties({},r,t,i),this._createInitialChildren(t,r,n,i),o=i}else{var u=this._createOpenTagMarkupAndPutListeners(t,r),l=this._createContentMarkup(t,r,n);o=!l&&Q[this._tag]?u+"/>":u+">"+l+"</"+this._currentElement.type+">"}switch(this._tag){case"input":t.getReactMountReady().enqueue(d,this);case"button":case"select":case"textarea":r.autoFocus&&t.getReactMountReady().enqueue(g.focusDOMComponent,this)}return o},_createOpenTagMarkupAndPutListeners:function(e,t){var n="<"+this._currentElement.type;for(var r in t)if(t.hasOwnProperty(r)){var o=t[r];if(null!=o)if(W.hasOwnProperty(r))o&&l(this._rootNodeID,r,o,e);else{r===H&&(o&&(o=this._previousStyleCopy=k({},t.style)),o=y.createMarkupForStyles(o));var a=null;null!=this._tag&&v(this._tag,t)?r!==q&&(a=b.createMarkupForCustomAttribute(r,o)):a=b.createMarkupForProperty(r,o),a&&(n+=" "+a)}}return e.renderToStaticMarkup?n:n+" "+b.createMarkupForID(this._rootNodeID)},_createContentMarkup:function(e,t,n){var r="",o=t.dangerouslySetInnerHTML;if(null!=o)null!=o.__html&&(r=o.__html);else{var a=K[_typeof(t.children)]?t.children:null,i=null!=a?null:t.children;if(null!=a)r=A(a);else if(null!=i){r=this.mountChildren(i,e,n).join("")}}return X[this._tag]&&"\n"===r.charAt(0)?"\n"+r:r},_createInitialChildren:function(e,t,n,r){var o=t.dangerouslySetInnerHTML;if(null!=o)null!=o.__html&&F(r,o.__html);else{var a=K[_typeof(t.children)]?t.children:null,i=null!=a?null:t.children;if(null!=a)B(r,a);else if(null!=i)for(var u=this.mountChildren(i,e,n),s=0;s<u.length;s++)r.appendChild(u[s])}},receiveComponent:function(e,t,n){var r=this._currentElement;this._currentElement=e,this.updateComponent(t,r,e,n)},updateComponent:function(e,t,n,r){var o=t.props,a=this._currentElement.props;switch(this._tag){case"button":o=D.getNativeProps(this,o),a=D.getNativeProps(this,a);break;case"input":P.updateWrapper(this),o=P.getNativeProps(this,o),a=P.getNativeProps(this,a);break;case"option":o=T.getNativeProps(this,o),a=T.getNativeProps(this,a);break;case"select":o=M.getNativeProps(this,o),a=M.getNativeProps(this,a);break;case"textarea":N.updateWrapper(this),o=N.getNativeProps(this,o),a=N.getNativeProps(this,a)}s(0,a),this._updateDOMProperties(o,a,e,null),this._updateDOMChildren(o,a,e,r),!O&&this._nodeWithLegacyProperties&&(this._nodeWithLegacyProperties.props=a),"select"===this._tag&&e.getReactMountReady().enqueue(f,this)},_updateDOMProperties:function(e,t,n,r){var o,a,i;for(o in e)if(!t.hasOwnProperty(o)&&e.hasOwnProperty(o))if(o===H){var u=this._previousStyleCopy;for(a in u)u.hasOwnProperty(a)&&((i=i||{})[a]="");this._previousStyleCopy=null}else W.hasOwnProperty(o)?e[o]&&V(this._rootNodeID,o):(C.properties[o]||C.isCustomAttribute(o))&&(r||(r=w.getNode(this._rootNodeID)),b.deleteValueForProperty(r,o));for(o in t){var s=t[o],c=o===H?this._previousStyleCopy:e[o];if(t.hasOwnProperty(o)&&s!==c)if(o===H)if(s?s=this._previousStyleCopy=k({},s):this._previousStyleCopy=null,c){for(a in c)!c.hasOwnProperty(a)||s&&s.hasOwnProperty(a)||((i=i||{})[a]="");for(a in s)s.hasOwnProperty(a)&&c[a]!==s[a]&&((i=i||{})[a]=s[a])}else i=s;else W.hasOwnProperty(o)?s?l(this._rootNodeID,o,s,n):c&&V(this._rootNodeID,o):v(this._tag,t)?(r||(r=w.getNode(this._rootNodeID)),o===q&&(s=null),b.setValueForAttribute(r,o,s)):(C.properties[o]||C.isCustomAttribute(o))&&(r||(r=w.getNode(this._rootNodeID)),null!=s?b.setValueForProperty(r,o,s):b.deleteValueForProperty(r,o))}i&&(r||(r=w.getNode(this._rootNodeID)),y.setValueForStyles(r,i))},_updateDOMChildren:function(e,t,n,r){var o=K[_typeof(e.children)]?e.children:null,a=K[_typeof(t.children)]?t.children:null,i=e.dangerouslySetInnerHTML&&e.dangerouslySetInnerHTML.__html,u=t.dangerouslySetInnerHTML&&t.dangerouslySetInnerHTML.__html,s=null!=o?null:e.children,l=null!=a?null:t.children,c=null!=o||null!=i,p=null!=a||null!=u;null!=s&&null==l?this.updateChildren(null,n,r):c&&!p&&this.updateTextContent(""),null!=a?o!==a&&this.updateTextContent(""+a):null!=u?i!==u&&this.updateMarkup(""+u):null!=l&&this.updateChildren(l,n,r)},unmountComponent:function(){switch(this._tag){case"iframe":case"img":case"form":case"video":case"audio":var e=this._wrapperState.listeners;if(e)for(var t=0;t<e.length;t++)e[t].remove();break;case"input":P.unmountWrapper(this);break;case"html":case"head":case"body":L(!1)}(this.unmountChildren(),_.deleteAllListeners(this._rootNodeID),x.unmountIDFromEnvironment(this._rootNodeID),this._rootNodeID=null,this._wrapperState=null,this._nodeWithLegacyProperties)&&(this._nodeWithLegacyProperties._reactInternalComponent=null,this._nodeWithLegacyProperties=null)},getPublicInstance:function(){if(!this._nodeWithLegacyProperties){var e=w.getNode(this._rootNodeID);e._reactInternalComponent=this,e.getDOMNode=r,e.isMounted=o,e.setState=a,e.replaceState=a,e.forceUpdate=a,e.setProps=i,e.replaceProps=u,e.props=this._currentElement.props,this._nodeWithLegacyProperties=e}return this._nodeWithLegacyProperties}},R.measureMethods(m,"ReactDOMComponent",{mountComponent:"mountComponent",updateComponent:"updateComponent"}),k(m.prototype,m.Mixin,S.Mixin),t.exports=m},{10:10,11:11,114:114,118:118,130:130,135:135,136:136,141:141,15:15,158:158,163:163,166:166,168:168,2:2,24:24,28:28,35:35,41:41,46:46,47:47,48:48,5:5,52:52,70:70,71:71,76:76,92:92}],43:[function(e,t,n){var o=e(55),i=(e(56),e(164))({a:"a",abbr:"abbr",address:"address",area:"area",article:"article",aside:"aside",audio:"audio",b:"b",base:"base",bdi:"bdi",bdo:"bdo",big:"big",blockquote:"blockquote",body:"body",br:"br",button:"button",canvas:"canvas",caption:"caption",cite:"cite",code:"code",col:"col",colgroup:"colgroup",data:"data",datalist:"datalist",dd:"dd",del:"del",details:"details",dfn:"dfn",dialog:"dialog",div:"div",dl:"dl",dt:"dt",em:"em",embed:"embed",fieldset:"fieldset",figcaption:"figcaption",figure:"figure",footer:"footer",form:"form",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",head:"head",header:"header",hgroup:"hgroup",hr:"hr",html:"html",i:"i",iframe:"iframe",img:"img",input:"input",ins:"ins",kbd:"kbd",keygen:"keygen",label:"label",legend:"legend",li:"li",link:"link",main:"main",map:"map",mark:"mark",menu:"menu",menuitem:"menuitem",meta:"meta",meter:"meter",nav:"nav",noscript:"noscript",object:"object",ol:"ol",optgroup:"optgroup",option:"option",output:"output",p:"p",param:"param",picture:"picture",pre:"pre",progress:"progress",q:"q",rp:"rp",rt:"rt",ruby:"ruby",s:"s",samp:"samp",script:"script",section:"section",select:"select",small:"small",source:"source",span:"span",strong:"strong",style:"style",sub:"sub",summary:"summary",sup:"sup",table:"table",tbody:"tbody",td:"td",textarea:"textarea",tfoot:"tfoot",th:"th",thead:"thead",time:"time",title:"title",tr:"tr",track:"track",u:"u",ul:"ul",var:"var",video:"video",wbr:"wbr",circle:"circle",clipPath:"clipPath",defs:"defs",ellipse:"ellipse",g:"g",image:"image",line:"line",linearGradient:"linearGradient",mask:"mask",path:"path",pattern:"pattern",polygon:"polygon",polyline:"polyline",radialGradient:"radialGradient",rect:"rect",stop:"stop",svg:"svg",text:"text",tspan:"tspan"},(function(e){return o.createFactory(e)}));t.exports=i},{164:164,55:55,56:56}],44:[function(e,t,n){t.exports={useCreateElement:!1}},{}],45:[function(e,t,n){var r=e(9),o=e(11),a=e(70),i=e(76),u=e(158),s={dangerouslySetInnerHTML:"`dangerouslySetInnerHTML` must be set using `updateInnerHTMLByID()`.",style:"`style` must be set using `updateStylesByID()`."},l={updatePropertyByID:function(e,t,n){var r=a.getNode(e);s.hasOwnProperty(t)&&u(!1),null!=n?o.setValueForProperty(r,t,n):o.deleteValueForProperty(r,t)},dangerouslyReplaceNodeWithMarkupByID:function(e,t){var n=a.getNode(e);r.dangerouslyReplaceNodeWithMarkup(n,t)},dangerouslyProcessChildrenUpdates:function(e,t){for(var n=0;n<e.length;n++)e[n].parentNode=a.getNode(e[n].parentID);r.processUpdates(e,t)}};i.measureMethods(l,"ReactDOMIDOperations",{dangerouslyReplaceNodeWithMarkupByID:"dangerouslyReplaceNodeWithMarkupByID",dangerouslyProcessChildrenUpdates:"dangerouslyProcessChildrenUpdates"}),t.exports=l},{11:11,158:158,70:70,76:76,9:9}],46:[function(e,t,n){function r(){this._rootNodeID&&d.updateWrapper(this)}function o(e){var t=this._currentElement.props,n=i.executeOnChange(t,e);s.asap(r,this);var o=t.name;if("radio"===t.type&&null!=o){for(var a=u.getNode(this._rootNodeID),l=a;l.parentNode;)l=l.parentNode;for(var d=l.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),f=0;f<d.length;f++){var h=d[f];if(h!==a&&h.form===a.form){var v=u.getID(h);v||c(!1);var m=p[v];m||c(!1),s.asap(r,m)}}}return n}var a=e(45),i=e(23),u=e(70),s=e(93),l=e(24),c=e(158),p={},d={getNativeProps:function(e,t,n){var r=i.getValue(t),o=i.getChecked(t);return l({},t,{defaultChecked:void 0,defaultValue:void 0,value:null!=r?r:e._wrapperState.initialValue,checked:null!=o?o:e._wrapperState.initialChecked,onChange:e._wrapperState.onChange})},mountWrapper:function(e,t){var n=t.defaultValue;e._wrapperState={initialChecked:t.defaultChecked||!1,initialValue:null!=n?n:null,onChange:o.bind(e)}},mountReadyWrapper:function(e){p[e._rootNodeID]=e},unmountWrapper:function(e){delete p[e._rootNodeID]},updateWrapper:function(e){var t=e._currentElement.props,n=t.checked;null!=n&&a.updatePropertyByID(e._rootNodeID,"checked",n||!1);var r=i.getValue(t);null!=r&&a.updatePropertyByID(e._rootNodeID,"value",""+r)}};t.exports=d},{158:158,23:23,24:24,45:45,70:70,93:93}],47:[function(e,t,n){var r=e(32),o=e(48),a=e(24),i=(e(168),o.valueContextKey),u={mountWrapper:function(e,t,n){var r=n[i],o=null;if(null!=r)if(o=!1,Array.isArray(r)){for(var a=0;a<r.length;a++)if(""+r[a]==""+t.value){o=!0;break}}else o=""+r==""+t.value;e._wrapperState={selected:o}},getNativeProps:function(e,t,n){var o=a({selected:void 0,children:void 0},t);null!=e._wrapperState.selected&&(o.selected=e._wrapperState.selected);var i="";return r.forEach(t.children,(function(e){null!=e&&("string"==typeof e||"number"==typeof e)&&(i+=e)})),o.children=i,o}};t.exports=u},{168:168,24:24,32:32,48:48}],48:[function(e,t,n){function r(){if(this._rootNodeID&&this._wrapperState.pendingUpdate){this._wrapperState.pendingUpdate=!1;var e=this._currentElement.props,t=i.getValue(e);null!=t&&o(this,e,t)}}function o(e,t,n){var r,o,a=u.getNode(e._rootNodeID).options;if(t){for(r={},o=0;o<n.length;o++)r[""+n[o]]=!0;for(o=0;o<a.length;o++){var i=r.hasOwnProperty(a[o].value);a[o].selected!==i&&(a[o].selected=i)}}else{for(r=""+n,o=0;o<a.length;o++)if(a[o].value===r)return void(a[o].selected=!0);a.length&&(a[0].selected=!0)}}function a(e){var t=this._currentElement.props,n=i.executeOnChange(t,e);return this._wrapperState.pendingUpdate=!0,s.asap(r,this),n}var i=e(23),u=e(70),s=e(93),l=e(24),c=(e(168),"__ReactDOMSelect_value$"+Math.random().toString(36).slice(2)),p={valueContextKey:c,getNativeProps:function(e,t,n){return l({},t,{onChange:e._wrapperState.onChange,value:void 0})},mountWrapper:function(e,t){var n=i.getValue(t);e._wrapperState={pendingUpdate:!1,initialValue:null!=n?n:t.defaultValue,onChange:a.bind(e),wasMultiple:Boolean(t.multiple)}},processChildContext:function(e,t,n){var r=l({},n);return r[c]=e._wrapperState.initialValue,r},postUpdateWrapper:function(e){var t=e._currentElement.props;e._wrapperState.initialValue=void 0;var n=e._wrapperState.wasMultiple;e._wrapperState.wasMultiple=Boolean(t.multiple);var r=i.getValue(t);null!=r?(e._wrapperState.pendingUpdate=!1,o(e,Boolean(t.multiple),r)):n!==Boolean(t.multiple)&&(null!=t.defaultValue?o(e,Boolean(t.multiple),t.defaultValue):o(e,Boolean(t.multiple),t.multiple?[]:""))}};t.exports=p},{168:168,23:23,24:24,70:70,93:93}],49:[function(e,t,n){function r(e,t,n,r){return e===n&&t===r}var s=e(144),l=e(127),c=e(128),p=s.canUseDOM&&"selection"in document&&!("getSelection"in window),d={getOffsets:p?function(e){var n=document.selection.createRange(),r=n.text.length,o=n.duplicate();o.moveToElementText(e),o.setEndPoint("EndToStart",n);var a=o.text.length;return{start:a,end:a+r}}:function(e){var t=window.getSelection&&window.getSelection();if(!t||0===t.rangeCount)return null;var n=t.anchorNode,o=t.anchorOffset,a=t.focusNode,i=t.focusOffset,u=t.getRangeAt(0);try{u.startContainer.nodeType,u.endContainer.nodeType}catch(s){return null}var c=r(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)?0:u.toString().length,p=u.cloneRange();p.selectNodeContents(e),p.setEnd(u.startContainer,u.startOffset);var f=r(p.startContainer,p.startOffset,p.endContainer,p.endOffset)?0:p.toString().length,h=f+c,v=document.createRange();v.setStart(n,o),v.setEnd(a,i);var m=v.collapsed;return{start:m?h:f,end:m?f:h}},setOffsets:p?function(e,t){var n,r,o=document.selection.createRange().duplicate();void 0===t.end?r=n=t.start:t.start>t.end?(n=t.end,r=t.start):(n=t.start,r=t.end),o.moveToElementText(e),o.moveStart("character",n),o.setEndPoint("EndToStart",o),o.moveEnd("character",r-n),o.select()}:function(e,t){if(window.getSelection){var n=window.getSelection(),r=e[c()].length,o=Math.min(t.start,r),a=void 0===t.end?o:Math.min(t.end,r);if(!n.extend&&o>a){var i=a;a=o,o=i}var u=l(e,o),s=l(e,a);if(u&&s){var p=document.createRange();p.setStart(u.node,u.offset),n.removeAllRanges(),o>a?(n.addRange(p),n.extend(s.node,s.offset)):(p.setEnd(s.node,s.offset),n.addRange(p))}}}};t.exports=d},{127:127,128:128,144:144}],50:[function(e,t,n){var r=e(54),o=e(86),a=e(94);r.inject();var i={renderToString:o.renderToString,renderToStaticMarkup:o.renderToStaticMarkup,version:a};t.exports=i},{54:54,86:86,94:94}],51:[function(e,t,n){var r=e(9),o=e(11),a=e(35),i=e(70),u=e(24),s=e(118),l=e(136),c=(e(141),function(e){});u(c.prototype,{construct:function(e){this._currentElement=e,this._stringText=""+e,this._rootNodeID=null,this._mountIndex=0},mountComponent:function(e,t,n){if(this._rootNodeID=e,t.useCreateElement){var a=n[i.ownerDocumentContextKey].createElement("span");return o.setAttributeForID(a,e),i.getID(a),l(a,this._stringText),a}var u=s(this._stringText);return t.renderToStaticMarkup?u:"<span "+o.createMarkupForID(e)+">"+u+"</span>"},receiveComponent:function(e,t){if(e!==this._currentElement){this._currentElement=e;var n=""+e;if(n!==this._stringText){this._stringText=n;var o=i.getNode(this._rootNodeID);r.updateTextContent(o,n)}}},unmountComponent:function(){a.unmountIDFromEnvironment(this._rootNodeID)}}),t.exports=c},{11:11,118:118,136:136,141:141,24:24,35:35,70:70,9:9}],52:[function(e,t,n){function r(){this._rootNodeID&&c.updateWrapper(this)}function o(e){var t=this._currentElement.props,n=a.executeOnChange(t,e);return u.asap(r,this),n}var a=e(23),i=e(45),u=e(93),s=e(24),l=e(158),c=(e(168),{getNativeProps:function(e,t,n){return null!=t.dangerouslySetInnerHTML&&l(!1),s({},t,{defaultValue:void 0,value:void 0,children:e._wrapperState.initialValue,onChange:e._wrapperState.onChange})},mountWrapper:function(e,t){var n=t.defaultValue,r=t.children;null!=r&&(null!=n&&l(!1),Array.isArray(r)&&(r.length<=1||l(!1),r=r[0]),n=""+r),null==n&&(n="");var i=a.getValue(t);e._wrapperState={initialValue:""+(null!=i?i:n),onChange:o.bind(e)}},updateWrapper:function(e){var t=e._currentElement.props,n=a.getValue(t);null!=n&&i.updatePropertyByID(e._rootNodeID,"value",""+n)}});t.exports=c},{158:158,168:168,23:23,24:24,45:45,93:93}],53:[function(e,t,n){function r(){this.reinitializeTransaction()}var o=e(93),a=e(110),i=e(24),u=e(150),s={initialize:u,close:function(){d.isBatchingUpdates=!1}},c=[{initialize:u,close:o.flushBatchedUpdates.bind(o)},s];i(r.prototype,a.Mixin,{getTransactionWrappers:function(){return c}});var p=new r,d={isBatchingUpdates:!1,batchedUpdates:function(e,t,n,r,o,a){var i=d.isBatchingUpdates;d.isBatchingUpdates=!0,i?e(t,n,r,o,a):p.perform(e,null,t,n,r,o,a)}};t.exports=d},{110:110,150:150,24:24,93:93}],54:[function(e,t,n){var o=e(3),a=e(7),i=e(8),u=e(13),s=e(14),l=e(144),c=e(21),p=e(27),d=e(35),f=e(53),h=e(42),v=e(51),m=e(61),g=e(63),y=e(65),C=e(70),b=e(81),E=e(96),_=e(97),x=e(98),D=e(95),P=!1;t.exports={inject:function(){P||(P=!0,g.EventEmitter.injectReactEventListener(m),g.EventPluginHub.injectEventPluginOrder(u),g.EventPluginHub.injectInstanceHandle(y),g.EventPluginHub.injectMount(C),g.EventPluginHub.injectEventPluginsByName({SimpleEventPlugin:x,EnterLeaveEventPlugin:s,ChangeEventPlugin:a,SelectEventPlugin:E,BeforeInputEventPlugin:o}),g.NativeComponent.injectGenericComponentClass(h),g.NativeComponent.injectTextComponentClass(v),g.Class.injectMixin(p),g.DOMProperty.injectDOMPropertyConfig(c),g.DOMProperty.injectDOMPropertyConfig(D),g.EmptyComponent.injectEmptyComponent("noscript"),g.Updates.injectReconcileTransaction(b),g.Updates.injectBatchingStrategy(f),g.RootIndex.injectCreateReactRootIndex(l.canUseDOM?i.createReactRootIndex:_.createReactRootIndex),g.Component.injectEnvironment(d))}}},{13:13,14:14,144:144,21:21,27:27,3:3,35:35,42:42,51:51,53:53,61:61,63:63,65:65,7:7,70:70,8:8,81:81,95:95,96:96,97:97,98:98}],55:[function(e,t,n){var r=e(39),o=e(24),a=(e(114),"function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103),i={key:!0,ref:!0,__self:!0,__source:!0},u=function(e,t,n,r,o,i,_u){return{$$typeof:a,type:e,key:t,ref:n,props:_u,_owner:i}};u.createElement=function(e,t,n){var o,a={},s=null,l=null;if(null!=t)for(o in l=void 0===t.ref?null:t.ref,s=void 0===t.key?null:""+t.key,void 0===t.__self?null:t.__self,void 0===t.__source?null:t.__source,t)t.hasOwnProperty(o)&&!i.hasOwnProperty(o)&&(a[o]=t[o]);var d=arguments.length-2;if(1===d)a.children=n;else if(d>1){for(var f=Array(d),h=0;d>h;h++)f[h]=arguments[h+2];a.children=f}if(e&&e.defaultProps){var v=e.defaultProps;for(o in v)void 0===a[o]&&(a[o]=v[o])}return u(e,s,l,0,0,r.current,a)},u.createFactory=function(e){var t=u.createElement.bind(null,e);return t.type=e,t},u.cloneAndReplaceKey=function(e,t){return u(e.type,t,e.ref,e._self,e._source,e._owner,e.props)},u.cloneAndReplaceProps=function(e,t){return u(e.type,e.key,e.ref,e._self,e._source,e._owner,t)},u.cloneElement=function(e,t,n){var a,s=o({},e.props),l=e.key,c=e.ref,f=(e._self,e._source,e._owner);if(null!=t)for(a in void 0!==t.ref&&(c=t.ref,f=r.current),void 0!==t.key&&(l=""+t.key),t)t.hasOwnProperty(a)&&!i.hasOwnProperty(a)&&(s[a]=t[a]);var h=arguments.length-2;if(1===h)s.children=n;else if(h>1){for(var v=Array(h),m=0;h>m;m++)v[m]=arguments[m+2];s.children=v}return u(e.type,l,c,0,0,f,s)},u.isValidElement=function(e){return"object"==_typeof(e)&&null!==e&&e.$$typeof===a},t.exports=u},{114:114,24:24,39:39}],56:[function(e,t,n){function r(){if(p.current){var e=p.current.getName();if(e)return" Check the render method of `"+e+"`."}return""}function o(e,t){e._store&&!e._store.validated&&null==e.key&&(e._store.validated=!0,function(e,t,n){var o=r();if(!o){var a="string"==typeof n?n:n.displayName||n.name;a&&(o=" Check the top-level render call using <"+a+">.")}var i=h[e]||(h[e]={});if(i[o])return null;i[o]=!0;var u={parentOrOwner:o,url:" See https://fb.me/react-warning-keys for more information.",childOwner:null};t&&t._owner&&t._owner!==p.current&&(u.childOwner=" It was passed a child from "+t._owner.getName()+".")}("uniqueKey",e,t))}function i(e,t){if("object"==_typeof(e))if(Array.isArray(e))for(var n=0;n<e.length;n++){var r=e[n];l.isValidElement(r)&&o(r,t)}else if(l.isValidElement(e))e._store&&(e._store.validated=!0);else if(e){var a=d(e);if(a&&a!==e.entries)for(var i,u=a.call(e);!(i=u.next()).done;)l.isValidElement(i.value)&&o(i.value,t)}}function s(e){var t=e.type;if("function"==typeof t){var n=t.displayName||t.name;t.propTypes&&function(e,t,n,o){for(var a in t)if(t.hasOwnProperty(a)){var i;try{"function"!=typeof t[a]&&f(!1),i=t[a](n,a,e,o)}catch(u){i=u}i instanceof Error&&!(i.message in v)&&(v[i.message]=!0,r())}}(n,t.propTypes,e.props,c.prop),t.getDefaultProps}}var l=e(55),c=e(79),p=(e(78),e(39)),d=(e(114),e(126)),f=e(158),h=(e(168),{}),v={},m={createElement:function(e,t,n){var r="string"==typeof e||"function"==typeof e,o=l.createElement.apply(this,arguments);if(null==o)return o;if(r)for(var a=2;a<arguments.length;a++)i(arguments[a],e);return s(o),o},createFactory:function(e){var t=m.createElement.bind(null,e);return t.type=e,t},cloneElement:function(e,t,n){for(var r=l.cloneElement.apply(this,arguments),o=2;o<arguments.length;o++)i(arguments[o],r.type);return s(r),r}};t.exports=m},{114:114,126:126,158:158,168:168,39:39,55:55,78:78,79:79}],57:[function(e,t,n){var r,o=e(55),a=e(58),i=e(82),s={injectEmptyComponent:function(e){r=o.createElement(e)}},l=function(e){this._currentElement=null,this._rootNodeID=null,this._renderedComponent=e(r)};e(24)(l.prototype,{construct:function(e){},mountComponent:function(e,t,n){return a.registerNullComponentID(e),this._rootNodeID=e,i.mountComponent(this._renderedComponent,e,t,n)},receiveComponent:function(){},unmountComponent:function(e,t,n){i.unmountComponent(this._renderedComponent),a.deregisterNullComponentID(this._rootNodeID),this._rootNodeID=null,this._renderedComponent=null}}),l.injection=s,t.exports=l},{24:24,55:55,58:58,82:82}],58:[function(e,t,n){var i={},u={isNullComponentID:function(e){return!!i[e]},registerNullComponentID:function(e){i[e]=!0},deregisterNullComponentID:function(e){delete i[e]}};t.exports=u},{}],59:[function(e,t,n){function r(e,t,n,r){try{return t(n,r)}catch(a){return void(null===o&&(o=a))}}var o=null,a={invokeGuardedCallback:r,invokeGuardedCallbackWithCatch:r,rethrowCaughtError:function(){if(o){var e=o;throw o=null,e}}};t.exports=a},{}],60:[function(e,t,n){var o=e(16),a={handleTopLevel:function(e,t,n,a,i){!function(e){o.enqueueEvents(e),o.processEventQueue(!1)}(o.extractEvents(e,t,n,a,i))}};t.exports=a},{16:16}],61:[function(e,t,n){function r(e){var t=d.getID(e),n=p.getReactRootIDFromNodeID(t),r=d.findReactContainerForID(n);return d.getFirstReactDOM(r)}function o(e,t){this.topLevelType=e,this.nativeEvent=t,this.ancestors=[]}function a(e){!function(e){for(var t=d.getFirstReactDOM(v(e.nativeEvent))||window,n=t;n;)e.ancestors.push(n),n=r(n);for(var o=0;o<e.ancestors.length;o++){t=e.ancestors[o];var a=d.getID(t)||"";g._handleTopLevel(e.topLevelType,t,a,e.nativeEvent,v(e.nativeEvent))}}(e)}function u(e){e(m(window))}var s=e(143),l=e(144),c=e(25),p=e(65),d=e(70),f=e(93),h=e(24),v=e(125),m=e(155);h(o.prototype,{destructor:function(){this.topLevelType=null,this.nativeEvent=null,this.ancestors.length=0}}),c.addPoolingTo(o,c.twoArgumentPooler);var g={_enabled:!0,_handleTopLevel:null,WINDOW_HANDLE:l.canUseDOM?window:null,setHandleTopLevel:function(e){g._handleTopLevel=e},setEnabled:function(e){g._enabled=!!e},isEnabled:function(){return g._enabled},trapBubbledEvent:function(e,t,n){var r=n;return r?s.listen(r,t,g.dispatchEvent.bind(null,e)):null},trapCapturedEvent:function(e,t,n){var r=n;return r?s.capture(r,t,g.dispatchEvent.bind(null,e)):null},monitorScrollValue:function(e){var t=u.bind(null,e);s.listen(window,"scroll",t)},dispatchEvent:function(e,t){if(g._enabled){var n=o.getPooled(e,t);try{f.batchedUpdates(a,n)}finally{o.release(n)}}}};t.exports=g},{125:125,143:143,144:144,155:155,24:24,25:25,65:65,70:70,93:93}],62:[function(e,t,n){var r=e(32),o=e(55),a=e(150),i=e(158),u=(e(168),{create:function(e){if("object"!=_typeof(e)||!e||Array.isArray(e))return e;if(o.isValidElement(e))return e;1===e.nodeType&&i(!1);var t=[];for(var n in e)r.mapIntoWithKeyPrefixInternal(e[n],t,n,a.thatReturnsArgument);return t}});t.exports=u},{150:150,158:158,168:168,32:32,55:55}],63:[function(e,t,n){var r=e(10),o=e(16),a=e(36),i=e(33),u=e(57),s=e(28),l=e(73),c=e(76),p=e(84),d=e(93),f={Component:a.injection,Class:i.injection,DOMProperty:r.injection,EmptyComponent:u.injection,EventPluginHub:o.injection,EventEmitter:s.injection,NativeComponent:l.injection,Perf:c.injection,RootIndex:p.injection,Updates:d.injection};t.exports=f},{10:10,16:16,28:28,33:33,36:36,57:57,73:73,76:76,84:84,93:93}],64:[function(e,t,n){var o=e(49),a=e(147),i=e(152),u=e(153),s={hasSelectionCapabilities:function(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&"text"===e.type||"textarea"===t||"true"===e.contentEditable)},getSelectionInformation:function(){var e=u();return{focusedElem:e,selectionRange:s.hasSelectionCapabilities(e)?s.getSelection(e):null}},restoreSelection:function(e){var t=u(),n=e.focusedElem,o=e.selectionRange;t!==n&&function(e){return a(document.documentElement,e)}(n)&&(s.hasSelectionCapabilities(n)&&s.setSelection(n,o),i(n))},getSelection:function(e){var t;if("selectionStart"in e)t={start:e.selectionStart,end:e.selectionEnd};else if(document.selection&&e.nodeName&&"input"===e.nodeName.toLowerCase()){var n=document.selection.createRange();n.parentElement()===e&&(t={start:-n.moveStart("character",-e.value.length),end:-n.moveEnd("character",-e.value.length)})}else t=o.getOffsets(e);return t||{start:0,end:0}},setSelection:function(e,t){var n=t.start,r=t.end;if(void 0===r&&(r=n),"selectionStart"in e)e.selectionStart=n,e.selectionEnd=Math.min(r,e.value.length);else if(document.selection&&e.nodeName&&"input"===e.nodeName.toLowerCase()){var a=e.createTextRange();a.collapse(!0),a.moveStart("character",n),a.moveEnd("character",r-n),a.select()}else o.setOffsets(e,t)}};t.exports=s},{147:147,152:152,153:153,49:49}],65:[function(e,t,n){function o(e,t){return e.charAt(t)===f||t===e.length}function a(e){return""===e||e.charAt(0)===f&&e.charAt(e.length-1)!==f}function i(e,t){return 0===t.indexOf(e)&&o(t,e.length)}function u(e){return e?e.substr(0,e.lastIndexOf(f)):""}function s(e,t){if(a(e)&&a(t)||d(!1),i(e,t)||d(!1),e===t)return e;var n;for(n=e.length+h;n<t.length&&!o(t,n);n++);return t.substr(0,n)}function l(e,t){var n=Math.min(e.length,t.length);if(0===n)return"";for(var r=0,i=0;n>=i;i++)if(o(e,i)&&o(t,i))r=i;else if(e.charAt(i)!==t.charAt(i))break;var u=e.substr(0,r);return a(u)||d(!1),u}function c(e,t,n,r,o,a){(e=e||"")===(t=t||"")&&d(!1);var l=i(t,e);l||i(e,t)||d(!1);for(var c=0,p=l?u:s,f=e;;f=p(f,t)){var h;if(o&&f===e||a&&f===t||(h=n(f,l,r)),!1===h||f===t)break;c++<v||d(!1)}}var p=e(84),d=e(158),f=".",h=f.length,v=1e4,m={createReactRootID:function(){return function(e){return f+e.toString(36)}(p.createReactRootIndex())},createReactID:function(e,t){return e+t},getReactRootIDFromNodeID:function(e){if(e&&e.charAt(0)===f&&e.length>1){var t=e.indexOf(f,1);return t>-1?e.substr(0,t):e}return null},traverseEnterLeave:function(e,t,n,r,o){var a=l(e,t);a!==e&&c(e,a,n,r,!1,!0),a!==t&&c(a,t,n,o,!0,!1)},traverseTwoPhase:function(e,t,n){e&&(c("",e,t,n,!0,!1),c(e,"",t,n,!1,!0))},traverseTwoPhaseSkipTarget:function(e,t,n){e&&(c("",e,t,n,!0,!0),c(e,"",t,n,!0,!0))},traverseAncestors:function(e,t,n){c("",e,t,n,!0,!1)},getFirstCommonAncestorID:l,_getNextDescendantID:s,isAncestorIDOf:i,SEPARATOR:f};t.exports=m},{158:158,84:84}],66:[function(e,t,n){t.exports={remove:function(e){e._reactInternalInstance=void 0},get:function(e){return e._reactInternalInstance},has:function(e){return void 0!==e._reactInternalInstance},set:function(e,t){e._reactInternalInstance=t}}},{}],67:[function(e,t,n){var r=e(32),o=e(34),a=e(33),i=e(43),u=e(55),s=(e(56),e(80)),l=e(94),c=e(24),p=e(132),d=u.createElement,f=u.createFactory,h=u.cloneElement,v={Children:{map:r.map,forEach:r.forEach,count:r.count,toArray:r.toArray,only:p},Component:o,createElement:d,cloneElement:h,isValidElement:u.isValidElement,PropTypes:s,createClass:a.createClass,createFactory:f,createMixin:function(e){return e},DOM:i,version:l,__spread:c};t.exports=v},{132:132,24:24,32:32,33:33,34:34,43:43,55:55,56:56,80:80,94:94}],68:[function(e,t,n){function r(e,t){this.value=e,this.requestChange=t}var a=e(26);r.PropTypes={link:function(e){var t={value:void 0===e?a.PropTypes.any.isRequired:e.isRequired,requestChange:a.PropTypes.func.isRequired};return a.PropTypes.shape(t)}},t.exports=r},{26:26}],69:[function(e,t,n){var r=e(113),o=/\/?>/,a={CHECKSUM_ATTR_NAME:"data-react-checksum",addChecksumToMarkup:function(e){var t=r(e);return e.replace(o," "+a.CHECKSUM_ATTR_NAME+'="'+t+'"$&')},canReuseMarkup:function(e,t){var n=t.getAttribute(a.CHECKSUM_ATTR_NAME);return n=n&&parseInt(n,10),r(e)===n}};t.exports=a},{113:113}],70:[function(e,t,n){function o(e){return e?e.nodeType===W?e.documentElement:e.firstChild:null}function a(e){var t=o(e);return t&&X.getID(t)}function u(e){return e&&e.getAttribute&&e.getAttribute(B)||""}function p(e,t){if(e){u(e)!==t&&L(!1);var n=X.findReactContainerForID(t);if(n&&O(n,e))return!0}return!1}function f(e){var t=V[e];return!(!t||!p(t,e))&&void(G=t)}function v(e,t,n,r,o,a){_.useCreateElement&&(a=I({},a),n.nodeType===W?a[q]=n:a[q]=n.ownerDocument);var i=w.mountComponent(e,t,r,a);e._renderedComponent._topLevelWrapper=e,X._mountImageIntoNode(i,n,o,r)}function m(e,t,n,r,o){var a=R.ReactReconcileTransaction.getPooled(r);a.perform(v,null,e,t,n,a,r,o),R.ReactReconcileTransaction.release(a)}function g(e,t){for(w.unmountComponent(e),t.nodeType===W&&(t=t.documentElement);t.lastChild;)t.removeChild(t.lastChild)}function y(e){var t=a(e);return!!t&&t!==P.getReactRootIDFromNodeID(t)}var b=e(10),E=e(28),_=(e(39),e(44)),x=e(55),D=e(58),P=e(65),T=e(66),M=e(69),N=e(76),w=e(82),S=e(92),R=e(93),I=e(24),k=e(151),O=e(147),A=e(129),L=e(158),U=e(135),F=e(138),B=(e(141),e(168),b.ID_ATTRIBUTE_NAME),V={},W=9,q="__ReactMount_ownerDocument$"+Math.random().toString(36).slice(2),H={},z={},Y=[],G=null,Q=function(){};Q.prototype.isReactComponent={},Q.prototype.render=function(){return this.props};var X={TopLevelWrapper:Q,_instancesByReactRootID:H,scrollMonitor:function(e,t){t()},_updateRootComponent:function(e,t,n,r){return X.scrollMonitor(n,(function(){S.enqueueElementInternal(e,t),r&&S.enqueueCallbackInternal(e,r)})),e},_registerComponent:function(e,t){(!t||1!==t.nodeType&&t.nodeType!==W&&11!==t.nodeType)&&L(!1),E.ensureScrollValueMonitoring();var n=X.registerContainer(t);return H[n]=e,n},_renderNewRootComponent:function(e,t,n,r){var o=A(e,null),a=X._registerComponent(o,t);return R.batchedUpdates(m,o,a,t,n,r),o},renderSubtreeIntoContainer:function(e,t,n,r){return(null==e||null==e._reactInternalInstance)&&L(!1),X._renderSubtreeIntoContainer(e,t,n,r)},_renderSubtreeIntoContainer:function(e,t,n,r){x.isValidElement(t)||L(!1);var i=new x(Q,null,null,null,null,null,t),s=H[a(n)];if(s){var c=s._currentElement.props;if(F(c,t)){var p=s._renderedComponent.getPublicInstance(),d=r&&function(){r.call(p)};return X._updateRootComponent(s,i,n,d),p}X.unmountComponentAtNode(n)}var f=o(n),h=f&&!!u(f),v=y(n),m=h&&!s&&!v,g=X._renderNewRootComponent(i,n,m,null!=e?e._reactInternalInstance._processChildContext(e._reactInternalInstance._context):k)._renderedComponent.getPublicInstance();return r&&r.call(g),g},render:function(e,t,n){return X._renderSubtreeIntoContainer(null,e,t,n)},registerContainer:function(e){var t=a(e);return t&&(t=P.getReactRootIDFromNodeID(t)),t||(t=P.createReactRootID()),z[t]=e,t},unmountComponentAtNode:function(e){(!e||1!==e.nodeType&&e.nodeType!==W&&11!==e.nodeType)&&L(!1);var t=a(e),n=H[t];if(!n){var r=(y(e),u(e));return r&&P.getReactRootIDFromNodeID(r),!1}return R.batchedUpdates(g,n,e),delete H[t],delete z[t],!0},findReactContainerForID:function(e){var t=P.getReactRootIDFromNodeID(e);return z[t]},findReactNodeByID:function(e){var t=X.findReactContainerForID(e);return X.findComponentRoot(t,e)},getFirstReactDOM:function(e){return function(e){for(;e&&e.parentNode!==e;e=e.parentNode)if(1===e.nodeType){var t=u(e);if(t){var n,r=P.getReactRootIDFromNodeID(t),o=e;do{if(n=u(o),null==(o=o.parentNode))return null}while(n!==r);if(o===z[r])return e}}return null}(e)},findComponentRoot:function(e,t){var n=Y,r=0,o=function(e){G=null,P.traverseAncestors(e,f);var t=G;return G=null,t}(t)||e;for(n[0]=o.firstChild,n.length=1;r<n.length;){for(var a,i=n[r++];i;){var u=X.getID(i);u?t===u?a=i:P.isAncestorIDOf(u,t)&&(n.length=r=0,n.push(i.firstChild)):n.push(i.firstChild),i=i.nextSibling}if(a)return n.length=0,a}n.length=0,L(!1)},_mountImageIntoNode:function(e,t,n,a){if((!t||1!==t.nodeType&&t.nodeType!==W&&11!==t.nodeType)&&L(!1),n){var i=o(t);if(M.canReuseMarkup(e,i))return;var u=i.getAttribute(M.CHECKSUM_ATTR_NAME);i.removeAttribute(M.CHECKSUM_ATTR_NAME);var s=i.outerHTML;i.setAttribute(M.CHECKSUM_ATTR_NAME,u);var l=e,c=function(e,t){for(var n=Math.min(e.length,t.length),r=0;n>r;r++)if(e.charAt(r)!==t.charAt(r))return r;return e.length===t.length?-1:n}(l,s);l.substring(c-20,c+20),s.substring(c-20,c+20),t.nodeType===W&&L(!1)}if(t.nodeType===W&&L(!1),a.useCreateElement){for(;t.lastChild;)t.removeChild(t.lastChild);t.appendChild(e)}else U(t,e)},ownerDocumentContextKey:q,getReactRootID:a,getID:function(e){var t=u(e);if(t)if(V.hasOwnProperty(t)){var n=V[t];n!==e&&(p(n,t)&&L(!1),V[t]=e)}else V[t]=e;return t},setID:function(e,t){var n=u(e);n!==t&&delete V[n],e.setAttribute(B,t),V[t]=e},getNode:function(e){return V.hasOwnProperty(e)&&p(V[e],e)||(V[e]=X.findReactNodeByID(e)),V[e]},getNodeFromInstance:function(e){var t=T.get(e)._rootNodeID;return D.isNullComponentID(t)?null:(V.hasOwnProperty(t)&&p(V[t],t)||(V[t]=X.findReactNodeByID(t)),V[t])},isValid:p,purgeID:function(e){delete V[e]}};N.measureMethods(X,"ReactMount",{_renderNewRootComponent:"_renderNewRootComponent",_mountImageIntoNode:"_mountImageIntoNode"}),t.exports=X},{10:10,129:129,135:135,138:138,141:141,147:147,151:151,158:158,168:168,24:24,28:28,39:39,44:44,55:55,58:58,65:65,66:66,69:69,76:76,82:82,92:92,93:93}],71:[function(e,t,n){function s(){m.length&&(c.processChildrenUpdates(m,g),l())}function l(){m.length=0,g.length=0}var c=e(36),p=e(72),d=(e(39),e(82)),f=e(31),h=e(120),v=0,m=[],g=[],y={Mixin:{_reconcilerInstantiateChildren:function(e,t,n){return f.instantiateChildren(e,t,n)},_reconcilerUpdateChildren:function(e,t,n,r){var o;return o=h(t),f.updateChildren(e,o,n,r)},mountChildren:function(e,t,n){var r=this._reconcilerInstantiateChildren(e,t,n);this._renderedChildren=r;var o=[],a=0;for(var i in r)if(r.hasOwnProperty(i)){var u=r[i],s=this._rootNodeID+i,l=d.mountComponent(u,s,t,n);u._mountIndex=a++,o.push(l)}return o},updateTextContent:function(e){v++;var t=!0;try{var n=this._renderedChildren;for(var r in f.unmountChildren(n),n)n.hasOwnProperty(r)&&this._unmountChild(n[r]);this.setTextContent(e),t=!1}finally{--v||(t?l():s())}},updateMarkup:function(e){v++;var t=!0;try{var n=this._renderedChildren;for(var r in f.unmountChildren(n),n)n.hasOwnProperty(r)&&this._unmountChildByName(n[r],r);this.setMarkup(e),t=!1}finally{--v||(t?l():s())}},updateChildren:function(e,t,n){v++;var r=!0;try{this._updateChildren(e,t,n),r=!1}finally{--v||(r?l():s())}},_updateChildren:function(e,t,n){var r=this._renderedChildren,o=this._reconcilerUpdateChildren(r,e,t,n);if(this._renderedChildren=o,o||r){var a,i=0,u=0;for(a in o)if(o.hasOwnProperty(a)){var s=r&&r[a],l=o[a];s===l?(this.moveChild(s,u,i),i=Math.max(s._mountIndex,i),s._mountIndex=u):(s&&(i=Math.max(s._mountIndex,i),this._unmountChild(s)),this._mountChildByNameAtIndex(l,a,u,t,n)),u++}for(a in r)!r.hasOwnProperty(a)||o&&o.hasOwnProperty(a)||this._unmountChild(r[a])}},unmountChildren:function(){var e=this._renderedChildren;f.unmountChildren(e),this._renderedChildren=null},moveChild:function(e,t,n){e._mountIndex<n&&function(e,t,n){m.push({parentID:e,parentNode:null,type:p.MOVE_EXISTING,markupIndex:null,content:null,fromIndex:t,toIndex:n})}(this._rootNodeID,e._mountIndex,t)},createChild:function(e,t){!function(e,t,n){m.push({parentID:e,parentNode:null,type:p.INSERT_MARKUP,markupIndex:g.push(t)-1,content:null,fromIndex:null,toIndex:n})}(this._rootNodeID,t,e._mountIndex)},removeChild:function(e){!function(e,t){m.push({parentID:e,parentNode:null,type:p.REMOVE_NODE,markupIndex:null,content:null,fromIndex:t,toIndex:null})}(this._rootNodeID,e._mountIndex)},setTextContent:function(e){!function(e,t){m.push({parentID:e,parentNode:null,type:p.TEXT_CONTENT,markupIndex:null,content:t,fromIndex:null,toIndex:null})}(this._rootNodeID,e)},setMarkup:function(e){!function(e,t){m.push({parentID:e,parentNode:null,type:p.SET_MARKUP,markupIndex:null,content:t,fromIndex:null,toIndex:null})}(this._rootNodeID,e)},_mountChildByNameAtIndex:function(e,t,n,r,o){var a=this._rootNodeID+t,i=d.mountComponent(e,a,r,o);e._mountIndex=n,this.createChild(e,i)},_unmountChild:function(e){this.removeChild(e),e._mountIndex=null}}};t.exports=y},{120:120,31:31,36:36,39:39,72:72,82:82}],72:[function(e,t,n){var o=e(162)({INSERT_MARKUP:null,MOVE_EXISTING:null,REMOVE_NODE:null,SET_MARKUP:null,TEXT_CONTENT:null});t.exports=o},{162:162}],73:[function(e,t,n){var u=e(24),s=e(158),l=null,c=null,p={},d=null,f={injectGenericComponentClass:function(e){c=e},injectTextComponentClass:function(e){d=e},injectComponentClasses:function(e){u(p,e)}},h={getComponentClassForElement:function(e){if("function"==typeof e.type)return e.type;var t=e.type,n=p[t];return null==n&&(p[t]=n=l(t)),n},createInternalComponent:function(e){return c||s(!1),new c(e.type,e.props)},createInstanceForText:function(e){return new d(e)},isTextComponent:function(e){return e instanceof d},injection:f};t.exports=h},{158:158,24:24}],74:[function(e,t,n){var o=(e(168),{isMounted:function(e){return!1},enqueueCallback:function(e,t){},enqueueForceUpdate:function(e){},enqueueReplaceState:function(e,t){},enqueueSetState:function(e,t){},enqueueSetProps:function(e,t){},enqueueReplaceProps:function(e,t){}});t.exports=o},{168:168}],75:[function(e,t,n){var r=e(158),o={isValidOwner:function(e){return!(!e||"function"!=typeof e.attachRef||"function"!=typeof e.detachRef)},addComponentAsRefTo:function(e,t,n){o.isValidOwner(n)||r(!1),n.attachRef(t,e)},removeComponentAsRefFrom:function(e,t,n){o.isValidOwner(n)||r(!1),n.getPublicInstance().refs[t]===e.getPublicInstance()&&n.detachRef(t)}};t.exports=o},{158:158}],76:[function(e,t,n){var o={enableMeasure:!1,storedMeasure:function(e,t,n){return n},measureMethods:function(e,t,n){},measure:function(e,t,n){return n},injection:{injectMeasure:function(e){o.storedMeasure=e}}};t.exports=o},{}],77:[function(e,t,n){function r(e){return function(t,n,r){t.hasOwnProperty(n)?t[n]=e(t[n],r):t[n]=r}}var a=e(24),i=e(150),u=e(161),s=r((function(e,t){return a({},t,e)})),l={children:i,className:r(u),style:s},c={mergeProps:function(e,t){return function(e,t){for(var n in t)if(t.hasOwnProperty(n)){var r=l[n];r&&l.hasOwnProperty(n)?r(e,n,t[n]):e.hasOwnProperty(n)||(e[n]=t[n])}return e}(a({},e),t)}};t.exports=c},{150:150,161:161,24:24}],78:[function(e,t,n){t.exports={}},{}],79:[function(e,t,n){var o=e(162)({prop:null,context:null,childContext:null});t.exports=o},{162:162}],80:[function(e,t,n){function r(e){function t(t,n,r,o,a,i){if(o=o||_,i=i||r,null==n[r]){var u=C[a];return t?new Error("Required "+u+" `"+i+"` was not specified in `"+o+"`."):null}return e(n,r,o,a,i)}var n=t.bind(null,!1);return n.isRequired=t.bind(null,!0),n}function o(e){return r((function(t,n,r,o,a){var i=t[n];if(v(i)!==e){var s=C[o],l=function(e){var t=v(e);if("object"===t){if(e instanceof Date)return"date";if(e instanceof RegExp)return"regexp"}return t}(i);return new Error("Invalid "+s+" `"+a+"` of type `"+l+"` supplied to `"+r+"`, expected `"+e+"`.")}return null}))}function h(e){switch(_typeof(e)){case"number":case"string":case"undefined":return!0;case"boolean":return!e;case"object":if(Array.isArray(e))return e.every(h);if(null===e||y.isValidElement(e))return!0;var t=E(e);if(!t)return!1;var n,r=t.call(e);if(t!==e.entries){for(;!(n=r.next()).done;)if(!h(n.value))return!1}else for(;!(n=r.next()).done;){var o=n.value;if(o&&!h(o[1]))return!1}return!0;default:return!1}}function v(e){var t=_typeof(e);return Array.isArray(e)?"array":e instanceof RegExp?"object":t}var y=e(55),C=e(78),b=e(150),E=e(126),_="<<anonymous>>",x={array:o("array"),bool:o("boolean"),func:o("function"),number:o("number"),object:o("object"),string:o("string"),any:r(b.thatReturns(null)),arrayOf:function(e){return r((function(t,n,r,o,a){var i=t[n];if(!Array.isArray(i)){var u=C[o],s=v(i);return new Error("Invalid "+u+" `"+a+"` of type `"+s+"` supplied to `"+r+"`, expected an array.")}for(var l=0;l<i.length;l++){var c=e(i,l,r,o,a+"["+l+"]");if(c instanceof Error)return c}return null}))},element:r((function(e,t,n,r,o){if(!y.isValidElement(e[t])){var a=C[r];return new Error("Invalid "+a+" `"+o+"` supplied to `"+n+"`, expected a single ReactElement.")}return null})),instanceOf:function(e){return r((function(t,n,r,o,a){if(!(t[n]instanceof e)){var i=C[o],u=e.name||_,s=function(e){return e.constructor&&e.constructor.name?e.constructor.name:"<<anonymous>>"}(t[n]);return new Error("Invalid "+i+" `"+a+"` of type `"+s+"` supplied to `"+r+"`, expected instance of `"+u+"`.")}return null}))},node:r((function(e,t,n,r,o){if(!h(e[t])){var a=C[r];return new Error("Invalid "+a+" `"+o+"` supplied to `"+n+"`, expected a ReactNode.")}return null})),objectOf:function(e){return r((function(t,n,r,o,a){var i=t[n],u=v(i);if("object"!==u){var s=C[o];return new Error("Invalid "+s+" `"+a+"` of type `"+u+"` supplied to `"+r+"`, expected an object.")}for(var l in i)if(i.hasOwnProperty(l)){var c=e(i,l,r,o,a+"."+l);if(c instanceof Error)return c}return null}))},oneOf:function(e){return r(Array.isArray(e)?function(t,n,r,o,a){for(var i=t[n],u=0;u<e.length;u++)if(i===e[u])return null;var s=C[o],l=JSON.stringify(e);return new Error("Invalid "+s+" `"+a+"` of value `"+i+"` supplied to `"+r+"`, expected one of "+l+".")}:function(){return new Error("Invalid argument supplied to oneOf, expected an instance of array.")})},oneOfType:function(e){return r(Array.isArray(e)?function(t,n,r,o,a){for(var i=0;i<e.length;i++){if(null==(0,e[i])(t,n,r,o,a))return null}var s=C[o];return new Error("Invalid "+s+" `"+a+"` supplied to `"+r+"`.")}:function(){return new Error("Invalid argument supplied to oneOfType, expected an instance of array.")})},shape:function(e){return r((function(t,n,r,o,a){var i=t[n],u=v(i);if("object"!==u){var s=C[o];return new Error("Invalid "+s+" `"+a+"` of type `"+u+"` supplied to `"+r+"`, expected `object`.")}for(var l in e){var c=e[l];if(c){var p=c(i,l,r,o,a+"."+l);if(p)return p}}return null}))}};t.exports=x},{126:126,150:150,55:55,78:78}],81:[function(e,t,n){function r(e){this.reinitializeTransaction(),this.renderToStaticMarkup=!1,this.reactMountReady=o.getPooled(null),this.useCreateElement=!e&&u.useCreateElement}var o=e(6),a=e(25),i=e(28),u=e(44),s=e(64),l=e(110),c=e(24),d={initialize:function(){var e=i.isEnabled();return i.setEnabled(!1),e},close:function(e){i.setEnabled(e)}},h=[{initialize:s.getSelectionInformation,close:s.restoreSelection},d,{initialize:function(){this.reactMountReady.reset()},close:function(){this.reactMountReady.notifyAll()}}],v={getTransactionWrappers:function(){return h},getReactMountReady:function(){return this.reactMountReady},destructor:function(){o.release(this.reactMountReady),this.reactMountReady=null}};c(r.prototype,l.Mixin,v),a.addPoolingTo(r),t.exports=r},{110:110,24:24,25:25,28:28,44:44,6:6,64:64}],82:[function(e,t,n){function r(){o.attachRefs(this,this._currentElement)}var o=e(83),a={mountComponent:function(e,t,n,o){var a=e.mountComponent(t,n,o);return e._currentElement&&null!=e._currentElement.ref&&n.getReactMountReady().enqueue(r,e),a},unmountComponent:function(e){o.detachRefs(e,e._currentElement),e.unmountComponent()},receiveComponent:function(e,t,n,a){var i=e._currentElement;if(t!==i||a!==e._context){var u=o.shouldUpdateRefs(i,t);u&&o.detachRefs(e,i),e.receiveComponent(t,n,a),u&&e._currentElement&&null!=e._currentElement.ref&&n.getReactMountReady().enqueue(r,e)}},performUpdateIfNecessary:function(e,t){e.performUpdateIfNecessary(t)}};t.exports=a},{83:83}],83:[function(e,t,n){var a=e(75),i={};i.attachRefs=function(e,t){if(null!==t&&!1!==t){var n=t.ref;null!=n&&function(e,t,n){"function"==typeof e?e(t.getPublicInstance()):a.addComponentAsRefTo(t,e,n)}(n,e,t._owner)}},i.shouldUpdateRefs=function(e,t){return null===e||!1===e||(null===t||!1===t)||t._owner!==e._owner||t.ref!==e.ref},i.detachRefs=function(e,t){if(null!==t&&!1!==t){var n=t.ref;null!=n&&function(e,t,n){"function"==typeof e?e(null):a.removeComponentAsRefFrom(t,e,n)}(n,e,t._owner)}},t.exports=i},{75:75}],84:[function(e,t,n){var r={injectCreateReactRootIndex:function(e){o.createReactRootIndex=e}},o={createReactRootIndex:null,injection:r};t.exports=o},{}],85:[function(e,t,n){t.exports={isBatchingUpdates:!1,batchedUpdates:function(e){}}},{}],86:[function(e,t,n){var a=e(53),i=e(55),u=e(65),s=e(69),l=e(85),c=e(87),p=e(93),d=e(151),f=e(129),h=e(158);t.exports={renderToString:function(e){var t;i.isValidElement(e)||h(!1);try{p.injection.injectBatchingStrategy(l);var n=u.createReactRootID();return(t=c.getPooled(!1)).perform((function(){var o=f(e,null).mountComponent(n,t,d);return s.addChecksumToMarkup(o)}),null)}finally{c.release(t),p.injection.injectBatchingStrategy(a)}},renderToStaticMarkup:function(e){var t;i.isValidElement(e)||h(!1);try{p.injection.injectBatchingStrategy(l);var n=u.createReactRootID();return(t=c.getPooled(!0)).perform((function(){return f(e,null).mountComponent(n,t,d)}),null)}finally{c.release(t),p.injection.injectBatchingStrategy(a)}}}},{129:129,151:151,158:158,53:53,55:55,65:65,69:69,85:85,87:87,93:93}],87:[function(e,t,n){function r(e){this.reinitializeTransaction(),this.renderToStaticMarkup=e,this.reactMountReady=a.getPooled(null),this.useCreateElement=!1}var o=e(25),a=e(6),i=e(110),u=e(24),c=[{initialize:function(){this.reactMountReady.reset()},close:e(150)}],p={getTransactionWrappers:function(){return c},getReactMountReady:function(){return this.reactMountReady},destructor:function(){a.release(this.reactMountReady),this.reactMountReady=null}};u(r.prototype,i.Mixin,p),o.addPoolingTo(r),t.exports=r},{110:110,150:150,24:24,25:25,6:6}],88:[function(e,t,n){var o={createStateSetter:function(e,t){return function(n,r,o,a,i,u){var s=t.call(e,n,r,o,a,i,u);s&&e.setState(s)}},createStateKeySetter:function(e,t){var n=e.__keySetters||(e.__keySetters={});return n[t]||(n[t]=function(e,t){var n={};return function(r){n[t]=r,e.setState(n)}}(e,t))}};o.Mixin={createStateSetter:function(e){return o.createStateSetter(this,e)},createStateKeySetter:function(e){return o.createStateKeySetter(this,e)}},t.exports=o},{}],89:[function(e,t,n){var r=e(120),o={getChildMapping:function(e){return e?r(e):e},mergeChildMappings:function(e,t){function n(n){return t.hasOwnProperty(n)?t[n]:e[n]}e=e||{},t=t||{};var r={},o=[];for(var a in e)t.hasOwnProperty(a)?o.length&&(r[a]=o,o=[]):o.push(a);var i,u={};for(var s in t){if(r.hasOwnProperty(s))for(i=0;i<r[s].length;i++){var l=r[s][i];u[r[s][i]]=n(l)}u[s]=n(s)}for(i=0;i<o.length;i++)u[o[i]]=n(o[i]);return u}};t.exports=o},{120:120}],90:[function(e,t,n){var i=e(144),u={transitionend:{transition:"transitionend",WebkitTransition:"webkitTransitionEnd",MozTransition:"mozTransitionEnd",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd"},animationend:{animation:"animationend",WebkitAnimation:"webkitAnimationEnd",MozAnimation:"mozAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd"}},s=[];i.canUseDOM&&function(){var t=document.createElement("div").style;for(var n in"AnimationEvent"in window||delete u.animationend.animation,"TransitionEvent"in window||delete u.transitionend.transition,u){var r=u[n];for(var o in r)if(o in t){s.push(r[o]);break}}}();var l={addEndEventListener:function(e,t){return 0===s.length?void window.setTimeout(t,0):void s.forEach((function(n){!function(e,t,n){e.addEventListener(t,n,!1)}(e,n,t)}))},removeEndEventListener:function(e,t){0!==s.length&&s.forEach((function(n){!function(e,t,n){e.removeEventListener(t,n,!1)}(e,n,t)}))}};t.exports=l},{144:144}],91:[function(e,t,n){var r=e(26),o=e(89),a=e(24),i=e(150),u=r.createClass({displayName:"ReactTransitionGroup",propTypes:{component:r.PropTypes.any,childFactory:r.PropTypes.func},getDefaultProps:function(){return{component:"span",childFactory:i.thatReturnsArgument}},getInitialState:function(){return{children:o.getChildMapping(this.props.children)}},componentWillMount:function(){this.currentlyTransitioningKeys={},this.keysToEnter=[],this.keysToLeave=[]},componentDidMount:function(){var e=this.state.children;for(var t in e)e[t]&&this.performAppear(t)},componentWillReceiveProps:function(e){var r,t=o.getChildMapping(e.children),n=this.state.children;for(r in this.setState({children:o.mergeChildMappings(n,t)}),t){var a=n&&n.hasOwnProperty(r);!t[r]||a||this.currentlyTransitioningKeys[r]||this.keysToEnter.push(r)}for(r in n){var i=t&&t.hasOwnProperty(r);!n[r]||i||this.currentlyTransitioningKeys[r]||this.keysToLeave.push(r)}},componentDidUpdate:function(){var e=this.keysToEnter;this.keysToEnter=[],e.forEach(this.performEnter);var t=this.keysToLeave;this.keysToLeave=[],t.forEach(this.performLeave)},performAppear:function(e){this.currentlyTransitioningKeys[e]=!0;var t=this.refs[e];t.componentWillAppear?t.componentWillAppear(this._handleDoneAppearing.bind(this,e)):this._handleDoneAppearing(e)},_handleDoneAppearing:function(e){var t=this.refs[e];t.componentDidAppear&&t.componentDidAppear(),delete this.currentlyTransitioningKeys[e];var n=o.getChildMapping(this.props.children);n&&n.hasOwnProperty(e)||this.performLeave(e)},performEnter:function(e){this.currentlyTransitioningKeys[e]=!0;var t=this.refs[e];t.componentWillEnter?t.componentWillEnter(this._handleDoneEntering.bind(this,e)):this._handleDoneEntering(e)},_handleDoneEntering:function(e){var t=this.refs[e];t.componentDidEnter&&t.componentDidEnter(),delete this.currentlyTransitioningKeys[e];var n=o.getChildMapping(this.props.children);n&&n.hasOwnProperty(e)||this.performLeave(e)},performLeave:function(e){this.currentlyTransitioningKeys[e]=!0;var t=this.refs[e];t.componentWillLeave?t.componentWillLeave(this._handleDoneLeaving.bind(this,e)):this._handleDoneLeaving(e)},_handleDoneLeaving:function(e){var t=this.refs[e];t.componentDidLeave&&t.componentDidLeave(),delete this.currentlyTransitioningKeys[e];var n=o.getChildMapping(this.props.children);n&&n.hasOwnProperty(e)?this.performEnter(e):this.setState((function(t){var n=a({},t.children);return delete n[e],{children:n}}))},render:function(){var e=[];for(var t in this.state.children){var n=this.state.children[t];n&&e.push(r.cloneElement(this.props.childFactory(n),{ref:t,key:t}))}return r.createElement(this.props.component,this.props,e)}});t.exports=u},{150:150,24:24,26:26,89:89}],92:[function(e,t,n){function r(e){u.enqueueUpdate(e)}function o(e,t){var n=i.get(e);return n||null}var a=(e(39),e(55)),i=e(66),u=e(93),s=e(24),l=e(158),c=(e(168),{isMounted:function(e){var t=i.get(e);return!!t&&!!t._renderedComponent},enqueueCallback:function(e,t){"function"!=typeof t&&l(!1);var n=o(e);return n?(n._pendingCallbacks?n._pendingCallbacks.push(t):n._pendingCallbacks=[t],void r(n)):null},enqueueCallbackInternal:function(e,t){"function"!=typeof t&&l(!1),e._pendingCallbacks?e._pendingCallbacks.push(t):e._pendingCallbacks=[t],r(e)},enqueueForceUpdate:function(e){var t=o(e);t&&(t._pendingForceUpdate=!0,r(t))},enqueueReplaceState:function(e,t){var n=o(e);n&&(n._pendingStateQueue=[t],n._pendingReplaceState=!0,r(n))},enqueueSetState:function(e,t){var n=o(e);n&&((n._pendingStateQueue||(n._pendingStateQueue=[])).push(t),r(n))},enqueueSetProps:function(e,t){var n=o(e);n&&c.enqueueSetPropsInternal(n,t)},enqueueSetPropsInternal:function(e,t){var n=e._topLevelWrapper;n||l(!1);var o=n._pendingElement||n._currentElement,i=o.props,u=s({},i.props,t);n._pendingElement=a.cloneAndReplaceProps(o,a.cloneAndReplaceProps(i,u)),r(n)},enqueueReplaceProps:function(e,t){var n=o(e);n&&c.enqueueReplacePropsInternal(n,t)},enqueueReplacePropsInternal:function(e,t){var n=e._topLevelWrapper;n||l(!1);var o=n._pendingElement||n._currentElement,i=o.props;n._pendingElement=a.cloneAndReplaceProps(o,a.cloneAndReplaceProps(i,t)),r(n)},enqueueElementInternal:function(e,t){e._pendingElement=t,r(e)}});t.exports=c},{158:158,168:168,24:24,39:39,55:55,66:66,93:93}],93:[function(e,t,n){function r(){T.ReactReconcileTransaction&&b||m(!1)}function o(){this.reinitializeTransaction(),this.dirtyComponentsLength=null,this.callbackQueue=c.getPooled(),this.reconcileTransaction=T.ReactReconcileTransaction.getPooled(!1)}function i(e,t){return e._mountOrder-t._mountOrder}function u(e){var t=e.dirtyComponentsLength;t!==g.length&&m(!1),g.sort(i);for(var n=0;t>n;n++){var r=g[n],o=r._pendingCallbacks;if(r._pendingCallbacks=null,f.performUpdateIfNecessary(r,e.reconcileTransaction),o)for(var a=0;a<o.length;a++)e.callbackQueue.enqueue(o[a],r.getPublicInstance())}}var c=e(6),p=e(25),d=e(76),f=e(82),h=e(110),v=e(24),m=e(158),g=[],y=c.getPooled(),C=!1,b=null,x=[{initialize:function(){this.dirtyComponentsLength=g.length},close:function(){this.dirtyComponentsLength!==g.length?(g.splice(0,this.dirtyComponentsLength),D()):g.length=0}},{initialize:function(){this.callbackQueue.reset()},close:function(){this.callbackQueue.notifyAll()}}];v(o.prototype,h.Mixin,{getTransactionWrappers:function(){return x},destructor:function(){this.dirtyComponentsLength=null,c.release(this.callbackQueue),this.callbackQueue=null,T.ReactReconcileTransaction.release(this.reconcileTransaction),this.reconcileTransaction=null},perform:function(e,t,n){return h.Mixin.perform.call(this,this.reconcileTransaction.perform,this.reconcileTransaction,e,t,n)}}),p.addPoolingTo(o);var D=function(){for(;g.length||C;){if(g.length){var e=o.getPooled();e.perform(u,null,e),o.release(e)}if(C){C=!1;var t=y;y=c.getPooled(),t.notifyAll(),c.release(t)}}},P={injectReconcileTransaction:function(e){e||m(!1),T.ReactReconcileTransaction=e},injectBatchingStrategy:function(e){e||m(!1),"function"!=typeof e.batchedUpdates&&m(!1),"boolean"!=typeof e.isBatchingUpdates&&m(!1),b=e}},T={ReactReconcileTransaction:null,batchedUpdates:function(e,t,n,o,a,i){r(),b.batchedUpdates(e,t,n,o,a,i)},enqueueUpdate:function s(e){return r(),b.isBatchingUpdates?void g.push(e):void b.batchedUpdates(s,e)},flushBatchedUpdates:D=d.measure("ReactUpdates","flushBatchedUpdates",D),injection:P,asap:function(e,t){b.isBatchingUpdates||m(!1),y.enqueue(e,t),C=!0}};t.exports=T},{110:110,158:158,24:24,25:25,6:6,76:76,82:82}],94:[function(e,t,n){t.exports="0.14.3"},{}],95:[function(e,t,n){var o=e(10).injection.MUST_USE_ATTRIBUTE,a_xlink="http://www.w3.org/1999/xlink",a_xml="http://www.w3.org/XML/1998/namespace",i={Properties:{clipPath:o,cx:o,cy:o,d:o,dx:o,dy:o,fill:o,fillOpacity:o,fontFamily:o,fontSize:o,fx:o,fy:o,gradientTransform:o,gradientUnits:o,markerEnd:o,markerMid:o,markerStart:o,offset:o,opacity:o,patternContentUnits:o,patternUnits:o,points:o,preserveAspectRatio:o,r:o,rx:o,ry:o,spreadMethod:o,stopColor:o,stopOpacity:o,stroke:o,strokeDasharray:o,strokeLinecap:o,strokeOpacity:o,strokeWidth:o,textAnchor:o,transform:o,version:o,viewBox:o,x1:o,x2:o,x:o,xlinkActuate:o,xlinkArcrole:o,xlinkHref:o,xlinkRole:o,xlinkShow:o,xlinkTitle:o,xlinkType:o,xmlBase:o,xmlLang:o,xmlSpace:o,y1:o,y2:o,y:o},DOMAttributeNamespaces:{xlinkActuate:a_xlink,xlinkArcrole:a_xlink,xlinkHref:a_xlink,xlinkRole:a_xlink,xlinkShow:a_xlink,xlinkTitle:a_xlink,xlinkType:a_xlink,xmlBase:a_xml,xmlLang:a_xml,xmlSpace:a_xml},DOMAttributeNames:{clipPath:"clip-path",fillOpacity:"fill-opacity",fontFamily:"font-family",fontSize:"font-size",gradientTransform:"gradientTransform",gradientUnits:"gradientUnits",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",patternContentUnits:"patternContentUnits",patternUnits:"patternUnits",preserveAspectRatio:"preserveAspectRatio",spreadMethod:"spreadMethod",stopColor:"stop-color",stopOpacity:"stop-opacity",strokeDasharray:"stroke-dasharray",strokeLinecap:"stroke-linecap",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",textAnchor:"text-anchor",viewBox:"viewBox",xlinkActuate:"xlink:actuate",xlinkArcrole:"xlink:arcrole",xlinkHref:"xlink:href",xlinkRole:"xlink:role",xlinkShow:"xlink:show",xlinkTitle:"xlink:title",xlinkType:"xlink:type",xmlBase:"xml:base",xmlLang:"xml:lang",xmlSpace:"xml:space"}};t.exports=i},{10:10}],96:[function(e,t,n){function o(e,t){if(b||null==g||g!==c())return null;var n=function(e){if("selectionStart"in e&&s.hasSelectionCapabilities(e))return{start:e.selectionStart,end:e.selectionEnd};if(window.getSelection){var t=window.getSelection();return{anchorNode:t.anchorNode,anchorOffset:t.anchorOffset,focusNode:t.focusNode,focusOffset:t.focusOffset}}if(document.selection){var n=document.selection.createRange();return{parentElement:n.parentElement(),text:n.text,top:n.boundingTop,left:n.boundingLeft}}}(g);if(!C||!f(C,n)){C=n;var o=l.getPooled(m.select,y,e,t);return o.type="select",o.target=g,i.accumulateTwoPhaseDispatches(o),o}return null}var a=e(15),i=e(19),u=e(144),s=e(64),l=e(102),c=e(153),p=e(131),d=e(163),f=e(166),h=a.topLevelTypes,v=u.canUseDOM&&"documentMode"in document&&document.documentMode<=11,m={select:{phasedRegistrationNames:{bubbled:d({onSelect:null}),captured:d({onSelectCapture:null})},dependencies:[h.topBlur,h.topContextMenu,h.topFocus,h.topKeyDown,h.topMouseDown,h.topMouseUp,h.topSelectionChange]}},g=null,y=null,C=null,b=!1,E=!1,_=d({onSelect:null}),x={eventTypes:m,extractEvents:function(e,t,n,r,a){if(!E)return null;switch(e){case h.topFocus:(p(t)||"true"===t.contentEditable)&&(g=t,y=n,C=null);break;case h.topBlur:g=null,y=null,C=null;break;case h.topMouseDown:b=!0;break;case h.topContextMenu:case h.topMouseUp:return b=!1,o(r,a);case h.topSelectionChange:if(v)break;case h.topKeyDown:case h.topKeyUp:return o(r,a)}return null},didPutListener:function(e,t,n){t===_&&(E=!0)}};t.exports=x},{102:102,131:131,144:144,15:15,153:153,163:163,166:166,19:19,64:64}],97:[function(e,t,n){var r=Math.pow(2,53),o={createReactRootIndex:function(){return Math.ceil(Math.random()*r)}};t.exports=o},{}],98:[function(e,t,n){var r=e(15),o=e(143),a=e(19),i=e(70),u=e(99),s=e(102),l=e(103),c=e(105),p=e(106),d=e(101),f=e(107),h=e(108),v=e(109),m=e(150),g=e(122),y=e(158),C=e(163),b=r.topLevelTypes,E={abort:{phasedRegistrationNames:{bubbled:C({onAbort:!0}),captured:C({onAbortCapture:!0})}},blur:{phasedRegistrationNames:{bubbled:C({onBlur:!0}),captured:C({onBlurCapture:!0})}},canPlay:{phasedRegistrationNames:{bubbled:C({onCanPlay:!0}),captured:C({onCanPlayCapture:!0})}},canPlayThrough:{phasedRegistrationNames:{bubbled:C({onCanPlayThrough:!0}),captured:C({onCanPlayThroughCapture:!0})}},click:{phasedRegistrationNames:{bubbled:C({onClick:!0}),captured:C({onClickCapture:!0})}},contextMenu:{phasedRegistrationNames:{bubbled:C({onContextMenu:!0}),captured:C({onContextMenuCapture:!0})}},copy:{phasedRegistrationNames:{bubbled:C({onCopy:!0}),captured:C({onCopyCapture:!0})}},cut:{phasedRegistrationNames:{bubbled:C({onCut:!0}),captured:C({onCutCapture:!0})}},doubleClick:{phasedRegistrationNames:{bubbled:C({onDoubleClick:!0}),captured:C({onDoubleClickCapture:!0})}},drag:{phasedRegistrationNames:{bubbled:C({onDrag:!0}),captured:C({onDragCapture:!0})}},dragEnd:{phasedRegistrationNames:{bubbled:C({onDragEnd:!0}),captured:C({onDragEndCapture:!0})}},dragEnter:{phasedRegistrationNames:{bubbled:C({onDragEnter:!0}),captured:C({onDragEnterCapture:!0})}},dragExit:{phasedRegistrationNames:{bubbled:C({onDragExit:!0}),captured:C({onDragExitCapture:!0})}},dragLeave:{phasedRegistrationNames:{bubbled:C({onDragLeave:!0}),captured:C({onDragLeaveCapture:!0})}},dragOver:{phasedRegistrationNames:{bubbled:C({onDragOver:!0}),captured:C({onDragOverCapture:!0})}},dragStart:{phasedRegistrationNames:{bubbled:C({onDragStart:!0}),captured:C({onDragStartCapture:!0})}},drop:{phasedRegistrationNames:{bubbled:C({onDrop:!0}),captured:C({onDropCapture:!0})}},durationChange:{phasedRegistrationNames:{bubbled:C({onDurationChange:!0}),captured:C({onDurationChangeCapture:!0})}},emptied:{phasedRegistrationNames:{bubbled:C({onEmptied:!0}),captured:C({onEmptiedCapture:!0})}},encrypted:{phasedRegistrationNames:{bubbled:C({onEncrypted:!0}),captured:C({onEncryptedCapture:!0})}},ended:{phasedRegistrationNames:{bubbled:C({onEnded:!0}),captured:C({onEndedCapture:!0})}},error:{phasedRegistrationNames:{bubbled:C({onError:!0}),captured:C({onErrorCapture:!0})}},focus:{phasedRegistrationNames:{bubbled:C({onFocus:!0}),captured:C({onFocusCapture:!0})}},input:{phasedRegistrationNames:{bubbled:C({onInput:!0}),captured:C({onInputCapture:!0})}},keyDown:{phasedRegistrationNames:{bubbled:C({onKeyDown:!0}),captured:C({onKeyDownCapture:!0})}},keyPress:{phasedRegistrationNames:{bubbled:C({onKeyPress:!0}),captured:C({onKeyPressCapture:!0})}},keyUp:{phasedRegistrationNames:{bubbled:C({onKeyUp:!0}),captured:C({onKeyUpCapture:!0})}},load:{phasedRegistrationNames:{bubbled:C({onLoad:!0}),captured:C({onLoadCapture:!0})}},loadedData:{phasedRegistrationNames:{bubbled:C({onLoadedData:!0}),captured:C({onLoadedDataCapture:!0})}},loadedMetadata:{phasedRegistrationNames:{bubbled:C({onLoadedMetadata:!0}),captured:C({onLoadedMetadataCapture:!0})}},loadStart:{phasedRegistrationNames:{bubbled:C({onLoadStart:!0}),captured:C({onLoadStartCapture:!0})}},mouseDown:{phasedRegistrationNames:{bubbled:C({onMouseDown:!0}),captured:C({onMouseDownCapture:!0})}},mouseMove:{phasedRegistrationNames:{bubbled:C({onMouseMove:!0}),captured:C({onMouseMoveCapture:!0})}},mouseOut:{phasedRegistrationNames:{bubbled:C({onMouseOut:!0}),captured:C({onMouseOutCapture:!0})}},mouseOver:{phasedRegistrationNames:{bubbled:C({onMouseOver:!0}),captured:C({onMouseOverCapture:!0})}},mouseUp:{phasedRegistrationNames:{bubbled:C({onMouseUp:!0}),captured:C({onMouseUpCapture:!0})}},paste:{phasedRegistrationNames:{bubbled:C({onPaste:!0}),captured:C({onPasteCapture:!0})}},pause:{phasedRegistrationNames:{bubbled:C({onPause:!0}),captured:C({onPauseCapture:!0})}},play:{phasedRegistrationNames:{bubbled:C({onPlay:!0}),captured:C({onPlayCapture:!0})}},playing:{phasedRegistrationNames:{bubbled:C({onPlaying:!0}),captured:C({onPlayingCapture:!0})}},progress:{phasedRegistrationNames:{bubbled:C({onProgress:!0}),captured:C({onProgressCapture:!0})}},rateChange:{phasedRegistrationNames:{bubbled:C({onRateChange:!0}),captured:C({onRateChangeCapture:!0})}},reset:{phasedRegistrationNames:{bubbled:C({onReset:!0}),captured:C({onResetCapture:!0})}},scroll:{phasedRegistrationNames:{bubbled:C({onScroll:!0}),captured:C({onScrollCapture:!0})}},seeked:{phasedRegistrationNames:{bubbled:C({onSeeked:!0}),captured:C({onSeekedCapture:!0})}},seeking:{phasedRegistrationNames:{bubbled:C({onSeeking:!0}),captured:C({onSeekingCapture:!0})}},stalled:{phasedRegistrationNames:{bubbled:C({onStalled:!0}),captured:C({onStalledCapture:!0})}},submit:{phasedRegistrationNames:{bubbled:C({onSubmit:!0}),captured:C({onSubmitCapture:!0})}},suspend:{phasedRegistrationNames:{bubbled:C({onSuspend:!0}),captured:C({onSuspendCapture:!0})}},timeUpdate:{phasedRegistrationNames:{bubbled:C({onTimeUpdate:!0}),captured:C({onTimeUpdateCapture:!0})}},touchCancel:{phasedRegistrationNames:{bubbled:C({onTouchCancel:!0}),captured:C({onTouchCancelCapture:!0})}},touchEnd:{phasedRegistrationNames:{bubbled:C({onTouchEnd:!0}),captured:C({onTouchEndCapture:!0})}},touchMove:{phasedRegistrationNames:{bubbled:C({onTouchMove:!0}),captured:C({onTouchMoveCapture:!0})}},touchStart:{phasedRegistrationNames:{bubbled:C({onTouchStart:!0}),captured:C({onTouchStartCapture:!0})}},volumeChange:{phasedRegistrationNames:{bubbled:C({onVolumeChange:!0}),captured:C({onVolumeChangeCapture:!0})}},waiting:{phasedRegistrationNames:{bubbled:C({onWaiting:!0}),captured:C({onWaitingCapture:!0})}},wheel:{phasedRegistrationNames:{bubbled:C({onWheel:!0}),captured:C({onWheelCapture:!0})}}},_={topAbort:E.abort,topBlur:E.blur,topCanPlay:E.canPlay,topCanPlayThrough:E.canPlayThrough,topClick:E.click,topContextMenu:E.contextMenu,topCopy:E.copy,topCut:E.cut,topDoubleClick:E.doubleClick,topDrag:E.drag,topDragEnd:E.dragEnd,topDragEnter:E.dragEnter,topDragExit:E.dragExit,topDragLeave:E.dragLeave,topDragOver:E.dragOver,topDragStart:E.dragStart,topDrop:E.drop,topDurationChange:E.durationChange,topEmptied:E.emptied,topEncrypted:E.encrypted,topEnded:E.ended,topError:E.error,topFocus:E.focus,topInput:E.input,topKeyDown:E.keyDown,topKeyPress:E.keyPress,topKeyUp:E.keyUp,topLoad:E.load,topLoadedData:E.loadedData,topLoadedMetadata:E.loadedMetadata,topLoadStart:E.loadStart,topMouseDown:E.mouseDown,topMouseMove:E.mouseMove,topMouseOut:E.mouseOut,topMouseOver:E.mouseOver,topMouseUp:E.mouseUp,topPaste:E.paste,topPause:E.pause,topPlay:E.play,topPlaying:E.playing,topProgress:E.progress,topRateChange:E.rateChange,topReset:E.reset,topScroll:E.scroll,topSeeked:E.seeked,topSeeking:E.seeking,topStalled:E.stalled,topSubmit:E.submit,topSuspend:E.suspend,topTimeUpdate:E.timeUpdate,topTouchCancel:E.touchCancel,topTouchEnd:E.touchEnd,topTouchMove:E.touchMove,topTouchStart:E.touchStart,topVolumeChange:E.volumeChange,topWaiting:E.waiting,topWheel:E.wheel};for(var x in _)_[x].dependencies=[x];var D=C({onClick:null}),P={},T={eventTypes:E,extractEvents:function(e,t,n,r,o){var m,i=_[e];if(!i)return null;switch(e){case b.topAbort:case b.topCanPlay:case b.topCanPlayThrough:case b.topDurationChange:case b.topEmptied:case b.topEncrypted:case b.topEnded:case b.topError:case b.topInput:case b.topLoad:case b.topLoadedData:case b.topLoadedMetadata:case b.topLoadStart:case b.topPause:case b.topPlay:case b.topPlaying:case b.topProgress:case b.topRateChange:case b.topReset:case b.topSeeked:case b.topSeeking:case b.topStalled:case b.topSubmit:case b.topSuspend:case b.topTimeUpdate:case b.topVolumeChange:case b.topWaiting:m=s;break;case b.topKeyPress:if(0===g(r))return null;case b.topKeyDown:case b.topKeyUp:m=c;break;case b.topBlur:case b.topFocus:m=l;break;case b.topClick:if(2===r.button)return null;case b.topContextMenu:case b.topDoubleClick:case b.topMouseDown:case b.topMouseMove:case b.topMouseOut:case b.topMouseOver:case b.topMouseUp:m=p;break;case b.topDrag:case b.topDragEnd:case b.topDragEnter:case b.topDragExit:case b.topDragLeave:case b.topDragOver:case b.topDragStart:case b.topDrop:m=d;break;case b.topTouchCancel:case b.topTouchEnd:case b.topTouchMove:case b.topTouchStart:m=f;break;case b.topScroll:m=h;break;case b.topWheel:m=v;break;case b.topCopy:case b.topCut:case b.topPaste:m=u}m||y(!1);var C=m.getPooled(i,n,r,o);return a.accumulateTwoPhaseDispatches(C),C},didPutListener:function(e,t,n){if(t===D){var r=i.getNode(e);P[e]||(P[e]=o.listen(r,"click",m))}},willDeleteListener:function(e,t){t===D&&(P[e].remove(),delete P[e])}};t.exports=T},{101:101,102:102,103:103,105:105,106:106,107:107,108:108,109:109,122:122,143:143,15:15,150:150,158:158,163:163,19:19,70:70,99:99}],99:[function(e,t,n){function r(e,t,n,r){o.call(this,e,t,n,r)}var o=e(102),a={clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}};o.augmentClass(r,a),t.exports=r},{102:102}],100:[function(e,t,n){function r(e,t,n,r){o.call(this,e,t,n,r)}var o=e(102);o.augmentClass(r,{data:null}),t.exports=r},{102:102}],101:[function(e,t,n){function r(e,t,n,r){o.call(this,e,t,n,r)}var o=e(106);o.augmentClass(r,{dataTransfer:null}),t.exports=r},{106:106}],102:[function(e,t,n){function r(e,t,n,r){this.dispatchConfig=e,this.dispatchMarker=t,this.nativeEvent=n,this.target=r,this.currentTarget=r;var o=this.constructor.Interface;for(var a in o)if(o.hasOwnProperty(a)){var u=o[a];this[a]=u?u(n):n[a]}var s=null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue;this.isDefaultPrevented=s?i.thatReturnsTrue:i.thatReturnsFalse,this.isPropagationStopped=i.thatReturnsFalse}var o=e(25),a=e(24),i=e(150),u=(e(168),{type:null,currentTarget:i.thatReturnsNull,eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null});a(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():e.returnValue=!1,this.isDefaultPrevented=i.thatReturnsTrue)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,this.isPropagationStopped=i.thatReturnsTrue)},persist:function(){this.isPersistent=i.thatReturnsTrue},isPersistent:i.thatReturnsFalse,destructor:function(){var e=this.constructor.Interface;for(var t in e)this[t]=null;this.dispatchConfig=null,this.dispatchMarker=null,this.nativeEvent=null}}),r.Interface=u,r.augmentClass=function(e,t){var n=this,r=Object.create(n.prototype);a(r,e.prototype),e.prototype=r,e.prototype.constructor=e,e.Interface=a({},n.Interface,t),e.augmentClass=n.augmentClass,o.addPoolingTo(e,o.fourArgumentPooler)},o.addPoolingTo(r,o.fourArgumentPooler),t.exports=r},{150:150,168:168,24:24,25:25}],103:[function(e,t,n){function r(e,t,n,r){o.call(this,e,t,n,r)}var o=e(108);o.augmentClass(r,{relatedTarget:null}),t.exports=r},{108:108}],104:[function(e,t,n){function r(e,t,n,r){o.call(this,e,t,n,r)}var o=e(102);o.augmentClass(r,{data:null}),t.exports=r},{102:102}],105:[function(e,t,n){function r(e,t,n,r){o.call(this,e,t,n,r)}var o=e(108),a=e(122),s={key:e(123),location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:e(124),charCode:function(e){return"keypress"===e.type?a(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?a(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}};o.augmentClass(r,s),t.exports=r},{108:108,122:122,123:123,124:124}],106:[function(e,t,n){function r(e,t,n,r){o.call(this,e,t,n,r)}var o=e(108),a=e(111),u={screenX:null,screenY:null,clientX:null,clientY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:e(124),button:function(e){var t=e.button;return"which"in e?t:2===t?2:4===t?1:0},buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},pageX:function(e){return"pageX"in e?e.pageX:e.clientX+a.currentScrollLeft},pageY:function(e){return"pageY"in e?e.pageY:e.clientY+a.currentScrollTop}};o.augmentClass(r,u),t.exports=r},{108:108,111:111,124:124}],107:[function(e,t,n){function r(e,t,n,r){o.call(this,e,t,n,r)}var o=e(108),i={touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:e(124)};o.augmentClass(r,i),t.exports=r},{108:108,124:124}],108:[function(e,t,n){function r(e,t,n,r){o.call(this,e,t,n,r)}var o=e(102),a=e(125),i={view:function(e){if(e.view)return e.view;var t=a(e);if(null!=t&&t.window===t)return t;var n=t.ownerDocument;return n?n.defaultView||n.parentWindow:window},detail:function(e){return e.detail||0}};o.augmentClass(r,i),t.exports=r},{102:102,125:125}],109:[function(e,t,n){function r(e,t,n,r){o.call(this,e,t,n,r)}var o=e(106);o.augmentClass(r,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null}),t.exports=r},{106:106}],110:[function(e,t,n){var r=e(158),o={reinitializeTransaction:function(){this.transactionWrappers=this.getTransactionWrappers(),this.wrapperInitData?this.wrapperInitData.length=0:this.wrapperInitData=[],this._isInTransaction=!1},_isInTransaction:!1,getTransactionWrappers:null,isInTransaction:function(){return!!this._isInTransaction},perform:function(e,t,n,o,a,i,u,s){var l,c;this.isInTransaction()&&r(!1);try{this._isInTransaction=!0,l=!0,this.initializeAll(0),c=e.call(t,n,o,a,i,u,s),l=!1}finally{try{if(l)try{this.closeAll(0)}catch(p){}else this.closeAll(0)}finally{this._isInTransaction=!1}}return c},initializeAll:function(e){for(var t=this.transactionWrappers,n=e;n<t.length;n++){var r=t[n];try{this.wrapperInitData[n]=a.OBSERVED_ERROR,this.wrapperInitData[n]=r.initialize?r.initialize.call(this):null}finally{if(this.wrapperInitData[n]===a.OBSERVED_ERROR)try{this.initializeAll(n+1)}catch(o){}}}},closeAll:function(e){this.isInTransaction()||r(!1);for(var t=this.transactionWrappers,n=e;n<t.length;n++){var o,i=t[n],u=this.wrapperInitData[n];try{o=!0,u!==a.OBSERVED_ERROR&&i.close&&i.close.call(this,u),o=!1}finally{if(o)try{this.closeAll(n+1)}catch(s){}}}this.wrapperInitData.length=0}},a={Mixin:o,OBSERVED_ERROR:{}};t.exports=a},{158:158}],111:[function(e,t,n){var r={currentScrollLeft:0,currentScrollTop:0,refreshScrollValues:function(e){r.currentScrollLeft=e.x,r.currentScrollTop=e.y}};t.exports=r},{}],112:[function(e,t,n){var o=e(158);t.exports=function(e,t){if(null==t&&o(!1),null==e)return t;var n=Array.isArray(e),r=Array.isArray(t);return n&&r?(e.push.apply(e,t),e):n?(e.push(t),e):r?[e].concat(t):[e,t]}},{158:158}],113:[function(e,t,n){var o=65521;t.exports=function(e){for(var t=1,n=0,r=0,a=e.length,i=-4&a;i>r;){for(;r<Math.min(r+4096,i);r+=4)n+=(t+=e.charCodeAt(r))+(t+=e.charCodeAt(r+1))+(t+=e.charCodeAt(r+2))+(t+=e.charCodeAt(r+3));t%=o,n%=o}for(;a>r;r++)n+=t+=e.charCodeAt(r);return(t%=o)|(n%=o)<<16}},{}],114:[function(e,t,n){t.exports=!1},{}],115:[function(e,t,n){var o=e(55),a=e(77),i=e(163),u=(e(168),i({children:null}));t.exports=function(e,t){var n=a.mergeProps(t,e.props);return!n.hasOwnProperty(u)&&e.props.hasOwnProperty(u)&&(n.children=e.props.children),o.createElement(e.type,n)}},{163:163,168:168,55:55,77:77}],116:[function(e,t,n){var a=e(4).isUnitlessNumber;t.exports=function(e,t){return null==t||"boolean"==typeof t||""===t?"":isNaN(t)||0===t||a.hasOwnProperty(e)&&a[e]?""+t:("string"==typeof t&&(t=t.trim()),t+"px")}},{4:4}],117:[function(e,t,n){e(24),e(168),t.exports=function(e,t,n,r,o){return o}},{168:168,24:24}],118:[function(e,t,n){function r(e){return a[e]}var a={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"},i=/[&><"']/g;t.exports=function(e){return(""+e).replace(i,r)}},{}],119:[function(e,t,n){var o=(e(39),e(66)),a=e(70),i=e(158);e(168),t.exports=function(e){return null==e?null:1===e.nodeType?e:o.has(e)?a.getNodeFromInstance(e):(null!=e.render&&"function"==typeof e.render&&i(!1),void i(!1))}},{158:158,168:168,39:39,66:66,70:70}],120:[function(e,t,n){function r(e,t,n){var r=e;void 0===r[n]&&null!=t&&(r[n]=t)}var a=e(139);e(168),t.exports=function(e){if(null==e)return e;var t={};return a(e,r,t),t}},{139:139,168:168}],121:[function(e,t,n){t.exports=function(e,t,n){Array.isArray(e)?e.forEach(t,n):e&&t.call(n,e)}},{}],122:[function(e,t,n){t.exports=function(e){var t,n=e.keyCode;return"charCode"in e?0===(t=e.charCode)&&13===n&&(t=13):t=n,t>=32||13===t?t:0}},{}],123:[function(e,t,n){var o=e(122),a={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},i={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"};t.exports=function(e){if(e.key){var t=a[e.key]||e.key;if("Unidentified"!==t)return t}if("keypress"===e.type){var n=o(e);return 13===n?"Enter":String.fromCharCode(n)}return"keydown"===e.type||"keyup"===e.type?i[e.keyCode]||"Unidentified":""}},{122:122}],124:[function(e,t,n){function r(e){var n=this.nativeEvent;if(n.getModifierState)return n.getModifierState(e);var r=a[e];return!!r&&!!n[r]}var a={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};t.exports=function(e){return r}},{}],125:[function(e,t,n){t.exports=function(e){var t=e.target||e.srcElement||window;return 3===t.nodeType?t.parentNode:t}},{}],126:[function(e,t,n){var o="function"==typeof Symbol&&Symbol.iterator,a="@@iterator";t.exports=function(e){var t=e&&(o&&e[o]||e[a]);return"function"==typeof t?t:void 0}},{}],127:[function(e,t,n){function r(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function o(e){for(;e;){if(e.nextSibling)return e.nextSibling;e=e.parentNode}}t.exports=function(e,t){for(var n=r(e),a=0,i=0;n;){if(3===n.nodeType){if(i=a+n.textContent.length,t>=a&&i>=t)return{node:n,offset:t-a};a=i}n=r(o(n))}}},{}],128:[function(e,t,n){var o=e(144),a=null;t.exports=function(){return!a&&o.canUseDOM&&(a="textContent"in document.documentElement?"textContent":"innerText"),a}},{144:144}],129:[function(e,t,n){function o(e){var t;if(null===e||!1===e)t=new i(o);else if("object"==_typeof(e)){var n=e;(!n||"function"!=typeof n.type&&"string"!=typeof n.type)&&l(!1),t="string"==typeof n.type?u.createInternalComponent(n):function(e){return"function"==typeof e&&void 0!==e.prototype&&"function"==typeof e.prototype.mountComponent&&"function"==typeof e.prototype.receiveComponent}(n.type)?new n.type(n):new c}else"string"==typeof e||"number"==typeof e?t=u.createInstanceForText(e):l(!1);return t.construct(e),t._mountIndex=0,t._mountImage=null,t}var a=e(38),i=e(57),u=e(73),s=e(24),l=e(158),c=(e(168),function(){});s(c.prototype,a.Mixin,{_instantiateReactComponent:o}),t.exports=o},{158:158,168:168,24:24,38:38,57:57,73:73}],130:[function(e,t,n){var o,a=e(144);a.canUseDOM&&(o=document.implementation&&document.implementation.hasFeature&&!0!==document.implementation.hasFeature("","")),t.exports=function(e,t){if(!a.canUseDOM||t&&!("addEventListener"in document))return!1;var n="on"+e,r=n in document;if(!r){var i=document.createElement("div");i.setAttribute(n,"return;"),r="function"==typeof i[n]}return!r&&o&&"wheel"===e&&(r=document.implementation.hasFeature("Events.wheel","3.0")),r}},{144:144}],131:[function(e,t,n){var o={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};t.exports=function(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&o[e.type]||"textarea"===t)}},{}],132:[function(e,t,n){var o=e(55),a=e(158);t.exports=function(e){return o.isValidElement(e)||a(!1),e}},{158:158,55:55}],133:[function(e,t,n){var o=e(118);t.exports=function(e){return'"'+o(e)+'"'}},{118:118}],134:[function(e,t,n){var r=e(70);t.exports=r.renderSubtreeIntoContainer},{70:70}],135:[function(e,t,n){var r=e(144),o=/^[ \r\n\t\f]/,a=/<(!--|link|noscript|meta|script|style)[ \r\n\t\f\/>]/,i=function(e,t){e.innerHTML=t};if("undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction&&(i=function(e,t){MSApp.execUnsafeLocalFunction((function(){e.innerHTML=t}))}),r.canUseDOM){var u=document.createElement("div");u.innerHTML=" ",""===u.innerHTML&&(i=function(e,t){if(e.parentNode&&e.parentNode.replaceChild(e,e),o.test(t)||"<"===t[0]&&a.test(t)){e.innerHTML=String.fromCharCode(65279)+t;var n=e.firstChild;1===n.data.length?e.removeChild(n):n.deleteData(0,1)}else e.innerHTML=t})}t.exports=i},{144:144}],136:[function(e,t,n){var r=e(144),o=e(118),a=e(135),i=function(e,t){e.textContent=t};r.canUseDOM&&("textContent"in document.documentElement||(i=function(e,t){a(e,o(t))})),t.exports=i},{118:118,135:135,144:144}],137:[function(e,t,n){var o=e(166);t.exports=function(e,t,n){return!o(e.props,t)||!o(e.state,n)}},{166:166}],138:[function(e,t,n){t.exports=function(e,t){var n=null===e||!1===e,r=null===t||!1===t;if(n||r)return n===r;var o=_typeof(e),a=_typeof(t);return"string"===o||"number"===o?"string"===a||"number"===a:"object"===a&&e.type===t.type&&e.key===t.key}},{}],139:[function(e,t,n){function r(e){return v[e]}function o(e,t){return e&&null!=e.key?i(e.key):t.toString(36)}function i(e){return"$"+function(e){return(""+e).replace(m,r)}(e)}function u(e,t,n,r){var a=_typeof(e);if(("undefined"===a||"boolean"===a)&&(e=null),null===e||"string"===a||"number"===a||l.isValidElement(e))return n(r,e,""===t?f+o(e,0):t),1;var s,v=0,m=""===t?f:t+h;if(Array.isArray(e))for(var g=0;g<e.length;g++)v+=u(s=e[g],m+o(s,g),n,r);else{var y=p(e);if(y){var C,b=y.call(e);if(y!==e.entries)for(var E=0;!(C=b.next()).done;)v+=u(s=C.value,m+o(s,E++),n,r);else for(;!(C=b.next()).done;){var _=C.value;_&&(v+=u(s=_[1],m+i(_[0])+h+o(s,0),n,r))}}else"object"===a&&(String(e),d(!1))}return v}var l=(e(39),e(55)),c=e(65),p=e(126),d=e(158),f=(e(168),c.SEPARATOR),h=":",v={"=":"=0",".":"=1",":":"=2"},m=/[=.:]/g;t.exports=function(e,t,n){return null==e?0:u(e,"",t,n)}},{126:126,158:158,168:168,39:39,55:55,65:65}],140:[function(e,t,n){function o(e,t,n){Array.isArray(e)||s(!1);var r=t[n];Array.isArray(r)||s(!1)}var i=e(24),u=e(163),s=e(158),l={}.hasOwnProperty,c=u({$push:null}),p=u({$unshift:null}),d=u({$splice:null}),f=u({$set:null}),h=u({$merge:null}),v=u({$apply:null}),g={};[c,p,d,f,h,v].forEach((function(e){g[e]=!0})),t.exports=function a(e,t){if("object"!=_typeof(t)&&s(!1),l.call(t,f))return 1!==Object.keys(t).length&&s(!1),t[f];var n=function(e){return Array.isArray(e)?e.concat():e&&"object"==_typeof(e)?i(new e.constructor,e):e}(e);if(l.call(t,h)){var u=t[h];u&&"object"==_typeof(u)||s(!1),n&&"object"==_typeof(n)||s(!1),i(n,t[h])}for(var m in l.call(t,c)&&(o(e,t,c),t[c].forEach((function(e){n.push(e)}))),l.call(t,p)&&(o(e,t,p),t[p].forEach((function(e){n.unshift(e)}))),l.call(t,d)&&(Array.isArray(e)||s(!1),Array.isArray(t[d])||s(!1),t[d].forEach((function(e){Array.isArray(e)||s(!1),n.splice.apply(n,e)}))),l.call(t,v)&&("function"!=typeof t[v]&&s(!1),n=t[v](n)),t)g.hasOwnProperty(m)&&g[m]||(n[m]=a(e[m],t[m]));return n}},{158:158,163:163,24:24}],141:[function(e,t,n){var r=(e(24),e(150)),o=(e(168),r);t.exports=o},{150:150,168:168,24:24}],142:[function(e,t,n){var r=e(158),o={addClass:function(e,t){return/\s/.test(t)&&r(!1),t&&(e.classList?e.classList.add(t):o.hasClass(e,t)||(e.className=e.className+" "+t)),e},removeClass:function(e,t){return/\s/.test(t)&&r(!1),t&&(e.classList?e.classList.remove(t):o.hasClass(e,t)&&(e.className=e.className.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,""))),e},conditionClass:function(e,t,n){return(n?o.addClass:o.removeClass)(e,t)},hasClass:function(e,t){return/\s/.test(t)&&r(!1),e.classList?!!t&&e.classList.contains(t):(" "+e.className+" ").indexOf(" "+t+" ")>-1}};t.exports=o},{158:158}],143:[function(e,t,n){var r=e(150),o={listen:function(e,t,n){return e.addEventListener?(e.addEventListener(t,n,!1),{remove:function(){e.removeEventListener(t,n,!1)}}):e.attachEvent?(e.attachEvent("on"+t,n),{remove:function(){e.detachEvent("on"+t,n)}}):void 0},capture:function(e,t,n){return e.addEventListener?(e.addEventListener(t,n,!0),{remove:function(){e.removeEventListener(t,n,!0)}}):{remove:r}},registerDefault:function(){}};t.exports=o},{150:150}],144:[function(e,t,n){var r=!("undefined"==typeof window||!window.document||!window.document.createElement),o={canUseDOM:r,canUseWorkers:"undefined"!=typeof Worker,canUseEventListeners:r&&!(!window.addEventListener&&!window.attachEvent),canUseViewport:r&&!!window.screen,isInWorker:!r};t.exports=o},{}],145:[function(e,t,n){var o=/-(.)/g;t.exports=function(e){return e.replace(o,(function(e,t){return t.toUpperCase()}))}},{}],146:[function(e,t,n){var o=e(145),a=/^-ms-/;t.exports=function(e){return o(e.replace(a,"ms-"))}},{145:145}],147:[function(e,t,n){var o=e(160);t.exports=function(e,t){var n=!0;e:for(;n;){var r=e,a=t;if(n=!1,r&&a){if(r===a)return!0;if(o(r))return!1;if(o(a)){e=r,t=a.parentNode,n=!0;continue e}return r.contains?r.contains(a):!!r.compareDocumentPosition&&!!(16&r.compareDocumentPosition(a))}return!1}}},{160:160}],148:[function(e,t,n){var a=e(167);t.exports=function(e){return function(e){return!!e&&("object"==_typeof(e)||"function"==typeof e)&&"length"in e&&!("setInterval"in e)&&"number"!=typeof e.nodeType&&(Array.isArray(e)||"callee"in e||"item"in e)}(e)?Array.isArray(e)?e.slice():a(e):[e]}},{167:167}],149:[function(e,t,n){function r(e){var t=e.match(c);return t&&t[1].toLowerCase()}var a=e(144),i=e(148),u=e(154),s=e(158),l=a.canUseDOM?document.createElement("div"):null,c=/^\s*<(\w+)/;t.exports=function(e,t){var n=l;l||s(!1);var o=r(e),a=o&&u(o);if(a){n.innerHTML=a[1]+e+a[2];for(var c=a[0];c--;)n=n.lastChild}else n.innerHTML=e;var p=n.getElementsByTagName("script");p.length&&(t||s(!1),i(p).forEach(t));for(var d=i(n.childNodes);n.lastChild;)n.removeChild(n.lastChild);return d}},{144:144,148:148,154:154,158:158}],150:[function(e,t,n){function r(e){return function(){return e}}function o(){}o.thatReturns=r,o.thatReturnsFalse=r(!1),o.thatReturnsTrue=r(!0),o.thatReturnsNull=r(null),o.thatReturnsThis=function(){return this},o.thatReturnsArgument=function(e){return e},t.exports=o},{}],151:[function(e,t,n){t.exports={}},{}],152:[function(e,t,n){t.exports=function(e){try{e.focus()}catch(t){}}},{}],153:[function(e,t,n){t.exports=function(){if("undefined"==typeof document)return null;try{return document.activeElement||document.body}catch(e){return document.body}}},{}],154:[function(e,t,n){var o=e(144),a=e(158),i=o.canUseDOM?document.createElement("div"):null,u={},s=[1,'<select multiple="true">',"</select>"],l=[1,"<table>","</table>"],c=[3,"<table><tbody><tr>","</tr></tbody></table>"],p=[1,'<svg xmlns="http://www.w3.org/2000/svg">',"</svg>"],d={"*":[1,"?<div>","</div>"],area:[1,"<map>","</map>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],legend:[1,"<fieldset>","</fieldset>"],param:[1,"<object>","</object>"],tr:[2,"<table><tbody>","</tbody></table>"],optgroup:s,option:s,caption:l,colgroup:l,tbody:l,tfoot:l,thead:l,td:c,th:c};["circle","clipPath","defs","ellipse","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","text","tspan"].forEach((function(e){d[e]=p,u[e]=!0})),t.exports=function(e){return i||a(!1),d.hasOwnProperty(e)||(e="*"),u.hasOwnProperty(e)||(i.innerHTML="*"===e?"<link />":"<"+e+"></"+e+">",u[e]=!i.firstChild),u[e]?d[e]:null}},{144:144,158:158}],155:[function(e,t,n){t.exports=function(e){return e===window?{x:window.pageXOffset||document.documentElement.scrollLeft,y:window.pageYOffset||document.documentElement.scrollTop}:{x:e.scrollLeft,y:e.scrollTop}}},{}],156:[function(e,t,n){var o=/([A-Z])/g;t.exports=function(e){return e.replace(o,"-$1").toLowerCase()}},{}],157:[function(e,t,n){var o=e(156),a=/^ms-/;t.exports=function(e){return o(e).replace(a,"-ms-")}},{156:156}],158:[function(e,t,n){t.exports=function(e,t,n,_r,o,a,i,u){if(!e){var s;if(void 0===t)s=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var l=[n,_r,o,a,i,u],c=0;s=new Error("Invariant Violation: "+t.replace(/%s/g,(function(){return l[c++]})))}throw s.framesToPop=1,s}}},{}],159:[function(e,t,n){t.exports=function(e){return!(!e||!("function"==typeof Node?e instanceof Node:"object"==_typeof(e)&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName))}},{}],160:[function(e,t,n){var o=e(159);t.exports=function(e){return o(e)&&3==e.nodeType}},{159:159}],161:[function(e,t,n){t.exports=function(e){e||(e="");var t,n=arguments.length;if(n>1)for(var r=1;n>r;r++)(t=arguments[r])&&(e=(e?e+" ":"")+t);return e}},{}],162:[function(e,t,n){var r=e(158);t.exports=function(e){var t,n={};for(t in e instanceof Object&&!Array.isArray(e)||r(!1),e)e.hasOwnProperty(t)&&(n[t]=t);return n}},{158:158}],163:[function(e,t,n){t.exports=function(e){var t;for(t in e)if(e.hasOwnProperty(t))return t;return null}},{}],164:[function(e,t,n){var o=Object.prototype.hasOwnProperty;t.exports=function(e,t,n){if(!e)return null;var r={};for(var a in e)o.call(e,a)&&(r[a]=t.call(n,e[a],a,e));return r}},{}],165:[function(e,t,n){t.exports=function(e){var t={};return function(n){return t.hasOwnProperty(n)||(t[n]=e.call(this,n)),t[n]}}},{}],166:[function(e,t,n){var o=Object.prototype.hasOwnProperty;t.exports=function(e,t){if(e===t)return!0;if("object"!=_typeof(e)||null===e||"object"!=_typeof(t)||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(var a=o.bind(t),i=0;i<n.length;i++)if(!a(n[i])||e[n[i]]!==t[n[i]])return!1;return!0}},{}],167:[function(e,t,n){var o=e(158);t.exports=function(e){var t=e.length;if((Array.isArray(e)||"object"!=_typeof(e)&&"function"!=typeof e)&&o(!1),"number"!=typeof t&&o(!1),0===t||t-1 in e||o(!1),e.hasOwnProperty)try{return Array.prototype.slice.call(e)}catch(n){}for(var r=Array(t),a=0;t>a;a++)r[a]=e[a];return r}},{158:158}],168:[function(e,t,n){var o=e(150);t.exports=o},{150:150}]},{},[1])(1)}));
define('filter_poodll/poodll_pushmediaskin', ["jquery","core/log","filter_poodll/utils_amd","filter_poodll/upskin_radial","filter_poodll/upskin_bar","filter_poodll/anim_hwave_mic","filter_poodll/dlg_devicesettings"],(function($,log,utils,upskin_radial,upskin_bar,hwave_mic,settings){return log.debug("PoodLL Push Skin: initialising"),{instanceprops:null,pmr:null,devsettings:null,therecanim:null,buttonmode:null,strings:null,clone:function(){return $.extend(!0,{},this)},init:function(ip,pmr){this.instanceprops=ip,this.pmr=pmr,this.devsettings=settings.clone(),this.devsettings.init(pmr,ip),this.strings=this.pmr.fetch_strings(),this.strings.recui_pushtospeak=M.util.get_string("recui_pushtospeak","filter_poodll")},fetch_instanceprops:function(){return this.instanceprops},onUploadSuccess:function(controlbarid){this.set_visual_mode("allfinished",controlbarid)},onUploadFailure:function(controlbarid){},fetch_status_bar:function(skin){return'<div class="poodll_status_'+skin+'" width="320" height="50">00:00:00</div>'},fetch_preview_audio:function(skin){return'<audio class="poodll_preview_'+skin+' hide"></audio>'},fetch_preview_video:function(skin){return this.fetch_preview_audio(skin)},fetch_resource_audio:function(skin){return'<audio class="poodll_resourceplayer_'+skin+' hide" ></audio>'},fetch_resource_video:function(skin){return this.fetch_resource_audio(skin)},onfinalspeechcapture:function(speechtext,speechresults){this.just_stop()},onMediaError:function(e){console.error("media error",e)},onMediaSuccess_video:function(controlbarid){this.fetch_instanceprops();this.set_visual_mode("startbuttonrecording",controlbarid)},onMediaSuccess_audio:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.preview.attr("src",null),ip.uploader.Output(""),this.therecanim.start(),ip.timer.reset(),ip.timer.start(),this.update_status(controlbarid),this.set_visual_mode("startbuttonrecording",controlbarid)},handle_timer_update:function(controlbarid){var ip=this.fetch_instanceprops();ip.controlbar.status.html(ip.timer.fetch_display_time()),0==ip.timer.seconds&&ip.timer.initseconds>0&&this.stop_and_upload(controlbarid)},update_status:function(controlbarid){var ip=this.fetch_instanceprops();ip.controlbar.status.html(ip.timer.fetch_display_time())},fetch_uploader_skin:function(controlbarid,element){var ip=this.fetch_instanceprops(),upskin=upskin_bar.clone();return upskin.init(ip.config,element,ip.controlbar.playcanvas,ip.controlbar.status),upskin},set_button_style:function(mode){$.each(["testbuttonready","testbuttonrecording","startbuttonready","startbuttoncountdown","startbuttonrecording","uploading","allfinished"],(function(index,modeclass){$(".poodll_mediarecorderbox_push").removeClass("poodll_mediarecorder_push_"+modeclass),$(".poodll_mediarecorderbox_push").removeClass("push_canclick")})),$(".poodll_mediarecorderbox_push").addClass("poodll_mediarecorder_push_"+mode),"testbuttonready"!=mode&&"startbuttonready"!=mode||$(".poodll_mediarecorderbox_push").addClass("push_canclick")},set_visual_mode:function(mode){var ip=this.fetch_instanceprops();this.buttonmode=mode;var messageObject={type:"recorderstatus"};messageObject.status=mode,ip.config.hermes.postMessage(messageObject);switch(mode){case"startbuttonready":ip.controlbar.thecaption.text(this.strings.recui_pushtospeak),ip.controlbar.thecaption.show(),ip.controlbar.playcanvas.hide(),ip.controlbar.status.hide(),ip.controlbar.settingsicon.hide(),this.set_button_style(mode);break;case"startbuttonrecording":ip.controlbar.thecaption.hide(),ip.controlbar.playcanvas.show(),this.set_button_style(mode),ip.controlbar.status.hide();break;case"uploading":ip.controlbar.thecaption.html('<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i>'),ip.controlbar.thecaption.show(),ip.controlbar.playcanvas.hide(),this.set_button_style(mode),ip.controlbar.status.hide();break;case"allfinished":ip.controlbar.thecaption.text("Finished"),ip.controlbar.thecaption.show(),ip.controlbar.playcanvas.hide(),ip.controlbar.status.hide(),this.set_button_style(mode)}},insert_controlbar_video:function(element,controlbarid,preview,resource){return this.prepare_controlbar_audio(element,controlbarid,preview,resource)},insert_controlbar_audio:function(element,controlbarid,preview,resource){return this.prepare_controlbar(element,controlbarid,preview,resource,"audio")},prepare_controlbar:function(element,controlbarid,preview,resource,mediatype){var ip=this.fetch_instanceprops(),skin_style=ip.config.media_skin_style,status=this.fetch_status_bar("push"),controls='<div class="poodll_mediarecorderholder_push poodll_mediarecorder_audio" id="holder_'+controlbarid+'">';controls+='<div class="poodll_mediarecorderbox_push" id="'+controlbarid+'">',controls+=this.devsettings.fetch_dialogue_box(),controls+=ip.downloaddialog.fetch_dialogue_box(),controls+=ip.errordialog.fetch_dialogue_box(),controls+='<div class="style-holder '+skin_style+'">',controls+=preview,controls+='<div class="settingsicon" id="settingsicon_'+controlbarid+'"><button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal"><i class="fa fa-cogs" aria-hidden="true"></i></button></div>',controls+='<canvas id="'+controlbarid+'_playcanvas" class="poodll_mediarecorder_playcanvas_push" width="180" height="50"></canvas>',controls+='<span id="'+controlbarid+'_caption" class="poodll_mediarecorder_caption_push"></span>',controls+=status,controls+="</div></div></div>",$(element).prepend(controls);var controlbar={settingsdialog:$("#"+controlbarid+" .poodll_dialogue_box_settings"),downloaddialog:$("#"+controlbarid+" .poodll_dialogue_box_download"),errorsdialog:$("#"+controlbarid+" .poodll_dialogue_box_errors"),settingsicon:$("#"+controlbarid+" .settingsicon"),status:$("#"+controlbarid+" .poodll_status_push"),preview:$("#"+controlbarid+" .poodll_preview_push"),bigbutton:$("#"+controlbarid+".poodll_mediarecorderbox_push"),playcanvas:$("#"+controlbarid+"_playcanvas"),thecaption:$("#"+controlbarid+"_caption"),themicicon:$("#"+controlbarid+"_micicon"),stopbutton:$("#"+controlbarid+" .poodll_mediarecorder_bogusstopbutton_push"),startbutton:$("#"+controlbarid+" .poodll_mediarecorder_bogusstartbutton_push")};return ip.downloaddialog.set_dialogue_box(controlbar.downloaddialog),ip.errordialog.set_dialogue_box(controlbar.errorsdialog),this.devsettings.set_dialogue_box(controlbar.settingsdialog),controlbar},register_controlbar_events_video:function(onMediaSuccess,controlbarid){return this.register_controlbar_events_audio(onMediaSuccess,controlbarid)},register_controlbar_events_audio:function(onMediaSuccess,controlbarid){var self=this,pmr=this.pmr,ip=this.fetch_instanceprops();ip.config.recanim="hwave_mic";var recanim=hwave_mic.clone();self.therecanim=recanim,recanim.init(ip.audioanalyser,ip.controlbar.playcanvas.get(0)),this.set_visual_mode("startbuttonready"),ip.controlbar.bigbutton.click((function(e){log.debug(e.target);var clickable=!1;if((e.target===self||$(e.target).hasClass("style-holder")||$(e.target).hasClass("poodll_mediarecorderbox_push")||$(e.target).hasClass("poodll_mediarecorder_caption_push")||$(e.target).hasClass("poodll_mediarecorder_playcanvas_push"))&&(clickable=!0),clickable)switch(self.buttonmode){case"startbuttonready":var messageObject={type:"recorderstatus",status:"startbuttonrecording"};ip.config.hermes.postMessage(messageObject),ip.timer.disable(),pmr.do_start_audio(ip,onMediaSuccess),self.set_visual_mode("startbuttonrecording");break;case"startbuttonrecording":self.just_stop(controlbarid);break;case"oldstartbuttonready":ip.config.hermes.enable(),self.set_visual_mode("startbuttoncountdown");var starttime=(new Date).getTime(),finalcount=3e3,previouscount=-1;setTimeout((function countingdown(){var currentcount=(new Date).getTime()-starttime;if(currentcount>finalcount)ip.timer.enable(),pmr.do_start_audio(ip,onMediaSuccess);else{var newcount=!1;if(previouscount<0&&currentcount>0?newcount=finalcount/1e3:previouscount<1e3&&currentcount>1e3?newcount=finalcount/1e3-1:previouscount<2e3&&currentcount>2e3&&(newcount=finalcount/1e3-2),newcount){var messageObject={type:"countdownstatus"};messageObject.status=newcount,ip.config.hermes.postMessage(messageObject)}previouscount=currentcount,setTimeout(countingdown,100)}}),100);break;case"stopbutton":self.stop_and_upload()}})),ip.controlbar.settingsicon.click((function(e){log.debug("we no proapagato"),e.stopPropagation(),self.uploaded?ip.downloaddialog.open():self.devsettings.open()})),window.onbeforeunload=function(){}},just_stop:function(){var pmr=this.pmr,ip=this.fetch_instanceprops(),recanim=this.therecanim;ip.mediaRecorder&&pmr.do_stop_audio(ip),recanim.clear(),ip.config.hermes.enable(),this.set_visual_mode("startbuttonready")},stop_and_upload:function(controlbarid){var pmr=this.pmr,ip=this.fetch_instanceprops(),recanim=this.therecanim;pmr.do_stop_audio(ip),recanim.clear(),ip.timer.stop(),this.update_status(controlbarid);setTimeout((function doDeferredUpload(){ip.blobs&&ip.blobs.length>0?(pmr.do_save_audio(ip),ip.uploaded=!0):setTimeout(doDeferredUpload,200)}),200),this.set_visual_mode("uploading")},enable_button:function(button){$(button).attr("disabled",!1),$(button).removeClass("pmr_disabled")},disable_button:function(button){$(button).attr("disabled",!0),$(button).addClass("pmr_disabled")}}}));
define('filter_poodll/upskin_text', ["jquery","core/log"],(function($,log){return log.debug("upskin_text: initialising"),{element:null,cvs:null,cvsctx:null,clone:function(){return $.extend(!0,{},this)},init:function(config,element,cvs,messagearea){this.config=config,this.element=element,this.cvs=cvs,this.messagearea=messagearea},initControls:function(){},initProgressSession:function(xhr){var self=this;self.percent=0;var uploadingmessage=M.util.get_string("recui_uploading","filter_poodll");xhr.upload.addEventListener("progress",(function(e){e.lengthComputable&&(self.percent=e.loaded/e.total,self.showMessage(uploadingmessage+"("+Math.floor(100*self.percent)+"%)"))}))},deactivateProgressSession:function(){log.debug("deactivating session")},showMessage:function(msg,msgid){this.messagearea.html(msg)}}}));
function _typeof2(obj){return _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof2(obj)
/*!
 * wavesurfer.js 3.3.3 (2020-04-16)
 * https://github.com/katspaugh/wavesurfer.js
 * @license BSD-3-Clause
 */}var root,factory;root=window,factory=function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"===_typeof2(value)&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value:value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s="./src/wavesurfer.js")}({"./node_modules/debounce/index.js":function(module,exports){function debounce(func,wait,immediate){var timeout,args,context,timestamp,result;function later(){var last=Date.now()-timestamp;last<wait&&last>=0?timeout=setTimeout(later,wait-last):(timeout=null,immediate||(result=func.apply(context,args),context=args=null))}null==wait&&(wait=100);var debounced=function(){context=this,args=arguments,timestamp=Date.now();var callNow=immediate&&!timeout;return timeout||(timeout=setTimeout(later,wait)),callNow&&(result=func.apply(context,args),context=args=null),result};return debounced.clear=function(){timeout&&(clearTimeout(timeout),timeout=null)},debounced.flush=function(){timeout&&(result=func.apply(context,args),context=args=null,clearTimeout(timeout),timeout=null)},debounced}debounce.debounce=debounce,module.exports=debounce},"./src/drawer.canvasentry.js":function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _style=_interopRequireDefault(__webpack_require__("./src/util/style.js")),_getId=_interopRequireDefault(__webpack_require__("./src/util/get-id.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var CanvasEntry=function(){function CanvasEntry(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,CanvasEntry),this.wave=null,this.waveCtx=null,this.progress=null,this.progressCtx=null,this.start=0,this.end=1,this.id=(0,_getId.default)(void 0!==this.constructor.name?this.constructor.name.toLowerCase()+"_":"canvasentry_"),this.canvasContextAttributes={}}var Constructor,protoProps,staticProps;return Constructor=CanvasEntry,(protoProps=[{key:"initWave",value:function(element){this.wave=element,this.waveCtx=this.wave.getContext("2d",this.canvasContextAttributes)}},{key:"initProgress",value:function(element){this.progress=element,this.progressCtx=this.progress.getContext("2d",this.canvasContextAttributes)}},{key:"updateDimensions",value:function(elementWidth,totalWidth,width,height){this.start=this.wave.offsetLeft/totalWidth||0,this.end=this.start+elementWidth/totalWidth,this.wave.width=width,this.wave.height=height;var elementSize={width:elementWidth+"px"};(0,_style.default)(this.wave,elementSize),this.hasProgressCanvas&&(this.progress.width=width,this.progress.height=height,(0,_style.default)(this.progress,elementSize))}},{key:"clearWave",value:function(){this.waveCtx.clearRect(0,0,this.waveCtx.canvas.width,this.waveCtx.canvas.height),this.hasProgressCanvas&&this.progressCtx.clearRect(0,0,this.progressCtx.canvas.width,this.progressCtx.canvas.height)}},{key:"setFillStyles",value:function(waveColor,progressColor){this.waveCtx.fillStyle=waveColor,this.hasProgressCanvas&&(this.progressCtx.fillStyle=progressColor)}},{key:"fillRects",value:function(x,y,width,height,radius){this.fillRectToContext(this.waveCtx,x,y,width,height,radius),this.hasProgressCanvas&&this.fillRectToContext(this.progressCtx,x,y,width,height,radius)}},{key:"fillRectToContext",value:function(ctx,x,y,width,height,radius){ctx&&(radius?this.drawRoundedRect(ctx,x,y,width,height,radius):ctx.fillRect(x,y,width,height))}},{key:"drawRoundedRect",value:function(ctx,x,y,width,height,radius){0!==height&&(height<0&&(y-=height*=-1),ctx.beginPath(),ctx.moveTo(x+radius,y),ctx.lineTo(x+width-radius,y),ctx.quadraticCurveTo(x+width,y,x+width,y+radius),ctx.lineTo(x+width,y+height-radius),ctx.quadraticCurveTo(x+width,y+height,x+width-radius,y+height),ctx.lineTo(x+radius,y+height),ctx.quadraticCurveTo(x,y+height,x,y+height-radius),ctx.lineTo(x,y+radius),ctx.quadraticCurveTo(x,y,x+radius,y),ctx.closePath(),ctx.fill())}},{key:"drawLines",value:function(peaks,absmax,halfH,offsetY,start,end){this.drawLineToContext(this.waveCtx,peaks,absmax,halfH,offsetY,start,end),this.hasProgressCanvas&&this.drawLineToContext(this.progressCtx,peaks,absmax,halfH,offsetY,start,end)}},{key:"drawLineToContext",value:function(ctx,peaks,absmax,halfH,offsetY,start,end){if(ctx){var i,peak,h,length=peaks.length/2,first=Math.round(length*this.start),canvasStart=first,canvasEnd=Math.round(length*this.end)+1,scale=this.wave.width/(canvasEnd-canvasStart-1),halfOffset=halfH+offsetY,absmaxHalf=absmax/halfH;for(ctx.beginPath(),ctx.moveTo((canvasStart-first)*scale,halfOffset),ctx.lineTo((canvasStart-first)*scale,halfOffset-Math.round((peaks[2*canvasStart]||0)/absmaxHalf)),i=canvasStart;i<canvasEnd;i++)peak=peaks[2*i]||0,h=Math.round(peak/absmaxHalf),ctx.lineTo((i-first)*scale+this.halfPixel,halfOffset-h);for(var j=canvasEnd-1;j>=canvasStart;j--)peak=peaks[2*j+1]||0,h=Math.round(peak/absmaxHalf),ctx.lineTo((j-first)*scale+this.halfPixel,halfOffset-h);ctx.lineTo((canvasStart-first)*scale,halfOffset-Math.round((peaks[2*canvasStart+1]||0)/absmaxHalf)),ctx.closePath(),ctx.fill()}}},{key:"destroy",value:function(){this.waveCtx=null,this.wave=null,this.progressCtx=null,this.progress=null}},{key:"getImage",value:function(format,quality,type){var _this=this;return"blob"===type?new Promise((function(resolve){_this.wave.toBlob(resolve,format,quality)})):"dataURL"===type?this.wave.toDataURL(format,quality):void 0}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),CanvasEntry}();return exports.default=CanvasEntry,module.exports=exports.default,exports.default},"./src/drawer.js":function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var util=function(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}(__webpack_require__("./src/util/index.js"));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function(){return cache},cache}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}var Drawer=function(_util$Observer){function Drawer(container,params){var _this;return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Drawer),(_this=_possibleConstructorReturn(this,_getPrototypeOf(Drawer).call(this))).container=container,_this.params=params,_this.width=0,_this.height=params.height*_this.params.pixelRatio,_this.lastPos=0,_this.wrapper=null,_this}var Constructor,protoProps,staticProps;return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(Drawer,_util$Observer),Constructor=Drawer,(protoProps=[{key:"style",value:function(el,styles){return util.style(el,styles)}},{key:"createWrapper",value:function(){this.wrapper=this.container.appendChild(document.createElement("wave")),this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"}),(this.params.fillParent||this.params.scrollParent)&&this.style(this.wrapper,{width:"100%",overflowX:this.params.hideScrollbar?"hidden":"auto",overflowY:"hidden"}),this.setupWrapperEvents()}},{key:"handleEvent",value:function(e,noPrevent){!noPrevent&&e.preventDefault();var progress,clientX=e.targetTouches?e.targetTouches[0].clientX:e.clientX,bbox=this.wrapper.getBoundingClientRect(),nominalWidth=this.width,parentWidth=this.getWidth();return!this.params.fillParent&&nominalWidth<parentWidth?(progress=(this.params.rtl?bbox.right-clientX:clientX-bbox.left)*(this.params.pixelRatio/nominalWidth)||0)>1&&(progress=1):progress=((this.params.rtl?bbox.right-clientX:clientX-bbox.left)+this.wrapper.scrollLeft)/this.wrapper.scrollWidth||0,progress}},{key:"setupWrapperEvents",value:function(){var _this2=this;this.wrapper.addEventListener("click",(function(e){var scrollbarHeight=_this2.wrapper.offsetHeight-_this2.wrapper.clientHeight;if(0!==scrollbarHeight){var bbox=_this2.wrapper.getBoundingClientRect();if(e.clientY>=bbox.bottom-scrollbarHeight)return}_this2.params.interact&&_this2.fireEvent("click",e,_this2.handleEvent(e))})),this.wrapper.addEventListener("dblclick",(function(e){_this2.params.interact&&_this2.fireEvent("dblclick",e,_this2.handleEvent(e))})),this.wrapper.addEventListener("scroll",(function(e){return _this2.fireEvent("scroll",e)}))}},{key:"drawPeaks",value:function(peaks,length,start,end){this.setWidth(length)||this.clearWave(),this.params.barWidth?this.drawBars(peaks,0,start,end):this.drawWave(peaks,0,start,end)}},{key:"resetScroll",value:function(){null!==this.wrapper&&(this.wrapper.scrollLeft=0)}},{key:"recenter",value:function(percent){var position=this.wrapper.scrollWidth*percent;this.recenterOnPosition(position,!0)}},{key:"recenterOnPosition",value:function(position,immediate){var scrollLeft=this.wrapper.scrollLeft,half=~~(this.wrapper.clientWidth/2),maxScroll=this.wrapper.scrollWidth-this.wrapper.clientWidth,target=position-half,offset=target-scrollLeft;if(0!=maxScroll){if(!immediate&&-half<=offset&&offset<half){var rate=this.params.autoCenterRate;rate/=half,rate*=maxScroll,target=scrollLeft+(offset=Math.max(-rate,Math.min(rate,offset)))}(target=Math.max(0,Math.min(maxScroll,target)))!=scrollLeft&&(this.wrapper.scrollLeft=target)}}},{key:"getScrollX",value:function(){var x=0;if(this.wrapper){var pixelRatio=this.params.pixelRatio;if(x=Math.round(this.wrapper.scrollLeft*pixelRatio),this.params.scrollParent){var maxScroll=~~(this.wrapper.scrollWidth*pixelRatio-this.getWidth());x=Math.min(maxScroll,Math.max(0,x))}}return x}},{key:"getWidth",value:function(){return Math.round(this.container.clientWidth*this.params.pixelRatio)}},{key:"setWidth",value:function(width){return this.width!=width&&(this.width=width,this.params.fillParent||this.params.scrollParent?this.style(this.wrapper,{width:""}):this.style(this.wrapper,{width:~~(this.width/this.params.pixelRatio)+"px"}),this.updateSize(),!0)}},{key:"setHeight",value:function(height){return height!=this.height&&(this.height=height,this.style(this.wrapper,{height:~~(this.height/this.params.pixelRatio)+"px"}),this.updateSize(),!0)}},{key:"progress",value:function(_progress){var minPxDelta=1/this.params.pixelRatio,pos=Math.round(_progress*this.width)*minPxDelta;if(pos<this.lastPos||pos-this.lastPos>=minPxDelta){if(this.lastPos=pos,this.params.scrollParent&&this.params.autoCenter){var newPos=~~(this.wrapper.scrollWidth*_progress);this.recenterOnPosition(newPos,this.params.autoCenterImmediately)}this.updateProgress(pos)}}},{key:"destroy",value:function(){this.unAll(),this.wrapper&&(this.wrapper.parentNode==this.container&&this.container.removeChild(this.wrapper),this.wrapper=null)}},{key:"updateCursor",value:function(){}},{key:"updateSize",value:function(){}},{key:"drawBars",value:function(peaks,channelIndex,start,end){}},{key:"drawWave",value:function(peaks,channelIndex,start,end){}},{key:"clearWave",value:function(){}},{key:"updateProgress",value:function(position){}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Drawer}(util.Observer);exports.default=Drawer,module.exports=exports.default},"./src/drawer.multicanvas.js":function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _drawer=_interopRequireDefault(__webpack_require__("./src/drawer.js")),util=function(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}(__webpack_require__("./src/util/index.js")),_drawer2=_interopRequireDefault(__webpack_require__("./src/drawer.canvasentry.js"));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function(){return cache},cache}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}var MultiCanvas=function(_Drawer){function MultiCanvas(container,params){var _this;return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MultiCanvas),(_this=_possibleConstructorReturn(this,_getPrototypeOf(MultiCanvas).call(this,container,params))).maxCanvasWidth=params.maxCanvasWidth,_this.maxCanvasElementWidth=Math.round(params.maxCanvasWidth/params.pixelRatio),_this.hasProgressCanvas=params.waveColor!=params.progressColor,_this.halfPixel=.5/params.pixelRatio,_this.canvases=[],_this.progressWave=null,_this.EntryClass=_drawer2.default,_this.canvasContextAttributes=params.drawingContextAttributes,_this.overlap=2*Math.ceil(params.pixelRatio/2),_this.barRadius=params.barRadius||0,_this}var Constructor,protoProps,staticProps;return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(MultiCanvas,_Drawer),Constructor=MultiCanvas,(protoProps=[{key:"init",value:function(){this.createWrapper(),this.createElements()}},{key:"createElements",value:function(){this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:3,left:0,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",pointerEvents:"none"})),this.addCanvas(),this.updateCursor()}},{key:"updateCursor",value:function(){this.style(this.progressWave,{borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor})}},{key:"updateSize",value:function(){for(var _this2=this,totalWidth=Math.round(this.width/this.params.pixelRatio),requiredCanvases=Math.ceil(totalWidth/(this.maxCanvasElementWidth+this.overlap));this.canvases.length<requiredCanvases;)this.addCanvas();for(;this.canvases.length>requiredCanvases;)this.removeCanvas();var canvasWidth=this.maxCanvasWidth+this.overlap,lastCanvas=this.canvases.length-1;this.canvases.forEach((function(entry,i){i==lastCanvas&&(canvasWidth=_this2.width-_this2.maxCanvasWidth*lastCanvas),_this2.updateDimensions(entry,canvasWidth,_this2.height),entry.clearWave()}))}},{key:"addCanvas",value:function(){var entry=new this.EntryClass;entry.canvasContextAttributes=this.canvasContextAttributes,entry.hasProgressCanvas=this.hasProgressCanvas,entry.halfPixel=this.halfPixel;var leftOffset=this.maxCanvasElementWidth*this.canvases.length;entry.initWave(this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:2,left:leftOffset+"px",top:0,bottom:0,height:"100%",pointerEvents:"none"}))),this.hasProgressCanvas&&entry.initProgress(this.progressWave.appendChild(this.style(document.createElement("canvas"),{position:"absolute",left:leftOffset+"px",top:0,bottom:0,height:"100%"}))),this.canvases.push(entry)}},{key:"removeCanvas",value:function(){var lastEntry=this.canvases[this.canvases.length-1];lastEntry.wave.parentElement.removeChild(lastEntry.wave),this.hasProgressCanvas&&lastEntry.progress.parentElement.removeChild(lastEntry.progress),lastEntry&&(lastEntry.destroy(),lastEntry=null),this.canvases.pop()}},{key:"updateDimensions",value:function(entry,width,height){var elementWidth=Math.round(width/this.params.pixelRatio),totalWidth=Math.round(this.width/this.params.pixelRatio);entry.updateDimensions(elementWidth,totalWidth,width,height),this.style(this.progressWave,{display:"block"})}},{key:"clearWave",value:function(){var _this3=this;util.frame((function(){_this3.canvases.forEach((function(entry){return entry.clearWave()}))}))()}},{key:"drawBars",value:function(peaks,channelIndex,start,end){var _this4=this;return this.prepareDraw(peaks,channelIndex,start,end,(function(_ref){var absmax=_ref.absmax,hasMinVals=_ref.hasMinVals,offsetY=(_ref.height,_ref.offsetY),halfH=_ref.halfH,peaks=_ref.peaks;if(void 0!==start)for(var peakIndexScale=hasMinVals?2:1,length=peaks.length/peakIndexScale,bar=_this4.params.barWidth*_this4.params.pixelRatio,step=bar+(null===_this4.params.barGap?Math.max(_this4.params.pixelRatio,~~(bar/2)):Math.max(_this4.params.pixelRatio,_this4.params.barGap*_this4.params.pixelRatio)),scale=length/_this4.width,last=end,i=start;i<last;i+=step){var peak=peaks[Math.floor(i*scale*peakIndexScale)]||0,h=Math.round(peak/absmax*halfH);0==h&&_this4.params.barMinHeight&&(h=_this4.params.barMinHeight),_this4.fillRect(i+_this4.halfPixel,halfH-h+offsetY,bar+_this4.halfPixel,2*h,_this4.barRadius)}}))}},{key:"drawWave",value:function(peaks,channelIndex,start,end){var _this5=this;return this.prepareDraw(peaks,channelIndex,start,end,(function(_ref2){var absmax=_ref2.absmax,hasMinVals=_ref2.hasMinVals,offsetY=(_ref2.height,_ref2.offsetY),halfH=_ref2.halfH,peaks=_ref2.peaks;if(!hasMinVals){for(var reflectedPeaks=[],len=peaks.length,i=0;i<len;i++)reflectedPeaks[2*i]=peaks[i],reflectedPeaks[2*i+1]=-peaks[i];peaks=reflectedPeaks}void 0!==start&&_this5.drawLine(peaks,absmax,halfH,offsetY,start,end),_this5.fillRect(0,halfH+offsetY-_this5.halfPixel,_this5.width,_this5.halfPixel,_this5.barRadius)}))}},{key:"drawLine",value:function(peaks,absmax,halfH,offsetY,start,end){var _this6=this;this.canvases.forEach((function(entry){_this6.setFillStyles(entry),entry.drawLines(peaks,absmax,halfH,offsetY,start,end)}))}},{key:"fillRect",value:function(x,y,width,height,radius){for(var startCanvas=Math.floor(x/this.maxCanvasWidth),endCanvas=Math.min(Math.ceil((x+width)/this.maxCanvasWidth)+1,this.canvases.length),i=startCanvas;i<endCanvas;i++){var entry=this.canvases[i],leftOffset=i*this.maxCanvasWidth,intersection={x1:Math.max(x,i*this.maxCanvasWidth),y1:y,x2:Math.min(x+width,i*this.maxCanvasWidth+entry.wave.width),y2:y+height};intersection.x1<intersection.x2&&(this.setFillStyles(entry),entry.fillRects(intersection.x1-leftOffset,intersection.y1,intersection.x2-intersection.x1,intersection.y2-intersection.y1,radius))}}},{key:"prepareDraw",value:function(peaks,channelIndex,start,end,fn){var _this7=this;return util.frame((function(){if(peaks[0]instanceof Array){var channels=peaks;if(_this7.params.splitChannels)return _this7.setHeight(channels.length*_this7.params.height*_this7.params.pixelRatio),channels.forEach((function(channelPeaks,i){return _this7.prepareDraw(channelPeaks,i,start,end,fn)}));peaks=channels[0]}var absmax=1/_this7.params.barHeight;if(_this7.params.normalize){var max=util.max(peaks),min=util.min(peaks);absmax=-min>max?-min:max}var hasMinVals=[].some.call(peaks,(function(val){return val<0})),height=_this7.params.height*_this7.params.pixelRatio;return fn({absmax:absmax,hasMinVals:hasMinVals,height:height,offsetY:height*channelIndex||0,halfH:height/2,peaks:peaks})}))()}},{key:"setFillStyles",value:function(entry){entry.setFillStyles(this.params.waveColor,this.params.progressColor)}},{key:"getImage",value:function(format,quality,type){if("blob"===type)return Promise.all(this.canvases.map((function(entry){return entry.getImage(format,quality,type)})));if("dataURL"===type){var images=this.canvases.map((function(entry){return entry.getImage(format,quality,type)}));return images.length>1?images:images[0]}}},{key:"updateProgress",value:function(position){this.style(this.progressWave,{width:position+"px"})}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),MultiCanvas}(_drawer.default);exports.default=MultiCanvas,module.exports=exports.default},"./src/mediaelement-webaudio.js":function(module,exports,__webpack_require__){var obj;function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function _get(target,property,receiver){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(target,property,receiver){var base=function(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=_getPrototypeOf(object)););return object}(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(receiver):desc.value}},_get(target,property,receiver||target)}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var MediaElementWebAudio=function(_MediaElement){function MediaElementWebAudio(params){var _this;return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MediaElementWebAudio),(_this=_possibleConstructorReturn(this,_getPrototypeOf(MediaElementWebAudio).call(this,params))).params=params,_this.sourceMediaElement=null,_this}var Constructor,protoProps,staticProps;return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(MediaElementWebAudio,_MediaElement),Constructor=MediaElementWebAudio,(protoProps=[{key:"init",value:function(){this.setPlaybackRate(this.params.audioRate),this.createTimer(),this.createVolumeNode(),this.createScriptNode(),this.createAnalyserNode()}},{key:"_load",value:function(media,peaks){_get(_getPrototypeOf(MediaElementWebAudio.prototype),"_load",this).call(this,media,peaks),this.createMediaElementSource(media)}},{key:"createMediaElementSource",value:function(mediaElement){this.sourceMediaElement=this.ac.createMediaElementSource(mediaElement),this.sourceMediaElement.connect(this.analyser)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),MediaElementWebAudio}(((obj=__webpack_require__("./src/mediaelement.js"))&&obj.__esModule?obj:{default:obj}).default);exports.default=MediaElementWebAudio,module.exports=exports.default},"./src/mediaelement.js":function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var obj,_webaudio=(obj=__webpack_require__("./src/webaudio.js"))&&obj.__esModule?obj:{default:obj},util=function(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}(__webpack_require__("./src/util/index.js"));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function(){return cache},cache}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function _get(target,property,receiver){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(target,property,receiver){var base=function(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=_getPrototypeOf(object)););return object}(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(receiver):desc.value}},_get(target,property,receiver||target)}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}var MediaElement=function(_WebAudio){function MediaElement(params){var _this;return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MediaElement),(_this=_possibleConstructorReturn(this,_getPrototypeOf(MediaElement).call(this,params))).params=params,_this.media={currentTime:0,duration:0,paused:!0,playbackRate:1,play:function(){},pause:function(){},volume:0},_this.mediaType=params.mediaType.toLowerCase(),_this.elementPosition=params.elementPosition,_this.peaks=null,_this.playbackRate=1,_this.volume=1,_this.isMuted=!1,_this.buffer=null,_this.onPlayEnd=null,_this.mediaListeners={},_this}var Constructor,protoProps,staticProps;return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(MediaElement,_WebAudio),Constructor=MediaElement,(protoProps=[{key:"init",value:function(){this.setPlaybackRate(this.params.audioRate),this.createTimer()}},{key:"_setupMediaListeners",value:function(){var _this2=this;this.mediaListeners.error=function(){_this2.fireEvent("error","Error loading media element")},this.mediaListeners.canplay=function(){_this2.fireEvent("canplay")},this.mediaListeners.ended=function(){_this2.fireEvent("finish")},this.mediaListeners.play=function(){_this2.fireEvent("play")},this.mediaListeners.pause=function(){_this2.fireEvent("pause")},this.mediaListeners.seeked=function(event){_this2.fireEvent("seek")},this.mediaListeners.volumechange=function(event){_this2.isMuted=_this2.media.muted,_this2.isMuted?_this2.volume=0:_this2.volume=_this2.media.volume,_this2.fireEvent("volume")},Object.keys(this.mediaListeners).forEach((function(id){_this2.media.removeEventListener(id,_this2.mediaListeners[id]),_this2.media.addEventListener(id,_this2.mediaListeners[id])}))}},{key:"createTimer",value:function(){var _this3=this;this.on("play",(function onAudioProcess(){_this3.isPaused()||(_this3.fireEvent("audioprocess",_this3.getCurrentTime()),util.frame(onAudioProcess)())})),this.on("pause",(function(){_this3.fireEvent("audioprocess",_this3.getCurrentTime())}))}},{key:"load",value:function(url,container,peaks,preload){var media=document.createElement(this.mediaType);media.controls=this.params.mediaControls,media.autoplay=this.params.autoplay||!1,media.preload=null==preload?"auto":preload,media.src=url,media.style.width="100%";var prevMedia=container.querySelector(this.mediaType);prevMedia&&container.removeChild(prevMedia),container.appendChild(media),this._load(media,peaks)}},{key:"loadElt",value:function(elt,peaks){elt.controls=this.params.mediaControls,elt.autoplay=this.params.autoplay||!1,this._load(elt,peaks)}},{key:"_load",value:function(media,peaks){if(!(media instanceof HTMLMediaElement)||void 0===media.addEventListener)throw new Error("media parameter is not a valid media element");"function"==typeof media.load&&media.load(),this.media=media,this._setupMediaListeners(),this.peaks=peaks,this.onPlayEnd=null,this.buffer=null,this.isMuted=media.muted,this.setPlaybackRate(this.playbackRate),this.setVolume(this.volume)}},{key:"isPaused",value:function(){return!this.media||this.media.paused}},{key:"getDuration",value:function(){if(this.explicitDuration)return this.explicitDuration;var duration=(this.buffer||this.media).duration;return duration>=1/0&&(duration=this.media.seekable.end(0)),duration}},{key:"getCurrentTime",value:function(){return this.media&&this.media.currentTime}},{key:"getPlayedPercents",value:function(){return this.getCurrentTime()/this.getDuration()||0}},{key:"getPlaybackRate",value:function(){return this.playbackRate||this.media.playbackRate}},{key:"setPlaybackRate",value:function(value){this.playbackRate=value||1,this.media.playbackRate=this.playbackRate}},{key:"seekTo",value:function(start){null!=start&&(this.media.currentTime=start),this.clearPlayEnd()}},{key:"play",value:function(start,end){this.seekTo(start);var promise=this.media.play();return end&&this.setPlayEnd(end),promise}},{key:"pause",value:function(){var promise;return this.media&&(promise=this.media.pause()),this.clearPlayEnd(),promise}},{key:"setPlayEnd",value:function(end){var _this4=this;this.clearPlayEnd(),this._onPlayEnd=function(time){time>=end&&(_this4.pause(),_this4.seekTo(end))},this.on("audioprocess",this._onPlayEnd)}},{key:"clearPlayEnd",value:function(){this._onPlayEnd&&(this.un("audioprocess",this._onPlayEnd),this._onPlayEnd=null)}},{key:"getPeaks",value:function(length,first,last){return this.buffer?_get(_getPrototypeOf(MediaElement.prototype),"getPeaks",this).call(this,length,first,last):this.peaks||[]}},{key:"setSinkId",value:function(deviceId){return deviceId?this.media.setSinkId?this.media.setSinkId(deviceId):Promise.reject(new Error("setSinkId is not supported in your browser")):Promise.reject(new Error("Invalid deviceId: "+deviceId))}},{key:"getVolume",value:function(){return this.volume}},{key:"setVolume",value:function(value){this.volume=value,this.media.volume!==this.volume&&(this.media.volume=this.volume)}},{key:"destroy",value:function(){var _this5=this;this.pause(),this.unAll(),this.destroyed=!0,Object.keys(this.mediaListeners).forEach((function(id){_this5.media&&_this5.media.removeEventListener(id,_this5.mediaListeners[id])})),this.params.removeMediaElementOnDestroy&&this.media&&this.media.parentNode&&this.media.parentNode.removeChild(this.media),this.media=null}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),MediaElement}(_webaudio.default);exports.default=MediaElement,module.exports=exports.default},"./src/peakcache.js":function(module,exports,__webpack_require__){function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var PeakCache=function(){function PeakCache(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,PeakCache),this.clearPeakCache()}var Constructor,protoProps,staticProps;return Constructor=PeakCache,(protoProps=[{key:"clearPeakCache",value:function(){this.peakCacheRanges=[],this.peakCacheLength=-1}},{key:"addRangeToPeakCache",value:function(length,start,end){length!=this.peakCacheLength&&(this.clearPeakCache(),this.peakCacheLength=length);for(var uncachedRanges=[],i=0;i<this.peakCacheRanges.length&&this.peakCacheRanges[i]<start;)i++;for(i%2==0&&uncachedRanges.push(start);i<this.peakCacheRanges.length&&this.peakCacheRanges[i]<=end;)uncachedRanges.push(this.peakCacheRanges[i]),i++;i%2==0&&uncachedRanges.push(end),uncachedRanges=uncachedRanges.filter((function(item,pos,arr){return 0==pos?item!=arr[pos+1]:pos==arr.length-1?item!=arr[pos-1]:item!=arr[pos-1]&&item!=arr[pos+1]})),this.peakCacheRanges=this.peakCacheRanges.concat(uncachedRanges),this.peakCacheRanges=this.peakCacheRanges.sort((function(a,b){return a-b})).filter((function(item,pos,arr){return 0==pos?item!=arr[pos+1]:pos==arr.length-1?item!=arr[pos-1]:item!=arr[pos-1]&&item!=arr[pos+1]}));var uncachedRangePairs=[];for(i=0;i<uncachedRanges.length;i+=2)uncachedRangePairs.push([uncachedRanges[i],uncachedRanges[i+1]]);return uncachedRangePairs}},{key:"getCacheRanges",value:function(){var i,peakCacheRangePairs=[];for(i=0;i<this.peakCacheRanges.length;i+=2)peakCacheRangePairs.push([this.peakCacheRanges[i],this.peakCacheRanges[i+1]]);return peakCacheRangePairs}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),PeakCache}();exports.default=PeakCache,module.exports=exports.default},"./src/util/ajax.js":function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(options){var instance=new _observer.default,xhr=new XMLHttpRequest,fired100=!1;return xhr.open(options.method||"GET",options.url,!0),xhr.responseType=options.responseType||"json",options.xhr&&(options.xhr.requestHeaders&&options.xhr.requestHeaders.forEach((function(header){xhr.setRequestHeader(header.key,header.value)})),options.xhr.withCredentials&&(xhr.withCredentials=!0)),xhr.addEventListener("progress",(function(e){instance.fireEvent("progress",e),e.lengthComputable&&e.loaded==e.total&&(fired100=!0)})),xhr.addEventListener("load",(function(e){fired100||instance.fireEvent("progress",e),instance.fireEvent("load",e),200==xhr.status||206==xhr.status?instance.fireEvent("success",xhr.response,e):instance.fireEvent("error",e)})),xhr.addEventListener("error",(function(e){return instance.fireEvent("error",e)})),xhr.send(),instance.xhr=xhr,instance};var obj,_observer=(obj=__webpack_require__("./src/util/observer.js"))&&obj.__esModule?obj:{default:obj};module.exports=exports.default},"./src/util/extend.js":function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(dest){console.warn("util.extend is deprecated; use Object.assign instead");for(var _len=arguments.length,sources=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)sources[_key-1]=arguments[_key];return sources.forEach((function(source){Object.keys(source).forEach((function(key){dest[key]=source[key]}))})),dest},module.exports=exports.default},"./src/util/fetch.js":function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(options){if(!options)throw new Error("fetch options missing");if(!options.url)throw new Error("fetch url missing");var instance=new _observer.default,fetchHeaders=new Headers,fetchRequest=new Request(options.url);instance.controller=new AbortController,options&&options.requestHeaders&&options.requestHeaders.forEach((function(header){fetchHeaders.append(header.key,header.value)}));var responseType=options.responseType||"json",fetchOptions={method:options.method||"GET",headers:fetchHeaders,mode:options.mode||"cors",credentials:options.credentials||"same-origin",cache:options.cache||"default",redirect:options.redirect||"follow",referrer:options.referrer||"client",signal:instance.controller.signal};return fetch(fetchRequest,fetchOptions).then((function(response){instance.response=response;var progressAvailable=!0;response.body||(progressAvailable=!1);var contentLength=response.headers.get("content-length");return null===contentLength&&(progressAvailable=!1),progressAvailable?(instance.onProgress=function(e){instance.fireEvent("progress",e)},new Response(new ReadableStream(new ProgressHandler(instance,contentLength,response)),fetchOptions)):response})).then((function(response){var errMsg;if(response.ok)switch(responseType){case"arraybuffer":return response.arrayBuffer();case"json":return response.json();case"blob":return response.blob();case"text":return response.text();default:errMsg="Unknown responseType: "+responseType}throw errMsg||(errMsg="HTTP error status: "+response.status),new Error(errMsg)})).then((function(response){instance.fireEvent("success",response)})).catch((function(error){instance.fireEvent("error",error)})),instance.fetchRequest=fetchRequest,instance};var obj,_observer=(obj=__webpack_require__("./src/util/observer.js"))&&obj.__esModule?obj:{default:obj};function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var ProgressHandler=function(){function ProgressHandler(instance,contentLength,response){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ProgressHandler),this.instance=instance,this.instance._reader=response.body.getReader(),this.total=parseInt(contentLength,10),this.loaded=0}var Constructor,protoProps,staticProps;return Constructor=ProgressHandler,(protoProps=[{key:"start",value:function(controller){var _this=this;!function read(){_this.instance._reader.read().then((function(_ref){var done=_ref.done,value=_ref.value;if(done)return 0===_this.total&&_this.instance.onProgress.call(_this.instance,{loaded:_this.loaded,total:_this.total,lengthComputable:!1}),void controller.close();_this.loaded+=value.byteLength,_this.instance.onProgress.call(_this.instance,{loaded:_this.loaded,total:_this.total,lengthComputable:!(0===_this.total)}),controller.enqueue(value),read()})).catch((function(error){controller.error(error)}))}()}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),ProgressHandler}();module.exports=exports.default},"./src/util/frame.js":function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(func){return function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return(0,_requestAnimationFrame.default)((function(){return func.apply(void 0,args)}))}};var obj,_requestAnimationFrame=(obj=__webpack_require__("./src/util/request-animation-frame.js"))&&obj.__esModule?obj:{default:obj};module.exports=exports.default},"./src/util/get-id.js":function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(prefix){return void 0===prefix&&(prefix="wavesurfer_"),prefix+Math.random().toString(32).substring(2)},module.exports=exports.default},"./src/util/index.js":function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"ajax",{enumerable:!0,get:function(){return _ajax.default}}),Object.defineProperty(exports,"getId",{enumerable:!0,get:function(){return _getId.default}}),Object.defineProperty(exports,"max",{enumerable:!0,get:function(){return _max.default}}),Object.defineProperty(exports,"min",{enumerable:!0,get:function(){return _min.default}}),Object.defineProperty(exports,"Observer",{enumerable:!0,get:function(){return _observer.default}}),Object.defineProperty(exports,"extend",{enumerable:!0,get:function(){return _extend.default}}),Object.defineProperty(exports,"style",{enumerable:!0,get:function(){return _style.default}}),Object.defineProperty(exports,"requestAnimationFrame",{enumerable:!0,get:function(){return _requestAnimationFrame.default}}),Object.defineProperty(exports,"frame",{enumerable:!0,get:function(){return _frame.default}}),Object.defineProperty(exports,"debounce",{enumerable:!0,get:function(){return _debounce.default}}),Object.defineProperty(exports,"preventClick",{enumerable:!0,get:function(){return _preventClick.default}}),Object.defineProperty(exports,"fetchFile",{enumerable:!0,get:function(){return _fetch.default}});var _ajax=_interopRequireDefault(__webpack_require__("./src/util/ajax.js")),_getId=_interopRequireDefault(__webpack_require__("./src/util/get-id.js")),_max=_interopRequireDefault(__webpack_require__("./src/util/max.js")),_min=_interopRequireDefault(__webpack_require__("./src/util/min.js")),_observer=_interopRequireDefault(__webpack_require__("./src/util/observer.js")),_extend=_interopRequireDefault(__webpack_require__("./src/util/extend.js")),_style=_interopRequireDefault(__webpack_require__("./src/util/style.js")),_requestAnimationFrame=_interopRequireDefault(__webpack_require__("./src/util/request-animation-frame.js")),_frame=_interopRequireDefault(__webpack_require__("./src/util/frame.js")),_debounce=_interopRequireDefault(__webpack_require__("./node_modules/debounce/index.js")),_preventClick=_interopRequireDefault(__webpack_require__("./src/util/prevent-click.js")),_fetch=_interopRequireDefault(__webpack_require__("./src/util/fetch.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},"./src/util/max.js":function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(values){var largest=-1/0;return Object.keys(values).forEach((function(i){values[i]>largest&&(largest=values[i])})),largest},module.exports=exports.default},"./src/util/min.js":function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(values){var smallest=Number(1/0);return Object.keys(values).forEach((function(i){values[i]<smallest&&(smallest=values[i])})),smallest},module.exports=exports.default},"./src/util/observer.js":function(module,exports,__webpack_require__){function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var Observer=function(){function Observer(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Observer),this.handlers=null}var Constructor,protoProps,staticProps;return Constructor=Observer,protoProps=[{key:"on",value:function(event,fn){var _this=this;this.handlers||(this.handlers={});var handlers=this.handlers[event];return handlers||(handlers=this.handlers[event]=[]),handlers.push(fn),{name:event,callback:fn,un:function(e,fn){return _this.un(e,fn)}}}},{key:"un",value:function(event,fn){if(this.handlers){var i,handlers=this.handlers[event];if(handlers)if(fn)for(i=handlers.length-1;i>=0;i--)handlers[i]==fn&&handlers.splice(i,1);else handlers.length=0}}},{key:"unAll",value:function(){this.handlers=null}},{key:"once",value:function(event,handler){var _this2=this;return this.on(event,(function fn(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];handler.apply(_this2,args),setTimeout((function(){_this2.un(event,fn)}),0)}))}},{key:"fireEvent",value:function(event){for(var _len2=arguments.length,args=new Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++)args[_key2-1]=arguments[_key2];if(this.handlers){var handlers=this.handlers[event];handlers&&handlers.forEach((function(fn){fn.apply(void 0,args)}))}}}],protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Observer}();exports.default=Observer,module.exports=exports.default},"./src/util/prevent-click.js":function(module,exports,__webpack_require__){function preventClickHandler(event){event.stopPropagation(),document.body.removeEventListener("click",preventClickHandler,!0)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(values){document.body.addEventListener("click",preventClickHandler,!0)},module.exports=exports.default},"./src/util/request-animation-frame.js":function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default=(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback,element){return setTimeout(callback,1e3/60)}).bind(window);exports.default=_default,module.exports=exports.default},"./src/util/style.js":function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(el,styles){return Object.keys(styles).forEach((function(prop){el.style[prop]!==styles[prop]&&(el.style[prop]=styles[prop])})),el},module.exports=exports.default},"./src/wavesurfer.js":function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var util=function(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}(__webpack_require__("./src/util/index.js")),_drawer=_interopRequireDefault(__webpack_require__("./src/drawer.multicanvas.js")),_webaudio=_interopRequireDefault(__webpack_require__("./src/webaudio.js")),_mediaelement=_interopRequireDefault(__webpack_require__("./src/mediaelement.js")),_peakcache=_interopRequireDefault(__webpack_require__("./src/peakcache.js")),_mediaelementWebaudio=_interopRequireDefault(__webpack_require__("./src/mediaelement-webaudio.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function(){return cache},cache}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?_assertThisInitialized(self):call}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}!function(){function PluginClass(params,ws){_classCallCheck(this,PluginClass)}_createClass(PluginClass,[{key:"create",value:function(params){}}]),_createClass(PluginClass,[{key:"init",value:function(){}},{key:"destroy",value:function(){}}])}();var WaveSurfer=function(_util$Observer){function WaveSurfer(params){var _this;if(_classCallCheck(this,WaveSurfer),(_this=_possibleConstructorReturn(this,_getPrototypeOf(WaveSurfer).call(this))).defaultParams={audioContext:null,audioScriptProcessor:null,audioRate:1,autoCenter:!0,autoCenterRate:5,autoCenterImmediately:!1,backend:"WebAudio",backgroundColor:null,barHeight:1,barRadius:0,barGap:null,barMinHeight:null,container:null,cursorColor:"#333",cursorWidth:1,dragSelection:!0,drawingContextAttributes:{desynchronized:!1},duration:null,fillParent:!0,forceDecode:!1,height:128,hideScrollbar:!1,interact:!0,loopSelection:!0,maxCanvasWidth:4e3,mediaContainer:null,mediaControls:!1,mediaType:"audio",minPxPerSec:20,normalize:!1,partialRender:!1,pixelRatio:window.devicePixelRatio||screen.deviceXDPI/screen.logicalXDPI,plugins:[],progressColor:"#555",removeMediaElementOnDestroy:!0,renderer:_drawer.default,responsive:!1,rtl:!1,scrollParent:!1,skipLength:2,splitChannels:!1,waveColor:"#999",xhr:{}},_this.backends={MediaElement:_mediaelement.default,WebAudio:_webaudio.default,MediaElementWebAudio:_mediaelementWebaudio.default},_this.util=util,_this.params=Object.assign({},_this.defaultParams,params),_this.container="string"==typeof params.container?document.querySelector(_this.params.container):_this.params.container,!_this.container)throw new Error("Container element not found");if(null==_this.params.mediaContainer?_this.mediaContainer=_this.container:"string"==typeof _this.params.mediaContainer?_this.mediaContainer=document.querySelector(_this.params.mediaContainer):_this.mediaContainer=_this.params.mediaContainer,!_this.mediaContainer)throw new Error("Media Container element not found");if(_this.params.maxCanvasWidth<=1)throw new Error("maxCanvasWidth must be greater than 1");if(_this.params.maxCanvasWidth%2==1)throw new Error("maxCanvasWidth must be an even number");if(!0===_this.params.rtl&&util.style(_this.container,{transform:"rotateY(180deg)"}),_this.params.backgroundColor&&_this.setBackgroundColor(_this.params.backgroundColor),_this.savedVolume=0,_this.isMuted=!1,_this.tmpEvents=[],_this.currentRequest=null,_this.arraybuffer=null,_this.drawer=null,_this.backend=null,_this.peakCache=null,"function"!=typeof _this.params.renderer)throw new Error("Renderer parameter is invalid");_this.Drawer=_this.params.renderer,"AudioElement"==_this.params.backend&&(_this.params.backend="MediaElement"),"WebAudio"!=_this.params.backend&&"MediaElementWebAudio"!==_this.params.backend||_webaudio.default.prototype.supportsWebAudio.call(null)||(_this.params.backend="MediaElement"),_this.Backend=_this.backends[_this.params.backend],_this.initialisedPluginList={},_this.isDestroyed=!1,_this.isReady=!1;var prevWidth=0;return _this._onResize=util.debounce((function(){prevWidth==_this.drawer.wrapper.clientWidth||_this.params.scrollParent||(prevWidth=_this.drawer.wrapper.clientWidth,_this.drawer.fireEvent("redraw"))}),"number"==typeof _this.params.responsive?_this.params.responsive:100),_possibleConstructorReturn(_this,_assertThisInitialized(_this))}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(WaveSurfer,_util$Observer),_createClass(WaveSurfer,null,[{key:"create",value:function(params){return new WaveSurfer(params).init()}}]),_createClass(WaveSurfer,[{key:"init",value:function(){return this.registerPlugins(this.params.plugins),this.createDrawer(),this.createBackend(),this.createPeakCache(),this}},{key:"registerPlugins",value:function(plugins){var _this2=this;return plugins.forEach((function(plugin){return _this2.addPlugin(plugin)})),plugins.forEach((function(plugin){plugin.deferInit||_this2.initPlugin(plugin.name)})),this.fireEvent("plugins-registered",plugins),this}},{key:"getActivePlugins",value:function(){return this.initialisedPluginList}},{key:"addPlugin",value:function(plugin){var _this3=this;if(!plugin.name)throw new Error("Plugin does not have a name!");if(!plugin.instance)throw new Error("Plugin ".concat(plugin.name," does not have an instance property!"));plugin.staticProps&&Object.keys(plugin.staticProps).forEach((function(pluginStaticProp){_this3[pluginStaticProp]=plugin.staticProps[pluginStaticProp]}));var Instance=plugin.instance;return Object.getOwnPropertyNames(util.Observer.prototype).forEach((function(key){Instance.prototype[key]=util.Observer.prototype[key]})),this[plugin.name]=new Instance(plugin.params||{},this),this.fireEvent("plugin-added",plugin.name),this}},{key:"initPlugin",value:function(name){if(!this[name])throw new Error("Plugin ".concat(name," has not been added yet!"));return this.initialisedPluginList[name]&&this.destroyPlugin(name),this[name].init(),this.initialisedPluginList[name]=!0,this.fireEvent("plugin-initialised",name),this}},{key:"destroyPlugin",value:function(name){if(!this[name])throw new Error("Plugin ".concat(name," has not been added yet and cannot be destroyed!"));if(!this.initialisedPluginList[name])throw new Error("Plugin ".concat(name," is not active and cannot be destroyed!"));if("function"!=typeof this[name].destroy)throw new Error("Plugin ".concat(name," does not have a destroy function!"));return this[name].destroy(),delete this.initialisedPluginList[name],this.fireEvent("plugin-destroyed",name),this}},{key:"destroyAllPlugins",value:function(){var _this4=this;Object.keys(this.initialisedPluginList).forEach((function(name){return _this4.destroyPlugin(name)}))}},{key:"createDrawer",value:function(){var _this5=this;this.drawer=new this.Drawer(this.container,this.params),this.drawer.init(),this.fireEvent("drawer-created",this.drawer),!1!==this.params.responsive&&(window.addEventListener("resize",this._onResize,!0),window.addEventListener("orientationchange",this._onResize,!0)),this.drawer.on("redraw",(function(){_this5.drawBuffer(),_this5.drawer.progress(_this5.backend.getPlayedPercents())})),this.drawer.on("click",(function(e,progress){setTimeout((function(){return _this5.seekTo(progress)}),0)})),this.drawer.on("scroll",(function(e){_this5.params.partialRender&&_this5.drawBuffer(),_this5.fireEvent("scroll",e)}))}},{key:"createBackend",value:function(){var _this6=this;this.backend&&this.backend.destroy(),this.backend=new this.Backend(this.params),this.backend.init(),this.fireEvent("backend-created",this.backend),this.backend.on("finish",(function(){_this6.drawer.progress(_this6.backend.getPlayedPercents()),_this6.fireEvent("finish")})),this.backend.on("play",(function(){return _this6.fireEvent("play")})),this.backend.on("pause",(function(){return _this6.fireEvent("pause")})),this.backend.on("audioprocess",(function(time){_this6.drawer.progress(_this6.backend.getPlayedPercents()),_this6.fireEvent("audioprocess",time)})),"MediaElement"!==this.params.backend&&"MediaElementWebAudio"!==this.params.backend||(this.backend.on("seek",(function(){_this6.drawer.progress(_this6.backend.getPlayedPercents())})),this.backend.on("volume",(function(){var newVolume=_this6.getVolume();_this6.fireEvent("volume",newVolume),_this6.backend.isMuted!==_this6.isMuted&&(_this6.isMuted=_this6.backend.isMuted,_this6.fireEvent("mute",_this6.isMuted))})))}},{key:"createPeakCache",value:function(){this.params.partialRender&&(this.peakCache=new _peakcache.default)}},{key:"getDuration",value:function(){return this.backend.getDuration()}},{key:"getCurrentTime",value:function(){return this.backend.getCurrentTime()}},{key:"setCurrentTime",value:function(seconds){seconds>=this.getDuration()?this.seekTo(1):this.seekTo(seconds/this.getDuration())}},{key:"play",value:function(start,end){var _this7=this;return this.fireEvent("interaction",(function(){return _this7.play(start,end)})),this.backend.play(start,end)}},{key:"setPlayEnd",value:function(position){this.backend.setPlayEnd(position)}},{key:"pause",value:function(){if(!this.backend.isPaused())return this.backend.pause()}},{key:"playPause",value:function(){return this.backend.isPaused()?this.play():this.pause()}},{key:"isPlaying",value:function(){return!this.backend.isPaused()}},{key:"skipBackward",value:function(seconds){this.skip(-seconds||-this.params.skipLength)}},{key:"skipForward",value:function(seconds){this.skip(seconds||this.params.skipLength)}},{key:"skip",value:function(offset){var duration=this.getDuration()||1,position=this.getCurrentTime()||0;position=Math.max(0,Math.min(duration,position+(offset||0))),this.seekAndCenter(position/duration)}},{key:"seekAndCenter",value:function(progress){this.seekTo(progress),this.drawer.recenter(progress)}},{key:"seekTo",value:function(progress){var _this8=this;if("number"!=typeof progress||!isFinite(progress)||progress<0||progress>1)throw new Error("Error calling wavesurfer.seekTo, parameter must be a number between 0 and 1!");this.fireEvent("interaction",(function(){return _this8.seekTo(progress)}));var paused=this.backend.isPaused();paused||this.backend.pause();var oldScrollParent=this.params.scrollParent;this.params.scrollParent=!1,this.backend.seekTo(progress*this.getDuration()),this.drawer.progress(progress),paused||this.backend.play(),this.params.scrollParent=oldScrollParent,this.fireEvent("seek",progress)}},{key:"stop",value:function(){this.pause(),this.seekTo(0),this.drawer.progress(0)}},{key:"setSinkId",value:function(deviceId){return this.backend.setSinkId(deviceId)}},{key:"setVolume",value:function(newVolume){this.backend.setVolume(newVolume),this.fireEvent("volume",newVolume)}},{key:"getVolume",value:function(){return this.backend.getVolume()}},{key:"setPlaybackRate",value:function(rate){this.backend.setPlaybackRate(rate)}},{key:"getPlaybackRate",value:function(){return this.backend.getPlaybackRate()}},{key:"toggleMute",value:function(){this.setMute(!this.isMuted)}},{key:"setMute",value:function(mute){mute!==this.isMuted?(mute?(this.savedVolume=this.backend.getVolume(),this.backend.setVolume(0),this.isMuted=!0,this.fireEvent("volume",0)):(this.backend.setVolume(this.savedVolume),this.isMuted=!1,this.fireEvent("volume",this.savedVolume)),this.fireEvent("mute",this.isMuted)):this.fireEvent("mute",this.isMuted)}},{key:"getMute",value:function(){return this.isMuted}},{key:"getFilters",value:function(){return this.backend.filters||[]}},{key:"toggleScroll",value:function(){this.params.scrollParent=!this.params.scrollParent,this.drawBuffer()}},{key:"toggleInteraction",value:function(){this.params.interact=!this.params.interact}},{key:"getWaveColor",value:function(){return this.params.waveColor}},{key:"setWaveColor",value:function(color){this.params.waveColor=color,this.drawBuffer()}},{key:"getProgressColor",value:function(){return this.params.progressColor}},{key:"setProgressColor",value:function(color){this.params.progressColor=color,this.drawBuffer()}},{key:"getBackgroundColor",value:function(){return this.params.backgroundColor}},{key:"setBackgroundColor",value:function(color){this.params.backgroundColor=color,util.style(this.container,{background:this.params.backgroundColor})}},{key:"getCursorColor",value:function(){return this.params.cursorColor}},{key:"setCursorColor",value:function(color){this.params.cursorColor=color,this.drawer.updateCursor()}},{key:"getHeight",value:function(){return this.params.height}},{key:"setHeight",value:function(height){this.params.height=height,this.drawer.setHeight(height*this.params.pixelRatio),this.drawBuffer()}},{key:"drawBuffer",value:function(){var peaks,nominalWidth=Math.round(this.getDuration()*this.params.minPxPerSec*this.params.pixelRatio),parentWidth=this.drawer.getWidth(),width=nominalWidth,start=0,end=Math.max(start+parentWidth,width);if(this.params.fillParent&&(!this.params.scrollParent||nominalWidth<parentWidth)&&(start=0,end=width=parentWidth),this.params.partialRender){var i,newRanges=this.peakCache.addRangeToPeakCache(width,start,end);for(i=0;i<newRanges.length;i++)peaks=this.backend.getPeaks(width,newRanges[i][0],newRanges[i][1]),this.drawer.drawPeaks(peaks,width,newRanges[i][0],newRanges[i][1])}else peaks=this.backend.getPeaks(width,start,end),this.drawer.drawPeaks(peaks,width,start,end);this.fireEvent("redraw",peaks,width)}},{key:"zoom",value:function(pxPerSec){pxPerSec?(this.params.minPxPerSec=pxPerSec,this.params.scrollParent=!0):(this.params.minPxPerSec=this.defaultParams.minPxPerSec,this.params.scrollParent=!1),this.drawBuffer(),this.drawer.progress(this.backend.getPlayedPercents()),this.drawer.recenter(this.getCurrentTime()/this.getDuration()),this.fireEvent("zoom",pxPerSec)}},{key:"loadArrayBuffer",value:function(arraybuffer){var _this9=this;this.decodeArrayBuffer(arraybuffer,(function(data){_this9.isDestroyed||_this9.loadDecodedBuffer(data)}))}},{key:"loadDecodedBuffer",value:function(buffer){this.backend.load(buffer),this.drawBuffer(),this.isReady=!0,this.fireEvent("ready")}},{key:"loadBlob",value:function(blob){var _this10=this,reader=new FileReader;reader.addEventListener("progress",(function(e){return _this10.onProgress(e)})),reader.addEventListener("load",(function(e){return _this10.loadArrayBuffer(e.target.result)})),reader.addEventListener("error",(function(){return _this10.fireEvent("error","Error reading file")})),reader.readAsArrayBuffer(blob),this.empty()}},{key:"load",value:function(url,peaks,preload,duration){if(!url)throw new Error("url parameter cannot be empty");if(this.empty(),preload){var preloadIgnoreReasons={"Preload is not 'auto', 'none' or 'metadata'":-1===["auto","metadata","none"].indexOf(preload),"Peaks are not provided":!peaks,"Backend is not of type 'MediaElement' or 'MediaElementWebAudio'":-1===["MediaElement","MediaElementWebAudio"].indexOf(this.params.backend),"Url is not of type string":"string"!=typeof url},activeReasons=Object.keys(preloadIgnoreReasons).filter((function(reason){return preloadIgnoreReasons[reason]}));activeReasons.length&&(console.warn("Preload parameter of wavesurfer.load will be ignored because:\n\t- "+activeReasons.join("\n\t- ")),preload=null)}switch(this.params.backend){case"WebAudio":return this.loadBuffer(url,peaks,duration);case"MediaElement":case"MediaElementWebAudio":return this.loadMediaElement(url,peaks,preload,duration)}}},{key:"loadBuffer",value:function(url,peaks,duration){var _this11=this,load=function(action){return action&&_this11.tmpEvents.push(_this11.once("ready",action)),_this11.getArrayBuffer(url,(function(data){return _this11.loadArrayBuffer(data)}))};if(!peaks)return load();this.backend.setPeaks(peaks,duration),this.drawBuffer(),this.tmpEvents.push(this.once("interaction",load))}},{key:"loadMediaElement",value:function(urlOrElt,peaks,preload,duration){var _this12=this,url=urlOrElt;if("string"==typeof urlOrElt)this.backend.load(url,this.mediaContainer,peaks,preload);else{var elt=urlOrElt;this.backend.loadElt(elt,peaks),url=elt.src}this.tmpEvents.push(this.backend.once("canplay",(function(){_this12.backend.destroyed||(_this12.drawBuffer(),_this12.isReady=!0,_this12.fireEvent("ready"))})),this.backend.once("error",(function(err){return _this12.fireEvent("error",err)}))),peaks&&this.backend.setPeaks(peaks,duration),peaks&&!this.params.forceDecode||!this.backend.supportsWebAudio()||this.getArrayBuffer(url,(function(arraybuffer){_this12.decodeArrayBuffer(arraybuffer,(function(buffer){_this12.backend.buffer=buffer,_this12.backend.setPeaks(null),_this12.drawBuffer(),_this12.fireEvent("waveform-ready")}))}))}},{key:"decodeArrayBuffer",value:function(arraybuffer,callback){var _this13=this;this.arraybuffer=arraybuffer,this.backend.decodeArrayBuffer(arraybuffer,(function(data){_this13.isDestroyed||_this13.arraybuffer!=arraybuffer||(callback(data),_this13.arraybuffer=null)}),(function(){return _this13.fireEvent("error","Error decoding audiobuffer")}))}},{key:"getArrayBuffer",value:function(url,callback){var _this14=this,options=Object.assign({url:url,responseType:"arraybuffer"},this.params.xhr),request=util.fetchFile(options);return this.currentRequest=request,this.tmpEvents.push(request.on("progress",(function(e){_this14.onProgress(e)})),request.on("success",(function(data){callback(data),_this14.currentRequest=null})),request.on("error",(function(e){_this14.fireEvent("error",e),_this14.currentRequest=null}))),request}},{key:"onProgress",value:function(e){var percentComplete;percentComplete=e.lengthComputable?e.loaded/e.total:e.loaded/(e.loaded+1e6),this.fireEvent("loading",Math.round(100*percentComplete),e.target)}},{key:"exportPCM",value:function(length,accuracy,noWindow,start,end){length=length||1024,start=start||0,accuracy=accuracy||1e4,noWindow=noWindow||!1;var peaks=this.backend.getPeaks(length,start,end),arr=[].map.call(peaks,(function(val){return Math.round(val*accuracy)/accuracy}));return new Promise((function(resolve,reject){var json=JSON.stringify(arr);noWindow||window.open("data:application/json;charset=utf-8,"+encodeURIComponent(json)),resolve(json)}))}},{key:"exportImage",value:function(format,quality,type){return format||(format="image/png"),quality||(quality=1),type||(type="dataURL"),this.drawer.getImage(format,quality,type)}},{key:"cancelAjax",value:function(){this.currentRequest&&this.currentRequest.controller&&(this.currentRequest.controller.abort(),this.currentRequest=null)}},{key:"clearTmpEvents",value:function(){this.tmpEvents.forEach((function(e){return e.un()}))}},{key:"empty",value:function(){this.backend.isPaused()||(this.stop(),this.backend.disconnectSource()),this.isReady=!1,this.cancelAjax(),this.clearTmpEvents(),this.drawer.progress(0),this.drawer.setWidth(0),this.drawer.drawPeaks({length:this.drawer.getWidth()},0)}},{key:"destroy",value:function(){this.destroyAllPlugins(),this.fireEvent("destroy"),this.cancelAjax(),this.clearTmpEvents(),this.unAll(),!1!==this.params.responsive&&(window.removeEventListener("resize",this._onResize,!0),window.removeEventListener("orientationchange",this._onResize,!0)),this.backend&&this.backend.destroy(),this.drawer&&this.drawer.destroy(),this.isDestroyed=!0,this.isReady=!1,this.arraybuffer=null}}]),WaveSurfer}(util.Observer);exports.default=WaveSurfer,WaveSurfer.VERSION="3.3.3",WaveSurfer.util=util,module.exports=exports.default},"./src/webaudio.js":function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var util=function(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}(__webpack_require__("./src/util/index.js"));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function(){return cache},cache}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}var WebAudio=function(_util$Observer){function WebAudio(params){var _this$stateBehaviors,_this$states,_this;return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,WebAudio),(_this=_possibleConstructorReturn(this,_getPrototypeOf(WebAudio).call(this))).audioContext=null,_this.offlineAudioContext=null,_this.stateBehaviors=(_defineProperty(_this$stateBehaviors={},"playing",{init:function(){this.addOnAudioProcess()},getPlayedPercents:function(){var duration=this.getDuration();return this.getCurrentTime()/duration||0},getCurrentTime:function(){return this.startPosition+this.getPlayedTime()}}),_defineProperty(_this$stateBehaviors,"paused",{init:function(){this.removeOnAudioProcess()},getPlayedPercents:function(){var duration=this.getDuration();return this.getCurrentTime()/duration||0},getCurrentTime:function(){return this.startPosition}}),_defineProperty(_this$stateBehaviors,"finished",{init:function(){this.removeOnAudioProcess(),this.fireEvent("finish")},getPlayedPercents:function(){return 1},getCurrentTime:function(){return this.getDuration()}}),_this$stateBehaviors),_this.params=params,_this.ac=params.audioContext||(_this.supportsWebAudio()?_this.getAudioContext():{}),_this.lastPlay=_this.ac.currentTime,_this.startPosition=0,_this.scheduledPause=null,_this.states=(_defineProperty(_this$states={},"playing",Object.create(_this.stateBehaviors.playing)),_defineProperty(_this$states,"paused",Object.create(_this.stateBehaviors.paused)),_defineProperty(_this$states,"finished",Object.create(_this.stateBehaviors.finished)),_this$states),_this.buffer=null,_this.filters=[],_this.gainNode=null,_this.mergedPeaks=null,_this.offlineAc=null,_this.peaks=null,_this.playbackRate=1,_this.analyser=null,_this.scriptNode=null,_this.source=null,_this.splitPeaks=[],_this.state=null,_this.explicitDuration=params.duration,_this.destroyed=!1,_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(WebAudio,_util$Observer),_createClass(WebAudio,[{key:"supportsWebAudio",value:function(){return!(!window.AudioContext&&!window.webkitAudioContext)}},{key:"getAudioContext",value:function(){return window.WaveSurferAudioContext||(window.WaveSurferAudioContext=new(window.AudioContext||window.webkitAudioContext)),window.WaveSurferAudioContext}},{key:"getOfflineAudioContext",value:function(sampleRate){return window.WaveSurferOfflineAudioContext||(window.WaveSurferOfflineAudioContext=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,sampleRate)),window.WaveSurferOfflineAudioContext}}]),_createClass(WebAudio,[{key:"init",value:function(){this.createVolumeNode(),this.createScriptNode(),this.createAnalyserNode(),this.setState("paused"),this.setPlaybackRate(this.params.audioRate),this.setLength(0)}},{key:"disconnectFilters",value:function(){this.filters&&(this.filters.forEach((function(filter){filter&&filter.disconnect()})),this.filters=null,this.analyser.connect(this.gainNode))}},{key:"setState",value:function(state){this.state!==this.states[state]&&(this.state=this.states[state],this.state.init.call(this))}},{key:"setFilter",value:function(){for(var _len=arguments.length,filters=new Array(_len),_key=0;_key<_len;_key++)filters[_key]=arguments[_key];this.setFilters(filters)}},{key:"setFilters",value:function(filters){this.disconnectFilters(),filters&&filters.length&&(this.filters=filters,this.analyser.disconnect(),filters.reduce((function(prev,curr){return prev.connect(curr),curr}),this.analyser).connect(this.gainNode))}},{key:"createScriptNode",value:function(){this.params.audioScriptProcessor?this.scriptNode=this.params.audioScriptProcessor:this.ac.createScriptProcessor?this.scriptNode=this.ac.createScriptProcessor(WebAudio.scriptBufferSize):this.scriptNode=this.ac.createJavaScriptNode(WebAudio.scriptBufferSize),this.scriptNode.connect(this.ac.destination)}},{key:"addOnAudioProcess",value:function(){var _this2=this;this.scriptNode.onaudioprocess=function(){var time=_this2.getCurrentTime();time>=_this2.getDuration()?(_this2.setState("finished"),_this2.fireEvent("pause")):time>=_this2.scheduledPause?_this2.pause():_this2.state===_this2.states.playing&&_this2.fireEvent("audioprocess",time)}}},{key:"removeOnAudioProcess",value:function(){this.scriptNode.onaudioprocess=function(){}}},{key:"createAnalyserNode",value:function(){this.analyser=this.ac.createAnalyser(),this.analyser.connect(this.gainNode)}},{key:"createVolumeNode",value:function(){this.ac.createGain?this.gainNode=this.ac.createGain():this.gainNode=this.ac.createGainNode(),this.gainNode.connect(this.ac.destination)}},{key:"setSinkId",value:function(deviceId){if(deviceId){var audio=new window.Audio;if(!audio.setSinkId)return Promise.reject(new Error("setSinkId is not supported in your browser"));audio.autoplay=!0;var dest=this.ac.createMediaStreamDestination();return this.gainNode.disconnect(),this.gainNode.connect(dest),audio.srcObject=dest.stream,audio.setSinkId(deviceId)}return Promise.reject(new Error("Invalid deviceId: "+deviceId))}},{key:"setVolume",value:function(value){this.gainNode.gain.setValueAtTime(value,this.ac.currentTime)}},{key:"getVolume",value:function(){return this.gainNode.gain.value}},{key:"decodeArrayBuffer",value:function(arraybuffer,callback,errback){this.offlineAc||(this.offlineAc=this.getOfflineAudioContext(this.ac&&this.ac.sampleRate?this.ac.sampleRate:44100)),this.offlineAc.decodeAudioData(arraybuffer,(function(data){return callback(data)}),errback)}},{key:"setPeaks",value:function(peaks,duration){null!=duration&&(this.explicitDuration=duration),this.peaks=peaks}},{key:"setLength",value:function(length){if(!this.mergedPeaks||length!=2*this.mergedPeaks.length-1+2){this.splitPeaks=[],this.mergedPeaks=[];var c,channels=this.buffer?this.buffer.numberOfChannels:1;for(c=0;c<channels;c++)this.splitPeaks[c]=[],this.splitPeaks[c][2*(length-1)]=0,this.splitPeaks[c][2*(length-1)+1]=0;this.mergedPeaks[2*(length-1)]=0,this.mergedPeaks[2*(length-1)+1]=0}}},{key:"getPeaks",value:function(length,first,last){if(this.peaks)return this.peaks;if(!this.buffer)return[];if(first=first||0,last=last||length-1,this.setLength(length),!this.buffer)return this.params.splitChannels?this.splitPeaks:this.mergedPeaks;if(!this.buffer.length){var newBuffer=this.createBuffer(1,4096,this.sampleRate);this.buffer=newBuffer.buffer}var c,sampleSize=this.buffer.length/length,sampleStep=~~(sampleSize/10)||1,channels=this.buffer.numberOfChannels;for(c=0;c<channels;c++){var peaks=this.splitPeaks[c],chan=this.buffer.getChannelData(c),i=void 0;for(i=first;i<=last;i++){var start=~~(i*sampleSize),end=~~(start+sampleSize),min=0,max=0,j=void 0;for(j=start;j<end;j+=sampleStep){var value=chan[j];value>max&&(max=value),value<min&&(min=value)}peaks[2*i]=max,peaks[2*i+1]=min,(0==c||max>this.mergedPeaks[2*i])&&(this.mergedPeaks[2*i]=max),(0==c||min<this.mergedPeaks[2*i+1])&&(this.mergedPeaks[2*i+1]=min)}}return this.params.splitChannels?this.splitPeaks:this.mergedPeaks}},{key:"getPlayedPercents",value:function(){return this.state.getPlayedPercents.call(this)}},{key:"disconnectSource",value:function(){this.source&&this.source.disconnect()}},{key:"destroy",value:function(){this.isPaused()||this.pause(),this.unAll(),this.buffer=null,this.destroyed=!0,this.disconnectFilters(),this.disconnectSource(),this.gainNode.disconnect(),this.scriptNode.disconnect(),this.analyser.disconnect(),this.params.closeAudioContext&&("function"==typeof this.ac.close&&"closed"!=this.ac.state&&this.ac.close(),this.ac=null,this.params.audioContext?this.params.audioContext=null:window.WaveSurferAudioContext=null,window.WaveSurferOfflineAudioContext=null)}},{key:"load",value:function(buffer){this.startPosition=0,this.lastPlay=this.ac.currentTime,this.buffer=buffer,this.createSource()}},{key:"createSource",value:function(){this.disconnectSource(),this.source=this.ac.createBufferSource(),this.source.start=this.source.start||this.source.noteGrainOn,this.source.stop=this.source.stop||this.source.noteOff,this.source.playbackRate.setValueAtTime(this.playbackRate,this.ac.currentTime),this.source.buffer=this.buffer,this.source.connect(this.analyser)}},{key:"isPaused",value:function(){return this.state!==this.states.playing}},{key:"getDuration",value:function(){return this.explicitDuration?this.explicitDuration:this.buffer?this.buffer.duration:0}},{key:"seekTo",value:function(start,end){if(this.buffer)return this.scheduledPause=null,null==start&&(start=this.getCurrentTime())>=this.getDuration()&&(start=0),null==end&&(end=this.getDuration()),this.startPosition=start,this.lastPlay=this.ac.currentTime,this.state===this.states.finished&&this.setState("paused"),{start:start,end:end}}},{key:"getPlayedTime",value:function(){return(this.ac.currentTime-this.lastPlay)*this.playbackRate}},{key:"play",value:function(start,end){if(this.buffer){this.createSource();var adjustedTime=this.seekTo(start,end);start=adjustedTime.start,end=adjustedTime.end,this.scheduledPause=end,this.source.start(0,start),"suspended"==this.ac.state&&this.ac.resume&&this.ac.resume(),this.setState("playing"),this.fireEvent("play")}}},{key:"pause",value:function(){this.scheduledPause=null,this.startPosition+=this.getPlayedTime(),this.source&&this.source.stop(0),this.setState("paused"),this.fireEvent("pause")}},{key:"getCurrentTime",value:function(){return this.state.getCurrentTime.call(this)}},{key:"getPlaybackRate",value:function(){return this.playbackRate}},{key:"setPlaybackRate",value:function(value){value=value||1,this.isPaused()?this.playbackRate=value:(this.pause(),this.playbackRate=value,this.play())}},{key:"setPlayEnd",value:function(end){this.scheduledPause=end}}]),WebAudio}(util.Observer);exports.default=WebAudio,WebAudio.scriptBufferSize=256,module.exports=exports.default}})},"object"===("undefined"==typeof exports?"undefined":_typeof2(exports))&&"object"===("undefined"==typeof module?"undefined":_typeof2(module))?module.exports=factory():"function"==typeof define&&define.amd?define("filter_poodll/wavesurfer",[],factory):"object"===("undefined"==typeof exports?"undefined":_typeof2(exports))?exports.WaveSurfer=factory():root.WaveSurfer=factory();
define('filter_poodll/poodll_splitmediaskin', ["jquery","core/log","filter_poodll/utils_amd","filter_poodll/upskin_bar"],(function($,log,utils,upskin_bar){return log.debug("PoodLL split Skin: initialising"),{instanceprops:null,pmr:null,uploaded:!1,recorded:!1,played:!1,mustResetResourcePlayer:!1,clone:function(){return $.extend(!0,{},this)},init:function(ip,pmr){this.instanceprops=ip,this.pmr=pmr},fetch_instanceprops:function(){return this.instanceprops},onUploadSuccess:function(controlbarid){$("#"+controlbarid+" > .poodll_save-recording").hide(),$("#"+controlbarid+" > .poodll_savedsuccessfully").show()},onUploadFailure:function(controlbarid){},fetch_status_bar:function(skin){return'<div class="poodll_status_'+skin+'"></div>'},fetch_preview_audio:function(skin){return'<audio class="poodll_preview_'+skin+' hide" controls></audio>'},fetch_preview_video:function(skin){return'<video class="poodll_preview_'+skin+'" width="320" height="240" playsinline="playsinline"></video>'},fetch_resource_audio:function(skin){return'<audio class="poodll_resourceplayer_'+skin+' hide" src="@@RESOURCEURL@@" playsinline controls></audio>'},fetch_resource_video:function(skin){return'<video class="poodll_resourceplayer_'+skin+' hide" src="@@RESOURCEURL@@" playsinline="playsinline"></video>'},fetch_uploader_skin:function(controlbarid,element){var ip=this.fetch_instanceprops(controlbarid),upskin=upskin_bar.clone();return upskin.init(ip.config,element,ip.controlbar.split_progresscanvas,ip.controlbar.status),upskin},onMediaError:function(e){console.error("media error",e)},onMediaSuccess_video:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.stopbutton.attr("disabled",!1),ip.controlbar.savebutton.attr("disabled",!1)},onMediaSuccess_audio:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.preview.attr("src",null),ip.controlbar.stopbutton.attr("disabled",!1),ip.controlbar.savebutton.attr("disabled",!1)},handle_timer_update:function(controlbarid){if(this.played||this.recorded){var ip=this.fetch_instanceprops(controlbarid),recordingstring=M.util.get_string("recui_recording","filter_poodll");this.update_status(controlbarid,recordingstring+ip.timer.fetch_display_time()),0==ip.timer.seconds&&ip.timer.initseconds>0&&ip.controlbar.stopbutton.click()}},update_status:function(controlbarid,text){this.fetch_instanceprops(controlbarid).controlbar.status.html(text)},set_visual_mode:function(mode,ip){switch(mode){case"recordingmode":this.disable_button(ip.controlbar.resourceplaybutton),ip.controlbar.resourceplaybutton.empty(),ip.controlbar.resourceplaybutton.html('<span class="fa fa-microphone fa-3x"></span>'),ip.controlbar.resourceplaybutton.addClass("poodll_mediarecorderholder_split_recordcolor"),ip.controlbar.status.addClass("poodll_mediarecorderholder_split_recordcolor"),this.handle_timer_update(ip.controlbarid),this.enable_button(ip.controlbar.stopbutton);break;case"resourceplayingmode":this.disable_button(ip.controlbar.resourceplaybutton),this.disable_button(ip.controlbar.stopbutton);break;case"neverrecordedmode":ip.controlbar.resourceplaybutton.empty(),ip.controlbar.resourceplaybutton.html('<p style="margin-bottom: 0px; font-size: 24px;">Start</p>'),this.enable_button(ip.controlbar.resourceplaybutton),this.disable_button(ip.controlbar.stopbutton),this.update_status(ip.controlbarid,M.util.get_string("recui_ready","filter_poodll"));break;case"allstoppedmode":this.disable_button(ip.controlbar.resourceplaybutton),this.disable_button(ip.controlbar.stopbutton),ip.controlbar.resourceplaybutton.empty(),ip.controlbar.resourceplaybutton.html('<span class="fa fa-check fa-3x"></span>'),ip.controlbar.resourceplaybutton.removeClass("poodll_mediarecorderholder_split_recordcolor"),ip.controlbar.status.removeClass("poodll_mediarecorderholder_split_recordcolor"),this.update_status(ip.controlbarid,M.util.get_string("recui_finished","filter_poodll"))}},insert_controlbar_video:function(element,controlbarid,preview,resourceplayer){return this.prepare_controlbar(element,controlbarid,preview,resourceplayer,"video")},insert_controlbar_audio:function(element,controlbarid,preview,resourceplayer){return this.prepare_controlbar(element,controlbarid,preview,resourceplayer,"audio")},prepare_controlbar:function(element,controlbarid,preview,resourceplayer,mediatype){var ip=this.fetch_instanceprops(controlbarid),controls='<div class="poodll_mediarecorderholder_split '+("video"==mediatype?"poodll_mediarecorder_video":"poodll_mediarecorder_audio")+'" id="holder_'+controlbarid+'">';controls+='<div class="poodll_mediarecorderbox_split" id="'+controlbarid+'">',controls+='<div class="style-holder '+ip.config.media_skin_style+'">',controls+=resourceplayer=resourceplayer.replace("@@RESOURCEURL@@",ip.config.resource),controls+='<button type="button" class="poodll_mediarecorder_button_split poodll_start-recording_split hide"><span class="fa fa-microphone fa-3x"></span></button>',controls+=' <button type="button" class="poodll_mediarecorder_button_split poodll_playback-recording_split hide"><span class="fa fa-play-circle fa-3x"></span></button>',controls+=' <button type="button" class="poodll_mediarecorder_button_split poodll_stopplayback-recording_split hide"><span class="fa fa-stop-circle fa-3x"></span></button>',controls+='<button type="button" class="poodll_save-recording_split pmr_disabled hide">'+this.pmr.fetch_strings().recui_save+"</button></div>",controls+='<div class="poodll_mediarecorderholder_split"><button type="button" class="poodll_mediarecorder_button_split poodll_stop-recording_split pmr_disabled" disabled><p style="margin-bottom: 0px;font-size: 24px;">Submit</p></button></div>',controls+='<div class="poodll_statusholder_split" >',controls+='<canvas class="split_range"></canvas>',controls+=this.fetch_status_bar("split"),controls+="</div>",controls+="</div></div></div>",$(element).append(controls);return $(".qtext").prepend("<hr />"),$(".qtext").prepend('<div class="poodll_mediarecorderholder_split poodll_mediarecorder_split_topsplit"><button type="button" class="poodll_mediarecorder_button_split poodll_play-resource_split"><p style="margin-bottom: 0px; font-size: 24px;">Start</p></button></div>'),$(".poodll_split_qbody").prepend('<div class="poodll_split_qbody_item poodll_split_qbody_preview">'+preview+"</div>"),{split_progresscanvas:$("#"+controlbarid+" .split_range"),marker:$("#"+controlbarid+"  .marker"),resourceplayer:$("#"+controlbarid+"  .poodll_resourceplayer_split"),preview:$(".qtext .poodll_preview_split"),stopbutton:$("#"+controlbarid+"  .poodll_stop-recording_split"),resourcestopbutton:$("#"+controlbarid+"  .poodll_stop-resource_split"),startbutton:$("#"+controlbarid+"  .poodll_start-recording_split"),playbackbutton:$("#"+controlbarid+"  .poodll_playback-recording_split"),stopplaybackbutton:$("#"+controlbarid+"  .poodll_stopplayback-recording_split"),savebutton:$("#"+controlbarid+"  .poodll_save-recording_split"),resourceplaybutton:$(".poodll_mediarecorder_button_split.poodll_play-resource_split"),status:$(".poodll_status_split")}},register_controlbar_events_video:function(onMediaSuccess,controlbarid){return this.register_controlbar_events_audio(onMediaSuccess,controlbarid)},do_callback:function(args){if("filesubmitted"===args[1]){var filenamecontrol=document.getElementById(args[3]);null==filenamecontrol&&(filenamecontrol=parent.document.getElementById(args[3])),filenamecontrol&&(filenamecontrol.value=args[2]),$("#responseform input[name=next]").attr("disabled",!1)}},register_controlbar_events_audio:function(onMediaSuccess,controlbarid){var self=this,pmr=this.pmr,ip=this.fetch_instanceprops(controlbarid);this.set_visual_mode("neverrecordedmode",ip),ip.config.callbackjs=self.do_callback,$("#responseform input[name=next]").attr("disabled",!0),ip.controlbar.startbutton.click((function(){pmr.do_start_audio(ip,onMediaSuccess),self.recorded=!0,ip.timer.reset(),ip.timer.start(),self.set_visual_mode("recordingmode",ip)})),ip.controlbar.stopbutton.click((function(){self.do_stop_resource(ip),pmr.do_stop_audio(ip),self.disable_button(this),setTimeout((function(){ip.controlbar.savebutton.click()}),100),ip.timer.stop(),self.set_visual_mode("allstoppedmode",ip)})),ip.controlbar.resourceplaybutton.click((function(){navigator.mediaDevices.getUserMedia({audio:!0}).then((function(stream){ip.controlbar.startbutton.trigger("click"),self.played=!0,""!=ip.config.resource&&self.do_play_resource(ip)})).catch((function(err){alert(err)}))})),ip.controlbar.resourcestopbutton.click((function(){self.do_stop_resource(ip),self.recorded?self.set_visual_mode("allstoppedmode",ip):self.set_visual_mode("neverrecordedmode",ip)})),ip.controlbar.savebutton.click((function(){return self.disable_button(this),ip.blobs&&ip.blobs.length>0?(pmr.do_save_audio(ip),self.uploaded=!0,self.disable_button(ip.controlbar.startbutton)):ip.uploader.Output(M.util.get_string("recui_nothingtosaveerror","filter_poodll")),!1}))},set_completion:function(completed,ip){},do_stop_resource:function(ip){console.log("stopped the resource");var resourceplayer=ip.controlbar.resourceplayer.get(0);if(resourceplayer.pause(),resourceplayer.currentTime=0,ip.mustResetResourcePlayer){ip.mustResetResourcePlayer=!1,resourceplayer.src=ip.config.resource;resourceplayer.load()}},do_play_resource:function(ip){var resourceplayer=ip.controlbar.resourceplayer.get(0);resourceplayer.play(),resourceplayer.currentTime=0},enable_button:function(button){$(button).attr("disabled",!1),$(button).removeClass("pmr_disabled")},disable_button:function(button){$(button).attr("disabled",!0),$(button).addClass("pmr_disabled")}}}));
define('filter_poodll/utils_amd', ["jquery","core/log"],(function($,log){return log.debug("Filter PoodLL: utils initialising"),{timeouthandles:[],WhiteboardUploadHandler:function(recid,wboard,opts,theuploader){$("#"+recid+"_btn_upload_whiteboard")[0].disabled=!0,clearTimeout(this.timeouthandles[recid]);var cvs=this.getCvs(recid,wboard,opts);this.pokeVectorData(recid,wboard,opts),theuploader.uploadFile(cvs.toDataURL(),"image/png")},getCvs:function(recid,wboard){if(0==recid.indexOf("drawingboard_"))var cvs=wboard.canvas;else cvs=wboard.canvasForExport();return cvs},escapeColon:function(thestring){return thestring.replace(/:/,"\\:")},pokeVectorData:function(recid,wboard,opts){var vectordata="";vectordata=0==recid.indexOf("drawingboard_")?JSON.stringify(wboard.history,null,2):JSON.stringify(wboard.getSnapshot()),void 0!==opts.vectorcontrol&&""!==opts.vectorcontrol&&($("#"+this.escapeColon(opts.vectorcontrol)).val(vectordata),log.debug("Vectorcontrol:"+opts.vectorcontrol))},_concatenateWavBlobs:function(blobs,callback){for(var allbytes=[],loadedblobs=0,totalbytes=0,lng=blobs.length,i=0;i<lng;i++)!function(index){var fileReader=new FileReader;fileReader.onload=function(){var ab=this.result,audiodata=ab.slice(44);if(totalbytes+=audiodata.byteLength,allbytes[index]=audiodata,++loadedblobs==lng){var header=ab.slice(0,44);new DataView(header).setUint32(40,totalbytes,!0),allbytes.unshift(header);var wavblob=new Blob(allbytes,{type:"audio/wav"});log.debug(totalbytes),log.debug(allbytes),callback(wavblob)}},fileReader.readAsArrayBuffer(blobs[i])}(i)},_simpleConcatenateBlobs:function(blobs,type){return new Blob(blobs,{type:type})},doConcatenateBlobs:function(theblobs,thecallback){var mimetype=theblobs[0].type;switch(mimetype){case"audio/wav":case"audio/pcm":this._concatenateWavBlobs(theblobs,thecallback);break;default:thecallback(this._simpleConcatenateBlobs(theblobs,mimetype))}},bytesToSize:function(bytes){if(0===bytes)return"0 Bytes";var i=parseInt(Math.floor(Math.log(bytes)/Math.log(1e3)),10);return(bytes/Math.pow(1e3,i)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB"][i]},getTimeLength:function(milliseconds){var data=new Date(milliseconds);return data.getUTCHours()+" hours, "+data.getUTCMinutes()+" minutes and "+data.getUTCSeconds()+" second(s)"},has_mediarecorder:function(){return"undefined"!=typeof MediaRecorder},can_html5_record:function(mediatype){return!!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)&&("audio"==mediatype||this.has_mediarecorder())},is_edge:function(){return navigator.userAgent.indexOf("Edge")>-1},is_chrome:function(){var isChromium=window.chrome,winNav=window.navigator,vendorName=winNav.vendor,isOpera=winNav.userAgent.indexOf("OPR")>-1,isIEedge=winNav.userAgent.indexOf("Edge")>-1;return!!winNav.userAgent.match("CriOS")||null!=isChromium&&"Google Inc."===vendorName&&!1===isOpera&&!1===isIEedge},is_safari:function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},is_ios:function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream},is_opera:function(){return"undefined"!=typeof opera&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("OPR/")},is_android:function(){var ua=window.navigator.userAgent;return ua.indexOf("android")>-1||ua.indexOf("Android")>-1},is_ie:function(){var ms_ie=!1,ua=window.navigator.userAgent,old_ie=ua.indexOf("MSIE "),new_ie=ua.indexOf("Trident/"),edge=ua.indexOf("Edge/");return(old_ie>-1||new_ie>-1||edge>-1)&&(ms_ie=!0),ms_ie},parseQueryString:function(url){var urlParams={};return url.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),(function($0,$1,$2,$3){urlParams[$1]=$3})),urlParams}}}));
define('filter_poodll/poodll_onetwothreemediaskin', ["jquery","core/log","filter_poodll/utils_amd","filter_poodll/anim_progress_bar","filter_poodll/speech_poodll","filter_poodll/dlg_devicesettings","filter_poodll/upskin_bar"],(function($,log,utils,anim_progress_bar,browserrecognition,settings,upskin_bar){return log.debug("PoodLL One Two Three Skin: initialising"),{instanceprops:null,pmr:null,stage:"none",uploaded:!1,devsettings:null,clone:function(){return $.extend(!0,{},this)},init:function(ip,pmr){this.instanceprops=ip,this.pmr=pmr,this.devsettings=settings.clone(),this.devsettings.init(pmr,ip)},fetch_instanceprops:function(){return this.instanceprops},onUploadSuccess:function(controlbarid){$("#"+controlbarid+" > .poodll_save-recording").hide(),$("#"+controlbarid+" > .poodll_savedsuccessfully").show()},onUploadFailure:function(controlbarid){},fetch_status_bar:function(skin){return'<div class="poodll_status_'+skin+'" height="50">00:00:00</div>'},fetch_preview_audio:function(skin){return'<audio class="audio_preview_123 poodll_preview_'+skin+'" style="display: none;" width="100%" height="100%" controls playsinline="playsinline" muted></audio>'},fetch_preview_video:function(skin){return'<video class="video_preview_123 poodll_preview_'+skin+'" width="100%" height="300px" playsinline="playsinline" muted></video>'},fetch_resource_audio:function(skin){return'<audio class="poodll_resourceplayer_'+skin+'" style="display: none;" playsinline="playsinline"></audio>'},fetch_resource_video:function(skin){return'<video class="poodll_resourceplayer_'+skin+'" style="display: none;" playsinline="playsinline"></video>'},fetch_uploader_skin:function(controlbarid,element){var ip=this.fetch_instanceprops(controlbarid),upskin=upskin_bar.clone();return upskin.init(ip.config,element,ip.controlbar.progresscanvas,ip.controlbar.timer),upskin},onMediaError:function(e){console.error("media error",e)},onMediaSuccess_video:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.uploader.Output(""),this.set_visual_mode("recordmode",controlbarid),ip.timer.reset(),ip.timer.start(),this.update_status(controlbarid),this.stage="recorded"},onMediaSuccess_audio:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.uploader.Output(""),this.set_visual_mode("recordmode",controlbarid),ip.timer.reset(),ip.timer.start(),this.update_status(controlbarid),ip.controlbar.preview.attr("src",null),this.stage="recorded"},handle_timer_update:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.status.html(ip.timer.fetch_display_time()),0==ip.timer.seconds&&ip.timer.initseconds>0&&ip.controlbar.stoprecbutton.click()},update_status:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.status.html(ip.timer.fetch_display_time())},set_visual_mode:function(mode,controlbarid){var ip=this.fetch_instanceprops(controlbarid);switch(mode){case"recordmode":ip.controlbar.progress.hide(),ip.controlbar.preview.addClass("poodll_recording"),ip.controlbar.status.addClass("poodll_recording"),"audio"==ip.config.mediatype&&ip.controlbar.preview.addClass("hide"),ip.controlbar.status.removeClass("hide"),this.disable_button(this),this.disable_button(ip.controlbar.playbutton),ip.controlbar.playbutton.show(),this.disable_button(ip.controlbar.stopbutton),ip.controlbar.stopbutton.hide(),this.disable_button(ip.controlbar.savebutton),ip.controlbar.savebutton.show(),this.enable_button(ip.controlbar.stoprecbutton),ip.controlbar.stoprecbutton.show(),ip.controlbar.startbutton.hide();break;case"previewmode":ip.controlbar.playbutton.hide(),this.enable_button(ip.controlbar.stopbutton),ip.controlbar.stopbutton.show(),this.disable_button(ip.controlbar.startbutton),ip.controlbar.startbutton.show(),this.disable_button(ip.controlbar.resumebutton),ip.controlbar.resumebutton.hide(),this.disable_button(ip.controlbar.playbutton),ip.controlbar.preview.removeClass("poodll_recording"),ip.controlbar.status.removeClass("poodll_recording"),"audio"==ip.config.mediatype?ip.controlbar.preview.removeClass("hide"):ip.controlbar.status.removeClass("hide"),ip.controlbar.status.addClass("hide"),ip.controlbar.progresscanvas.hasClass("hide")&&(ip.controlbar.progresscanvas.removeClass("hide"),ip.controlbar.progresscanvas.show()),$(this).hasClass("played")||($(this).addClass("played"),ip.controlbar.steptwo.empty(),ip.controlbar.steptwo.append('<i class="fa fa-check" aria-hidden="true"></i>').hide().fadeIn(1e3));break;case"pausedmode":this.enable_button(ip.controlbar.startbutton),ip.controlbar.startbutton.show(),this.enable_button(ip.controlbar.playbutton),ip.controlbar.playbutton.show(),this.disable_button(ip.controlbar.savebutton),ip.controlbar.savebutton.show(),ip.controlbar.preview.removeClass("poodll_recording"),ip.controlbar.status.removeClass("poodll_recording"),ip.controlbar.stoprecbutton.hide(),ip.controlbar.timer.html("00:00:00"),ip.controlbar.status.addClass("hide"),ip.controlbar.progress.show(),ip.controlbar.stepone.empty(),ip.controlbar.stepone.append('<i class="fa fa-check" aria-hidden="true"></i>').hide().fadeIn(1e3),this.disable_button(ip.controlbar.stoprecbutton);break;case"stopplayingmode":this.uploaded||(this.enable_button(ip.controlbar.savebutton),this.enable_button(ip.controlbar.startbutton)),ip.controlbar.progresscanvas.hasClass("hide")||(ip.controlbar.timer.html("00:00:00"),ip.controlbar.progresscanvas.addClass("hide"),ip.controlbar.progresscanvas.hide()),ip.controlbar.stopbutton.hide(),ip.controlbar.playbutton.show(),ip.controlbar.startbutton.show(),this.enable_button(ip.controlbar.playbutton),this.disable_button(ip.controlbar.stopbutton);break;case"uploadmode":this.disable_button(ip.controlbar.startbutton),ip.controlbar.progresscanvas.removeClass("hide"),ip.controlbar.progresscanvas.show();break;case"savemode":this.disable_button(ip.controlbar.savebutton),ip.controlbar.stepthree.empty(),ip.controlbar.stepthree.append('<i class="fa fa-check" aria-hidden="true"></i>').hide().fadeIn(1e3)}},insert_controlbar_video:function(element,controlbarid,preview,resource){return this.prepare_controlbar(element,controlbarid,preview,resource,"video")},insert_controlbar_audio:function(element,controlbarid,preview,resource){return this.prepare_controlbar(element,controlbarid,preview,resource,"audio")},prepare_controlbar:function(element,controlbarid,preview,resource,mediatype){var ip=this.fetch_instanceprops(controlbarid),skin_style=ip.config.media_skin_style,recorder_class="video"==mediatype?"poodll_mediarecorder_video":"poodll_mediarecorder_audio",size_class="poodll_mediarecorder_size_auto";switch(ip.config.size){case"small":size_class="poodll_mediarecorder_size_small";break;case"big":size_class="poodll_mediarecorder_size_big";break;case"auto":size_class="poodll_mediarecorder_size_auto"}var ss=this.pmr.fetch_strings(),controls='<div class="one-two-three-main-wrapper poodll_mediarecorderholder_onetwothree '+recorder_class+" "+size_class+'" id="holder_'+controlbarid+'">';if(controls+='<div class="modal-box poodll_mediarecorderbox_onetwothree one-two-three-wrap" id="'+controlbarid+'">',controls+='<div class="style-holder '+skin_style+'">',controls+=this.fetch_status_bar("onetwothree"),controls+='<div class="hp_slide" id="slide_'+controlbarid+'">',controls+='<div class="hp_timer"></div><canvas class="hp_range"></canvas></div>',controls+=preview,controls+='<div class="settingsicon" id="settingsicon_'+controlbarid+'"><button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal"><i class="fa fa-cogs" aria-hidden="true"></i></button></div>',"video"==mediatype)var recicon="video-camera";else recicon="microphone";controls+='<button type="button" class="poodll_mediarecorder_button_onetwothree poodll_start-recording_onetwothree"><i class="fa fa-'+recicon+'" aria-hidden="true"></i></button> ',controls+='<button type="button" class="poodll_mediarecorder_button_onetwothree poodll_stop-recording_onetwothree pmr_disabled" style="display: none;" disabled><i class="fa fa-stop" aria-hidden="true"></i></button>',controls+='<button type="button" class="poodll_mediarecorder_button_onetwothree poodll_pause-recording_onetwothree pmr_disabled" style="display: none;" disabled><i class="fa fa-pause" aria-hidden="true"></i></button>',controls+=' <button type="button" class="poodll_mediarecorder_button_onetwothree poodll_resume-recording_onetwothree pmr_disabled" style="display: none;" disabled><i class="fa fa-'+recicon+'" aria-hidden="true"></i></button>',controls+='<button type="button" class="poodll_mediarecorder_button_onetwothree poodll_play-recording_onetwothree pmr_disabled" disabled><i class="fa fa-play" aria-hidden="true"></i></button> ',controls+='<button type="button" class="poodll_mediarecorder_button_onetwothree poodll_stop-playing_onetwothree pmr_disabled" style="display: none;" disabled><i class="fa fa-stop" aria-hidden="true"></i></button>',controls+='<button type="button" class="poodll_mediarecorder_button_onetwothree poodll_save-recording_onetwothree pmr_disabled" disabled><i class="fa fa-upload" aria-hidden="true"></i></button>',controls+='<div style="clear:both;">',controls+='<div class="task-helper">',controls+='<p class="step-1">'+ss.recui_record+"</p>",controls+='<p class="step-2">'+ss.recui_play+"</p>",controls+='<p class="step-3">'+ss.recui_save+"</p>",controls+="</div>",controls+="</div>",controls+="</div>",controls+=this.devsettings.fetch_dialogue_box(),controls+=ip.downloaddialog.fetch_dialogue_box(),controls+=ip.errordialog.fetch_dialogue_box(),controls+="</div>",$(element).prepend(controls);var controlbar={settingsdialog:$("#"+controlbarid+" .poodll_dialogue_box_settings"),downloaddialog:$("#"+controlbarid+" .poodll_dialogue_box_download"),errorsdialog:$("#"+controlbarid+" .poodll_dialogue_box_errors"),settingsicon:$("#"+controlbarid+" .settingsicon"),stepone:$("#"+controlbarid+" .step-1"),steptwo:$("#"+controlbarid+" .step-2"),stepthree:$("#"+controlbarid+" .step-3"),progresscanvas:$("#"+controlbarid+" .hp_range"),progress:$("#"+controlbarid+" .hp_slide"),timer:$("#"+controlbarid+" .hp_timer"),status:$("#"+controlbarid+" .poodll_status_onetwothree"),preview:$("#"+controlbarid+" .poodll_preview_onetwothree"),startbutton:$("#"+controlbarid+" .poodll_start-recording_onetwothree"),stoprecbutton:$("#"+controlbarid+" .poodll_stop-recording_onetwothree"),stopbutton:$("#"+controlbarid+" .poodll_stop-playing_onetwothree"),pausebutton:$("#"+controlbarid+" .poodll_pause-recording_onetwothree"),resumebutton:$("#"+controlbarid+" .poodll_resume-recording_onetwothree"),playbutton:$("#"+controlbarid+" .poodll_play-recording_onetwothree"),savebutton:$("#"+controlbarid+" .poodll_save-recording_onetwothree")};return ip.downloaddialog.set_dialogue_box(controlbar.downloaddialog),ip.errordialog.set_dialogue_box(controlbar.errorsdialog),this.devsettings.set_dialogue_box(controlbar.settingsdialog),controlbar},register_controlbar_events_video:function(onMediaSuccess,controlbarid){return this.register_controlbar_events_audio(onMediaSuccess,controlbarid)},register_controlbar_events_audio:function(onMediaSuccess,controlbarid){var self=this,pmr=this.pmr,ip=(this.stage,this.fetch_instanceprops(controlbarid)),hprogress=anim_progress_bar.clone();hprogress.init(ip.controlbar.progresscanvas),ip.controlbar.settingsicon.click((function(){self.uploaded?ip.downloaddialog.open():self.devsettings.open()})),ip.controlbar.startbutton.click((function(){pmr.do_start_audio(ip,onMediaSuccess)})),ip.controlbar.stoprecbutton.click((function(){pmr.do_stop_audio(ip),self.set_visual_mode("pausedmode",controlbarid),ip.timer.stop(),ip.timer.reset(),self.update_status(controlbarid)})),ip.controlbar.stopbutton.click((function(){self.set_visual_mode("stopplayingmode",controlbarid);var preview=ip.controlbar.preview.get(0);pmr.do_stopplay_audio(ip,preview),hprogress.stop()})),ip.controlbar.playbutton.click((function(){var preview=ip.controlbar.preview.get(0);pmr.do_play_audio(ip,preview),ip.controlbar.preview.on("timeupdate",(function(){var currentTime=this.currentTime;ip.controlbar.timer.html(ip.timer.fetch_display_time(currentTime))})),self.set_visual_mode("previewmode",controlbarid),"played",hprogress.clear(),hprogress.fetchCurrent=function(){var ct=ip.controlbar.preview.prop("currentTime"),duration=ip.controlbar.preview.prop("duration");return isFinite(duration)||(duration=ip.timer.finalseconds),ct/duration},hprogress.start()})),ip.controlbar.savebutton.click((function(){return self.set_visual_mode("savemode",controlbarid),log.debug("save"),ip.blobs&&ip.blobs.length>0?(pmr.do_save_audio(ip),self.uploaded=!0,self.set_visual_mode("uploadmode",controlbarid),"saved"):ip.uploader.Output(M.util.get_string("recui_nothingtosaveerror","filter_poodll")),!1})),window.onbeforeunload=function(){self.enable_button(ip.controlbar.startbutton);var preview=ip.controlbar.preview;preview&&preview.get(0)&&preview.get(0).pause()}},enable_button:function(button){$(button).attr("disabled",!1),$(button).removeClass("pmr_disabled")},disable_button:function(button){$(button).attr("disabled",!0),$(button).addClass("pmr_disabled")}}}));
define('filter_poodll/anim_fbars', ["jquery","core/log"],(function($,log){return log.debug("anim_freq bars: initialising"),{analyser:null,cvs:null,cvsctx:null,clone:function(){return $.extend(!0,{},this)},init:function(analyser,cvs){this.cvs=cvs,this.cvsctx=cvs.getContext("2d"),this.analyser=analyser},clear:function(){this.cvsctx.clearRect(0,0,this.cvs.width,this.cvs.height)},start:function(){this.analyser.core.fftSize=256;var bufferLength=this.analyser.core.frequencyBinCount,dataArray=new Uint8Array(bufferLength),cwidth=this.cvs.width,cheight=this.cvs.height,canvasCtx=this.cvsctx,analyser=this.analyser;this.clear();!function draw(){requestAnimationFrame(draw);if(analyser.theinterval){analyser.core.getByteFrequencyData(dataArray),canvasCtx.clearRect(0,0,cwidth,cheight);for(var barHeight,barWidth=cwidth/bufferLength*2.5,x=0,i=0;i<bufferLength;i++)barHeight=dataArray[i],canvasCtx.fillStyle="rgb("+(barHeight+100)+",50,50)",canvasCtx.fillRect(x,cheight-barHeight/2,barWidth,barHeight/2),x+=barWidth+1}}()}}}));
define('filter_poodll/template_presets_amd', ["jquery","core/log"],(function($,log){return log.debug("Filter Poodll Presets initialising"),{presetdata:!1,dataitems:["name","key","version","instructions","showatto","showplayers","requirecss","requirejs","shim","defaults","amd","body","bodyend","script","style","dataset","datasetvars","alternate","alternateend"],fetchcontrols:function(templateindex){var controls={};return controls.name=document.getElementById("id_s_filter_poodll_templatename_"+templateindex),controls.key=document.getElementById("id_s_filter_poodll_templatekey_"+templateindex),controls.version=document.getElementById("id_s_filter_poodll_templateversion_"+templateindex),controls.instructions=document.getElementById("id_s_filter_poodll_templateinstructions_"+templateindex),controls.showatto=document.getElementById("id_s_filter_poodll_template_showatto_"+templateindex),controls.showplayers=document.getElementById("id_s_filter_poodll_template_showplayers_"+templateindex),controls.requirecss=document.getElementById("id_s_filter_poodll_templaterequire_css_"+templateindex),controls.requirejs=document.getElementById("id_s_filter_poodll_templaterequire_js_"+templateindex),controls.shim=document.getElementById("id_s_filter_poodll_templaterequire_js_shim_"+templateindex),controls.defaults=document.getElementById("id_s_filter_poodll_templatedefaults_"+templateindex),controls.amd=document.getElementById("id_s_filter_poodll_template_amd_"+templateindex),controls.body=document.getElementById("id_s_filter_poodll_template_"+templateindex),controls.bodyend=document.getElementById("id_s_filter_poodll_templateend_"+templateindex),controls.script=document.getElementById("id_s_filter_poodll_templatescript_"+templateindex),controls.style=document.getElementById("id_s_filter_poodll_templatestyle_"+templateindex),controls.dataset=document.getElementById("id_s_filter_poodll_dataset_"+templateindex),controls.datasetvars=document.getElementById("id_s_filter_poodll_datasetvars_"+templateindex),controls.alternate=document.getElementById("id_s_filter_poodll_templatealternate_"+templateindex),controls.alternateend=document.getElementById("id_s_filter_poodll_templatealternate_end_"+templateindex),controls.presetdata=document.getElementById("id_s_filter_poodll_presetdata_"+templateindex),controls},fetchjsonbundle:function(templateindex,controls){var bundle={};$.each(this.dataitems,(function(index,item){bundle[item]=controls[item].value}));var jsonbundle=JSON.stringify(bundle);return jsonbundle},exportbundle:function(templateindex){var controls=this.fetchcontrols(templateindex);if(""!=controls.key.value){var jsonbundle=this.fetchjsonbundle(templateindex,controls),pom=document.createElement("a");if(pom.setAttribute("href","data:text/json;charset=utf-8,"+encodeURIComponent(jsonbundle)),pom.setAttribute("download",controls.key.value+".txt"),document.createEvent){var event=document.createEvent("MouseEvents");event.initEvent("click",!0,!0),pom.dispatchEvent(event)}else pom.click()}},populateform:function(templateindex,presetindex,presetdata){var controls=this.fetchcontrols(templateindex);(presetindex||presetdata)&&(0==presetindex&&presetdata||(presetdata=this.presetdata),$.each(this.dataitems,(function(index,item){if(presetdata[presetindex].hasOwnProperty(item)){if("cleartemplate"!=presetdata[presetindex].key||"key"!=item&&"name"!=item)usevalue=presetdata[presetindex][item];else var usevalue="";controls[item].value=usevalue}else switch(item){case"amd":case"showplayers":case"showatto":controls[item].value=0;break;default:controls[item].value=""}})))},dopopulate:function(templateindex,templatedata){this.populateform(templateindex,0,new Array(templatedata))},init:function(opts){if(!this.presetdata){var controlid="#id_s_filter_poodll_presetdata_"+opts.templateindex,presetcontrol=$(controlid).get(0);this.presetdata=JSON.parse(presetcontrol.value),$(controlid).remove()}var amdpresets=this;$("select[name='filter_poodll/presets']").change((function(){amdpresets.populateform(opts.templateindex,$(this).val())}));var ddsquareid="#id_s_filter_poodll_dragdropsquare_"+opts.templateindex;$(ddsquareid).on("click",(function(){amdpresets.exportbundle(opts.templateindex)})),$(ddsquareid).on("dragover",(function(event){event.preventDefault(),event.stopPropagation(),$(this).addClass("filter_poodll_dragging")})),$(ddsquareid).on("dragleave",(function(event){event.preventDefault(),event.stopPropagation(),$(this).removeClass("filter_poodll_dragging")})),$(ddsquareid).on("drop",(function(event){event.preventDefault();var files=event.originalEvent.dataTransfer.files;if(files.length){var f=files[0];if(f){var r=new FileReader;r.onload=function(e){var contents=e.target.result,templatedata=JSON.parse(contents);templatedata.key&&amdpresets.dopopulate(opts.templateindex,templatedata)},r.readAsText(f)}else alert("Failed to load file")}$(this).removeClass("filter_poodll_dragging")}))}}}));
define('filter_poodll/poodll_scenariomediaskin', ["jquery","core/log","filter_poodll/utils_amd","filter_poodll/upskin_bar"],(function($,log,utils,upskin_bar){return log.debug("PoodLL Scenario Skin: initialising"),{instanceprops:null,pmr:null,uploaded:!1,recorded:!1,played:!1,mustResetResourcePlayer:!1,clone:function(){return $.extend(!0,{},this)},init:function(ip,pmr){this.instanceprops=ip,this.pmr=pmr},fetch_instanceprops:function(){return this.instanceprops},onUploadSuccess:function(controlbarid){$("#"+controlbarid+" > .poodll_save-recording").hide(),$("#"+controlbarid+" > .poodll_savedsuccessfully").show()},onUploadFailure:function(controlbarid){},fetch_status_bar:function(skin){return'<div class="poodll_status_'+skin+'"></div>'},fetch_preview_audio:function(skin){return'<audio class="poodll_checkplayer_'+skin+' hide" controls playsinline="playsinline"></audio>'},fetch_preview_video:function(skin){return'<video class="poodll_checkplayer_'+skin+'" width="320" height="240" playsinline="playsinline"></video>'},fetch_resource_audio:function(skin){return'<audio class="poodll_resourceplayer_'+skin+' hide" src="@@RESOURCEURL@@" playsinline controls></audio>'},fetch_resource_video:function(skin){return'<video class="poodll_resourceplayer_'+skin+' hide" src="@@RESOURCEURL@@" playsinline="playsinline"></video>'},fetch_uploader_skin:function(controlbarid,element){var ip=this.fetch_instanceprops(controlbarid),upskin=upskin_bar.clone();return upskin.init(ip.config,element,ip.controlbar.split_progresscanvas,ip.controlbar.status),upskin},onMediaError:function(e){console.error("media error",e)},onMediaSuccess_video:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.stopbutton.attr("disabled",!1),ip.controlbar.savebutton.attr("disabled",!1)},onMediaSuccess_audio:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.checkplayer.attr("src",null),ip.controlbar.stopbutton.attr("disabled",!1),ip.controlbar.savebutton.attr("disabled",!1)},handle_timer_update:function(controlbarid){if(this.played||this.recorded){var ip=this.fetch_instanceprops(controlbarid),recordingstring=M.util.get_string("recui_recording","filter_poodll");this.update_status(controlbarid,recordingstring+ip.timer.fetch_display_time()),0==ip.timer.seconds&&ip.timer.initseconds>0&&ip.controlbar.stopbutton.click()}},update_status:function(controlbarid,text){this.fetch_instanceprops(controlbarid).controlbar.status.html(text)},set_visual_mode:function(mode,ip){switch(mode){case"recordingmode":this.disable_button(ip.controlbar.resourceplaybutton),ip.controlbar.resourceplaybutton.empty(),ip.controlbar.resourceplaybutton.html('<span class="fa fa-microphone fa-3x"></span>'),ip.controlbar.resourceplaybutton.addClass("poodll_mediarecorderholder_scenario_recordcolor"),ip.controlbar.status.addClass("poodll_mediarecorderholder_scenario_recordcolor"),this.handle_timer_update(ip.controlbarid),this.enable_button(ip.controlbar.stopbutton);break;case"resourceplayingmode":this.disable_button(ip.controlbar.resourceplaybutton),this.disable_button(ip.controlbar.stopbutton);break;case"neverrecordedmode":ip.controlbar.resourceplaybutton.empty(),ip.controlbar.resourceplaybutton.html('<p style="margin-bottom: 0px; font-size: 24px;">Start</p>'),this.enable_button(ip.controlbar.resourceplaybutton),this.disable_button(ip.controlbar.stopbutton),this.update_status(ip.controlbarid,M.util.get_string("recui_ready","filter_poodll"));break;case"allstoppedmode":this.disable_button(ip.controlbar.resourceplaybutton),this.disable_button(ip.controlbar.stopbutton),ip.controlbar.resourceplaybutton.empty(),ip.controlbar.resourceplaybutton.html('<span class="fa fa-check fa-3x"></span>'),ip.controlbar.resourceplaybutton.removeClass("poodll_mediarecorderholder_scenario_recordcolor"),ip.controlbar.status.removeClass("poodll_mediarecorderholder_scenario_recordcolor"),this.update_status(ip.controlbarid,M.util.get_string("recui_finished","filter_poodll"))}},insert_controlbar_video:function(element,controlbarid,checkplayer,resourceplayer){return this.prepare_controlbar(element,controlbarid,checkplayer,resourceplayer,"video")},insert_controlbar_audio:function(element,controlbarid,checkplayer,resourceplayer){return this.prepare_controlbar(element,controlbarid,checkplayer,resourceplayer,"audio")},prepare_controlbar:function(element,controlbarid,checkplayer,resourceplayer,mediatype){var ip=this.fetch_instanceprops(controlbarid),controls='<div class="poodll_mediarecorderholder_scenario '+("video"==mediatype?"poodll_mediarecorder_video":"poodll_mediarecorder_audio")+'" id="holder_'+controlbarid+'">';controls+='<div class="poodll_mediarecorderbox_scenario" id="'+controlbarid+'">',controls+='<div class="style-holder '+ip.config.media_skin_style+'">',controls+=checkplayer,controls+=resourceplayer=resourceplayer.replace("@@RESOURCEURL@@",ip.config.resource),controls+='<button type="button" class="poodll_mediarecorder_button_scenario poodll_start-recording_scenario hide"><span class="fa fa-microphone fa-3x"></span></button>',controls+=' <button type="button" class="poodll_mediarecorder_button_scenario poodll_playback-recording_scenario hide"><span class="fa fa-play-circle fa-3x"></span></button>',controls+=' <button type="button" class="poodll_mediarecorder_button_scenario poodll_stopplayback-recording_scenario hide"><span class="fa fa-stop-circle fa-3x"></span></button>',controls+='<button type="button" class="poodll_save-recording_scenario pmr_disabled hide">'+this.pmr.fetch_strings().recui_save+"</button></div>",controls+='<div class="poodll_mediarecorderholder_scenario"><button type="button" class="poodll_mediarecorder_button_scenario poodll_stop-recording_scenario pmr_disabled" disabled><p style="margin-bottom: 0px;font-size: 24px;">Submit</p></button></div>',controls+='<div class="poodll_statusholder_scenario" >',controls+='<canvas class="scenario_range"></canvas>',controls+=this.fetch_status_bar("scenario"),controls+="</div>",controls+="</div></div></div>",$(element).append(controls);return $(".qtext").prepend("<hr />"),$(".qtext").prepend('<div class="poodll_mediarecorderholder_scenario poodll_mediarecorder_scenario_topscenario"><button type="button" class="poodll_mediarecorder_button_scenario poodll_play-resource_scenario"><p style="margin-bottom: 0px; font-size: 24px;">Start</p></button></div>'),{scenario_progresscanvas:$("#"+controlbarid+" .scenario_range"),marker:$("#"+controlbarid+"  .marker"),resourceplayer:$("#"+controlbarid+"  .poodll_resourceplayer_scenario"),checkplayer:$("#"+controlbarid+"  .poodll_checkplayer_scenario"),stopbutton:$("#"+controlbarid+"  .poodll_stop-recording_scenario"),resourcestopbutton:$("#"+controlbarid+"  .poodll_stop-resource_scenario"),startbutton:$("#"+controlbarid+"  .poodll_start-recording_scenario"),playbackbutton:$("#"+controlbarid+"  .poodll_playback-recording_scenario"),stopplaybackbutton:$("#"+controlbarid+"  .poodll_stopplayback-recording_scenario"),savebutton:$("#"+controlbarid+"  .poodll_save-recording_scenario"),resourceplaybutton:$(".poodll_mediarecorder_button_scenario.poodll_play-resource_scenario"),status:$(".poodll_status_scenario")}},register_controlbar_events_video:function(onMediaSuccess,controlbarid){return this.register_controlbar_events_audio(onMediaSuccess,controlbarid)},do_callback:function(args){if("filesubmitted"===args[1]){var filenamecontrol=document.getElementById(args[3]);null==filenamecontrol&&(filenamecontrol=parent.document.getElementById(args[3])),filenamecontrol&&(filenamecontrol.value=args[2]),$("#responseform input[name=next]").attr("disabled",!1)}},register_controlbar_events_audio:function(onMediaSuccess,controlbarid){var self=this,pmr=this.pmr,ip=this.fetch_instanceprops(controlbarid);this.set_visual_mode("neverrecordedmode",ip),ip.config.callbackjs=self.do_callback,$("#responseform input[name=next]").attr("disabled",!0),ip.controlbar.startbutton.click((function(){pmr.do_start_audio(ip,onMediaSuccess),self.recorded=!0,ip.timer.reset(),ip.timer.start(),self.set_visual_mode("recordingmode",ip)})),ip.controlbar.stopbutton.click((function(){self.do_stop_resource(ip),pmr.do_stop_audio(ip),self.disable_button(this),setTimeout((function(){ip.controlbar.savebutton.click()}),100),ip.timer.stop(),self.set_visual_mode("allstoppedmode",ip)})),ip.controlbar.resourceplaybutton.click((function(){navigator.mediaDevices.getUserMedia({audio:!0}).then((function(stream){ip.controlbar.startbutton.trigger("click"),self.played=!0,""!=ip.config.resource&&self.do_play_resource(ip)})).catch((function(err){alert(err)}))})),ip.controlbar.resourcestopbutton.click((function(){self.do_stop_resource(ip),self.recorded?self.set_visual_mode("allstoppedmode",ip):self.set_visual_mode("neverrecordedmode",ip)})),ip.controlbar.savebutton.click((function(){return self.disable_button(this),ip.blobs&&ip.blobs.length>0?(pmr.do_save_audio(ip),self.uploaded=!0,self.disable_button(ip.controlbar.startbutton)):ip.uploader.Output(M.util.get_string("recui_nothingtosaveerror","filter_poodll")),!1}))},set_completion:function(completed,ip){},do_stop_resource:function(ip){console.log("stopped the resource");var resourceplayer=ip.controlbar.resourceplayer.get(0);if(resourceplayer.pause(),resourceplayer.currentTime=0,ip.mustResetResourcePlayer){ip.mustResetResourcePlayer=!1,resourceplayer.src=ip.config.resource;resourceplayer.load()}},do_play_resource:function(ip){var resourceplayer=ip.controlbar.resourceplayer.get(0);resourceplayer.play(),resourceplayer.currentTime=0},enable_button:function(button){$(button).attr("disabled",!1),$(button).removeClass("pmr_disabled")},disable_button:function(button){$(button).attr("disabled",!0),$(button).addClass("pmr_disabled")}}}));
define('filter_poodll/poodll_burntrosemediaskin', ["jquery","core/log","filter_poodll/utils_amd"],(function($,log,utils){return log.debug("PoodLL Burnt Rose Skin: initialising"),{instanceprops:null,pmr:null,clone:function(){return $.extend(!0,{},this)},init:function(ip,pmr,controlbarid){this.instanceprops=ip,this.pmr=pmr},fetch_instanceprops:function(){return this.instanceprops},onUploadSuccess:function(widgetid){log.debug("from poodllmediarecorder: uploadsuccess");var controlbarid="filter_poodll_controlbar_"+widgetid;$("#"+controlbarid+" > .poodll_save-recording").hide(),$("#"+controlbarid+" > .poodll_savedsuccessfully").show()},onUploadFailure:function(controlbarid){log.debug("from poodllmediarecorder: uploadfailure")},fetch_status_bar:function(skin){return'<div class="poodll_status_'+skin+'" width="320" height="50">00:00:00</div>'},fetch_preview_audio:function(skin){return'<audio class="poodll_preview_'+skin+' hide" controls playsinline="playsinline" muted></audio>'},fetch_preview_video:function(skin){return'<video class="poodll_preview_'+skin+'" width="320" height="240" playsinline="playsinline" muted></video>'},fetch_resource_audio:function(skin){return'<audio class="poodll_resourceplayer_'+skin+' hide" playsinline="playsinline" ></audio>'},fetch_resource_video:function(skin){return'<video class="poodll_resourceplayer_'+skin+' hide" playsinline="playsinline"></video>'},onMediaError:function(e){console.error("media error",e)},onMediaSuccess_video:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.stopbutton.attr("disabled",!1),ip.controlbar.pausebutton.attr("disabled",!1),ip.controlbar.savebutton.attr("disabled",!1)},onMediaSuccess_audio:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.preview.attr("src",null),ip.controlbar.stopbutton.attr("disabled",!1),ip.controlbar.pausebutton.attr("disabled",!1),ip.controlbar.savebutton.attr("disabled",!1)},handle_timer_update:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.status.html(ip.timer.fetch_display_time()),0==ip.timer.seconds&&ip.timer.initseconds>0&&ip.controlbar.stopbutton.click()},update_status:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.status.html(ip.timer.fetch_display_time())},set_visual_mode:function(mode,controlbarid){var ip=this.fetch_instanceprops(controlbarid);switch(mode){case"recordmode":ip.controlbar.preview.addClass("poodll_recording"),ip.controlbar.status.addClass("poodll_recording"),"audio"==ip.config.mediatype&&ip.controlbar.preview.addClass("hide"),ip.controlbar.status.removeClass("hide");break;case"previewmode":case"pausedmode":ip.controlbar.preview.removeClass("poodll_recording"),ip.controlbar.status.removeClass("poodll_recording")}},insert_controlbar_audio:function(element,controlbarid,preview,resource){var ip=this.fetch_instanceprops(controlbarid),skin_style=ip.config.media_skin_style,size_class="poodll_mediarecorder_size_auto";switch(ip.config.size){case"small":size_class="poodll_mediarecorder_size_small";break;case"big":size_class="poodll_mediarecorder_size_big";break;case"auto":size_class="poodll_mediarecorder_size_auto"}var controls='<div class="poodll_mediarecorderbox_burntrose '+skin_style+" "+size_class+'" id="'+controlbarid+'">';return controls+=this.fetch_status_bar("burntrose"),controls+=preview,controls+='<span class="poodll_start-recording" title="'+M.util.get_string("recui_record","filter_poodll")+'"></span>',controls+='<span class="poodll_stop-recording hide" title="'+M.util.get_string("recui_stop","filter_poodll")+'"></span>',controls+='<span class="poodll_pause-recording hide" title="'+M.util.get_string("recui_pause","filter_poodll")+'"></span>',controls+=' <span class="poodll_resume-recording hide"title="'+M.util.get_string("recui_continue","filter_poodll")+'" ></span>',controls+=' <span class="poodll_play-recording" ></span>',controls+=' <span class="poodll_playsave hide" title="'+M.util.get_string("recui_play","filter_poodll")+'" ></span>',controls+=' <span class="poodll_mic" ></span>',controls+=' <span class="poodll_recmic hide" ></span>',controls+=' <span class="poodll_resume_mic hide" ></span>',controls+='<span class="poodll_savebtn" ></span>',controls+='<span class="poodll_save-recording_burntrose hide" title="'+M.util.get_string("recui_save","filter_poodll")+'" ></span>',controls+='<span class="poodll_savedsuccessfully hide"></span>',controls+="</div>",$(element).prepend(controls),{status:$("#"+controlbarid+" .poodll_status_burntrose"),preview:$("#"+controlbarid+" .poodll_preview_burntrose"),startbutton:$("#"+controlbarid+" .poodll_start-recording"),stopbutton:$("#"+controlbarid+"  .poodll_stop-recording"),pausebutton:$("#"+controlbarid+" .poodll_pause-recording"),resumebutton:$("#"+controlbarid+" .poodll_resume-recording"),play1:$("#"+controlbarid+" .poodll_play-recording"),playbutton:$("#"+controlbarid+" > .poodll_playsave"),save1:$("#"+controlbarid+" .poodll_savebtn"),savebutton:$("#"+controlbarid+" .poodll_save-recording_burntrose"),savesuccess:$("#"+controlbarid+" .poodll_savedsuccessfully"),playermic:$("#"+controlbarid+" .poodll_mic"),recordmic:$("#"+controlbarid+" .poodll_recmic"),resumemic:$("#"+controlbarid+" .poodll_resume_mic")}},insert_controlbar_video:function(element,controlbarid,preview,resource){var ip=this.fetch_instanceprops(controlbarid),skin_style=ip.config.media_skin_style,size_class="poodll_mediarecorder_size_auto";switch(ip.config.size){case"small":size_class="poodll_mediarecorder_size_small";break;case"big":size_class="poodll_mediarecorder_size_big";break;case"auto":size_class="poodll_mediarecorder_size_auto"}var controls='<div class="poodll_mediavideobox '+skin_style+" "+size_class+'" id="'+controlbarid+'">';return controls+=this.fetch_status_bar("burntrose"),controls+=preview,controls+='<div class="poodll_mediavideobox2" id="'+controlbarid+'">',controls+='<span class="poodll_start-recording" title="'+M.util.get_string("recui_record","filter_poodll")+'"></span>',controls+='<span class="poodll_stop-recording hide" title="'+M.util.get_string("recui_stop","filter_poodll")+'"></span>',controls+='<span class="poodll_pause-recording hide" title="'+M.util.get_string("recui_pause","filter_poodll")+'" ></span>',controls+=' <span class="poodll_resume-recording hide" title="'+M.util.get_string("recui_continue","filter_poodll")+'"></span>',controls+=' <span class="poodll_play-recording" ></span>',controls+=' <span class="poodll_playsave hide" title="'+M.util.get_string("recui_play","filter_poodll")+'"></span>',controls+=' <span class="poodll_mic hide" ></span>',controls+=' <span class="poodll_recmic hide" ></span>',controls+=' <span class="poodll_resume_mic hide" ></span>',controls+='<span class="poodll_savebtn "title="'+M.util.get_string("recui_save","filter_poodll")+'" ></span>',controls+='<span class="poodll_save-recording_burntrose hide "title="'+M.util.get_string("recui_save","filter_poodll")+'" ></span>',controls+='<span class="poodll_savedsuccessfully hide" ></span>',controls+="</div>",controls+="</div>",$(element).prepend(controls),{status:$("#"+controlbarid+" > .poodll_status_burntrose"),preview:$("#"+controlbarid+" > .poodll_preview_burntrose"),startbutton:$("#"+controlbarid+" > .poodll_start-recording"),stopbutton:$("#"+controlbarid+" > .poodll_stop-recording"),pausebutton:$("#"+controlbarid+" > .poodll_pause-recording"),resumebutton:$("#"+controlbarid+" > .poodll_resume-recording"),play1:$("#"+controlbarid+" > .poodll_play-recording"),playbutton:$("#"+controlbarid+" > .poodll_playsave"),save1:$("#"+controlbarid+" > .poodll_savebtn"),savebutton:$("#"+controlbarid+" > .poodll_save-recording_burntrose"),savesuccess:$("#"+controlbarid+" > .poodll_savedsuccessfully"),playermic:$("#"+controlbarid+"> .poodll_mic"),recordmic:$("#"+controlbarid+"> .poodll_recmic"),resumemic:$("#"+controlbarid+"> .poodll_resume_mic")}},register_controlbar_events_video:function(onMediaSuccess,controlbarid){return this.register_controlbar_events_audio(onMediaSuccess,controlbarid)},register_controlbar_events_audio:function(onMediaSuccess,controlbarid){var self=this,pmr=this.pmr,ip=this.fetch_instanceprops(controlbarid);ip.controlbar.startbutton.click((function(){this.disabled=!1,$("#"+ip.config.widgetid+"_messages").text(""),pmr.do_start_audio(ip,onMediaSuccess),ip.controlbar.playermic.hide(),ip.controlbar.recordmic.show(),ip.controlbar.playbutton.hide(),ip.controlbar.play1.hide(),ip.controlbar.pausebutton.show(),ip.controlbar.pausebutton.attr("disabled",!1),ip.controlbar.startbutton.hide(),ip.controlbar.stopbutton.show(),ip.controlbar.stopbutton.attr("disabled",!1),ip.controlbar.savebutton.hide(),ip.controlbar.savesuccess.hide(),ip.controlbar.save1.show(),self.set_visual_mode("recordmode",controlbarid),ip.timer.reset(),ip.timer.start(),self.update_status(controlbarid)})),ip.controlbar.stopbutton.click((function(){this.disabled=!1,ip.controlbar.stopbutton.hide(),ip.controlbar.startbutton.show(),ip.controlbar.startbutton.attr("disabled",!1),ip.controlbar.resumebutton.hide(),ip.controlbar.pausebutton.hide(),ip.controlbar.play1.hide(),ip.controlbar.playbutton.show(),ip.controlbar.save1.hide(),ip.controlbar.savesuccess.hide(),ip.controlbar.savebutton.show(),ip.controlbar.resumemic.hide(),ip.controlbar.recordmic.hide(),ip.controlbar.playermic.show(),pmr.do_stop_audio(ip);var preview=ip.controlbar.preview;preview&&preview.get(0)&&preview.get(0).pause(),self.set_visual_mode("previewmode",controlbarid),ip.timer.stop(),self.update_status(controlbarid),ip.uploaded||ip.controlbar.startbutton.attr("disabled",!1)})),ip.controlbar.pausebutton.click((function(){this.disabled=!0,$(this).hide(),ip.controlbar.resumebutton.show(),pmr.do_pause_audio(ip),ip.controlbar.resumebutton.attr("disabled",!1),self.set_visual_mode("pausedmode",controlbarid),ip.timer.pause(),self.update_status(controlbarid),ip.controlbar.recordmic.hide(),ip.controlbar.resumemic.show()})),ip.controlbar.resumebutton.click((function(){this.disabled=!0,$(this).hide(),ip.controlbar.pausebutton.show(),pmr.do_resume_audio(ip),ip.controlbar.pausebutton.attr("disabled",!1),self.set_visual_mode("recordmode",controlbarid),ip.timer.resume(),self.update_status(controlbarid),ip.controlbar.resumemic.hide(),ip.controlbar.recordmic.show()})),ip.controlbar.playbutton.click((function(){this.disabled=!1;var preview=ip.controlbar.preview.get(0);if(preview.currentTime>0&&!preview.paused)return preview.pause(),void(preview.currentTime=0);pmr.do_play_audio(ip,preview),ip.controlbar.startbutton.show()})),ip.controlbar.savebutton.click((function(){return this.disabled=!1,ip.blobs&&ip.blobs.length>0?(pmr.do_save_audio(ip),ip.uploaded=!0,ip.controlbar.startbutton.attr("disabled",!0)):ip.uploader.Output(M.util.get_string("recui_nothingtosaveerror","filter_poodll")),!1})),window.onbeforeunload=function(){ip.controlbar.startbutton.attr("disabled",!1);var preview=ip.controlbar.preview;preview&&preview.get(0)&&preview.get(0).pause()}}}}));
define('filter_poodll/responsiveiframe', ["jquery","core/log"],(function($,log){return log.debug("responsive iframe initialising"),{defheight:150,defwidth:300,init:function(config){var theiframe=$("#"+config.iframeid);if(0==theiframe.length&&(theiframe=$("#"+config.iframeid,window.parent.document)),theiframe.length>0){var iframeprops={currentheight:this.defheight,currentwidth:this.defwidth,theiframe:theiframe,thisref:this};this._iframeResize(iframeprops)}},_iframeResize:function(iframeprops){var theiframe=iframeprops.theiframe;if(theiframe&&!(theiframe.length<1)){var newheight=theiframe[0].contentWindow.document.body.scrollHeight,newwidth=theiframe[0].contentWindow.document.body.scrollWidth;newheight==iframeprops.currentheight&&newwidth==iframeprops.currentwidth||(theiframe.attr("height",newheight+"px"),theiframe.attr("width",newwidth+"px")),iframeprops.currentheight=newheight,iframeprops.currentwidth=newwidth,setTimeout(iframeprops.thisref._iframeResize,100,iframeprops)}}}}));
define('filter_poodll/radialprogress', ["jquery","core/log"],function(a,b){"use strict";return b.debug("Radial Progress: initialising"),{playcanvas:null,context:null,x:null,y:null,currenttime:0,enabled:!1,clone:function(){return a.extend(!0,{},this)},init:function(a){this.playcanvas=a.get(0),this.x=this.playcanvas.width/2,this.y=this.playcanvas.height/2,this.context=this.playcanvas.getContext("2d"),this.context.lineWidth=10,this.context.strokeStyle="#ad2323",this.context.setLineDash([15,5]),this.context.shadowOffsetX=0,this.context.shadowOffsetY=0,this.context.shadowBlur=10,this.context.shadowColor="#fff"},clear:function(){this.context.clearRect(0,0,this.playcanvas.width,this.playcanvas.height)},fetchCurrent:function(){return 0},stop:function(){this.enabled=!1,this.clear()},start:function(){this.clear(),this.enabled=!0;var a=this,b=function(){if(a.enabled){var c=65,d=!1,e=2*Math.PI,f=Math.PI/2;a.context.beginPath(),a.context.arc(a.x,a.y,c,-f,e*a.fetchCurrent()-f,d),a.context.stroke();var g=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;g(b)}};b()}}});
define('format_grid/tooltip', ["jquery","core/log"],function(a,b){"use strict";function c(){var a=document.createElement("bootstrap"),b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var c in b)if(void 0!==a.style[c])return{end:b[c]};return!1}function d(b){return this.each(function(){var c=a(this),d=c.data("bs.gridtooltip"),f="object"==typeof b&&b;!d&&/destroy|hide/.test(b)||(d||c.data("bs.gridtooltip",d=new e(this,f)),"string"==typeof b&&d[b]())})}a.fn.emulateTransitionEnd=function(b){var c=!1,d=this;a(this).one("bsTransitionEnd",function(){c=!0});var e=function(){c||a(d).trigger(a.support.transition.end)};return setTimeout(e,b),this},a(function(){a.support.transition=c(),a.support.transition&&(a.event.special.bsTransitionEnd={bindType:a.support.transition.end,delegateType:a.support.transition.end,handle:function(b){if(a(b.target).is(this))return b.handleObj.handler.apply(this,arguments)}})});var e=function(a,b){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("gridtooltip",a,b)};e.VERSION="3.3.7",e.TRANSITION_DURATION=150,e.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},e.prototype.init=function(b,c,d){if(this.enabled=!0,this.type=b,this.$element=a(c),this.options=this.getOptions(d),this.$viewport=this.options.viewport&&a(a.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var e=this.options.trigger.split(" "),f=e.length;f--;){var g=e[f];if("click"==g)this.$element.on("click."+this.type,this.options.selector,a.proxy(this.toggle,this));else if("manual"!=g){var h="hover"==g?"mouseenter":"focusin",i="hover"==g?"mouseleave":"focusout";this.$element.on(h+"."+this.type,this.options.selector,a.proxy(this.enter,this)),this.$element.on(i+"."+this.type,this.options.selector,a.proxy(this.leave,this))}}this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},e.prototype.getDefaults=function(){return e.DEFAULTS},e.prototype.getOptions=function(b){return b=a.extend({},this.getDefaults(),this.$element.data(),b),b.delay&&"number"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},e.prototype.getDelegateOptions=function(){var b={},c=this.getDefaults();return this._options&&a.each(this._options,function(a,d){c[a]!=d&&(b[a]=d)}),b},e.prototype.enter=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);return c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),b instanceof a.Event&&(c.inState["focusin"==b.type?"focus":"hover"]=!0),c.tip().hasClass("in")||"in"==c.hoverState?void(c.hoverState="in"):(clearTimeout(c.timeout),c.hoverState="in",c.options.delay&&c.options.delay.show?void(c.timeout=setTimeout(function(){"in"==c.hoverState&&c.show()},c.options.delay.show)):c.show())},e.prototype.isInStateTrue=function(){for(var a in this.inState)if(this.inState[a])return!0;return!1},e.prototype.leave=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);if(c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),b instanceof a.Event&&(c.inState["focusout"==b.type?"focus":"hover"]=!1),!c.isInStateTrue())return clearTimeout(c.timeout),c.hoverState="out",c.options.delay&&c.options.delay.hide?void(c.timeout=setTimeout(function(){"out"==c.hoverState&&c.hide()},c.options.delay.hide)):c.hide()},e.prototype.show=function(){var b=a.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(b);var c=a.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(b.isDefaultPrevented()||!c)return;var d=this,f=this.tip(),g=this.getUID(this.type);this.setContent(),f.attr("id",g),this.$element.attr("aria-describedby",g),this.options.animation&&f.addClass("fade");var h="function"==typeof this.options.placement?this.options.placement.call(this,f[0],this.$element[0]):this.options.placement,i=/\s?auto?\s?/i,j=i.test(h);j&&(h=h.replace(i,"")||"top");var k={top:0,left:0,display:"block"};f.detach().css(k).addClass(h).data("bs."+this.type,this),this.options.container?f.appendTo(this.options.container):f.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var l=this.getPosition(),m=f[0].offsetWidth,n=f[0].offsetHeight;if(j){var o=h,p=this.getPosition(this.$viewport);h="bottom"==h&&l.bottom+n>p.bottom?"top":"top"==h&&l.top-n<p.top?"bottom":"right"==h&&l.right+m>p.width?"left":"left"==h&&l.left-m<p.left?"right":h,f.removeClass(o).addClass(h)}var q=this.getCalculatedOffset(h,l,m,n);this.applyPlacement(q,h);var r=function(){var a=d.hoverState;d.$element.trigger("shown.bs."+d.type),d.hoverState=null,"out"==a&&d.leave(d)};a.support.transition&&this.$tip.hasClass("fade")?f.one("bsTransitionEnd",r).emulateTransitionEnd(e.TRANSITION_DURATION):r()}},e.prototype.applyPlacement=function(b,c){var d=this.tip(),e=d[0].offsetWidth,f=d[0].offsetHeight,g=parseInt(d.css("margin-top"),10),h=parseInt(d.css("margin-left"),10);isNaN(g)&&(g=0),isNaN(h)&&(h=0),b.top+=g,b.left+=h,a.offset.setOffset(d[0],a.extend({using:function(a){d.css({top:Math.round(a.top),left:Math.round(a.left)})}},b),0),d.addClass("in");var i=d[0].offsetWidth,j=d[0].offsetHeight;"top"==c&&j!=f&&(b.top=b.top+f-j);var k=this.getViewportAdjustedDelta(c,b,i,j);k.left?b.left+=k.left:b.top+=k.top;var l=/top|bottom/.test(c),m=l?2*k.left-e+i:2*k.top-f+j,n=l?"offsetWidth":"offsetHeight";d.offset(b),this.replaceArrow(m,d[0][n],l)},e.prototype.replaceArrow=function(a,b,c){this.arrow().css(c?"left":"top",50*(1-a/b)+"%").css(c?"top":"left","")},e.prototype.setContent=function(){var a=this.tip(),b=this.getTitle();a.find(".tooltip-inner")[this.options.html?"html":"text"](b),a.removeClass("fade in top bottom left right")},e.prototype.hide=function(b){function c(){"in"!=d.hoverState&&f.detach(),d.$element&&d.$element.removeAttr("aria-describedby").trigger("hidden.bs."+d.type),b&&b()}var d=this,f=a(this.$tip),g=a.Event("hide.bs."+this.type);if(this.$element.trigger(g),!g.isDefaultPrevented())return f.removeClass("in"),a.support.transition&&f.hasClass("fade")?f.one("bsTransitionEnd",c).emulateTransitionEnd(e.TRANSITION_DURATION):c(),this.hoverState=null,this},e.prototype.fixTitle=function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("data-original-title"))&&a.attr("data-original-title",a.attr("title")||"").attr("title","")},e.prototype.hasContent=function(){return this.getTitle()},e.prototype.getPosition=function(b){b=b||this.$element;var c=b[0],d="BODY"==c.tagName,e=c.getBoundingClientRect();null==e.width&&(e=a.extend({},e,{width:e.right-e.left,height:e.bottom-e.top}));var f=window.SVGElement&&c instanceof window.SVGElement,g=d?{top:0,left:0}:f?null:b.offset(),h={scroll:d?document.documentElement.scrollTop||document.body.scrollTop:b.scrollTop()},i=d?{width:a(window).width(),height:a(window).height()}:null;return a.extend({},e,h,i,g)},e.prototype.getCalculatedOffset=function(a,b,c,d){return"bottom"==a?{top:b.top+b.height,left:b.left+b.width/2-c/2}:"top"==a?{top:b.top-d,left:b.left+b.width/2-c/2}:"left"==a?{top:b.top+b.height/2-d/2,left:b.left-c}:{top:b.top+b.height/2-d/2,left:b.left+b.width}},e.prototype.getViewportAdjustedDelta=function(a,b,c,d){var e={top:0,left:0};if(!this.$viewport)return e;var f=this.options.viewport&&this.options.viewport.padding||0,g=this.getPosition(this.$viewport);if(/right|left/.test(a)){var h=b.top-f-g.scroll,i=b.top+f-g.scroll+d;h<g.top?e.top=g.top-h:i>g.top+g.height&&(e.top=g.top+g.height-i)}else{var j=b.left-f,k=b.left+f+c;j<g.left?e.left=g.left-j:k>g.right&&(e.left=g.left+g.width-k)}return e},e.prototype.getTitle=function(){var a,b=this.$element,c=this.options;return a=b.attr("data-original-title")||("function"==typeof c.title?c.title.call(b[0]):c.title)},e.prototype.getUID=function(a){do a+=~~(1e6*Math.random());while(document.getElementById(a));return a},e.prototype.tip=function(){if(!this.$tip&&(this.$tip=a(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},e.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},e.prototype.enable=function(){this.enabled=!0},e.prototype.disable=function(){this.enabled=!1},e.prototype.toggleEnabled=function(){this.enabled=!this.enabled},e.prototype.toggle=function(b){var c=this;b&&(c=a(b.currentTarget).data("bs."+this.type),c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c))),b?(c.inState.click=!c.inState.click,c.isInStateTrue()?c.enter(c):c.leave(c)):c.tip().hasClass("in")?c.leave(c):c.enter(c)},e.prototype.destroy=function(){var a=this;clearTimeout(this.timeout),this.hide(function(){a.$element.off("."+a.type).removeData("bs."+a.type),a.$tip&&a.$tip.detach(),a.$tip=null,a.$arrow=null,a.$viewport=null,a.$element=null})};var f=a.fn.gridtooltip;return a.fn.gridtooltip=d,a.fn.gridtooltip.Constructor=e,a.fn.gridtooltip.noConflict=function(){return a.fn.gridtooltip=f,this},b.debug("Grid Format AMD"),{init:function(){a(document).ready(function(a){a("[data-toggle=gridtooltip]").gridtooltip()}),b.debug("Grid Format AMD init")}}});
/**
 * Module to navigation between users in a course.
 *
 * @package    report_competency
 * @copyright  2015 Damyon Wiese
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("report_competency/user_course_navigation",["jquery"],(function($){var UserCourseNavigation=function(userSelector,moduleSelector,baseUrl,userId,courseId,moduleId){this._baseUrl=baseUrl,this._userId=userId+"",this._courseId=courseId,this._moduleId=moduleId,$(userSelector).on("change",this._userChanged.bind(this)),$(moduleSelector).on("change",this._moduleChanged.bind(this))};return UserCourseNavigation.prototype._userChanged=function(e){M.util.js_pending("report_competency/user_course_navigation:_userChanged");var queryStr="?user="+$(e.target).val()+"&id="+this._courseId+"&mod="+this._moduleId;document.location=this._baseUrl+queryStr},UserCourseNavigation.prototype._moduleChanged=function(e){M.util.js_pending("report_competency/user_course_navigation:_moduleChanged");var queryStr="?mod="+$(e.target).val()+"&id="+this._courseId+"&user="+this._userId;document.location=this._baseUrl+queryStr},UserCourseNavigation.prototype._userId=null,UserCourseNavigation.prototype._moduleId=null,UserCourseNavigation.prototype._courseId=null,UserCourseNavigation.prototype._baseUrl=null,UserCourseNavigation}));
/**
 * Module to enable inline editing of a comptency grade.
 *
 * @package    report_competency
 * @copyright  2015 Damyon Wiese
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("report_competency/grading_popup",["jquery","core/notification","core/str","core/ajax","core/log","core/templates","tool_lp/dialogue"],(function($,notification,str,ajax,log,templates,Dialogue){var GradingPopup=function(regionSelector,userCompetencySelector){this._regionSelector=regionSelector,this._userCompetencySelector=userCompetencySelector,$(this._regionSelector).on("click",this._userCompetencySelector,this._handleClick.bind(this))};return GradingPopup.prototype._handleClick=function(e){var cell=$(e.target).closest(this._userCompetencySelector),competencyId=$(cell).data("competencyid"),courseId=$(cell).data("courseid"),userId=$(cell).data("userid");log.debug("Clicked on cell: competencyId="+competencyId+", courseId="+courseId+", userId="+userId);var requests=ajax.call([{methodname:"tool_lp_data_for_user_competency_summary_in_course",args:{userid:userId,competencyid:competencyId,courseid:courseId}},{methodname:"core_competency_user_competency_viewed_in_course",args:{userid:userId,competencyid:competencyId,courseid:courseId}}]);$.when(requests[0],requests[1]).then(this._contextLoaded.bind(this)).catch(notification.exception)},GradingPopup.prototype._contextLoaded=function(context){return context.displayuser=!0,M.util.js_pending("report_competency/grading_popup:_contextLoaded"),$.when(str.get_string("usercompetencysummary","report_competency"),templates.render("tool_lp/user_competency_summary_in_course",context)).then(function(title,templateData){return new Dialogue(title,templateData[0],(function(){templates.runTemplateJS(templateData[1]),M.util.js_complete("report_competency/grading_popup:_contextLoaded")}),this._refresh.bind(this),!0)}.bind(this))},GradingPopup.prototype._refresh=function(){var region=$(this._regionSelector),courseId=region.data("courseid"),moduleId=region.data("moduleid"),userId=region.data("userid");return""===moduleId&&(moduleId=0),ajax.call([{methodname:"report_competency_data_for_report",args:{courseid:courseId,userid:userId,moduleid:moduleId},done:this._pageContextLoaded.bind(this),fail:notification.exception}])},GradingPopup.prototype._pageContextLoaded=function(context){templates.render("report_competency/report",context).then(function(html,js){templates.replaceNode(this._regionSelector,html,js)}.bind(this)).catch(notification.exception)},GradingPopup.prototype._regionSelector=null,GradingPopup.prototype._userCompetencySelector=null,GradingPopup}));
/**
 * Message users.
 *
 * @module     report_insights/message_users
 * @package    report_insights
 * @copyright  2019 David Monllao
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("report_insights/message_users",["jquery","core/str","core/log","core/modal_factory","core/modal_events","core/templates","core/notification","core/ajax"],(function($,Str,Log,ModalFactory,ModalEvents,Templates,Notification,Ajax){var SELECTORS_BULKACTIONSELECT="#formactionid",MessageUsers=function(rootNode,actionName){this.actionName=actionName,this.attachEventListeners(rootNode)};return MessageUsers.prototype.actionName=null,MessageUsers.prototype.modal=null,MessageUsers.prototype.attachEventListeners=function(rootNode){$(rootNode+" button[data-bulk-sendmessage]").on("click",function(e){e.preventDefault();var cTarget=$(e.currentTarget),users={},predictionToUserMapping=cTarget.data("prediction-to-user-id");return $('.insights-list input[data-togglegroup^="insight-bulk-action"][data-toggle="slave"]:checked').each((function(index,value){var predictionId=$(value).closest("tr[data-prediction-id]").data("prediction-id");if(void 0!==predictionToUserMapping[predictionId]){var userId=predictionToUserMapping[predictionId];users[predictionId]=userId}else Log.error("Unknown user for prediction "+predictionId)})),0===Object.keys(users).length||this.showSendMessage(users),this}.bind(this))},MessageUsers.prototype.showSendMessage=function(users){var userIds=new Set(Object.values(users));if(0==userIds.length)return $.Deferred().resolve().promise();var titlePromise=null;return titlePromise=1==userIds.size?Str.get_string("sendbulkmessagesingle","core_message"):Str.get_string("sendbulkmessage","core_message",userIds.size),$.when(ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,body:Templates.render("core_user/send_bulk_message",{})}),titlePromise).then(function(modal,title){return this.modal=modal,this.modal.setTitle(title),this.modal.setSaveButtonText(title),this.modal.getRoot().on(ModalEvents.hidden,function(){$(SELECTORS_BULKACTIONSELECT).focus(),this.modal.getRoot().remove()}.bind(this)),this.modal.getRoot().on(ModalEvents.save,this.submitSendMessage.bind(this,users)),this.modal.show(),this.modal}.bind(this))},MessageUsers.prototype.submitSendMessage=function(users){var messageText=this.modal.getRoot().find("form textarea").val(),messages=[];new Set(Object.values(users)).forEach((function(userId){messages.push({touserid:userId,text:messageText})}));var actionName=this.actionName,message=null;return Ajax.call([{methodname:"core_message_send_instant_messages",args:{messages:messages}}])[0].then((function(messageIds){return 1==messageIds.length?Str.get_string("sendbulkmessagesentsingle","core_message"):Str.get_string("sendbulkmessagesent","core_message",messageIds.length)})).then((function(msg){return message=msg,Ajax.call([{methodname:"report_insights_action_executed",args:{actionname:actionName,predictionids:Object.keys(users)}}])[0]})).then((function(){return Notification.addNotification({message:message,type:"success"}),!0})).catch(Notification.exception)},{init:function(rootNode,actionName){return new MessageUsers(rootNode,actionName)}}}));
/**
 * Module to manage report insights actions that are executed using AJAX.
 *
 * @package    report_insights
 * @copyright  2017 David Monllao {@link http://www.davidmonllao.com}
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("report_insights/actions",["jquery","core/str","core/ajax","core/notification","core/url","core/modal_factory","core/modal_events"],(function($,Str,Ajax,Notification,Url,ModalFactory,ModalEvents){return{initBulk:function(rootNode){$(rootNode+" [data-bulk-actionname]").on("click",(function(e){e.preventDefault();var action=$(e.currentTarget),actionName=action.data("bulk-actionname"),actionVisibleName=action.text().trim(),predictionIds=[],predictionContainers=[];if($('.insights-list input[data-togglegroup^="insight-bulk-action-"][data-toggle="slave"]:checked').each((function(){var container=$(this).closest("tr[data-prediction-id]");predictionContainers.push(container),predictionIds.push(container.data("prediction-id"))})),0===predictionIds.length)return this;var strings=[];return Str.get_strings([{key:"confirmbulkaction",component:"report_insights",param:{action:actionVisibleName,nitems:predictionIds.length}},{key:"confirm",component:"moodle"}]).then((function(strs){return strings=strs,ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:actionVisibleName,body:strings[0]})})).then((function(modal){return modal.setSaveButtonText(strings[1]),modal.show(),modal.getRoot().on(ModalEvents.save,(function(){return function(predictionIds,predictionContainers,actionName){return Ajax.call([{methodname:"report_insights_action_executed",args:{predictionids:predictionIds,actionname:actionName}}])[0].then((function(){var tableNode=!1;if(predictionContainers.forEach((function(el){!1===tableNode&&(tableNode=el.closest("table")),el.remove()})),0===tableNode.find("tbody > tr").length){var params={contextid:tableNode.closest("div.insight-container").data("context-id"),modelid:tableNode.closest("div.insight-container").data("model-id")};window.location.assign(Url.relativeUrl("report/insights/insights.php",params,!1))}})).catch(Notification.exception)}(predictionIds,predictionContainers,actionName)})),modal})).catch(Notification.exception),this}))}}}));
define("report_participation/participants",["exports","jquery","core/custom_interaction_events","core/modal_events","core/notification","core_user/local/participants/bulkactions"],(function(_exports,_jquery,_custom_interaction_events,_modal_events,_notification,_bulkactions){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Some UI stuff for participants page.
   * This is also used by the report/participants/index.php because it has the same functionality.
   *
   * @module     core_user/participants
   * @package    core_user
   * @copyright  2017 Damyon Wiese
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_custom_interaction_events=_interopRequireDefault(_custom_interaction_events),_modal_events=_interopRequireDefault(_modal_events),_notification=_interopRequireDefault(_notification);var Selectors_bulkActionSelect="#formactionid",Selectors_bulkUserSelectedCheckBoxes="input[data-togglegroup^='participants-table'][data-toggle='slave']:checked",Selectors_participantsForm="#participantsform";_exports.init=function(){var root=document.querySelector(Selectors_participantsForm),resetBulkAction=function(bulkActionSelect){bulkActionSelect.value=""};_custom_interaction_events.default.define(Selectors_bulkActionSelect,[_custom_interaction_events.default.events.accessibleChange]),(0,_jquery.default)(Selectors_bulkActionSelect).on(_custom_interaction_events.default.events.accessibleChange,(function(e){var action=e.target.value,checkboxes=root.querySelectorAll(Selectors_bulkUserSelectedCheckBoxes);if(-1!==action.indexOf("#")){e.preventDefault();var ids=[];checkboxes.forEach((function(checkbox){ids.push(checkbox.getAttribute("name").replace("user",""))})),"#messageselect"===action&&(0,_bulkactions.showSendMessage)(ids).then((function(modal){return modal.getRoot().on(_modal_events.default.hidden,(function(){var bulkActionSelector=root.querySelector(Selectors_bulkActionSelect);resetBulkAction(bulkActionSelector),bulkActionSelector.focus()})),modal})).catch(_notification.default.exception)}else""!==action&&checkboxes.length&&e.target.form().submit();resetBulkAction(e.target)}))}}));
/**
 * AMD module to handle overriding activity completion status.
 *
 * @module     report_progress/completion_override
 * @package    report_progress
 * @copyright  2016 onwards Eiz Eddin Al Katrib <eiz@barasoft.co.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("report_progress/completion_override",["jquery","core/ajax","core/str","core/modal_factory","core/modal_events","core/notification","core/custom_interaction_events","core/templates"],(function($,Ajax,Str,ModalFactory,ModalEvents,Notification,CustomEvents,Templates){var userFullName,triggerElement,userConfirm=function(e,data){data.originalEvent.preventDefault(),data.originalEvent.stopPropagation(),e.preventDefault(),e.stopPropagation();var elemData=(triggerElement=$(e.currentTarget)).data("changecompl").split("-"),override={userid:elemData[0],cmid:elemData[1],newstate:elemData[2]},newStateStr=1==override.newstate?"completion-y":"completion-n";Str.get_strings([{key:newStateStr,component:"completion"}]).then((function(strings){return Str.get_strings([{key:"confirm",component:"moodle"},{key:"areyousureoverridecompletion",component:"completion",param:strings[0]}])})).then((function(strings){return ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:strings[0],body:strings[1]})})).then((function(modal){modal.getRoot().on(ModalEvents.save,(function(){!function(override){Templates.render("core/loading",{}).then((function(html){return triggerElement.append(html),Ajax.call([{methodname:"core_completion_override_activity_completion_status",args:override}])[0]})).then((function(results){var completionState=results.state>0?1:0,tooltipKey=completionState?"completion-y-override":"completion-n-override";Str.get_string(tooltipKey,"completion",userFullName).then((function(stateString){var params={state:stateString,date:"",user:triggerElement.attr("data-userfullname"),activity:triggerElement.attr("data-activityname")};return Str.get_string("progress-title","completion",params)})).then((function(titleString){var tracking,completionTracking=triggerElement.attr("data-completiontracking");return Templates.renderPix((tracking=completionTracking,completionState>0?"i/completion-"+tracking+"-y-override":"i/completion-"+tracking+"-n-override"),"core",titleString)})).then((function(html){var oppositeState=completionState>0?0:1;triggerElement.find(".loading-icon").remove(),triggerElement.data("changecompl",override.userid+"-"+override.cmid+"-"+oppositeState),triggerElement.attr("data-changecompl",override.userid+"-"+override.cmid+"-"+oppositeState),triggerElement.children("img").replaceWith(html)})).catch(Notification.exception)})).catch(Notification.exception)}(override)})),modal.getRoot().on(ModalEvents.hidden,(function(){triggerElement.focus(),modal.destroy()})),modal.show()})).catch(Notification.exception)};return{init:function(fullName){userFullName=fullName,$("#completion-progress a.changecompl").each((function(index,element){CustomEvents.define(element,[CustomEvents.events.activate])})),$("#completion-progress").on(CustomEvents.events.activate,"a.changecompl",(function(e,data){userConfirm(e,data)}))}}}));
define("gradingform_guide/grades/grader/gradingpanel/comments/selectors",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;return _exports.default={frequentComment:'[data-gradingform_guide-role="frequent-comment"]',criterion:'[data-gradingform-guide-role="criterion"]',remark:'[data-gradingform-guide-role="remark"]'},_exports.default}));
define("gradingform_guide/grades/grader/gradingpanel/comments",["exports","./comments/selectors"],(function(_exports,_selectors){var obj;
/**
   * Grading panel frequently used comments selector.
   *
   * @module     gradingform_guide/grades/grader/gradingpanel/comments
   * @package    gradingform_guide
   * @copyright  2019 Andrew Nicols <andrew@nicols.co.uk>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_selectors=(obj=_selectors)&&obj.__esModule?obj:{default:obj};_exports.init=function(rootId){document.querySelector("#".concat(rootId)).addEventListener("click",(function(e){if(e.target.matches(_selectors.default.frequentComment)){e.preventDefault();var clicked=e.target.closest(_selectors.default.frequentComment),remark=clicked.closest(_selectors.default.criterion).querySelector(_selectors.default.remark);remark&&(remark.value.trim()?remark.value+="\n".concat(clicked.innerHTML):remark.value+=clicked.innerHTML)}}))}}));
define("gradingform_guide/grades/grader/gradingpanel",["exports","core/ajax","core_grades/grades/grader/gradingpanel/normalise","core_grades/grades/grader/gradingpanel/comparison","jquery"],(function(_exports,_ajax,_normalise,_comparison,_jquery){var obj;function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.storeCurrentGrade=_exports.fetchCurrentGrade=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};_exports.fetchCurrentGrade=function(component,contextid,itemname,gradeduserid){return(0,_ajax.call)([{methodname:"gradingform_guide_grader_gradingpanel_fetch",args:{component:component,contextid:contextid,itemname:itemname,gradeduserid:gradeduserid}}])[0]};var fn,_ref,storeCurrentGrade=(fn=regeneratorRuntime.mark((function _callee(component,contextid,itemname,gradeduserid,notifyUser,rootNode){var form;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(form=rootNode.querySelector("form"),!0!==(0,_comparison.compareData)(form)){_context.next=9;break}return _context.t0=_normalise.normaliseResult,_context.next=5,(0,_ajax.call)([{methodname:"gradingform_guide_grader_gradingpanel_store",args:{component:component,contextid:contextid,itemname:itemname,gradeduserid:gradeduserid,notifyuser:notifyUser,formdata:(0,_jquery.default)(form).serialize()}}])[0];case 5:return _context.t1=_context.sent,_context.abrupt("return",(0,_context.t0)(_context.t1));case 9:return _context.abrupt("return","");case 10:case"end":return _context.stop()}}),_callee)})),_ref=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(_x,_x2,_x3,_x4,_x5,_x6){return _ref.apply(this,arguments)});_exports.storeCurrentGrade=storeCurrentGrade}));
/**
 * AMD code for the frequently used comments chooser for the marking guide grading form.
 *
 * @module     gradingform_guide/comment_chooser
 * @class      comment_chooser
 * @package    core
 * @copyright  2015 Jun Pataleta <jun@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
  */
define("gradingform_guide/comment_chooser",["jquery","core/templates","core/notification","core/yui"],(function($,templates,notification){return{initialise:function(criterionId,buttonId,remarkId,commentOptions){function generateCommentsChooser(){var context={criterionId:criterionId,comments:commentOptions};templates.render("gradingform_guide/comment_chooser",context).done((function(compiledSource){!function(compiledSource,comments){var titleLabel="<label>"+M.util.get_string("insertcomment","gradingform_guide")+"</label>",cancelButtonId="comment-chooser-"+criterionId+"-cancel",cancelButton='<button id="'+cancelButtonId+'">'+M.util.get_string("cancel","moodle")+"</button>",chooserDialog=new M.core.dialogue({modal:!0,headerContent:titleLabel,bodyContent:compiledSource,footerContent:cancelButton,focusAfterHide:"#"+remarkId,id:"comments-chooser-dialog-"+criterionId});$("#"+cancelButtonId).click((function(){chooserDialog.hide()})),$.each(comments,(function(index,comment){var commentOptionId="#comment-option-"+criterionId+"-"+comment.id;$(commentOptionId).click((function(){var remarkTextArea=$("#"+remarkId),remarkText=remarkTextArea.val();""!==remarkText.trim()&&(remarkText+="\n"),remarkText+=comment.description,remarkTextArea.val(remarkText),chooserDialog.hide()})),$(document).off("keypress",commentOptionId).on("keypress",commentOptionId,(function(){var keyCode=event.which||event.keyCode;13!=keyCode&&32!=keyCode||$(commentOptionId).click()}))})),chooserDialog.after("visibleChange",(function(e){e.prevVal&&!e.newVal&&this.destroy()}),chooserDialog),chooserDialog.show()}(compiledSource,commentOptions)})).fail(notification.exception)}$("#"+buttonId).click((function(e){e.preventDefault(),generateCommentsChooser()}))}}}));
define("gradingform_rubric/grades/grader/gradingpanel",["exports","core/ajax","core_grades/grades/grader/gradingpanel/normalise","core_grades/grades/grader/gradingpanel/comparison","jquery"],(function(_exports,_ajax,_normalise,_comparison,_jquery){var obj;function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.storeCurrentGrade=_exports.fetchCurrentGrade=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};_exports.fetchCurrentGrade=function(component,contextid,itemname,gradeduserid){return(0,_ajax.call)([{methodname:"gradingform_rubric_grader_gradingpanel_fetch",args:{component:component,contextid:contextid,itemname:itemname,gradeduserid:gradeduserid}}])[0]};var fn,_ref,storeCurrentGrade=(fn=regeneratorRuntime.mark((function _callee(component,contextid,itemname,gradeduserid,notifyUser,rootNode){var form;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(form=rootNode.querySelector("form"),!0!==(0,_comparison.compareData)(form)){_context.next=9;break}return _context.t0=_normalise.normaliseResult,_context.next=5,(0,_ajax.call)([{methodname:"gradingform_rubric_grader_gradingpanel_store",args:{component:component,contextid:contextid,itemname:itemname,gradeduserid:gradeduserid,notifyuser:notifyUser,formdata:(0,_jquery.default)(form).serialize()}}])[0];case 5:return _context.t1=_context.sent,_context.abrupt("return",(0,_context.t0)(_context.t1));case 9:return _context.abrupt("return","");case 10:case"end":return _context.stop()}}),_callee)})),_ref=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(_x,_x2,_x3,_x4,_x5,_x6){return _ref.apply(this,arguments)});_exports.storeCurrentGrade=storeCurrentGrade}));
define("plagiarism_turnitin/modal_peermark_reviews_launch",["jquery","core/ajax","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/modal_events"],function($,Ajax,Notification,CustomEvents,Modal,ModalRegistry,ModalEvents){var registered=!1,SELECTORS_HIDE_BUTTON='[data-action="hide"]',ModalPeermarkReviewsLaunch=function(root){Modal.call(this,root)};return ModalPeermarkReviewsLaunch.TYPE="plagiarism_turnitin-modal_peermark_reviews_launch",(ModalPeermarkReviewsLaunch.prototype=Object.create(Modal.prototype)).constructor=ModalPeermarkReviewsLaunch,ModalPeermarkReviewsLaunch.prototype.registerEventListeners=function(){Modal.prototype.registerEventListeners.call(this),this.getModal().on(CustomEvents.events.activate,SELECTORS_HIDE_BUTTON,function(e,data){var cancelEvent=$.Event(ModalEvents.cancel);this.getRoot().trigger(cancelEvent,this),cancelEvent.isDefaultPrevented()||(this.hide(),data.originalEvent.preventDefault())}.bind(this))},registered||(ModalRegistry.register(ModalPeermarkReviewsLaunch.TYPE,ModalPeermarkReviewsLaunch,"plagiarism_turnitin/modal_peermark_reviews_launch"),registered=!0),ModalPeermarkReviewsLaunch});
define("plagiarism_turnitin/open_viewer",["jquery"],(function($){return{origreport_open:function(){var that=this;$(document).on("click",".pp_origreport_open",(function(){for(var classList=$(this).attr("class").replace(/\s+/," ").split(" "),i=0;i<classList.length;i++)if(-1!==classList[i].indexOf("origreport_")&&"pp_origreport_open"!=classList[i]){var classStr=classList[i].split("_");that.openDV("origreport",classStr[1],classStr[2])}}))},grademark_open:function(){var that=this;$(document).on("click",".pp_grademark_open",(function(){for(var classList=$(this).attr("class").replace(/\s+/," ").split(" "),i=0;i<classList.length;i++)if(-1!==classList[i].indexOf("grademark_")&&"pp_grademark_open"!=classList[i]){var classStr=classList[i].split("_");that.openDV("grademark",classStr[1],classStr[2])}}))},openDV:function(dvtype,submissionid,coursemoduleid){var that=this,dvWindow=window.open("","turnitin_viewer"),loading='<div class="tii_dv_loading" style="text-align:center;">';loading+='<img src="'+M.cfg.wwwroot+'/plagiarism/turnitin/pix/turnitin-icon.png" style="width:100px; height: 100px">',loading+='<p style="font-family: Arial, Helvetica, sans-serif;">'+M.str.plagiarism_turnitin.loadingdv+"</p>",loading+="</div>",$(dvWindow.document.body).html(loading),$.ajax({type:"POST",url:M.cfg.wwwroot+"/plagiarism/turnitin/ajax.php",dataType:"json",data:{action:"get_dv_html",submissionid:submissionid,dvtype:dvtype,cmid:coursemoduleid,sesskey:M.cfg.sesskey},success:function(data){$(dvWindow.document.body).html(loading+data),dvWindow.document.forms[0].submit(),dvWindow.document.close(),that.checkDVClosed(submissionid,coursemoduleid,dvWindow)}})},checkDVClosed:function(submissionid,coursemoduleid,dvWindow){var that=this;dvWindow.closed?that.refreshScores(submissionid,coursemoduleid):setTimeout((function(){that.checkDVClosed(submissionid,coursemoduleid,dvWindow)}),500)},refreshScores:function(submission_id,coursemoduleid){var refreshStartTime=(new Date).getTime();$.ajax({type:"POST",url:M.cfg.wwwroot+"/plagiarism/turnitin/ajax.php",dataType:"json",data:{action:"update_grade",submission:submission_id,cmid:coursemoduleid,sesskey:M.cfg.sesskey},success:function(){(new Date).getTime()-refreshStartTime<3e3||!$(".turnitin_score_refresh_alert").length?window.location=window.location+"":$(".turnitin_score_refresh_alert").show()}})}}}));
define("plagiarism_turnitin/eula",["jquery","core/templates","core/modal_factory","core/modal_events","plagiarism_turnitin/modal_eula_launch"],(function($,Templates,ModalFactory,ModalEvents,ModalEulaLaunch){return{eulaLaunch:function(){var turnitinEulaClass=$(".pp_turnitin_eula");turnitinEulaClass.show(),$(document).on("mod_forum-post-created",".forum-post-container",(function(event,newid){$("#post-content-"+newid+" .pp_turnitin_eula").show()})),$(document).on("click",".pp_turnitin_eula_link",(function(){ModalFactory.create({type:ModalEulaLaunch.TYPE,templateContext:{cmid:$('input[name="coursemodule"]').val(),wwwroot:M.cfg.wwwroot},large:!0}).then((function(modal){modal.show(),modal.getRoot().find(".modal").addClass("tii_pp_modal_eula"),modal.getRoot().find(".modal-content").addClass("tii_pp_modal_eula_content")}))})),$(".pp_turnitin_eula_ignored").length>0&&($(".editsubmissionform").length>0&&$(".editsubmissionform").hide(),turnitinEulaClass.siblings(".mform").length>0&&turnitinEulaClass.siblings(".mform").hide())}}}));
define("plagiarism_turnitin/peermark",["jquery","core/templates","core/modal_factory","core/modal_events","plagiarism_turnitin/modal_peermark_manager_launch","plagiarism_turnitin/modal_peermark_reviews_launch"],(function($,Templates,ModalFactory,ModalEvents,ModalPeermarkManagerLaunch,ModalPeermarkReviewsLaunch){return{peermarkLaunch:function(){var that=this;$(".peermark_manager_launch").on("click",(function(event){event.preventDefault(),that.peermarkCreateModal(ModalPeermarkManagerLaunch.TYPE)})),$(document).on("click",".peermark_reviews_pp_launch",(function(){that.peermarkCreateModal(ModalPeermarkReviewsLaunch.TYPE)}))},peermarkCreateModal:function(modalType){if($('input[name="coursemodule"]').val())var cmid=$('input[name="coursemodule"]').val();else cmid=new URLSearchParams(window.location.search).get("id");ModalFactory.create({type:modalType,templateContext:{cmid:cmid,wwwroot:M.cfg.wwwroot},large:!0}).then((function(modal){modal.show()}))}}}));
define("plagiarism_turnitin/modal_peermark_manager_launch",["jquery","core/ajax","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/modal_events"],(function($,Ajax,Notification,CustomEvents,Modal,ModalRegistry,ModalEvents){var registered=!1,SELECTORS_HIDE_BUTTON='[data-action="hide"]',SELECTORS_MODAL='[data-region="modal"]',ModalPeermarkManagerLaunch=function(root){Modal.call(this,root)};function refreshPeermarkAssignments(){$.ajax({type:"POST",url:M.cfg.wwwroot+"/plagiarism/turnitin/ajax.php",dataType:"json",data:{action:"refresh_peermark_assignments",cmid:$('input[name="coursemodule"]').val(),sesskey:M.cfg.sesskey}})}return ModalPeermarkManagerLaunch.TYPE="plagiarism_turnitin-modal_peermark_manager_launch",(ModalPeermarkManagerLaunch.prototype=Object.create(Modal.prototype)).constructor=ModalPeermarkManagerLaunch,ModalPeermarkManagerLaunch.prototype.registerEventListeners=function(){Modal.prototype.registerEventListeners.call(this),this.getModal().on(CustomEvents.events.activate,SELECTORS_HIDE_BUTTON,function(e,data){var cancelEvent=$.Event(ModalEvents.cancel);this.getRoot().trigger(cancelEvent,this),cancelEvent.isDefaultPrevented()||(this.hide(),data.originalEvent.preventDefault(),refreshPeermarkAssignments())}.bind(this)),this.getRoot().click(function(e){$(e.target).closest(SELECTORS_MODAL).length||refreshPeermarkAssignments()}.bind(this))},registered||(ModalRegistry.register(ModalPeermarkManagerLaunch.TYPE,ModalPeermarkManagerLaunch,"plagiarism_turnitin/modal_peermark_manager_launch"),registered=!0),ModalPeermarkManagerLaunch}));
define("plagiarism_turnitin/rubric",["jquery","core/templates","core/modal_factory","core/modal_events","plagiarism_turnitin/modal_rubric_manager_launch","plagiarism_turnitin/modal_rubric_view_launch"],(function($,Templates,ModalFactory,ModalEvents,ModalRubricManagerLaunch,ModalRubricViewLaunch){return{rubric:function(){var that=this;$(".rubric_manager_launch").on("click",(function(){var courseid=$(this).data("courseid"),cmid=$(this).data("cmid");that.rubricCreateModal(ModalRubricManagerLaunch.TYPE,courseid,cmid)})),$(document).on("click",".rubric_view",(function(){var courseid=$(this).data("courseid"),cmid=$(this).data("cmid");that.rubricCreateModal(ModalRubricViewLaunch.TYPE,courseid,cmid)})),$("#id_plagiarism_rubric").mousedown((function(){""!=$('input[name="instance"]').val()&&"Y"!=$('input[name="rubric_warning_seen"]').val()&&confirm(M.str.plagiarism_turnitin.changerubricwarning)&&$('input[name="rubric_warning_seen"]').val("Y")}))},rubricCreateModal:function(modalType,courseid,cmid){ModalFactory.create({type:modalType,templateContext:{courseid:courseid,cmid:cmid,wwwroot:M.cfg.wwwroot},large:!0}).then((function(modal){modal.show(),modal.getRoot().find(".modal").addClass("tii_pp_modal_rubric"),modal.getRoot().find(".modal-dialog").addClass("tii_pp_modal_rubric_content")}))}}}));
define("plagiarism_turnitin/modal_rubric_view_launch",["jquery","core/ajax","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/modal_events"],(function($,Ajax,Notification,CustomEvents,Modal,ModalRegistry,ModalEvents){var registered=!1,SELECTORS_HIDE_BUTTON='[data-action="hide"]',ModalRubricViewLaunch=function(root){Modal.call(this,root)};return ModalRubricViewLaunch.TYPE="plagiarism_turnitin-modal_rubric_view_launch",(ModalRubricViewLaunch.prototype=Object.create(Modal.prototype)).constructor=ModalRubricViewLaunch,ModalRubricViewLaunch.prototype.registerEventListeners=function(){Modal.prototype.registerEventListeners.call(this),this.getModal().on(CustomEvents.events.activate,SELECTORS_HIDE_BUTTON,function(e,data){var cancelEvent=$.Event(ModalEvents.cancel);this.getRoot().trigger(cancelEvent,this),cancelEvent.isDefaultPrevented()||(this.hide(),data.originalEvent.preventDefault())}.bind(this))},registered||(ModalRegistry.register(ModalRubricViewLaunch.TYPE,ModalRubricViewLaunch,"plagiarism_turnitin/modal_rubric_view_launch"),registered=!0),ModalRubricViewLaunch}));
define("plagiarism_turnitin/modal_rubric_manager_launch",["jquery","core/ajax","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/modal_events"],(function($,Ajax,Notification,CustomEvents,Modal,ModalRegistry,ModalEvents){var registered=!1,SELECTORS_HIDE_BUTTON='[data-action="hide"]',SELECTORS_MODAL='[data-region="modal"]',ModalRubricManagerLaunch=function(root){Modal.call(this,root)};function refreshRubricSelect(){var currentRubric=$("#id_plagiarism_rubric").val();$.ajax({dataType:"json",type:"POST",url:"../plagiarism/turnitin/ajax.php",data:{action:"refresh_rubric_select",assignment:$('input[name="instance"]').val(),modulename:$('input[name="modulename"]').val(),course:$('input[name="course"]').val()},success:function(data){$($("#id_plagiarism_rubric")).empty();var options=data;$.each(options,(function(i,val){if($.isNumeric(i)||""===i)$($("#id_plagiarism_rubric")).append($("<option>",{value:i,text:val}));else{var optgroup=$("<optgroup>");optgroup.attr("label",i),$.each(val,(function(j,rubric){var option=$("<option></option>");option.val(j),option.text(rubric),optgroup.append(option)})),$("#id_plagiarism_rubric").append(optgroup)}})),$('#id_plagiarism_rubric option[value="'+currentRubric+'"]').attr("selected","selected")}})}return ModalRubricManagerLaunch.TYPE="plagiarism_turnitin-modal_rubric_manager_launch",(ModalRubricManagerLaunch.prototype=Object.create(Modal.prototype)).constructor=ModalRubricManagerLaunch,ModalRubricManagerLaunch.prototype.registerEventListeners=function(){Modal.prototype.registerEventListeners.call(this),this.getModal().on(CustomEvents.events.activate,SELECTORS_HIDE_BUTTON,function(e,data){var cancelEvent=$.Event(ModalEvents.cancel);this.getRoot().trigger(cancelEvent,this),cancelEvent.isDefaultPrevented()||(this.hide(),data.originalEvent.preventDefault(),refreshRubricSelect())}.bind(this)),this.getRoot().click(function(e){$(e.target).closest(SELECTORS_MODAL).length||refreshRubricSelect()}.bind(this))},registered||(ModalRegistry.register(ModalRubricManagerLaunch.TYPE,ModalRubricManagerLaunch,"plagiarism_turnitin/modal_rubric_manager_launch"),registered=!0),ModalRubricManagerLaunch}));
define("plagiarism_turnitin/modal_eula_launch",["jquery","core/ajax","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/modal_events"],function($,Ajax,Notification,CustomEvents,Modal,ModalRegistry,ModalEvents){var registered=!1,SELECTORS_HIDE_BUTTON='[data-action="hide"]',ModalEulaLaunch=function(root){Modal.call(this,root)};return ModalEulaLaunch.TYPE="plagiarism_turnitin-modal_eula_launch",(ModalEulaLaunch.prototype=Object.create(Modal.prototype)).constructor=ModalEulaLaunch,ModalEulaLaunch.prototype.registerEventListeners=function(){Modal.prototype.registerEventListeners.call(this),$(window).on("message",function(ev){var message=void 0===ev.data?ev.originalEvent.data:ev.data;"turnitin_eula_declined"!==message&&"turnitin_eula_accepted"!==message||$.ajax({type:"POST",url:M.cfg.wwwroot+"/plagiarism/turnitin/ajax.php",dataType:"json",data:{action:"actionuseragreement",message:message,sesskey:M.cfg.sesskey},success:function(){window.location.reload()},error:function(){window.location.reload()}})}),this.getModal().on(CustomEvents.events.activate,SELECTORS_HIDE_BUTTON,function(e,data){var cancelEvent=$.Event(ModalEvents.cancel);this.getRoot().trigger(cancelEvent,this),cancelEvent.isDefaultPrevented()||(this.hide(),data.originalEvent.preventDefault())}.bind(this))},registered||(ModalRegistry.register(ModalEulaLaunch.TYPE,ModalEulaLaunch,"plagiarism_turnitin/modal_eula_launch"),registered=!0),ModalEulaLaunch});
define("plagiarism_turnitin/refresh_submissions",["jquery"],function($){return{refreshSubmissions:function(){$(".plagiarism_turnitin_refresh_grades").on("click",function(){$(".plagiarism_turnitin_refresh_grades").hide(),$(".plagiarism_turnitin_refreshing_grades").show(),$.ajax({type:"POST",url:M.cfg.wwwroot+"/plagiarism/turnitin/ajax.php",dataType:"json",data:{action:"update_grade",cmid:$('input[name="coursemodule"]').val(),sesskey:M.cfg.sesskey},success:function(){$(".plagiarism_turnitin_refresh_grades").show(),$(".plagiarism_turnitin_refreshing_grades").hide()}})})}}});
define("plagiarism_turnitin/open_viewer",["jquery"],function($){return{origreport_open:function(){var that=this;$(document).on("click",".pp_origreport_open",function(){for(var classList=$(this).attr("class").replace(/\s+/," ").split(" "),i=0;i<classList.length;i++)if(-1!==classList[i].indexOf("origreport_")&&"pp_origreport_open"!=classList[i]){var classStr=classList[i].split("_");that.openDV("origreport",classStr[1],classStr[2])}})},grademark_open:function(){var that=this;$(document).on("click",".pp_grademark_open",function(){for(var classList=$(this).attr("class").replace(/\s+/," ").split(" "),i=0;i<classList.length;i++)if(-1!==classList[i].indexOf("grademark_")&&"pp_grademark_open"!=classList[i]){var classStr=classList[i].split("_");that.openDV("grademark",classStr[1],classStr[2])}})},openDV:function(dvtype,submissionid,coursemoduleid){var that=this,dvWindow=window.open("","turnitin_viewer"),loading='<div class="tii_dv_loading" style="text-align:center;">';loading+='<img src="'+M.cfg.wwwroot+'/plagiarism/turnitin/pix/turnitin-icon.png" style="width:100px; height: 100px">',loading+='<p style="font-family: Arial, Helvetica, sans-serif;">'+M.str.plagiarism_turnitin.loadingdv+"</p>",loading+="</div>",$(dvWindow.document.body).html(loading),$.ajax({type:"POST",url:M.cfg.wwwroot+"/plagiarism/turnitin/ajax.php",dataType:"json",data:{action:"get_dv_html",submissionid:submissionid,dvtype:dvtype,cmid:coursemoduleid,sesskey:M.cfg.sesskey},success:function(data){$(dvWindow.document.body).html(loading+data),dvWindow.document.forms[0].submit(),dvWindow.document.close(),that.checkDVClosed(submissionid,coursemoduleid,dvWindow)}})},checkDVClosed:function(submissionid,coursemoduleid,dvWindow){var that=this;dvWindow.closed?that.refreshScores(submissionid,coursemoduleid):setTimeout(function(){that.checkDVClosed(submissionid,coursemoduleid,dvWindow)},500)},refreshScores:function(submission_id,coursemoduleid){var refreshStartTime=(new Date).getTime();$.ajax({type:"POST",url:M.cfg.wwwroot+"/plagiarism/turnitin/ajax.php",dataType:"json",data:{action:"update_grade",submission:submission_id,cmid:coursemoduleid,sesskey:M.cfg.sesskey},success:function(){(new Date).getTime()-refreshStartTime<3e3||!$(".turnitin_score_refresh_alert").length?window.location=window.location+"":$(".turnitin_score_refresh_alert").show()}})}}});
define("plagiarism_turnitin/modal_eula_launch",["jquery","core/ajax","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/modal_events"],(function($,Ajax,Notification,CustomEvents,Modal,ModalRegistry,ModalEvents){var registered=!1,SELECTORS_HIDE_BUTTON='[data-action="hide"]',ModalEulaLaunch=function(root){Modal.call(this,root)};return ModalEulaLaunch.TYPE="plagiarism_turnitin-modal_eula_launch",(ModalEulaLaunch.prototype=Object.create(Modal.prototype)).constructor=ModalEulaLaunch,ModalEulaLaunch.prototype.registerEventListeners=function(){Modal.prototype.registerEventListeners.call(this),$(window).on("message",(function(ev){var message=void 0===ev.data?ev.originalEvent.data:ev.data;"turnitin_eula_declined"!==message&&"turnitin_eula_accepted"!==message||$.ajax({type:"POST",url:M.cfg.wwwroot+"/plagiarism/turnitin/ajax.php",dataType:"json",data:{action:"actionuseragreement",message:message,sesskey:M.cfg.sesskey},success:function(){window.location.reload()},error:function(){window.location.reload()}})})),this.getModal().on(CustomEvents.events.activate,SELECTORS_HIDE_BUTTON,function(e,data){var cancelEvent=$.Event(ModalEvents.cancel);this.getRoot().trigger(cancelEvent,this),cancelEvent.isDefaultPrevented()||(this.hide(),data.originalEvent.preventDefault())}.bind(this))},registered||(ModalRegistry.register(ModalEulaLaunch.TYPE,ModalEulaLaunch,"plagiarism_turnitin/modal_eula_launch"),registered=!0),ModalEulaLaunch}));
define("plagiarism_turnitin/refresh_submissions",["jquery"],(function($){return{refreshSubmissions:function(){$(".plagiarism_turnitin_refresh_grades").on("click",(function(){$(".plagiarism_turnitin_refresh_grades").hide(),$(".plagiarism_turnitin_refreshing_grades").show(),$.ajax({type:"POST",url:M.cfg.wwwroot+"/plagiarism/turnitin/ajax.php",dataType:"json",data:{action:"update_grade",cmid:$('input[name="coursemodule"]').val(),sesskey:M.cfg.sesskey},success:function(){$(".plagiarism_turnitin_refresh_grades").show(),$(".plagiarism_turnitin_refreshing_grades").hide()}})}))}}}));
define("plagiarism_turnitin/rubric",["jquery","core/templates","core/modal_factory","core/modal_events","plagiarism_turnitin/modal_rubric_manager_launch","plagiarism_turnitin/modal_rubric_view_launch"],function($,Templates,ModalFactory,ModalEvents,ModalRubricManagerLaunch,ModalRubricViewLaunch){return{rubric:function(){var that=this;$(".rubric_manager_launch").on("click",function(){var courseid=$(this).data("courseid"),cmid=$(this).data("cmid");that.rubricCreateModal(ModalRubricManagerLaunch.TYPE,courseid,cmid)}),$(document).on("click",".rubric_view",function(){var courseid=$(this).data("courseid"),cmid=$(this).data("cmid");that.rubricCreateModal(ModalRubricViewLaunch.TYPE,courseid,cmid)}),$("#id_plagiarism_rubric").mousedown(function(){""!=$('input[name="instance"]').val()&&"Y"!=$('input[name="rubric_warning_seen"]').val()&&confirm(M.str.plagiarism_turnitin.changerubricwarning)&&$('input[name="rubric_warning_seen"]').val("Y")})},rubricCreateModal:function(modalType,courseid,cmid){ModalFactory.create({type:modalType,templateContext:{courseid:courseid,cmid:cmid,wwwroot:M.cfg.wwwroot},large:!0}).then(function(modal){modal.show(),modal.getRoot().find(".modal").addClass("tii_pp_modal_rubric"),modal.getRoot().find(".modal-dialog").addClass("tii_pp_modal_rubric_content")})}}});
define("plagiarism_turnitin/modal_rubric_view_launch",["jquery","core/ajax","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/modal_events"],function($,Ajax,Notification,CustomEvents,Modal,ModalRegistry,ModalEvents){var registered=!1,SELECTORS_HIDE_BUTTON='[data-action="hide"]',ModalRubricViewLaunch=function(root){Modal.call(this,root)};return ModalRubricViewLaunch.TYPE="plagiarism_turnitin-modal_rubric_view_launch",(ModalRubricViewLaunch.prototype=Object.create(Modal.prototype)).constructor=ModalRubricViewLaunch,ModalRubricViewLaunch.prototype.registerEventListeners=function(){Modal.prototype.registerEventListeners.call(this),this.getModal().on(CustomEvents.events.activate,SELECTORS_HIDE_BUTTON,function(e,data){var cancelEvent=$.Event(ModalEvents.cancel);this.getRoot().trigger(cancelEvent,this),cancelEvent.isDefaultPrevented()||(this.hide(),data.originalEvent.preventDefault())}.bind(this))},registered||(ModalRegistry.register(ModalRubricViewLaunch.TYPE,ModalRubricViewLaunch,"plagiarism_turnitin/modal_rubric_view_launch"),registered=!0),ModalRubricViewLaunch});
define("plagiarism_turnitin/modal_rubric_manager_launch",["jquery","core/ajax","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/modal_events"],function($,Ajax,Notification,CustomEvents,Modal,ModalRegistry,ModalEvents){var registered=!1,SELECTORS_HIDE_BUTTON='[data-action="hide"]',SELECTORS_MODAL='[data-region="modal"]',ModalRubricManagerLaunch=function(root){Modal.call(this,root)};function refreshRubricSelect(){var currentRubric=$("#id_plagiarism_rubric").val();$.ajax({dataType:"json",type:"POST",url:"../plagiarism/turnitin/ajax.php",data:{action:"refresh_rubric_select",assignment:$('input[name="instance"]').val(),modulename:$('input[name="modulename"]').val(),course:$('input[name="course"]').val()},success:function(data){$($("#id_plagiarism_rubric")).empty();var options=data;$.each(options,function(i,val){if($.isNumeric(i)||""===i)$($("#id_plagiarism_rubric")).append($("<option>",{value:i,text:val}));else{var optgroup=$("<optgroup>");optgroup.attr("label",i),$.each(val,function(j,rubric){var option=$("<option></option>");option.val(j),option.text(rubric),optgroup.append(option)}),$("#id_plagiarism_rubric").append(optgroup)}}),$('#id_plagiarism_rubric option[value="'+currentRubric+'"]').attr("selected","selected")}})}return ModalRubricManagerLaunch.TYPE="plagiarism_turnitin-modal_rubric_manager_launch",(ModalRubricManagerLaunch.prototype=Object.create(Modal.prototype)).constructor=ModalRubricManagerLaunch,ModalRubricManagerLaunch.prototype.registerEventListeners=function(){Modal.prototype.registerEventListeners.call(this),this.getModal().on(CustomEvents.events.activate,SELECTORS_HIDE_BUTTON,function(e,data){var cancelEvent=$.Event(ModalEvents.cancel);this.getRoot().trigger(cancelEvent,this),cancelEvent.isDefaultPrevented()||(this.hide(),data.originalEvent.preventDefault(),refreshRubricSelect())}.bind(this)),this.getRoot().click(function(e){$(e.target).closest(SELECTORS_MODAL).length||refreshRubricSelect()}.bind(this))},registered||(ModalRegistry.register(ModalRubricManagerLaunch.TYPE,ModalRubricManagerLaunch,"plagiarism_turnitin/modal_rubric_manager_launch"),registered=!0),ModalRubricManagerLaunch});
define("plagiarism_turnitin/modal_peermark_manager_launch",["jquery","core/ajax","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/modal_events"],function($,Ajax,Notification,CustomEvents,Modal,ModalRegistry,ModalEvents){var registered=!1,SELECTORS_HIDE_BUTTON='[data-action="hide"]',SELECTORS_MODAL='[data-region="modal"]',ModalPeermarkManagerLaunch=function(root){Modal.call(this,root)};function refreshPeermarkAssignments(){$.ajax({type:"POST",url:M.cfg.wwwroot+"/plagiarism/turnitin/ajax.php",dataType:"json",data:{action:"refresh_peermark_assignments",cmid:$('input[name="coursemodule"]').val(),sesskey:M.cfg.sesskey}})}return ModalPeermarkManagerLaunch.TYPE="plagiarism_turnitin-modal_peermark_manager_launch",(ModalPeermarkManagerLaunch.prototype=Object.create(Modal.prototype)).constructor=ModalPeermarkManagerLaunch,ModalPeermarkManagerLaunch.prototype.registerEventListeners=function(){Modal.prototype.registerEventListeners.call(this),this.getModal().on(CustomEvents.events.activate,SELECTORS_HIDE_BUTTON,function(e,data){var cancelEvent=$.Event(ModalEvents.cancel);this.getRoot().trigger(cancelEvent,this),cancelEvent.isDefaultPrevented()||(this.hide(),data.originalEvent.preventDefault(),refreshPeermarkAssignments())}.bind(this)),this.getRoot().click(function(e){$(e.target).closest(SELECTORS_MODAL).length||refreshPeermarkAssignments()}.bind(this))},registered||(ModalRegistry.register(ModalPeermarkManagerLaunch.TYPE,ModalPeermarkManagerLaunch,"plagiarism_turnitin/modal_peermark_manager_launch"),registered=!0),ModalPeermarkManagerLaunch});
define("plagiarism_turnitin/peermark",["jquery","core/templates","core/modal_factory","core/modal_events","plagiarism_turnitin/modal_peermark_manager_launch","plagiarism_turnitin/modal_peermark_reviews_launch"],function($,Templates,ModalFactory,ModalEvents,ModalPeermarkManagerLaunch,ModalPeermarkReviewsLaunch){return{peermarkLaunch:function(){var that=this;$(".peermark_manager_launch").on("click",function(event){event.preventDefault(),that.peermarkCreateModal(ModalPeermarkManagerLaunch.TYPE)}),$(document).on("click",".peermark_reviews_pp_launch",function(){that.peermarkCreateModal(ModalPeermarkReviewsLaunch.TYPE)})},peermarkCreateModal:function(modalType){if($('input[name="coursemodule"]').val())var cmid=$('input[name="coursemodule"]').val();else cmid=new URLSearchParams(window.location.search).get("id");ModalFactory.create({type:modalType,templateContext:{cmid:cmid,wwwroot:M.cfg.wwwroot},large:!0}).then(function(modal){modal.show()})}}});
define("plagiarism_turnitin/eula",["jquery","core/templates","core/modal_factory","core/modal_events","plagiarism_turnitin/modal_eula_launch"],function($,Templates,ModalFactory,ModalEvents,ModalEulaLaunch){return{eulaLaunch:function(){var turnitinEulaClass=$(".pp_turnitin_eula");turnitinEulaClass.show(),$(document).on("mod_forum-post-created",".forum-post-container",function(event,newid){$("#post-content-"+newid+" .pp_turnitin_eula").show()}),$(document).on("click",".pp_turnitin_eula_link",function(){ModalFactory.create({type:ModalEulaLaunch.TYPE,templateContext:{cmid:$('input[name="coursemodule"]').val(),wwwroot:M.cfg.wwwroot},large:!0}).then(function(modal){modal.show(),modal.getRoot().find(".modal").addClass("tii_pp_modal_eula"),modal.getRoot().find(".modal-content").addClass("tii_pp_modal_eula_content")})}),$(".pp_turnitin_eula_ignored").length>0&&($(".editsubmissionform").length>0&&$(".editsubmissionform").hide(),turnitinEulaClass.siblings(".mform").length>0&&turnitinEulaClass.siblings(".mform").hide())}}});
define("plagiarism_turnitin/modal_peermark_reviews_launch",["jquery","core/ajax","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/modal_events"],(function($,Ajax,Notification,CustomEvents,Modal,ModalRegistry,ModalEvents){var registered=!1,SELECTORS_HIDE_BUTTON='[data-action="hide"]',ModalPeermarkReviewsLaunch=function(root){Modal.call(this,root)};return ModalPeermarkReviewsLaunch.TYPE="plagiarism_turnitin-modal_peermark_reviews_launch",(ModalPeermarkReviewsLaunch.prototype=Object.create(Modal.prototype)).constructor=ModalPeermarkReviewsLaunch,ModalPeermarkReviewsLaunch.prototype.registerEventListeners=function(){Modal.prototype.registerEventListeners.call(this),this.getModal().on(CustomEvents.events.activate,SELECTORS_HIDE_BUTTON,function(e,data){var cancelEvent=$.Event(ModalEvents.cancel);this.getRoot().trigger(cancelEvent,this),cancelEvent.isDefaultPrevented()||(this.hide(),data.originalEvent.preventDefault())}.bind(this))},registered||(ModalRegistry.register(ModalPeermarkReviewsLaunch.TYPE,ModalPeermarkReviewsLaunch,"plagiarism_turnitin/modal_peermark_reviews_launch"),registered=!0),ModalPeermarkReviewsLaunch}));
define("plagiarism_turnitin/resend_submission",["jquery"],(function($){return{resendSubmission:function(){$(document).on("click",".plagiarism_turnitin_resubmit_link",(function(){$(this).hide(),$(this).siblings(".pp_resubmitting").removeClass("hidden");var that=$(this),submissionid=$(this).prop("id").split("_")[2],forumpost=$("#content_"+submissionid).html(),forumdata=$("#forumdata_"+submissionid).html();return $.ajax({type:"POST",url:M.cfg.wwwroot+"/plagiarism/turnitin/ajax.php",dataType:"json",data:{action:"resubmit_event",submissionid:submissionid,forumpost:forumpost,forumdata:forumdata,sesskey:M.cfg.sesskey},success:function(){that.siblings(".turnitin_status").removeClass("hidden"),that.siblings(".pp_resubmitting").addClass("hidden")},error:function(){that.show(),that.siblings(".pp_resubmitting").addClass("hidden")}}),!1}))}}}));
define("plagiarism_turnitin/quickmark",["jquery","core/templates","core/modal_factory","core/modal_events","plagiarism_turnitin/modal_quickmark_launch"],(function($,Templates,ModalFactory,ModalEvents,ModalQuickmarkLaunch){return{quickmarkLaunch:function(){$(".plagiarism_turnitin_quickmark_manager_launch").on("click",(function(event){event.preventDefault(),ModalFactory.create({type:ModalQuickmarkLaunch.TYPE,templateContext:{cmid:$('input[name="coursemodule"]').val(),wwwroot:M.cfg.wwwroot},large:!0}).then((function(modal){modal.show()}))}))}}}));
define("plagiarism_turnitin/modal_quickmark_launch",["jquery","core/ajax","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/modal_events"],function($,Ajax,Notification,CustomEvents,Modal,ModalRegistry,ModalEvents){var registered=!1,SELECTORS_HIDE_BUTTON='[data-action="hide"]',ModalQuickmarkLaunch=function(root){Modal.call(this,root)};return ModalQuickmarkLaunch.TYPE="plagiarism_turnitin-modal_quickmark_launch",(ModalQuickmarkLaunch.prototype=Object.create(Modal.prototype)).constructor=ModalQuickmarkLaunch,ModalQuickmarkLaunch.prototype.registerEventListeners=function(){Modal.prototype.registerEventListeners.call(this),this.getModal().on(CustomEvents.events.activate,SELECTORS_HIDE_BUTTON,function(e,data){var cancelEvent=$.Event(ModalEvents.cancel);this.getRoot().trigger(cancelEvent,this),cancelEvent.isDefaultPrevented()||(this.hide(),data.originalEvent.preventDefault())}.bind(this))},registered||(ModalRegistry.register(ModalQuickmarkLaunch.TYPE,ModalQuickmarkLaunch,"plagiarism_turnitin/modal_quickmark_launch"),registered=!0),ModalQuickmarkLaunch});
define("plagiarism_turnitin/modal_quickmark_launch",["jquery","core/ajax","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/modal_events"],(function($,Ajax,Notification,CustomEvents,Modal,ModalRegistry,ModalEvents){var registered=!1,SELECTORS_HIDE_BUTTON='[data-action="hide"]',ModalQuickmarkLaunch=function(root){Modal.call(this,root)};return ModalQuickmarkLaunch.TYPE="plagiarism_turnitin-modal_quickmark_launch",(ModalQuickmarkLaunch.prototype=Object.create(Modal.prototype)).constructor=ModalQuickmarkLaunch,ModalQuickmarkLaunch.prototype.registerEventListeners=function(){Modal.prototype.registerEventListeners.call(this),this.getModal().on(CustomEvents.events.activate,SELECTORS_HIDE_BUTTON,function(e,data){var cancelEvent=$.Event(ModalEvents.cancel);this.getRoot().trigger(cancelEvent,this),cancelEvent.isDefaultPrevented()||(this.hide(),data.originalEvent.preventDefault())}.bind(this))},registered||(ModalRegistry.register(ModalQuickmarkLaunch.TYPE,ModalQuickmarkLaunch,"plagiarism_turnitin/modal_quickmark_launch"),registered=!0),ModalQuickmarkLaunch}));
define("plagiarism_turnitin/resend_submission",["jquery"],function($){return{resendSubmission:function(){$(document).on("click",".plagiarism_turnitin_resubmit_link",function(){$(this).hide(),$(this).siblings(".pp_resubmitting").removeClass("hidden");var that=$(this),submissionid=$(this).prop("id").split("_")[2],forumpost=$("#content_"+submissionid).html(),forumdata=$("#forumdata_"+submissionid).html();return $.ajax({type:"POST",url:M.cfg.wwwroot+"/plagiarism/turnitin/ajax.php",dataType:"json",data:{action:"resubmit_event",submissionid:submissionid,forumpost:forumpost,forumdata:forumdata,sesskey:M.cfg.sesskey},success:function(){that.siblings(".turnitin_status").removeClass("hidden"),that.siblings(".pp_resubmitting").addClass("hidden")},error:function(){that.show(),that.siblings(".pp_resubmitting").addClass("hidden")}}),!1})}}});
define("plagiarism_turnitin/quickmark",["jquery","core/templates","core/modal_factory","core/modal_events","plagiarism_turnitin/modal_quickmark_launch"],function($,Templates,ModalFactory,ModalEvents,ModalQuickmarkLaunch){return{quickmarkLaunch:function(){$(".plagiarism_turnitin_quickmark_manager_launch").on("click",function(event){event.preventDefault(),ModalFactory.create({type:ModalQuickmarkLaunch.TYPE,templateContext:{cmid:$('input[name="coursemodule"]').val(),wwwroot:M.cfg.wwwroot},large:!0}).then(function(modal){modal.show()})})}}});
/**
 * AMD module for model actions confirmation.
 *
 * @module     tool_analytics/model
 * @copyright  2017 David Monllao
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_analytics/model",["jquery","core/str","core/log","core/notification","core/modal_factory","core/modal_events","core/templates"],(function($,Str,log,Notification,ModalFactory,ModalEvents,Templates){var actionsList={clear:{title:{key:"clearpredictions",component:"tool_analytics"},body:{key:"clearmodelpredictions",component:"tool_analytics"}},delete:{title:{key:"delete",component:"tool_analytics"},body:{key:"deletemodelconfirmation",component:"tool_analytics"}}};return{confirmAction:function(actionId,actionType){$('[data-action-id="'+actionId+'"]').on("click",(function(ev){ev.preventDefault();var a=$(ev.currentTarget);if(void 0!==actionsList[actionType]){var wrap,reqStrings=[actionsList[actionType].title,actionsList[actionType].body];reqStrings[1].param=(wrap=$(a).closest("[data-model-name]")).length?wrap.attr("data-model-name"):(log.error("Unexpected DOM error - unable to obtain the model name"),"");var stringsPromise=Str.get_strings(reqStrings),modalPromise=ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL});$.when(stringsPromise,modalPromise).then((function(strings,modal){return modal.setTitle(strings[0]),modal.setBody(strings[1]),modal.setSaveButtonText(strings[0]),modal.getRoot().on(ModalEvents.save,(function(){window.location.href=a.attr("href")})),modal.show(),modal})).fail(Notification.exception)}else log.error('Action "'+actionType+'" is not allowed.')}))},selectEvaluationOptions:function(actionId,trainedOnlyExternally){$('[data-action-id="'+actionId+'"]').on("click",(function(ev){ev.preventDefault();var a=$(ev.currentTarget),timeSplittingMethods=$(this).attr("data-timesplitting-methods"),stringsPromise=Str.get_strings([{key:"evaluatemodel",component:"tool_analytics"},{key:"evaluate",component:"tool_analytics"}]),modalPromise=ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL}),bodyPromise=Templates.render("tool_analytics/evaluation_options",{trainedexternally:trainedOnlyExternally,timesplittingmethods:JSON.parse(timeSplittingMethods)});$.when(stringsPromise,modalPromise).then((function(strings,modal){return modal.getRoot().on(ModalEvents.hidden,modal.destroy.bind(modal)),modal.setTitle(strings[0]),modal.setSaveButtonText(strings[1]),modal.setBody(bodyPromise),modal.getRoot().on(ModalEvents.save,(function(){"trainedmodel"==$("input[name='evaluationmode']:checked").val()&&a.attr("href",a.attr("href")+"&mode=trainedmodel");var timeSplittingMethod=$("#id-evaluation-timesplitting").val();a.attr("href",a.attr("href")+"&timesplitting="+timeSplittingMethod),window.location.href=a.attr("href")})),modal.show(),modal})).fail(Notification.exception)}))},selectExportOptions:function(actionId,isTrained){$('[data-action-id="'+actionId+'"]').on("click",(function(ev){ev.preventDefault();var a=$(ev.currentTarget);if(!isTrained)return a.attr("href",a.attr("href")+"&action=exportmodel&includeweights=0"),void(window.location.href=a.attr("href"));var stringsPromise=Str.get_strings([{key:"export",component:"tool_analytics"}]),modalPromise=ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL}),bodyPromise=Templates.render("tool_analytics/export_options",{});$.when(stringsPromise,modalPromise).then((function(strings,modal){return modal.getRoot().on(ModalEvents.hidden,modal.destroy.bind(modal)),modal.setTitle(strings[0]),modal.setSaveButtonText(strings[0]),modal.setBody(bodyPromise),modal.getRoot().on(ModalEvents.save,(function(){"exportdata"==$("input[name='exportoption']:checked").val()?a.attr("href",a.attr("href")+"&action=exportdata"):(a.attr("href",a.attr("href")+"&action=exportmodel"),$("#id-includeweights").is(":checked")?a.attr("href",a.attr("href")+"&includeweights=1"):a.attr("href",a.attr("href")+"&includeweights=0")),window.location.href=a.attr("href")})),modal.show(),modal})).fail(Notification.exception)}))}}}));
/**
 * Shows a dialogue with info about this logs.
 *
 * @module     tool_analytics/log_info
 * @class      log_info
 * @package    tool_analytics
 * @copyright  2017 David Monllao {@link http://www.davidmonllao.com}
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_analytics/log_info",["jquery","core/str","core/modal_factory","core/notification"],(function($,str,ModalFactory,Notification){return{loadInfo:function(id,info){var link=$('[data-model-log-id="'+id+'"]');str.get_string("loginfo","tool_analytics").then((function(langString){var bodyInfo=$("<ul>");return info.forEach((function(item){bodyInfo.append("<li>"+item+"</li>")})),bodyInfo.append("</ul>"),ModalFactory.create({title:langString,body:bodyInfo.html(),large:!0},link)})).catch(Notification.exception)}}}));
/**
 * Potential contexts selector module.
 *
 * @module     tool_analytics/potential-contexts
 * @class      potential-contexts
 * @package    tool_analytics
 * @copyright  2019 David Monllao
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_analytics/potential-contexts",["jquery","core/ajax"],(function($,Ajax){return{processResults:function(selector,results){var contexts=[];return $.isArray(results)?($.each(results,(function(index,context){contexts.push({value:context.id,label:context.name})})),contexts):results},transport:function(selector,query,success,failure){var modelid=$(selector).attr("modelid")||null;Ajax.call([{methodname:"tool_analytics_potential_contexts",args:{query:query,modelid:modelid}}])[0].then(success).fail(failure)}}}));
define("tool_behat/steps",["exports","core/ajax","core/templates","core/pending"],(function(_exports,_ajax,_templates,_pending){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_pending=_interopRequireDefault(_pending);
/**
   * Enhancements for the step definitions page.
   *
   * @module tool_behat/steps
   * @copyright 2022 Catalyst IT EU
   * @author Mark Johnson <mark.johnson@catalyst-eu.net>
   * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
var getRequiredFieldsContent=function(entityData){var _entityData$required;return null!==(_entityData$required=entityData.required)&&void 0!==_entityData$required&&_entityData$required.length?_templates.default.renderForPromise("tool_behat/steprequiredfields",{fields:entityData.required}):Promise.resolve({html:"",js:""})};_exports.init=function(){var fn,_ref;document.addEventListener("change",(fn=regeneratorRuntime.mark((function _callee(e){var entityElement,stepElement,pendingPromise,entityData,_yield$getRequiredFie,html,js,stepRequiredFields;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(entityElement=e.target.closest(".entities"),stepElement=e.target.closest(".stepcontent"),entityElement&&stepElement){_context.next=4;break}return _context.abrupt("return");case 4:return pendingPromise=new _pending.default("tool_behat/steps:change"),_context.next=7,entityType=e.target.value,_ajax.default.call([{methodname:"tool_behat_get_entity_generator",args:{entitytype:entityType}}])[0];case 7:return entityData=_context.sent,_context.next=10,getRequiredFieldsContent(entityData);case 10:if(_yield$getRequiredFie=_context.sent,html=_yield$getRequiredFie.html,js=_yield$getRequiredFie.js,!(stepRequiredFields=stepElement.querySelector(".steprequiredfields"))){_context.next=19;break}return _context.next=17,_templates.default.replaceNode(stepRequiredFields,html,js);case 17:_context.next=21;break;case 19:return _context.next=21,_templates.default.appendNodeContents(stepElement,html,js);case 21:pendingPromise.resolve();case 22:case"end":return _context.stop()}var entityType}),_callee)})),_ref=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(_x){return _ref.apply(this,arguments)}))}}));
/**
 * AMD module for purposes actions.
 *
 * @module     tool_dataprivacy/purposesactions
 * @package    tool_dataprivacy
 * @copyright  2018 David Monllao
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/purposesactions",["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events"],(function($,Ajax,Notification,Str,ModalFactory,ModalEvents){var ACTIONS_DELETE='[data-action="deletepurpose"]',PurposesActions=function(){this.registerEvents()};return PurposesActions.prototype.registerEvents=function(){$(ACTIONS_DELETE).click((function(e){e.preventDefault();var id=$(this).data("id"),stringkeys=[{key:"deletepurpose",component:"tool_dataprivacy"},{key:"deletepurposetext",component:"tool_dataprivacy",param:$(this).data("name")},{key:"delete"}];Str.get_strings(stringkeys).then((function(langStrings){var title=langStrings[0],confirmMessage=langStrings[1],buttonText=langStrings[2];return ModalFactory.create({title:title,body:confirmMessage,type:ModalFactory.types.SAVE_CANCEL}).then((function(modal){return modal.setSaveButtonText(buttonText),modal.getRoot().on(ModalEvents.save,(function(){var request={methodname:"tool_dataprivacy_delete_purpose",args:{id:id}};Ajax.call([request])[0].done((function(data){data.result?$('tr[data-purposeid="'+id+'"]').remove():Notification.addNotification({message:data.warnings[0].message,type:"error"})})).fail(Notification.exception)})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal}))})).done((function(modal){modal.show()})).fail(Notification.exception)}))},{init:function(){return new PurposesActions}}}));
/**
 * Module to update the displayed retention period.
 *
 * @module     tool_dataprivacy/effective_retention_period
 * @package    tool_dataprivacy
 * @copyright  2018 David Monllao
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/effective_retention_period",["jquery"],(function($){var SELECTORS_PURPOSE_SELECT="#id_purposeid",SELECTORS_RETENTION_FIELD="#fitem_id_retention_current [data-fieldtype=static]",EffectiveRetentionPeriod=function(purposeRetentionPeriods){this.purposeRetentionPeriods=purposeRetentionPeriods,this.registerEventListeners()};return EffectiveRetentionPeriod.prototype.purposeRetentionPeriods=[],EffectiveRetentionPeriod.prototype.registerEventListeners=function(){$(SELECTORS_PURPOSE_SELECT).on("change",function(ev){var selected=$(ev.currentTarget).val(),selectedPurpose=this.purposeRetentionPeriods[selected];$(SELECTORS_RETENTION_FIELD).text(selectedPurpose)}.bind(this))},{init:function(purposeRetentionPeriods){return $(SELECTORS_PURPOSE_SELECT).off("change"),new EffectiveRetentionPeriod(purposeRetentionPeriods)}}}));
/**
 * AMD module for categories actions.
 *
 * @module     tool_dataprivacy/categoriesactions
 * @package    tool_dataprivacy
 * @copyright  2018 David Monllao
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/categoriesactions",["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events"],(function($,Ajax,Notification,Str,ModalFactory,ModalEvents){var ACTIONS_DELETE='[data-action="deletecategory"]',CategoriesActions=function(){this.registerEvents()};return CategoriesActions.prototype.registerEvents=function(){$(ACTIONS_DELETE).click((function(e){e.preventDefault();var id=$(this).data("id"),stringkeys=[{key:"deletecategory",component:"tool_dataprivacy"},{key:"deletecategorytext",component:"tool_dataprivacy",param:$(this).data("name")},{key:"delete"}];Str.get_strings(stringkeys).then((function(langStrings){var title=langStrings[0],confirmMessage=langStrings[1],buttonText=langStrings[2];return ModalFactory.create({title:title,body:confirmMessage,type:ModalFactory.types.SAVE_CANCEL}).then((function(modal){return modal.setSaveButtonText(buttonText),modal.getRoot().on(ModalEvents.save,(function(){var request={methodname:"tool_dataprivacy_delete_category",args:{id:id}};Ajax.call([request])[0].done((function(data){data.result?$('tr[data-categoryid="'+id+'"]').remove():Notification.addNotification({message:data.warnings[0].message,type:"error"})})).fail(Notification.exception)})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal}))})).done((function(modal){modal.show()})).fail(Notification.exception)}))},{init:function(){return new CategoriesActions}}}));
/**
 * Request actions.
 *
 * @module     tool_dataprivacy/data_request_modal
 * @package    tool_dataprivacy
 * @copyright  2018 Jun Pataleta
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/data_request_modal",["jquery","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","tool_dataprivacy/events"],(function($,Notification,CustomEvents,Modal,ModalRegistry,DataPrivacyEvents){var registered=!1,SELECTORS_APPROVE_BUTTON='[data-action="approve"]',SELECTORS_DENY_BUTTON='[data-action="deny"]',SELECTORS_COMPLETE_BUTTON='[data-action="complete"]',ModalDataRequest=function(root){Modal.call(this,root)};return ModalDataRequest.TYPE="tool_dataprivacy-data_request",(ModalDataRequest.prototype=Object.create(Modal.prototype)).constructor=ModalDataRequest,ModalDataRequest.prototype.registerEventListeners=function(){Modal.prototype.registerEventListeners.call(this),this.getModal().on(CustomEvents.events.activate,SELECTORS_APPROVE_BUTTON,function(e,data){var approveEvent=$.Event(DataPrivacyEvents.approve);this.getRoot().trigger(approveEvent,this),approveEvent.isDefaultPrevented()||(this.hide(),data.originalEvent.preventDefault())}.bind(this)),this.getModal().on(CustomEvents.events.activate,SELECTORS_DENY_BUTTON,function(e,data){var denyEvent=$.Event(DataPrivacyEvents.deny);this.getRoot().trigger(denyEvent,this),denyEvent.isDefaultPrevented()||(this.hide(),data.originalEvent.preventDefault())}.bind(this)),this.getModal().on(CustomEvents.events.activate,SELECTORS_COMPLETE_BUTTON,function(e,data){var completeEvent=$.Event(DataPrivacyEvents.complete);this.getRoot().trigger(completeEvent,this),completeEvent.isDefaultPrevented()||(this.hide(),data.originalEvent.preventDefault())}.bind(this))},registered||(ModalRegistry.register(ModalDataRequest.TYPE,ModalDataRequest,"tool_dataprivacy/data_request_modal"),registered=!0),ModalDataRequest}));
/**
 * Contain the events the data privacy tool can fire.
 *
 * @module     tool_dataprivacy/events
 * @class      events
 * @package    tool_dataprivacy
 * @copyright  2018 Jun Pataleta
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/events",[],(function(){return{approve:"tool_dataprivacy-data_request:approve",bulkApprove:"tool_dataprivacy-data_request:bulk_approve",deny:"tool_dataprivacy-data_request:deny",bulkDeny:"tool_dataprivacy-data_request:bulk_deny",complete:"tool_dataprivacy-data_request:complete"}}));
/**
 * JS module for the data requests filter.
 *
 * @module     tool_dataprivacy/request_filter
 * @package    tool_dataprivacy
 * @copyright  2018 Jun Pataleta
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/request_filter",["jquery","core/form-autocomplete","core/str","core/notification"],(function($,Autocomplete,Str,Notification){var SELECTORS_REQUEST_FILTERS="#request-filters";return{init:function(){!function(){Str.get_strings([{key:"filter",component:"moodle"},{key:"nofiltersapplied",component:"moodle"}]).then((function(langstrings){var placeholder=langstrings[0],noSelectionString=langstrings[1];return Autocomplete.enhance(SELECTORS_REQUEST_FILTERS,!1,"",placeholder,!1,!0,noSelectionString,!0)})).fail(Notification.exception);var last=$(SELECTORS_REQUEST_FILTERS).val();$(SELECTORS_REQUEST_FILTERS).on("change",(function(){var current=$(this).val();last.join(",")!==current.join(",")&&(0===current.length&&$("#filters-cleared").val(1),$(this.form).submit())}))}()}}}));
/**
 * Request actions.
 *
 * @module     tool_dataprivacy/data_deletion
 * @package    tool_dataprivacy
 * @copyright  2018 Jun Pataleta
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/data_deletion",["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events"],(function($,Ajax,Notification,Str,ModalFactory,ModalEvents){var ACTIONS_MARK_FOR_DELETION='[data-action="markfordeletion"]',ACTIONS_SELECT_ALL='[data-action="selectall"]',SELECTORS_SELECTCONTEXT=".selectcontext",DataDeletionActions=function(){this.registerEvents()};return DataDeletionActions.prototype.registerEvents=function(){$(ACTIONS_MARK_FOR_DELETION).click((function(e){e.preventDefault();var ids,keys,wsfunction,modalTitle,selectedIds=[];$(SELECTORS_SELECTCONTEXT).each((function(){var checkbox=$(this);checkbox.is(":checked")&&selectedIds.push(checkbox.val())})),ids=selectedIds,keys=[{key:"confirm",component:"moodle"},{key:"confirmcontextdeletion",component:"tool_dataprivacy"}],wsfunction="tool_dataprivacy_confirm_contexts_for_deletion",modalTitle="",Str.get_strings(keys).then((function(langStrings){modalTitle=langStrings[0];var confirmMessage=langStrings[1];return ModalFactory.create({title:modalTitle,body:confirmMessage,type:ModalFactory.types.SAVE_CANCEL})})).then((function(modal){return modal.setSaveButtonText(modalTitle),modal.getRoot().on(ModalEvents.save,(function(){var request={methodname:wsfunction,args:{ids:ids}};Ajax.call([request])[0].done((function(data){data.result?window.location.reload():Notification.addNotification({message:data.warnings[0].message,type:"error"})})).fail(Notification.exception)})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal})).done((function(modal){modal.show()})).fail(Notification.exception)})),$(ACTIONS_SELECT_ALL).change((function(e){e.preventDefault(),$(this).is(":checked")?$(SELECTORS_SELECTCONTEXT).attr("checked","checked"):$(SELECTORS_SELECTCONTEXT).removeAttr("checked")}))},DataDeletionActions}));
/**
 * Request actions.
 *
 * @module     tool_dataprivacy/requestactions
 * @package    tool_dataprivacy
 * @copyright  2018 Jun Pataleta
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/requestactions",["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events","core/templates","tool_dataprivacy/data_request_modal","tool_dataprivacy/events"],(function($,Ajax,Notification,Str,ModalFactory,ModalEvents,Templates,ModalDataRequest,DataPrivacyEvents){var ACTIONS_APPROVE_REQUEST='[data-action="approve"]',ACTIONS_DENY_REQUEST='[data-action="deny"]',ACTIONS_VIEW_REQUEST='[data-action="view"]',ACTIONS_MARK_COMPLETE='[data-action="complete"]',ACTIONS_CONFIRM_BULK_ACTION='[id="confirm-bulk-action"]',ACTIONS_SELECT_ALL='[data-action="selectall"]',BULK_ACTIONS_APPROVE=1,BULK_ACTIONS_DENY=2,SELECTORS_SELECT_REQUEST=".selectrequests",RequestActions=function(){this.registerEvents()};function approveEventWsData(requestId){return{wsfunction:"tool_dataprivacy_approve_data_request",wsparams:{requestid:requestId}}}function denyEventWsData(requestId){return{wsfunction:"tool_dataprivacy_deny_data_request",wsparams:{requestid:requestId}}}function showConfirmation(action,wsdata){var keys=[];switch(action){case DataPrivacyEvents.approve:keys=[{key:"approverequest",component:"tool_dataprivacy"},{key:"confirmapproval",component:"tool_dataprivacy"}];break;case DataPrivacyEvents.bulkApprove:keys=[{key:"bulkapproverequests",component:"tool_dataprivacy"},{key:"confirmbulkapproval",component:"tool_dataprivacy"}];break;case DataPrivacyEvents.deny:keys=[{key:"denyrequest",component:"tool_dataprivacy"},{key:"confirmdenial",component:"tool_dataprivacy"}];break;case DataPrivacyEvents.bulkDeny:keys=[{key:"bulkdenyrequests",component:"tool_dataprivacy"},{key:"confirmbulkdenial",component:"tool_dataprivacy"}];break;case DataPrivacyEvents.complete:keys=[{key:"markcomplete",component:"tool_dataprivacy"},{key:"confirmcompletion",component:"tool_dataprivacy"}]}var modalTitle="";Str.get_strings(keys).then((function(langStrings){modalTitle=langStrings[0];var confirmMessage=langStrings[1];return ModalFactory.create({title:modalTitle,body:confirmMessage,type:ModalFactory.types.SAVE_CANCEL})})).then((function(modal){modal.setSaveButtonText(modalTitle),modal.getRoot().on(ModalEvents.save,(function(){handleSave(wsdata.wsfunction,wsdata.wsparams)})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.show()})).catch(Notification.exception)}function handleSave(wsfunction,params){var request={methodname:wsfunction,args:params};Ajax.call([request])[0].done((function(data){data.result?window.location.reload():Notification.addNotification({message:data.warnings[0].message,type:"error"})})).fail(Notification.exception)}return RequestActions.prototype.registerEvents=function(){$(ACTIONS_VIEW_REQUEST).click((function(e){e.preventDefault();var requestId=$(this).data("requestid"),request={methodname:"tool_dataprivacy_get_data_request",args:{requestid:requestId}},promises=Ajax.call([request]);$.when(promises[0]).then((function(data){return data.result?data.result:(Notification.addNotification({message:data.warnings[0].message,type:"error"}),!1)})).then((function(data){var body=Templates.render("tool_dataprivacy/request_details",data),templateContext={approvedeny:data.approvedeny,canmarkcomplete:data.canmarkcomplete};return ModalFactory.create({title:data.typename,body:body,type:ModalDataRequest.TYPE,large:!0,templateContext:templateContext})})).then((function(modal){modal.getRoot().on(DataPrivacyEvents.approve,(function(){showConfirmation(DataPrivacyEvents.approve,approveEventWsData(requestId))})),modal.getRoot().on(DataPrivacyEvents.deny,(function(){showConfirmation(DataPrivacyEvents.deny,denyEventWsData(requestId))})),modal.getRoot().on(DataPrivacyEvents.complete,(function(){handleSave("tool_dataprivacy_mark_complete",{requestid:requestId})})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.show()})).catch(Notification.exception)})),$(ACTIONS_APPROVE_REQUEST).click((function(e){e.preventDefault();var requestId=$(this).data("requestid");showConfirmation(DataPrivacyEvents.approve,approveEventWsData(requestId))})),$(ACTIONS_DENY_REQUEST).click((function(e){e.preventDefault();var requestId=$(this).data("requestid");showConfirmation(DataPrivacyEvents.deny,denyEventWsData(requestId))})),$(ACTIONS_MARK_COMPLETE).click((function(e){e.preventDefault();var requestId=$(this).data("requestid");showConfirmation(DataPrivacyEvents.complete,function(requestId){return{wsfunction:"tool_dataprivacy_mark_complete",wsparams:{requestid:requestId}}}(requestId))})),$(ACTIONS_CONFIRM_BULK_ACTION).click((function(){var requestIds=[],actionEvent="",wsdata={},bulkActionKeys=[{key:"selectbulkaction",component:"tool_dataprivacy"},{key:"selectdatarequests",component:"tool_dataprivacy"},{key:"ok"}],bulkaction=parseInt($("#bulk-action").val());if(bulkaction==BULK_ACTIONS_APPROVE||bulkaction==BULK_ACTIONS_DENY)if($(".selectrequests:checked").each((function(){requestIds.push($(this).val())})),requestIds.length<1)Str.get_strings(bulkActionKeys).done((function(langStrings){Notification.alert("",langStrings[1],langStrings[2])})).fail(Notification.exception);else{switch(bulkaction){case BULK_ACTIONS_APPROVE:actionEvent=DataPrivacyEvents.bulkApprove,wsdata=function(requestIds){return{wsfunction:"tool_dataprivacy_bulk_approve_data_requests",wsparams:{requestids:requestIds}}}(requestIds);break;case BULK_ACTIONS_DENY:actionEvent=DataPrivacyEvents.bulkDeny,wsdata=function(requestIds){return{wsfunction:"tool_dataprivacy_bulk_deny_data_requests",wsparams:{requestids:requestIds}}}(requestIds)}showConfirmation(actionEvent,wsdata)}else Str.get_strings(bulkActionKeys).done((function(langStrings){Notification.alert("",langStrings[0],langStrings[2])})).fail(Notification.exception)})),$(ACTIONS_SELECT_ALL).change((function(e){e.preventDefault();var selectAll=$(this).is(":checked");$(SELECTORS_SELECT_REQUEST).prop("checked",selectAll)}))},RequestActions}));
/**
 * Potential user selector module.
 *
 * @module     tool_dataprivacy/form-user-selector
 * @class      form-user-selector
 * @package    tool_dataprivacy
 * @copyright  2018 Jun Pataleta
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/form-user-selector",["jquery","core/ajax","core/templates"],(function($,Ajax,Templates){return{processResults:function(selector,results){var users=[];return $.each(results,(function(index,user){users.push({value:user.id,label:user._label})})),users},transport:function(selector,query,success,failure){Ajax.call([{methodname:"tool_dataprivacy_get_users",args:{query:query}}])[0].then((function(results){var promises=[],i=0;return $.each(results,(function(index,user){promises.push(Templates.render("tool_dataprivacy/form-user-selector-suggestion",user))})),$.when.apply($.when,promises).then((function(){var args=arguments;$.each(results,(function(index,user){user._label=args[i],i++})),success(results)}))})).fail(failure)}}}));
/**
 * AMD module to enable users to manage their own data requests.
 *
 * @module     tool_dataprivacy/myrequestactions
 * @package    tool_dataprivacy
 * @copyright  2018 Jun Pataleta
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/myrequestactions",["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events","core/templates","core/pending"],(function($,Ajax,Notification,Str,ModalFactory,ModalEvents,Templates,Pending){var ACTIONS_CANCEL_REQUEST='[data-action="cancel"]',ACTIONS_CONTACT_DPO='[data-action="contactdpo"]',MyRequestActions=function(){this.registerEvents()};return MyRequestActions.prototype.registerEvents=function(){$(ACTIONS_CANCEL_REQUEST).click((function(e){e.preventDefault();var requestId=$(this).data("requestid");Str.get_strings([{key:"cancelrequest",component:"tool_dataprivacy"},{key:"cancelrequestconfirmation",component:"tool_dataprivacy"}]).then((function(langStrings){var title=langStrings[0],confirmMessage=langStrings[1];return ModalFactory.create({title:title,body:confirmMessage,type:ModalFactory.types.SAVE_CANCEL}).then((function(modal){return modal.setSaveButtonText(title),modal.getRoot().on(ModalEvents.save,(function(){var request={methodname:"tool_dataprivacy_cancel_data_request",args:{requestid:requestId}};Ajax.call([request])[0].done((function(data){data.result?window.location.reload():Notification.addNotification({message:data.warnings[0].message,type:"error"})})).fail(Notification.exception)})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal}))})).done((function(modal){modal.show()})).fail(Notification.exception)})),$(ACTIONS_CONTACT_DPO).click((function(e){var pendingPromise=new Pending("dataprivacy/crud:initModal:contactdpo");e.preventDefault();var replyToEmail=$(this).data("replytoemail"),sendButtonText="";Str.get_strings([{key:"contactdataprotectionofficer",component:"tool_dataprivacy"},{key:"send",component:"tool_dataprivacy"}]).then((function(langStrings){var modalTitle=langStrings[0];sendButtonText=langStrings[1];var context={replytoemail:replyToEmail};return ModalFactory.create({title:modalTitle,body:Templates.render("tool_dataprivacy/contact_dpo",context),type:ModalFactory.types.SAVE_CANCEL,large:!0})})).then((function(modal){modal.setSaveButtonText(sendButtonText),modal.show(),modal.getRoot().on(ModalEvents.save,(function(e){var message=$("#message").val().trim();0===message.length?(e.preventDefault(),$('[data-region="messageinput"]').addClass("has-danger notifyproblem"),$("#id_error_message").removeAttr("hidden")):function(message){var request={methodname:"tool_dataprivacy_contact_dpo",args:{message:message}},requestType="success";Ajax.call([request])[0].then((function(data){return data.result?Str.get_string("requestsubmitted","tool_dataprivacy"):(requestType="error",data.warnings.join("<br>"))})).done((function(message){Notification.addNotification({message:message,type:requestType})})).fail(Notification.exception)}(message)})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()}))})).then(pendingPromise.resolve).catch(Notification.exception)}))},{init:function(){return new MyRequestActions}}}));
/**
 * Potential user selector module.
 *
 * @module     tool_dataprivacy/expand_contract
 * @class      page-expand-contract
 * @package    tool_dataprivacy
 * @copyright  2018 Adrian Greeve
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/expand_contract",["jquery","core/url","core/str"],(function($,url,str){var expandedImage=$('<img alt="" src="'+url.imageUrl("t/expanded")+'"/>'),collapsedImage=$('<img alt="" src="'+url.imageUrl("t/collapsed")+'"/>'),CLASSES_EXPAND="fa-caret-right",CLASSES_COLLAPSE="fa-caret-down";return{expandCollapse:function(targetnode,thisnode){targetnode.hasClass("hide")?(targetnode.removeClass("hide"),targetnode.addClass("visible"),targetnode.attr("aria-expanded",!0),thisnode.find(":header i.fa").removeClass(CLASSES_EXPAND),thisnode.find(":header i.fa").addClass(CLASSES_COLLAPSE),thisnode.find(":header img.icon").attr("src",expandedImage.attr("src"))):(targetnode.removeClass("visible"),targetnode.addClass("hide"),targetnode.attr("aria-expanded",!1),thisnode.find(":header i.fa").removeClass(CLASSES_COLLAPSE),thisnode.find(":header i.fa").addClass(CLASSES_EXPAND),thisnode.find(":header img.icon").attr("src",collapsedImage.attr("src")))},expandCollapseAll:function(nextstate){var currentstate="visible"==nextstate?"hide":"visible",ariaexpandedstate="visible"==nextstate,iconclassnow="visible"==nextstate?CLASSES_EXPAND:CLASSES_COLLAPSE,iconclassnext="visible"==nextstate?CLASSES_COLLAPSE:CLASSES_EXPAND,imagenow="visible"==nextstate?expandedImage.attr("src"):collapsedImage.attr("src");$("."+currentstate).each((function(){$(this).removeClass(currentstate),$(this).addClass(nextstate),$(this).attr("aria-expanded",ariaexpandedstate)})),$(".tool_dataprivacy-expand-all").data("visibilityState",currentstate),str.get_string(currentstate,"tool_dataprivacy").then((function(langString){$(".tool_dataprivacy-expand-all").html(langString)})).catch(Notification.exception),$(":header i.fa").each((function(){$(this).removeClass(iconclassnow),$(this).addClass(iconclassnext)})),$(":header img.icon").each((function(){$(this).attr("src",imagenow)}))}}}));
/**
 * Module to add categories.
 *
 * @module     tool_dataprivacy/add_category
 * @package    tool_dataprivacy
 * @copyright  2018 David Monllao
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/add_category",["jquery","core/str","core/ajax","core/notification","core/modal_factory","core/modal_events","core/fragment"],(function($,Str,Ajax,Notification,ModalFactory,ModalEvents,Fragment){var SELECTORS_CATEGORY_LINK='[data-add-element="category"]',AddCategory=function(contextId){this.contextId=contextId;this.strings=Str.get_strings([{key:"addcategory",component:"tool_dataprivacy"},{key:"save",component:"admin"}]),this.registerEventListeners()};return AddCategory.prototype.contextId=0,AddCategory.prototype.strings=0,AddCategory.prototype.registerEventListeners=function(){var trigger=$(SELECTORS_CATEGORY_LINK);trigger.on("click",function(){return this.strings.then(function(strings){ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:strings[0],body:""},trigger).done(function(modal){this.setupFormModal(modal,strings[1])}.bind(this))}.bind(this)).fail(Notification.exception)}.bind(this))},AddCategory.prototype.getBody=function(formdata){var params=null;return void 0!==formdata&&(params={jsonformdata:JSON.stringify(formdata)}),Fragment.loadFragment("tool_dataprivacy","addcategory_form",this.contextId,params)},AddCategory.prototype.setupFormModal=function(modal,saveText){modal.setLarge(),modal.setSaveButtonText(saveText),modal.getRoot().on(ModalEvents.hidden,this.destroy.bind(this)),modal.setBody(this.getBody()),modal.getRoot().on(ModalEvents.save,this.submitForm.bind(this)),modal.getRoot().on("submit","form",this.submitFormAjax.bind(this)),this.modal=modal,modal.show()},AddCategory.prototype.submitForm=function(e){e.preventDefault(),this.modal.getRoot().find("form").submit()},AddCategory.prototype.submitFormAjax=function(e){e.preventDefault();var formData=this.modal.getRoot().find("form").serialize();Ajax.call([{methodname:"tool_dataprivacy_create_category_form",args:{jsonformdata:JSON.stringify(formData)},done:function(data){data.validationerrors?this.modal.setBody(this.getBody(formData)):this.close()}.bind(this),fail:Notification.exception}])},AddCategory.prototype.close=function(){this.destroy(),document.location.reload()},AddCategory.prototype.destroy=function(){Y.use("moodle-core-formchangechecker",(function(){M.core_formchangechecker.reset_form_dirty_state()})),this.modal.destroy()},AddCategory.prototype.removeListeners=function(){$(SELECTORS_CATEGORY_LINK).off("click")},{getInstance:function(contextId){return new AddCategory(contextId)}}}));
/**
 * Module to add purposes.
 *
 * @module     tool_dataprivacy/add_purpose
 * @package    tool_dataprivacy
 * @copyright  2018 David Monllao
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/add_purpose",["jquery","core/str","core/ajax","core/notification","core/modal_factory","core/modal_events","core/fragment"],(function($,Str,Ajax,Notification,ModalFactory,ModalEvents,Fragment){var SELECTORS_PURPOSE_LINK='[data-add-element="purpose"]',AddPurpose=function(contextId){this.contextId=contextId;this.strings=Str.get_strings([{key:"addpurpose",component:"tool_dataprivacy"},{key:"save",component:"admin"}]),this.registerEventListeners()};return AddPurpose.prototype.contextId=0,AddPurpose.prototype.strings=0,AddPurpose.prototype.registerEventListeners=function(){var trigger=$(SELECTORS_PURPOSE_LINK);trigger.on("click",function(){return this.strings.then(function(strings){ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:strings[0],body:""},trigger).done(function(modal){this.setupFormModal(modal,strings[1])}.bind(this))}.bind(this)).fail(Notification.exception)}.bind(this))},AddPurpose.prototype.getBody=function(formdata){var params=null;return void 0!==formdata&&(params={jsonformdata:JSON.stringify(formdata)}),Fragment.loadFragment("tool_dataprivacy","addpurpose_form",this.contextId,params)},AddPurpose.prototype.setupFormModal=function(modal,saveText){modal.setLarge(),modal.setSaveButtonText(saveText),modal.getRoot().on(ModalEvents.hidden,this.destroy.bind(this)),modal.setBody(this.getBody()),modal.getRoot().on(ModalEvents.save,this.submitForm.bind(this)),modal.getRoot().on("submit","form",this.submitFormAjax.bind(this)),this.modal=modal,modal.show()},AddPurpose.prototype.submitForm=function(e){e.preventDefault(),this.modal.getRoot().find("form").submit()},AddPurpose.prototype.submitFormAjax=function(e){e.preventDefault();var formData=this.modal.getRoot().find("form").serialize();Ajax.call([{methodname:"tool_dataprivacy_create_purpose_form",args:{jsonformdata:JSON.stringify(formData)},done:function(data){data.validationerrors?this.modal.setBody(this.getBody(formData)):this.close()}.bind(this),fail:Notification.exception}])},AddPurpose.prototype.close=function(){this.destroy(),document.location.reload()},AddPurpose.prototype.destroy=function(){Y.use("moodle-core-formchangechecker",(function(){M.core_formchangechecker.reset_form_dirty_state()})),this.modal.destroy()},AddPurpose.prototype.removeListeners=function(){$(SELECTORS_PURPOSE_LINK).off("click")},{getInstance:function(contextId){return new AddPurpose(contextId)}}}));
/**
 * Request actions.
 *
 * @module     tool_dataprivacy/data_registry
 * @package    tool_dataprivacy
 * @copyright  2018 David Monllao
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/data_registry",["jquery","core/str","core/ajax","core/notification","core/templates","core/modal_factory","core/modal_events","core/fragment","tool_dataprivacy/add_purpose","tool_dataprivacy/add_category"],(function($,Str,Ajax,Notification,Templates,ModalFactory,ModalEvents,Fragment,AddPurpose,AddCategory){var SELECTORS_TREE_NODES="[data-context-tree-node=1]",SELECTORS_FORM_CONTAINER="#context-form-container",DataRegistry=function(systemContextId,initContextLevel,initContextId){this.systemContextId=systemContextId,this.currentContextLevel=initContextLevel,this.currentContextId=initContextId,this.init()};return DataRegistry.prototype.systemContextId=0,DataRegistry.prototype.currentContextLevel=0,DataRegistry.prototype.currentContextId=0,DataRegistry.prototype.addpurpose=null,DataRegistry.prototype.addcategory=null,DataRegistry.prototype.init=function(){this.addpurpose=AddPurpose.getInstance(this.systemContextId),this.addcategory=AddCategory.getInstance(this.systemContextId);this.strings=Str.get_strings([{key:"changessaved",component:"moodle"},{key:"contextpurposecategorysaved",component:"tool_dataprivacy"},{key:"noblockstoload",component:"tool_dataprivacy"},{key:"noactivitiestoload",component:"tool_dataprivacy"},{key:"nocoursestoload",component:"tool_dataprivacy"}]),this.registerEventListeners(),this.currentContextId?this.loadForm("context_form",[this.currentContextId],this.submitContextFormAjax.bind(this)):this.loadForm("contextlevel_form",[this.currentContextLevel],this.submitContextLevelFormAjax.bind(this))},DataRegistry.prototype.registerEventListeners=function(){$(SELECTORS_TREE_NODES).on("click",function(ev){ev.preventDefault();var trigger=$(ev.currentTarget);$(SELECTORS_TREE_NODES).removeClass("active"),trigger.addClass("active");var contextLevel=trigger.data("contextlevel"),contextId=trigger.data("contextid");if(contextLevel)window.history.pushState({},null,"?contextlevel="+contextLevel),this.addpurpose.removeListeners(),this.addcategory.removeListeners(),this.currentContextLevel=contextLevel,this.loadForm("contextlevel_form",[this.currentContextLevel],this.submitContextLevelFormAjax.bind(this));else if(contextId)window.history.pushState({},null,"?contextid="+contextId),this.addpurpose.removeListeners(),this.addcategory.removeListeners(),this.currentContextId=contextId,this.loadForm("context_form",[this.currentContextId],this.submitContextFormAjax.bind(this));else{var expandContextId=trigger.data("expandcontextid"),expandElement=trigger.data("expandelement"),expanded=trigger.data("expanded");expandElement&&(expanded?this.collapse(trigger):!trigger.data("loaded")&&expandContextId&&expandElement?(trigger.find("> i").removeClass("fa-plus"),trigger.find("> i").addClass("fa-circle-o-notch fa-spin"),this.loadExtra(trigger,expandContextId,expandElement)):this.expand(trigger))}}.bind(this))},DataRegistry.prototype.removeListeners=function(){$(SELECTORS_TREE_NODES).off("click")},DataRegistry.prototype.loadForm=function(fragmentName,fragmentArgs,formSubmitCallback){this.clearForm(),Fragment.loadFragment("tool_dataprivacy",fragmentName,this.systemContextId,fragmentArgs).done(function(html,js){$(SELECTORS_FORM_CONTAINER).html(html),Templates.runTemplateJS(js),this.addpurpose.registerEventListeners(),this.addcategory.registerEventListeners(),$(SELECTORS_FORM_CONTAINER).on("submit","form",formSubmitCallback)}.bind(this)).fail(Notification.exception)},DataRegistry.prototype.clearForm=function(){Y.use("moodle-core-formchangechecker",(function(){M.core_formchangechecker.reset_form_dirty_state()})),$(SELECTORS_FORM_CONTAINER).off("submit","form")},DataRegistry.prototype.submitForm=function(e){e.preventDefault(),$(SELECTORS_FORM_CONTAINER).find("form").submit()},DataRegistry.prototype.submitContextLevelFormAjax=function(e){this.submitFormAjax(e,"tool_dataprivacy_set_contextlevel_form")},DataRegistry.prototype.submitContextFormAjax=function(e){this.submitFormAjax(e,"tool_dataprivacy_set_context_form")},DataRegistry.prototype.submitFormAjax=function(e,saveMethodName){e.preventDefault();var formData=$(SELECTORS_FORM_CONTAINER).find("form").serialize();return this.strings.then((function(strings){Ajax.call([{methodname:saveMethodName,args:{jsonformdata:JSON.stringify(formData)},done:function(){Notification.alert(strings[0],strings[1])},fail:Notification.exception}])})).catch(Notification.exception)},DataRegistry.prototype.loadExtra=function(parentNode,expandContextId,expandElement){Ajax.call([{methodname:"tool_dataprivacy_tree_extra_branches",args:{contextid:expandContextId,element:expandElement},done:function(data){0!=data.branches.length?Templates.render("tool_dataprivacy/context_tree_branches",data).then(function(html){parentNode.after(html),this.removeListeners(),this.registerEventListeners(),this.expand(parentNode),parentNode.data("loaded",1)}.bind(this)).fail(Notification.exception):this.noElements(parentNode,expandElement)}.bind(this),fail:Notification.exception}])},DataRegistry.prototype.noElements=function(node,expandElement){node.data("expandcontextid",""),node.data("expandelement",""),this.strings.then((function(strings){var key=2;"module"==expandElement?key=3:"course"==expandElement&&(key=4),node.text(strings[key])})).fail(Notification.exception)},DataRegistry.prototype.collapse=function(node){node.data("expanded",0),node.siblings("nav").addClass("hidden"),node.find("> i").removeClass("fa-minus"),node.find("> i").addClass("fa-plus")},DataRegistry.prototype.expand=function(node){node.data("expanded",1),node.siblings("nav").removeClass("hidden"),node.find("> i").removeClass("fa-plus"),node.find("> i").removeClass("fa-circle-o-notch fa-spin"),node.find("> i").addClass("fa-minus")},{init:function(systemContextId,initContextLevel,initContextId){return new DataRegistry(systemContextId,initContextLevel,initContextId)}}}));
/**
 * AMD module for data registry defaults actions.
 *
 * @module     tool_dataprivacy/defaultsactions
 * @package    tool_dataprivacy
 * @copyright  2018 Jun Pataleta
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_dataprivacy/defaultsactions",["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events","core/templates"],(function($,Ajax,Notification,Str,ModalFactory,ModalEvents,Templates){var ACTIONS_EDIT_LEVEL_DEFAULTS='[data-action="edit-level-defaults"]',ACTIONS_NEW_ACTIVITY_DEFAULTS='[data-action="new-activity-defaults"]',ACTIONS_EDIT_ACTIVITY_DEFAULTS='[data-action="edit-activity-defaults"]',ACTIONS_DELETE_ACTIVITY_DEFAULTS='[data-action="delete-activity-defaults"]',DefaultsActions=function(){this.registerEvents()};function showDefaultsFormModal(title,contextLevel,category,purpose,activity,categoryOptions,purposeOptions,activityOptions){null!==category&&categoryOptions.forEach((function(currentValue){currentValue.id===category&&(currentValue.selected=!0)})),null!==purpose&&purposeOptions.forEach((function(currentValue){currentValue.id===purpose&&(currentValue.selected=!0)}));var templateContext={contextlevel:contextLevel,categoryoptions:categoryOptions,purposeoptions:purposeOptions};null!==activityOptions&&activityOptions.length&&(null===activity?templateContext.newactivitydefaults=!0:activityOptions.forEach((function(currentValue){activity===currentValue.name&&(currentValue.selected=!0)})),templateContext.modemodule=!0,templateContext.activityoptions=activityOptions),ModalFactory.create({title:title,body:Templates.render("tool_dataprivacy/category_purpose_form",templateContext),type:ModalFactory.types.SAVE_CANCEL,large:!0}).then((function(modal){return modal.getRoot().on(ModalEvents.save,(function(){var activity=$("#activity"),activityVal=void 0!==activity?activity.val():null,override=$("#override"),overrideVal=void 0!==override&&override.is(":checked");setContextDefaults($("#contextlevel").val(),$("#category").val(),$("#purpose").val(),activityVal,overrideVal)})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.show(),modal})).catch(Notification.exception)}function setContextDefaults(contextLevel,category,purpose,activity,override){var request={methodname:"tool_dataprivacy_set_context_defaults",args:{contextlevel:contextLevel,category:category,purpose:purpose,override:override,activity:activity}};Ajax.call([request])[0].done((function(data){data.result&&window.location.reload()}))}return DefaultsActions.prototype.registerEvents=function(){$(ACTIONS_EDIT_LEVEL_DEFAULTS).click((function(e){e.preventDefault();var button=$(this),contextLevel=button.data("contextlevel"),category=button.data("category"),purpose=button.data("purpose"),promises=Ajax.call([{methodname:"tool_dataprivacy_get_category_options",args:{}},{methodname:"tool_dataprivacy_get_purpose_options",args:{}}]),titlePromise=Str.get_string("editdefaults","tool_dataprivacy",$("#defaults-header").text());$.when(promises[0],promises[1],titlePromise).then((function(categoryResponse,purposeResponse,title){var categories=categoryResponse.options,purposes=purposeResponse.options;return showDefaultsFormModal(title,contextLevel,category,purpose,null,categories,purposes,null),!0})).catch(Notification.exception)})),$(ACTIONS_NEW_ACTIVITY_DEFAULTS).click((function(e){e.preventDefault();var contextLevel=$(this).data("contextlevel"),promises=Ajax.call([{methodname:"tool_dataprivacy_get_category_options",args:{}},{methodname:"tool_dataprivacy_get_purpose_options",args:{}},{methodname:"tool_dataprivacy_get_activity_options",args:{nodefaults:!0}}]),titlePromise=Str.get_string("addnewdefaults","tool_dataprivacy");$.when(promises[0],promises[1],promises[2],titlePromise).then((function(categoryResponse,purposeResponse,activityResponse,title){var categories=categoryResponse.options,purposes=purposeResponse.options,activities=activityResponse.options;return showDefaultsFormModal(title,contextLevel,null,null,null,categories,purposes,activities),!0})).catch(Notification.exception)})),$(ACTIONS_EDIT_ACTIVITY_DEFAULTS).click((function(e){e.preventDefault();var button=$(this),contextLevel=button.data("contextlevel"),category=button.data("category"),purpose=button.data("purpose"),activity=button.data("activityname"),promises=Ajax.call([{methodname:"tool_dataprivacy_get_category_options",args:{}},{methodname:"tool_dataprivacy_get_purpose_options",args:{}},{methodname:"tool_dataprivacy_get_activity_options",args:{}}]),titlePromise=Str.get_string("editmoduledefaults","tool_dataprivacy");$.when(promises[0],promises[1],promises[2],titlePromise).then((function(categoryResponse,purposeResponse,activityResponse,title){var categories=categoryResponse.options,purposes=purposeResponse.options,activities=activityResponse.options;return showDefaultsFormModal(title,contextLevel,category,purpose,activity,categories,purposes,activities),!0})).catch(Notification.exception)})),$(ACTIONS_DELETE_ACTIVITY_DEFAULTS).click((function(e){e.preventDefault();var button=$(this),contextLevel=button.data("contextlevel"),activity=button.data("activityname"),activityDisplayName=button.data("activitydisplayname");ModalFactory.create({title:Str.get_string("deletedefaults","tool_dataprivacy",activityDisplayName),body:Templates.render("tool_dataprivacy/delete_activity_defaults",{activityname:activityDisplayName}),type:ModalFactory.types.SAVE_CANCEL,large:!0}).then((function(modal){return modal.setSaveButtonText(Str.get_string("delete")),modal.getRoot().on(ModalEvents.save,(function(){setContextDefaults(contextLevel,-1,-1,activity,!1)})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.show(),!0})).catch(Notification.exception)}))},{init:function(){return new DefaultsActions}}}));
/**
 * Modal for confirming deletion of a custom license.
 *
 * @module     tool_licensemanager/delete_license
 * @class      delete_license
 * @package    tool_licensemanager
 * @copyright  2019 Tom Dickman <tomdickman@catalyst-au.net>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_licensemanager/delete_license",["jquery","core/modal_factory","core/modal_events","core/url","core/str"],(function($,ModalFactory,ModalEvents,Url,String){var trigger=$(".delete-license");ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:String.get_string("deletelicense","tool_licensemanager"),body:String.get_string("deletelicenseconfirmmessage","tool_licensemanager"),preShowCallback:function(triggerElement,modal){var params={action:"delete",license:(triggerElement=$(triggerElement)).data("license")};modal.deleteURL=Url.relativeUrl("/admin/tool/licensemanager/index.php",params,!0)},large:!0},trigger).done((function(modal){modal.getRoot().on(ModalEvents.save,(function(e){e.preventDefault(),window.location.href=modal.deleteURL}))}))}));
/**
 * Drag and drop reorder via HTML5.
 *
 * @module     tool_lp/dragdrop-reorder
 * @package    tool_lp
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/dragdrop-reorder",["core/str","core/yui"],(function(str,Y){var dragDropInstance=null,proxyCallback=function(e){var dragNode=e.drag.get("node"),dropNode=e.drop.get("node");this.callback(dragNode.getDOMNode(),dropNode.getDOMNode())};return{dragdrop:function(group,dragHandleText,sameNodeText,parentNodeText,sameNodeClass,parentNodeClass,dragHandleInsertClass,callback){str.get_strings([{key:"emptydragdropregion",component:"moodle"},{key:"movecontent",component:"moodle"},{key:"tocontent",component:"moodle"}]).done((function(){Y.use("moodle-tool_lp-dragdrop-reorder",(function(){var context={callback:callback};dragDropInstance&&dragDropInstance.destroy(),dragDropInstance=M.tool_lp.dragdrop_reorder({group:group,dragHandleText:dragHandleText,sameNodeText:sameNodeText,parentNodeText:parentNodeText,sameNodeClass:sameNodeClass,parentNodeClass:parentNodeClass,dragHandleInsertClass:dragHandleInsertClass,callback:Y.bind(proxyCallback,context)})}))}))}}}));
/**
 * Handle selection changes on the competency tree.
 *
 * @module     tool_lp/competencyselect
 * @package    tool_lp
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/competencytree",["core/ajax","core/notification","core/templates","tool_lp/tree","tool_lp/competency_outcomes","jquery"],(function(ajax,notification,templates,Ariatree,CompOutcomes,$){var competencies={},competencyFrameworkId=0,competencyFrameworkShortName="",treeSelector="",currentNodeId="",competencyFramworkCanManage=!1,addChildren=function addChildren(parent,all){var i=0,current=!1;for(parent.haschildren=!1,parent.children=[],i=0;i<all.length;i++)(current=all[i]).parentid==parent.id&&(parent.haschildren=!0,parent.children.push(current),addChildren(current,all))},loadCompetencies=function(searchtext){var deferred=$.Deferred();return templates.render("tool_lp/loading",{}).done((function(loadinghtml,loadingjs){templates.replaceNodeContents($(treeSelector),loadinghtml,loadingjs),ajax.call([{methodname:"core_competency_search_competencies",args:{searchtext:searchtext,competencyframeworkid:competencyFrameworkId}}])[0].done((function(result){competencies={};var i=0;for(i=0;i<result.length;i++)competencies[result[i].id]=result[i];var children=[],competency=!1;for(i=0;i<result.length;i++)competency=result[i],0===parseInt(competency.parentid,10)&&(children.push(competency),addChildren(competency,result));var context={shortname:competencyFrameworkShortName,canmanage:competencyFramworkCanManage,competencies:children};templates.render("tool_lp/competencies_tree_root",context).done((function(html,js){templates.replaceNodeContents($(treeSelector),$(html).html(),js);var tree=new Ariatree(treeSelector,!1);if(currentNodeId){var node=$(treeSelector).find("[data-id="+currentNodeId+"]");node.length&&(tree.selectItem(node),tree.updateFocus(node))}deferred.resolve(competencies)})).fail(deferred.reject)})).fail(deferred.reject)})),deferred.promise()},rememberCurrent=function(evt,params){var node=params.selected;currentNodeId=node.attr("data-id")};return{init:function(id,shortname,search,selector,canmanage,competencyid){competencyFrameworkId=id,competencyFrameworkShortName=shortname,competencyFramworkCanManage=canmanage,treeSelector=selector,loadCompetencies(search).fail(notification.exception),competencyid>0&&(currentNodeId=competencyid),this.on("selectionchanged",rememberCurrent)},on:function(eventname,handler){$(treeSelector).on(eventname,handler)},getChildren:function(id){var children=[];return $.each(competencies,(function(index,competency){competency.parentid==id&&children.push(competency)})),children},getCompetencyFrameworkId:function(){return competencyFrameworkId},getCompetency:function(id){return competencies[id]},getCompetencyLevel:function(id){return this.getCompetency(id).path.replace(/^\/|\/$/g,"").split("/").length},hasChildren:function(id){return this.getChildren(id).length>0},hasRule:function(id){var comp=this.getCompetency(id);return!!comp&&(comp.ruleoutcome!=CompOutcomes.OUTCOME_NONE&&comp.ruletype)},reloadCompetencies:function(){return loadCompetencies("").fail(notification.exception)},listCompetencies:function(){return competencies}}}));
/**
 * Competency rule points module.
 *
 * @package    tool_lp
 * @copyright  2015 Frdric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/competency_rule_points",["jquery","core/str","core/templates","tool_lp/competency_rule"],(function($,Str,Templates,RuleBase){var Rule=function(){RuleBase.apply(this,arguments)};return(Rule.prototype=Object.create(RuleBase.prototype))._container=null,Rule.prototype._templateLoaded=!1,Rule.prototype.getConfig=function(){return JSON.stringify({base:{points:this._getRequiredPoints()},competencies:this._getCompetenciesConfig()})},Rule.prototype._getCompetenciesConfig=function(){var competencies=[];return this._container.find("[data-competency]").each((function(){var node=$(this),id=node.data("competency"),points=parseInt(node.find('[name="points"]').val(),10),required=node.find('[name="required"]').prop("checked");competencies.push({id:id,points:points,required:required?1:0})})),competencies},Rule.prototype._getRequiredPoints=function(){return parseInt(this._container.find('[name="requiredpoints"]').val()||1,10)},Rule.prototype.getType=function(){return"core_competency\\competency_rule_points"},Rule.prototype.injectTemplate=function(container){var context,self=this,children=this._tree.getChildren(this._competency.id),config={base:{points:2},competencies:[]};if(this._templateLoaded=!1,self._competency.ruletype==self.getType())try{config=JSON.parse(self._competency.ruleconfig)}catch(e){}return context={requiredpoints:config&&config.base?config.base.points:2,competency:self._competency,children:[]},$.each(children,(function(index,child){var competency={id:child.id,shortname:child.shortname,required:!1,points:0};config&&$.each(config.competencies,(function(index,comp){comp.id==competency.id&&(competency.required=!!comp.required,competency.points=comp.points)})),context.children.push(competency)})),Templates.render("tool_lp/competency_rule_points",context).then((function(html){self._container=container,container.html(html),container.find("input").change((function(){self._triggerChange()})),self._templateLoaded=!0,self._triggerChange()}))},Rule.prototype.isValid=function(){if(!this._templateLoaded)return!1;var required=this._getRequiredPoints(),max=0,valid=!0;return $.each(this._getCompetenciesConfig(),(function(index,competency){competency.points<0&&(valid=!1),max+=competency.points})),valid=valid&&max>=required},Rule}));
/**
 * Module to navigation between users in a course.
 *
 * @package    tool_lp
 * @copyright  2019 Damyon Wiese
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/module_navigation",["jquery"],(function($){var ModuleNavigation=function(moduleSelector,baseUrl,courseId,moduleId){this._baseUrl=baseUrl,this._moduleId=moduleId,this._courseId=courseId,$(moduleSelector).on("change",this._moduleChanged.bind(this))};return ModuleNavigation.prototype._moduleChanged=function(e){var queryStr="?mod="+$(e.target).val()+"&courseid="+this._courseId;document.location=this._baseUrl+queryStr},ModuleNavigation.prototype._courseId=null,ModuleNavigation.prototype._moduleId=null,ModuleNavigation.prototype._baseUrl=null,ModuleNavigation}));
/**
 * Event click on selecting competency in the competency autocomplete.
 *
 * @package    tool_lp
 * @copyright  2016 Issam Taboubi <issam.taboubi@umontreal.ca>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/competency_plan_navigation",["jquery"],(function($){var CompetencyPlanNavigation=function(competencySelector,baseUrl,userId,competencyId,planId){this._baseUrl=baseUrl,this._userId=userId+"",this._competencyId=competencyId+"",this._planId=planId,this._ignoreFirstCompetency=!0,$(competencySelector).on("change",this._competencyChanged.bind(this))};return CompetencyPlanNavigation.prototype._competencyChanged=function(e){if(this._ignoreFirstCompetency)this._ignoreFirstCompetency=!1;else{var newCompetencyId=$(e.target).val(),queryStr="?userid="+this._userId+"&planid="+this._planId+"&competencyid="+newCompetencyId;document.location=this._baseUrl+queryStr}},CompetencyPlanNavigation.prototype._competencyId=null,CompetencyPlanNavigation.prototype._userId=null,CompetencyPlanNavigation.prototype._planId=null,CompetencyPlanNavigation.prototype._baseUrl=null,CompetencyPlanNavigation.prototype._ignoreFirstCompetency=null,CompetencyPlanNavigation}));
/**
 * Module to refresh a user competency summary in a page.
 *
 * @package    tool_lp
 * @copyright  2015 Damyon Wiese
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/user_competency_info",["jquery","core/notification","core/ajax","core/templates"],(function($,notification,ajax,templates){var Info=function(rootElement,competencyId,userId,planId,courseId,displayuser){this._rootElement=rootElement,this._competencyId=competencyId,this._userId=userId,this._planId=planId,this._courseId=courseId,this._valid=!0,this._displayuser=void 0!==displayuser&&displayuser,this._planId?(this._methodName="tool_lp_data_for_user_competency_summary_in_plan",this._args={competencyid:this._competencyId,planid:this._planId},this._templateName="tool_lp/user_competency_summary_in_plan"):this._courseId?(this._methodName="tool_lp_data_for_user_competency_summary_in_course",this._args={userid:this._userId,competencyid:this._competencyId,courseid:this._courseId},this._templateName="tool_lp/user_competency_summary_in_course"):(this._methodName="tool_lp_data_for_user_competency_summary",this._args={userid:this._userId,competencyid:this._competencyId},this._templateName="tool_lp/user_competency_summary")};return Info.prototype.reload=function(){var self=this;this._valid&&ajax.call([{methodname:this._methodName,args:this._args}])[0].done((function(context){self._displayuser&&(context.displayuser=!0),templates.render(self._templateName,context).done((function(html,js){templates.replaceNode(self._rootElement,html,js)})).fail(notification.exception)})).fail(notification.exception)},Info.prototype._rootElement=null,Info.prototype._courseId=null,Info.prototype._valid=null,Info.prototype._planId=null,Info.prototype._competencyId=null,Info.prototype._userId=null,Info.prototype._methodName=null,Info.prototype._args=null,Info.prototype._templateName=null,Info.prototype._displayuser=!1,Info}));
/**
 * Competency rule config.
 *
 * @package    tool_lp
 * @copyright  2015 Frdric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/competencyruleconfig",["jquery","core/notification","core/templates","tool_lp/dialogue","tool_lp/competency_outcomes","core/str"],(function($,Notification,Templates,Dialogue,Outcomes,Str){var RuleConfig=function(tree,rulesModules){this._eventNode=$("<div></div>"),this._tree=tree,this._rulesModules=rulesModules,this._setUp()};return RuleConfig.prototype._competency=null,RuleConfig.prototype._eventNode=null,RuleConfig.prototype._outcomesOption=null,RuleConfig.prototype._popup=null,RuleConfig.prototype._ready=null,RuleConfig.prototype._rules=null,RuleConfig.prototype._rulesModules=null,RuleConfig.prototype._tree=null,RuleConfig.prototype._afterChange=function(){this._isValid()?this._find('[data-action="save"]').prop("disabled",!1):this._find('[data-action="save"]').prop("disabled",!0)},RuleConfig.prototype._afterRuleConfigChange=function(e,rule){rule==this._getRule()&&this._afterChange()},RuleConfig.prototype._afterRender=function(){var self=this;self._find('[name="outcome"]').on("change",(function(){self._switchedOutcome()})).trigger("change"),self._find('[name="rule"]').on("change",(function(){self._switchedRule()})).trigger("change"),self._find('[data-action="save"]').on("click",(function(){self._trigger("save",self._getConfig()),self.close()})),self._find('[data-action="cancel"]').on("click",(function(){self.close()}))},RuleConfig.prototype.canBeConfigured=function(){var can=!1;return $.each(this._rules,(function(index,rule){rule.canConfig()&&(can=!0)})),can},RuleConfig.prototype.close=function(){this._popup.close(),this._popup=null},RuleConfig.prototype.display=function(){var self=this;return!!self._competency&&$.when(Str.get_string("competencyrule","tool_lp"),self._render()).then((function(title,render){self._popup=new Dialogue(title,render[0],self._afterRender.bind(self))})).fail(Notification.exception)},RuleConfig.prototype._find=function(selector){return $(this._popup.getContent()).find(selector)},RuleConfig.prototype._getApplicableOutcomesOptions=function(){var self=this,options=[];return $.each(self._outcomesOption,(function(index,outcome){options.push({code:outcome.code,name:outcome.name,selected:outcome.code==self._competency.ruleoutcome})})),options},RuleConfig.prototype._getApplicableRulesOptions=function(){var self=this,options=[];return $.each(self._rules,(function(index,rule){rule.canConfig()&&options.push({name:self._getRuleName(rule.getType()),type:rule.getType(),selected:rule.getType()==self._competency.ruletype})})),options},RuleConfig.prototype._getConfig=function(){var rule=this._getRule();return{ruletype:rule?rule.getType():null,ruleconfig:rule?rule.getConfig():null,ruleoutcome:this._getOutcome()}},RuleConfig.prototype._getOutcome=function(){return this._find('[name="outcome"]').val()},RuleConfig.prototype._getRule=function(){var result,type=this._find('[name="rule"]').val();return $.each(this._rules,(function(index,rule){rule.getType()!=type||(result=rule)})),result},RuleConfig.prototype._getRuleName=function(type){var name;return $.each(this._rulesModules,(function(index,modInfo){modInfo.type!=type||(name=modInfo.name)})),name},RuleConfig.prototype._initOutcomes=function(){var self=this;return Outcomes.getAll().then((function(outcomes){self._outcomesOption=outcomes}))},RuleConfig.prototype._initRules=function(){var self=this,promises=[];return $.each(self._rules,(function(index,rule){var promise=rule.init().then((function(){rule.setTargetCompetency(self._competency),rule.on("change",self._afterRuleConfigChange.bind(self))}),(function(){return self._rules.splice(index,1),$.when()}));promises.push(promise)})),$.when.apply($.when,promises)},RuleConfig.prototype._isValid=function(){var outcome=this._getOutcome(),rule=this._getRule();return outcome==Outcomes.NONE||!!rule&&rule.isValid()},RuleConfig.prototype.on=function(type,handler){this._eventNode.on(type,handler)},RuleConfig.prototype._preRender=function(){return this.ready()},RuleConfig.prototype.ready=function(){return this._ready.promise()},RuleConfig.prototype._render=function(){var self=this;return this._preRender().then((function(){var config;self.canBeConfigured()?((config={}).outcomes=self._getApplicableOutcomesOptions(),config.rules=self._getApplicableRulesOptions()):config=!1;var context={competencyshortname:self._competency.shortname,config:config};return Templates.render("tool_lp/competency_rule_config",context)}))},RuleConfig.prototype.setTargetCompetencyId=function(competencyId){var self=this;self._competency=self._tree.getCompetency(competencyId),$.each(self._rules,(function(index,rule){rule.setTargetCompetency(self._competency)}))},RuleConfig.prototype._setUp=function(){var self=this,promises=[],modules=[];self._ready=$.Deferred(),self._rules=[],$.each(self._rulesModules,(function(index,rule){modules.push(rule.amd)})),require(modules,(function(){$.each(arguments,(function(index,Module){var rule=new Module(self._tree);self._rules.push(rule)})),promises.push(self._initRules()),promises.push(self._initOutcomes()),$.when.apply($.when,promises).always((function(){self._ready.resolve()}))}))},RuleConfig.prototype._switchedOutcome=function(){if(this._getOutcome()==Outcomes.NONE)return this._find('[data-region="rule-type"]').hide().find('[name="rule"]').val(-1),this._find('[data-region="rule-config"]').empty().hide(),void this._afterChange();this._find('[data-region="rule-type"]').show(),this._find('[data-region="rule-config"]').show(),this._afterChange()},RuleConfig.prototype._switchedRule=function(){var self=this,container=self._find('[data-region="rule-config"]'),rule=self._getRule();if(!rule)return container.empty().hide(),void self._afterChange();rule.injectTemplate(container).then((function(){container.show()})).always((function(){self._afterChange()})).catch((function(){container.empty().hide()}))},RuleConfig.prototype._trigger=function(type,data){this._eventNode.trigger(type,[data])},RuleConfig}));
/**
 * Display Competency in dialogue box.
 *
 * @module     tool_lp/Competencydialogue
 * @package    tool_lp
 * @copyright  2015 Issam Taboubi <issam.taboubi@umontreal.ca>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/competencydialogue",["jquery","core/notification","core/ajax","core/templates","core/str","tool_lp/dialogue"],(function($,notification,ajax,templates,str,Dialogue){var instance,Competencydialogue=function(){};return Competencydialogue.prototype.triggerCompetencyViewedEvent=function(competencyId){ajax.call([{methodname:"core_competency_competency_viewed",args:{id:competencyId}}])},Competencydialogue.prototype.showDialogue=function(competencyid,options){var datapromise=this.getCompetencyDataPromise(competencyid,options),localthis=this;datapromise.done((function(data){templates.render("tool_lp/competency_summary",data).done((function(html){localthis.triggerCompetencyViewedEvent(competencyid),new Dialogue(data.competency.shortname,html)})).fail(notification.exception)})).fail(notification.exception)},Competencydialogue.prototype.showDialogueFromData=function(dataSource){var localthis=this;templates.render("tool_lp/competency_summary",dataSource).done((function(html){localthis.triggerCompetencyViewedEvent(dataSource.id),new Dialogue(dataSource.shortname,html,localthis.enhanceDialogue)})).fail(notification.exception)},Competencydialogue.prototype.clickEventHandler=function(e){var compdialogue=e.data.compdialogue,currentTarget=$(e.currentTarget),competencyid=currentTarget.data("id"),includerelated=!currentTarget.data("excluderelated"),includecourses=currentTarget.data("includecourses");compdialogue.showDialogue(competencyid,{includerelated:includerelated,includecourses:includecourses}),e.preventDefault()},Competencydialogue.prototype.getCompetencyDataPromise=function(competencyid,options){return ajax.call([{methodname:"tool_lp_data_for_competency_summary",args:{competencyid:competencyid,includerelated:options.includerelated||!1,includecourses:options.includecourses||!1}}])[0].then((function(context){return context})).fail(notification.exception)},{init:function(){void 0===instance&&(instance=new Competencydialogue,$("body").delegate('[data-action="competency-dialogue"]',"click",{compdialogue:instance},instance.clickEventHandler.bind(instance)))}}}));
/**
 * Badge select competency actions
 *
 * @module     tool_lp/form_competency_element
 * @package    tool_lp
 * @copyright  2019 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/form_competency_element",["jquery","tool_lp/competencypicker","core/ajax","core/notification","core/templates"],(function($,Picker,Ajax,Notification,Templates){var pickerInstance=null,pageContextId=1,renderCompetencies=function(){var currentCompetencies=$('[data-action="competencies"]').val(),requests=[],i=0;if(""!=currentCompetencies)for(currentCompetencies=currentCompetencies.split(","),i=0;i<currentCompetencies.length;i++)requests[requests.length]={methodname:"core_competency_read_competency",args:{id:currentCompetencies[i]}};return $.when.apply($,Ajax.call(requests,!1)).then((function(){var i=0,competencies=[];for(i=0;i<arguments.length;i++)competencies[i]=arguments[i];var context={competencies:competencies};return Templates.render("tool_lp/form_competency_list",context)})).then((function(html,js){return Templates.replaceNode($('[data-region="competencies"]'),html,js),!0})).fail(Notification.exception),!0},unpickCompetenciesHandler=function(e){var i,currentCompetencies=$('[data-action="competencies"]').val().split(","),newCompetencies=[],toRemove=$(e.currentTarget).data("id");for(i=0;i<currentCompetencies.length;i++)currentCompetencies[i]!=toRemove&&(newCompetencies[newCompetencies.length]=currentCompetencies[i]);return $('[data-action="competencies"]').val(newCompetencies.join(",")),renderCompetencies()},pickCompetenciesHandler=function(){var currentCompetencies=$('[data-action="competencies"]').val().split(",");pickerInstance||(pickerInstance=new Picker(pageContextId,!1,"parents",!0)).on("save",(function(e,data){var before=$('[data-action="competencies"]').val(),compIds=data.competencyIds;""!=before&&(compIds=compIds.concat(before.split(",")));var value=compIds.join(",");return $('[data-action="competencies"]').val(value),renderCompetencies()})),pickerInstance.setDisallowedCompetencyIDs(currentCompetencies),pickerInstance.display()};return{init:function(contextId){pageContextId=contextId,renderCompetencies(),$('[data-action="select-competencies"]').on("click",pickCompetenciesHandler),$("body").on("click",'[data-action="deselect-competency"]',unpickCompetenciesHandler)}}}));
/**
 * Handle selecting parent competency in competency form.
 *
 * @module     tool_lp/parentcompetency_form
 * @package    tool_lp
 * @copyright  2015 Issam Taboubi <issam.taboubi@umontreal.ca>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/parentcompetency_form",["jquery","core/ajax","core/str","tool_lp/competencypicker","core/templates","core/notification"],(function($,ajax,Str,Picker,Templates,Notification){var ParentCompetencyForm=function(buttonSelector,inputHiddenSelector,staticElementSelector,frameworkId,pageContextId){this.buttonSelector=buttonSelector,this.inputHiddenSelector=inputHiddenSelector,this.staticElementSelector=staticElementSelector,this.frameworkId=frameworkId,this.pageContextId=pageContextId,this.registerEvents()};return ParentCompetencyForm.prototype.buttonSelector=null,ParentCompetencyForm.prototype.inputHiddenSelector=null,ParentCompetencyForm.prototype.staticElementSelector=null,ParentCompetencyForm.prototype.frameworkId=null,ParentCompetencyForm.prototype.pageContextId=null,ParentCompetencyForm.prototype.setParent=function(data){var self=this;0!==data.competencyId?ajax.call([{methodname:"core_competency_read_competency",args:{id:data.competencyId}}])[0].done((function(competency){$(self.staticElementSelector).html(competency.shortname),$(self.inputHiddenSelector).val(competency.id)})).fail(Notification.exception):Str.get_string("competencyframeworkroot","tool_lp").then((function(rootframework){$(self.staticElementSelector).html(rootframework),$(self.inputHiddenSelector).val(data.competencyId)})).fail(Notification.exception)},ParentCompetencyForm.prototype.registerEvents=function(){var self=this;$(self.buttonSelector).on("click",(function(e){e.preventDefault();var picker=new Picker(self.pageContextId,self.frameworkId,"self",!1);picker._render=function(){var self=this;return self._preRender().then((function(){var context={competencies:self._competencies,framework:self._getFramework(self._frameworkId),frameworks:self._frameworks,search:self._searchText,singleFramework:self._singleFramework};return Templates.render("tool_lp/competency_picker_competencyform",context)}))},picker.on("save",(function(e,data){self.setParent(data)})),picker.display()}))},{init:function(buttonSelector,inputSelector,staticElementSelector,frameworkId,pageContextId){new ParentCompetencyForm(buttonSelector,inputSelector,staticElementSelector,frameworkId,pageContextId)}}}));
/**
 * Competency picker.
 *
 * To handle 'save' events use: picker.on('save')
 * This will receive a object with either a single 'competencyId', or an array in 'competencyIds'
 * depending on the value of multiSelect.
 *
 * @package    tool_lp
 * @copyright  2015 Frdric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/competencypicker",["jquery","core/notification","core/ajax","core/templates","tool_lp/dialogue","core/str","tool_lp/tree","core/pending"],(function($,Notification,Ajax,Templates,Dialogue,Str,Tree,Pending){var Picker=function(pageContextId,singleFramework,pageContextIncludes,multiSelect){this._eventNode=$("<div></div>"),this._frameworks=[],this._reset(),this._pageContextId=pageContextId,this._pageContextIncludes=pageContextIncludes||"children",this._multiSelect=void 0===multiSelect||!0===multiSelect,singleFramework&&(this._frameworkId=singleFramework,this._singleFramework=!0)};return Picker.prototype._competencies=null,Picker.prototype._disallowedCompetencyIDs=null,Picker.prototype._eventNode=null,Picker.prototype._frameworks=null,Picker.prototype._frameworkId=null,Picker.prototype._pageContextId=null,Picker.prototype._pageContextIncludes=null,Picker.prototype._popup=null,Picker.prototype._searchText="",Picker.prototype._selectedCompetencies=null,Picker.prototype._singleFramework=!1,Picker.prototype._multiSelect=!0,Picker.prototype._onlyVisible=!0,Picker.prototype._afterRender=function(){var self=this,tree=new Tree(self._find("[data-enhance=linktree]"),self._multiSelect);self._find("[data-enhance=linktree]").show(),tree.on("selectionchanged",(function(evt,params){var selected=params.selected;evt.preventDefault();var validIds=[];$.each(selected,(function(index,item){var compId=$(item).data("id"),valid=!0;void 0===compId?valid=!1:$.each(self._disallowedCompetencyIDs,(function(i,id){id==compId&&(valid=!1)})),valid&&validIds.push(compId)})),self._selectedCompetencies=validIds,self._selectedCompetencies.length?self._find('[data-region="competencylinktree"] [data-action="add"]').removeAttr("disabled"):self._find('[data-region="competencylinktree"] [data-action="add"]').attr("disabled","disabled")})),self._singleFramework||self._find('[data-action="chooseframework"]').change((function(e){self._frameworkId=$(e.target).val(),self._loadCompetencies().then(self._refresh.bind(self)).catch(Notification.exception)})),self._find('[data-region="filtercompetencies"] button').click((function(e){return e.preventDefault(),$(e.target).attr("disabled","disabled"),self._searchText=self._find('[data-region="filtercompetencies"] input').val()||"",self._refresh().always((function(){$(e.target).removeAttr("disabled")}))})),self._find('[data-region="competencylinktree"] [data-action="cancel"]').click((function(e){e.preventDefault(),self.close()})),self._find('[data-region="competencylinktree"] [data-action="add"]').click((function(e){e.preventDefault();var pendingPromise=new Pending;self._selectedCompetencies.length&&(self._multiSelect?self._trigger("save",{competencyIds:self._selectedCompetencies}):self._trigger("save",{competencyId:self._selectedCompetencies[0]}),self.close(),pendingPromise.resolve())}));var currentItems=self._selectedCompetencies.slice(0);$.each(currentItems,(function(index,id){var node=self._find("[data-id="+id+"]");node.length&&(tree.toggleItem(node),tree.updateFocus(node))}))},Picker.prototype.close=function(){this._popup.close(),this._reset()},Picker.prototype.display=function(){var self=this;return $.when(Str.get_string("competencypicker","tool_lp"),self._render()).then((function(title,render){self._popup=new Dialogue(title,render[0],self._afterRender.bind(self))})).catch(Notification.exception)},Picker.prototype._fetchCompetencies=function(frameworkId,searchText){var self=this;return Ajax.call([{methodname:"core_competency_search_competencies",args:{searchtext:searchText,competencyframeworkid:frameworkId}}])[0].done((function(competencies){function addCompetencyChildren(parent,competencies){for(var i=0;i<competencies.length;i++)competencies[i].parentid==parent.id&&(parent.haschildren=!0,competencies[i].children=[],competencies[i].haschildren=!1,parent.children[parent.children.length]=competencies[i],addCompetencyChildren(competencies[i],competencies))}var i,comp,tree=[];for(i=0;i<competencies.length;i++)"0"==(comp=competencies[i]).parentid&&(comp.children=[],comp.haschildren=0,tree[tree.length]=comp,addCompetencyChildren(comp,competencies));self._competencies=tree})).fail(Notification.exception)},Picker.prototype._find=function(selector){return $(this._popup.getContent()).find(selector)},Picker.prototype._getFramework=function(fid){var frm;return $.each(this._frameworks,(function(i,f){f.id!=fid||(frm=f)})),frm},Picker.prototype._loadCompetencies=function(){return this._fetchCompetencies(this._frameworkId,this._searchText)},Picker.prototype._loadFrameworks=function(){var self=this;return self._frameworks.length>0?$.when():(self._singleFramework?Ajax.call([{methodname:"core_competency_read_competency_framework",args:{id:this._frameworkId}}])[0].then((function(framework){return[framework]})):Ajax.call([{methodname:"core_competency_list_competency_frameworks",args:{sort:"shortname",context:{contextid:self._pageContextId},includes:self._pageContextIncludes,onlyvisible:self._onlyVisible}}])[0]).done((function(frameworks){self._frameworks=frameworks})).fail(Notification.exception)},Picker.prototype.on=function(type,handler){this._eventNode.on(type,handler)},Picker.prototype._preRender=function(){var self=this;return self._loadFrameworks().then((function(){return!self._frameworkId&&self._frameworks.length>0&&(self._frameworkId=self._frameworks[0].id),self._frameworkId?self._loadCompetencies():(self._frameworks=[],$.when())}))},Picker.prototype._refresh=function(){var self=this;return self._render().then((function(html){self._find('[data-region="competencylinktree"]').replaceWith(html),self._afterRender()}))},Picker.prototype._render=function(){var self=this;return self._preRender().then((function(){self._singleFramework||$.each(self._frameworks,(function(i,framework){framework.id==self._frameworkId?framework.selected=!0:framework.selected=!1}));var context={competencies:self._competencies,framework:self._getFramework(self._frameworkId),frameworks:self._frameworks,search:self._searchText,singleFramework:self._singleFramework};return Templates.render("tool_lp/competency_picker",context)}))},Picker.prototype._reset=function(){this._competencies=[],this._disallowedCompetencyIDs=[],this._popup=null,this._searchText="",this._selectedCompetencies=[]},Picker.prototype.setDisallowedCompetencyIDs=function(ids){this._disallowedCompetencyIDs=ids},Picker.prototype._trigger=function(type,data){this._eventNode.trigger(type,[data])},Picker}));
/**
 * Wrapper for the YUI M.core.notification class. Allows us to
 * use the YUI version in AMD code until it is replaced.
 *
 * @module     tool_lp/dialogue
 * @package    tool_lp
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/dialogue",["core/yui"],(function(Y){var dialogue=function(title,content,afterShow,afterHide,wide){M.util.js_pending("tool_lp/dialogue:dialogue"),this.yuiDialogue=null;var parent=this;void 0===wide&&(wide=!1),Y.use("moodle-core-notification","timers",(function(){var width="480px";wide&&(width="800px"),parent.yuiDialogue=new M.core.dialogue({headerContent:title,bodyContent:content,draggable:!0,visible:!1,center:!0,modal:!0,width:width}),parent.yuiDialogue.before("visibleChange",(function(){M.util.js_pending("tool_lp/dialogue:before:visibleChange")})),parent.yuiDialogue.after("visibleChange",(function(e){e.newVal?void 0!==afterShow?Y.soon((function(){afterShow(parent),parent.yuiDialogue.centerDialogue(),M.util.js_complete("tool_lp/dialogue:before:visibleChange")})):M.util.js_complete("tool_lp/dialogue:before:visibleChange"):void 0!==afterHide?Y.soon((function(){afterHide(parent),M.util.js_complete("tool_lp/dialogue:before:visibleChange")})):M.util.js_complete("tool_lp/dialogue:before:visibleChange")})),parent.yuiDialogue.show(),M.util.js_complete("tool_lp/dialogue:dialogue")}))};return dialogue.prototype.close=function(){this.yuiDialogue.hide(),this.yuiDialogue.destroy()},dialogue.prototype.getContent=function(){return this.yuiDialogue.bodyNode.getDOMNode()},dialogue}));
/**
 * Implement an accessible aria tree widget, from a nested unordered list.
 * Based on http://oaa-accessibility.org/example/41/
 *
 * To respond to selection changed events - use tree.on("selectionchanged", handler).
 * The handler will receive an array of nodes, which are the list items that are currently
 * selected. (Or a single node if multiselect is disabled).
 *
 * @module     tool_lp/tree
 * @package    core
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/tree",["jquery","core/url","core/log"],(function($,url,log){var expandedImage=$('<img alt="" src="'+url.imageUrl("t/expanded")+'"/>'),collapsedImage=$('<img alt="" src="'+url.imageUrl("t/collapsed")+'"/>'),Tree=function(selector,multiSelect){this.treeRoot=$(selector),this.multiSelect=void 0===multiSelect||!0===multiSelect,this.items=this.treeRoot.find("li"),this.expandAll=this.items.length<20,this.parents=this.treeRoot.find("li:has(ul)"),multiSelect&&this.treeRoot.attr("aria-multiselectable","true"),this.items.attr("aria-selected","false"),this.visibleItems=null,this.activeItem=null,this.lastActiveItem=null,this.keys={tab:9,enter:13,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,eight:56,asterisk:106},this.init(),this.bindEventHandlers()};return Tree.prototype.init=function(){this.parents.attr("aria-expanded","true"),this.parents.prepend(expandedImage.clone()),this.items.attr("role","tree-item"),this.items.attr("tabindex","-1"),this.parents.attr("role","group"),this.treeRoot.attr("role","tree"),this.visibleItems=this.treeRoot.find("li");var thisObj=this;this.expandAll||(this.parents.each((function(){thisObj.collapseGroup($(this))})),this.expandGroup(this.parents.first()))},Tree.prototype.expandGroup=function(item){item.children("ul").show().attr("aria-hidden","false"),item.attr("aria-expanded","true"),item.children("img").attr("src",expandedImage.attr("src")),this.visibleItems=this.treeRoot.find("li:visible")},Tree.prototype.collapseGroup=function(item){item.children("ul").hide().attr("aria-hidden","true"),item.attr("aria-expanded","false"),item.children("img").attr("src",collapsedImage.attr("src")),this.visibleItems=this.treeRoot.find("li:visible")},Tree.prototype.toggleGroup=function(item){"true"==item.attr("aria-expanded")?this.collapseGroup(item):this.expandGroup(item)},Tree.prototype.triggerChange=function(){var allSelected=this.items.filter("[aria-selected=true]");this.multiSelect||(allSelected=allSelected.first()),this.treeRoot.trigger("selectionchanged",{selected:allSelected})},Tree.prototype.multiSelectItem=function(item){if(this.multiSelect){if(null!==this.lastActiveItem){for(var lastIndex=this.visibleItems.index(this.lastActiveItem),currentIndex=this.visibleItems.index(this.activeItem);lastIndex<currentIndex;)$(this.visibleItems.get(lastIndex)).attr("aria-selected","true"),lastIndex++;for(;lastIndex>currentIndex;)$(this.visibleItems.get(lastIndex)).attr("aria-selected","true"),lastIndex--}}else this.items.attr("aria-selected","false");item.attr("aria-selected","true"),this.triggerChange()},Tree.prototype.selectItem=function(item){for(var walk=item.parent();"tree"!=walk.attr("role");)"false"==(walk=walk.parent()).attr("aria-expanded")&&this.expandGroup(walk),walk=walk.parent();this.items.attr("aria-selected","false"),item.attr("aria-selected","true"),this.triggerChange()},Tree.prototype.toggleItem=function(item){if(this.multiSelect){var current=item.attr("aria-selected");current="true"===current?"false":"true",item.attr("aria-selected",current),this.triggerChange()}else this.selectItem(item)},Tree.prototype.updateFocus=function(item){this.lastActiveItem=this.activeItem,this.activeItem=item;for(var walk=item.parent();"tree"!=walk.attr("role");)"false"==(walk=walk.parent()).attr("aria-expanded")&&this.expandGroup(walk),walk=walk.parent();this.items.attr("tabindex","-1"),item.attr("tabindex",0)},Tree.prototype.handleKeyDown=function(item,e){var currentIndex=this.visibleItems.index(item),newItem=null,hasKeyModifier=e.shiftKey||e.ctrlKey||e.metaKey||e.altKey,thisObj=this;switch(e.keyCode){case this.keys.home:return(newItem=this.parents.first()).focus(),e.shiftKey?this.multiSelectItem(newItem):hasKeyModifier||this.selectItem(newItem),e.stopPropagation(),!1;case this.keys.end:return(newItem=this.visibleItems.last()).focus(),e.shiftKey?this.multiSelectItem(newItem):hasKeyModifier||this.selectItem(newItem),e.stopPropagation(),!1;case this.keys.enter:case this.keys.space:return e.shiftKey?this.multiSelectItem(item):e.metaKey||e.ctrlKey?this.toggleItem(item):this.selectItem(item),e.stopPropagation(),!1;case this.keys.left:if(item.has("ul")&&"true"==item.attr("aria-expanded"))this.collapseGroup(item);else{var itemParent=item.parent().parent();itemParent.is("li")&&(itemParent.focus(),e.shiftKey?this.multiSelectItem(itemParent):hasKeyModifier||this.selectItem(itemParent))}return e.stopPropagation(),!1;case this.keys.right:return item.has("ul")&&"false"==item.attr("aria-expanded")?this.expandGroup(item):(newItem=item.children("ul").children("li").first()).length>0&&(newItem.focus(),e.shiftKey?this.multiSelectItem(newItem):hasKeyModifier||this.selectItem(newItem)),e.stopPropagation(),!1;case this.keys.up:if(currentIndex>0){var prev=this.visibleItems.eq(currentIndex-1);prev.focus(),e.shiftKey?this.multiSelectItem(prev):hasKeyModifier||this.selectItem(prev)}return e.stopPropagation(),!1;case this.keys.down:if(currentIndex<this.visibleItems.length-1){var next=this.visibleItems.eq(currentIndex+1);next.focus(),e.shiftKey?this.multiSelectItem(next):hasKeyModifier||this.selectItem(next)}return e.stopPropagation(),!1;case this.keys.asterisk:return this.parents.each((function(){thisObj.expandGroup($(this))})),e.stopPropagation(),!1;case this.keys.eight:return e.shiftKey&&(this.parents.each((function(){thisObj.expandGroup($(this))})),e.stopPropagation()),!1}return!0},Tree.prototype.handleKeyPress=function(item,e){if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)return!0;switch(e.keyCode){case this.keys.tab:return!0;case this.keys.enter:case this.keys.home:case this.keys.end:case this.keys.left:case this.keys.right:case this.keys.up:case this.keys.down:return e.stopPropagation(),!1;default:var chr=String.fromCharCode(e.which),match=!1,itemIndex=this.visibleItems.index(item),itemCount=this.visibleItems.length,currentIndex=itemIndex+1;for(currentIndex==itemCount&&(currentIndex=0);currentIndex!=itemIndex;){var currentItem=this.visibleItems.eq(currentIndex),titleChr=currentItem.text().charAt(0);if(currentItem.has("ul")&&(titleChr=currentItem.find("span").text().charAt(0)),titleChr.toLowerCase()==chr){match=!0;break}(currentIndex+=1)==itemCount&&(currentIndex=0)}return!0===match&&this.updateFocus(this.visibleItems.eq(currentIndex)),e.stopPropagation(),!1}return!0},Tree.prototype.on=function(eventname,handler){"selectionchanged"!==eventname?log.warning('Invalid custom event name for tree. Only "selectionchanged" is supported.'):this.treeRoot.on(eventname,handler)},Tree.prototype.handleDblClick=function(item,e){return!!(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)||(this.updateFocus(item),this.toggleGroup(item),e.stopPropagation(),!1)},Tree.prototype.handleExpandCollapseClick=function(item,e){return this.toggleGroup(item),e.stopPropagation(),!1},Tree.prototype.handleClick=function(item,e){return e.shiftKey?this.multiSelectItem(item):e.metaKey||e.ctrlKey?this.toggleItem(item):this.selectItem(item),this.updateFocus(item),e.stopPropagation(),!1},Tree.prototype.handleBlur=function(){return!0},Tree.prototype.handleFocus=function(item){return this.updateFocus(item),!0},Tree.prototype.bindEventHandlers=function(){var thisObj=this;this.parents.dblclick((function(e){return thisObj.handleDblClick($(this),e)})),this.items.click((function(e){return thisObj.handleClick($(this),e)})),this.items.children("img").click((function(e){return thisObj.handleExpandCollapseClick($(this).parent(),e)})),this.items.keydown((function(e){return thisObj.handleKeyDown($(this),e)})),this.items.keypress((function(e){return thisObj.handleKeyPress($(this),e)})),this.items.focus((function(e){return thisObj.handleFocus($(this),e)})),this.items.blur((function(e){return thisObj.handleBlur($(this),e)}))},Tree}));
/**
 * Module to get the scale values.
 *
 * @package    tool_lp
 * @copyright  2016 Serge Gauthier
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/scalevalues",["jquery","core/ajax"],(function($,ajax){var localCache=[];return{get_values:function(scaleid){var deferred=$.Deferred();return void 0===localCache[scaleid]?ajax.call([{methodname:"core_competency_get_scale_values",args:{scaleid:scaleid},done:function(scaleinfo){localCache[scaleid]=scaleinfo,deferred.resolve(scaleinfo)},fail:deferred.reject}]):deferred.resolve(localCache[scaleid]),deferred.promise()}}}));
/**
 * Aria menubar functionality. Enhances a simple nested list structure into a full aria widget.
 * Based on the open ajax example: http://oaa-accessibility.org/example/26/
 *
 * @module     tool_lp/menubar
 * @package    tool_lp
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/menubar",["jquery"],(function($){var documentClickHandlerRegistered=!1,menuActive=!1,closeAllSubMenus=function(){$(".tool-lp-menu .tool-lp-sub-menu").attr("aria-hidden","true"),menuActive=!1},Menubar=function(menuRoot,handlers){this.menuRoot=menuRoot,this.handlers=handlers,this.rootMenus=this.menuRoot.children("li"),this.subMenus=this.rootMenus.children("ul"),this.subMenuItems=this.subMenus.children("li"),this.allItems=this.rootMenus.add(this.subMenuItems),this.activeItem=null,this.isChildOpen=!1,this.keys={tab:9,enter:13,esc:27,space:32,left:37,up:38,right:39,down:40},this.addAriaAttributes(),this.addEventListeners()};return Menubar.prototype.openSubMenu=function(menu){this.setOpenDirection(),closeAllSubMenus(),menu.attr("aria-hidden","false"),menuActive=!0},Menubar.prototype.addEventListeners=function(){var currentThis=this;!1===documentClickHandlerRegistered&&($(document).click((function(){menuActive&&closeAllSubMenus()})),documentClickHandlerRegistered=!0),this.subMenuItems.mouseenter((function(){return $(this).addClass("menu-hover"),!0})),this.subMenuItems.mouseout((function(){return $(this).removeClass("menu-hover"),!0})),this.allItems.click((function(e){return currentThis.handleClick($(this),e)})),this.allItems.keydown((function(e){return currentThis.handleKeyDown($(this),e)})),this.allItems.focus((function(){return currentThis.handleFocus($(this))})),this.allItems.blur((function(){return currentThis.handleBlur($(this))}))},Menubar.prototype.handleClick=function(item,e){if(e.stopPropagation(),item.parent().is(".tool-lp-menu"))"true"==item.children("ul").first().attr("aria-hidden")?this.openSubMenu(item.children("ul").first()):item.children("ul").first().attr("aria-hidden","true");else{this.allItems.removeClass("menu-hover menu-focus"),this.activeItem=null,this.menuRoot.find("ul").not(".root-level").attr("aria-hidden","true");var anchor=item.find("a").first(),clickEvent=new $.Event("click");clickEvent.target=anchor;var eventHandled=!1;this.handlers&&$.each(this.handlers,(function(selector,handler){if(!eventHandled&&item.find(selector).length>0){var callable=$.proxy(handler,anchor);eventHandled=!1===callable(clickEvent)||clickEvent.isDefaultPrevented()}})),eventHandled||"#"===anchor.attr("href")||(window.location.href=anchor.attr("href"))}return!1},Menubar.prototype.handleFocus=function(item){if(null===this.activeItem)this.activeItem=item;else if(item[0]!=this.activeItem[0])return!0;var parentItems=this.activeItem.parentsUntil("ul.tool-lp-menu").filter("li");(this.allItems.removeClass("menu-focus"),this.activeItem.addClass("menu-focus"),parentItems.addClass("menu-focus"),!0===this.isChildOpen)&&(item.parent().is(".tool-lp-menu")&&"true"==item.attr("aria-haspopup")&&this.openSubMenu(item.children("ul").first()));return!0},Menubar.prototype.handleBlur=function(item){return item.removeClass("menu-focus"),!0},Menubar.prototype.setOpenDirection=function(){var pos=this.menuRoot.offset(),isRTL=$(document.body).hasClass("dir-rtl"),heightmenuRoot=this.rootMenus.outerHeight(),widthmenuRoot=this.rootMenus.outerWidth(),subMenuContainer=this.rootMenus.find("ul.tool-lp-sub-menu");subMenuContainer.css("margin-right",""),subMenuContainer.css("margin-left",""),subMenuContainer.css("margin-top",""),subMenuContainer.attr("aria-hidden",!1);var menuRealWidth=subMenuContainer.outerWidth(),menuRealHeight=subMenuContainer.outerHeight(),margintop=null,marginright=null,marginleft=null;pos.top-$(window).scrollTop()+menuRealHeight>$(window).height()&&(margintop=menuRealHeight+heightmenuRoot,subMenuContainer.css("margin-top","-"+margintop+"px")),isRTL?pos.left-menuRealWidth<0&&(marginright=menuRealWidth-widthmenuRoot,subMenuContainer.css("margin-right","-"+marginright+"px")):pos.left+menuRealWidth>$(window).width()&&(marginleft=menuRealWidth-widthmenuRoot,subMenuContainer.css("margin-left","-"+marginleft+"px")),this.menuRoot.addClass("tool-lp-menu-open-left")},Menubar.prototype.handleKeyDown=function(item,e){if(e.altKey||e.ctrlKey)return!0;switch(e.keyCode){case this.keys.tab:this.menuRoot.find("ul").attr("aria-hidden","true"),this.allItems.removeClass("menu-focus"),this.activeItem=null,this.isChildOpen=!1;break;case this.keys.esc:var itemUL=item.parent();return itemUL.is(".tool-lp-menu")?item.children("ul").first().attr("aria-hidden","true"):(this.activeItem=itemUL.parent(),this.isChildOpen=!1,this.activeItem.focus(),itemUL.attr("aria-hidden","true")),e.stopPropagation(),!1;case this.keys.enter:case this.keys.space:return this.handleClick(item,e);case this.keys.left:return this.activeItem=this.moveToPrevious(item),this.activeItem.focus(),e.stopPropagation(),!1;case this.keys.right:return this.activeItem=this.moveToNext(item),this.activeItem.focus(),e.stopPropagation(),!1;case this.keys.up:return this.activeItem=this.moveUp(item),this.activeItem.focus(),e.stopPropagation(),!1;case this.keys.down:return this.activeItem=this.moveDown(item),this.activeItem.focus(),e.stopPropagation(),!1}return!0},Menubar.prototype.moveToNext=function(item){var itemUL=item.parent(),menuItems=itemUL.children("li"),menuNum=menuItems.length,menuIndex=menuItems.index(item),newItem=null,childMenu=null;if(itemUL.is(".tool-lp-menu"))newItem=menuIndex<menuNum-1?item.next():menuItems.first(),"true"==item.attr("aria-haspopup")&&"false"==(childMenu=item.children("ul").first()).attr("aria-hidden")&&(childMenu.attr("aria-hidden","true"),this.isChildOpen=!0),item.removeClass("menu-focus"),"true"===newItem.attr("aria-haspopup")&&!0===this.isChildOpen&&(childMenu=newItem.children("ul").first(),this.openSubMenu(childMenu));else if("true"==item.attr("aria-haspopup"))newItem=(childMenu=item.children("ul").first()).children("li").first(),this.openSubMenu(childMenu);else{var parentMenus=null,rootItem=null;(parentMenus=item.parentsUntil("ul.tool-lp-menu").filter("ul").not(".tool-lp-menu")).attr("aria-hidden","true"),parentMenus.find("li").removeClass("menu-focus"),parentMenus.last().parent().removeClass("menu-focus"),rootItem=parentMenus.last().parent(),(newItem=(menuIndex=this.rootMenus.index(rootItem))<this.rootMenus.length-1?rootItem.next():this.rootMenus.first()).addClass("menu-focus"),"true"==newItem.attr("aria-haspopup")&&(childMenu=newItem.children("ul").first(),newItem=childMenu.children("li").first(),this.openSubMenu(childMenu),this.isChildOpen=!0)}return newItem},Menubar.prototype.moveToPrevious=function(item){var itemUL=item.parent(),menuItems=itemUL.children("li"),menuIndex=menuItems.index(item),newItem=null,childMenu=null;if(itemUL.is(".tool-lp-menu"))newItem=menuIndex>0?item.prev():menuItems.last(),"true"==item.attr("aria-haspopup")&&"false"==(childMenu=item.children("ul").first()).attr("aria-hidden")&&(childMenu.attr("aria-hidden","true"),this.isChildOpen=!0),item.removeClass("menu-focus"),"true"===newItem.attr("aria-haspopup")&&!0===this.isChildOpen&&(childMenu=newItem.children("ul").first(),this.openSubMenu(childMenu));else{var parentLI=itemUL.parent();parentLI.parent().is(".tool-lp-menu")?(itemUL.attr("aria-hidden","true"),item.removeClass("menu-focus"),parentLI.removeClass("menu-focus"),(newItem=(menuIndex=this.rootMenus.index(parentLI))>0?parentLI.prev():this.rootMenus.last()).addClass("menu-focus"),"true"==newItem.attr("aria-haspopup")&&(childMenu=newItem.children("ul").first(),this.openSubMenu(childMenu),this.isChildOpen=!0,newItem=childMenu.children("li").first())):(newItem=itemUL.parent(),itemUL.attr("aria-hidden","true"),item.removeClass("menu-focus"))}return newItem},Menubar.prototype.moveDown=function(item,startChr){var itemUL=item.parent(),menuItems=itemUL.children("li").not(".separator"),menuNum=menuItems.length,menuIndex=menuItems.index(item),newItem=null,newItemUL=null;if(itemUL.is(".tool-lp-menu"))return"true"!=item.attr("aria-haspopup")?item:(newItem=(newItemUL=item.children("ul").first()).children("li").first(),this.openSubMenu(newItemUL),newItem);if(startChr){var match=!1,curNdx=menuIndex+1;for(curNdx==menuNum&&(curNdx=0);curNdx!=menuIndex;){if(menuItems.eq(curNdx).html().charAt(0).toLowerCase()==startChr){match=!0;break}(curNdx+=1)==menuNum&&(curNdx=0)}return!0===match?(newItem=menuItems.eq(curNdx),item.removeClass("menu-focus"),newItem):item}return newItem=menuIndex<menuNum-1?menuItems.eq(menuIndex+1):menuItems.first(),item.removeClass("menu-focus"),newItem},Menubar.prototype.moveUp=function(item){var itemUL=item.parent(),menuItems=itemUL.children("li").not(".separator"),menuIndex=menuItems.index(item),newItem=null;return itemUL.is(".tool-lp-menu")?item:(newItem=menuIndex>0?menuItems.eq(menuIndex-1):menuItems.last(),item.removeClass("menu-focus"),newItem)},Menubar.prototype.addAriaAttributes=function(){this.menuRoot.attr("role","menubar"),this.rootMenus.attr("role","menuitem"),this.rootMenus.attr("tabindex","0"),this.rootMenus.attr("aria-haspopup","true"),this.subMenus.attr("role","menu"),this.subMenus.attr("aria-hidden","true"),this.subMenuItems.attr("role","menuitem"),this.subMenuItems.attr("tabindex","-1"),this.menuRoot.addClass("tool-lp-menu"),this.allItems.addClass("tool-lp-menu-item"),this.rootMenus.addClass("tool-lp-root-menu"),this.subMenus.addClass("tool-lp-sub-menu"),this.subMenuItems.addClass("dropdown-item")},{enhance:function(selector,handler){$(selector).each((function(index,element){var menuRoot=$(element);!0!==menuRoot.data("menubarEnhanced")&&(new Menubar(menuRoot,handler),menuRoot.data("menubarEnhanced",!0))}))},closeAll:closeAllSubMenus}}));
/**
 * Handle opening a dialogue to configure scale data.
 *
 * @module     tool_lp/scaleconfig
 * @package    tool_lp
 * @copyright  2015 Adrian Greeve <adrian@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/scaleconfig",["jquery","core/notification","core/templates","core/ajax","tool_lp/dialogue","tool_lp/scalevalues"],(function($,notification,templates,ajax,Dialogue,ModScaleValues){var ScaleConfig=function(selectSelector,inputSelector,triggerSelector){this.selectSelector=selectSelector,this.inputSelector=inputSelector,this.triggerSelector=triggerSelector,this.originalscaleid=$(selectSelector).val(),$(selectSelector).on("change",this.scaleChangeHandler.bind(this)).change(),$(triggerSelector).click(this.showConfig.bind(this))};return ScaleConfig.prototype.selectSelector=null,ScaleConfig.prototype.inputSelector=null,ScaleConfig.prototype.triggerSelector=null,ScaleConfig.prototype.scalevalues=null,ScaleConfig.prototype.originalscaleid=0,ScaleConfig.prototype.scaleid=0,ScaleConfig.prototype.popup=null,ScaleConfig.prototype.showConfig=function(){var self=this;if(this.scaleid=$(this.selectSelector).val(),!(this.scaleid<=0)){var scalename=$(this.selectSelector).find("option:selected").text();this.getScaleValues(this.scaleid).done((function(){var context={scalename:scalename,scales:self.scalevalues};templates.render("tool_lp/scale_configuration_page",context).done((function(html){new Dialogue(scalename,html,self.initScaleConfig.bind(self))})).fail(notification.exception)})).fail(notification.exception)}},ScaleConfig.prototype.retrieveOriginalScaleConfig=function(){var jsonstring=$(this.inputSelector).val();if(""!==jsonstring){var scaleconfiguration=$.parseJSON(jsonstring);if(scaleconfiguration.shift().scaleid===this.originalscaleid)return scaleconfiguration}return""},ScaleConfig.prototype.initScaleConfig=function(popup){this.popup=popup;var body=$(popup.getContent());if(this.originalscaleid===this.scaleid){var currentconfig=this.retrieveOriginalScaleConfig();""!==currentconfig&&currentconfig.forEach((function(value){1===value.scaledefault&&body.find('[data-field="tool_lp_scale_default_'+value.id+'"]').attr("checked",!0),1===value.proficient&&body.find('[data-field="tool_lp_scale_proficient_'+value.id+'"]').attr("checked",!0)}))}body.on("click",'[data-action="close"]',function(){this.setScaleConfig(),popup.close()}.bind(this)),body.on("click",'[data-action="cancel"]',(function(){popup.close()}))},ScaleConfig.prototype.setScaleConfig=function(){var body=$(this.popup.getContent()),data=[{scaleid:this.scaleid}];this.scalevalues.forEach((function(value){var scaledefault=0,proficient=0;body.find('[data-field="tool_lp_scale_default_'+value.id+'"]').is(":checked")&&(scaledefault=1),body.find('[data-field="tool_lp_scale_proficient_'+value.id+'"]').is(":checked")&&(proficient=1),(scaledefault||proficient)&&data.push({id:value.id,scaledefault:scaledefault,proficient:proficient})}));var datastring=JSON.stringify(data);$(this.inputSelector).val(datastring),this.originalscaleid=this.scaleid},ScaleConfig.prototype.getScaleValues=function(scaleid){return ModScaleValues.get_values(scaleid).then(function(values){return this.scalevalues=values,values}.bind(this))},ScaleConfig.prototype.scaleChangeHandler=function(e){$(e.target).val()<=0?$(this.triggerSelector).prop("disabled",!0):$(this.triggerSelector).prop("disabled",!1)},{init:function(selectSelector,inputSelector,triggerSelector){return new ScaleConfig(selectSelector,inputSelector,triggerSelector)}}}));
/**
 * Competency rule base module.
 *
 * @package    tool_lp
 * @copyright  2015 Frdric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/competency_rule",["jquery"],(function($){var Rule=function(tree){this._eventNode=$("<div>"),this._ready=$.Deferred(),this._tree=tree};return Rule.prototype._competency=null,Rule.prototype._eventNode=null,Rule.prototype._ready=null,Rule.prototype._tree=null,Rule.prototype.canConfig=function(){return this._tree.hasChildren(this._competency.id)},Rule.prototype.getConfig=function(){return null},Rule.prototype.getType=function(){throw new Error("Not implemented")},Rule.prototype.init=function(){return this._load()},Rule.prototype.injectTemplate=function(){return $.Deferred().reject().promise()},Rule.prototype.isValid=function(){return!1},Rule.prototype._load=function(){return $.when()},Rule.prototype.on=function(type,handler){this._eventNode.on(type,handler)},Rule.prototype.setTargetCompetency=function(competency){this._competency=competency},Rule.prototype._trigger=function(type,data){this._eventNode.trigger(type,[data])},Rule.prototype._triggerChange=function(){this._trigger("change",this)},Rule}));
/**
 * Competency rule config.
 *
 * @package    tool_lp
 * @copyright  2015 Frdric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/competency_outcomes",["jquery","core/str"],(function($,Str){return{NONE:0,EVIDENCE:1,COMPLETE:2,RECOMMEND:3,getAll:function(){var self=this;return Str.get_strings([{key:"competencyoutcome_none",component:"tool_lp"},{key:"competencyoutcome_evidence",component:"tool_lp"},{key:"competencyoutcome_recommend",component:"tool_lp"},{key:"competencyoutcome_complete",component:"tool_lp"}]).then((function(strings){var outcomes={};return outcomes[self.NONE]={code:self.NONE,name:strings[0]},outcomes[self.EVIDENCE]={code:self.EVIDENCE,name:strings[1]},outcomes[self.RECOMMEND]={code:self.RECOMMEND,name:strings[2]},outcomes[self.COMPLETE]={code:self.COMPLETE,name:strings[3]},outcomes}))},getString:function(id){return this.getAll().then((function(outcomes){return void 0===outcomes[id]?$.Deferred().reject().promise():outcomes[id].name}))}}}));
/**
 * Module to enable inline editing of a comptency grade.
 *
 * @package    tool_lp
 * @copyright  2015 Damyon Wiese
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/user_competency_course_navigation",["jquery"],(function($){var UserCompetencyCourseNavigation=function(userSelector,competencySelector,baseUrl,userId,competencyId,courseId){this._baseUrl=baseUrl,this._userId=userId+"",this._competencyId=competencyId+"",this._courseId=courseId,$(userSelector).on("change",this._userChanged.bind(this)),$(competencySelector).on("change",this._competencyChanged.bind(this))};return UserCompetencyCourseNavigation.prototype._userChanged=function(e){var queryStr="?userid="+$(e.target).val()+"&courseid="+this._courseId+"&competencyid="+this._competencyId;document.location=this._baseUrl+queryStr},UserCompetencyCourseNavigation.prototype._competencyChanged=function(e){var newCompetencyId=$(e.target).val(),queryStr="?userid="+this._userId+"&courseid="+this._courseId+"&competencyid="+newCompetencyId;document.location=this._baseUrl+queryStr},UserCompetencyCourseNavigation.prototype._competencyId=null,UserCompetencyCourseNavigation.prototype._userId=null,UserCompetencyCourseNavigation.prototype._courseId=null,UserCompetencyCourseNavigation.prototype._baseUrl=null,UserCompetencyCourseNavigation.prototype._ignoreFirstCompetency=null,UserCompetencyCourseNavigation}));
/**
 * Competency picker from user plans.
 *
 * To handle 'save' events use: picker.on('save').
 *
 * This will receive a object with either a single 'competencyId', or an array in 'competencyIds'
 * depending on the value of multiSelect.
 *
 * @package    tool_lp
 * @copyright  2015 Frdric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/competencypicker_user_plans",["jquery","core/notification","core/ajax","core/templates","core/str","tool_lp/tree","tool_lp/competencypicker"],(function($,Notification,Ajax,Templates,Str,Tree,PickerBase){var Picker=function(userId,singlePlan,multiSelect){PickerBase.prototype.constructor.apply(this,[1,!1,"self",multiSelect]),this._userId=userId,this._plans=[],singlePlan&&(this._planId=singlePlan,this._singlePlan=!0)};return(Picker.prototype=Object.create(PickerBase.prototype))._plans=null,Picker.prototype._planId=null,Picker.prototype._singlePlan=!1,Picker.prototype._userId=null,Picker.prototype._afterRender=function(){var self=this;PickerBase.prototype._afterRender.apply(self,arguments),self._singlePlan||self._find('[data-action="chooseplan"]').change((function(e){self._planId=$(e.target).val(),self._loadCompetencies().then(self._refresh.bind(self)).catch(Notification.exception)}))},Picker.prototype._fetchCompetencies=function(planId,searchText){var self=this;return Ajax.call([{methodname:"core_competency_list_plan_competencies",args:{id:planId}}])[0].done((function(competencies){var i,comp,tree=[];for(i=0;i<competencies.length;i++)(comp=competencies[i].competency).shortname.toLowerCase().indexOf(searchText.toLowerCase())<0||(comp.children=[],comp.haschildren=0,tree.push(comp));self._competencies=tree})).fail(Notification.exception)},Picker.prototype._getPlan=function(id){var plan;return $.each(this._plans,(function(i,f){f.id!=id||(plan=f)})),plan},Picker.prototype._loadCompetencies=function(){return this._fetchCompetencies(this._planId,this._searchText)},Picker.prototype._loadPlans=function(){var self=this;return self._plans.length>0?$.when():(self._singlePlan?Ajax.call([{methodname:"core_competency_read_plan",args:{id:this._planId}}])[0].then((function(plan){return[plan]})):Ajax.call([{methodname:"core_competency_list_user_plans",args:{userid:self._userId}}])[0]).done((function(plans){self._plans=plans})).fail(Notification.exception)},Picker.prototype._preRender=function(){var self=this;return self._loadPlans().then((function(){return!self._planId&&self._plans.length>0&&(self._planId=self._plans[0].id),self._planId?self._loadCompetencies():(self._plans=[],$.when())}))},Picker.prototype._render=function(){var self=this;return self._preRender().then((function(){self._singlePlan||$.each(self._plans,(function(i,plan){plan.id==self._planId?plan.selected=!0:plan.selected=!1}));var context={competencies:self._competencies,plan:self._getPlan(self._planId),plans:self._plans,search:self._searchText,singlePlan:self._singlePlan};return Templates.render("tool_lp/competency_picker_user_plans",context)}))},Picker}));
/**
 * Change the course competency settings in a popup.
 *
 * @module     tool_lp/configurecoursecompetencysettings
 * @package    tool_lp
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/course_competency_settings",["jquery","core/notification","tool_lp/dialogue","core/str","core/ajax","core/templates","core/pending"],(function($,notification,Dialogue,str,ajax,templates,Pending){var settingsMod=function(selector){$(selector).on("click",this.configureSettings.bind(this))};return settingsMod.prototype._dialogue=null,settingsMod.prototype.configureSettings=function(e){var pendingPromise=new Pending,context={courseid:$(e.target).closest("a").data("courseid"),settings:{pushratingstouserplans:$(e.target).closest("a").data("pushratingstouserplans")}};e.preventDefault(),$.when(str.get_string("configurecoursecompetencysettings","tool_lp"),templates.render("tool_lp/course_competency_settings",context)).then(function(title,templateResult){return this._dialogue=new Dialogue(title,templateResult[0],this.addListeners.bind(this)),this._dialogue}.bind(this)).then(pendingPromise.resolve).catch(notification.exception)},settingsMod.prototype.addListeners=function(){this._find('[data-action="save"]').on("click",this.saveSettings.bind(this)),this._find('[data-action="cancel"]').on("click",this.cancelChanges.bind(this))},settingsMod.prototype.cancelChanges=function(e){e.preventDefault(),this._dialogue.close()},settingsMod.prototype._find=function(selector){return $('[data-region="coursecompetencysettings"]').find(selector)},settingsMod.prototype.saveSettings=function(e){var pendingPromise=new Pending;e.preventDefault();var newValue=this._find('input[name="pushratingstouserplans"]:checked').val(),courseId=this._find('input[name="courseid"]').val(),settings={pushratingstouserplans:newValue};ajax.call([{methodname:"core_competency_update_course_competency_settings",args:{courseid:courseId,settings:settings}}])[0].then(function(){return this.refreshCourseCompetenciesPage()}.bind(this)).then(pendingPromise.resolve).catch(notification.exception)},settingsMod.prototype.refreshCourseCompetenciesPage=function(){var courseId=this._find('input[name="courseid"]').val(),pendingPromise=new Pending;ajax.call([{methodname:"tool_lp_data_for_course_competencies_page",args:{courseid:courseId,moduleid:0}}])[0].then((function(context){return templates.render("tool_lp/course_competencies_page",context)})).then(function(html,js){templates.replaceNode($('[data-region="coursecompetenciespage"]'),html,js),this._dialogue.close()}.bind(this)).then(pendingPromise.resolve).catch(notification.exception)},settingsMod}));
/**
 * Cohort selector module.
 *
 * @module     tool_lp/form-cohort-selector
 * @class      form-cohort-selector
 * @package    tool_lp
 * @copyright  2015 Frdric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/form-cohort-selector",["jquery","core/ajax","core/templates"],(function($,Ajax,Templates){return{processResults:function(selector,results){var cohorts=[];return $.each(results,(function(index,cohort){cohorts.push({value:cohort.id,label:cohort._label})})),cohorts},transport:function(selector,query,success,failure){var contextid=parseInt($(selector).data("contextid"),10),includes=$(selector).data("includes");Ajax.call([{methodname:"tool_lp_search_cohorts",args:{query:query,context:{contextid:contextid},includes:includes}}])[0].then((function(results){var promises=[],i=0;return $.each(results.cohorts,(function(index,cohort){promises.push(Templates.render("tool_lp/form-cohort-selector-suggestion",cohort))})),$.when.apply($.when,promises).then((function(){var args=arguments;$.each(results.cohorts,(function(index,cohort){cohort._label=args[i],i++})),success(results.cohorts)}))})).catch(failure)}}}));
/**
 * Competency frameworks actions via ajax.
 *
 * @module     tool_lp/frameworkactions
 * @package    tool_lp
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/frameworkactions",["jquery","core/templates","core/ajax","core/notification","core/str"],(function($,templates,ajax,notification,str){var pagecontextid=0,frameworkid=0,updatePage=function(newhtml,newjs){$('[data-region="managecompetencies"]').replaceWith(newhtml),templates.runTemplateJS(newjs)},reloadList=function(context){templates.render("tool_lp/manage_competency_frameworks_page",context).done(updatePage).fail(notification.exception)},doDelete=function(){var requests=ajax.call([{methodname:"core_competency_delete_competency_framework",args:{id:frameworkid}},{methodname:"tool_lp_data_for_competency_frameworks_manage_page",args:{pagecontext:{contextid:pagecontextid}}}]);requests[0].done((function(success){!1===success&&ajax.call([{methodname:"core_competency_read_competency_framework",args:{id:frameworkid}}])[0].done((function(framework){str.get_strings([{key:"frameworkcannotbedeleted",component:"tool_lp",param:framework.shortname},{key:"cancel",component:"moodle"}]).done((function(strings){notification.alert(null,strings[0])})).fail(notification.exception)}))})).fail(notification.exception),requests[1].done(reloadList).fail(notification.exception)};return{deleteHandler:function(e){e.preventDefault();var id=$(this).attr("data-frameworkid");frameworkid=id,ajax.call([{methodname:"core_competency_read_competency_framework",args:{id:frameworkid}}])[0].done((function(framework){str.get_strings([{key:"confirm",component:"moodle"},{key:"deletecompetencyframework",component:"tool_lp",param:framework.shortname},{key:"delete",component:"moodle"},{key:"cancel",component:"moodle"}]).done((function(strings){notification.confirm(strings[0],strings[1],strings[2],strings[3],doDelete)})).fail(notification.exception)})).fail(notification.exception)},duplicateHandler:function(e){e.preventDefault(),frameworkid=$(this).attr("data-frameworkid"),ajax.call([{methodname:"core_competency_duplicate_competency_framework",args:{id:frameworkid}},{methodname:"tool_lp_data_for_competency_frameworks_manage_page",args:{pagecontext:{contextid:pagecontextid}}}])[1].done(reloadList).fail(notification.exception)},init:function(contextid){pagecontextid=contextid}}}));
/**
 * Frameworks datasource.
 *
 * This module is compatible with core/form-autocomplete.
 *
 * @package    tool_lpmigrate
 * @copyright  2016 Frdric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/frameworks_datasource",["jquery","core/ajax","core/notification"],(function($,Ajax,Notification){return{list:function(contextId,options){var args={context:{contextid:contextId}};return $.extend(args,void 0===options?{}:options),Ajax.call([{methodname:"core_competency_list_competency_frameworks",args:args}])[0]},processResults:function(selector,results){var options=[];return $.each(results,(function(index,data){options.push({value:data.id,label:data.shortname+" "+data.idnumber})})),options},transport:function(selector,query,callback){var el=$(selector),contextId=el.data("contextid"),onlyVisible=el.data("onlyvisible");if(!contextId)throw new Error("The attribute data-contextid is required on "+selector);this.list(contextId,{query:query,onlyvisible:onlyVisible}).then(callback).catch(Notification.exception)}}}));
/**
 * Module to enable inline editing of a comptency grade.
 *
 * @package    tool_lp
 * @copyright  2015 Damyon Wiese
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/grade_user_competency_inline",["jquery","core/notification","core/ajax","core/log","tool_lp/grade_dialogue","tool_lp/event_base","tool_lp/scalevalues"],(function($,notification,ajax,log,GradeDialogue,EventBase,ScaleValues){var InlineEditor=function(selector,scaleId,competencyId,userId,planId,courseId,chooseStr){EventBase.prototype.constructor.apply(this,[]);var trigger=$(selector);if(!trigger.length)throw new Error("Could not find the trigger");this._scaleId=scaleId,this._competencyId=competencyId,this._userId=userId,this._planId=planId,this._courseId=courseId,this._chooseStr=chooseStr,this._setUp(),trigger.click(function(e){e.preventDefault(),this._dialogue.display()}.bind(this)),this._planId?(this._methodName="core_competency_grade_competency_in_plan",this._args={competencyid:this._competencyId,planid:this._planId}):this._courseId?(this._methodName="core_competency_grade_competency_in_course",this._args={competencyid:this._competencyId,courseid:this._courseId,userid:this._userId}):(this._methodName="core_competency_grade_competency",this._args={userid:this._userId,competencyid:this._competencyId})};return(InlineEditor.prototype=Object.create(EventBase.prototype))._setUp=function(){var options=[],self=this;M.util.js_pending("tool_lp/grade_user_competency_inline:_setUp"),ScaleValues.get_values(self._scaleId).then((function(scalevalues){options.push({value:"",name:self._chooseStr});for(var i=0;i<scalevalues.length;i++){var optionConfig=scalevalues[i];options.push({value:optionConfig.id,name:optionConfig.name})}return options})).then((function(options){return new GradeDialogue(options)})).then((function(dialogue){return dialogue.on("rated",(function(e,data){var args=self._args;args.grade=data.rating,args.note=data.note,ajax.call([{methodname:self._methodName,args:args,done:function(evidence){self._trigger("competencyupdated",{args:args,evidence:evidence})},fail:notification.exception}])})),dialogue})).then((function(dialogue){self._dialogue=dialogue,M.util.js_complete("tool_lp/grade_user_competency_inline:_setUp")})).fail(notification.exception)},InlineEditor.prototype._scaleId=null,InlineEditor.prototype._competencyId=null,InlineEditor.prototype._userId=null,InlineEditor.prototype._planId=null,InlineEditor.prototype._courseId=null,InlineEditor.prototype._chooseStr=null,InlineEditor.prototype._dialogue=null,InlineEditor}));
/**
 * Competency rule all module.
 *
 * @package    tool_lp
 * @copyright  2015 Frdric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/competency_rule_all",["jquery","core/str","tool_lp/competency_rule"],(function($,Str,RuleBase){var Rule=function(){RuleBase.apply(this,arguments)};return(Rule.prototype=Object.create(RuleBase.prototype)).getType=function(){return"core_competency\\competency_rule_all"},Rule.prototype.isValid=function(){return!0},Rule}));
/**
 * Event base javascript module.
 *
 * @module     tool_lp/event_base
 * @package    tool_lp
 * @copyright  2015 Frdric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/event_base",["jquery"],(function($){var Base=function(){this._eventNode=$("<div></div>")};return Base.prototype._eventNode=null,Base.prototype.on=function(type,handler){this._eventNode.on(type,handler)},Base.prototype._trigger=function(type,data){this._eventNode.trigger(type,[data])},Base}));
/**
 * User competency workflow.
 *
 * @module     tool_lp/user_competency_workflow
 * @package    tool_lp
 * @copyright  2015 Frdric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/user_competency_workflow",["jquery","core/templates","core/ajax","core/notification","core/str","tool_lp/menubar","tool_lp/event_base"],(function($,Templates,Ajax,Notification,Str,Menubar,EventBase){var UserCompetencyWorkflow=function(){EventBase.prototype.constructor.apply(this,[])};return(UserCompetencyWorkflow.prototype=Object.create(EventBase.prototype))._nodeSelector='[data-node="user-competency"]',UserCompetencyWorkflow.prototype._cancelReviewRequest=function(data){var call={methodname:"core_competency_user_competency_cancel_review_request",args:{userid:data.userid,competencyid:data.competencyid}};Ajax.call([call])[0].then(function(){this._trigger("review-request-cancelled",data),this._trigger("status-changed",data)}.bind(this)).catch(function(){this._trigger("error-occured",data)}.bind(this))},UserCompetencyWorkflow.prototype.cancelReviewRequest=function(data){this._cancelReviewRequest(data)},UserCompetencyWorkflow.prototype._cancelReviewRequestHandler=function(e){e.preventDefault();var data=this._findUserCompetencyData($(e.target));this.cancelReviewRequest(data)},UserCompetencyWorkflow.prototype._requestReview=function(data){var call={methodname:"core_competency_user_competency_request_review",args:{userid:data.userid,competencyid:data.competencyid}};Ajax.call([call])[0].then(function(){this._trigger("review-requested",data),this._trigger("status-changed",data)}.bind(this)).catch(function(){this._trigger("error-occured",data)}.bind(this))},UserCompetencyWorkflow.prototype.requestReview=function(data){this._requestReview(data)},UserCompetencyWorkflow.prototype._requestReviewHandler=function(e){e.preventDefault();var data=this._findUserCompetencyData($(e.target));this.requestReview(data)},UserCompetencyWorkflow.prototype._startReview=function(data){var call={methodname:"core_competency_user_competency_start_review",args:{userid:data.userid,competencyid:data.competencyid}};Ajax.call([call])[0].then(function(){this._trigger("review-started",data),this._trigger("status-changed",data)}.bind(this)).catch(function(){this._trigger("error-occured",data)}.bind(this))},UserCompetencyWorkflow.prototype.startReview=function(data){this._startReview(data)},UserCompetencyWorkflow.prototype._startReviewHandler=function(e){e.preventDefault();var data=this._findUserCompetencyData($(e.target));this.startReview(data)},UserCompetencyWorkflow.prototype._stopReview=function(data){var call={methodname:"core_competency_user_competency_stop_review",args:{userid:data.userid,competencyid:data.competencyid}};Ajax.call([call])[0].then(function(){this._trigger("review-stopped",data),this._trigger("status-changed",data)}.bind(this)).catch(function(){this._trigger("error-occured",data)}.bind(this))},UserCompetencyWorkflow.prototype.stopReview=function(data){this._stopReview(data)},UserCompetencyWorkflow.prototype._stopReviewHandler=function(e){e.preventDefault();var data=this._findUserCompetencyData($(e.target));this.stopReview(data)},UserCompetencyWorkflow.prototype.enhanceMenubar=function(selector){Menubar.enhance(selector,{'[data-action="request-review"]':this._requestReviewHandler.bind(this),'[data-action="cancel-review-request"]':this._cancelReviewRequestHandler.bind(this)})},UserCompetencyWorkflow.prototype._findUserCompetencyData=function(node){var data,parent=node.parents(this._nodeSelector);if(1!=parent.length)throw new Error("The evidence node was not located.");if(void 0===(data=parent.data())||void 0===data.userid||void 0===data.competencyid)throw new Error("User competency data could not be found.");return data},UserCompetencyWorkflow.prototype.enhanceMenubar=function(selector){Menubar.enhance(selector,{'[data-action="request-review"]':this._requestReviewHandler.bind(this),'[data-action="cancel-review-request"]':this._cancelReviewRequestHandler.bind(this),'[data-action="start-review"]':this._startReviewHandler.bind(this),'[data-action="stop-review"]':this._stopReviewHandler.bind(this)})},UserCompetencyWorkflow.prototype.registerEvents=function(selector){var wrapper=$(selector);wrapper.find('[data-action="request-review"]').click(this._requestReviewHandler.bind(this)),wrapper.find('[data-action="cancel-review-request"]').click(this._cancelReviewRequestHandler.bind(this)),wrapper.find('[data-action="start-review"]').click(this._startReviewHandler.bind(this)),wrapper.find('[data-action="stop-review"]').click(this._stopReviewHandler.bind(this))},UserCompetencyWorkflow}));
/**
 * User selector module.
 *
 * @module     tool_lp/form-user-selector
 * @class      form-user-selector
 * @package    tool_lp
 * @copyright  2015 Frdric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/form-user-selector",["jquery","core/ajax","core/templates"],(function($,Ajax,Templates){return{processResults:function(selector,results){var users=[];return $.each(results,(function(index,user){users.push({value:user.id,label:user._label})})),users},transport:function(selector,query,success,failure){var capability=$(selector).data("capability");void 0===capability&&(capability=""),Ajax.call([{methodname:"tool_lp_search_users",args:{query:query,capability:capability}}])[0].then((function(results){var promises=[],i=0;return $.each(results.users,(function(index,user){var ctx=user,identity=[];$.each(["idnumber","email","phone1","phone2","department","institution"],(function(i,k){void 0!==user[k]&&""!==user[k]&&(ctx.hasidentity=!0,identity.push(user[k]))})),ctx.identity=identity.join(", "),promises.push(Templates.render("tool_lp/form-user-selector-suggestion",ctx))})),$.when.apply($.when,promises).then((function(){var args=arguments;$.each(results.users,(function(index,user){user._label=args[i],i++})),success(results.users)}))})).catch(failure)}}}));
/**
 * Handle add/remove competency links.
 *
 * @module     tool_lp/competencies
 * @package    tool_lp
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/competencies",["jquery","core/notification","core/ajax","core/templates","core/str","tool_lp/competencypicker","tool_lp/dragdrop-reorder","core/pending"],(function($,notification,ajax,templates,str,Picker,dragdrop,Pending){var competencies=function(itemid,itemtype,pagectxid){this.itemid=itemid,this.itemtype=itemtype,this.pageContextId=pagectxid,this.pickerInstance=null,$('[data-region="actions"] button').prop("disabled",!1),this.registerEvents(),this.registerDragDrop()};return competencies.prototype.registerDragDrop=function(){var localthis=this;str.get_string("movecompetency","tool_lp").done((function(movestring){dragdrop.dragdrop("movecompetency",movestring,{identifier:"movecompetency",component:"tool_lp"},{identifier:"movecompetencyafter",component:"tool_lp"},"drag-samenode","drag-parentnode","drag-handlecontainer",(function(drag,drop){localthis.handleDrop(drag,drop)}))})).fail(notification.exception)},competencies.prototype.handleDrop=function(drag,drop){var fromid=$(drag).data("id"),toid=$(drop).data("id"),requests=[];if("course"==this.itemtype)requests=ajax.call([{methodname:"core_competency_reorder_course_competency",args:{courseid:this.itemid,competencyidfrom:fromid,competencyidto:toid}}]);else if("template"==this.itemtype)requests=ajax.call([{methodname:"core_competency_reorder_template_competency",args:{templateid:this.itemid,competencyidfrom:fromid,competencyidto:toid}}]);else{if("plan"!=this.itemtype)return;requests=ajax.call([{methodname:"core_competency_reorder_plan_competency",args:{planid:this.itemid,competencyidfrom:fromid,competencyidto:toid}}])}requests[0].fail(notification.exception)},competencies.prototype.pickCompetency=function(){var requests,pagerender,pageregion,pageContextIncludes,self=this;return self.pickerInstance||("template"!==self.itemtype&&"course"!==self.itemtype||(pageContextIncludes="parents"),self.pickerInstance=new Picker(self.pageContextId,!1,pageContextIncludes),self.pickerInstance.on("save",(function(e,data){var compIds=data.competencyIds,pendingPromise=new Pending;"course"===self.itemtype?(requests=[],$.each(compIds,(function(index,compId){requests.push({methodname:"core_competency_add_competency_to_course",args:{courseid:self.itemid,competencyid:compId}})})),requests.push({methodname:"tool_lp_data_for_course_competencies_page",args:{courseid:self.itemid,moduleid:0}}),pagerender="tool_lp/course_competencies_page",pageregion="coursecompetenciespage"):"template"===self.itemtype?(requests=[],$.each(compIds,(function(index,compId){requests.push({methodname:"core_competency_add_competency_to_template",args:{templateid:self.itemid,competencyid:compId}})})),requests.push({methodname:"tool_lp_data_for_template_competencies_page",args:{templateid:self.itemid,pagecontext:{contextid:self.pageContextId}}}),pagerender="tool_lp/template_competencies_page",pageregion="templatecompetenciespage"):"plan"===self.itemtype&&(requests=[],$.each(compIds,(function(index,compId){requests.push({methodname:"core_competency_add_competency_to_plan",args:{planid:self.itemid,competencyid:compId}})})),requests.push({methodname:"tool_lp_data_for_plan_page",args:{planid:self.itemid}}),pagerender="tool_lp/plan_page",pageregion="plan-page"),ajax.call(requests)[requests.length-1].then((function(context){return templates.render(pagerender,context)})).then((function(html,js){templates.replaceNode($('[data-region="'+pageregion+'"]'),html,js)})).then(pendingPromise.resolve).catch(notification.exception)}))),self.pickerInstance.display()},competencies.prototype.doDelete=function(deleteid){var requests=[],pagerender="",pageregion="";"course"==this.itemtype?(requests=ajax.call([{methodname:"core_competency_remove_competency_from_course",args:{courseid:this.itemid,competencyid:deleteid}},{methodname:"tool_lp_data_for_course_competencies_page",args:{courseid:this.itemid,moduleid:0}}]),pagerender="tool_lp/course_competencies_page",pageregion="coursecompetenciespage"):"template"==this.itemtype?(requests=ajax.call([{methodname:"core_competency_remove_competency_from_template",args:{templateid:this.itemid,competencyid:deleteid}},{methodname:"tool_lp_data_for_template_competencies_page",args:{templateid:this.itemid,pagecontext:{contextid:this.pageContextId}}}]),pagerender="tool_lp/template_competencies_page",pageregion="templatecompetenciespage"):"plan"==this.itemtype&&(requests=ajax.call([{methodname:"core_competency_remove_competency_from_plan",args:{planid:this.itemid,competencyid:deleteid}},{methodname:"tool_lp_data_for_plan_page",args:{planid:this.itemid}}]),pagerender="tool_lp/plan_page",pageregion="plan-page"),requests[1].done((function(context){templates.render(pagerender,context).done((function(html,js){$('[data-region="'+pageregion+'"]').replaceWith(html),templates.runTemplateJS(js)})).fail(notification.exception)})).fail(notification.exception)},competencies.prototype.deleteHandler=function(deleteid){var message,localthis=this;if("course"==localthis.itemtype)message="unlinkcompetencycourse";else if("template"==localthis.itemtype)message="unlinkcompetencytemplate";else{if("plan"!=localthis.itemtype)return;message="unlinkcompetencyplan"}ajax.call([{methodname:"core_competency_read_competency",args:{id:deleteid}}])[0].done((function(competency){str.get_strings([{key:"confirm",component:"moodle"},{key:message,component:"tool_lp",param:competency.shortname},{key:"confirm",component:"moodle"},{key:"cancel",component:"moodle"}]).done((function(strings){notification.confirm(strings[0],strings[1],strings[2],strings[3],(function(){localthis.doDelete(deleteid)}))})).fail(notification.exception)})).fail(notification.exception)},competencies.prototype.registerEvents=function(){var localthis=this;"course"==localthis.itemtype&&$('[data-region="coursecompetenciespage"]').on("change",'select[data-field="ruleoutcome"]',(function(e){var pendingPromise=new Pending,coursecompetencyid=$(e.target).data("id"),ruleoutcome=$(e.target).val();ajax.call([{methodname:"core_competency_set_course_competency_ruleoutcome",args:{coursecompetencyid:coursecompetencyid,ruleoutcome:ruleoutcome}},{methodname:"tool_lp_data_for_course_competencies_page",args:{courseid:localthis.itemid,moduleid:0}}])[1].then((function(context){return templates.render("tool_lp/course_competencies_page",context)})).then((function(html,js){return templates.replaceNode($('[data-region="coursecompetenciespage"]'),html,js)})).then(pendingPromise.resolve).catch(notification.exception)})),$('[data-region="actions"] button').click((function(e){var pendingPromise=new Pending;e.preventDefault(),localthis.pickCompetency().then(pendingPromise.resolve).catch()})),$('[data-action="delete-competency-link"]').click((function(e){e.preventDefault();var deleteid=$(e.target).closest("[data-id]").data("id");localthis.deleteHandler(deleteid)}))},competencies}));
/**
 * User evidence actions.
 *
 * @module     tool_lp/user_evidence_actions
 * @package    tool_lp
 * @copyright  2015 Frdric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/user_evidence_actions",["jquery","core/templates","core/ajax","core/notification","core/str","tool_lp/menubar","tool_lp/competencypicker_user_plans"],(function($,templates,ajax,notification,str,Menubar,PickerUserPlans){var UserEvidenceActions=function(type){if(this._type=type,"evidence"===type)this._region='[data-region="user-evidence-page"]',this._evidenceNode='[data-region="user-evidence-page"]',this._template="tool_lp/user_evidence_page",this._contextMethod="tool_lp_data_for_user_evidence_page";else{if("list"!==type)throw new TypeError("Unexpected type.");this._region='[data-region="user-evidence-list"]',this._evidenceNode='[data-region="user-evidence-node"]',this._template="tool_lp/user_evidence_list_page",this._contextMethod="tool_lp_data_for_user_evidence_list_page"}};return UserEvidenceActions.prototype._contextMethod=null,UserEvidenceActions.prototype._evidenceNode=null,UserEvidenceActions.prototype._region=null,UserEvidenceActions.prototype._template=null,UserEvidenceActions.prototype._type=null,UserEvidenceActions.prototype._getContextArgs=function(evidenceData){var args={};return"evidence"===this._type?args={id:evidenceData.id}:"list"===this._type&&(args={userid:evidenceData.userid}),args},UserEvidenceActions.prototype._renderView=function(context){var self=this;return templates.render(self._template,context).then((function(newhtml,newjs){templates.replaceNode($(self._region),newhtml,newjs)}))},UserEvidenceActions.prototype._callAndRefresh=function(calls,evidenceData){var self=this;return calls.push({methodname:self._contextMethod,args:self._getContextArgs(evidenceData)}),$.when.apply($.when,ajax.call(calls)).then((function(){return self._renderView(arguments[arguments.length-1])})).fail(notification.exception)},UserEvidenceActions.prototype._doDelete=function(evidenceData){var calls=[{methodname:"core_competency_delete_user_evidence",args:{id:evidenceData.id}}];this._callAndRefresh(calls,evidenceData)},UserEvidenceActions.prototype.deleteEvidence=function(evidenceData){var self=this;ajax.call([{methodname:"core_competency_read_user_evidence",args:{id:evidenceData.id}}])[0].done((function(evidence){str.get_strings([{key:"confirm",component:"moodle"},{key:"deleteuserevidence",component:"tool_lp",param:evidence.name},{key:"delete",component:"moodle"},{key:"cancel",component:"moodle"}]).done((function(strings){notification.confirm(strings[0],strings[1],strings[2],strings[3],(function(){self._doDelete(evidenceData)}))})).fail(notification.exception)})).fail(notification.exception)},UserEvidenceActions.prototype._deleteEvidenceHandler=function(e){e.preventDefault();var data=this._findEvidenceData($(e.target));this.deleteEvidence(data)},UserEvidenceActions.prototype._doCreateUserEvidenceCompetency=function(evidenceData,competencyIds){var calls=[];$.each(competencyIds,(function(index,competencyId){calls.push({methodname:"core_competency_create_user_evidence_competency",args:{userevidenceid:evidenceData.id,competencyid:competencyId}})})),this._callAndRefresh(calls,evidenceData)},UserEvidenceActions.prototype.createUserEvidenceCompetency=function(evidenceData){var self=this,picker=new PickerUserPlans(evidenceData.userid);picker.on("save",(function(e,data){var competencyIds=data.competencyIds;self._doCreateUserEvidenceCompetency(evidenceData,competencyIds,data.requestReview)})),picker.display()},UserEvidenceActions.prototype._createUserEvidenceCompetencyHandler=function(e){e.preventDefault();var data=this._findEvidenceData($(e.target));this.createUserEvidenceCompetency(data)},UserEvidenceActions.prototype._doDeleteUserEvidenceCompetency=function(evidenceData,competencyId){var calls=[];calls.push({methodname:"core_competency_delete_user_evidence_competency",args:{userevidenceid:evidenceData.id,competencyid:competencyId}}),this._callAndRefresh(calls,evidenceData)},UserEvidenceActions.prototype.deleteUserEvidenceCompetency=function(evidenceData,competencyId){this._doDeleteUserEvidenceCompetency(evidenceData,competencyId)},UserEvidenceActions.prototype._deleteUserEvidenceCompetencyHandler=function(e){var data=this._findEvidenceData($(e.currentTarget)),competencyId=$(e.currentTarget).data("id");e.preventDefault(),this.deleteUserEvidenceCompetency(data,competencyId)},UserEvidenceActions.prototype._doReviewUserEvidenceCompetencies=function(evidenceData){var calls=[{methodname:"core_competency_request_review_of_user_evidence_linked_competencies",args:{id:evidenceData.id}}];this._callAndRefresh(calls,evidenceData)},UserEvidenceActions.prototype.reviewUserEvidenceCompetencies=function(evidenceData){var self=this;ajax.call([{methodname:"core_competency_read_user_evidence",args:{id:evidenceData.id}}])[0].done((function(evidence){str.get_strings([{key:"confirm",component:"moodle"},{key:"sendallcompetenciestoreview",component:"tool_lp",param:evidence.name},{key:"confirm",component:"moodle"},{key:"cancel",component:"moodle"}]).done((function(strings){notification.confirm(strings[0],strings[1],strings[2],strings[3],(function(){self._doReviewUserEvidenceCompetencies(evidenceData)}))})).fail(notification.exception)})).fail(notification.exception)},UserEvidenceActions.prototype._reviewUserEvidenceCompetenciesHandler=function(e){e.preventDefault();var data=this._findEvidenceData($(e.target));this.reviewUserEvidenceCompetencies(data)},UserEvidenceActions.prototype._findEvidenceData=function(node){var data,parent=node.parentsUntil($(this._region).parent(),this._evidenceNode);if(1!=parent.length)throw new Error("The evidence node was not located.");if(void 0===(data=parent.data())||void 0===data.id)throw new Error("Evidence data could not be found.");return data},UserEvidenceActions.prototype.enhanceMenubar=function(selector){Menubar.enhance(selector,{'[data-action="user-evidence-delete"]':this._deleteEvidenceHandler.bind(this),'[data-action="link-competency"]':this._createUserEvidenceCompetencyHandler.bind(this),'[data-action="send-competencies-review"]':this._reviewUserEvidenceCompetenciesHandler.bind(this)})},UserEvidenceActions.prototype.registerEvents=function(){var wrapper=$(this._region);wrapper.find('[data-action="user-evidence-delete"]').click(this._deleteEvidenceHandler.bind(this)),wrapper.find('[data-action="link-competency"]').click(this._createUserEvidenceCompetencyHandler.bind(this)),wrapper.find('[data-action="delete-competency-link"]').click(this._deleteUserEvidenceCompetencyHandler.bind(this)),wrapper.find('[data-action="send-competencies-review"]').click(this._reviewUserEvidenceCompetenciesHandler.bind(this))},UserEvidenceActions}));
/**
 * Handle selection changes and actions on the competency tree.
 *
 * @module     tool_lp/competencyactions
 * @package    tool_lp
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/competencyactions",["jquery","core/url","core/templates","core/notification","core/str","core/ajax","tool_lp/dragdrop-reorder","tool_lp/tree","tool_lp/dialogue","tool_lp/menubar","tool_lp/competencypicker","tool_lp/competency_outcomes","tool_lp/competencyruleconfig","core/pending"],(function($,url,templates,notification,str,ajax,dragdrop,Ariatree,Dialogue,menubar,Picker,Outcomes,RuleConfig,Pending){var pageContextId,pickerInstance,ruleConfigInstance,relatedTarget,taxonomiesConstants,rulesModules,treeModel=null,moveSource=null,moveTarget=null,selectedCompetencyId=null,addHandler=function(){var parent=$('[data-region="competencyactions"]').data("competency"),params={competencyframeworkid:treeModel.getCompetencyFrameworkId(),pagecontextid:pageContextId};null!==parent&&(params.parentid=parent.id);var relocate=function(){var queryparams=$.param(params);window.location=url.relativeUrl("/admin/tool/lp/editcompetency.php?"+queryparams)};null!==parent&&treeModel.hasRule(parent.id)?str.get_strings([{key:"confirm",component:"moodle"},{key:"addingcompetencywillresetparentrule",component:"tool_lp",param:parent.shortname},{key:"yes",component:"core"},{key:"no",component:"core"}]).done((function(strings){notification.confirm(strings[0],strings[1],strings[2],strings[3],relocate)})).fail(notification.exception):relocate()},doMove=function(){var frameworkid=$('[data-region="filtercompetencies"]').data("frameworkid");ajax.call([{methodname:"core_competency_set_parent_competency",args:{competencyid:moveSource,parentid:moveTarget}},{methodname:"tool_lp_data_for_competencies_manage_page",args:{competencyframeworkid:frameworkid,search:$('[data-region="filtercompetencies"] input').val()}}])[1].done(reloadPage).fail(notification.exception)},confirmMove=function(){if((moveTarget=void 0===moveTarget?0:moveTarget)!=moveSource){var targetComp=treeModel.getCompetency(moveTarget)||{},sourceComp=treeModel.getCompetency(moveSource)||{},confirmMessage="movecompetencywillresetrules",showConfirm=!1;sourceComp.parentid!=moveTarget&&(targetComp.path&&targetComp.path.indexOf("/"+sourceComp.id+"/")>=0&&(confirmMessage="movecompetencytochildofselfwillresetrules",showConfirm=showConfirm||treeModel.hasRule(sourceComp.id)),(showConfirm=showConfirm||treeModel.hasRule(targetComp.id)||treeModel.hasRule(sourceComp.parentid))?str.get_strings([{key:"confirm",component:"moodle"},{key:confirmMessage,component:"tool_lp"},{key:"yes",component:"moodle"},{key:"no",component:"moodle"}]).done((function(strings){notification.confirm(strings[0],strings[1],strings[2],strings[3],doMove)})).fail(notification.exception):doMove())}},initMovePopup=function(popup){var body=$(popup.getContent()),treeRoot=body.find("[data-enhance=movetree]");new Ariatree(treeRoot,!1).on("selectionchanged",(function(evt,params){var target=params.selected;moveTarget=$(target).data("id")})),treeRoot.show(),body.on("click",'[data-action="move"]',(function(){popup.close(),confirmMove()})),body.on("click",'[data-action="cancel"]',(function(){popup.close()}))},addCompetencyChildren=function addCompetencyChildren(parent,competencies){var i;for(i=0;i<competencies.length;i++)competencies[i].parentid==parent.id&&(parent.haschildren=!0,competencies[i].children=[],competencies[i].haschildren=!1,parent.children[parent.children.length]=competencies[i],addCompetencyChildren(competencies[i],competencies))},moveHandler=function(e){e.preventDefault();var competency=$('[data-region="competencyactions"]').data("competency");moveSource=competency.id;var requests=ajax.call([{methodname:"core_competency_search_competencies",args:{competencyframeworkid:competency.competencyframeworkid,searchtext:""}},{methodname:"core_competency_read_competency_framework",args:{id:competency.competencyframeworkid}}]);$.when.apply(null,requests).done((function(competencies,framework){var i,competenciestree=[];for(i=0;i<competencies.length;i++){var onecompetency=competencies[i];"0"==onecompetency.parentid&&(onecompetency.children=[],onecompetency.haschildren=0,competenciestree[competenciestree.length]=onecompetency,addCompetencyChildren(onecompetency,competencies))}str.get_strings([{key:"movecompetency",component:"tool_lp",param:competency.shortname},{key:"move",component:"tool_lp"},{key:"cancel",component:"moodle"}]).done((function(strings){var context={framework:framework,competencies:competenciestree};templates.render("tool_lp/competencies_move_tree",context).done((function(tree){new Dialogue(strings[0],tree,initMovePopup)})).fail(notification.exception)})).fail(notification.exception)})).fail(notification.exception)},editHandler=function(){var competency=$('[data-region="competencyactions"]').data("competency"),params={competencyframeworkid:treeModel.getCompetencyFrameworkId(),id:competency.id,parentid:competency.parentid,pagecontextid:pageContextId},queryparams=$.param(params);window.location=url.relativeUrl("/admin/tool/lp/editcompetency.php?"+queryparams)},reloadPage=function(context){templates.render("tool_lp/manage_competencies_page",context).done((function(newhtml,newjs){$('[data-region="managecompetencies"]').replaceWith(newhtml),templates.runTemplateJS(newjs)})).fail(notification.exception)},updateSearchHandler=function(e){e.preventDefault();var frameworkid=$('[data-region="filtercompetencies"]').data("frameworkid");ajax.call([{methodname:"tool_lp_data_for_competencies_manage_page",args:{competencyframeworkid:frameworkid,search:$('[data-region="filtercompetencies"] input').val()}}])[0].done(reloadPage).fail(notification.exception)},moveUpHandler=function(){var competency=$('[data-region="competencyactions"]').data("competency");ajax.call([{methodname:"core_competency_move_up_competency",args:{id:competency.id}},{methodname:"tool_lp_data_for_competencies_manage_page",args:{competencyframeworkid:competency.competencyframeworkid,search:$('[data-region="filtercompetencies"] input').val()}}])[1].done(reloadPage).fail(notification.exception)},moveDownHandler=function(){var competency=$('[data-region="competencyactions"]').data("competency");ajax.call([{methodname:"core_competency_move_down_competency",args:{id:competency.id}},{methodname:"tool_lp_data_for_competencies_manage_page",args:{competencyframeworkid:competency.competencyframeworkid,search:$('[data-region="filtercompetencies"] input').val()}}])[1].done(reloadPage).fail(notification.exception)},seeCoursesHandler=function(){var competency=$('[data-region="competencyactions"]').data("competency");ajax.call([{methodname:"tool_lp_list_courses_using_competency",args:{id:competency.id}}])[0].done((function(courses){var context={courses:courses};templates.render("tool_lp/linked_courses_summary",context).done((function(html){str.get_string("linkedcourses","tool_lp").done((function(linkedcourses){new Dialogue(linkedcourses,html,initMovePopup)})).fail(notification.exception)})).fail(notification.exception)})).fail(notification.exception)},relateCompetenciesHandler=function(){relatedTarget=$('[data-region="competencyactions"]').data("competency"),pickerInstance||(pickerInstance=new Picker(pageContextId,relatedTarget.competencyframeworkid)).on("save",(function(e,data){var pendingPromise=new Pending,compIds=data.competencyIds,calls=[];$.each(compIds,(function(index,value){calls.push({methodname:"core_competency_add_related_competency",args:{competencyid:value,relatedcompetencyid:relatedTarget.id}})})),calls.push({methodname:"tool_lp_data_for_related_competencies_section",args:{competencyid:relatedTarget.id}}),ajax.call(calls)[calls.length-1].then((function(context){return templates.render("tool_lp/related_competencies",context)})).then((function(html,js){$('[data-region="relatedcompetencies"]').replaceWith(html),templates.runTemplateJS(js),updatedRelatedCompetencies()})).then(pendingPromise.resolve).catch(notification.exception)})),pickerInstance.setDisallowedCompetencyIDs([relatedTarget.id]),pickerInstance.display()},ruleConfigHandler=function(e){e.preventDefault(),relatedTarget=$('[data-region="competencyactions"]').data("competency"),ruleConfigInstance.setTargetCompetencyId(relatedTarget.id),ruleConfigInstance.display()},ruleConfigSaveHandler=function(e,config){var update={id:relatedTarget.id,shortname:relatedTarget.shortname,idnumber:relatedTarget.idnumber,description:relatedTarget.description,descriptionformat:relatedTarget.descriptionformat,ruletype:config.ruletype,ruleoutcome:config.ruleoutcome,ruleconfig:config.ruleconfig};ajax.call([{methodname:"core_competency_update_competency",args:{competency:update}}])[0].then((function(result){result&&(relatedTarget.ruletype=config.ruletype,relatedTarget.ruleoutcome=config.ruleoutcome,relatedTarget.ruleconfig=config.ruleconfig,renderCompetencySummary(relatedTarget))})).catch(notification.exception)},doDelete=function(){var competency=$('[data-region="competencyactions"]').data("competency"),requests=ajax.call([{methodname:"core_competency_delete_competency",args:{id:competency.id}},{methodname:"tool_lp_data_for_competencies_manage_page",args:{competencyframeworkid:competency.competencyframeworkid,search:$('[data-region="filtercompetencies"] input').val()}}]);requests[0].done((function(success){!1===success&&str.get_strings([{key:"competencycannotbedeleted",component:"tool_lp",param:competency.shortname},{key:"cancel",component:"moodle"}]).done((function(strings){notification.alert(null,strings[0])})).fail(notification.exception)})).fail(notification.exception),requests[1].done(reloadPage).fail(notification.exception)},deleteCompetencyHandler=function(){var competency=$('[data-region="competencyactions"]').data("competency"),confirmMessage="deletecompetency";treeModel.hasRule(competency.parentid)&&(confirmMessage="deletecompetencyparenthasrule"),str.get_strings([{key:"confirm",component:"moodle"},{key:confirmMessage,component:"tool_lp",param:competency.shortname},{key:"delete",component:"moodle"},{key:"cancel",component:"moodle"}]).done((function(strings){notification.confirm(strings[0],strings[1],strings[2],strings[3],doDelete)})).fail(notification.exception)},dragStart=function(e){e.originalEvent.dataTransfer.setData("text",$(e.target).parent().data("id"))},allowDrop=function(e){e.originalEvent.dataTransfer.dropEffect="move",e.preventDefault()},dragEnter=function(e){e.preventDefault(),$(this).addClass("currentdragtarget")},dragLeave=function(e){e.preventDefault(),$(this).removeClass("currentdragtarget")},dropOver=function(e){e.preventDefault(),moveSource=e.originalEvent.dataTransfer.getData("text"),moveTarget=$(e.target).parent().data("id"),$(this).removeClass("currentdragtarget"),confirmMove()},deleteRelatedHandler=function(e){e.preventDefault();var relatedid=this.id.substr(11),competency=$('[data-region="competencyactions"]').data("competency");ajax.call([{methodname:"core_competency_remove_related_competency",args:{relatedcompetencyid:relatedid,competencyid:competency.id}},{methodname:"tool_lp_data_for_related_competencies_section",args:{competencyid:competency.id}}])[1].done((function(context){templates.render("tool_lp/related_competencies",context).done((function(html){$('[data-region="relatedcompetencies"]').replaceWith(html),updatedRelatedCompetencies()})).fail(notification.exception)})).fail(notification.exception)},updatedRelatedCompetencies=function(){$('[data-action="deleterelation"]').on("click",deleteRelatedHandler)},getTaxonomyAtLevel=function(level){var constant=taxonomiesConstants[level];return constant||(constant="competency"),constant},renderCompetencySummary=function(competency){var promise=$.Deferred().resolve().promise(),context={};context.competency=competency,context.showdeleterelatedaction=!0,context.showrelatedcompetencies=!0,context.showrule=!1,context.pluginbaseurl=url.relativeUrl("/admin/tool/lp"),competency.ruleoutcome!=Outcomes.NONE&&(promise=Outcomes.getString(competency.ruleoutcome).then((function(str){var name;return $.each(rulesModules,(function(index,modInfo){modInfo.type==competency.ruletype&&(name=modInfo.name)})),[str,name]}))),promise.then((function(strs){return void 0!==strs&&(context.showrule=!0,context.rule={outcome:strs[0],type:strs[1]}),context})).then((function(context){return templates.render("tool_lp/competency_summary",context)})).then((function(html){return $('[data-region="competencyinfo"]').html(html),$('[data-action="deleterelation"]').on("click",deleteRelatedHandler),templates.render("tool_lp/loading",{})})).then((function(html,js){return templates.replaceNodeContents('[data-region="relatedcompetencies"]',html,js),ajax.call([{methodname:"tool_lp_data_for_related_competencies_section",args:{competencyid:competency.id}}])[0]})).then((function(context){return templates.render("tool_lp/related_competencies",context)})).then((function(html,js){$('[data-region="relatedcompetencies"]').replaceWith(html),templates.runTemplateJS(js),updatedRelatedCompetencies()})).catch(notification.exception)},selectionChanged=function(evt,params){var node=params.selected,id=$(node).data("id"),btn=$('[data-region="competencyactions"] [data-action="add"]'),actionMenu=$('[data-region="competencyactionsmenu"]'),selectedTitle=$('[data-region="selected-competency"]'),level=0,sublevel=1;if(menubar.closeAll(),void 0===id)$('[data-region="competencyinfo"]').html(node.clone().children().remove().end().text()),$('[data-region="competencyactions"]').data("competency",null),actionMenu.hide();else{var competency=treeModel.getCompetency(id);sublevel=(level=treeModel.getCompetencyLevel(id))+1,actionMenu.show(),$('[data-region="competencyactions"]').data("competency",competency),renderCompetencySummary(competency),function(competency){competency.id!==selectedCompetencyId&&(selectedCompetencyId=competency.id,ajax.call([{methodname:"core_competency_competency_viewed",args:{id:competency.id}}]))}(competency)}return function(level){return str.get_string("taxonomy_selected_"+getTaxonomyAtLevel(level),"tool_lp")}(level).then((function(str){selectedTitle.text(str)})).catch(notification.exception),function(level){return str.get_string("taxonomy_add_"+getTaxonomyAtLevel(level),"tool_lp")}(sublevel).then((function(str){btn.show().find('[data-region="term"]').text(str)})).catch(notification.exception),evt.preventDefault(),!1};return{init:function(model,pagectxid,taxonomies,rulesMods){var all;treeModel=model,pageContextId=pagectxid,(all=taxonomies.split(",")).unshift(""),delete all[0],taxonomiesConstants=all,rulesModules=rulesMods,$('[data-region="competencyactions"] [data-action="add"]').on("click",addHandler),menubar.enhance(".competencyactionsmenu",{'[data-action="edit"]':editHandler,'[data-action="delete"]':deleteCompetencyHandler,'[data-action="move"]':moveHandler,'[data-action="moveup"]':moveUpHandler,'[data-action="movedown"]':moveDownHandler,'[data-action="linkedcourses"]':seeCoursesHandler,'[data-action="relatedcompetencies"]':relateCompetenciesHandler.bind(this),'[data-action="competencyrules"]':ruleConfigHandler.bind(this)}),$('[data-region="competencyactionsmenu"]').hide(),$('[data-region="competencyactions"] [data-action="add"]').hide(),$('[data-region="filtercompetencies"]').on("submit",updateSearchHandler),$('[data-region="managecompetencies"] [data-enhance="tree"]').on("dragstart","li>span",dragStart).on("dragover","li>span",allowDrop).on("dragenter","li>span",dragEnter).on("dragleave","li>span",dragLeave).on("drop","li>span",dropOver),model.on("selectionchanged",selectionChanged),(ruleConfigInstance=new RuleConfig(treeModel,rulesModules)).on("save",ruleConfigSaveHandler.bind(this))}}}));
/**
 * Action selector.
 *
 * To handle 'save' events use: actionselector.on('save')
 * This will receive the information to display in popup.
 * The actions have the format [{'text': sometext, 'value' : somevalue}].
 *
 * @package    tool_lp
 * @copyright  2016 Serge Gauthier - <serge.gauthier.2@umontreal.ca>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/actionselector",["jquery","core/notification","core/ajax","core/templates","tool_lp/dialogue","tool_lp/event_base"],(function($,Notification,Ajax,Templates,Dialogue,EventBase){var ActionSelector=function(title,message,actions,confirm,cancel){EventBase.prototype.constructor.apply(this,[]),this._title=title,this._message=message,this._actions=actions,this._confirm=confirm,this._cancel=cancel,this._selectedValue=null,this._reset()};return(ActionSelector.prototype=Object.create(EventBase.prototype))._selectedValue=null,ActionSelector.prototype._popup=null,ActionSelector.prototype._title=null,ActionSelector.prototype._message=null,ActionSelector.prototype._actions=null,ActionSelector.prototype._confirm=null,ActionSelector.prototype._cancel=null,ActionSelector.prototype._afterRender=function(){var self=this;self._find('[data-action="action-selector-confirm"]').attr("disabled","disabled"),self._find('[data-region="action-selector-radio-buttons"]').change((function(){self._selectedValue=$("input[type='radio']:checked").val(),self._find('[data-action="action-selector-confirm"]').removeAttr("disabled"),self._refresh.bind(self)})),self._find('[data-action="action-selector-cancel"]').click((function(e){e.preventDefault(),self.close()})),self._find('[data-action="action-selector-confirm"]').click((function(e){e.preventDefault(),self._selectedValue.length&&(self._trigger("save",{action:self._selectedValue}),self.close())}))},ActionSelector.prototype.close=function(){this._popup.close(),this._reset()},ActionSelector.prototype.display=function(){var self=this;return self._render().then((function(html){self._popup=new Dialogue(self._title,html,self._afterRender.bind(self))})).fail(Notification.exception)},ActionSelector.prototype._find=function(selector){return $(this._popup.getContent()).find(selector)},ActionSelector.prototype._refresh=function(){var self=this;return self._render().then((function(html){self._find('[data-region="action-selector"]').replaceWith(html),self._afterRender()}))},ActionSelector.prototype._render=function(){var choices=[];for(var i in this._actions)choices.push(this._actions[i]);var content={message:this._message,choices:choices,confirm:this._confirm,cancel:this._cancel};return Templates.render("tool_lp/action_selector",content)},ActionSelector.prototype._reset=function(){this._popup=null,this._selectedValue=""},ActionSelector}));
/**
 * Handle actions on learning plan templates via ajax.
 *
 * @module     tool_lp/templateactions
 * @package    tool_lp
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/templateactions",["jquery","core/templates","core/ajax","core/notification","core/str","tool_lp/actionselector"],(function($,templates,ajax,notification,str,Actionselector){var pagecontextid=0,templateid=0,deleteplans=!0,updatePage=function(newhtml,newjs){$('[data-region="managetemplates"]').replaceWith(newhtml),templates.runTemplateJS(newjs)},reloadList=function(context){templates.render("tool_lp/manage_templates_page",context).done(updatePage).fail(notification.exception)},doDelete=function(){ajax.call([{methodname:"core_competency_delete_template",args:{id:templateid,deleteplans:deleteplans}},{methodname:"tool_lp_data_for_templates_manage_page",args:{pagecontext:{contextid:pagecontextid}}}])[1].done(reloadList).fail(notification.exception)};return{deleteHandler:function(e){e.preventDefault();var id=$(this).attr("data-templateid");templateid=id,deleteplans=!0;var requests=ajax.call([{methodname:"core_competency_read_template",args:{id:templateid}},{methodname:"core_competency_template_has_related_data",args:{id:templateid}}]);requests[0].done((function(template){requests[1].done((function(templatehasrelateddata){templatehasrelateddata?str.get_strings([{key:"deletetemplate",component:"tool_lp",param:template.shortname},{key:"deletetemplatewithplans",component:"tool_lp"},{key:"deleteplans",component:"tool_lp"},{key:"unlinkplanstemplate",component:"tool_lp"},{key:"confirm",component:"moodle"},{key:"cancel",component:"moodle"}]).done((function(strings){var actions=[{text:strings[2],value:"delete"},{text:strings[3],value:"unlink"}],actionselector=new Actionselector(strings[0],strings[1],actions,strings[4],strings[5]);actionselector.display(),actionselector.on("save",(function(e,data){"delete"!=data.action&&(deleteplans=!1),doDelete()}))})).fail(notification.exception):str.get_strings([{key:"confirm",component:"moodle"},{key:"deletetemplate",component:"tool_lp",param:template.shortname},{key:"delete",component:"moodle"},{key:"cancel",component:"moodle"}]).done((function(strings){notification.confirm(strings[0],strings[1],strings[2],strings[3],doDelete)})).fail(notification.exception)})).fail(notification.exception)})).fail(notification.exception)},duplicateHandler:function(e){e.preventDefault(),templateid=$(this).attr("data-templateid"),ajax.call([{methodname:"core_competency_duplicate_template",args:{id:templateid}},{methodname:"tool_lp_data_for_templates_manage_page",args:{pagecontext:{contextid:pagecontextid}}}])[1].done(reloadList).fail(notification.exception)},init:function(contextid){pagecontextid=contextid}}}));
/**
 * Module to open user competency plan in popup
 *
 * @package    report_competency
 * @copyright  2016 Issam Taboubi <issam.taboubi@umontreal.ca>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/user_competency_plan_popup",["jquery","core/notification","core/str","core/ajax","core/templates","tool_lp/dialogue"],(function($,notification,str,ajax,templates,Dialogue){var UserCompetencyPopup=function(regionSelector,userCompetencySelector,planId){this._regionSelector=regionSelector,this._userCompetencySelector=userCompetencySelector,this._planId=planId,$(this._regionSelector).on("click",this._userCompetencySelector,this._handleClick.bind(this))};return UserCompetencyPopup.prototype._handleClick=function(e){e.preventDefault();var tr=$(e.target).closest("tr"),competencyId=$(tr).data("competencyid"),userId=$(tr).data("userid"),planId=this._planId;ajax.call([{methodname:"tool_lp_data_for_user_competency_summary_in_plan",args:{competencyid:competencyId,planid:planId},done:this._contextLoaded.bind(this),fail:notification.exception}])[0].then((function(result){var eventMethodName="core_competency_user_competency_viewed_in_plan";return result.plan.iscompleted&&(eventMethodName="core_competency_user_competency_plan_viewed"),ajax.call([{methodname:eventMethodName,args:{competencyid:competencyId,userid:userId,planid:planId}}])[0]})).catch(notification.exception)},UserCompetencyPopup.prototype._contextLoaded=function(context){var self=this;templates.render("tool_lp/user_competency_summary_in_plan",context).done((function(html,js){str.get_string("usercompetencysummary","report_competency").done((function(title){new Dialogue(title,html,templates.runTemplateJS.bind(templates,js),self._refresh.bind(self),!0)})).fail(notification.exception)})).fail(notification.exception)},UserCompetencyPopup.prototype._refresh=function(){var planId=this._planId;ajax.call([{methodname:"tool_lp_data_for_plan_page",args:{planid:planId},done:this._pageContextLoaded.bind(this),fail:notification.exception}])},UserCompetencyPopup.prototype._pageContextLoaded=function(context){var self=this;templates.render("tool_lp/plan_page",context).done((function(html,js){templates.replaceNode(self._regionSelector,html,js)})).fail(notification.exception)},UserCompetencyPopup.prototype._regionSelector=null,UserCompetencyPopup.prototype._userCompetencySelector=null,UserCompetencyPopup.prototype._planId=null,UserCompetencyPopup}));
/**
 * Evidence delete.
 *
 * @package    tool_lp
 * @copyright  2016 Frdric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/evidence_delete",["jquery","core/notification","core/ajax","core/str","core/log"],(function($,Notification,Ajax,Str,Log){var selectors={};return{register:function(triggerSelector,containerSelector){void 0===selectors[triggerSelector]&&(selectors[triggerSelector]=$("body").delegate(triggerSelector,"click",(function(e){var parent=$(e.currentTarget).parents(containerSelector);if(!parent.length||parent.length>1)Log.error("None or too many evidence container were found.");else{var evidenceId=parent.data("id");evidenceId?(e.preventDefault(),e.stopPropagation(),Str.get_strings([{key:"confirm",component:"moodle"},{key:"areyousure",component:"moodle"},{key:"delete",component:"moodle"},{key:"cancel",component:"moodle"}]).done((function(strings){Notification.confirm(strings[0],strings[1],strings[2],strings[3],(function(){Ajax.call([{methodname:"core_competency_delete_evidence",args:{id:evidenceId}}])[0].then((function(){parent.remove()})).fail(Notification.exception)}))})).fail(Notification.exception)):Log.error("Evidence ID was not found.")}})))}}}));
/**
 * Grade dialogue.
 *
 * @package    tool_lp
 * @copyright  2016 Frdric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/grade_dialogue",["jquery","core/notification","core/templates","tool_lp/dialogue","tool_lp/event_base","core/str"],(function($,Notification,Templates,Dialogue,EventBase,Str){var Grade=function(ratingOptions){EventBase.prototype.constructor.apply(this,[]),this._ratingOptions=ratingOptions};return(Grade.prototype=Object.create(EventBase.prototype))._popup=null,Grade.prototype._ratingOptions=null,Grade.prototype._afterRender=function(){var btnRate=this._find('[data-action="rate"]'),lstRating=this._find('[name="rating"]'),txtComment=this._find('[name="comment"]');this._find('[data-action="cancel"]').click(function(e){e.preventDefault(),this._trigger("cancelled"),this.close()}.bind(this)),lstRating.change((function(){$(this).val()?btnRate.prop("disabled",!1):btnRate.prop("disabled",!0)})).change(),btnRate.click(function(e){e.preventDefault();var val=lstRating.val();val&&(this._trigger("rated",{rating:val,note:txtComment.val()}),this.close())}.bind(this))},Grade.prototype.close=function(){this._popup.close(),this._popup=null},Grade.prototype.display=function(){return M.util.js_pending("tool_lp/grade_dialogue:display"),$.when(Str.get_string("rate","tool_lp"),this._render()).then(function(title,templateResult){return this._popup=new Dialogue(title,templateResult[0],function(){this._afterRender(),M.util.js_complete("tool_lp/grade_dialogue:display")}.bind(this)),this._popup}.bind(this)).catch(Notification.exception)},Grade.prototype._find=function(selector){return $(this._popup.getContent()).find(selector)},Grade.prototype._render=function(){var context={cangrade:this._canGrade,ratings:this._ratingOptions};return Templates.render("tool_lp/competency_grader",context)},Grade}));
/**
 * Plan actions via ajax.
 *
 * @module     tool_lp/planactions
 * @package    tool_lp
 * @copyright  2015 David Monllao
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_lp/planactions",["jquery","core/templates","core/ajax","core/notification","core/str","tool_lp/menubar","tool_lp/dialogue"],(function($,templates,ajax,notification,str,Menubar,Dialogue){var PlanActions=function(type){if(this._type=type,"plan"===type)this._region='[data-region="plan-page"]',this._planNode='[data-region="plan-page"]',this._template="tool_lp/plan_page",this._contextMethod="tool_lp_data_for_plan_page";else{if("plans"!==type)throw new TypeError("Unexpected type.");this._region='[data-region="plans"]',this._planNode='[data-region="plan-node"]',this._template="tool_lp/plans_page",this._contextMethod="tool_lp_data_for_plans_page"}};return PlanActions.prototype._contextMethod=null,PlanActions.prototype._planNode=null,PlanActions.prototype._region=null,PlanActions.prototype._template=null,PlanActions.prototype._type=null,PlanActions.prototype._getContextArgs=function(planData){var args={};return"plan"===this._type?args={planid:planData.id}:"plans"===this._type&&(args={userid:planData.userid}),args},PlanActions.prototype.refresh=function(selector){var planData=this._findPlanData($(selector));this._callAndRefresh([],planData)},PlanActions.prototype._renderView=function(context){var self=this;return templates.render(self._template,context).then((function(newhtml,newjs){$(self._region).replaceWith(newhtml),templates.runTemplateJS(newjs)}))},PlanActions.prototype._callAndRefresh=function(calls,planData){var callKey="tool_lp/planactions:_callAndRefresh-"+Math.floor(Math.random()*Math.floor(1e3));M.util.js_pending(callKey);var self=this;return calls.push({methodname:self._contextMethod,args:self._getContextArgs(planData)}),$.when.apply($,ajax.call(calls)).then((function(){return self._renderView(arguments[arguments.length-1])})).fail(notification.exception).always((function(){return M.util.js_complete(callKey)}))},PlanActions.prototype._doDelete=function(planData){var calls=[{methodname:"core_competency_delete_plan",args:{id:planData.id}}];this._callAndRefresh(calls,planData)},PlanActions.prototype.deletePlan=function(planData){var self=this;ajax.call([{methodname:"core_competency_read_plan",args:{id:planData.id}}])[0].done((function(plan){str.get_strings([{key:"confirm",component:"moodle"},{key:"deleteplan",component:"tool_lp",param:plan.name},{key:"delete",component:"moodle"},{key:"cancel",component:"moodle"}]).done((function(strings){notification.confirm(strings[0],strings[1],strings[2],strings[3],(function(){self._doDelete(planData)}))})).fail(notification.exception)})).fail(notification.exception)},PlanActions.prototype._doReopenPlan=function(planData){var calls=[{methodname:"core_competency_reopen_plan",args:{planid:planData.id}}];this._callAndRefresh(calls,planData)},PlanActions.prototype.reopenPlan=function(planData){var self=this;ajax.call([{methodname:"core_competency_read_plan",args:{id:planData.id}}])[0].done((function(plan){str.get_strings([{key:"confirm",component:"moodle"},{key:"reopenplanconfirm",component:"tool_lp",param:plan.name},{key:"reopenplan",component:"tool_lp"},{key:"cancel",component:"moodle"}]).done((function(strings){notification.confirm(strings[0],strings[1],strings[2],strings[3],(function(){self._doReopenPlan(planData)}))})).fail(notification.exception)})).fail(notification.exception)},PlanActions.prototype._doCompletePlan=function(planData){var calls=[{methodname:"core_competency_complete_plan",args:{planid:planData.id}}];this._callAndRefresh(calls,planData)},PlanActions.prototype.completePlan=function(planData){var self=this;ajax.call([{methodname:"core_competency_read_plan",args:{id:planData.id}}])[0].done((function(plan){str.get_strings([{key:"confirm",component:"moodle"},{key:"completeplanconfirm",component:"tool_lp",param:plan.name},{key:"completeplan",component:"tool_lp"},{key:"cancel",component:"moodle"}]).done((function(strings){notification.confirm(strings[0],strings[1],strings[2],strings[3],(function(){self._doCompletePlan(planData)}))})).fail(notification.exception)})).fail(notification.exception)},PlanActions.prototype._doUnlinkPlan=function(planData){var calls=[{methodname:"core_competency_unlink_plan_from_template",args:{planid:planData.id}}];this._callAndRefresh(calls,planData)},PlanActions.prototype.unlinkPlan=function(planData){var self=this;ajax.call([{methodname:"core_competency_read_plan",args:{id:planData.id}}])[0].done((function(plan){str.get_strings([{key:"confirm",component:"moodle"},{key:"unlinkplantemplateconfirm",component:"tool_lp",param:plan.name},{key:"unlinkplantemplate",component:"tool_lp"},{key:"cancel",component:"moodle"}]).done((function(strings){notification.confirm(strings[0],strings[1],strings[2],strings[3],(function(){self._doUnlinkPlan(planData)}))})).fail(notification.exception)})).fail(notification.exception)},PlanActions.prototype._doRequestReview=function(planData){var calls=[{methodname:"core_competency_plan_request_review",args:{id:planData.id}}];this._callAndRefresh(calls,planData)},PlanActions.prototype.requestReview=function(planData){this._doRequestReview(planData)},PlanActions.prototype._doCancelReviewRequest=function(planData){var calls=[{methodname:"core_competency_plan_cancel_review_request",args:{id:planData.id}}];this._callAndRefresh(calls,planData)},PlanActions.prototype.cancelReviewRequest=function(planData){this._doCancelReviewRequest(planData)},PlanActions.prototype._doStartReview=function(planData){var calls=[{methodname:"core_competency_plan_start_review",args:{id:planData.id}}];this._callAndRefresh(calls,planData)},PlanActions.prototype.startReview=function(planData){this._doStartReview(planData)},PlanActions.prototype._doStopReview=function(planData){var calls=[{methodname:"core_competency_plan_stop_review",args:{id:planData.id}}];this._callAndRefresh(calls,planData)},PlanActions.prototype.stopReview=function(planData){this._doStopReview(planData)},PlanActions.prototype._doApprove=function(planData){var calls=[{methodname:"core_competency_approve_plan",args:{id:planData.id}}];this._callAndRefresh(calls,planData)},PlanActions.prototype.approve=function(planData){this._doApprove(planData)},PlanActions.prototype._doUnapprove=function(planData){var calls=[{methodname:"core_competency_unapprove_plan",args:{id:planData.id}}];this._callAndRefresh(calls,planData)},PlanActions.prototype.unapprove=function(planData){this._doUnapprove(planData)},PlanActions.prototype._showLinkedCoursesHandler=function(e){e.preventDefault();var competencyid=$(e.target).data("id");ajax.call([{methodname:"tool_lp_list_courses_using_competency",args:{id:competencyid}}])[0].done((function(courses){var context={courses:courses};templates.render("tool_lp/linked_courses_summary",context).done((function(html){str.get_string("linkedcourses","tool_lp").done((function(linkedcourses){new Dialogue(linkedcourses,html)})).fail(notification.exception)})).fail(notification.exception)})).fail(notification.exception)},PlanActions.prototype._eventHandler=function(method,e){e.preventDefault();var data=this._findPlanData($(e.target));this[method](data)},PlanActions.prototype._findPlanData=function(node){var data,parent=node.parentsUntil($(this._region).parent(),this._planNode);if(1!=parent.length)throw new Error("The plan node was not located.");if(void 0===(data=parent.data())||void 0===data.id)throw new Error("Plan data could not be found.");return data},PlanActions.prototype.enhanceMenubar=function(selector){Menubar.enhance(selector,{'[data-action="plan-delete"]':this._eventHandler.bind(this,"deletePlan"),'[data-action="plan-complete"]':this._eventHandler.bind(this,"completePlan"),'[data-action="plan-reopen"]':this._eventHandler.bind(this,"reopenPlan"),'[data-action="plan-unlink"]':this._eventHandler.bind(this,"unlinkPlan"),'[data-action="plan-request-review"]':this._eventHandler.bind(this,"requestReview"),'[data-action="plan-cancel-review-request"]':this._eventHandler.bind(this,"cancelReviewRequest"),'[data-action="plan-start-review"]':this._eventHandler.bind(this,"startReview"),'[data-action="plan-stop-review"]':this._eventHandler.bind(this,"stopReview"),'[data-action="plan-approve"]':this._eventHandler.bind(this,"approve"),'[data-action="plan-unapprove"]':this._eventHandler.bind(this,"unapprove")})},PlanActions.prototype.registerEvents=function(){var wrapper=$(this._region);wrapper.find('[data-action="plan-delete"]').click(this._eventHandler.bind(this,"deletePlan")),wrapper.find('[data-action="plan-complete"]').click(this._eventHandler.bind(this,"completePlan")),wrapper.find('[data-action="plan-reopen"]').click(this._eventHandler.bind(this,"reopenPlan")),wrapper.find('[data-action="plan-unlink"]').click(this._eventHandler.bind(this,"unlinkPlan")),wrapper.find('[data-action="plan-request-review"]').click(this._eventHandler.bind(this,"requestReview")),wrapper.find('[data-action="plan-cancel-review-request"]').click(this._eventHandler.bind(this,"cancelReviewRequest")),wrapper.find('[data-action="plan-start-review"]').click(this._eventHandler.bind(this,"startReview")),wrapper.find('[data-action="plan-stop-review"]').click(this._eventHandler.bind(this,"stopReview")),wrapper.find('[data-action="plan-approve"]').click(this._eventHandler.bind(this,"approve")),wrapper.find('[data-action="plan-unapprove"]').click(this._eventHandler.bind(this,"unapprove")),wrapper.find('[data-action="find-courses-link"]').click(this._showLinkedCoursesHandler.bind(this))},PlanActions}));
/**
 * Our basic form manager for when a user either enters
 * their profile url or just wants to browse.
 *
 * This file is a mishmash of JS functions we need for both the standalone (M3.7, M3.8)
 * plugin & Moodle 3.9 functions. The 3.9 Functions have a base understanding that certain
 * things exist i.e. directory structures for templates. When this feature goes 3.9+ only
 * The goal is that we can quickly gut all AMD modules into bare JS files and use ES6 guidelines.
 * Till then this will have to do.
 *
 * @module     tool_moodlenet/instance_form
 * @package    tool_moodlenet
 * @copyright  2020 Mathew May <mathew.solutions>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_moodlenet/instance_form",["tool_moodlenet/validator","tool_moodlenet/selectors","core/loadingicon","core/templates","core/notification","jquery"],(function(Validator,Selectors,LoadingIcon,Templates,Notification,$){var chooserNavigateToMnet=function(showMoodleNet,footerData,carousel,modal){showMoodleNet.innerHTML="";var page,spinnerPromise=LoadingIcon.addIconToContainer(showMoodleNet),transitionPromiseResolver=null,transitionPromise=new Promise((function(resolve){transitionPromiseResolver=resolve}));$.when(spinnerPromise,transitionPromise).then((function(){Templates.replaceNodeContents(showMoodleNet,footerData.customcarouseltemplate,"")})).catch(Notification.exception),(page=showMoodleNet).addEventListener("click",(function(e){if(e.target.matches(Selectors.action.submit)){var input=page.querySelector('[data-var="mnet-link"]'),overlay=page.querySelector(Selectors.region.spinner),validationArea=document.querySelector(Selectors.region.validationArea);overlay.classList.remove("d-none");var spinner=LoadingIcon.addIconToContainerWithPromise(overlay);Validator.validation(input).then((function(result){spinner.resolve(),overlay.classList.add("d-none"),result.result?(input.classList.remove("is-invalid"),input.classList.add("is-valid"),validationArea.innerText=result.message,validationArea.classList.remove("text-error"),validationArea.classList.add("text-success"),setTimeout((function(){window.location=result.domain}),1e3)):(input.classList.add("is-invalid"),validationArea.innerText=result.message,validationArea.classList.add("text-error"))})).catch()}})),carousel.one("slid.bs.carousel",(function(){transitionPromiseResolver()})),carousel.carousel(2),modal.setFooter(Templates.render("tool_moodlenet/chooser_footer_close_mnet",{}))};return{footerClickListener:function(e,footerData,modal){if(e.target.matches(Selectors.action.showMoodleNet)||e.target.closest(Selectors.action.showMoodleNet)){e.preventDefault();var carousel=$(modal.getBody()[0].querySelector(Selectors.region.carousel)),showMoodleNet=carousel.find(Selectors.region.moodleNet)[0];chooserNavigateToMnet(showMoodleNet,footerData,carousel,modal)}e.target.matches(Selectors.action.closeOption)&&function(carousel,modal,footerData){carousel.carousel(0),modal.setFooter(footerData.customfootertemplate)}($(modal.getBody()[0].querySelector(Selectors.region.carousel)),modal,footerData)}}}));
/**
 * Our validator that splits the user's input then fires off to a webservice
 *
 * @module     tool_moodlenet/validator
 * @package    tool_moodlenet
 * @copyright  2020 Mathew May <mathew.solutions>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_moodlenet/validator",["jquery","core/ajax","core/str","core/notification"],(function($,Ajax,Str,Notification){return{validation:function(inputElement){var inputValue=inputElement.value;return""!==inputValue&&inputValue.includes("@")||$.when(Str.get_string("profilevalidationerror","tool_moodlenet")).then((function(strings){return Promise.reject().catch((function(){return{result:!1,message:strings[0]}}))})).fail(Notification.exception),Ajax.call([{methodname:"tool_moodlenet_verify_webfinger",args:{profileurl:inputValue,course:inputElement.dataset.courseid,section:inputElement.dataset.sectionid}}])[0].then((function(result){return result})).catch()}}}));
/**
 * When returning to Moodle let the user select which course to add the resource to.
 *
 * @module     tool_moodlenet/select_page
 * @package    tool_moodlenet
 * @copyright  2020 Mathew May <mathew.solutions>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_moodlenet/select_page",["core/ajax","core/templates","tool_moodlenet/selectors","core/notification"],(function(Ajax,Templates,Selectors,Notification){var importId,searchCourses=function(inputValue,page,areaReplace){var searchIcon=page.querySelector(Selectors.region.searchIcon),clearIcon=page.querySelector(Selectors.region.clearIcon);""!==inputValue?(searchIcon.classList.add("d-none"),clearIcon.parentElement.classList.remove("d-none")):(searchIcon.classList.remove("d-none"),clearIcon.parentElement.classList.add("d-none"));var args={searchvalue:inputValue};Ajax.call([{methodname:"tool_moodlenet_search_courses",args:args}])[0].then((function(result){return 0===result.courses.length?function(areaReplace){return Templates.renderPix("courses","tool_moodlenet").then((function(img){return img})).then((function(img){var temp=document.createElement("div");return temp.innerHTML=img.trim(),Templates.render("core_course/no-courses",{nocoursesimg:temp.firstChild.src})})).then((function(html,js){Templates.replaceNodeContents(areaReplace,html,js),areaReplace.classList.add("mx-auto"),areaReplace.classList.add("w-25")}))}(areaReplace):(result.courses.forEach((function(course){course.viewurl+="&id="+importId})),function(areaReplace,courses){return Templates.render("tool_moodlenet/view-cards",{courses:courses}).then((function(html,js){Templates.replaceNodeContents(areaReplace,html,js),areaReplace.classList.remove("mx-auto"),areaReplace.classList.remove("w-25")}))}(areaReplace,result.courses))})).catch(Notification.exception)},registerListenerEvents=function(page){var input=page.querySelector(Selectors.region.searchInput),courseArea=page.querySelector(Selectors.region.courses);page.querySelector(Selectors.region.clearIcon).addEventListener("click",(function(){input.value="",searchCourses("",page,courseArea)})),input.addEventListener("input",debounce((function(){searchCourses(input.value,page,courseArea)}),300))},addCourses=function(page){var courseArea=page.querySelector(Selectors.region.courses);searchCourses("",page,courseArea)},debounce=function(func,wait,immediate){var timeout;return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||func.apply(context,args)},callNow=immediate&&!timeout;clearTimeout(timeout),timeout=setTimeout(later,wait),callNow&&func.apply(context,args)}};return{init:function(importIdString){importId=importIdString;var page=document.querySelector(Selectors.region.selectPage);registerListenerEvents(page),addCourses(page)}}}));
/**
 * Define all of the selectors we will be using within MoodleNet plugin.
 *
 * @module     tool_moodlenet/selectors
 * @package    tool_moodlenet
 * @copyright  2020 Mathew May <mathew.solutions>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_moodlenet/selectors",[],(function(){return{action:{browse:'[data-action="browse"]',submit:'[data-action="submit"]',showMoodleNet:'[data-action="show-moodlenet"]',closeOption:'[data-action="close-chooser-option-summary"]'},region:{clearIcon:'[data-region="clear-icon"]',courses:'[data-region="mnet-courses"]',instancePage:'[data-region="moodle-net"]',searchInput:'[data-region="search-input"]',searchIcon:'[data-region="search-icon"]',selectPage:'[data-region="moodle-net-select"]',spinner:'[data-region="spinner"]',validationArea:'[data-region="validation-area"]',carousel:'[data-region="carousel"]',moodleNet:'[data-region="pluginCarousel"]'}}}));
/**
 * Datasource for the tool_policy/acceptances_filter.
 *
 * This module is compatible with core/form-autocomplete.
 *
 * @package    tool_policy
 * @copyright  2017 Jun Pataleta
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_policy/acceptances_filter_datasource",["jquery","core/ajax","core/notification"],(function($,Ajax,Notification){return{list:function(selector,query){var filteredOptions=[],el=$(selector),originalOptions=$(selector).data("originaloptionsjson"),selectedFilters=el.val();$.each(originalOptions,(function(index,option){return""!==query.trim()&&-1===option.label.toLocaleLowerCase().indexOf(query.toLocaleLowerCase())||$.inArray(option.value,selectedFilters)>-1||filteredOptions.push(option),!0}));var deferred=new $.Deferred;return deferred.resolve(filteredOptions),deferred.promise()},processResults:function(selector,results){var options=[];return $.each(results,(function(index,data){options.push({value:data.value,label:data.label})})),options},transport:function(selector,query,callback){this.list(selector,query).then(callback).catch(Notification.exception)}}}));
define("tool_policy/jquery-eu-cookie-law-popup",["jquery"],(function($){window.console||(window.console={}),window.console.log||(window.console.log=function(){}),$.fn.euCookieLawPopup=function(){var _self=this;_self.params={cookiePolicyUrl:"/?cookie-policy",popupPosition:"top",colorStyle:"default",compactStyle:!1,popupTitle:"This website is using cookies",popupText:"We use cookies to ensure that we give you the best experience on our website. If you continue without changing your settings, we'll assume that you are happy to receive all cookies on this website.",buttonContinueTitle:"Continue",buttonLearnmoreTitle:"Learn&nbsp;more",buttonLearnmoreOpenInNewWindow:!0,agreementExpiresInDays:30,autoAcceptCookiePolicy:!1,htmlMarkup:null},_self.vars={INITIALISED:!1,HTML_MARKUP:null,COOKIE_NAME:"EU_COOKIE_LAW_CONSENT"};var setUserAcceptsCookies=function(consent){var d=new Date,expiresInDays=24*_self.params.agreementExpiresInDays*60*60*1e3;d.setTime(d.getTime()+expiresInDays);var expires="expires="+d.toGMTString();document.cookie=_self.vars.COOKIE_NAME+"="+consent+"; "+expires+";path=/",$(document).trigger("user_cookie_consent_changed",{consent:consent})},hideContainer=function(){$(".eupopup-container").animate({opacity:0,height:0},200,(function(){$(".eupopup-container").hide(0)}))};return{init:function(settings){!function(object,markup,settings){if(object){var className=$(object).attr("class")?$(object).attr("class"):"";className.indexOf("eupopup-top")>-1?_self.params.popupPosition="top":className.indexOf("eupopup-fixedtop")>-1?_self.params.popupPosition="fixedtop":className.indexOf("eupopup-bottomright")>-1?_self.params.popupPosition="bottomright":className.indexOf("eupopup-bottomleft")>-1?_self.params.popupPosition="bottomleft":className.indexOf("eupopup-bottom")>-1?_self.params.popupPosition="bottom":className.indexOf("eupopup-block")>-1&&(_self.params.popupPosition="block"),className.indexOf("eupopup-color-default")>-1?_self.params.colorStyle="default":className.indexOf("eupopup-color-inverse")>-1&&(_self.params.colorStyle="inverse"),className.indexOf("eupopup-style-compact")>-1&&(_self.params.compactStyle=!0)}markup&&(_self.params.htmlMarkup=markup),settings&&(void 0!==settings.cookiePolicyUrl&&(_self.params.cookiePolicyUrl=settings.cookiePolicyUrl),void 0!==settings.popupPosition&&(_self.params.popupPosition=settings.popupPosition),void 0!==settings.colorStyle&&(_self.params.colorStyle=settings.colorStyle),void 0!==settings.popupTitle&&(_self.params.popupTitle=settings.popupTitle),void 0!==settings.popupText&&(_self.params.popupText=settings.popupText),void 0!==settings.buttonContinueTitle&&(_self.params.buttonContinueTitle=settings.buttonContinueTitle),void 0!==settings.buttonLearnmoreTitle&&(_self.params.buttonLearnmoreTitle=settings.buttonLearnmoreTitle),void 0!==settings.buttonLearnmoreOpenInNewWindow&&(_self.params.buttonLearnmoreOpenInNewWindow=settings.buttonLearnmoreOpenInNewWindow),void 0!==settings.agreementExpiresInDays&&(_self.params.agreementExpiresInDays=settings.agreementExpiresInDays),void 0!==settings.autoAcceptCookiePolicy&&(_self.params.autoAcceptCookiePolicy=settings.autoAcceptCookiePolicy),void 0!==settings.htmlMarkup&&(_self.params.htmlMarkup=settings.htmlMarkup))}($(".eupopup").first(),$(".eupopup-markup").html(),settings),function(){for(var userAcceptedCookies=!1,cookies=document.cookie.split(";"),i=0;i<cookies.length;i++){var c=cookies[i].trim();-1!==c.indexOf(_self.vars.COOKIE_NAME)&&(userAcceptedCookies=c.substring(_self.vars.COOKIE_NAME.length+1,c.length))}return userAcceptedCookies}()?$(document).trigger("user_cookie_already_accepted",{consent:!0}):_self.vars.INITIALISED||(_self.vars.INITIALISED=!0,_self.vars.HTML_MARKUP=_self.params.htmlMarkup?_self.params.htmlMarkup:'<div class="eupopup-container eupopup-container-'+_self.params.popupPosition+(_self.params.compactStyle?" eupopup-style-compact":"")+" eupopup-color-"+_self.params.colorStyle+'"><div class="eupopup-head">'+_self.params.popupTitle+'</div><div class="eupopup-body">'+_self.params.popupText+'</div><div class="eupopup-buttons"><a href="#" class="eupopup-button eupopup-button_1">'+_self.params.buttonContinueTitle+'</a><a href="'+_self.params.cookiePolicyUrl+'"'+(_self.params.buttonLearnmoreOpenInNewWindow?" target=_blank ":"")+' class="eupopup-button eupopup-button_2">'+_self.params.buttonLearnmoreTitle+'</a><div class="clearfix"></div></div><a href="#" class="eupopup-closebutton">x</a></div>',$(".eupopup-block").length>0?$(".eupopup-block").append(_self.vars.HTML_MARKUP):$("BODY").append(_self.vars.HTML_MARKUP),$(".eupopup-button_1").click((function(){return setUserAcceptsCookies(!0),hideContainer(),!1})),$(".eupopup-closebutton").click((function(){return setUserAcceptsCookies(!0),hideContainer(),!1})),$(".eupopup-container").show(),_self.params.autoAcceptCookiePolicy&&setUserAcceptsCookies(!0))}}}}));
/**
 * Unified filter page JS module for the course participants page.
 *
 * @module     tool_policy/acceptances_filter
 * @package    tool_policy
 * @copyright  2017 Jun Pataleta
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_policy/acceptances_filter",["jquery","core/form-autocomplete","core/str","core/notification"],(function($,Autocomplete,Str,Notification){var SELECTORS_UNIFIED_FILTERS="#unified-filters";return{init:function(){!function(){M.util.js_pending("acceptances_filter_datasource"),Str.get_strings([{key:"filterplaceholder",component:"tool_policy"},{key:"nofiltersapplied",component:"tool_policy"}]).done((function(langstrings){var placeholder=langstrings[0],noSelectionString=langstrings[1];Autocomplete.enhance(SELECTORS_UNIFIED_FILTERS,!0,"tool_policy/acceptances_filter_datasource",placeholder,!1,!0,noSelectionString,!0).then((function(){M.util.js_complete("acceptances_filter_datasource")})).fail(Notification.exception)})).fail(Notification.exception);var last=$(SELECTORS_UNIFIED_FILTERS).val();$(SELECTORS_UNIFIED_FILTERS).on("change",(function(){var current=$(this).val(),listoffilters=[],textfilters=[],updatedselectedfilters=!1;if($.each(current,(function(index,catoption){var catandoption=catoption.split(":",2);if(2!==catandoption.length)return textfilters.push(catoption),!0;var category=catandoption[0],option=catandoption[1];return void 0!==listoffilters[category]&&(updatedselectedfilters=!0),listoffilters[category]=option,!0})),updatedselectedfilters){var updatefilters=[];for(var category in listoffilters)updatefilters.push(category+":"+listoffilters[category]);updatefilters=updatefilters.concat(textfilters),$(this).val(updatefilters)}last.join(",")!=current.join(",")&&this.form.submit()}))}()},getForm:function(){return $(SELECTORS_UNIFIED_FILTERS).closest("form")}}}));
/**
 * Policy actions.
 *
 * @module     tool_policy/policyactions
 * @package    tool_policy
 * @copyright  2018 Sara Arjona (sara@moodle.com)
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_policy/policyactions",["jquery","core/ajax","core/notification","core/modal_factory","core/modal_events"],(function($,Ajax,Notification,ModalFactory,ModalEvents){var PolicyActions=function(root){this.registerEvents(root)};return PolicyActions.prototype.registerEvents=function(root){root.on("click",(function(e){e.preventDefault();var request={methodname:"tool_policy_get_policy_version",args:{versionid:$(this).data("versionid"),behalfid:$(this).data("behalfid")}},modalTitle=$.Deferred(),modalBody=$.Deferred(),modal=ModalFactory.create({title:modalTitle,body:modalBody,large:!0}).then((function(modal){return modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal})).then((function(modal){return modal.show(),modal})).catch(Notification.exception),promises=Ajax.call([request]);$.when(promises[0]).then((function(data){if(data.result.policy)return modalTitle.resolve(data.result.policy.name),modalBody.resolve(data.result.policy.content),data;throw new Error(data.warnings[0].message)})).catch((function(message){return modal.then((function(modal){return modal.hide(),modal.destroy(),modal})).catch(Notification.exception),Notification.addNotification({message:message,type:"error"})}))}))},{init:function(root){return root=$(root),new PolicyActions(root)}}}));
/**
 * Adds support for confirmation via JS modal for some management actions at the Manage policies page.
 *
 * @module      tool_policy/managedocsactions
 * @package     tool_policy
 * @copyright   2018 David Mudrk <david@moodle.com>
 * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_policy/managedocsactions",["jquery","core/log","core/config","core/str","core/modal_factory","core/modal_events"],(function($,Log,Config,Str,ModalFactory,ModalEvents){var ACTION_LINKS="[data-action]",ACTION_MAKE_CURRENT='[data-action="makecurrent"]',ACTION_INACTIVATE='[data-action="inactivate"]',ACTION_DELETE='[data-action="delete"]';function ManageDocsActions(base){this.base=base,this.initEvents()}return ManageDocsActions.prototype.initEvents=function(){this.base.on("click",ACTION_LINKS,(function(e){e.stopPropagation();var promise,strings,link=$(e.currentTarget);if(link.is(ACTION_MAKE_CURRENT))promise=Str.get_strings([{key:"activating",component:"tool_policy"},{key:"activateconfirm",component:"tool_policy",param:{name:link.closest("[data-policy-name]").attr("data-policy-name"),revision:link.closest("[data-policy-revision]").attr("data-policy-revision")}},{key:"activateconfirmyes",component:"tool_policy"}]);else if(link.is(ACTION_INACTIVATE))promise=Str.get_strings([{key:"inactivating",component:"tool_policy"},{key:"inactivatingconfirm",component:"tool_policy",param:{name:link.closest("[data-policy-name]").attr("data-policy-name"),revision:link.closest("[data-policy-revision]").attr("data-policy-revision")}},{key:"inactivatingconfirmyes",component:"tool_policy"}]);else{if(!link.is(ACTION_DELETE))return void Log.error("unknown action type detected","tool_policy/managedocsactions");promise=Str.get_strings([{key:"deleting",component:"tool_policy"},{key:"deleteconfirm",component:"tool_policy",param:{name:link.closest("[data-policy-name]").attr("data-policy-name"),revision:link.closest("[data-policy-revision]").attr("data-policy-revision")}},{key:"delete",component:"core"}])}e.preventDefault(),promise.then((function(strs){return strings=strs,ModalFactory.create({title:strings[0],body:strings[1],type:ModalFactory.types.SAVE_CANCEL})})).then((function(modal){return modal.setSaveButtonText(strings[2]),modal.getRoot().on(ModalEvents.save,(function(){window.location.href=link.attr("href")+"&sesskey="+Config.sesskey+"&confirm=1"})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.show(),!0})).catch((function(e){return Log.error(e),!1}))}))},{init:function(baseid){var base=$(document.getElementById(baseid));if(base.length)return new ManageDocsActions(base);throw new Error("managedocsactions: Invalid base element identifier")}}}));
/**
 * Add policy consent modal to the page
 *
 * @module     tool_policy/acceptmodal
 * @class      AcceptOnBehalf
 * @package    tool_policy
 * @copyright  2018 Marina Glancy
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_policy/acceptmodal",["jquery","core/str","core/modal_factory","core/modal_events","core/notification","core/fragment","core/ajax","core/yui"],(function($,Str,ModalFactory,ModalEvents,Notification,Fragment,Ajax,Y){var AcceptOnBehalf=function(contextid){this.contextid=contextid,this.init()};return AcceptOnBehalf.prototype.modal=null,AcceptOnBehalf.prototype.contextid=-1,AcceptOnBehalf.prototype.currentTrigger=null,AcceptOnBehalf.prototype.triggers={SINGLE:"a[data-action=acceptmodal]",BULK:"input[data-action=acceptmodal]"},AcceptOnBehalf.prototype.init=function(){$(this.triggers.SINGLE).on("click",function(e){e.preventDefault(),this.currentTrigger=$(e.currentTarget);var href=$(e.currentTarget).attr("href"),formData=href.slice(href.indexOf("?")+1);this.showFormModal(formData)}.bind(this)),$(this.triggers.BULK).on("click",function(e){e.preventDefault(),this.currentTrigger=$(e.currentTarget);var form=$(e.currentTarget).closest("form");if(form.find('input[type=checkbox][name="userids[]"]:checked').length){var formData=form.serialize();this.showFormModal(formData)}else Str.get_strings([{key:"notice"},{key:"selectusersforconsent",component:"tool_policy"},{key:"ok"}]).then((function(strings){Notification.alert(strings[0],strings[1],strings[2])})).fail(Notification.exception)}.bind(this))},AcceptOnBehalf.prototype.showFormModal=function(formData){for(var action,params=formData.split("&"),i=0;i<params.length;i++){var pair=params[i].split("=");"action"==pair[0]&&(action=pair[1])}Str.get_strings([{key:"statusformtitleaccept",component:"tool_policy"},{key:"iagreetothepolicy",component:"tool_policy"},{key:"statusformtitlerevoke",component:"tool_policy"},{key:"irevokethepolicy",component:"tool_policy"},{key:"statusformtitledecline",component:"tool_policy"},{key:"declinethepolicy",component:"tool_policy"}]).then(function(strings){var title,saveText;return"accept"==action?(title=strings[0],saveText=strings[1]):"revoke"==action?(title=strings[2],saveText=strings[3]):"decline"==action&&(title=strings[4],saveText=strings[5]),ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:title,body:""}).done(function(modal){this.modal=modal,this.setupFormModal(formData,saveText)}.bind(this))}.bind(this)).catch(Notification.exception)},AcceptOnBehalf.prototype.setupFormModal=function(formData,saveText){var modal=this.modal;modal.setLarge(),modal.setSaveButtonText(saveText),modal.getRoot().on(ModalEvents.hidden,this.destroy.bind(this)),modal.setBody(this.getBody(formData)),modal.getRoot().on(ModalEvents.save,this.submitForm.bind(this)),modal.getRoot().on("submit","form",this.submitFormAjax.bind(this)),modal.show()},AcceptOnBehalf.prototype.getBody=function(formData){void 0===formData&&(formData={});var params={jsonformdata:JSON.stringify(formData)};return Fragment.loadFragment("tool_policy","accept_on_behalf",this.contextid,params)},AcceptOnBehalf.prototype.submitFormAjax=function(e){e.preventDefault();var formData=this.modal.getRoot().find("form").serialize();Ajax.call([{methodname:"tool_policy_submit_accept_on_behalf",args:{jsonformdata:JSON.stringify(formData)}}])[0].done(function(data){data.validationerrors?this.modal.setBody(this.getBody(formData)):this.close()}.bind(this)).fail(Notification.exception)},AcceptOnBehalf.prototype.submitForm=function(e){e.preventDefault(),this.modal.getRoot().find("form").submit()},AcceptOnBehalf.prototype.close=function(){this.destroy(),document.location.reload()},AcceptOnBehalf.prototype.destroy=function(){Y.use("moodle-core-formchangechecker",(function(){M.core_formchangechecker.reset_form_dirty_state()})),this.modal.destroy(),this.currentTrigger.focus()},{getInstance:function(contextid){return new AcceptOnBehalf(contextid)}}}));
/**
 * This module adds ajax display functions to the template library page.
 *
 * @module     tool_templatelibrary/display
 * @package    tool_templatelibrary
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_templatelibrary/display",["jquery","core/ajax","core/log","core/notification","core/templates","core/config","core/str"],(function($,ajax,log,notification,templates,config,str){var findDocsSection=function(templateSource,templateName){if(!templateSource)return!1;var sections,marker="@template "+templateName,i=0;if(null!==(sections=templateSource.match(/{{!([\s\S]*?)}}/g)))for(i=0;i<sections.length;i++){var section=sections[i],start=section.indexOf(marker);if(-1!==start){var offset=start+marker.length+1;return section=section.substr(offset,section.length-2-offset)}}return!1},loadTemplate=function(templateName){var parts=templateName.split("/"),component=parts.shift(),name=parts.join("/"),promises=ajax.call([{methodname:"core_output_load_template",args:{component:component,template:name,themename:config.theme,includecomments:!0}},{methodname:"tool_templatelibrary_load_canonical_template",args:{component:component,template:name}}],!0,!1);$.when.apply($,promises).done((function(source,originalSource){!function(templateName,source,originalSource){str.get_string("templateselected","tool_templatelibrary",templateName).done((function(s){$('[data-region="displaytemplateheader"]').text(s)})).fail(notification.exception);var docs=findDocsSection(source,templateName);!1===docs&&(docs=findDocsSection(originalSource,templateName)),docs&&(source=docs),$('[data-region="displaytemplatesource"]').text(source);var example=source.match(/Example context \(json\):([\s\S]*)/),context=!1;if(example){var rawJSON=example[1].trim();try{context=$.parseJSON(rawJSON)}catch(e){log.debug("Could not parse json example context for template."),log.debug(e)}}context?templates.render(templateName,context).done((function(html,js){templates.replaceNodeContents($('[data-region="displaytemplateexample"]'),html,js)})).fail(notification.exception):str.get_string("templatehasnoexample","tool_templatelibrary").done((function(s){$('[data-region="displaytemplateexample"]').text(s)})).fail(notification.exception)}(templateName,source,originalSource)})).fail(notification.exception)};return $('[data-region="list-templates"]').on("click","[data-templatename]",(function(e){var templatename=$(this).data("templatename");e.preventDefault(),loadTemplate(templatename)})),{}}));
/**
 * This module adds ajax search functions to the template library page.
 *
 * @module     tool_templatelibrary/search
 * @package    tool_templatelibrary
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_templatelibrary/search",["jquery","core/ajax","core/log","core/notification","core/templates","core/config"],(function($,ajax,log,notification,templates,config){var reloadListTemplate=function(templateList){templates.render("tool_templatelibrary/search_results",{templates:templateList}).done((function(result,js){templates.replaceNode($('[data-region="searchresults"]'),result,js)})).fail(notification.exception)},refreshSearch=function(themename){var componentStr=$('[data-field="component"]').val(),searchStr=$('[data-field="search"]').val();ajax.call([{methodname:"tool_templatelibrary_list_templates",args:{component:componentStr,search:searchStr,themename:themename},done:reloadListTemplate,fail:notification.exception}],!0,!1)},throttle=null,changeHandler=function(){var callback,delay;callback=refreshSearch.bind(this,config.theme),delay=400,null!==throttle&&window.clearTimeout(throttle),throttle=window.setTimeout((function(){callback(),throttle=null}),delay)};return $('[data-region="list-templates"]').on("change",'[data-field="component"]',changeHandler),$('[data-region="list-templates"]').on("input",'[data-field="search"]',changeHandler),refreshSearch(config.theme),{}}));
define("tool_usertours/managesteps",["jquery","core/str","core/notification"],(function($,str,notification){var manager={removeStep:function(e){e.preventDefault();var targetUrl=$(e.currentTarget).attr("href");str.get_strings([{key:"confirmstepremovaltitle",component:"tool_usertours"},{key:"confirmstepremovalquestion",component:"tool_usertours"},{key:"yes",component:"moodle"},{key:"no",component:"moodle"}]).then((function(s){notification.confirm(s[0],s[1],s[2],s[3],(function(){window.location=targetUrl}))})).catch()},setup:function(){$("body").delegate('[data-action="delete"]',"click",manager.removeStep)}};return{setup:manager.setup}}));
define("tool_usertours/tour",["exports","jquery","core/popper"],(function(_exports,_jquery,_popper){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_popper=_interopRequireDefault(_popper);var Tour=function(){function Tour(config){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Tour),this.init(config)}var Constructor,protoProps,staticProps;return Constructor=Tour,protoProps=[{key:"init",value:function(config){this.eventHandlers={},this.reset(),this.originalConfiguration=config||{},this.configure.apply(this,arguments);try{this.storage=window.sessionStorage,this.storageKey="tourstate_"+this.tourName}catch(e){this.storage=!1,this.storageKey=""}return this}},{key:"reset",value:function(){return this.hide(),this.eventHandlers=[],this.resetStepListeners(),this.originalConfiguration={},this.steps=[],this.currentStepNumber=0,this}},{key:"configure",value:function(config){var _this=this;if("object"===_typeof(config)){if(void 0!==config.tourName&&(this.tourName=config.tourName),config.eventHandlers){var _loop=function(eventName){config.eventHandlers[eventName].forEach((function(handler){this.addEventHandler(eventName,handler)}),_this)};for(var eventName in config.eventHandlers)_loop(eventName)}this.resetStepDefaults(!0),"object"===_typeof(config.steps)&&(this.steps=config.steps),void 0!==config.template&&(this.templateContent=config.template)}return this.checkMinimumRequirements(),this}},{key:"checkMinimumRequirements",value:function(){if(!this.tourName)throw new Error("Tour Name required");if(!this.steps||!this.steps.length)throw new Error("Steps must be specified")}},{key:"resetStepDefaults",value:function(loadOriginalConfiguration){return void 0===loadOriginalConfiguration&&(loadOriginalConfiguration=!0),this.stepDefaults={},loadOriginalConfiguration&&void 0!==this.originalConfiguration.stepDefaults?this.setStepDefaults(this.originalConfiguration.stepDefaults):this.setStepDefaults({}),this}},{key:"setStepDefaults",value:function(stepDefaults){return this.stepDefaults||(this.stepDefaults={}),_jquery.default.extend(this.stepDefaults,{element:"",placement:"top",delay:0,moveOnClick:!1,moveAfterTime:0,orphan:!1,direction:1},stepDefaults),this}},{key:"getCurrentStepNumber",value:function(){return parseInt(this.currentStepNumber,10)}},{key:"setCurrentStepNumber",value:function(stepNumber){if(this.currentStepNumber=stepNumber,this.storage)try{this.storage.setItem(this.storageKey,stepNumber)}catch(e){e.code===DOMException.QUOTA_EXCEEDED_ERR&&this.storage.removeItem(this.storageKey)}}},{key:"getNextStepNumber",value:function(stepNumber){void 0===stepNumber&&(stepNumber=this.getCurrentStepNumber());for(var nextStepNumber=stepNumber+1;nextStepNumber<=this.steps.length;){if(this.isStepPotentiallyVisible(this.getStepConfig(nextStepNumber)))return nextStepNumber;nextStepNumber++}return null}},{key:"getPreviousStepNumber",value:function(stepNumber){void 0===stepNumber&&(stepNumber=this.getCurrentStepNumber());for(var previousStepNumber=stepNumber-1;previousStepNumber>=0;){if(this.isStepPotentiallyVisible(this.getStepConfig(previousStepNumber)))return previousStepNumber;previousStepNumber--}return null}},{key:"isLastStep",value:function(stepNumber){return null===this.getNextStepNumber(stepNumber)}},{key:"isFirstStep",value:function(stepNumber){return null===this.getPreviousStepNumber(stepNumber)}},{key:"isStepPotentiallyVisible",value:function(stepConfig){return!!(stepConfig&&(this.isStepActuallyVisible(stepConfig)||void 0!==stepConfig.orphan&&stepConfig.orphan||void 0!==stepConfig.delay&&stepConfig.delay))}},{key:"isStepActuallyVisible",value:function(stepConfig){if(!stepConfig)return!1;var target=this.getStepTarget(stepConfig);return!!(target&&target.length&&target.is(":visible"))&&!!target.length}},{key:"next",value:function(){return this.gotoStep(this.getNextStepNumber())}},{key:"previous",value:function(){return this.gotoStep(this.getPreviousStepNumber(),-1)}},{key:"gotoStep",value:function(stepNumber,direction){if(stepNumber<0)return this.endTour();var stepConfig=this.getStepConfig(stepNumber);return null===stepConfig?this.endTour():this._gotoStep(stepConfig,direction)}},{key:"_gotoStep",value:function(stepConfig,direction){if(!stepConfig)return this.endTour();if(void 0!==stepConfig.delay&&stepConfig.delay&&!stepConfig.delayed)return stepConfig.delayed=!0,window.setTimeout(this._gotoStep.bind(this),stepConfig.delay,stepConfig,direction),this;if(!stepConfig.orphan&&!this.isStepActuallyVisible(stepConfig)){var fn=-1==direction?"getPreviousStepNumber":"getNextStepNumber";return this.gotoStep(this[fn](stepConfig.stepNumber),direction)}return this.hide(),this.fireEventHandlers("beforeRender",stepConfig),this.renderStep(stepConfig),this.fireEventHandlers("afterRender",stepConfig),this}},{key:"getStepConfig",value:function(stepNumber){if(null===stepNumber||stepNumber<0||stepNumber>=this.steps.length)return null;var stepConfig=this.normalizeStepConfig(this.steps[stepNumber]);return stepConfig=_jquery.default.extend(stepConfig,{stepNumber:stepNumber})}},{key:"normalizeStepConfig",value:function(stepConfig){return void 0!==stepConfig.reflex&&void 0===stepConfig.moveAfterClick&&(stepConfig.moveAfterClick=stepConfig.reflex),void 0!==stepConfig.element&&void 0===stepConfig.target&&(stepConfig.target=stepConfig.element),void 0!==stepConfig.content&&void 0===stepConfig.body&&(stepConfig.body=stepConfig.content),stepConfig=_jquery.default.extend({},this.stepDefaults,stepConfig),(stepConfig=_jquery.default.extend({},{attachTo:stepConfig.target,attachPoint:"after"},stepConfig)).attachTo&&(stepConfig.attachTo=(0,_jquery.default)(stepConfig.attachTo).first()),stepConfig}},{key:"getStepTarget",value:function(stepConfig){return stepConfig.target?(0,_jquery.default)(stepConfig.target):null}},{key:"fireEventHandlers",value:function(eventName,data){return void 0===this.eventHandlers[eventName]||this.eventHandlers[eventName].forEach((function(thisEvent){thisEvent.call(this,data)}),this),this}},{key:"addEventHandler",value:function(eventName,handler){return void 0===this.eventHandlers[eventName]&&(this.eventHandlers[eventName]=[]),this.eventHandlers[eventName].push(handler),this}},{key:"processStepListeners",value:function(stepConfig){if(this.listeners.push({node:this.currentStepNode,args:["click",'[data-role="next"]',_jquery.default.proxy(this.next,this)]},{node:this.currentStepNode,args:["click",'[data-role="previous"]',_jquery.default.proxy(this.previous,this)]},{node:this.currentStepNode,args:["click",'[data-role="end"]',_jquery.default.proxy(this.endTour,this)]},{node:(0,_jquery.default)('[data-flexitour="backdrop"]'),args:["click",_jquery.default.proxy(this.hide,this)]},{node:(0,_jquery.default)("body"),args:["keydown",_jquery.default.proxy(this.handleKeyDown,this)]}),stepConfig.moveOnClick){var targetNode=this.getStepTarget(stepConfig);this.listeners.push({node:targetNode,args:["click",_jquery.default.proxy((function(e){0===(0,_jquery.default)(e.target).parents('[data-flexitour="container"]').length&&window.setTimeout(_jquery.default.proxy(this.next,this),500)}),this)]})}return this.listeners.forEach((function(listener){listener.node.on.apply(listener.node,listener.args)})),this}},{key:"resetStepListeners",value:function(){return this.listeners&&this.listeners.forEach((function(listener){listener.node.off.apply(listener.node,listener.args)})),this.listeners=[],this}},{key:"renderStep",value:function(stepConfig){this.currentStepConfig=stepConfig,this.setCurrentStepNumber(stepConfig.stepNumber);var template=(0,_jquery.default)(this.getTemplateContent());return template.find('[data-placeholder="title"]').html(stepConfig.title),template.find('[data-placeholder="body"]').html(stepConfig.body),this.isFirstStep(stepConfig.stepNumber)?template.find('[data-role="previous"]').hide():template.find('[data-role="previous"]').prop("disabled",!1),this.isLastStep(stepConfig.stepNumber)?(template.find('[data-role="next"]').hide(),template.find('[data-role="end"]').removeClass("btn-secondary").addClass("btn-primary")):template.find('[data-role="next"]').prop("disabled",!1),template.find('[data-role="previous"]').attr("role","button"),template.find('[data-role="next"]').attr("role","button"),template.find('[data-role="end"]').attr("role","button"),stepConfig.template=template,this.addStepToPage(stepConfig),this.processStepListeners(stepConfig),this}},{key:"getTemplateContent",value:function(){return(0,_jquery.default)(this.templateContent).clone()}},{key:"addStepToPage",value:function(stepConfig){var currentStepNode=(0,_jquery.default)('<span data-flexitour="container"></span>').html(stepConfig.template).hide(),animationTarget=(0,_jquery.default)("body, html").stop(!0,!0);if(this.isStepActuallyVisible(stepConfig)){var targetNode=this.getStepTarget(stepConfig);targetNode.data("flexitour","target");var zIndex=this.calculateZIndex(targetNode);zIndex&&(stepConfig.zIndex=zIndex+1),stepConfig.zIndex&&currentStepNode.css("zIndex",stepConfig.zIndex+1),this.positionBackdrop(stepConfig),(0,_jquery.default)(document.body).append(currentStepNode),this.currentStepNode=currentStepNode,this.currentStepNode.css({top:0,left:0}),animationTarget.animate({scrollTop:this.calculateScrollTop(stepConfig)}).promise().then(function(){this.positionStep(stepConfig),this.revealStep(stepConfig)}.bind(this)).catch((function(){}))}else stepConfig.orphan&&(stepConfig.isOrphan=!0,stepConfig.attachTo=(0,_jquery.default)("body").first(),stepConfig.attachPoint="append",this.positionBackdrop(stepConfig),currentStepNode.addClass("orphan"),(0,_jquery.default)(document.body).append(currentStepNode),this.currentStepNode=currentStepNode,this.currentStepNode.offset(this.calculateStepPositionInPage()),this.currentStepNode.css("position","fixed"),this.currentStepPopper=new _popper.default((0,_jquery.default)("body"),this.currentStepNode[0],{removeOnDestroy:!0,placement:stepConfig.placement+"-start",arrowElement:'[data-role="arrow"]',modifiers:{hide:{enabled:!1},applyStyle:{onLoad:null,enabled:!1}}}),this.revealStep(stepConfig));return this}},{key:"revealStep",value:function(stepConfig){return this.currentStepNode.fadeIn("",_jquery.default.proxy((function(){this.announceStep(stepConfig),this.currentStepNode.focus(),window.setTimeout(_jquery.default.proxy((function(){this.currentStepNode&&this.currentStepNode.focus()}),this),100)}),this)),this}},{key:"announceStep",value:function(stepConfig){var stepId="tour-step-"+this.tourName+"-"+stepConfig.stepNumber;this.currentStepNode.attr("id",stepId);var bodyRegion=this.currentStepNode.find('[data-placeholder="body"]').first();bodyRegion.attr("id",stepId+"-body"),bodyRegion.attr("role","document");var headerRegion=this.currentStepNode.find('[data-placeholder="title"]').first();headerRegion.attr("id",stepId+"-title"),headerRegion.attr("aria-labelledby",stepId+"-body"),this.currentStepNode.attr("role","dialog"),this.currentStepNode.attr("tabindex",0),this.currentStepNode.attr("aria-labelledby",stepId+"-title"),this.currentStepNode.attr("aria-describedby",stepId+"-body");var target=this.getStepTarget(stepConfig);return target&&(target.attr("tabindex")||target.attr("tabindex",0),target.data("original-describedby",target.attr("aria-describedby")).attr("aria-describedby",stepId+"-body")),this.accessibilityShow(stepConfig),this}},{key:"handleKeyDown",value:function(e){var tabbableSelector="a[href], link[href], [draggable=true], [contenteditable=true], ";switch(tabbableSelector+=":input:enabled, [tabindex], button:enabled",e.keyCode){case 27:this.endTour();break;case 9:(function(){if(this.currentStepConfig.hasBackdrop){var currentIndex,nextIndex,nextNode,focusRelevant,activeElement=(0,_jquery.default)(document.activeElement),stepTarget=this.getStepTarget(this.currentStepConfig),tabbableNodes=(0,_jquery.default)(tabbableSelector),dialogContainer=(0,_jquery.default)('span[data-flexitour="container"]');if(stepTarget&&(tabbableNodes=tabbableNodes.filter((function(index,element){return null!==stepTarget&&(stepTarget.has(element).length||dialogContainer.has(element).length||stepTarget.is(element)||dialogContainer.is(element))}))),tabbableNodes.each((function(index,element){return!activeElement.is(element)||(currentIndex=index,!1)})),null!=currentIndex){var direction=1;e.shiftKey&&(direction=-1),nextIndex=currentIndex;do{nextIndex+=direction,nextNode=(0,_jquery.default)(tabbableNodes[nextIndex])}while(nextNode.length&&nextNode.is(":disabled")||nextNode.is(":hidden"));focusRelevant=!!nextNode.length&&((focusRelevant=nextNode.closest(stepTarget).length)||nextNode.closest(this.currentStepNode).length)}focusRelevant?nextNode.focus():e.shiftKey?this.currentStepNode.find(tabbableSelector).last().focus():this.currentStepConfig.isOrphan?this.currentStepNode.focus():stepTarget.focus(),e.preventDefault()}}).call(this)}}},{key:"startTour",value:function(startAt){if(this.storage&&void 0===startAt){var storageStartValue=this.storage.getItem(this.storageKey);if(storageStartValue){var storageStartAt=parseInt(storageStartValue,10);storageStartAt<=this.steps.length&&(startAt=storageStartAt)}}return void 0===startAt&&(startAt=this.getCurrentStepNumber()),this.fireEventHandlers("beforeStart",startAt),this.gotoStep(startAt),this.fireEventHandlers("afterStart",startAt),this}},{key:"restartTour",value:function(){return this.startTour(0)}},{key:"endTour",value:function(){if(this.fireEventHandlers("beforeEnd"),this.currentStepConfig){var previousTarget=this.getStepTarget(this.currentStepConfig);previousTarget&&(previousTarget.attr("tabindex")||previousTarget.attr("tabindex","-1"),previousTarget.focus())}return this.hide(!0),this.fireEventHandlers("afterEnd"),this}},{key:"hide",value:function(transition){if(this.fireEventHandlers("beforeHide"),this.currentStepNode&&this.currentStepNode.length&&(this.currentStepNode.hide(),this.currentStepPopper&&this.currentStepPopper.destroy()),this.currentStepConfig){var target=this.getStepTarget(this.currentStepConfig);target&&(target.data("original-labelledby")&&target.attr("aria-labelledby",target.data("original-labelledby")),target.data("original-describedby")&&target.attr("aria-describedby",target.data("original-describedby")),target.data("original-tabindex")&&target.attr("tabindex",target.data("tabindex"))),this.currentStepConfig=null}var fadeTime=0;if(transition&&(fadeTime=400),(0,_jquery.default)('[data-flexitour="step-background"]').remove(),(0,_jquery.default)('[data-flexitour="step-backdrop"]').removeAttr("data-flexitour"),(0,_jquery.default)('[data-flexitour="backdrop"]').fadeOut(fadeTime,(function(){(0,_jquery.default)(this).remove()})),this.currentStepNode&&this.currentStepNode.length){var stepId=this.currentStepNode.attr("id");if(stepId){var currentStepElement='[aria-describedby="'+stepId+'-body"]';(0,_jquery.default)(currentStepElement).removeAttr("tabindex"),(0,_jquery.default)(currentStepElement).removeAttr("aria-describedby")}}return this.resetStepListeners(),this.accessibilityHide(),this.fireEventHandlers("afterHide"),this.currentStepNode=null,this.currentStepPopper=null,this}},{key:"show",value:function(){var startAt=this.getCurrentStepNumber();return this.gotoStep(startAt)}},{key:"getStepContainer",value:function(){return(0,_jquery.default)(this.currentStepNode)}},{key:"calculateScrollTop",value:function(stepConfig){var scrollTop=(0,_jquery.default)(window).scrollTop(),viewportHeight=(0,_jquery.default)(window).height(),targetNode=this.getStepTarget(stepConfig);return scrollTop="top"===stepConfig.placement?targetNode.offset().top-viewportHeight/2:"bottom"===stepConfig.placement?targetNode.offset().top+targetNode.height()-viewportHeight/2:targetNode.height()<=.8*viewportHeight?targetNode.offset().top-(viewportHeight-targetNode.height())/2:targetNode.offset().top-.2*viewportHeight,scrollTop=Math.max(0,scrollTop),scrollTop=Math.min((0,_jquery.default)(document).height()-viewportHeight,scrollTop),Math.ceil(scrollTop)}},{key:"calculateStepPositionInPage",value:function(){var viewportHeight=(0,_jquery.default)(window).height(),stepHeight=this.currentStepNode.height(),viewportWidth=(0,_jquery.default)(window).width(),stepWidth=this.currentStepNode.width();return{top:Math.ceil((viewportHeight-stepHeight)/2),left:Math.ceil((viewportWidth-stepWidth)/2)}}},{key:"positionStep",value:function(stepConfig){var flipBehavior,content=this.currentStepNode;if(!content||!content.length)return this;switch(stepConfig.placement){case"left":flipBehavior=["left","right","top","bottom"];break;case"right":flipBehavior=["right","left","top","bottom"];break;case"top":flipBehavior=["top","bottom","right","left"];break;case"bottom":flipBehavior=["bottom","top","right","left"];break;default:flipBehavior="flip"}var target=this.getStepTarget(stepConfig),config={placement:stepConfig.placement+"-start",removeOnDestroy:!0,modifiers:{flip:{behaviour:flipBehavior},arrow:{element:'[data-role="arrow"]'}},onCreate:function(data){recalculateArrowPosition(data)},onUpdate:function(data){recalculateArrowPosition(data)}},recalculateArrowPosition=function(data){var placement=data.placement.split("-")[0],isVertical=-1!==["left","right"].indexOf(placement),arrowElement=data.instance.popper.querySelector('[data-role="arrow"]'),stepElement=(0,_jquery.default)(data.instance.popper.querySelector('[data-role="flexitour-step"]'));if(isVertical){var arrowHeight=parseFloat(window.getComputedStyle(arrowElement).height),arrowOffset=parseFloat(window.getComputedStyle(arrowElement).top),popperHeight=parseFloat(window.getComputedStyle(data.instance.popper).height),popperOffset=parseFloat(window.getComputedStyle(data.instance.popper).top),popperBorderWidth=parseFloat(stepElement.css("borderTopWidth")),popperBorderRadiusWidth=2*parseFloat(stepElement.css("borderTopLeftRadius")),arrowPos=arrowOffset+arrowHeight/2,maxPos=popperHeight+popperOffset-popperBorderWidth-popperBorderRadiusWidth,minPos=popperOffset+popperBorderWidth+popperBorderRadiusWidth;if(arrowPos>=maxPos||arrowPos<=minPos){var newArrowPos=0;newArrowPos=arrowPos>popperHeight/2?maxPos-arrowHeight:minPos+arrowHeight,(0,_jquery.default)(arrowElement).css("top",newArrowPos)}}else{var arrowWidth=parseFloat(window.getComputedStyle(arrowElement).width),_arrowOffset=parseFloat(window.getComputedStyle(arrowElement).left),popperWidth=parseFloat(window.getComputedStyle(data.instance.popper).width),_popperOffset=parseFloat(window.getComputedStyle(data.instance.popper).left),_popperBorderWidth=parseFloat(stepElement.css("borderTopWidth")),_popperBorderRadiusWidth=2*parseFloat(stepElement.css("borderTopLeftRadius")),_arrowPos=_arrowOffset+arrowWidth/2,_maxPos=popperWidth+_popperOffset-_popperBorderWidth-_popperBorderRadiusWidth,_minPos=_popperOffset+_popperBorderWidth+_popperBorderRadiusWidth;if(_arrowPos>=_maxPos||_arrowPos<=_minPos){var _newArrowPos=0;_newArrowPos=_arrowPos>popperWidth/2?_maxPos-arrowWidth:_minPos+arrowWidth,(0,_jquery.default)(arrowElement).css("left",_newArrowPos)}}},background=(0,_jquery.default)('[data-flexitour="step-background"]');return background.length&&(target=background),this.currentStepPopper=new _popper.default(target,content[0],config),this}},{key:"positionBackdrop",value:function(stepConfig){if(stepConfig.backdrop){this.currentStepConfig.hasBackdrop=!0;var backdrop=(0,_jquery.default)('<div data-flexitour="backdrop"></div>');if(stepConfig.zIndex?"append"===stepConfig.attachPoint?stepConfig.attachTo.append(backdrop):backdrop.insertAfter(stepConfig.attachTo):(0,_jquery.default)("body").append(backdrop),this.isStepActuallyVisible(stepConfig)){var background=(0,_jquery.default)('<div data-flexitour="step-background"></div>'),targetNode=this.getStepTarget(stepConfig),colorNode=targetNode;colorNode=(0,_jquery.default)("body"),background.css({width:targetNode.outerWidth()+10+10,height:targetNode.outerHeight()+10+10,left:targetNode.offset().left-10,top:targetNode.offset().top-10,backgroundColor:this.calculateInherittedBackgroundColor(colorNode)}),targetNode.offset().left<10&&background.css({width:targetNode.outerWidth()+targetNode.offset().left+10,left:targetNode.offset().left}),targetNode.offset().top<10&&background.css({height:targetNode.outerHeight()+targetNode.offset().top+10,top:targetNode.offset().top});var targetRadius=targetNode.css("borderRadius");targetRadius&&targetRadius!==(0,_jquery.default)("body").css("borderRadius")&&background.css("borderRadius",targetRadius);var targetPosition=this.calculatePosition(targetNode);"fixed"===targetPosition?background.css("top",0):"absolute"===targetPosition&&background.css("position","fixed");var fader=background.clone();fader.css({backgroundColor:backdrop.css("backgroundColor"),opacity:backdrop.css("opacity")}),fader.attr("data-flexitour","step-background-fader"),stepConfig.zIndex?"append"===stepConfig.attachPoint?stepConfig.attachTo.append(background):(fader.insertAfter(stepConfig.attachTo),background.insertAfter(stepConfig.attachTo)):((0,_jquery.default)("body").append(fader),(0,_jquery.default)("body").append(background)),targetNode.attr("data-flexitour","step-backdrop"),stepConfig.zIndex&&(backdrop.css("zIndex",stepConfig.zIndex),background.css("zIndex",stepConfig.zIndex+1),targetNode.css("zIndex",stepConfig.zIndex+2)),fader.fadeOut("2000",(function(){(0,_jquery.default)(this).remove()}))}}return this}},{key:"calculateZIndex",value:function(elem){for(elem=(0,_jquery.default)(elem);elem.length&&elem[0]!==document;){var position=elem.css("position");if("absolute"===position||"relative"===position||"fixed"===position){var value=parseInt(elem.css("zIndex"),10);if(!isNaN(value)&&0!==value)return value}elem=elem.parent()}return 0}},{key:"calculateInherittedBackgroundColor",value:function(elem){var fakeNode=(0,_jquery.default)("<div>").hide();(0,_jquery.default)("body").append(fakeNode);var fakeElemColor=fakeNode.css("backgroundColor");for(fakeNode.remove(),elem=(0,_jquery.default)(elem);elem.length&&elem[0]!==document;){var color=elem.css("backgroundColor");if(color!==fakeElemColor)return color;elem=elem.parent()}return null}},{key:"calculatePosition",value:function(elem){for(elem=(0,_jquery.default)(elem);elem.length&&elem[0]!==document;){var position=elem.css("position");if("static"!==position)return position;elem=elem.parent()}return null}},{key:"accessibilityShow",value:function(){var hideFunction=function(child){var flexitourRole=child.data("flexitour");if(flexitourRole)switch(flexitourRole){case"container":case"target":return}child.attr("aria-hidden")||(child.attr("data-has-hidden",!0),child.attr("aria-hidden",!0))};this.currentStepNode.siblings().each((function(index,node){hideFunction((0,_jquery.default)(node))})),this.currentStepNode.parentsUntil("body").siblings().each((function(index,node){hideFunction((0,_jquery.default)(node))}))}},{key:"accessibilityHide",value:function(){(0,_jquery.default)("[data-has-hidden]").each((function(index,node){var child;void 0!==(child=(0,_jquery.default)(node)).attr("data-has-hidden")&&(child.removeAttr("data-has-hidden"),child.removeAttr("aria-hidden"))}))}}],protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Tour}();return _exports.default=Tour,_exports.default}));
define("tool_usertours/managetours",["jquery","core/ajax","core/str","core/notification"],(function($,ajax,str,notification){var manager={removeTour:function(e){e.preventDefault();var targetUrl=$(e.currentTarget).attr("href");str.get_strings([{key:"confirmtourremovaltitle",component:"tool_usertours"},{key:"confirmtourremovalquestion",component:"tool_usertours"},{key:"yes",component:"moodle"},{key:"no",component:"moodle"}]).then((function(s){notification.confirm(s[0],s[1],s[2],s[3],(function(){window.location=targetUrl}))})).catch()},setup:function(){$("body").delegate('[data-action="delete"]',"click",manager.removeTour)}};return{setup:manager.setup}}));
define("tool_usertours/usertours",["core/ajax","tool_usertours/tour","jquery","core/templates","core/str","core/log","core/notification"],(function(ajax,BootstrapTour,$,templates,str,log,notification){var usertours={tourId:null,currentTour:null,context:null,init:function(tourId,startTour,context){usertours.tourId=tourId,usertours.context=context,void 0===startTour&&(startTour=!0),startTour&&usertours.fetchTour(tourId),usertours.addResetLink(),$("body").on("click",'[data-action="tool_usertours/resetpagetour"]',(function(e){e.preventDefault(),usertours.resetTourState(usertours.tourId)}))},fetchTour:function(tourId){M.util.js_pending("admin_usertour_fetchTour"+tourId),$.when(ajax.call([{methodname:"tool_usertours_fetch_and_start_tour",args:{tourid:tourId,context:usertours.context,pageurl:window.location.href}}])[0],templates.render("tool_usertours/tourstep",{})).then((function(response,template){if(response.hasOwnProperty("tourconfig"))return usertours.startBootstrapTour(tourId,template[0],response.tourconfig)})).always((function(){M.util.js_complete("admin_usertour_fetchTour"+tourId)})).fail(notification.exception)},addResetLink:function(){var ele;M.util.js_pending("admin_usertour_addResetLink"),ele=$(".tool_usertours-resettourcontainer").length?$(".tool_usertours-resettourcontainer"):$(".logininfo").length?$(".logininfo"):$("footer").length?$("footer"):$("body"),templates.render("tool_usertours/resettour",{}).then((function(html,js){templates.appendNodeContents(ele,html,js)})).always((function(){M.util.js_complete("admin_usertour_addResetLink")})).fail()},startBootstrapTour:function(tourId,template,tourConfig){return usertours.currentTour&&(tourConfig.onEnd=null,usertours.currentTour.endTour(),delete usertours.currentTour),tourConfig.eventHandlers={afterEnd:[usertours.markTourComplete],afterRender:[usertours.markStepShown]},tourConfig.tourName=tourConfig.name,delete tourConfig.name,tourConfig.template=template,tourConfig.steps=tourConfig.steps.map((function(step){return void 0!==step.element&&(step.target=step.element,delete step.element),void 0!==step.reflex&&(step.moveOnClick=!!step.reflex,delete step.reflex),void 0!==step.content&&(step.body=step.content,delete step.content),step})),usertours.currentTour=new BootstrapTour(tourConfig),usertours.currentTour.startTour()},markStepShown:function(){var stepConfig=this.getStepConfig(this.getCurrentStepNumber());$.when(ajax.call([{methodname:"tool_usertours_step_shown",args:{tourid:usertours.tourId,context:usertours.context,pageurl:window.location.href,stepid:stepConfig.stepid,stepindex:this.getCurrentStepNumber()}}])[0]).fail(log.error)},markTourComplete:function(){var stepConfig=this.getStepConfig(this.getCurrentStepNumber());$.when(ajax.call([{methodname:"tool_usertours_complete_tour",args:{tourid:usertours.tourId,context:usertours.context,pageurl:window.location.href,stepid:stepConfig.stepid,stepindex:this.getCurrentStepNumber()}}])[0]).fail(log.error)},resetTourState:function(tourId){$.when(ajax.call([{methodname:"tool_usertours_reset_tour",args:{tourid:tourId,context:usertours.context,pageurl:window.location.href}}])[0]).then((function(response){response.startTour&&usertours.fetchTour(response.startTour)})).fail(notification.exception)}};return{init:usertours.init,resetTourState:usertours.resetTourState}}));
define("tool_xmldb/move",["jquery","core/sortable_list","core/ajax","core/notification"],(function($,SortableList,Ajax,Notification){return{init:function(tableid,moveaction){var origIndex;new SortableList("#"+tableid+" tbody").getElementName=function(element){return $.Deferred().resolve(element.attr("data-name"))},$("#"+tableid+" tbody tr").on(SortableList.EVENTS.DRAGSTART,(function(_,info){origIndex=info.sourceList.children().index(info.element),setTimeout((function(){$(".sortable-list-is-dragged").width(info.element.width())}),501)})).on(SortableList.EVENTS.DROP,(function(_,info){var newIndex=info.targetList.children().index(info.element),t=info.element.find("[data-action="+moveaction+"]");if(info.positionChanged&&t.length){var request={methodname:"tool_xmldb_invoke_move_action",args:{action:moveaction,dir:t.attr("data-dir"),table:t.attr("data-table"),field:t.attr("data-field"),key:t.attr("data-key"),index:t.attr("data-index"),position:newIndex-origIndex}};Ajax.call([request])[0].fail(Notification.exception)}}))}}}));
function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("theme_boost/loader",["exports","jquery","./aria","./bootstrap/index","core/pending","./scroll","./pending"],(function(_exports,_jquery,Aria,_index,_pending,_scroll,_pending2){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Template renderer for Moodle. Load and render Moodle templates with Mustache.
   *
   * @module     core/templates
   * @package    core
   * @class      templates
   * @copyright  2015 Damyon Wiese <damyon@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   * @since      2.9
   */Object.defineProperty(_exports,"__esModule",{value:!0}),Object.defineProperty(_exports,"Bootstrap",{enumerable:!0,get:function(){return _index.default}}),_jquery=_interopRequireDefault(_jquery),Aria=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Aria),_index=_interopRequireDefault(_index),_pending=_interopRequireDefault(_pending),_scroll=_interopRequireDefault(_scroll),_pending2=_interopRequireDefault(_pending2);var pendingPromise=new _pending.default("theme_boost/loader:init");(0,_pending2.default)(),Aria.init(),function(){(0,_jquery.default)('a[data-toggle="tab"]').on("shown.bs.tab",(function(e){var hash=(0,_jquery.default)(e.target).attr("href");history.replaceState?history.replaceState(null,null,hash):location.hash=hash}));var hash=window.location.hash;if(hash){var tab=document.querySelector('.nav-link[href="'+hash+'"]');tab&&tab.click()}}(),(0,_jquery.default)("body").popover({container:"body",selector:'[data-toggle="popover"]',trigger:"focus"}),document.addEventListener("keydown",(function(e){"Escape"===e.key&&e.target.closest('[data-toggle="popover"]')&&(0,_jquery.default)(e.target).popover("hide")})),(0,_jquery.default)("body").tooltip({container:"body",selector:'[data-toggle="tooltip"]'}),(new _scroll.default).init(),_jquery.default.fn.dropdown.Constructor.Default.flip=!1,pendingPromise.resolve()}));
define("theme_boost/aria",["exports","core/key_codes","jquery","core/pending"],(function(_exports,_key_codes,_jquery,_pending){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Enhancements to Bootstrap components for accessibility.
   *
   * @module     theme_boost/aria
   * @copyright  2018 Damyon Wiese <damyon@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_pending=_interopRequireDefault(_pending);var dropdownFix=function(){var focusEnd=!1;document.addEventListener("keydown",(function(e){if(e.target.matches('[data-toggle="dropdown"]')){var trigger=e.which;trigger==_key_codes.arrowUp&&(focusEnd=!0),trigger!=_key_codes.space&&trigger!=_key_codes.enter||(e.preventDefault(),e.target.click())}}));var shiftFocus=function(element){setTimeout((function(pendingPromise){element.focus(),pendingPromise.resolve()}),50,new _pending.default("core/aria:delayed-focus"))};(0,_jquery.default)(".dropdown").on("shown.bs.dropdown",(function(e){var result,menu=e.target.querySelector('[role="menu"]'),menuItems=!1,foundMenuItem=!1;menu&&(menuItems=menu.querySelectorAll('[role="menuitem"]')),menuItems&&menuItems.length>0&&(result=focusEnd,focusEnd=!1,foundMenuItem=result?menuItems[menuItems.length-1]:menuItems[0]),foundMenuItem&&shiftFocus(foundMenuItem)})),document.addEventListener("keypress",(function(e){if(e.target.matches('.dropdown [role="menu"] [role="menuitem"]')){var trigger=String.fromCharCode(e.which).toLowerCase(),menu=e.target.closest('[role="menu"]');if(!menu)return;var menuItems=menu.querySelectorAll('[role="menuitem"]');if(!menuItems)return;for(var i=0;i<menuItems.length;i++){var item=menuItems[i];if(0==item.text.trim().toLowerCase().indexOf(trigger)){shiftFocus(item);break}}}})),document.addEventListener("keydown",(function(e){if(e.target.matches('.dropdown [role="menu"] [role="menuitem"]')){var trigger=e.which,next=!1,menu=e.target.closest('[role="menu"]');if(!menu)return;var menuItems=menu.querySelectorAll('[role="menuitem"]');if(!menuItems)return;if(trigger==_key_codes.arrowDown){for(var i=0;i<menuItems.length-1;i++)if(menuItems[i]==e.target){next=menuItems[i+1];break}next||(next=menuItems[0])}else if(trigger==_key_codes.arrowUp){for(var _i=1;_i<menuItems.length;_i++)if(menuItems[_i]==e.target){next=menuItems[_i-1];break}next||(next=menuItems[menuItems.length-1])}else trigger==_key_codes.home?next=menuItems[0]:trigger==_key_codes.end&&(next=menuItems[menuItems.length-1]);next&&(e.preventDefault(),shiftFocus(next))}else;})),(0,_jquery.default)(".dropdown").on("hidden.bs.dropdown",(function(e){var trigger=e.target.querySelector('[data-toggle="dropdown"]');trigger&&shiftFocus(trigger)}))},tabElementFix=function(){document.addEventListener("keydown",(function(e){[_key_codes.arrowUp,_key_codes.arrowDown,_key_codes.arrowLeft,_key_codes.arrowRight,_key_codes.home,_key_codes.end,_key_codes.enter,_key_codes.space].includes(e.keyCode)&&e.target.matches('[role="tablist"] [role="tab"]')&&function(e){for(var tabList=e.target.closest('[role="tablist"]'),vertical="vertical"==tabList.getAttribute("aria-orientation"),rtl=window.right_to_left(),arrowNext=vertical?_key_codes.arrowDown:rtl?_key_codes.arrowLeft:_key_codes.arrowRight,arrowPrevious=vertical?_key_codes.arrowUp:rtl?_key_codes.arrowRight:_key_codes.arrowLeft,tabs=Array.prototype.filter.call(tabList.querySelectorAll('[role="tab"]'),(function(tab){return"none"!==getComputedStyle(tab).display})),i=0;i<tabs.length;i++)tabs[i].index=i;switch(e.keyCode){case arrowNext:e.preventDefault(),void 0!==e.target.index&&tabs[e.target.index+1]?tabs[e.target.index+1].focus():tabs[0].focus();break;case arrowPrevious:e.preventDefault(),void 0!==e.target.index&&tabs[e.target.index-1]?tabs[e.target.index-1].focus():tabs[tabs.length-1].focus();break;case _key_codes.home:e.preventDefault(),tabs[0].focus();break;case _key_codes.end:e.preventDefault(),tabs[tabs.length-1].focus();break;case _key_codes.enter:case _key_codes.space:e.preventDefault(),(0,_jquery.default)(e.target).tab("show"),tabs.forEach((function(tab){tab.tabIndex=-1})),e.target.tabIndex=0}}(e)})),document.addEventListener("click",(function(e){if(e.target.matches('[role="tablist"] [role="tab"]')){var tabs=e.target.closest('[role="tablist"]').querySelectorAll('[role="tab"]');e.preventDefault(),(0,_jquery.default)(e.target).tab("show"),tabs.forEach((function(tab){tab.tabIndex=-1})),e.target.tabIndex=0}}))};_exports.init=function(){dropdownFix(),window.addEventListener("load",(function(){var alerts=document.querySelectorAll('[data-aria-autofocus="true"][role="alert"]');Array.prototype.forEach.call(alerts,(function(autofocusElement){autofocusElement.innerHTML+=" ",autofocusElement.removeAttribute("data-aria-autofocus")}))})),tabElementFix()}}));
/**
 * Contain the logic for a drawer.
 *
 * @package    theme_boost
 * @copyright  2016 Damyon Wiese
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("theme_boost/drawer",["jquery","core/custom_interaction_events","core/log","core/pubsub"],(function($,CustomEvents,Log,PubSub){var SELECTORS_TOGGLE_REGION='[data-region="drawer-toggle"]',SELECTORS_TOGGLE_ACTION='[data-action="toggle-drawer"]',SELECTORS_BODY="body",SELECTORS_SECTION='.list-group-item[href*="#section-"]',SELECTORS_DRAWER="#nav-drawer",small=$(document).width()<768,Drawer=function(){$(SELECTORS_TOGGLE_REGION).length||Log.debug("Page is missing a drawer region"),$(SELECTORS_TOGGLE_ACTION).length||Log.debug("Page is missing a drawer toggle link"),$(SELECTORS_TOGGLE_REGION).each(function(index,ele){var trigger=$(ele).find(SELECTORS_TOGGLE_ACTION),drawerid=trigger.attr("aria-controls"),drawer=$(document.getElementById(drawerid)),hidden="false"==trigger.attr("aria-expanded"),side=trigger.attr("data-side"),body=$(SELECTORS_BODY),preference=trigger.attr("data-preference");small&&M.util.set_user_preference(preference,"false"),drawer.on("mousewheel DOMMouseScroll",this.preventPageScroll),hidden?trigger.attr("aria-expanded","false"):(body.addClass("drawer-open-"+side),trigger.attr("aria-expanded","true"))}.bind(this)),this.registerEventListeners(),small&&this.closeAll()};return Drawer.prototype.closeAll=function(){$(SELECTORS_TOGGLE_REGION).each((function(index,ele){var trigger=$(ele).find(SELECTORS_TOGGLE_ACTION),side=trigger.attr("data-side"),body=$(SELECTORS_BODY),drawerid=trigger.attr("aria-controls"),drawer=$(document.getElementById(drawerid)),preference=trigger.attr("data-preference");trigger.attr("aria-expanded","false"),body.removeClass("drawer-open-"+side),drawer.attr("aria-hidden","true"),drawer.addClass("closed"),small||M.util.set_user_preference(preference,"false")}))},Drawer.prototype.toggleDrawer=function(e){var trigger=$(e.target).closest("[data-action=toggle-drawer]"),drawerid=trigger.attr("aria-controls"),drawer=$(document.getElementById(drawerid)),body=$(SELECTORS_BODY),side=trigger.attr("data-side"),preference=trigger.attr("data-preference");small&&M.util.set_user_preference(preference,"false"),body.addClass("drawer-ease");var open="true"==trigger.attr("aria-expanded");open?(body.removeClass("drawer-open-"+side),trigger.attr("aria-expanded","false"),drawer.addClass("closed").delay(500).queue((function(){$(this).hasClass("closed")&&$(this).attr("aria-hidden","true"),$(this).dequeue()})),small||M.util.set_user_preference(preference,"false")):(trigger.attr("aria-expanded","true"),drawer.attr("aria-hidden","false"),drawer.focus(),body.addClass("drawer-open-"+side),drawer.removeClass("closed"),small||M.util.set_user_preference(preference,"true")),PubSub.publish("nav-drawer-toggle-start",open)},Drawer.prototype.preventPageScroll=function(e){var delta=e.wheelDelta||e.originalEvent&&e.originalEvent.wheelDelta||-e.originalEvent.detail,bottomOverflow=this.scrollTop+$(this).outerHeight()-this.scrollHeight>=0,topOverflow=this.scrollTop<=0;(delta<0&&bottomOverflow||delta>0&&topOverflow)&&e.preventDefault()},Drawer.prototype.registerEventListeners=function(){$(SELECTORS_TOGGLE_ACTION).each(function(index,element){CustomEvents.define($(element),[CustomEvents.events.activate]),$(element).on(CustomEvents.events.activate,function(e,data){this.toggleDrawer(data.originalEvent),data.originalEvent.preventDefault()}.bind(this))}.bind(this)),$(SELECTORS_SECTION).click(function(){small&&this.closeAll()}.bind(this)),$(SELECTORS_DRAWER).on("webkitTransitionEnd msTransitionEnd transitionend",(function(e){var open="false"==$(e.target).closest(SELECTORS_DRAWER).attr("aria-hidden");PubSub.publish("nav-drawer-toggle-end",open)}))},{init:function(){return new Drawer}}}));
define("theme_boost/scroll",["exports"],(function(_exports){function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;
/**
   * Manage user scroll in Moodle for future floating elements.
   *
   * @copyright  2020 Ferran Recio <ferran@moodle.org>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
var MoodleScroll=function(){function MoodleScroll(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MoodleScroll)}var Constructor,protoProps,staticProps;return Constructor=MoodleScroll,(protoProps=[{key:"init",value:function(){return this.scrollY=0,window.addEventListener("scroll",this.scrollHandler.bind(this)),this}},{key:"getScrollPosition",value:function(){return window.pageYOffset||document.documentElement.scrollTop}},{key:"scrollHandler",value:function(){var body=document.querySelector("body");this.getScrollPosition()>=window.innerHeight?body.classList.add("scrolled"):body.classList.remove("scrolled")}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),MoodleScroll}();return _exports.default=MoodleScroll,_exports.default}));
/**
 * Custom form error event handler to manipulate the bootstrap markup and show
 * nicely styled errors in an mform.
 *
 * @module     theme_boost/form-display-errors
 * @copyright  2016 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("theme_boost/form-display-errors",["jquery","core/event"],(function($,Event){return{enhance:function(elementid){var element=document.getElementById(elementid);if(element){$(element).on(Event.Events.FORM_FIELD_VALIDATION,(function(event,msg){event.preventDefault();var parent=$(element).closest(".form-group"),feedback=parent.find(".form-control-feedback"),feedbackId=feedback.attr("id"),describedBy=$(element).attr("aria-describedby");void 0===describedBy&&(describedBy="");var describedByIds=[];describedBy.length&&(describedByIds=describedBy.split(" "));var feedbackIndex=describedByIds.indexOf(feedbackId);"TEXTAREA"==$(element).prop("tagName")&&parent.find("[contenteditable]")&&(element=parent.find("[contenteditable]")),""!==msg?(parent.addClass("has-danger"),parent.data("client-validation-error",!0),$(element).addClass("is-invalid"),-1===feedbackIndex&&(describedByIds.push(feedbackId),$(element).attr("aria-describedby",describedByIds.join(" "))),$(element).attr("aria-invalid",!0),feedback.attr("tabindex",0),feedback.html(msg),feedback.is(":visible")||(feedback.show(),feedback.focus())):!0===parent.data("client-validation-error")&&(parent.removeClass("has-danger"),parent.data("client-validation-error",!1),$(element).removeClass("is-invalid"),feedbackIndex>-1&&describedByIds.splice(feedbackIndex,1),describedByIds.length?(describedBy=describedByIds.join(" "),$(element).attr("aria-describedby",describedBy)):$(element).removeAttr("aria-describedby"),$(element).attr("aria-invalid",!1),feedback.hide())}));var form=element.closest("form");form&&!("boostFormErrorsEnhanced"in form.dataset)&&(form.addEventListener("submit",(function(){var visibleError=$(".form-control-feedback:visible");visibleError.length&&visibleError[0].focus()})),form.dataset.boostFormErrorsEnhanced=1)}}}}));
define("theme_boost/toast",["exports","./bootstrap/toast"],(function(_exports,_toast){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),Object.defineProperty(_exports,"Toast",{enumerable:!0,get:function(){return _toast.default}}),_toast=(obj=_toast)&&obj.__esModule?obj:{default:obj}}));
define("theme_boost/bootstrap/alert",["exports","jquery","./util"],(function(_exports,_jquery,_util){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_util=_interopRequireDefault(_util);var EVENT_KEY=".".concat("bs.alert"),JQUERY_NO_CONFLICT=_jquery.default.fn.alert,EVENT_CLOSE="close".concat(EVENT_KEY),EVENT_CLOSED="closed".concat(EVENT_KEY),EVENT_CLICK_DATA_API="click".concat(EVENT_KEY).concat(".data-api"),Alert=function(){function Alert(element){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Alert),this._element=element}var Constructor,protoProps,staticProps;return Constructor=Alert,staticProps=[{key:"VERSION",get:function(){return"4.5.0"}},{key:"_jQueryInterface",value:function(config){return this.each((function(){var $element=(0,_jquery.default)(this),data=$element.data("bs.alert");data||(data=new Alert(this),$element.data("bs.alert",data)),"close"===config&&data[config](this)}))}},{key:"_handleDismiss",value:function(alertInstance){return function(event){event&&event.preventDefault(),alertInstance.close(this)}}}],(protoProps=[{key:"close",value:function(element){var rootElement=this._element;element&&(rootElement=this._getRootElement(element)),this._triggerCloseEvent(rootElement).isDefaultPrevented()||this._removeElement(rootElement)}},{key:"dispose",value:function(){_jquery.default.removeData(this._element,"bs.alert"),this._element=null}},{key:"_getRootElement",value:function(element){var selector=_util.default.getSelectorFromElement(element),parent=!1;return selector&&(parent=document.querySelector(selector)),parent||(parent=(0,_jquery.default)(element).closest(".".concat("alert"))[0]),parent}},{key:"_triggerCloseEvent",value:function(element){var closeEvent=_jquery.default.Event(EVENT_CLOSE);return(0,_jquery.default)(element).trigger(closeEvent),closeEvent}},{key:"_removeElement",value:function(element){var _this=this;if((0,_jquery.default)(element).removeClass("show"),(0,_jquery.default)(element).hasClass("fade")){var transitionDuration=_util.default.getTransitionDurationFromElement(element);(0,_jquery.default)(element).one(_util.default.TRANSITION_END,(function(event){return _this._destroyElement(element,event)})).emulateTransitionEnd(transitionDuration)}else this._destroyElement(element)}},{key:"_destroyElement",value:function(element){(0,_jquery.default)(element).detach().trigger(EVENT_CLOSED).remove()}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Alert}();(0,_jquery.default)(document).on(EVENT_CLICK_DATA_API,'[data-dismiss="alert"]',Alert._handleDismiss(new Alert)),_jquery.default.fn.alert=Alert._jQueryInterface,_jquery.default.fn.alert.Constructor=Alert,_jquery.default.fn.alert.noConflict=function(){return _jquery.default.fn.alert=JQUERY_NO_CONFLICT,Alert._jQueryInterface};var _default=Alert;return _exports.default=_default,_exports.default}));
define("theme_boost/bootstrap/tab",["exports","jquery","./util"],(function(_exports,_jquery,_util){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_util=_interopRequireDefault(_util);var EVENT_KEY=".".concat("bs.tab"),JQUERY_NO_CONFLICT=_jquery.default.fn.tab,EVENT_HIDE="hide".concat(EVENT_KEY),EVENT_HIDDEN="hidden".concat(EVENT_KEY),EVENT_SHOW="show".concat(EVENT_KEY),EVENT_SHOWN="shown".concat(EVENT_KEY),EVENT_CLICK_DATA_API="click".concat(EVENT_KEY).concat(".data-api"),Tab=function(){function Tab(element){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Tab),this._element=element}var Constructor,protoProps,staticProps;return Constructor=Tab,staticProps=[{key:"VERSION",get:function(){return"4.5.0"}},{key:"_jQueryInterface",value:function(config){return this.each((function(){var $this=(0,_jquery.default)(this),data=$this.data("bs.tab");if(data||(data=new Tab(this),$this.data("bs.tab",data)),"string"==typeof config){if(void 0===data[config])throw new TypeError('No method named "'.concat(config,'"'));data[config]()}}))}}],(protoProps=[{key:"show",value:function(){var _this=this;if(!(this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE&&(0,_jquery.default)(this._element).hasClass("active")||(0,_jquery.default)(this._element).hasClass("disabled"))){var target,previous,listElement=(0,_jquery.default)(this._element).closest(".nav, .list-group")[0],selector=_util.default.getSelectorFromElement(this._element);if(listElement){var itemSelector="UL"===listElement.nodeName||"OL"===listElement.nodeName?"> li > .active":".active";previous=(previous=_jquery.default.makeArray((0,_jquery.default)(listElement).find(itemSelector)))[previous.length-1]}var hideEvent=_jquery.default.Event(EVENT_HIDE,{relatedTarget:this._element}),showEvent=_jquery.default.Event(EVENT_SHOW,{relatedTarget:previous});if(previous&&(0,_jquery.default)(previous).trigger(hideEvent),(0,_jquery.default)(this._element).trigger(showEvent),!showEvent.isDefaultPrevented()&&!hideEvent.isDefaultPrevented()){selector&&(target=document.querySelector(selector)),this._activate(this._element,listElement);var complete=function(){var hiddenEvent=_jquery.default.Event(EVENT_HIDDEN,{relatedTarget:_this._element}),shownEvent=_jquery.default.Event(EVENT_SHOWN,{relatedTarget:previous});(0,_jquery.default)(previous).trigger(hiddenEvent),(0,_jquery.default)(_this._element).trigger(shownEvent)};target?this._activate(target,target.parentNode,complete):complete()}}}},{key:"dispose",value:function(){_jquery.default.removeData(this._element,"bs.tab"),this._element=null}},{key:"_activate",value:function(element,container,callback){var _this2=this,active=(!container||"UL"!==container.nodeName&&"OL"!==container.nodeName?(0,_jquery.default)(container).children(".active"):(0,_jquery.default)(container).find("> li > .active"))[0],isTransitioning=callback&&active&&(0,_jquery.default)(active).hasClass("fade"),complete=function(){return _this2._transitionComplete(element,active,callback)};if(active&&isTransitioning){var transitionDuration=_util.default.getTransitionDurationFromElement(active);(0,_jquery.default)(active).removeClass("show").one(_util.default.TRANSITION_END,complete).emulateTransitionEnd(transitionDuration)}else complete()}},{key:"_transitionComplete",value:function(element,active,callback){if(active){(0,_jquery.default)(active).removeClass("active");var dropdownChild=(0,_jquery.default)(active.parentNode).find("> .dropdown-menu .active")[0];dropdownChild&&(0,_jquery.default)(dropdownChild).removeClass("active"),"tab"===active.getAttribute("role")&&active.setAttribute("aria-selected",!1)}if((0,_jquery.default)(element).addClass("active"),"tab"===element.getAttribute("role")&&element.setAttribute("aria-selected",!0),_util.default.reflow(element),element.classList.contains("fade")&&element.classList.add("show"),element.parentNode&&(0,_jquery.default)(element.parentNode).hasClass("dropdown-menu")){var dropdownElement=(0,_jquery.default)(element).closest(".dropdown")[0];if(dropdownElement){var dropdownToggleList=[].slice.call(dropdownElement.querySelectorAll(".dropdown-toggle"));(0,_jquery.default)(dropdownToggleList).addClass("active")}element.setAttribute("aria-expanded",!0)}callback&&callback()}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Tab}();(0,_jquery.default)(document).on(EVENT_CLICK_DATA_API,'[data-toggle="tab"], [data-toggle="pill"], [data-toggle="list"]',(function(event){event.preventDefault(),Tab._jQueryInterface.call((0,_jquery.default)(this),"show")})),_jquery.default.fn.tab=Tab._jQueryInterface,_jquery.default.fn.tab.Constructor=Tab,_jquery.default.fn.tab.noConflict=function(){return _jquery.default.fn.tab=JQUERY_NO_CONFLICT,Tab._jQueryInterface};var _default=Tab;return _exports.default=_default,_exports.default}));
define("theme_boost/bootstrap/collapse",["exports","jquery","./util"],(function(_exports,_jquery,_util){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_util=_interopRequireDefault(_util);var NAME="collapse",DATA_KEY="bs.collapse",EVENT_KEY=".".concat(DATA_KEY),JQUERY_NO_CONFLICT=_jquery.default.fn[NAME],Default={toggle:!0,parent:""},DefaultType={toggle:"boolean",parent:"(string|element)"},EVENT_SHOW="show".concat(EVENT_KEY),EVENT_SHOWN="shown".concat(EVENT_KEY),EVENT_HIDE="hide".concat(EVENT_KEY),EVENT_HIDDEN="hidden".concat(EVENT_KEY),EVENT_CLICK_DATA_API="click".concat(EVENT_KEY).concat(".data-api"),Collapse=function(){function Collapse(element,config){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Collapse),this._isTransitioning=!1,this._element=element,this._config=this._getConfig(config),this._triggerArray=[].slice.call(document.querySelectorAll('[data-toggle="collapse"][href="#'.concat(element.id,'"],')+'[data-toggle="collapse"][data-target="#'.concat(element.id,'"]')));for(var toggleList=[].slice.call(document.querySelectorAll('[data-toggle="collapse"]')),i=0,len=toggleList.length;i<len;i++){var elem=toggleList[i],selector=_util.default.getSelectorFromElement(elem),filterElement=[].slice.call(document.querySelectorAll(selector)).filter((function(foundElem){return foundElem===element}));null!==selector&&filterElement.length>0&&(this._selector=selector,this._triggerArray.push(elem))}this._parent=this._config.parent?this._getParent():null,this._config.parent||this._addAriaAndCollapsedClass(this._element,this._triggerArray),this._config.toggle&&this.toggle()}var Constructor,protoProps,staticProps;return Constructor=Collapse,staticProps=[{key:"VERSION",get:function(){return"4.5.0"}},{key:"Default",get:function(){return Default}},{key:"_getTargetFromElement",value:function(element){var selector=_util.default.getSelectorFromElement(element);return selector?document.querySelector(selector):null}},{key:"_jQueryInterface",value:function(config){return this.each((function(){var $this=(0,_jquery.default)(this),data=$this.data(DATA_KEY),_config=_objectSpread(_objectSpread(_objectSpread({},Default),$this.data()),"object"===_typeof(config)&&config?config:{});if(!data&&_config.toggle&&"string"==typeof config&&/show|hide/.test(config)&&(_config.toggle=!1),data||(data=new Collapse(this,_config),$this.data(DATA_KEY,data)),"string"==typeof config){if(void 0===data[config])throw new TypeError('No method named "'.concat(config,'"'));data[config]()}}))}}],(protoProps=[{key:"toggle",value:function(){(0,_jquery.default)(this._element).hasClass("show")?this.hide():this.show()}},{key:"show",value:function(){var actives,activesData,_this=this;if(!(this._isTransitioning||(0,_jquery.default)(this._element).hasClass("show")||(this._parent&&0===(actives=[].slice.call(this._parent.querySelectorAll(".show, .collapsing")).filter((function(elem){return"string"==typeof _this._config.parent?elem.getAttribute("data-parent")===_this._config.parent:elem.classList.contains("collapse")}))).length&&(actives=null),actives&&(activesData=(0,_jquery.default)(actives).not(this._selector).data(DATA_KEY))&&activesData._isTransitioning))){var startEvent=_jquery.default.Event(EVENT_SHOW);if((0,_jquery.default)(this._element).trigger(startEvent),!startEvent.isDefaultPrevented()){actives&&(Collapse._jQueryInterface.call((0,_jquery.default)(actives).not(this._selector),"hide"),activesData||(0,_jquery.default)(actives).data(DATA_KEY,null));var dimension=this._getDimension();(0,_jquery.default)(this._element).removeClass("collapse").addClass("collapsing"),this._element.style[dimension]=0,this._triggerArray.length&&(0,_jquery.default)(this._triggerArray).removeClass("collapsed").attr("aria-expanded",!0),this.setTransitioning(!0);var capitalizedDimension=dimension[0].toUpperCase()+dimension.slice(1),scrollSize="scroll".concat(capitalizedDimension),transitionDuration=_util.default.getTransitionDurationFromElement(this._element);(0,_jquery.default)(this._element).one(_util.default.TRANSITION_END,(function(){(0,_jquery.default)(_this._element).removeClass("collapsing").addClass("".concat("collapse"," ").concat("show")),_this._element.style[dimension]="",_this.setTransitioning(!1),(0,_jquery.default)(_this._element).trigger(EVENT_SHOWN)})).emulateTransitionEnd(transitionDuration),this._element.style[dimension]="".concat(this._element[scrollSize],"px")}}}},{key:"hide",value:function(){var _this2=this;if(!this._isTransitioning&&(0,_jquery.default)(this._element).hasClass("show")){var startEvent=_jquery.default.Event(EVENT_HIDE);if((0,_jquery.default)(this._element).trigger(startEvent),!startEvent.isDefaultPrevented()){var dimension=this._getDimension();this._element.style[dimension]="".concat(this._element.getBoundingClientRect()[dimension],"px"),_util.default.reflow(this._element),(0,_jquery.default)(this._element).addClass("collapsing").removeClass("".concat("collapse"," ").concat("show"));var triggerArrayLength=this._triggerArray.length;if(triggerArrayLength>0)for(var i=0;i<triggerArrayLength;i++){var trigger=this._triggerArray[i],selector=_util.default.getSelectorFromElement(trigger);null!==selector&&((0,_jquery.default)([].slice.call(document.querySelectorAll(selector))).hasClass("show")||(0,_jquery.default)(trigger).addClass("collapsed").attr("aria-expanded",!1))}this.setTransitioning(!0),this._element.style[dimension]="";var transitionDuration=_util.default.getTransitionDurationFromElement(this._element);(0,_jquery.default)(this._element).one(_util.default.TRANSITION_END,(function(){_this2.setTransitioning(!1),(0,_jquery.default)(_this2._element).removeClass("collapsing").addClass("collapse").trigger(EVENT_HIDDEN)})).emulateTransitionEnd(transitionDuration)}}}},{key:"setTransitioning",value:function(isTransitioning){this._isTransitioning=isTransitioning}},{key:"dispose",value:function(){_jquery.default.removeData(this._element,DATA_KEY),this._config=null,this._parent=null,this._element=null,this._triggerArray=null,this._isTransitioning=null}},{key:"_getConfig",value:function(config){return(config=_objectSpread(_objectSpread({},Default),config)).toggle=Boolean(config.toggle),_util.default.typeCheckConfig(NAME,config,DefaultType),config}},{key:"_getDimension",value:function(){return(0,_jquery.default)(this._element).hasClass("width")?"width":"height"}},{key:"_getParent",value:function(){var parent,_this3=this;_util.default.isElement(this._config.parent)?(parent=this._config.parent,void 0!==this._config.parent.jquery&&(parent=this._config.parent[0])):parent=document.querySelector(this._config.parent);var selector='[data-toggle="collapse"][data-parent="'.concat(this._config.parent,'"]'),children=[].slice.call(parent.querySelectorAll(selector));return(0,_jquery.default)(children).each((function(i,element){_this3._addAriaAndCollapsedClass(Collapse._getTargetFromElement(element),[element])})),parent}},{key:"_addAriaAndCollapsedClass",value:function(element,triggerArray){var isOpen=(0,_jquery.default)(element).hasClass("show");triggerArray.length&&(0,_jquery.default)(triggerArray).toggleClass("collapsed",!isOpen).attr("aria-expanded",isOpen)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Collapse}();(0,_jquery.default)(document).on(EVENT_CLICK_DATA_API,'[data-toggle="collapse"]',(function(event){"A"===event.currentTarget.tagName&&event.preventDefault();var $trigger=(0,_jquery.default)(this),selector=_util.default.getSelectorFromElement(this),selectors=[].slice.call(document.querySelectorAll(selector));(0,_jquery.default)(selectors).each((function(){var $target=(0,_jquery.default)(this),config=$target.data(DATA_KEY)?"toggle":$trigger.data();Collapse._jQueryInterface.call($target,config)}))})),_jquery.default.fn[NAME]=Collapse._jQueryInterface,_jquery.default.fn[NAME].Constructor=Collapse,_jquery.default.fn[NAME].noConflict=function(){return _jquery.default.fn[NAME]=JQUERY_NO_CONFLICT,Collapse._jQueryInterface};var _default=Collapse;return _exports.default=_default,_exports.default}));
define("theme_boost/bootstrap/button",["exports","jquery"],(function(_exports,_jquery){var obj;function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};var NAME="button",EVENT_KEY=".".concat("bs.button"),JQUERY_NO_CONFLICT=_jquery.default.fn[NAME],EVENT_CLICK_DATA_API="click".concat(EVENT_KEY).concat(".data-api"),EVENT_FOCUS_BLUR_DATA_API="focus".concat(EVENT_KEY).concat(".data-api"," ")+"blur".concat(EVENT_KEY).concat(".data-api"),EVENT_LOAD_DATA_API="load".concat(EVENT_KEY).concat(".data-api"),Button=function(){function Button(element){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Button),this._element=element}var Constructor,protoProps,staticProps;return Constructor=Button,staticProps=[{key:"VERSION",get:function(){return"4.5.0"}},{key:"_jQueryInterface",value:function(config){return this.each((function(){var data=(0,_jquery.default)(this).data("bs.button");data||(data=new Button(this),(0,_jquery.default)(this).data("bs.button",data)),"toggle"===config&&data[config]()}))}}],(protoProps=[{key:"toggle",value:function(){var triggerChangeEvent=!0,addAriaPressed=!0,rootElement=(0,_jquery.default)(this._element).closest('[data-toggle="buttons"]')[0];if(rootElement){var input=this._element.querySelector('input:not([type="hidden"])');if(input){if("radio"===input.type)if(input.checked&&this._element.classList.contains("active"))triggerChangeEvent=!1;else{var activeElement=rootElement.querySelector(".active");activeElement&&(0,_jquery.default)(activeElement).removeClass("active")}triggerChangeEvent&&("checkbox"!==input.type&&"radio"!==input.type||(input.checked=!this._element.classList.contains("active")),(0,_jquery.default)(input).trigger("change")),input.focus(),addAriaPressed=!1}}this._element.hasAttribute("disabled")||this._element.classList.contains("disabled")||(addAriaPressed&&this._element.setAttribute("aria-pressed",!this._element.classList.contains("active")),triggerChangeEvent&&(0,_jquery.default)(this._element).toggleClass("active"))}},{key:"dispose",value:function(){_jquery.default.removeData(this._element,"bs.button"),this._element=null}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Button}();(0,_jquery.default)(document).on(EVENT_CLICK_DATA_API,'[data-toggle^="button"]',(function(event){var button=event.target,initialButton=button;if((0,_jquery.default)(button).hasClass("btn")||(button=(0,_jquery.default)(button).closest(".btn")[0]),!button||button.hasAttribute("disabled")||button.classList.contains("disabled"))event.preventDefault();else{var inputBtn=button.querySelector('input:not([type="hidden"])');if(inputBtn&&(inputBtn.hasAttribute("disabled")||inputBtn.classList.contains("disabled")))return void event.preventDefault();"LABEL"===initialButton.tagName&&inputBtn&&"checkbox"===inputBtn.type&&event.preventDefault(),Button._jQueryInterface.call((0,_jquery.default)(button),"toggle")}})).on(EVENT_FOCUS_BLUR_DATA_API,'[data-toggle^="button"]',(function(event){var button=(0,_jquery.default)(event.target).closest(".btn")[0];(0,_jquery.default)(button).toggleClass("focus",/^focus(in)?$/.test(event.type))})),(0,_jquery.default)(window).on(EVENT_LOAD_DATA_API,(function(){for(var buttons=[].slice.call(document.querySelectorAll('[data-toggle="buttons"] .btn')),i=0,len=buttons.length;i<len;i++){var button=buttons[i],input=button.querySelector('input:not([type="hidden"])');input.checked||input.hasAttribute("checked")?button.classList.add("active"):button.classList.remove("active")}for(var _i=0,_len=(buttons=[].slice.call(document.querySelectorAll('[data-toggle="button"]'))).length;_i<_len;_i++){var _button=buttons[_i];"true"===_button.getAttribute("aria-pressed")?_button.classList.add("active"):_button.classList.remove("active")}})),_jquery.default.fn[NAME]=Button._jQueryInterface,_jquery.default.fn[NAME].Constructor=Button,_jquery.default.fn[NAME].noConflict=function(){return _jquery.default.fn[NAME]=JQUERY_NO_CONFLICT,Button._jQueryInterface};var _default=Button;return _exports.default=_default,_exports.default}));
define("theme_boost/bootstrap/toast",["exports","jquery","./util"],(function(_exports,_jquery,_util){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_util=_interopRequireDefault(_util);var NAME="toast",EVENT_KEY=".".concat("bs.toast"),JQUERY_NO_CONFLICT=_jquery.default.fn.toast,EVENT_CLICK_DISMISS="click.dismiss".concat(EVENT_KEY),EVENT_HIDE="hide".concat(EVENT_KEY),EVENT_HIDDEN="hidden".concat(EVENT_KEY),EVENT_SHOW="show".concat(EVENT_KEY),EVENT_SHOWN="shown".concat(EVENT_KEY),DefaultType={animation:"boolean",autohide:"boolean",delay:"number"},Default={animation:!0,autohide:!0,delay:500},Toast=function(){function Toast(element,config){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Toast),this._element=element,this._config=this._getConfig(config),this._timeout=null,this._setListeners()}var Constructor,protoProps,staticProps;return Constructor=Toast,staticProps=[{key:"VERSION",get:function(){return"4.5.0"}},{key:"DefaultType",get:function(){return DefaultType}},{key:"Default",get:function(){return Default}},{key:"_jQueryInterface",value:function(config){return this.each((function(){var $element=(0,_jquery.default)(this),data=$element.data("bs.toast"),_config="object"===_typeof(config)&&config;if(data||(data=new Toast(this,_config),$element.data("bs.toast",data)),"string"==typeof config){if(void 0===data[config])throw new TypeError('No method named "'.concat(config,'"'));data[config](this)}}))}}],(protoProps=[{key:"show",value:function(){var _this=this,showEvent=_jquery.default.Event(EVENT_SHOW);if((0,_jquery.default)(this._element).trigger(showEvent),!showEvent.isDefaultPrevented()){this._config.animation&&this._element.classList.add("fade");var complete=function(){_this._element.classList.remove("showing"),_this._element.classList.add("show"),(0,_jquery.default)(_this._element).trigger(EVENT_SHOWN),_this._config.autohide&&(_this._timeout=setTimeout((function(){_this.hide()}),_this._config.delay))};if(this._element.classList.remove("hide"),_util.default.reflow(this._element),this._element.classList.add("showing"),this._config.animation){var transitionDuration=_util.default.getTransitionDurationFromElement(this._element);(0,_jquery.default)(this._element).one(_util.default.TRANSITION_END,complete).emulateTransitionEnd(transitionDuration)}else complete()}}},{key:"hide",value:function(){if(this._element.classList.contains("show")){var hideEvent=_jquery.default.Event(EVENT_HIDE);(0,_jquery.default)(this._element).trigger(hideEvent),hideEvent.isDefaultPrevented()||this._close()}}},{key:"dispose",value:function(){clearTimeout(this._timeout),this._timeout=null,this._element.classList.contains("show")&&this._element.classList.remove("show"),(0,_jquery.default)(this._element).off(EVENT_CLICK_DISMISS),_jquery.default.removeData(this._element,"bs.toast"),this._element=null,this._config=null}},{key:"_getConfig",value:function(config){return config=_objectSpread(_objectSpread(_objectSpread({},Default),(0,_jquery.default)(this._element).data()),"object"===_typeof(config)&&config?config:{}),_util.default.typeCheckConfig(NAME,config,this.constructor.DefaultType),config}},{key:"_setListeners",value:function(){var _this2=this;(0,_jquery.default)(this._element).on(EVENT_CLICK_DISMISS,'[data-dismiss="toast"]',(function(){return _this2.hide()}))}},{key:"_close",value:function(){var _this3=this,complete=function(){_this3._element.classList.add("hide"),(0,_jquery.default)(_this3._element).trigger(EVENT_HIDDEN)};if(this._element.classList.remove("show"),this._config.animation){var transitionDuration=_util.default.getTransitionDurationFromElement(this._element);(0,_jquery.default)(this._element).one(_util.default.TRANSITION_END,complete).emulateTransitionEnd(transitionDuration)}else complete()}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Toast}();_jquery.default.fn.toast=Toast._jQueryInterface,_jquery.default.fn.toast.Constructor=Toast,_jquery.default.fn.toast.noConflict=function(){return _jquery.default.fn.toast=JQUERY_NO_CONFLICT,Toast._jQueryInterface};var _default=Toast;return _exports.default=_default,_exports.default}));
define("theme_boost/bootstrap/index",["exports","./alert","./button","./carousel","./collapse","./dropdown","./modal","./popover","./scrollspy","./tab","./toast","./tooltip","./util"],(function(_exports,_alert,_button,_carousel,_collapse,_dropdown,_modal,_popover,_scrollspy,_tab,_toast,_tooltip,_util){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),Object.defineProperty(_exports,"Alert",{enumerable:!0,get:function(){return _alert.default}}),Object.defineProperty(_exports,"Button",{enumerable:!0,get:function(){return _button.default}}),Object.defineProperty(_exports,"Carousel",{enumerable:!0,get:function(){return _carousel.default}}),Object.defineProperty(_exports,"Collapse",{enumerable:!0,get:function(){return _collapse.default}}),Object.defineProperty(_exports,"Dropdown",{enumerable:!0,get:function(){return _dropdown.default}}),Object.defineProperty(_exports,"Modal",{enumerable:!0,get:function(){return _modal.default}}),Object.defineProperty(_exports,"Popover",{enumerable:!0,get:function(){return _popover.default}}),Object.defineProperty(_exports,"Scrollspy",{enumerable:!0,get:function(){return _scrollspy.default}}),Object.defineProperty(_exports,"Tab",{enumerable:!0,get:function(){return _tab.default}}),Object.defineProperty(_exports,"Toast",{enumerable:!0,get:function(){return _toast.default}}),Object.defineProperty(_exports,"Tooltip",{enumerable:!0,get:function(){return _tooltip.default}}),Object.defineProperty(_exports,"Util",{enumerable:!0,get:function(){return _util.default}}),_alert=_interopRequireDefault(_alert),_button=_interopRequireDefault(_button),_carousel=_interopRequireDefault(_carousel),_collapse=_interopRequireDefault(_collapse),_dropdown=_interopRequireDefault(_dropdown),_modal=_interopRequireDefault(_modal),_popover=_interopRequireDefault(_popover),_scrollspy=_interopRequireDefault(_scrollspy),_tab=_interopRequireDefault(_tab),_toast=_interopRequireDefault(_toast),_tooltip=_interopRequireDefault(_tooltip),_util=_interopRequireDefault(_util)}));
define("theme_boost/bootstrap/scrollspy",["exports","jquery","./util"],(function(_exports,_jquery,_util){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_util=_interopRequireDefault(_util);var NAME="scrollspy",EVENT_KEY=".".concat("bs.scrollspy"),JQUERY_NO_CONFLICT=_jquery.default.fn[NAME],Default={offset:10,method:"auto",target:""},DefaultType={offset:"number",method:"string",target:"(string|element)"},EVENT_ACTIVATE="activate".concat(EVENT_KEY),EVENT_SCROLL="scroll".concat(EVENT_KEY),EVENT_LOAD_DATA_API="load".concat(EVENT_KEY).concat(".data-api"),ScrollSpy=function(){function ScrollSpy(element,config){var _this=this;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ScrollSpy),this._element=element,this._scrollElement="BODY"===element.tagName?window:element,this._config=this._getConfig(config),this._selector="".concat(this._config.target," ").concat(".nav-link",",")+"".concat(this._config.target," ").concat(".list-group-item",",")+"".concat(this._config.target," ").concat(".dropdown-item"),this._offsets=[],this._targets=[],this._activeTarget=null,this._scrollHeight=0,(0,_jquery.default)(this._scrollElement).on(EVENT_SCROLL,(function(event){return _this._process(event)})),this.refresh(),this._process()}var Constructor,protoProps,staticProps;return Constructor=ScrollSpy,staticProps=[{key:"VERSION",get:function(){return"4.5.0"}},{key:"Default",get:function(){return Default}},{key:"_jQueryInterface",value:function(config){return this.each((function(){var data=(0,_jquery.default)(this).data("bs.scrollspy"),_config="object"===_typeof(config)&&config;if(data||(data=new ScrollSpy(this,_config),(0,_jquery.default)(this).data("bs.scrollspy",data)),"string"==typeof config){if(void 0===data[config])throw new TypeError('No method named "'.concat(config,'"'));data[config]()}}))}}],(protoProps=[{key:"refresh",value:function(){var _this2=this,autoMethod=this._scrollElement===this._scrollElement.window?"offset":"position",offsetMethod="auto"===this._config.method?autoMethod:this._config.method,offsetBase="position"===offsetMethod?this._getScrollTop():0;this._offsets=[],this._targets=[],this._scrollHeight=this._getScrollHeight(),[].slice.call(document.querySelectorAll(this._selector)).map((function(element){var target,targetSelector=_util.default.getSelectorFromElement(element);if(targetSelector&&(target=document.querySelector(targetSelector)),target){var targetBCR=target.getBoundingClientRect();if(targetBCR.width||targetBCR.height)return[(0,_jquery.default)(target)[offsetMethod]().top+offsetBase,targetSelector]}return null})).filter((function(item){return item})).sort((function(a,b){return a[0]-b[0]})).forEach((function(item){_this2._offsets.push(item[0]),_this2._targets.push(item[1])}))}},{key:"dispose",value:function(){_jquery.default.removeData(this._element,"bs.scrollspy"),(0,_jquery.default)(this._scrollElement).off(EVENT_KEY),this._element=null,this._scrollElement=null,this._config=null,this._selector=null,this._offsets=null,this._targets=null,this._activeTarget=null,this._scrollHeight=null}},{key:"_getConfig",value:function(config){if("string"!=typeof(config=_objectSpread(_objectSpread({},Default),"object"===_typeof(config)&&config?config:{})).target&&_util.default.isElement(config.target)){var id=(0,_jquery.default)(config.target).attr("id");id||(id=_util.default.getUID(NAME),(0,_jquery.default)(config.target).attr("id",id)),config.target="#".concat(id)}return _util.default.typeCheckConfig(NAME,config,DefaultType),config}},{key:"_getScrollTop",value:function(){return this._scrollElement===window?this._scrollElement.pageYOffset:this._scrollElement.scrollTop}},{key:"_getScrollHeight",value:function(){return this._scrollElement.scrollHeight||Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}},{key:"_getOffsetHeight",value:function(){return this._scrollElement===window?window.innerHeight:this._scrollElement.getBoundingClientRect().height}},{key:"_process",value:function(){var scrollTop=this._getScrollTop()+this._config.offset,scrollHeight=this._getScrollHeight(),maxScroll=this._config.offset+scrollHeight-this._getOffsetHeight();if(this._scrollHeight!==scrollHeight&&this.refresh(),scrollTop>=maxScroll){var target=this._targets[this._targets.length-1];this._activeTarget!==target&&this._activate(target)}else{if(this._activeTarget&&scrollTop<this._offsets[0]&&this._offsets[0]>0)return this._activeTarget=null,void this._clear();for(var i=this._offsets.length;i--;)this._activeTarget!==this._targets[i]&&scrollTop>=this._offsets[i]&&(void 0===this._offsets[i+1]||scrollTop<this._offsets[i+1])&&this._activate(this._targets[i])}}},{key:"_activate",value:function(target){this._activeTarget=target,this._clear();var queries=this._selector.split(",").map((function(selector){return"".concat(selector,'[data-target="').concat(target,'"],').concat(selector,'[href="').concat(target,'"]')})),$link=(0,_jquery.default)([].slice.call(document.querySelectorAll(queries.join(","))));$link.hasClass("dropdown-item")?($link.closest(".dropdown").find(".dropdown-toggle").addClass("active"),$link.addClass("active")):($link.addClass("active"),$link.parents(".nav, .list-group").prev("".concat(".nav-link",", ").concat(".list-group-item")).addClass("active"),$link.parents(".nav, .list-group").prev(".nav-item").children(".nav-link").addClass("active")),(0,_jquery.default)(this._scrollElement).trigger(EVENT_ACTIVATE,{relatedTarget:target})}},{key:"_clear",value:function(){[].slice.call(document.querySelectorAll(this._selector)).filter((function(node){return node.classList.contains("active")})).forEach((function(node){return node.classList.remove("active")}))}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),ScrollSpy}();(0,_jquery.default)(window).on(EVENT_LOAD_DATA_API,(function(){for(var scrollSpys=[].slice.call(document.querySelectorAll('[data-spy="scroll"]')),i=scrollSpys.length;i--;){var $spy=(0,_jquery.default)(scrollSpys[i]);ScrollSpy._jQueryInterface.call($spy,$spy.data())}})),_jquery.default.fn[NAME]=ScrollSpy._jQueryInterface,_jquery.default.fn[NAME].Constructor=ScrollSpy,_jquery.default.fn[NAME].noConflict=function(){return _jquery.default.fn[NAME]=JQUERY_NO_CONFLICT,ScrollSpy._jQueryInterface};var _default=ScrollSpy;return _exports.default=_default,_exports.default}));
define("theme_boost/bootstrap/tools/sanitizer",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.DefaultWhitelist=void 0,_exports.sanitizeHtml=function(unsafeHtml,whiteList,sanitizeFn){if(0===unsafeHtml.length)return unsafeHtml;if(sanitizeFn&&"function"==typeof sanitizeFn)return sanitizeFn(unsafeHtml);for(var createdDocument=(new window.DOMParser).parseFromString(unsafeHtml,"text/html"),whitelistKeys=Object.keys(whiteList),elements=[].slice.call(createdDocument.body.querySelectorAll("*")),_loop=function(i,len){var el=elements[i],elName=el.nodeName.toLowerCase();if(-1===whitelistKeys.indexOf(el.nodeName.toLowerCase()))return el.parentNode.removeChild(el),"continue";var attributeList=[].slice.call(el.attributes),whitelistedAttributes=[].concat(whiteList["*"]||[],whiteList[elName]||[]);attributeList.forEach((function(attr){(function(attr,allowedAttributeList){var attrName=attr.nodeName.toLowerCase();if(-1!==allowedAttributeList.indexOf(attrName))return-1===uriAttrs.indexOf(attrName)||Boolean(attr.nodeValue.match(SAFE_URL_PATTERN)||attr.nodeValue.match(DATA_URL_PATTERN));for(var regExp=allowedAttributeList.filter((function(attrRegex){return attrRegex instanceof RegExp})),i=0,len=regExp.length;i<len;i++)if(attrName.match(regExp[i]))return!0;return!1})(attr,whitelistedAttributes)||el.removeAttribute(attr.nodeName)}))},i=0,len=elements.length;i<len;i++)_loop(i);return createdDocument.body.innerHTML};var uriAttrs=["background","cite","href","itemtype","longdesc","poster","src","xlink:href"],DefaultWhitelist={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]};_exports.DefaultWhitelist=DefaultWhitelist;var SAFE_URL_PATTERN=/^(?:(?:https?|mailto|ftp|tel|file):|[^#&/:?]*(?:[#/?]|$))/gi,DATA_URL_PATTERN=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[\d+/a-z]+=*$/i}));
define("theme_boost/bootstrap/modal",["exports","jquery","./util"],(function(_exports,_jquery,_util){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_util=_interopRequireDefault(_util);var NAME="modal",EVENT_KEY=".".concat("bs.modal"),JQUERY_NO_CONFLICT=_jquery.default.fn.modal,Default={backdrop:!0,keyboard:!0,focus:!0,show:!0},DefaultType={backdrop:"(boolean|string)",keyboard:"boolean",focus:"boolean",show:"boolean"},EVENT_HIDE="hide".concat(EVENT_KEY),EVENT_HIDE_PREVENTED="hidePrevented".concat(EVENT_KEY),EVENT_HIDDEN="hidden".concat(EVENT_KEY),EVENT_SHOW="show".concat(EVENT_KEY),EVENT_SHOWN="shown".concat(EVENT_KEY),EVENT_FOCUSIN="focusin".concat(EVENT_KEY),EVENT_RESIZE="resize".concat(EVENT_KEY),EVENT_CLICK_DISMISS="click.dismiss".concat(EVENT_KEY),EVENT_KEYDOWN_DISMISS="keydown.dismiss".concat(EVENT_KEY),EVENT_MOUSEUP_DISMISS="mouseup.dismiss".concat(EVENT_KEY),EVENT_MOUSEDOWN_DISMISS="mousedown.dismiss".concat(EVENT_KEY),EVENT_CLICK_DATA_API="click".concat(EVENT_KEY).concat(".data-api"),Modal=function(){function Modal(element,config){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Modal),this._config=this._getConfig(config),this._element=element,this._dialog=element.querySelector(".modal-dialog"),this._backdrop=null,this._isShown=!1,this._isBodyOverflowing=!1,this._ignoreBackdropClick=!1,this._isTransitioning=!1,this._scrollbarWidth=0}var Constructor,protoProps,staticProps;return Constructor=Modal,staticProps=[{key:"VERSION",get:function(){return"4.5.0"}},{key:"Default",get:function(){return Default}},{key:"_jQueryInterface",value:function(config,relatedTarget){return this.each((function(){var data=(0,_jquery.default)(this).data("bs.modal"),_config=_objectSpread(_objectSpread(_objectSpread({},Default),(0,_jquery.default)(this).data()),"object"===_typeof(config)&&config?config:{});if(data||(data=new Modal(this,_config),(0,_jquery.default)(this).data("bs.modal",data)),"string"==typeof config){if(void 0===data[config])throw new TypeError('No method named "'.concat(config,'"'));data[config](relatedTarget)}else _config.show&&data.show(relatedTarget)}))}}],(protoProps=[{key:"toggle",value:function(relatedTarget){return this._isShown?this.hide():this.show(relatedTarget)}},{key:"show",value:function(relatedTarget){var _this=this;if(!this._isShown&&!this._isTransitioning){(0,_jquery.default)(this._element).hasClass("fade")&&(this._isTransitioning=!0);var showEvent=_jquery.default.Event(EVENT_SHOW,{relatedTarget:relatedTarget});(0,_jquery.default)(this._element).trigger(showEvent),this._isShown||showEvent.isDefaultPrevented()||(this._isShown=!0,this._checkScrollbar(),this._setScrollbar(),this._adjustDialog(),this._setEscapeEvent(),this._setResizeEvent(),(0,_jquery.default)(this._element).on(EVENT_CLICK_DISMISS,'[data-dismiss="modal"]',(function(event){return _this.hide(event)})),(0,_jquery.default)(this._dialog).on(EVENT_MOUSEDOWN_DISMISS,(function(){(0,_jquery.default)(_this._element).one(EVENT_MOUSEUP_DISMISS,(function(event){(0,_jquery.default)(event.target).is(_this._element)&&(_this._ignoreBackdropClick=!0)}))})),this._showBackdrop((function(){return _this._showElement(relatedTarget)})))}}},{key:"hide",value:function(event){var _this2=this;if(event&&event.preventDefault(),this._isShown&&!this._isTransitioning){var hideEvent=_jquery.default.Event(EVENT_HIDE);if((0,_jquery.default)(this._element).trigger(hideEvent),this._isShown&&!hideEvent.isDefaultPrevented()){this._isShown=!1;var transition=(0,_jquery.default)(this._element).hasClass("fade");if(transition&&(this._isTransitioning=!0),this._setEscapeEvent(),this._setResizeEvent(),(0,_jquery.default)(document).off(EVENT_FOCUSIN),(0,_jquery.default)(this._element).removeClass("show"),(0,_jquery.default)(this._element).off(EVENT_CLICK_DISMISS),(0,_jquery.default)(this._dialog).off(EVENT_MOUSEDOWN_DISMISS),transition){var transitionDuration=_util.default.getTransitionDurationFromElement(this._element);(0,_jquery.default)(this._element).one(_util.default.TRANSITION_END,(function(event){return _this2._hideModal(event)})).emulateTransitionEnd(transitionDuration)}else this._hideModal()}}}},{key:"dispose",value:function(){[window,this._element,this._dialog].forEach((function(htmlElement){return(0,_jquery.default)(htmlElement).off(EVENT_KEY)})),(0,_jquery.default)(document).off(EVENT_FOCUSIN),_jquery.default.removeData(this._element,"bs.modal"),this._config=null,this._element=null,this._dialog=null,this._backdrop=null,this._isShown=null,this._isBodyOverflowing=null,this._ignoreBackdropClick=null,this._isTransitioning=null,this._scrollbarWidth=null}},{key:"handleUpdate",value:function(){this._adjustDialog()}},{key:"_getConfig",value:function(config){return config=_objectSpread(_objectSpread({},Default),config),_util.default.typeCheckConfig(NAME,config,DefaultType),config}},{key:"_triggerBackdropTransition",value:function(){var _this3=this;if("static"===this._config.backdrop){var hideEventPrevented=_jquery.default.Event(EVENT_HIDE_PREVENTED);if((0,_jquery.default)(this._element).trigger(hideEventPrevented),hideEventPrevented.defaultPrevented)return;this._element.classList.add("modal-static");var modalTransitionDuration=_util.default.getTransitionDurationFromElement(this._element);(0,_jquery.default)(this._element).one(_util.default.TRANSITION_END,(function(){_this3._element.classList.remove("modal-static")})).emulateTransitionEnd(modalTransitionDuration),this._element.focus()}else this.hide()}},{key:"_showElement",value:function(relatedTarget){var _this4=this,transition=(0,_jquery.default)(this._element).hasClass("fade"),modalBody=this._dialog?this._dialog.querySelector(".modal-body"):null;this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE||document.body.appendChild(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),(0,_jquery.default)(this._dialog).hasClass("modal-dialog-scrollable")&&modalBody?modalBody.scrollTop=0:this._element.scrollTop=0,transition&&_util.default.reflow(this._element),(0,_jquery.default)(this._element).addClass("show"),this._config.focus&&this._enforceFocus();var shownEvent=_jquery.default.Event(EVENT_SHOWN,{relatedTarget:relatedTarget}),transitionComplete=function(){_this4._config.focus&&_this4._element.focus(),_this4._isTransitioning=!1,(0,_jquery.default)(_this4._element).trigger(shownEvent)};if(transition){var transitionDuration=_util.default.getTransitionDurationFromElement(this._dialog);(0,_jquery.default)(this._dialog).one(_util.default.TRANSITION_END,transitionComplete).emulateTransitionEnd(transitionDuration)}else transitionComplete()}},{key:"_enforceFocus",value:function(){var _this5=this;(0,_jquery.default)(document).off(EVENT_FOCUSIN).on(EVENT_FOCUSIN,(function(event){document!==event.target&&_this5._element!==event.target&&0===(0,_jquery.default)(_this5._element).has(event.target).length&&_this5._element.focus()}))}},{key:"_setEscapeEvent",value:function(){var _this6=this;this._isShown?(0,_jquery.default)(this._element).on(EVENT_KEYDOWN_DISMISS,(function(event){_this6._config.keyboard&&27===event.which?(event.preventDefault(),_this6.hide()):_this6._config.keyboard||27!==event.which||_this6._triggerBackdropTransition()})):this._isShown||(0,_jquery.default)(this._element).off(EVENT_KEYDOWN_DISMISS)}},{key:"_setResizeEvent",value:function(){var _this7=this;this._isShown?(0,_jquery.default)(window).on(EVENT_RESIZE,(function(event){return _this7.handleUpdate(event)})):(0,_jquery.default)(window).off(EVENT_RESIZE)}},{key:"_hideModal",value:function(){var _this8=this;this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._isTransitioning=!1,this._showBackdrop((function(){(0,_jquery.default)(document.body).removeClass("modal-open"),_this8._resetAdjustments(),_this8._resetScrollbar(),(0,_jquery.default)(_this8._element).trigger(EVENT_HIDDEN)}))}},{key:"_removeBackdrop",value:function(){this._backdrop&&((0,_jquery.default)(this._backdrop).remove(),this._backdrop=null)}},{key:"_showBackdrop",value:function(callback){var _this9=this,animate=(0,_jquery.default)(this._element).hasClass("fade")?"fade":"";if(this._isShown&&this._config.backdrop){if(this._backdrop=document.createElement("div"),this._backdrop.className="modal-backdrop",animate&&this._backdrop.classList.add(animate),(0,_jquery.default)(this._backdrop).appendTo(document.body),(0,_jquery.default)(this._element).on(EVENT_CLICK_DISMISS,(function(event){_this9._ignoreBackdropClick?_this9._ignoreBackdropClick=!1:event.target===event.currentTarget&&_this9._triggerBackdropTransition()})),animate&&_util.default.reflow(this._backdrop),(0,_jquery.default)(this._backdrop).addClass("show"),!callback)return;if(!animate)return void callback();var backdropTransitionDuration=_util.default.getTransitionDurationFromElement(this._backdrop);(0,_jquery.default)(this._backdrop).one(_util.default.TRANSITION_END,callback).emulateTransitionEnd(backdropTransitionDuration)}else if(!this._isShown&&this._backdrop){(0,_jquery.default)(this._backdrop).removeClass("show");var callbackRemove=function(){_this9._removeBackdrop(),callback&&callback()};if((0,_jquery.default)(this._element).hasClass("fade")){var _backdropTransitionDuration=_util.default.getTransitionDurationFromElement(this._backdrop);(0,_jquery.default)(this._backdrop).one(_util.default.TRANSITION_END,callbackRemove).emulateTransitionEnd(_backdropTransitionDuration)}else callbackRemove()}else callback&&callback()}},{key:"_adjustDialog",value:function(){var isModalOverflowing=this._element.scrollHeight>document.documentElement.clientHeight;!this._isBodyOverflowing&&isModalOverflowing&&(this._element.style.paddingLeft="".concat(this._scrollbarWidth,"px")),this._isBodyOverflowing&&!isModalOverflowing&&(this._element.style.paddingRight="".concat(this._scrollbarWidth,"px"))}},{key:"_resetAdjustments",value:function(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}},{key:"_checkScrollbar",value:function(){var rect=document.body.getBoundingClientRect();this._isBodyOverflowing=Math.round(rect.left+rect.right)<window.innerWidth,this._scrollbarWidth=this._getScrollbarWidth()}},{key:"_setScrollbar",value:function(){var _this10=this;if(this._isBodyOverflowing){var fixedContent=[].slice.call(document.querySelectorAll(".fixed-top, .fixed-bottom, .is-fixed, .sticky-top")),stickyContent=[].slice.call(document.querySelectorAll(".sticky-top"));(0,_jquery.default)(fixedContent).each((function(index,element){var actualPadding=element.style.paddingRight,calculatedPadding=(0,_jquery.default)(element).css("padding-right");(0,_jquery.default)(element).data("padding-right",actualPadding).css("padding-right","".concat(parseFloat(calculatedPadding)+_this10._scrollbarWidth,"px"))})),(0,_jquery.default)(stickyContent).each((function(index,element){var actualMargin=element.style.marginRight,calculatedMargin=(0,_jquery.default)(element).css("margin-right");(0,_jquery.default)(element).data("margin-right",actualMargin).css("margin-right","".concat(parseFloat(calculatedMargin)-_this10._scrollbarWidth,"px"))}));var actualPadding=document.body.style.paddingRight,calculatedPadding=(0,_jquery.default)(document.body).css("padding-right");(0,_jquery.default)(document.body).data("padding-right",actualPadding).css("padding-right","".concat(parseFloat(calculatedPadding)+this._scrollbarWidth,"px"))}(0,_jquery.default)(document.body).addClass("modal-open")}},{key:"_resetScrollbar",value:function(){var fixedContent=[].slice.call(document.querySelectorAll(".fixed-top, .fixed-bottom, .is-fixed, .sticky-top"));(0,_jquery.default)(fixedContent).each((function(index,element){var padding=(0,_jquery.default)(element).data("padding-right");(0,_jquery.default)(element).removeData("padding-right"),element.style.paddingRight=padding||""}));var elements=[].slice.call(document.querySelectorAll("".concat(".sticky-top")));(0,_jquery.default)(elements).each((function(index,element){var margin=(0,_jquery.default)(element).data("margin-right");void 0!==margin&&(0,_jquery.default)(element).css("margin-right",margin).removeData("margin-right")}));var padding=(0,_jquery.default)(document.body).data("padding-right");(0,_jquery.default)(document.body).removeData("padding-right"),document.body.style.paddingRight=padding||""}},{key:"_getScrollbarWidth",value:function(){var scrollDiv=document.createElement("div");scrollDiv.className="modal-scrollbar-measure",document.body.appendChild(scrollDiv);var scrollbarWidth=scrollDiv.getBoundingClientRect().width-scrollDiv.clientWidth;return document.body.removeChild(scrollDiv),scrollbarWidth}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Modal}();(0,_jquery.default)(document).on(EVENT_CLICK_DATA_API,'[data-toggle="modal"]',(function(event){var target,_this11=this,selector=_util.default.getSelectorFromElement(this);selector&&(target=document.querySelector(selector));var config=(0,_jquery.default)(target).data("bs.modal")?"toggle":_objectSpread(_objectSpread({},(0,_jquery.default)(target).data()),(0,_jquery.default)(this).data());"A"!==this.tagName&&"AREA"!==this.tagName||event.preventDefault();var $target=(0,_jquery.default)(target).one(EVENT_SHOW,(function(showEvent){showEvent.isDefaultPrevented()||$target.one(EVENT_HIDDEN,(function(){(0,_jquery.default)(_this11).is(":visible")&&_this11.focus()}))}));Modal._jQueryInterface.call((0,_jquery.default)(target),config,this)})),_jquery.default.fn.modal=Modal._jQueryInterface,_jquery.default.fn.modal.Constructor=Modal,_jquery.default.fn.modal.noConflict=function(){return _jquery.default.fn.modal=JQUERY_NO_CONFLICT,Modal._jQueryInterface};var _default=Modal;return _exports.default=_default,_exports.default}));
define("theme_boost/bootstrap/tooltip",["exports","./tools/sanitizer","jquery","core/popper","./util"],(function(_exports,_sanitizer,_jquery,_popper,_util){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_popper=_interopRequireDefault(_popper),_util=_interopRequireDefault(_util);var NAME="tooltip",EVENT_KEY=".".concat("bs.tooltip"),JQUERY_NO_CONFLICT=_jquery.default.fn[NAME],BSCLS_PREFIX_REGEX=new RegExp("(^|\\s)".concat("bs-tooltip","\\S+"),"g"),DISALLOWED_ATTRIBUTES=["sanitize","whiteList","sanitizeFn"],DefaultType={animation:"boolean",template:"string",title:"(string|element|function)",trigger:"string",delay:"(number|object)",html:"boolean",selector:"(string|boolean)",placement:"(string|function)",offset:"(number|string|function)",container:"(string|element|boolean)",fallbackPlacement:"(string|array)",boundary:"(string|element)",sanitize:"boolean",sanitizeFn:"(null|function)",whiteList:"object",popperConfig:"(null|object)"},AttachmentMap={AUTO:"auto",TOP:"top",RIGHT:"right",BOTTOM:"bottom",LEFT:"left"},Default={animation:!0,template:'<div class="tooltip" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,selector:!1,placement:"top",offset:0,container:!1,fallbackPlacement:"flip",boundary:"scrollParent",sanitize:!0,sanitizeFn:null,whiteList:_sanitizer.DefaultWhitelist,popperConfig:null},Event={HIDE:"hide".concat(EVENT_KEY),HIDDEN:"hidden".concat(EVENT_KEY),SHOW:"show".concat(EVENT_KEY),SHOWN:"shown".concat(EVENT_KEY),INSERTED:"inserted".concat(EVENT_KEY),CLICK:"click".concat(EVENT_KEY),FOCUSIN:"focusin".concat(EVENT_KEY),FOCUSOUT:"focusout".concat(EVENT_KEY),MOUSEENTER:"mouseenter".concat(EVENT_KEY),MOUSELEAVE:"mouseleave".concat(EVENT_KEY)},Tooltip=function(){function Tooltip(element,config){if(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Tooltip),void 0===_popper.default)throw new TypeError("Bootstrap's tooltips require Popper.js (https://popper.js.org/)");this._isEnabled=!0,this._timeout=0,this._hoverState="",this._activeTrigger={},this._popper=null,this.element=element,this.config=this._getConfig(config),this.tip=null,this._setListeners()}var Constructor,protoProps,staticProps;return Constructor=Tooltip,staticProps=[{key:"VERSION",get:function(){return"4.5.0"}},{key:"Default",get:function(){return Default}},{key:"NAME",get:function(){return NAME}},{key:"DATA_KEY",get:function(){return"bs.tooltip"}},{key:"Event",get:function(){return Event}},{key:"EVENT_KEY",get:function(){return EVENT_KEY}},{key:"DefaultType",get:function(){return DefaultType}},{key:"_jQueryInterface",value:function(config){return this.each((function(){var data=(0,_jquery.default)(this).data("bs.tooltip"),_config="object"===_typeof(config)&&config;if((data||!/dispose|hide/.test(config))&&(data||(data=new Tooltip(this,_config),(0,_jquery.default)(this).data("bs.tooltip",data)),"string"==typeof config)){if(void 0===data[config])throw new TypeError('No method named "'.concat(config,'"'));data[config]()}}))}}],(protoProps=[{key:"enable",value:function(){this._isEnabled=!0}},{key:"disable",value:function(){this._isEnabled=!1}},{key:"toggleEnabled",value:function(){this._isEnabled=!this._isEnabled}},{key:"toggle",value:function(event){if(this._isEnabled)if(event){var dataKey=this.constructor.DATA_KEY,context=(0,_jquery.default)(event.currentTarget).data(dataKey);context||(context=new this.constructor(event.currentTarget,this._getDelegateConfig()),(0,_jquery.default)(event.currentTarget).data(dataKey,context)),context._activeTrigger.click=!context._activeTrigger.click,context._isWithActiveTrigger()?context._enter(null,context):context._leave(null,context)}else{if((0,_jquery.default)(this.getTipElement()).hasClass("show"))return void this._leave(null,this);this._enter(null,this)}}},{key:"dispose",value:function(){clearTimeout(this._timeout),_jquery.default.removeData(this.element,this.constructor.DATA_KEY),(0,_jquery.default)(this.element).off(this.constructor.EVENT_KEY),(0,_jquery.default)(this.element).closest(".modal").off("hide.bs.modal",this._hideModalHandler),this.tip&&(0,_jquery.default)(this.tip).remove(),this._isEnabled=null,this._timeout=null,this._hoverState=null,this._activeTrigger=null,this._popper&&this._popper.destroy(),this._popper=null,this.element=null,this.config=null,this.tip=null}},{key:"show",value:function(){var _this=this;if("none"===(0,_jquery.default)(this.element).css("display"))throw new Error("Please use show on visible elements");var showEvent=_jquery.default.Event(this.constructor.Event.SHOW);if(this.isWithContent()&&this._isEnabled){(0,_jquery.default)(this.element).trigger(showEvent);var shadowRoot=_util.default.findShadowRoot(this.element),isInTheDom=_jquery.default.contains(null!==shadowRoot?shadowRoot:this.element.ownerDocument.documentElement,this.element);if(showEvent.isDefaultPrevented()||!isInTheDom)return;var tip=this.getTipElement(),tipId=_util.default.getUID(this.constructor.NAME);tip.setAttribute("id",tipId),this.element.setAttribute("aria-describedby",tipId),this.setContent(),this.config.animation&&(0,_jquery.default)(tip).addClass("fade");var placement="function"==typeof this.config.placement?this.config.placement.call(this,tip,this.element):this.config.placement,attachment=this._getAttachment(placement);this.addAttachmentClass(attachment);var container=this._getContainer();(0,_jquery.default)(tip).data(this.constructor.DATA_KEY,this),_jquery.default.contains(this.element.ownerDocument.documentElement,this.tip)||(0,_jquery.default)(tip).appendTo(container),(0,_jquery.default)(this.element).trigger(this.constructor.Event.INSERTED),this._popper=new _popper.default(this.element,tip,this._getPopperConfig(attachment)),(0,_jquery.default)(tip).addClass("show"),"ontouchstart"in document.documentElement&&(0,_jquery.default)(document.body).children().on("mouseover",null,_jquery.default.noop);var complete=function(){_this.config.animation&&_this._fixTransition();var prevHoverState=_this._hoverState;_this._hoverState=null,(0,_jquery.default)(_this.element).trigger(_this.constructor.Event.SHOWN),"out"===prevHoverState&&_this._leave(null,_this)};if((0,_jquery.default)(this.tip).hasClass("fade")){var transitionDuration=_util.default.getTransitionDurationFromElement(this.tip);(0,_jquery.default)(this.tip).one(_util.default.TRANSITION_END,complete).emulateTransitionEnd(transitionDuration)}else complete()}}},{key:"hide",value:function(callback){var _this2=this,tip=this.getTipElement(),hideEvent=_jquery.default.Event(this.constructor.Event.HIDE),complete=function(){"show"!==_this2._hoverState&&tip.parentNode&&tip.parentNode.removeChild(tip),_this2._cleanTipClass(),_this2.element.removeAttribute("aria-describedby"),(0,_jquery.default)(_this2.element).trigger(_this2.constructor.Event.HIDDEN),null!==_this2._popper&&_this2._popper.destroy(),callback&&callback()};if((0,_jquery.default)(this.element).trigger(hideEvent),!hideEvent.isDefaultPrevented()){if((0,_jquery.default)(tip).removeClass("show"),"ontouchstart"in document.documentElement&&(0,_jquery.default)(document.body).children().off("mouseover",null,_jquery.default.noop),this._activeTrigger.click=!1,this._activeTrigger.focus=!1,this._activeTrigger.hover=!1,(0,_jquery.default)(this.tip).hasClass("fade")){var transitionDuration=_util.default.getTransitionDurationFromElement(tip);(0,_jquery.default)(tip).one(_util.default.TRANSITION_END,complete).emulateTransitionEnd(transitionDuration)}else complete();this._hoverState=""}}},{key:"update",value:function(){null!==this._popper&&this._popper.scheduleUpdate()}},{key:"isWithContent",value:function(){return Boolean(this.getTitle())}},{key:"addAttachmentClass",value:function(attachment){(0,_jquery.default)(this.getTipElement()).addClass("".concat("bs-tooltip","-").concat(attachment))}},{key:"getTipElement",value:function(){return this.tip=this.tip||(0,_jquery.default)(this.config.template)[0],this.tip}},{key:"setContent",value:function(){var tip=this.getTipElement();this.setElementContent((0,_jquery.default)(tip.querySelectorAll(".tooltip-inner")),this.getTitle()),(0,_jquery.default)(tip).removeClass("".concat("fade"," ").concat("show"))}},{key:"setElementContent",value:function($element,content){"object"!==_typeof(content)||!content.nodeType&&!content.jquery?this.config.html?(this.config.sanitize&&(content=(0,_sanitizer.sanitizeHtml)(content,this.config.whiteList,this.config.sanitizeFn)),$element.html(content)):$element.text(content):this.config.html?(0,_jquery.default)(content).parent().is($element)||$element.empty().append(content):$element.text((0,_jquery.default)(content).text())}},{key:"getTitle",value:function(){var title=this.element.getAttribute("data-original-title");return title||(title="function"==typeof this.config.title?this.config.title.call(this.element):this.config.title),title}},{key:"_getPopperConfig",value:function(attachment){var _this3=this;return _objectSpread(_objectSpread({},{placement:attachment,modifiers:{offset:this._getOffset(),flip:{behavior:this.config.fallbackPlacement},arrow:{element:".arrow"},preventOverflow:{boundariesElement:this.config.boundary}},onCreate:function(data){data.originalPlacement!==data.placement&&_this3._handlePopperPlacementChange(data)},onUpdate:function(data){return _this3._handlePopperPlacementChange(data)}}),this.config.popperConfig)}},{key:"_getOffset",value:function(){var _this4=this,offset={};return"function"==typeof this.config.offset?offset.fn=function(data){return data.offsets=_objectSpread(_objectSpread({},data.offsets),_this4.config.offset(data.offsets,_this4.element)||{}),data}:offset.offset=this.config.offset,offset}},{key:"_getContainer",value:function(){return!1===this.config.container?document.body:_util.default.isElement(this.config.container)?(0,_jquery.default)(this.config.container):(0,_jquery.default)(document).find(this.config.container)}},{key:"_getAttachment",value:function(placement){return AttachmentMap[placement.toUpperCase()]}},{key:"_setListeners",value:function(){var _this5=this;this.config.trigger.split(" ").forEach((function(trigger){if("click"===trigger)(0,_jquery.default)(_this5.element).on(_this5.constructor.Event.CLICK,_this5.config.selector,(function(event){return _this5.toggle(event)}));else if("manual"!==trigger){var eventIn="hover"===trigger?_this5.constructor.Event.MOUSEENTER:_this5.constructor.Event.FOCUSIN,eventOut="hover"===trigger?_this5.constructor.Event.MOUSELEAVE:_this5.constructor.Event.FOCUSOUT;(0,_jquery.default)(_this5.element).on(eventIn,_this5.config.selector,(function(event){return _this5._enter(event)})).on(eventOut,_this5.config.selector,(function(event){return _this5._leave(event)}))}})),this._hideModalHandler=function(){_this5.element&&_this5.hide()},(0,_jquery.default)(this.element).closest(".modal").on("hide.bs.modal",this._hideModalHandler),this.config.selector?this.config=_objectSpread(_objectSpread({},this.config),{},{trigger:"manual",selector:""}):this._fixTitle()}},{key:"_fixTitle",value:function(){var titleType=_typeof(this.element.getAttribute("data-original-title"));(this.element.getAttribute("title")||"string"!==titleType)&&(this.element.setAttribute("data-original-title",this.element.getAttribute("title")||""),this.element.setAttribute("title",""))}},{key:"_enter",value:function(event,context){var dataKey=this.constructor.DATA_KEY;(context=context||(0,_jquery.default)(event.currentTarget).data(dataKey))||(context=new this.constructor(event.currentTarget,this._getDelegateConfig()),(0,_jquery.default)(event.currentTarget).data(dataKey,context)),event&&(context._activeTrigger["focusin"===event.type?"focus":"hover"]=!0),(0,_jquery.default)(context.getTipElement()).hasClass("show")||"show"===context._hoverState?context._hoverState="show":(clearTimeout(context._timeout),context._hoverState="show",context.config.delay&&context.config.delay.show?context._timeout=setTimeout((function(){"show"===context._hoverState&&context.show()}),context.config.delay.show):context.show())}},{key:"_leave",value:function(event,context){var dataKey=this.constructor.DATA_KEY;(context=context||(0,_jquery.default)(event.currentTarget).data(dataKey))||(context=new this.constructor(event.currentTarget,this._getDelegateConfig()),(0,_jquery.default)(event.currentTarget).data(dataKey,context)),event&&(context._activeTrigger["focusout"===event.type?"focus":"hover"]=!1),context._isWithActiveTrigger()||(clearTimeout(context._timeout),context._hoverState="out",context.config.delay&&context.config.delay.hide?context._timeout=setTimeout((function(){"out"===context._hoverState&&context.hide()}),context.config.delay.hide):context.hide())}},{key:"_isWithActiveTrigger",value:function(){for(var trigger in this._activeTrigger)if(this._activeTrigger[trigger])return!0;return!1}},{key:"_getConfig",value:function(config){var dataAttributes=(0,_jquery.default)(this.element).data();return Object.keys(dataAttributes).forEach((function(dataAttr){-1!==DISALLOWED_ATTRIBUTES.indexOf(dataAttr)&&delete dataAttributes[dataAttr]})),"number"==typeof(config=_objectSpread(_objectSpread(_objectSpread({},this.constructor.Default),dataAttributes),"object"===_typeof(config)&&config?config:{})).delay&&(config.delay={show:config.delay,hide:config.delay}),"number"==typeof config.title&&(config.title=config.title.toString()),"number"==typeof config.content&&(config.content=config.content.toString()),_util.default.typeCheckConfig(NAME,config,this.constructor.DefaultType),config.sanitize&&(config.template=(0,_sanitizer.sanitizeHtml)(config.template,config.whiteList,config.sanitizeFn)),config}},{key:"_getDelegateConfig",value:function(){var config={};if(this.config)for(var key in this.config)this.constructor.Default[key]!==this.config[key]&&(config[key]=this.config[key]);return config}},{key:"_cleanTipClass",value:function(){var $tip=(0,_jquery.default)(this.getTipElement()),tabClass=$tip.attr("class").match(BSCLS_PREFIX_REGEX);null!==tabClass&&tabClass.length&&$tip.removeClass(tabClass.join(""))}},{key:"_handlePopperPlacementChange",value:function(popperData){this.tip=popperData.instance.popper,this._cleanTipClass(),this.addAttachmentClass(this._getAttachment(popperData.placement))}},{key:"_fixTransition",value:function(){var tip=this.getTipElement(),initConfigAnimation=this.config.animation;null===tip.getAttribute("x-placement")&&((0,_jquery.default)(tip).removeClass("fade"),this.config.animation=!1,this.hide(),this.show(),this.config.animation=initConfigAnimation)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Tooltip}();_jquery.default.fn[NAME]=Tooltip._jQueryInterface,_jquery.default.fn[NAME].Constructor=Tooltip,_jquery.default.fn[NAME].noConflict=function(){return _jquery.default.fn[NAME]=JQUERY_NO_CONFLICT,Tooltip._jQueryInterface};var _default=Tooltip;return _exports.default=_default,_exports.default}));
define("theme_boost/bootstrap/util",["exports","jquery"],(function(_exports,_jquery){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};function toType(obj){return null==obj?"".concat(obj):{}.toString.call(obj).match(/\s([a-z]+)/i)[1].toLowerCase()}function transitionEndEmulator(duration){var _this=this,called=!1;return(0,_jquery.default)(this).one(Util.TRANSITION_END,(function(){called=!0})),setTimeout((function(){called||Util.triggerTransitionEnd(_this)}),duration),this}var Util={TRANSITION_END:"bsTransitionEnd",getUID:function(prefix){do{prefix+=~~(1e6*Math.random())}while(document.getElementById(prefix));return prefix},getSelectorFromElement:function(element){var selector=element.getAttribute("data-target");if(!selector||"#"===selector){var hrefAttr=element.getAttribute("href");selector=hrefAttr&&"#"!==hrefAttr?hrefAttr.trim():""}try{return document.querySelector(selector)?selector:null}catch(err){return null}},getTransitionDurationFromElement:function(element){if(!element)return 0;var transitionDuration=(0,_jquery.default)(element).css("transition-duration"),transitionDelay=(0,_jquery.default)(element).css("transition-delay"),floatTransitionDuration=parseFloat(transitionDuration),floatTransitionDelay=parseFloat(transitionDelay);return floatTransitionDuration||floatTransitionDelay?(transitionDuration=transitionDuration.split(",")[0],transitionDelay=transitionDelay.split(",")[0],1e3*(parseFloat(transitionDuration)+parseFloat(transitionDelay))):0},reflow:function(element){return element.offsetHeight},triggerTransitionEnd:function(element){(0,_jquery.default)(element).trigger("transitionend")},supportsTransitionEnd:function(){return Boolean("transitionend")},isElement:function(obj){return(obj[0]||obj).nodeType},typeCheckConfig:function(componentName,config,configTypes){for(var property in configTypes)if(Object.prototype.hasOwnProperty.call(configTypes,property)){var expectedTypes=configTypes[property],value=config[property],valueType=value&&Util.isElement(value)?"element":toType(value);if(!new RegExp(expectedTypes).test(valueType))throw new Error("".concat(componentName.toUpperCase(),": ")+'Option "'.concat(property,'" provided type "').concat(valueType,'" ')+'but expected type "'.concat(expectedTypes,'".'))}},findShadowRoot:function(element){if(!document.documentElement.attachShadow)return null;if("function"==typeof element.getRootNode){var root=element.getRootNode();return root instanceof ShadowRoot?root:null}return element instanceof ShadowRoot?element:element.parentNode?Util.findShadowRoot(element.parentNode):null},jQueryDetection:function(){if(void 0===_jquery.default)throw new TypeError("Bootstrap's JavaScript requires jQuery. jQuery must be included before Bootstrap's JavaScript.");var version=_jquery.default.fn.jquery.split(" ")[0].split(".");if(version[0]<2&&version[1]<9||1===version[0]&&9===version[1]&&version[2]<1||version[0]>=4)throw new Error("Bootstrap's JavaScript requires at least jQuery v1.9.1 but less than v4.0.0")}};Util.jQueryDetection(),_jquery.default.fn.emulateTransitionEnd=transitionEndEmulator,_jquery.default.event.special[Util.TRANSITION_END]={bindType:"transitionend",delegateType:"transitionend",handle:function(event){if((0,_jquery.default)(event.target).is(this))return event.handleObj.handler.apply(this,arguments)}};var _default=Util;return _exports.default=_default,_exports.default}));
define("theme_boost/bootstrap/carousel",["exports","jquery","./util"],(function(_exports,_jquery,_util){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_util=_interopRequireDefault(_util);var NAME="carousel",DATA_KEY="bs.carousel",EVENT_KEY=".".concat(DATA_KEY),JQUERY_NO_CONFLICT=_jquery.default.fn[NAME],Default={interval:5e3,keyboard:!0,slide:!1,pause:"hover",wrap:!0,touch:!0},DefaultType={interval:"(number|boolean)",keyboard:"boolean",slide:"(boolean|string)",pause:"(string|boolean)",wrap:"boolean",touch:"boolean"},EVENT_SLIDE="slide".concat(EVENT_KEY),EVENT_SLID="slid".concat(EVENT_KEY),EVENT_KEYDOWN="keydown".concat(EVENT_KEY),EVENT_MOUSEENTER="mouseenter".concat(EVENT_KEY),EVENT_MOUSELEAVE="mouseleave".concat(EVENT_KEY),EVENT_TOUCHSTART="touchstart".concat(EVENT_KEY),EVENT_TOUCHMOVE="touchmove".concat(EVENT_KEY),EVENT_TOUCHEND="touchend".concat(EVENT_KEY),EVENT_POINTERDOWN="pointerdown".concat(EVENT_KEY),EVENT_POINTERUP="pointerup".concat(EVENT_KEY),EVENT_DRAG_START="dragstart".concat(EVENT_KEY),EVENT_LOAD_DATA_API="load".concat(EVENT_KEY).concat(".data-api"),EVENT_CLICK_DATA_API="click".concat(EVENT_KEY).concat(".data-api"),PointerType={TOUCH:"touch",PEN:"pen"},Carousel=function(){function Carousel(element,config){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Carousel),this._items=null,this._interval=null,this._activeElement=null,this._isPaused=!1,this._isSliding=!1,this.touchTimeout=null,this.touchStartX=0,this.touchDeltaX=0,this._config=this._getConfig(config),this._element=element,this._indicatorsElement=this._element.querySelector(".carousel-indicators"),this._touchSupported="ontouchstart"in document.documentElement||navigator.maxTouchPoints>0,this._pointerEvent=Boolean(window.PointerEvent||window.MSPointerEvent),this._addEventListeners()}var Constructor,protoProps,staticProps;return Constructor=Carousel,staticProps=[{key:"VERSION",get:function(){return"4.5.0"}},{key:"Default",get:function(){return Default}},{key:"_jQueryInterface",value:function(config){return this.each((function(){var data=(0,_jquery.default)(this).data(DATA_KEY),_config=_objectSpread(_objectSpread({},Default),(0,_jquery.default)(this).data());"object"===_typeof(config)&&(_config=_objectSpread(_objectSpread({},_config),config));var action="string"==typeof config?config:_config.slide;if(data||(data=new Carousel(this,_config),(0,_jquery.default)(this).data(DATA_KEY,data)),"number"==typeof config)data.to(config);else if("string"==typeof action){if(void 0===data[action])throw new TypeError('No method named "'.concat(action,'"'));data[action]()}else _config.interval&&_config.ride&&(data.pause(),data.cycle())}))}},{key:"_dataApiClickHandler",value:function(event){var selector=_util.default.getSelectorFromElement(this);if(selector){var target=(0,_jquery.default)(selector)[0];if(target&&(0,_jquery.default)(target).hasClass("carousel")){var config=_objectSpread(_objectSpread({},(0,_jquery.default)(target).data()),(0,_jquery.default)(this).data()),slideIndex=this.getAttribute("data-slide-to");slideIndex&&(config.interval=!1),Carousel._jQueryInterface.call((0,_jquery.default)(target),config),slideIndex&&(0,_jquery.default)(target).data(DATA_KEY).to(slideIndex),event.preventDefault()}}}}],(protoProps=[{key:"next",value:function(){this._isSliding||this._slide("next")}},{key:"nextWhenVisible",value:function(){!document.hidden&&(0,_jquery.default)(this._element).is(":visible")&&"hidden"!==(0,_jquery.default)(this._element).css("visibility")&&this.next()}},{key:"prev",value:function(){this._isSliding||this._slide("prev")}},{key:"pause",value:function(event){event||(this._isPaused=!0),this._element.querySelector(".carousel-item-next, .carousel-item-prev")&&(_util.default.triggerTransitionEnd(this._element),this.cycle(!0)),clearInterval(this._interval),this._interval=null}},{key:"cycle",value:function(event){event||(this._isPaused=!1),this._interval&&(clearInterval(this._interval),this._interval=null),this._config.interval&&!this._isPaused&&(this._interval=setInterval((document.visibilityState?this.nextWhenVisible:this.next).bind(this),this._config.interval))}},{key:"to",value:function(index){var _this=this;this._activeElement=this._element.querySelector(".active.carousel-item");var activeIndex=this._getItemIndex(this._activeElement);if(!(index>this._items.length-1||index<0))if(this._isSliding)(0,_jquery.default)(this._element).one(EVENT_SLID,(function(){return _this.to(index)}));else{if(activeIndex===index)return this.pause(),void this.cycle();var direction=index>activeIndex?"next":"prev";this._slide(direction,this._items[index])}}},{key:"dispose",value:function(){(0,_jquery.default)(this._element).off(EVENT_KEY),_jquery.default.removeData(this._element,DATA_KEY),this._items=null,this._config=null,this._element=null,this._interval=null,this._isPaused=null,this._isSliding=null,this._activeElement=null,this._indicatorsElement=null}},{key:"_getConfig",value:function(config){return config=_objectSpread(_objectSpread({},Default),config),_util.default.typeCheckConfig(NAME,config,DefaultType),config}},{key:"_handleSwipe",value:function(){var absDeltax=Math.abs(this.touchDeltaX);if(!(absDeltax<=40)){var direction=absDeltax/this.touchDeltaX;this.touchDeltaX=0,direction>0&&this.prev(),direction<0&&this.next()}}},{key:"_addEventListeners",value:function(){var _this2=this;this._config.keyboard&&(0,_jquery.default)(this._element).on(EVENT_KEYDOWN,(function(event){return _this2._keydown(event)})),"hover"===this._config.pause&&(0,_jquery.default)(this._element).on(EVENT_MOUSEENTER,(function(event){return _this2.pause(event)})).on(EVENT_MOUSELEAVE,(function(event){return _this2.cycle(event)})),this._config.touch&&this._addTouchEventListeners()}},{key:"_addTouchEventListeners",value:function(){var _this3=this;if(this._touchSupported){var start=function(event){_this3._pointerEvent&&PointerType[event.originalEvent.pointerType.toUpperCase()]?_this3.touchStartX=event.originalEvent.clientX:_this3._pointerEvent||(_this3.touchStartX=event.originalEvent.touches[0].clientX)},end=function(event){_this3._pointerEvent&&PointerType[event.originalEvent.pointerType.toUpperCase()]&&(_this3.touchDeltaX=event.originalEvent.clientX-_this3.touchStartX),_this3._handleSwipe(),"hover"===_this3._config.pause&&(_this3.pause(),_this3.touchTimeout&&clearTimeout(_this3.touchTimeout),_this3.touchTimeout=setTimeout((function(event){return _this3.cycle(event)}),500+_this3._config.interval))};(0,_jquery.default)(this._element.querySelectorAll(".carousel-item img")).on(EVENT_DRAG_START,(function(e){return e.preventDefault()})),this._pointerEvent?((0,_jquery.default)(this._element).on(EVENT_POINTERDOWN,(function(event){return start(event)})),(0,_jquery.default)(this._element).on(EVENT_POINTERUP,(function(event){return end(event)})),this._element.classList.add("pointer-event")):((0,_jquery.default)(this._element).on(EVENT_TOUCHSTART,(function(event){return start(event)})),(0,_jquery.default)(this._element).on(EVENT_TOUCHMOVE,(function(event){return function(event){event.originalEvent.touches&&event.originalEvent.touches.length>1?_this3.touchDeltaX=0:_this3.touchDeltaX=event.originalEvent.touches[0].clientX-_this3.touchStartX}(event)})),(0,_jquery.default)(this._element).on(EVENT_TOUCHEND,(function(event){return end(event)})))}}},{key:"_keydown",value:function(event){if(!/input|textarea/i.test(event.target.tagName))switch(event.which){case 37:event.preventDefault(),this.prev();break;case 39:event.preventDefault(),this.next()}}},{key:"_getItemIndex",value:function(element){return this._items=element&&element.parentNode?[].slice.call(element.parentNode.querySelectorAll(".carousel-item")):[],this._items.indexOf(element)}},{key:"_getItemByDirection",value:function(direction,activeElement){var isNextDirection="next"===direction,isPrevDirection="prev"===direction,activeIndex=this._getItemIndex(activeElement),lastItemIndex=this._items.length-1;if((isPrevDirection&&0===activeIndex||isNextDirection&&activeIndex===lastItemIndex)&&!this._config.wrap)return activeElement;var itemIndex=(activeIndex+("prev"===direction?-1:1))%this._items.length;return-1===itemIndex?this._items[this._items.length-1]:this._items[itemIndex]}},{key:"_triggerSlideEvent",value:function(relatedTarget,eventDirectionName){var targetIndex=this._getItemIndex(relatedTarget),fromIndex=this._getItemIndex(this._element.querySelector(".active.carousel-item")),slideEvent=_jquery.default.Event(EVENT_SLIDE,{relatedTarget:relatedTarget,direction:eventDirectionName,from:fromIndex,to:targetIndex});return(0,_jquery.default)(this._element).trigger(slideEvent),slideEvent}},{key:"_setActiveIndicatorElement",value:function(element){if(this._indicatorsElement){var indicators=[].slice.call(this._indicatorsElement.querySelectorAll(".active"));(0,_jquery.default)(indicators).removeClass("active");var nextIndicator=this._indicatorsElement.children[this._getItemIndex(element)];nextIndicator&&(0,_jquery.default)(nextIndicator).addClass("active")}}},{key:"_slide",value:function(direction,element){var directionalClassName,orderClassName,eventDirectionName,_this4=this,activeElement=this._element.querySelector(".active.carousel-item"),activeElementIndex=this._getItemIndex(activeElement),nextElement=element||activeElement&&this._getItemByDirection(direction,activeElement),nextElementIndex=this._getItemIndex(nextElement),isCycling=Boolean(this._interval);if("next"===direction?(directionalClassName="carousel-item-left",orderClassName="carousel-item-next",eventDirectionName="left"):(directionalClassName="carousel-item-right",orderClassName="carousel-item-prev",eventDirectionName="right"),nextElement&&(0,_jquery.default)(nextElement).hasClass("active"))this._isSliding=!1;else if(!this._triggerSlideEvent(nextElement,eventDirectionName).isDefaultPrevented()&&activeElement&&nextElement){this._isSliding=!0,isCycling&&this.pause(),this._setActiveIndicatorElement(nextElement);var slidEvent=_jquery.default.Event(EVENT_SLID,{relatedTarget:nextElement,direction:eventDirectionName,from:activeElementIndex,to:nextElementIndex});if((0,_jquery.default)(this._element).hasClass("slide")){(0,_jquery.default)(nextElement).addClass(orderClassName),_util.default.reflow(nextElement),(0,_jquery.default)(activeElement).addClass(directionalClassName),(0,_jquery.default)(nextElement).addClass(directionalClassName);var nextElementInterval=parseInt(nextElement.getAttribute("data-interval"),10);nextElementInterval?(this._config.defaultInterval=this._config.defaultInterval||this._config.interval,this._config.interval=nextElementInterval):this._config.interval=this._config.defaultInterval||this._config.interval;var transitionDuration=_util.default.getTransitionDurationFromElement(activeElement);(0,_jquery.default)(activeElement).one(_util.default.TRANSITION_END,(function(){(0,_jquery.default)(nextElement).removeClass("".concat(directionalClassName," ").concat(orderClassName)).addClass("active"),(0,_jquery.default)(activeElement).removeClass("".concat("active"," ").concat(orderClassName," ").concat(directionalClassName)),_this4._isSliding=!1,setTimeout((function(){return(0,_jquery.default)(_this4._element).trigger(slidEvent)}),0)})).emulateTransitionEnd(transitionDuration)}else(0,_jquery.default)(activeElement).removeClass("active"),(0,_jquery.default)(nextElement).addClass("active"),this._isSliding=!1,(0,_jquery.default)(this._element).trigger(slidEvent);isCycling&&this.cycle()}}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Carousel}();(0,_jquery.default)(document).on(EVENT_CLICK_DATA_API,"[data-slide], [data-slide-to]",Carousel._dataApiClickHandler),(0,_jquery.default)(window).on(EVENT_LOAD_DATA_API,(function(){for(var carousels=[].slice.call(document.querySelectorAll('[data-ride="carousel"]')),i=0,len=carousels.length;i<len;i++){var $carousel=(0,_jquery.default)(carousels[i]);Carousel._jQueryInterface.call($carousel,$carousel.data())}})),_jquery.default.fn[NAME]=Carousel._jQueryInterface,_jquery.default.fn[NAME].Constructor=Carousel,_jquery.default.fn[NAME].noConflict=function(){return _jquery.default.fn[NAME]=JQUERY_NO_CONFLICT,Carousel._jQueryInterface};var _default=Carousel;return _exports.default=_default,_exports.default}));
define("theme_boost/bootstrap/popover",["exports","jquery","./tooltip"],(function(_exports,_jquery,_tooltip){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&("object"===_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_tooltip=_interopRequireDefault(_tooltip);var NAME="popover",EVENT_KEY=".".concat("bs.popover"),JQUERY_NO_CONFLICT=_jquery.default.fn[NAME],BSCLS_PREFIX_REGEX=new RegExp("(^|\\s)".concat("bs-popover","\\S+"),"g"),Default=_objectSpread(_objectSpread({},_tooltip.default.Default),{},{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>'}),DefaultType=_objectSpread(_objectSpread({},_tooltip.default.DefaultType),{},{content:"(string|element|function)"}),Event={HIDE:"hide".concat(EVENT_KEY),HIDDEN:"hidden".concat(EVENT_KEY),SHOW:"show".concat(EVENT_KEY),SHOWN:"shown".concat(EVENT_KEY),INSERTED:"inserted".concat(EVENT_KEY),CLICK:"click".concat(EVENT_KEY),FOCUSIN:"focusin".concat(EVENT_KEY),FOCUSOUT:"focusout".concat(EVENT_KEY),MOUSEENTER:"mouseenter".concat(EVENT_KEY),MOUSELEAVE:"mouseleave".concat(EVENT_KEY)},Popover=function(_Tooltip){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}(Popover,_Tooltip);var Constructor,protoProps,staticProps,_super=_createSuper(Popover);function Popover(){return _classCallCheck(this,Popover),_super.apply(this,arguments)}return Constructor=Popover,staticProps=[{key:"VERSION",get:function(){return"4.5.0"}},{key:"Default",get:function(){return Default}},{key:"NAME",get:function(){return NAME}},{key:"DATA_KEY",get:function(){return"bs.popover"}},{key:"Event",get:function(){return Event}},{key:"EVENT_KEY",get:function(){return EVENT_KEY}},{key:"DefaultType",get:function(){return DefaultType}},{key:"_jQueryInterface",value:function(config){return this.each((function(){var data=(0,_jquery.default)(this).data("bs.popover"),_config="object"===_typeof(config)?config:null;if((data||!/dispose|hide/.test(config))&&(data||(data=new Popover(this,_config),(0,_jquery.default)(this).data("bs.popover",data)),"string"==typeof config)){if(void 0===data[config])throw new TypeError('No method named "'.concat(config,'"'));data[config]()}}))}}],(protoProps=[{key:"isWithContent",value:function(){return this.getTitle()||this._getContent()}},{key:"addAttachmentClass",value:function(attachment){(0,_jquery.default)(this.getTipElement()).addClass("".concat("bs-popover","-").concat(attachment))}},{key:"getTipElement",value:function(){return this.tip=this.tip||(0,_jquery.default)(this.config.template)[0],this.tip}},{key:"setContent",value:function(){var $tip=(0,_jquery.default)(this.getTipElement());this.setElementContent($tip.find(".popover-header"),this.getTitle());var content=this._getContent();"function"==typeof content&&(content=content.call(this.element)),this.setElementContent($tip.find(".popover-body"),content),$tip.removeClass("".concat("fade"," ").concat("show"))}},{key:"_getContent",value:function(){return this.element.getAttribute("data-content")||this.config.content}},{key:"_cleanTipClass",value:function(){var $tip=(0,_jquery.default)(this.getTipElement()),tabClass=$tip.attr("class").match(BSCLS_PREFIX_REGEX);null!==tabClass&&tabClass.length>0&&$tip.removeClass(tabClass.join(""))}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Popover}(_tooltip.default);_jquery.default.fn[NAME]=Popover._jQueryInterface,_jquery.default.fn[NAME].Constructor=Popover,_jquery.default.fn[NAME].noConflict=function(){return _jquery.default.fn[NAME]=JQUERY_NO_CONFLICT,Popover._jQueryInterface};var _default=Popover;return _exports.default=_default,_exports.default}));
define("theme_boost/bootstrap/dropdown",["exports","jquery","core/popper","./util"],(function(_exports,_jquery,_popper,_util){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_popper=_interopRequireDefault(_popper),_util=_interopRequireDefault(_util);var NAME="dropdown",DATA_KEY="bs.dropdown",EVENT_KEY=".".concat(DATA_KEY),JQUERY_NO_CONFLICT=_jquery.default.fn[NAME],REGEXP_KEYDOWN=new RegExp("".concat(38,"|").concat(40,"|").concat(27)),EVENT_HIDE="hide".concat(EVENT_KEY),EVENT_HIDDEN="hidden".concat(EVENT_KEY),EVENT_SHOW="show".concat(EVENT_KEY),EVENT_SHOWN="shown".concat(EVENT_KEY),EVENT_CLICK="click".concat(EVENT_KEY),EVENT_CLICK_DATA_API="click".concat(EVENT_KEY).concat(".data-api"),EVENT_KEYDOWN_DATA_API="keydown".concat(EVENT_KEY).concat(".data-api"),EVENT_KEYUP_DATA_API="keyup".concat(EVENT_KEY).concat(".data-api"),Default={offset:0,flip:!0,boundary:"scrollParent",reference:"toggle",display:"dynamic",popperConfig:null},DefaultType={offset:"(number|string|function)",flip:"boolean",boundary:"(string|element)",reference:"(string|element)",display:"string",popperConfig:"(null|object)"},Dropdown=function(){function Dropdown(element,config){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Dropdown),this._element=element,this._popper=null,this._config=this._getConfig(config),this._menu=this._getMenuElement(),this._inNavbar=this._detectNavbar(),this._addEventListeners()}var Constructor,protoProps,staticProps;return Constructor=Dropdown,protoProps=[{key:"toggle",value:function(){if(!this._element.disabled&&!(0,_jquery.default)(this._element).hasClass("disabled")){var isActive=(0,_jquery.default)(this._menu).hasClass("show");Dropdown._clearMenus(),isActive||this.show(!0)}}},{key:"show",value:function(){var usePopper=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!(this._element.disabled||(0,_jquery.default)(this._element).hasClass("disabled")||(0,_jquery.default)(this._menu).hasClass("show"))){var relatedTarget={relatedTarget:this._element},showEvent=_jquery.default.Event(EVENT_SHOW,relatedTarget),parent=Dropdown._getParentFromElement(this._element);if((0,_jquery.default)(parent).trigger(showEvent),!showEvent.isDefaultPrevented()){if(!this._inNavbar&&usePopper){if(void 0===_popper.default)throw new TypeError("Bootstrap's dropdowns require Popper.js (https://popper.js.org/)");var referenceElement=this._element;"parent"===this._config.reference?referenceElement=parent:_util.default.isElement(this._config.reference)&&(referenceElement=this._config.reference,void 0!==this._config.reference.jquery&&(referenceElement=this._config.reference[0])),"scrollParent"!==this._config.boundary&&(0,_jquery.default)(parent).addClass("position-static"),this._popper=new _popper.default(referenceElement,this._menu,this._getPopperConfig())}"ontouchstart"in document.documentElement&&0===(0,_jquery.default)(parent).closest(".navbar-nav").length&&(0,_jquery.default)(document.body).children().on("mouseover",null,_jquery.default.noop),this._element.focus(),this._element.setAttribute("aria-expanded",!0),(0,_jquery.default)(this._menu).toggleClass("show"),(0,_jquery.default)(parent).toggleClass("show").trigger(_jquery.default.Event(EVENT_SHOWN,relatedTarget))}}}},{key:"hide",value:function(){if(!this._element.disabled&&!(0,_jquery.default)(this._element).hasClass("disabled")&&(0,_jquery.default)(this._menu).hasClass("show")){var relatedTarget={relatedTarget:this._element},hideEvent=_jquery.default.Event(EVENT_HIDE,relatedTarget),parent=Dropdown._getParentFromElement(this._element);(0,_jquery.default)(parent).trigger(hideEvent),hideEvent.isDefaultPrevented()||(this._popper&&this._popper.destroy(),(0,_jquery.default)(this._menu).toggleClass("show"),(0,_jquery.default)(parent).toggleClass("show").trigger(_jquery.default.Event(EVENT_HIDDEN,relatedTarget)))}}},{key:"dispose",value:function(){_jquery.default.removeData(this._element,DATA_KEY),(0,_jquery.default)(this._element).off(EVENT_KEY),this._element=null,this._menu=null,null!==this._popper&&(this._popper.destroy(),this._popper=null)}},{key:"update",value:function(){this._inNavbar=this._detectNavbar(),null!==this._popper&&this._popper.scheduleUpdate()}},{key:"_addEventListeners",value:function(){var _this=this;(0,_jquery.default)(this._element).on(EVENT_CLICK,(function(event){event.preventDefault(),event.stopPropagation(),_this.toggle()}))}},{key:"_getConfig",value:function(config){return config=_objectSpread(_objectSpread(_objectSpread({},this.constructor.Default),(0,_jquery.default)(this._element).data()),config),_util.default.typeCheckConfig(NAME,config,this.constructor.DefaultType),config}},{key:"_getMenuElement",value:function(){if(!this._menu){var parent=Dropdown._getParentFromElement(this._element);parent&&(this._menu=parent.querySelector(".dropdown-menu"))}return this._menu}},{key:"_getPlacement",value:function(){var $parentDropdown=(0,_jquery.default)(this._element.parentNode),placement="bottom-start";return $parentDropdown.hasClass("dropup")?placement=(0,_jquery.default)(this._menu).hasClass("dropdown-menu-right")?"top-end":"top-start":$parentDropdown.hasClass("dropright")?placement="right-start":$parentDropdown.hasClass("dropleft")?placement="left-start":(0,_jquery.default)(this._menu).hasClass("dropdown-menu-right")&&(placement="bottom-end"),placement}},{key:"_detectNavbar",value:function(){return(0,_jquery.default)(this._element).closest(".navbar").length>0}},{key:"_getOffset",value:function(){var _this2=this,offset={};return"function"==typeof this._config.offset?offset.fn=function(data){return data.offsets=_objectSpread(_objectSpread({},data.offsets),_this2._config.offset(data.offsets,_this2._element)||{}),data}:offset.offset=this._config.offset,offset}},{key:"_getPopperConfig",value:function(){var popperConfig={placement:this._getPlacement(),modifiers:{offset:this._getOffset(),flip:{enabled:this._config.flip},preventOverflow:{boundariesElement:this._config.boundary}}};return"static"===this._config.display&&(popperConfig.modifiers.applyStyle={enabled:!1}),_objectSpread(_objectSpread({},popperConfig),this._config.popperConfig)}}],staticProps=[{key:"VERSION",get:function(){return"4.5.0"}},{key:"Default",get:function(){return Default}},{key:"DefaultType",get:function(){return DefaultType}},{key:"_jQueryInterface",value:function(config){return this.each((function(){var data=(0,_jquery.default)(this).data(DATA_KEY),_config="object"===_typeof(config)?config:null;if(data||(data=new Dropdown(this,_config),(0,_jquery.default)(this).data(DATA_KEY,data)),"string"==typeof config){if(void 0===data[config])throw new TypeError('No method named "'.concat(config,'"'));data[config]()}}))}},{key:"_clearMenus",value:function(event){if(!event||3!==event.which&&("keyup"!==event.type||9===event.which))for(var toggles=[].slice.call(document.querySelectorAll('[data-toggle="dropdown"]')),i=0,len=toggles.length;i<len;i++){var parent=Dropdown._getParentFromElement(toggles[i]),context=(0,_jquery.default)(toggles[i]).data(DATA_KEY),relatedTarget={relatedTarget:toggles[i]};if(event&&"click"===event.type&&(relatedTarget.clickEvent=event),context){var dropdownMenu=context._menu;if((0,_jquery.default)(parent).hasClass("show")&&!(event&&("click"===event.type&&/input|textarea/i.test(event.target.tagName)||"keyup"===event.type&&9===event.which)&&_jquery.default.contains(parent,event.target))){var hideEvent=_jquery.default.Event(EVENT_HIDE,relatedTarget);(0,_jquery.default)(parent).trigger(hideEvent),hideEvent.isDefaultPrevented()||("ontouchstart"in document.documentElement&&(0,_jquery.default)(document.body).children().off("mouseover",null,_jquery.default.noop),toggles[i].setAttribute("aria-expanded","false"),context._popper&&context._popper.destroy(),(0,_jquery.default)(dropdownMenu).removeClass("show"),(0,_jquery.default)(parent).removeClass("show").trigger(_jquery.default.Event(EVENT_HIDDEN,relatedTarget)))}}}}},{key:"_getParentFromElement",value:function(element){var parent,selector=_util.default.getSelectorFromElement(element);return selector&&(parent=document.querySelector(selector)),parent||element.parentNode}},{key:"_dataApiKeydownHandler",value:function(event){if(!(/input|textarea/i.test(event.target.tagName)?32===event.which||27!==event.which&&(40!==event.which&&38!==event.which||(0,_jquery.default)(event.target).closest(".dropdown-menu").length):!REGEXP_KEYDOWN.test(event.which))&&!this.disabled&&!(0,_jquery.default)(this).hasClass("disabled")){var parent=Dropdown._getParentFromElement(this),isActive=(0,_jquery.default)(parent).hasClass("show");if(isActive||27!==event.which){if(event.preventDefault(),event.stopPropagation(),!isActive||isActive&&(27===event.which||32===event.which))return 27===event.which&&(0,_jquery.default)(parent.querySelector('[data-toggle="dropdown"]')).trigger("focus"),void(0,_jquery.default)(this).trigger("click");var items=[].slice.call(parent.querySelectorAll(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)")).filter((function(item){return(0,_jquery.default)(item).is(":visible")}));if(0!==items.length){var index=items.indexOf(event.target);38===event.which&&index>0&&index--,40===event.which&&index<items.length-1&&index++,index<0&&(index=0),items[index].focus()}}}}}],protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Dropdown}();(0,_jquery.default)(document).on(EVENT_KEYDOWN_DATA_API,'[data-toggle="dropdown"]',Dropdown._dataApiKeydownHandler).on(EVENT_KEYDOWN_DATA_API,".dropdown-menu",Dropdown._dataApiKeydownHandler).on("".concat(EVENT_CLICK_DATA_API," ").concat(EVENT_KEYUP_DATA_API),Dropdown._clearMenus).on(EVENT_CLICK_DATA_API,'[data-toggle="dropdown"]',(function(event){event.preventDefault(),event.stopPropagation(),Dropdown._jQueryInterface.call((0,_jquery.default)(this),"toggle")})).on(EVENT_CLICK_DATA_API,".dropdown form",(function(e){e.stopPropagation()})),_jquery.default.fn[NAME]=Dropdown._jQueryInterface,_jquery.default.fn[NAME].Constructor=Dropdown,_jquery.default.fn[NAME].noConflict=function(){return _jquery.default.fn[NAME]=JQUERY_NO_CONFLICT,Dropdown._jQueryInterface};var _default=Dropdown;return _exports.default=_default,_exports.default}));
define("theme_boost/popover",["exports","./bootstrap/popover"],(function(_exports,_popover){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),Object.defineProperty(_exports,"Popover",{enumerable:!0,get:function(){return _popover.default}}),_popover=(obj=_popover)&&obj.__esModule?obj:{default:obj}}));
define("theme_boost/pending",["exports","jquery"],(function(_exports,_jquery){var obj;function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};var moduleTransitions={alert:[{start:"close",end:"closed"}],carousel:[{start:"slide",end:"slid"}],collapse:[{start:"hide",end:"hidden"},{start:"show",end:"shown"}],dropdown:[{start:"hide",end:"hidden"},{start:"show",end:"shown"}],modal:[{start:"hide",end:"hidden"},{start:"show",end:"shown"}],popover:[{start:"hide",end:"hidden"},{start:"show",end:"shown"}],tab:[{start:"hide",end:"hidden"},{start:"show",end:"shown"}],toast:[{start:"hide",end:"hidden"},{start:"show",end:"shown"}],tooltip:[{start:"hide",end:"hidden"},{start:"show",end:"shown"}]};return _exports.default=function(){Object.entries(moduleTransitions).forEach((function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0];_ref2[1].forEach((function(pair){var eventStart="".concat(pair.start,".bs.").concat(key),eventEnd="".concat(pair.end,".bs.").concat(key);(0,_jquery.default)(document.body).on(eventStart,(function(e){M.util.js_pending(eventEnd),(0,_jquery.default)(e.target).one(eventEnd,(function(){M.util.js_complete(eventEnd)}))}))}))}))},_exports.default}));
define("forumreport_summary/filters",["exports","jquery","core/popper","core/custom_interaction_events","forumreport_summary/selectors","core/yui","core/ajax","core/key_codes"],(function(_exports,_jquery,_popper,_custom_interaction_events,_selectors,_yui,_ajax,_key_codes){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Module responsible for handling forum summary report filters.
   *
   * @module     forumreport_summary/filters
   * @package    forumreport_summary
   * @copyright  2019 Michael Hawkins <michaelh@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_popper=_interopRequireDefault(_popper),_custom_interaction_events=_interopRequireDefault(_custom_interaction_events),_selectors=_interopRequireDefault(_selectors),_yui=_interopRequireDefault(_yui),_ajax=_interopRequireDefault(_ajax),_key_codes=_interopRequireDefault(_key_codes);_exports.init=function(root){var jqRoot=(0,_jquery.default)(root);(0,_jquery.default)(document).ready((function(){(0,_jquery.default)(".loading-icon").hide(),(0,_jquery.default)("#summaryreport").removeClass("hidden")}));var generateWithFilters=function(event,getparams){var newLink,currentLink=document.forms.filtersform.action;if(event){event.preventDefault();var currentSplit=currentLink.split("?"),currentstring=currentSplit[1],newparamsarray=getparams.split("&"),paramsstring="",paramkeys=[],paramvalues=[];currentstring.split("&").forEach((function(param){var splitparam=param.split("=");paramkeys.push(splitparam[0]),paramvalues.push(splitparam[1])})),newparamsarray.forEach((function(paramstring){var newparam=paramstring.split("="),existingkey=paramkeys.indexOf(newparam[0]);existingkey>-1?paramvalues[existingkey]=newparam[1]:(paramkeys.push(newparam[0]),paramvalues.push(newparam[1]))})),paramkeys.forEach((function(name,key){paramsstring+="&".concat(name,"=").concat(paramvalues[key])})),newLink=currentSplit[0]+"?"+paramsstring.substr(1)}else newLink=currentLink;document.forms.filtersform.action=newLink,document.forms.filtersform.submit()};(0,_jquery.default)(".resettable").on("click","a",(function(event){generateWithFilters(event,event.target.search.substr(1))})),(0,_jquery.default)("thead").on("click","a",(function(event){generateWithFilters(event,event.target.search.substr(1))})),(0,_jquery.default)(".pagination").on("click","a",(function(event){generateWithFilters(event,event.target.search.substr(1))})),document.forms.selectperpage&&(document.forms.selectperpage.onsubmit=function(event){var getparam="perpage="+document.forms.selectperpage.elements.perpage.value;generateWithFilters(event,getparam)});var downloadForm=document.getElementById("summaryreport").querySelector("form.dataformatselector");downloadForm&&(downloadForm.onsubmit=function(event){var downloadType=downloadForm.querySelector("#downloadtype_download").value,getParams="download=".concat(downloadType),prevAction=document.forms.filtersform.action;generateWithFilters(event,getParams),document.forms.filtersform.action=prevAction});var submitWithFilter=function(containerelement){_yui.default.use("moodle-core-formchangechecker",(function(){M.core_formchangechecker.reset_form_dirty_state()})),(0,_jquery.default)(containerelement).addClass("hidden"),generateWithFilters(!1)},updateCalendarPosition=function(referenceid){var referenceElement=document.querySelector(referenceid),popperContent=document.querySelector(_selectors.default.filters.date.calendar);popperContent.style.removeProperty("z-index"),new _popper.default(referenceElement,popperContent,{placement:"bottom"})},closeOpenFilters=function(openFilterButton,openFilter){openFilter.classList.add("hidden"),openFilter.setAttribute("data-openfilter","false"),openFilterButton.classList.add("btn-primary"),openFilterButton.classList.remove("btn-outline-primary"),openFilterButton.setAttribute("aria-expanded",!1)};jqRoot.on(_custom_interaction_events.default.events.activate,_selectors.default.filters.group.selectall,(function(){root.querySelectorAll(_selectors.default.filters.group.checkbox+":not(:checked)").forEach((function(checkbox){checkbox.checked=!0}))})),jqRoot.on(_custom_interaction_events.default.events.activate,_selectors.default.filters.group.clear,(function(){root.querySelectorAll(_selectors.default.filters.group.checkbox+":checked").forEach((function(checkbox){checkbox.checked=!1}))})),jqRoot.on(_custom_interaction_events.default.events.activate,_selectors.default.filters.group.trigger,(function(){var referenceElement=root.querySelector(_selectors.default.filters.group.trigger),popperContent=root.querySelector(_selectors.default.filters.group.popover);new _popper.default(referenceElement,popperContent,{placement:"bottom"}),popperContent.classList.remove("hidden"),popperContent.setAttribute("data-openfilter","true"),referenceElement.classList.add("btn-outline-primary"),referenceElement.classList.remove("btn-primary"),referenceElement.setAttribute("aria-expanded",!0);var closeListener=function closeListener(e){e.target.id===referenceElement.id||popperContent===e.target.closest('[data-openfilter="true"]')||void 0!==e.keyCode&&e.keyCode!==_key_codes.default.enter&&e.keyCode!==_key_codes.default.space||(closeOpenFilters(referenceElement,popperContent),document.removeEventListener("click",closeListener),document.removeEventListener("keyup",closeListener),document.removeEventListener("keyup",escCloseListener))};document.addEventListener("click",closeListener),document.addEventListener("keyup",closeListener);var escCloseListener=function escCloseListener(e){e.keyCode===_key_codes.default.escape&&(closeOpenFilters(referenceElement,popperContent),document.removeEventListener("keyup",escCloseListener),document.removeEventListener("click",closeListener))};document.addEventListener("keyup",escCloseListener)})),jqRoot.on(_custom_interaction_events.default.events.activate,_selectors.default.filters.group.save,(function(){root.querySelectorAll(_selectors.default.filters.group.checkbox).forEach((function(popcheckbox){var filtersform=document.forms.filtersform,saveid=popcheckbox.getAttribute("data-saveid");filtersform.querySelector("#".concat(saveid)).checked=popcheckbox.checked})),submitWithFilter("#filter-groups-popover")})),document.querySelectorAll(_selectors.default.filters.exportlink.link).forEach((function(exportbutton){exportbutton.addEventListener("click",(function(event){document.forms.exportlinkform.action=event.target.dataset.url,document.forms.exportlinkform.submit()}))})),jqRoot.on(_custom_interaction_events.default.events.activate,_selectors.default.filters.date.trigger,(function(){var referenceElement=root.querySelector(_selectors.default.filters.date.trigger),popperContent=root.querySelector(_selectors.default.filters.date.popover);new _popper.default(referenceElement,popperContent,{placement:"bottom"}),popperContent.classList.remove("hidden"),popperContent.setAttribute("data-openfilter","true"),popperContent.querySelector('[name="filterdatefrompopover[enabled]"]').focus(),referenceElement.classList.add("btn-outline-primary"),referenceElement.classList.remove("btn-primary"),referenceElement.setAttribute("aria-expanded",!0);var closeListener=function closeListener(e){e.target.id===referenceElement.id||popperContent===e.target.closest('[data-openfilter="true"]')||void 0!==e.keyCode&&e.keyCode!==_key_codes.default.enter&&e.keyCode!==_key_codes.default.space||(closeOpenFilters(referenceElement,popperContent),document.removeEventListener("click",closeListener),document.removeEventListener("keyup",closeListener),document.removeEventListener("keyup",escCloseListener))};document.addEventListener("click",closeListener),document.addEventListener("keyup",closeListener);var escCloseListener=function escCloseListener(e){e.keyCode===_key_codes.default.escape&&(closeOpenFilters(referenceElement,popperContent),document.removeEventListener("keyup",escCloseListener),document.removeEventListener("click",closeListener))};document.addEventListener("keyup",escCloseListener)})),jqRoot.on(_custom_interaction_events.default.events.activate,_selectors.default.filters.date.save,(function(){var filtersForm=document.forms.filtersform,datesPopover=root.querySelector(_selectors.default.filters.date.popover),fromEnabled=datesPopover.querySelector('[name="filterdatefrompopover[enabled]"]').checked?1:0,toEnabled=datesPopover.querySelector('[name="filterdatetopopover[enabled]"]').checked?1:0;if(fromEnabled||toEnabled){var args={data:[]};fromEnabled&&args.data.push({key:"from",year:datesPopover.querySelector('[name="filterdatefrompopover[year]"]').value,month:datesPopover.querySelector('[name="filterdatefrompopover[month]"]').value,day:datesPopover.querySelector('[name="filterdatefrompopover[day]"]').value,hour:0,minute:0}),toEnabled&&args.data.push({key:"to",year:datesPopover.querySelector('[name="filterdatetopopover[year]"]').value,month:datesPopover.querySelector('[name="filterdatetopopover[month]"]').value,day:datesPopover.querySelector('[name="filterdatetopopover[day]"]').value,hour:23,minute:59});var request={methodname:"core_calendar_get_timestamps",args:args};_ajax.default.call([request])[0].done((function(result){var fromTimestamp=0,toTimestamp=0;if(result.timestamps.forEach((function(data){"from"===data.key?fromTimestamp=data.timestamp:"to"===data.key&&(toTimestamp=data.timestamp)})),toTimestamp>0&&fromTimestamp>toTimestamp){var warningdiv=document.getElementById("dates-filter-warning");warningdiv.classList.remove("hidden"),warningdiv.classList.add("d-block")}else filtersForm.elements["datefrom[timestamp]"].value=fromTimestamp,filtersForm.elements["datefrom[enabled]"].value=fromEnabled,filtersForm.elements["dateto[timestamp]"].value=toTimestamp,filtersForm.elements["dateto[enabled]"].value=toEnabled,submitWithFilter("#filter-dates-popover")}))}else filtersForm.elements["datefrom[timestamp]"].value=0,filtersForm.elements["datefrom[enabled]"].value=fromEnabled,filtersForm.elements["dateto[timestamp]"].value=0,filtersForm.elements["dateto[enabled]"].value=toEnabled,submitWithFilter("#filter-dates-popover")})),jqRoot.on(_custom_interaction_events.default.events.activate,_selectors.default.filters.date.calendariconfrom,(function(){updateCalendarPosition(_selectors.default.filters.date.calendariconfrom)})),jqRoot.on(_custom_interaction_events.default.events.activate,_selectors.default.filters.date.calendariconto,(function(){updateCalendarPosition(_selectors.default.filters.date.calendariconto)}))}}));
define("forumreport_summary/selectors",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;return _exports.default={filters:{group:{checkbox:'[data-region="filter-groups"] input[type="checkbox"]',clear:'[data-region="filter-groups"] .filter-clear',popover:"#filter-groups-popover",save:'[data-region="filter-groups"] .filter-save',selectall:'[data-region="filter-groups"] .select-all',trigger:"#filter-groups-button"},date:{calendar:"#dateselector-calendar-panel",calendariconfrom:"#id_filterdatefrompopover_calendar",calendariconto:"#id_filterdatetopopover_calendar",popover:"#filter-dates-popover",save:'[data-region="filter-dates"] .filter-save',trigger:"#filter-dates-button"},exportlink:{link:"#summaryreport #forumreport_summary_table button.export-link"}}},_exports.default}));
define("quizaccess_seb/managetemplates",["jquery","core/ajax","core/str","core/notification"],(function($,ajax,str,notification){var manager={removeTemplate:function(e){e.preventDefault();var targetUrl=$(e.currentTarget).attr("href");str.get_strings([{key:"confirmtemplateremovaltitle",component:"quizaccess_seb"},{key:"confirmtemplateremovalquestion",component:"quizaccess_seb"},{key:"yes",component:"moodle"},{key:"no",component:"moodle"}]).then((function(s){notification.confirm(s[0],s[1],s[2],s[3],(function(){window.location=targetUrl}))})).catch()},setup:function(){$("body").delegate('[data-action="delete"]',"click",manager.removeTemplate)}};return{setup:manager.setup}}));
